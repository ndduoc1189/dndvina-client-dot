import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHJhbmRvbQppbXBvcnQgdW5pY29kZWRhdGEKZnJvbSBzZXJ2aWNlcy5oZWxwZXJfc2VydmljZSBpbXBvcnQgSGVscGVyU2VydmljZQppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBweW90cAoKZGVmIHJlbW92ZV92aWV0bmFtZXNlX2FjY2VudHModGV4dCk6CiAgICB0ZXh0ID0gdW5pY29kZWRhdGEubm9ybWFsaXplKCdORkQnLCB0ZXh0KQogICAgdGV4dCA9ICcnLmpvaW4oW2MgZm9yIGMgaW4gdGV4dCBpZiB1bmljb2RlZGF0YS5jYXRlZ29yeShjKSAhPSAnTW4nXSkKICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoJ8SRJywgJ2QnKS5yZXBsYWNlKCfEkCcsICdEJykKICAgIHJldHVybiB0ZXh0CgpkZWYgcmFuZG9tX2JpcnRoZGF5KCk6CiAgICB5ZWFyID0gcmFuZG9tLnJhbmRpbnQoMTk5NCwgMjAwNSkKICAgIG1vbnRoID0gcmFuZG9tLnJhbmRpbnQoMSwgMTIpCiAgICBpZiBtb250aCA9PSAyOgogICAgICAgIGRheSA9IHJhbmRvbS5yYW5kaW50KDEsIDI4KQogICAgZWxpZiBtb250aCBpbiBbNCwgNiwgOSwgMTFdOgogICAgICAgIGRheSA9IHJhbmRvbS5yYW5kaW50KDEsIDMwKQogICAgZWxzZToKICAgICAgICBkYXkgPSByYW5kb20ucmFuZGludCgxLCAzMSkKICAgIHJldHVybiBkYXksIG1vbnRoLCB5ZWFyCgpkZWYgcmVnaXN0ZXJfaW5zdGFncmFtX2FjY291bnQoaXA9IjEwLjAuMy40NiIgKToKICAgIGhlbHBlciA9IEhlbHBlclNlcnZpY2UoYmFzZV91cmw9ZiJodHRwOi8ve2lwfTo5MDk5IikKICAgIG5hbWVzPSJOZ3V54buFbiBUaOG7iyBMYW58VHLhuqduIFRo4buLIEhvYXxMw6ogVGjhu4sgSMawxqFuZ3xQaOG6oW0gVGjhu4sgSOG6sW5nfEhvw6BuZyBUaOG7iyBUaHV8SHXhu7NuaCBUaOG7iyBNYWl8UGhhbiBUaOG7iyBI4bqhbmh8VsWpIFRo4buLIE5n4buNY3xWw7UgVGjhu4sgTWluaHzEkOG6t25nIFRo4buLIEhp4buBbnxCw7lpIFRo4buLIER1bmd8xJDhu5cgVGjhu4sgVHJhbmd8SOG7kyBUaOG7iyBQaMawxqFuZ3xOZ8O0IFRo4buLIFF1ecOqbnxExrDGoW5nIFRo4buLIFnhur9ufEzDvSBUaOG7iyBOaHVuZ3xOZ3V54buFbiBUaOG7iyBUdXnhur90fFRy4bqnbiBUaOG7iyBWw6JufEzDqiBUaOG7iyBUaGFuaHxQaOG6oW0gVGjhu4sgVMOibXxIb8OgbmcgVGjhu4sgSG9hfEh14buzbmggVGjhu4sgSMawxqFuZ3xQaGFuIFRo4buLIEjhurFuZ3xWxakgVGjhu4sgVGh1fFbDtSBUaOG7iyBNYWl8xJDhurduZyBUaOG7iyBI4bqhbmh8QsO5aSBUaOG7iyBOZ+G7jWN8xJDhu5cgVGjhu4sgTWluaHxI4buTIFRo4buLIEhp4buBbnxOZ8O0IFRo4buLIER1bmd8RMawxqFuZyBUaOG7iyBUcmFuZ3xMw70gVGjhu4sgUGjGsMahbmd8Tmd1eeG7hW4gVGjhu4sgUXV5w6pufFRy4bqnbiBUaOG7iyBZ4bq/bnxMw6ogVGjhu4sgTmh1bmd8UGjhuqFtIFRo4buLIFR1eeG6v3R8SG/DoG5nIFRo4buLIFbDom58SHXhu7NuaCBUaOG7iyBUaGFuaHxQaGFuIFRo4buLIFTDom18VsWpIFRo4buLIExhbnxWw7UgVGjhu4sgSG9hfMSQ4bq3bmcgVGjhu4sgSMawxqFuZ3xCw7lpIFRo4buLIEjhurFuZ3zEkOG7lyBUaOG7iyBUaHV8SOG7kyBUaOG7iyBNYWl8TmfDtCBUaOG7iyBI4bqhbmh8RMawxqFuZyBUaOG7iyBOZ+G7jWN8TMO9IFRo4buLIE1pbmh8Tmd1eeG7hW4gVGjhu4sgSGnhu4FufFRy4bqnbiBUaOG7iyBEdW5nfEzDqiBUaOG7iyBUcmFuZ3xQaOG6oW0gVGjhu4sgUGjGsMahbmd8SG/DoG5nIFRo4buLIFF1ecOqbnxIdeG7s25oIFRo4buLIFnhur9ufFBoYW4gVGjhu4sgTmh1bmd8VsWpIFRo4buLIFR1eeG6v3R8VsO1IFRo4buLIFbDom58xJDhurduZyBUaOG7iyBUaGFuaHxCw7lpIFRo4buLIFTDom18xJDhu5cgVGjhu4sgTGFufEjhu5MgVGjhu4sgSG9hfE5nw7QgVGjhu4sgSMawxqFuZ3xExrDGoW5nIFRo4buLIEjhurFuZ3xMw70gVGjhu4sgVGh1fE5ndXnhu4VuIFRo4buLIE1haXxUcuG6p24gVGjhu4sgSOG6oW5ofEzDqiBUaOG7iyBOZ+G7jWN8UGjhuqFtIFRo4buLIE1pbmh8SG/DoG5nIFRo4buLIEhp4buBbnxIdeG7s25oIFRo4buLIER1bmd8UGhhbiBUaOG7iyBUcmFuZ3xWxakgVGjhu4sgUGjGsMahbmd8VsO1IFRo4buLIFF1ecOqbnzEkOG6t25nIFRo4buLIFnhur9ufELDuWkgVGjhu4sgTmh1bmd8xJDhu5cgVGjhu4sgVHV54bq/dHxI4buTIFRo4buLIFbDom58TmfDtCBUaOG7iyBUaGFuaHxExrDGoW5nIFRo4buLIFTDom18TMO9IFRo4buLIExhbnxOZ3V54buFbiBUaOG7iyBIb2F8VHLhuqduIFRo4buLIEjGsMahbmd8TMOqIFRo4buLIEjhurFuZ3xQaOG6oW0gVGjhu4sgVGh1fEhvw6BuZyBUaOG7iyBNYWl8SHXhu7NuaCBUaOG7iyBI4bqhbmh8UGhhbiBUaOG7iyBOZ+G7jWN8VsWpIFRo4buLIE1pbmh8VsO1IFRo4buLIEhp4buBbnzEkOG6t25nIFRo4buLIER1bmd8QsO5aSBUaOG7iyBUcmFuZ3zEkOG7lyBUaOG7iyBQaMawxqFuZ3xI4buTIFRo4buLIFF1ecOqbnxOZ8O0IFRo4buLIFnhur9ufETGsMahbmcgVGjhu4sgTmh1bmd8TMO9IFRo4buLIFR1eeG6v3R8Tmd1eeG7hW4gVGjhu4sgVsOibnxUcuG6p24gVGjhu4sgVGhhbmh8TMOqIFRo4buLIFTDom18UGjhuqFtIFRo4buLIExhbnxIb8OgbmcgVGjhu4sgSG9hfEh14buzbmggVGjhu4sgSMawxqFuZ3xQaGFuIFRo4buLIEjhurFuZ3xWxakgVGjhu4sgVGh1fFbDtSBUaOG7iyBNYWl8xJDhurduZyBUaOG7iyBI4bqhbmh8QsO5aSBUaOG7iyBOZ+G7jWN8xJDhu5cgVGjhu4sgTWluaHxI4buTIFRo4buLIEhp4buBbnxOZ8O0IFRo4buLIER1bmd8RMawxqFuZyBUaOG7iyBUcmFuZ3xMw70gVGjhu4sgUGjGsMahbmd8Tmd1eeG7hW4gVGjhu4sgUXV5w6pufFRy4bqnbiBUaOG7iyBZ4bq/bnxMw6ogVGjhu4sgTmh1bmd8UGjhuqFtIFRo4buLIFR1eeG6v3R8SG/DoG5nIFRo4buLIFbDom58SHXhu7NuaCBUaOG7iyBUaGFuaHxQaGFuIFRo4buLIFTDom18VsWpIFRo4buLIExhbnxWw7UgVGjhu4sgSG9hfMSQ4bq3bmcgVGjhu4sgSMawxqFuZ3xCw7lpIFRo4buLIEjhurFuZ3zEkOG7lyBUaOG7iyBUaHV8SOG7kyBUaOG7iyBNYWl8TmfDtCBUaOG7iyBI4bqhbmh8RMawxqFuZyBUaOG7iyBOZ+G7jWN8TMO9IFRo4buLIE1pbmh8Tmd1eeG7hW4gVGjhu4sgSGnhu4FufFRy4bqnbiBUaOG7iyBEdW5nfEzDqiBUaOG7iyBUcmFuZ3xQaOG6oW0gVGjhu4sgUGjGsMahbmd8SG/DoG5nIFRo4buLIFF1ecOqbnxIdeG7s25oIFRo4buLIFnhur9ufFBoYW4gVGjhu4sgTmh1bmd8VsWpIFRo4buLIFR1eeG6v3R8VsO1IFRo4buLIFbDom58xJDhurduZyBUaOG7iyBUaGFuaHxCw7lpIFRo4buLIFTDom0iCiAgICBhcHBfcGFja2FnZSA9ICJjb20uaW5zdGFncmFtLmFuZHJvaWQiCiAgICBwcmludCgiWytdIMSQw7NuZyBhcHAgSW5zdGFncmFtLi4uIikKICAgIGhlbHBlci5jbG9zZV9hcHAoYXBwX3BhY2thZ2UpCiAgICB0aW1lLnNsZWVwKDIpCiAgICBwcmludCgiWytdIE3hu58gYXBwIEluc3RhZ3JhbS4uLiIpCiAgICBoZWxwZXIub3Blbl9hcHAoYXBwX3BhY2thZ2UpCiAgICB0aW1lLnNsZWVwKDUpCgogICAgIyBWw6BvIHByb2ZpbGUKICAgIHByaW50KCJbK10gVsOgbyB0YWIgVHJhbmcgY8OhIG5ow6JuLi4uIikKICAgIGZvciBfIGluIHJhbmdlKDMpOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBwcm9maWxlX3RhYiA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICBpZiBwcm9maWxlX3RhYjoKICAgICAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihwcm9maWxlX3RhYikKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICBoZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAgICAgICAgIGhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICBoZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICBoZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICB0aW1lLnNsZWVwKDEpCgogICAgIyBC4bqlbSB2w6BvIHRpw6p1IMSR4buBIHVzZXJuYW1lIMSR4buDIG3hu58gZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgIHByaW50KCJbK10gTeG7nyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbi4uLiIpCiAgICBmb3IgXyBpbiByYW5nZSgzKToKICAgICAgICBzY3JlZW5feG1sID0gaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfbGFyZ2VfdGl0bGVfYXV0b19zaXplIikKICAgICAgICBpZiB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih1c2VybmFtZV90aXRsZSkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQoKICAgICMgQuG6pW0gVGjDqm0gdMOgaSBraG/huqNuCiAgICBwcmludCgiWytdIELhuqVtIFRow6ptIHTDoGkga2hv4bqjbi4uLiIpCiAgICBmb3IgXyBpbiByYW5nZSgzKToKICAgICAgICBzY3JlZW5feG1sID0gaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgYWRkX2FjY291bnQgPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlRow6ptIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0iKQogICAgICAgIGlmIGFkZF9hY2NvdW50OgogICAgICAgICAgICByZXN1bHQgPSBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGFkZF9hY2NvdW50KQogICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmVzdWx0LCBkaWN0KSBhbmQgcmVzdWx0LmdldCgic3RhdHVzIikgPT0gImVycm9yIjoKICAgICAgICAgICAgICAgIHByaW50KGYiWyFdIEzhu5dpIGtoaSBi4bqlbSBUaMOqbSB0w6BpIGtob+G6o246IHtyZXN1bHQuZ2V0KCdtZXNzYWdlJyl9IikKICAgICAgICAgICAgICAgICMgTuG6v3UgbOG7l2kgdGjDrCBi4bqlbSAnxJDEg25nIG5o4bqtcCB2w6BvIHTDoGkga2hv4bqjbiBoaeG7h24gY8OzJwogICAgICAgICAgICAgICAgbG9naW5fZXhpc3QgPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSLEkMSDbmcgbmjhuq1wIHbDoG8gdMOgaSBraG/huqNuIGhp4buHbiBjw7MiKQogICAgICAgICAgICAgICAgaWYgbG9naW5fZXhpc3Q6CiAgICAgICAgICAgICAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihsb2dpbl9leGlzdCkKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAjIFNhdSDEkcOzIGLhuqVtIGzhuqFpICdU4bqhbyB0w6BpIGtob+G6o24gbeG7m2knCiAgICAgICAgICAgICAgICBjcmVhdGVfYWNjb3VudCA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IlThuqFvIHTDoGkga2hv4bqjbiBt4bubaSIpCiAgICAgICAgICAgICAgICBpZiBjcmVhdGVfYWNjb3VudDoKICAgICAgICAgICAgICAgICAgICBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGNyZWF0ZV9hY2NvdW50KQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICBoZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICB0aW1lLnNsZWVwKDEpCgogICAgaGVscGVyLndhaXRfZm9yX2VsZW1lbnQodGV4dD0iVOG6oW8gdMOgaSBraG/huqNuIG3hu5tpIikKICAgICMgQuG6pW0gVOG6oW8gdMOgaSBraG/huqNuIG3hu5tpCiAgICBwcmludCgiWytdIELhuqVtIFThuqFvIHTDoGkga2hv4bqjbiBt4bubaS4uLiIpCiAgICBmb3IgXyBpbiByYW5nZSgzKToKICAgICAgICBzY3JlZW5feG1sID0gaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgY3JlYXRlX2FjY291bnQgPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJU4bqhbyB0w6BpIGtob+G6o24gbeG7m2kiKQogICAgICAgIGlmIGNyZWF0ZV9hY2NvdW50OgogICAgICAgICAgICBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGNyZWF0ZV9hY2NvdW50KQogICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQoKICAgICMgU2luaCB0aMO0bmcgdGluIHJhbmRvbQogICAgbmFtZV9saXN0ID0gbmFtZXMuc3BsaXQoInwiKQogICAgZnVsbF9uYW1lID0gcmFuZG9tLmNob2ljZShuYW1lX2xpc3QpLnN0cmlwKCkKICAgIGRheSwgbW9udGgsIHllYXIgPSByYW5kb21fYmlydGhkYXkoKQogICAgYmFzZV91c2VybmFtZSA9IHJlbW92ZV92aWV0bmFtZXNlX2FjY2VudHMoZnVsbF9uYW1lKS5yZXBsYWNlKCIgIiwgIiIpLmxvd2VyKCkKICAgIGJhc2VfdXNlcm5hbWUgPSAnJy5qb2luKGMgZm9yIGMgaW4gYmFzZV91c2VybmFtZSBpZiBjLmlzYWxudW0oKSkKICAgIHVzZXJuYW1lID0gZiJ7YmFzZV91c2VybmFtZX17ZGF5OjAyZH17bW9udGg6MDJkfXtzdHIoeWVhcilbLTI6XX17cmFuZG9tLnJhbmRpbnQoMSw5OSk6MDJkfSIKICAgIGVtYWlsID0gZiJ7dXNlcm5hbWV9QGRuZHZpbmEuY29tIgogICAgcHJpbnQoZiJbK10gVGjDtG5nIHRpbiDEkcSDbmcga8O9OiB7ZnVsbF9uYW1lfSwge2RheTowMmR9L3ttb250aDowMmR9L3t5ZWFyfSwge3VzZXJuYW1lfSwge2VtYWlsfSIpCgogICAgIyBOaOG6rXAgdXNlcm5hbWUKICAgIHByaW50KCJbK10gTmjhuq1wIHVzZXJuYW1lLi4uIikKICAgIGZvciBfIGluIHJhbmdlKDMpOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICB1c2VybmFtZV9pbnB1dCA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvdXNlcm5hbWUiKQogICAgICAgIGlmIG5vdCB1c2VybmFtZV9pbnB1dDoKICAgICAgICAgICAgdXNlcm5hbWVfaW5wdXQgPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5FZGl0VGV4dCIpCiAgICAgICAgaWYgdXNlcm5hbWVfaW5wdXQ6CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIodXNlcm5hbWVfaW5wdXQpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgaGVscGVyLmlucHV0X3RleHQodXNlcm5hbWUpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoNikKICAgICAgICAgICAgIyBC4bqlbSBUaeG6v3AKICAgICAgICAgICAgbmV4dF9idG4gPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJUaeG6v3AiKQogICAgICAgICAgICBpZiBuZXh0X2J0bjoKICAgICAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIobmV4dF9idG4pCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQoKICAgICMgS2nhu4NtIHRyYSBu4bq/dSBjw7MgbsO6dCAiVOG6oW8gbeG6rXQga2jhuql1IiB0aMOsIGLhuqVtIHbDoG8KICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgIHRhb19tYXRfa2hhdV9idG4gPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJU4bqhbyBt4bqtdCBraOG6qXUiKQogICAgaWYgdGFvX21hdF9raGF1X2J0bjoKICAgICAgICBwcmludCgiWytdIFBow6F0IGhp4buHbiBuw7p0ICdU4bqhbyBt4bqtdCBraOG6qXUnLCBi4bqlbSB2w6BvLi4uIikKICAgICAgICBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHRhb19tYXRfa2hhdV9idG4pCiAgICAgICAgdGltZS5zbGVlcCgyKQoKICAgICMgTmjhuq1wIG3huq10IGto4bqpdQogICAgcHJpbnQoIlsrXSBOaOG6rXAgbeG6rXQga2jhuql1Li4uIikKICAgIGZvciBfIGluIHJhbmdlKDMpOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBwYXNzd29yZF9pbnB1dCA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcGFzc3dvcmQiKQogICAgICAgIGlmIG5vdCBwYXNzd29yZF9pbnB1dDoKICAgICAgICAgICAgcGFzc3dvcmRfaW5wdXQgPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5FZGl0VGV4dCIpCiAgICAgICAgaWYgcGFzc3dvcmRfaW5wdXQ6CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocGFzc3dvcmRfaW5wdXQpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgaGVscGVyLmlucHV0X3RleHQoInRpbnRpbkAxMjMiKQogICAgICAgICAgICB0aW1lLnNsZWVwKDQpCiAgICAgICAgICAgICMgQuG6pW0gVGnhur9wCiAgICAgICAgICAgIG5leHRfYnRuID0gaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iVGnhur9wIikKICAgICAgICAgICAgaWYgbmV4dF9idG46CiAgICAgICAgICAgICAgICBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG5leHRfYnRuKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKCiAgICAjIELhuqVtIHRow6ptIGVtYWlsL3Phu5EgxJFp4buHbiB0aG/huqFpIG3hu5tpCiAgICBwcmludCgiWytdIELhuqVtIFRow6ptIGVtYWlsIGhv4bq3YyBz4buRIMSRaeG7h24gdGhv4bqhaSBt4bubaS4uLiIpCiAgICBmb3IgXyBpbiByYW5nZSgzKToKICAgICAgICBzY3JlZW5feG1sID0gaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgYWRkX2VtYWlsX2J0biA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IlRow6ptIGVtYWlsIGhv4bq3YyBz4buRIMSRaeG7h24gdGhv4bqhaSBt4bubaSIpCiAgICAgICAgaWYgYWRkX2VtYWlsX2J0bjoKICAgICAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihhZGRfZW1haWxfYnRuKQogICAgICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQoKICAgICMgQ2h1eeG7g24gc2FuZyB0YWIgRW1haWwKICAgIHByaW50KCJbK10gQ2h1eeG7g24gc2FuZyB0YWIgRW1haWwuLi4iKQogICAgZm9yIF8gaW4gcmFuZ2UoMyk6CiAgICAgICAgc2NyZWVuX3htbCA9IGhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIGVtYWlsX3RhYiA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IkVNQUlMIikKICAgICAgICBpZiBlbWFpbF90YWI6CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZW1haWxfdGFiKQogICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQoKICAgICMgTmjhuq1wIGVtYWlsCiAgICBwcmludCgiWytdIE5o4bqtcCBlbWFpbC4uLiIpCiAgICBmb3IgXyBpbiByYW5nZSgzKToKICAgICAgICBzY3JlZW5feG1sID0gaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgZW1haWxfaW5wdXQgPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5FZGl0VGV4dCIpCiAgICAgICAgaWYgZW1haWxfaW5wdXQ6CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZW1haWxfaW5wdXQpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgaGVscGVyLmlucHV0X3RleHQoZW1haWwpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoNykKICAgICAgICAgICAgIyBC4bqlbSBUaeG6v3AKICAgICAgICAgICAgbmV4dF9idG4gPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJUaeG6v3AiKQogICAgICAgICAgICBpZiBuZXh0X2J0bjoKICAgICAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIobmV4dF9idG4pCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDUpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQoKICAgICMgPT09PT09PSBC4bquVCDEkOG6plUgxJBP4bqgTiBN4buaSTogTOG6pFkgT1RQIFbDgCBOSOG6rFAgT1RQID09PT09PT0KICAgIHByaW50KCJbK10gxJDhu6NpIG5o4bqtbiBPVFAgcXVhIGVtYWlsLi4uIikKICAgIGxhc3RzeW5jID0gaW50KHRpbWUudGltZSgpKQogICAgb3RwX2NvZGUgPSBOb25lCiAgICB0aW1lLnNsZWVwKDIpCiAgICBmb3IgXyBpbiByYW5nZSgxMjApOiAgIyBUaOG7rSB04buRaSDEkWEgNjAgbOG6p24gKHThu5FpIMSRYSAxIHBow7p0KQogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcCA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAiaHR0cDovL2FwaTMuZG5kdmluYS5jb20vYXBpL3V0aWwvZW1haWwiLAogICAgICAgICAgICAgICAganNvbj17ImVtYWlsIjogZW1haWwsICJsYXN0c3luYyI6IGxhc3RzeW5jfQogICAgICAgICAgICApCiAgICAgICAgICAgIGRhdGEgPSByZXNwLmpzb24oKQogICAgICAgICAgICBpZiBkYXRhLmdldCgic3VjY2VzcyIpIGFuZCBkYXRhLmdldCgiZGF0YSIpOgogICAgICAgICAgICAgICAgdGl0bGUgPSBkYXRhWyJkYXRhIl0uZ2V0KCJ0aXRsZSIsICIiKQogICAgICAgICAgICAgICAgaW1wb3J0IHJlCiAgICAgICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChyIihcZHs2fSkiLCB0aXRsZSkKICAgICAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgICAgIG90cF9jb2RlID0gbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDEkMOjIGzhuqV5IMSRxrDhu6NjIE9UUDoge290cF9jb2RlfSIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJbK10gQ2jGsGEgY8OzIE9UUCwgdGjhu60gbOG6oWkuLi4iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoIlshXSBM4buXaSBraGkgZ+G7jWkgQVBJIGzhuqV5IE9UUDoiLCBlKQogICAgICAgIHRpbWUuc2xlZXAoMikKICAgIGlmIG5vdCBvdHBfY29kZToKICAgICAgICBwcmludCgiWyFdIEtow7RuZyBs4bqleSDEkcaw4bujYyBPVFAsIGThu6tuZyB0aeG6v24gdHLDrG5oISIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAjIE5o4bqtcCBPVFAKICAgIHByaW50KCJbK10gTmjhuq1wIE9UUCB2w6BvIMO0IHjDoWMgdGjhu7FjLi4uIikKICAgIGZvciBfIGluIHJhbmdlKDUpOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBvdHBfaW5wdXQgPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5FZGl0VGV4dCIpCiAgICAgICAgaWYgb3RwX2lucHV0OgogICAgICAgICAgICBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG90cF9pbnB1dCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICBoZWxwZXIuaW5wdXRfdGV4dChvdHBfY29kZSkKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAjIELhuqVtIFRp4bq/cAogICAgICAgICAgICBuZXh0X2J0biA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IlRp4bq/cCIpCiAgICAgICAgICAgIGlmIG5leHRfYnRuOgogICAgICAgICAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihuZXh0X2J0bikKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkgICMgQ2jhu50gNSBnacOieQogICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKCiAgICAjIFNhdSBraGkgbmjhuq1wIE9UUCwgY2jhu50gdOG7kWkgxJFhIDIgcGjDunQgxJHhu4Mga2nhu4NtIHRyYSBuw7p0ICdIb8OgbiB04bqldCDEkcSDbmcga8O9JyBob+G6t2MgJ09LJwogICAgcHJpbnQoIlsrXSBDaOG7nSBuw7p0ICdIb8OgbiB04bqldCDEkcSDbmcga8O9JyBob+G6t2MgJ09LJy4uLiIpCiAgICBmb3IgaSBpbiByYW5nZSgxMCk6ICAjIDIgcGjDunQsIG3hu5dpIHbDsm5nIDJzCiAgICAgICAgc2NyZWVuX3htbCA9IGhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIGNvbXBsZXRlX2J0biA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9Ikhvw6BuIHThuqV0IMSRxINuZyBrw70iKQogICAgICAgIG9rX2J0biA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9Ik9LIikKICAgICAgICBpZiBjb21wbGV0ZV9idG46CiAgICAgICAgICAgIHByaW50KCJbK10gUGjDoXQgaGnhu4duIG7DunQgJ0hvw6BuIHThuqV0IMSRxINuZyBrw70nLCBi4bqlbSB2w6BvLi4uIikKICAgICAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjb21wbGV0ZV9idG4pCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMTUpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYgb2tfYnRuOgogICAgICAgICAgICBwcmludCgiWytdIFBow6F0IGhp4buHbiBuw7p0ICdPSycsIGLhuqVtIHbDoG8uLi4iKQogICAgICAgICAgICBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG9rX2J0bikKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAjIFNhdSBraGkgYuG6pW0gT0sgY8OzIHRo4buDIHPhur0geHXhuqV0IGhp4buHbiBs4bqhaSBuw7p0IGhvw6BuIHThuqV0IMSRxINuZyBrw70sIG7Dqm4ga2jDtG5nIGJyZWFrCiAgICAgICAgdGltZS5zbGVlcCgyKQoKICAgICMgQuG6pW0gQuG7jyBxdWEgbuG6v3UgY8OzCiAgICBwcmludCgiWytdIELhuqVtIELhu48gcXVhIG7hur91IGPDsy4uLiIpCiAgICBza2lwX2NvdW50ID0gMAogICAgd2hpbGUgVHJ1ZToKICAgICAgICBzY3JlZW5feG1sID0gaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgc2tpcF9idG4gPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJC4buPIHF1YSIpCiAgICAgICAgaWYgc2tpcF9idG46CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2tpcF9idG4pCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgc2tpcF9jb3VudCArPSAxCiAgICAgICAgICAgIHByaW50KGYiWytdIMSQw6MgYuG6pW0gQuG7jyBxdWEgbOG6p24ge3NraXBfY291bnR9IikKICAgICAgICBlbHNlOgogICAgICAgICAgICBicmVhawoKICAgIHByaW50KCJbK10gxJDEg25nIGvDvSB0w6BpIGtob+G6o24gSW5zdGFncmFtIGhvw6BuIHThuqV0ISIpCiAgICByZXR1cm4gewogICAgICAgICJmdWxsX25hbWUiOiBmdWxsX25hbWUsCiAgICAgICAgInVzZXJuYW1lIjogdXNlcm5hbWUsCiAgICAgICAgImVtYWlsIjogZW1haWwsCiAgICAgICAgImJpcnRoZGF5IjogZiJ7ZGF5OjAyZH0ve21vbnRoOjAyZH0ve3llYXJ9IgogICAgfQoKZGVmIHVwZGF0ZV9wcm9maWxlX2luZm8oaGVscGVyKToKICAgIHByaW50KCJbIV0gQ2jhu6ljIG7Eg25nIHPhu61hIHTDqm4sIHRp4buDdSBz4butLCBnaeG7m2kgdMOtbmggc+G6vSDEkcaw4bujYyBi4buVIHN1bmcgc2F1ISIpCiAgICAjIFRPRE86IFRo4buxYyBoaeG7h24gY8OhYyB0aGFvIHTDoWMgVUkgxJHhu4Mgc+G7rWEgdMOqbiwgdGnhu4N1IHPhu60sIGdp4bubaSB0w61uaAogICAgcGFzcwoKZGVmIHJlZ2lzdGVyXzJmYShoZWxwZXIpOgogICAgcHJpbnQoIlsyRkFdIMSQxINuZyBrw70gMkZBIEdvb2dsZSBBdXRoZW50aWNhdG9yLi4uIikKICAgIAogICAgIyBCMS4gVsOgbyB0cmFuZyBjw6EgbmjDom4KICAgIHByaW50KCJbMkZBXSBCxrDhu5tjIDE6IFbDoG8gdHJhbmcgY8OhIG5ow6JuLi4uIikKICAgIGZvciBfIGluIHJhbmdlKDMpOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBwcm9maWxlX3RhYiA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICBpZiBwcm9maWxlX3RhYjoKICAgICAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihwcm9maWxlX3RhYikKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgIAogICAgIyBCMi4gVnXhu5F0IGzDqm4gbmdo4buJIDEgZ2nDonksIHZ14buRdCB4deG7kW5nIDIgbOG6p24KICAgIHByaW50KCJbMkZBXSBCxrDhu5tjIDI6IFZ14buRdCBsw6puIHbDoCB4deG7kW5nLi4uIikKICAgIGhlbHBlci5zd2lwZV91cCgpCiAgICB0aW1lLnNsZWVwKDEpCiAgICBoZWxwZXIuc3dpcGVfZG93bigpCiAgICB0aW1lLnNsZWVwKDEpCiAgICBoZWxwZXIuc3dpcGVfZG93bigpCiAgICB0aW1lLnNsZWVwKDEpCiAgICAKICAgICMgQjMuIFTDrG0gbsO6dCAiVMO5eSBjaOG7jW4iIHbDoCBi4bqlbSB2w6BvCiAgICBwcmludCgiWzJGQV0gQsaw4bubYyAzOiBUw6xtIG7DunQgVMO5eSBjaOG7jW4uLi4iKQogICAgZm9yIF8gaW4gcmFuZ2UoNSk6CiAgICAgICAgc2NyZWVuX3htbCA9IGhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIG9wdGlvbnNfYnRuID0gaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJUw7l5IGNo4buNbiIpCiAgICAgICAgaWYgb3B0aW9uc19idG46CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIob3B0aW9uc19idG4pCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICBoZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAKICAgICMgQjQuIELhuqVtICJUcnVuZyB0w6JtIHTDoGkga2hv4bqjbiIKICAgIHByaW50KCJbMkZBXSBCxrDhu5tjIDQ6IELhuqVtIFRydW5nIHTDom0gdMOgaSBraG/huqNuLi4uIikKICAgIGZvciBfIGluIHJhbmdlKDUpOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBhY2NvdW50X2NlbnRlciA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IlRydW5nIHTDom0gdMOgaSBraG/huqNuIikKICAgICAgICBpZiBhY2NvdW50X2NlbnRlcjoKICAgICAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihhY2NvdW50X2NlbnRlcikKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgIAogICAgIyBCNS4gQuG6pW0gIk3huq10IGto4bqpdSB2w6AgYuG6o28gbeG6rXQiCiAgICBwcmludCgiWzJGQV0gQsaw4bubYyA1OiBC4bqlbSBN4bqtdCBraOG6qXUgdsOgIGLhuqNvIG3huq10Li4uIikKICAgIGZvciBfIGluIHJhbmdlKDUpOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBzZWN1cml0eV9idG4gPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJN4bqtdCBraOG6qXUgdsOgIGLhuqNvIG3huq10IikKICAgICAgICBpZiBzZWN1cml0eV9idG46CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VjdXJpdHlfYnRuKQogICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgCiAgICAjIEI2LiBC4bqlbSAiWMOhYyB0aOG7sWMgMiB54bq/dSB04buRIgogICAgcHJpbnQoIlsyRkFdIELGsOG7m2MgNjogQuG6pW0gWMOhYyB0aOG7sWMgMiB54bq/dSB04buRLi4uIikKICAgIGZvciBfIGluIHJhbmdlKDUpOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICB0d29fZmFjdG9yX2J0biA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IljDoWMgdGjhu7FjIDIgeeG6v3UgdOG7kSIpCiAgICAgICAgaWYgdHdvX2ZhY3Rvcl9idG46CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIodHdvX2ZhY3Rvcl9idG4pCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICBoZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAKICAgICMgQjcuIELhuqVtIHbDoG8gY2jhu68gIkluc3RhZ3JhbSIKICAgIHByaW50KCJbMkZBXSBCxrDhu5tjIDc6IELhuqVtIHbDoG8gY2jhu68gSW5zdGFncmFtLi4uIikKICAgIGZvciBfIGluIHJhbmdlKDUpOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBpbnN0YWdyYW1fdGV4dCA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9Ikluc3RhZ3JhbSIpCiAgICAgICAgaWYgaW5zdGFncmFtX3RleHQ6CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaW5zdGFncmFtX3RleHQpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICBoZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAKICAgICMgQjguIELhuqVtICLhu6huZyBk4bulbmcgeMOhYyB0aOG7sWMiCiAgICBwcmludCgiWzJGQV0gQsaw4bubYyA4OiBC4bqlbSDhu6huZyBk4bulbmcgeMOhYyB0aOG7sWMuLi4iKQogICAgZm9yIF8gaW4gcmFuZ2UoNSk6CiAgICAgICAgc2NyZWVuX3htbCA9IGhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIGF1dGhfYXBwX2J0biA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IuG7qG5nIGThu6VuZyB4w6FjIHRo4buxYyIpCiAgICAgICAgaWYgYXV0aF9hcHBfYnRuOgogICAgICAgICAgICBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGF1dGhfYXBwX2J0bikKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgIAogICAgIyBCOS4gQuG6pW0gIlRp4bq/cCIKICAgIHByaW50KCJbMkZBXSBCxrDhu5tjIDk6IELhuqVtIFRp4bq/cC4uLiIpCiAgICBmb3IgXyBpbiByYW5nZSg1KToKICAgICAgICBzY3JlZW5feG1sID0gaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgbmV4dF9idG4gPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJUaeG6v3AiKQogICAgICAgIGlmIG5leHRfYnRuOgogICAgICAgICAgICBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG5leHRfYnRuKQogICAgICAgICAgICB0aW1lLnNsZWVwKDQpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgCiAgICAjIEIxMC4gVMOsbSBuw7p0ICJTYW8gY2jDqXAga2jDs2EiIHbDoCBs4bqleSBraMOzYSB04burIFZpZXdHcm91cCBjaGEKICAgIHByaW50KCJbMkZBXSBCxrDhu5tjIDEwOiBUw6xtIG7DunQgU2FvIGNow6lwIGtow7NhIHbDoCBs4bqleSBraMOzYS4uLiIpCiAgICBzZWNyZXRfa2V5ID0gTm9uZQogICAgZm9yIF8gaW4gcmFuZ2UoNSk6CiAgICAgICAgc2NyZWVuX3htbCA9IGhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIGNvcHlfa2V5X2J0biA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iU2FvIGNow6lwIGtow7NhIikKICAgICAgICBpZiBjb3B5X2tleV9idG46CiAgICAgICAgICAgICMgVMOsbSBub2RlIFZpZXcgY8OzIHRleHQgaG/hurdjIGNvbnRlbnQtZGVzYyBjaOG7qWEgY2h14buXaSBraMOzYSDEkeG6p3kgxJHhu6cKICAgICAgICAgICAgdmlld19ub2RlcyA9IGhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXciKQogICAgICAgICAgICBmb3Igbm9kZSBpbiB2aWV3X25vZGVzOgogICAgICAgICAgICAgICAgdGV4dCA9IG5vZGUuZ2V0KCJ0ZXh0IiwgIiIpCiAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBub2RlLmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0ZXh0IHRyxrDhu5tjCiAgICAgICAgICAgICAgICBpZiB0ZXh0IGFuZCBsZW4odGV4dCkgPiAyMCBhbmQgIiAiIGluIHRleHQgYW5kIHRleHQuY291bnQoIiAiKSA+PSA3OgogICAgICAgICAgICAgICAgICAgICMgQ2h14buXaSBraMOzYSB0aMaw4budbmcgY8OzIDggbmjDs20gNCBrw70gdOG7sSwgY8OhY2ggbmhhdSBi4bufaSBraG/huqNuZyB0cuG6r25nCiAgICAgICAgICAgICAgICAgICAgcGFydHMgPSB0ZXh0LnNwbGl0KCkKICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFydHMpID09IDggYW5kIGFsbChsZW4ocGFydCkgPT0gNCBmb3IgcGFydCBpbiBwYXJ0cyk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3JldF9rZXkgPSB0ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiWzJGQV0gxJDDoyB0w6xtIHRo4bqleSBraMOzYSB04burIHRleHQ6IHtzZWNyZXRfa2V5fSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjb250ZW50LWRlc2MgbuG6v3UgdGV4dCBraMO0bmcgY8OzCiAgICAgICAgICAgICAgICBlbGlmIGNvbnRlbnRfZGVzYyBhbmQgbGVuKGNvbnRlbnRfZGVzYykgPiAyMCBhbmQgIiAiIGluIGNvbnRlbnRfZGVzYyBhbmQgY29udGVudF9kZXNjLmNvdW50KCIgIikgPj0gNzoKICAgICAgICAgICAgICAgICAgICBwYXJ0cyA9IGNvbnRlbnRfZGVzYy5zcGxpdCgpCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA9PSA4IGFuZCBhbGwobGVuKHBhcnQpID09IDQgZm9yIHBhcnQgaW4gcGFydHMpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWNyZXRfa2V5ID0gY29udGVudF9kZXNjCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiWzJGQV0gxJDDoyB0w6xtIHRo4bqleSBraMOzYSB04burIGNvbnRlbnQtZGVzYzoge3NlY3JldF9rZXl9IikKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNlY3JldF9rZXk6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgIAogICAgaWYgbm90IHNlY3JldF9rZXk6CiAgICAgICAgcHJpbnQoIlshXSBLaMO0bmcgdMOsbSB0aOG6pXkga2jDs2EsIG5o4bqtcCB0aOG7pyBjw7RuZzoiKQogICAgICAgIHNlY3JldF9rZXkgPSBpbnB1dCgiTmjhuq1wIGtow7NhIHNlY3JldDogIikucmVwbGFjZSgnICcsICcnKQogICAgCiAgICAjIEIxMS4gQuG6pW0gIlRp4bq/cCIgKGLhu48gcXVhIHZp4buHYyBs4bqleSBjbGlwYm9hcmQpCiAgICBwcmludCgiWzJGQV0gQsaw4bubYyAxMTogQuG6pW0gVGnhur9wLi4uIikKICAgIGZvciBfIGluIHJhbmdlKDUpOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBuZXh0X2J0biA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IlRp4bq/cCIpCiAgICAgICAgaWYgbmV4dF9idG46CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIobmV4dF9idG4pCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICBoZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAKICAgICMgQjEyLiBTaW5oIE9UUCB04burIGNodeG7l2kga2V5CiAgICBwcmludCgiWzJGQV0gQsaw4bubYyAxMjogU2luaCBPVFAuLi4iKQogICAgdHJ5OgogICAgICAgICMgTG/huqFpIGLhu48ga2hv4bqjbmcgdHLhuq9uZyB2w6AgY2h1eeG7g24gduG7gSBjaOG7ryBob2EKICAgICAgICBzZWNyZXRfa2V5X2NsZWFuID0gc2VjcmV0X2tleS5yZXBsYWNlKCcgJywgJycpLnVwcGVyKCkKICAgICAgICBwcmludChmIlsyRkFdIEtow7NhIMSRw6MgbMOgbSBz4bqhY2g6IHtzZWNyZXRfa2V5X2NsZWFufSIpCiAgICAgICAgdG90cCA9IHB5b3RwLlRPVFAoc2VjcmV0X2tleV9jbGVhbikKICAgICAgICBvdHBfY29kZSA9IHRvdHAubm93KCkKICAgICAgICBwcmludChmIlsyRkFdIE3DoyBPVFAgaGnhu4duIHThuqFpOiB7b3RwX2NvZGV9IikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIlshXSBM4buXaSBraGkgc2luaCBPVFA6IHtlfSIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgICMgQjEzLiBC4bqlbSB2w6BvIMO0IG5o4bqtcCBPVFAKICAgIHByaW50KCJbMkZBXSBCxrDhu5tjIDEzOiBUw6xtIMO0IG5o4bqtcCBPVFAuLi4iKQogICAgZm9yIF8gaW4gcmFuZ2UoNSk6CiAgICAgICAgc2NyZWVuX3htbCA9IGhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIG90cF9pbnB1dCA9IGhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkVkaXRUZXh0IikKICAgICAgICBpZiBvdHBfaW5wdXQ6CiAgICAgICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIob3RwX2lucHV0KQogICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgCiAgICAjIEIxNC4gTmjhuq1wIE9UUAogICAgcHJpbnQoIlsyRkFdIELGsOG7m2MgMTQ6IE5o4bqtcCBPVFAuLi4iKQogICAgaGVscGVyLmlucHV0X3RleHQob3RwX2NvZGUpCiAgICB0aW1lLnNsZWVwKDIpCiAgICAKICAgICMgQuG6pW0gVGnhur9wIHNhdSBraGkgbmjhuq1wIE9UUAogICAgcHJpbnQoIlsyRkFdIELhuqVtIFRp4bq/cCBzYXUga2hpIG5o4bqtcCBPVFAuLi4iKQogICAgZm9yIF8gaW4gcmFuZ2UoNSk6CiAgICAgICAgc2NyZWVuX3htbCA9IGhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIG5leHRfYnRuID0gaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iVGnhur9wIikKICAgICAgICBpZiBuZXh0X2J0bjoKICAgICAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihuZXh0X2J0bikKICAgICAgICAgICAgdGltZS5zbGVlcCg1KSAgIyBDaOG7nSA1IGdpw6J5CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgCiAgICAjIENo4budIHbDoCBraeG7g20gdHJhIG7DunQgIlhvbmciCiAgICBwcmludCgiWzJGQV0gQ2jhu50gdsOgIGtp4buDbSB0cmEgbsO6dCBYb25nLi4uIikKICAgIGZvciBpIGluIHJhbmdlKDMwKTogICMgQ2jhu50gdOG7kWkgxJFhIDMwIGdpw6J5CiAgICAgICAgc2NyZWVuX3htbCA9IGhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIGRvbmVfYnRuID0gaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iWG9uZyIpCiAgICAgICAgaWYgZG9uZV9idG46CiAgICAgICAgICAgIHByaW50KCJbMkZBXSBQaMOhdCBoaeG7h24gbsO6dCBYb25nLCBi4bqlbSB2w6BvLi4uIikKICAgICAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihkb25lX2J0bikKICAgICAgICAgICAgdGltZS5zbGVlcCg1KQogICAgICAgICAgICBwcmludCgiWzJGQV0gxJDDoyBi4bqlbSBYb25nLCB4w6FjIG5o4bqtbiB0aMOgbmggY8O0bmchIikKICAgICAgICAgICAgYnJlYWsKICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICBlbHNlOgogICAgICAgIHByaW50KCJbMkZBXSBLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBYb25nIHNhdSAzMCBnacOieSIpCiAgICAKICAgICMgQjE1LiBC4bqlbSBiYWNrIMSR4bq/biBraGkgbsOgbyByYSB0cmFuZyBjaOG7pyB0aMOsIHRow7RpCiAgICBwcmludCgiWzJGQV0gQsaw4bubYyAxNTogQuG6pW0gYmFjayB24buBIHRyYW5nIGNo4bunLi4uIikKICAgIGJhY2tfY291bnQgPSAwCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHNjcmVlbl94bWwgPSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBwaOG6o2kgdHJhbmcgY2jhu6cga2jDtG5nIChjw7MgdGFiIEhvbWUpCiAgICAgICAgaG9tZV90YWIgPSBoZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIikKICAgICAgICBpZiBob21lX3RhYjoKICAgICAgICAgICAgcHJpbnQoIlsyRkFdIMSQw6MgduG7gSB0cmFuZyBjaOG7pyEiKQogICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICBiYWNrX2NvdW50ICs9IDEKICAgICAgICAgICAgcHJpbnQoZiJbMkZBXSDEkMOjIGLhuqVtIGJhY2sgbOG6p24ge2JhY2tfY291bnR9IikKICAgICAgICAgICAgaWYgYmFja19jb3VudCA+IDIwOiAgIyBUcsOhbmggdsOybmcgbOG6t3AgdsO0IGjhuqFuCiAgICAgICAgICAgICAgICBwcmludCgiWzJGQV0gxJDDoyBi4bqlbSBiYWNrIHF1w6Egbmhp4buBdSBs4bqnbiwgZOG7q25nIGzhuqFpISIpCiAgICAgICAgICAgICAgICBicmVhawogICAgCiAgICAjIEIxNi4gSW4gcmEgY2h14buXaSBrZXkgxJHhu4MgbMawdSBs4bqhaQogICAgcHJpbnQoIlsyRkFdIELGsOG7m2MgMTY6IEluIHJhIGNodeG7l2kga2V5Li4uIikKICAgIHByaW50KGYiWzJGQV0gPT09PT0gQ0hV4buWSSBLRVkgMkZBID09PT09PSIpCiAgICBwcmludChmIlsyRkFdIFNlY3JldCBLZXk6IHtzZWNyZXRfa2V5fSIpCiAgICBwcmludChmIlsyRkFdID09PT09PT09PT09PT09PT09PT09PT09PT09IikKICAgIAogICAgcHJpbnQoIlsyRkFdIMSQw6Mgbmjhuq1wIG3DoyBPVFAgMkZBIHRow6BuaCBjw7RuZyEiKQogICAgcmV0dXJuIHNlY3JldF9rZXkKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBpcExvY2FsPSIxMC4wLjQuNzgiCiAgICBwcmludCgiPT09PSBNRU5VID09PT0iKQogICAgcHJpbnQoIjEuIMSQxINuZyBrw70gdMOgaSBraG/huqNuIEluc3RhZ3JhbSIpCiAgICBwcmludCgiMi4gU+G7rWEgdMOqbiwgdGnhu4N1IHPhu60sIGdp4bubaSB0w61uaCIpCiAgICBwcmludCgiMy4gxJDEg25nIGvDvSAyRkEgKEdvb2dsZSBBdXRoZW50aWNhdG9yKSIpCiAgICBjaG9pY2UgPSBpbnB1dCgiQ2jhu41uIGNo4bupYyBuxINuZyAoMS8yLzMpOiAiKS5zdHJpcCgpCiAgICBpZiBjaG9pY2UgPT0gJzEnOgogICAgICAgIGluZm8gPSByZWdpc3Rlcl9pbnN0YWdyYW1fYWNjb3VudChpcExvY2FsKQogICAgICAgIHByaW50KCJbUkVTVUxUXSIsIGluZm8pCiAgICBlbGlmIGNob2ljZSA9PSAnMic6CiAgICAgICAgI2lwID0gaW5wdXQoIk5o4bqtcCBJUCB0aGnhur90IGLhu4s6ICIpLnN0cmlwKCkgb3IgIjEwLjAuMy4zNyIKICAgICAgICBoZWxwZXIgPSBIZWxwZXJTZXJ2aWNlKGJhc2VfdXJsPWYiaHR0cDovL3tpcExvY2FsfTo5MDk5IikKICAgICAgICB1cGRhdGVfcHJvZmlsZV9pbmZvKGhlbHBlcikKICAgIGVsaWYgY2hvaWNlID09ICczJzoKICAgICAgICAjaXAgPSBpbnB1dCgiTmjhuq1wIElQIHRoaeG6v3QgYuG7izogIikuc3RyaXAoKSBvciAiMTAuMC4zLjM3IgogICAgICAgIGhlbHBlciA9IEhlbHBlclNlcnZpY2UoYmFzZV91cmw9ZiJodHRwOi8ve2lwTG9jYWx9OjkwOTkiKQogICAgICAgIHJlZ2lzdGVyXzJmYShoZWxwZXIpCiAgICBlbHNlOgogICAgICAgIHByaW50KCJM4buxYSBjaOG7jW4ga2jDtG5nIGjhu6NwIGzhu4chIikK').decode('utf-8'))
