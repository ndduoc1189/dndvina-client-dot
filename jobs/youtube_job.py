import base64
exec(base64.b64decode('aW1wb3J0IGRhdGV0aW1lCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IHJlCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIExpc3QsIE9wdGlvbmFsCmZyb20gam9icy5qb2JfYmFzZSBpbXBvcnQgQmFzZUpvYgoKY2xhc3MgWW91dHViZUpvYihCYXNlSm9iKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9zZXJ2aWNlLCBoZWxwZXJfc2VydmljZSwgZ29saWtlX3NlcnZpY2U9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhkYl9zZXJ2aWNlLCBoZWxwZXJfc2VydmljZSwgZ29saWtlX3NlcnZpY2UpCiAgICAgICAgc2VsZi5hcHBfcGFja2FnZSA9ICJjb20uZ29vZ2xlLmFuZHJvaWQueW91dHViZSIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gInlvdXR1YmUiCiAgICAgICAgCiAgICAgICAgIyBPdmVycmlkZSBkZWZhdWx0IGNvbmZpZyBjaG8gWW91VHViZQogICAgICAgIHNlbGYuX2RlZmF1bHRfY29uZmlnLnVwZGF0ZSh7CiAgICAgICAgICAgICJhY3Rpb25fd2VpZ2h0cyI6IHsKICAgICAgICAgICAgICAgICJyYW5kb21fdmlld192aWRlb19jaGFuZWwiOiAxMDAsICAjIDEwMCUgeGVtIHZpZGVvL2NoYW5uZWwgcmFuZG9tCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJtaW5fYWN0aW9uc19wZXJfc2Vzc2lvbiI6IDMsCiAgICAgICAgICAgICJtYXhfYWN0aW9uc19wZXJfc2Vzc2lvbiI6IDUwLCAgIyBZb3VUdWJlIGPDsyB0aOG7gyBjw7Mgbmhp4buBdSBhY3Rpb25zIGjGoW4gKDUwIHRoYXkgdsOsIDMwKQogICAgICAgICAgICAibWF4X3Nlc3Npb25fZHVyYXRpb25fbWludXRlcyI6IDE1LAogICAgICAgICAgICAiYWN0aW9uX2RlbGF5X21pbiI6IDUsCiAgICAgICAgICAgICJhY3Rpb25fZGVsYXlfbWF4IjogMTUsCiAgICAgICAgICAgICJrZXlfc2VhcmNoX2lkIjogImRzakVFTXBaay1RLGp1Z0k2VXJVLWZJLGtwUmlFcHE3YXdnLDMzM2Nsa2R6S0JNLHdPUnNhemhJRzM0LGxnWDVROVNQRThFLGN4ZFU2YklrVi1nLDM1dEc2SUZpQk9jLFg3MEVNN041ZEpZLF8xQmw4UDdURVk0LE5GSmx5RUxxZDF3LFBBOWZXV2JIWHRzLEc1by1oRlhwTzFZLDV3ZW45aERjSTRZIiwKICAgICAgICAgICAgIm5hbWVfY2hhbm5lbCI6ICJExaluZyBCw6lvIE9mZmljaWFsIiwKICAgICAgICAgICAgImFkX3dhdGNoX3RpbWVfbWluIjogMTAsICAgICAgIyBUaOG7nWkgZ2lhbiB4ZW0gcXXhuqNuZyBjw6FvIHThu5FpIHRoaeG7g3UgKGdpw6J5KQogICAgICAgICAgICAiYWRfd2F0Y2hfdGltZV9tYXgiOiAzMCwgICAgICMgVGjhu51pIGdpYW4geGVtIHF14bqjbmcgY8OhbyB04buRaSDEkWEgKGdpw6J5KQogICAgICAgICAgICAidmlkZW9fd2F0Y2hfdGltZV9taW4iOiAxMDAsICAjIFRo4budaSBnaWFuIHhlbSB2aWRlbyB04buRaSB0aGnhu4N1IChnacOieSkKICAgICAgICAgICAgInZpZGVvX3dhdGNoX3RpbWVfbWF4IjogMTgwLCAgIyBUaOG7nWkgZ2lhbiB4ZW0gdmlkZW8gdOG7kWkgxJFhIChnacOieSkKICAgICAgICAgICAgInZpZGVvX3Jld2F0Y2hfY29vbGRvd25fbWludXRlcyI6IDMwMCAgIyBUaOG7nWkgZ2lhbiBnacOjbiBjw6FjaCB0csaw4bubYyBraGkgeGVtIGzhuqFpIHZpZGVvIChwaMO6dCkKICAgICAgICB9KQogICAgCiAgICBkZWYgZHVtcF9zY3JlZW4oc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgRmFsbGJhY2sgbWV0aG9kIMSR4buDIHTGsMahbmcgdGjDrWNoIHbhu5tpIGPDoWMgbWV0aG9kIGPDsyB0aOG7gyBn4buNaSBkdW1wX3NjcmVlbigpCiAgICAgICAgdGhheSB2w6wgZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgIAogICAgZGVmIGdldF9zdXBwb3J0ZWRfYWN0aW9ucyhzZWxmKSAtPiBMaXN0W3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgT3ZlcnJpZGUgZGFuaCBzw6FjaCBhY3Rpb25zIMSRxrDhu6NjIFlvdVR1YmUgaOG7lyB0cuG7owogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3Rbc3RyXTogRGFuaCBzw6FjaCBhY3Rpb25zIFlvdVR1YmUgaOG7lyB0cuG7owogICAgICAgICIiIgogICAgICAgIHJldHVybiBsaXN0KHNlbGYuZ2V0X2FjdGlvbl93ZWlnaHRzKCkua2V5cygpKQogICAgICAgIAogICAgZGVmIGdldF9hY2NvdW50c19mcm9tX2RldmljZShzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBZb3VUdWJlIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgWW91VHViZSBsdcO0biByZXR1cm4gMSBhY2NvdW50IHbhu5tpIHVuaXF1ZV91c2VybmFtZSA9ICJuby5hY2NvdW50IgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gWW91VHViZSB04burIHRoaeG6v3QgYuG7iyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFlvdVR1YmUgY2jhu4kgY8OzIDEgYWNjb3VudCBt4bq3YyDEkeG7i25oCiAgICAgICAgICAgIGFjY291bnRzID0gW3sKICAgICAgICAgICAgICAgICJ1bmlxdWVfdXNlcm5hbWUiOiAibm8uYWNjb3VudCIsCiAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogIm5vLmFjY291bnQiLCAKICAgICAgICAgICAgICAgICJuaWNrbmFtZSI6ICJZb3VUdWJlIEFjY291bnQiLAogICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6ICIiLAogICAgICAgICAgICAgICAgImlzX2xvZ2luIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfV0KICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB7bGVuKGFjY291bnRzKX0gdMOgaSBraG/huqNuIFlvdVR1YmUiKQogICAgICAgICAgICByZXR1cm4gYWNjb3VudHMKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBZb3VUdWJlIikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoc2VsZikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB1c2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcAogICAgICAgIFlvdVR1YmUgbHXDtG4gcmV0dXJuICJuby5hY2NvdW50IgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogIm5vLmFjY291bnQiCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuICJuby5hY2NvdW50IgogICAgCiAgICBkZWYgX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2goc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGNodXnhu4NuIHTDoGkga2hv4bqjbgogICAgICAgIFlvdVR1YmUga2jDtG5nIGPhuqduIGNodXnhu4NuIHTDoGkga2hv4bqjbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhcmdldF9hY2NvdW50OiBUw6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24gxJHhur9uCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyBjaHV54buDbiB0w6BpIGtob+G6o24KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAnc3VjY2Vzcyc6IFRydWUsCiAgICAgICAgICAgICdtZXNzYWdlJzogJ1lvdVR1YmUga2jDtG5nIGPhuqduIGNodXnhu4NuIHTDoGkga2hv4bqjbicKICAgICAgICB9CiAgICAKICAgIGRlZiBvcGVuX2FwcChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIE3hu58g4bupbmcgZOG7pW5nIFlvdVR1YmUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTeG7nyDhu6luZyBk4bulbmcgWW91VHViZSIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBt4bufIFlvdVR1YmU6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgaXNfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcg4bufIG3DoG4gaMOsbmggaG9tZSBZb3VUdWJlIGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJFhbmcg4bufIGhvbWUgc2NyZWVuCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJyZW50X3BhY2thZ2UgPSBzZWxmLmhlbHBlci5nZXRfY3VycmVudF9wYWNrYWdlKCkKICAgICAgICAgICAgaWYgY3VycmVudF9wYWNrYWdlICE9IHNlbGYuYXBwX3BhY2thZ2U6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw7MgY8OhYyBlbGVtZW50IMSR4bq3YyB0csawbmcgY+G7p2EgWW91VHViZSBob21lCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCLEkGFuZyBn4buNaSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkgdHJvbmcgaXNfaG9tZV9zY3JlZW4uLi4iKQogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBjw6FjIGluZGljYXRvciBj4bunYSBZb3VUdWJlIGhvbWUKICAgICAgICAgICAgaG9tZV9pbmRpY2F0b3JzID0gWwogICAgICAgICAgICAgICAgJ2NvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL3lvdXR1YmVfbG9nbycsCiAgICAgICAgICAgICAgICAnVHJhbmcgY2jhu6cnLAogICAgICAgICAgICAgICAgJ1Nob3J0cycKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGluZGljYXRvciBpbiBob21lX2luZGljYXRvcnM6CiAgICAgICAgICAgICAgICBpZiBpbmRpY2F0b3IgaW4gc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraeG7g20gdHJhIGhvbWUgc2NyZWVuOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGdldF9jdXJyZW50X3NjcmVlbihzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgUGjDoXQgaGnhu4duIG3DoG4gaMOsbmggaGnhu4duIHThuqFpIGPhu6dhIFlvdVR1YmUKICAgICAgICDEkOG6o20gYuG6o28gWW91VHViZSDEkWFuZyBt4bufIHRyxrDhu5tjIGtoaSBwaMOhdCBoaeG7h24gc2NyZWVuCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBMb+G6oWkgbcOgbiBow6xuaCBoaeG7h24gdOG6oWkgKCdob21lJywgJ2hvbWVfc2VhcmNoJywgJ3ZpZXdfdmlkZW8nLCAndW5rbm93bicpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBZb3VUdWJlIMSRYW5nIG3hu58KICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIllvdVR1YmUgY2jGsGEgbeG7nyAocGFja2FnZSBoaeG7h24gdOG6oWk6IHtjdXJyZW50X3BhY2thZ2V9KSwgxJFhbmcgbeG7nyBZb3VUdWJlLi4uIikKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLm9wZW5fYXBwKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBt4bufIFlvdVR1YmUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAidW5rbm93biIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkOG7o2kgYXBwIGxvYWQKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgcGFja2FnZQogICAgICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3BhY2thZ2UgIT0gc2VsZi5hcHBfcGFja2FnZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlbhuqtuIGtow7RuZyBwaOG6o2kgWW91VHViZSBhcHA6IHtjdXJyZW50X3BhY2thZ2V9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInVua25vd24iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IFhNTCBj4bunYSBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygixJBhbmcgZ+G7jWkgaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpLi4uIikKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHNjcmVlbiBYTUwiKQogICAgICAgICAgICAgICAgcmV0dXJuICJ1bmtub3duIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHZpZXdfdmlkZW8gc2NyZWVuIHRyxrDhu5tjICjGsHUgdGnDqm4gY2FvIG5o4bqldCkKICAgICAgICAgICAgaWYgImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL3dhdGNoX3BsYXllciIgaW4gc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHJldHVybiAidmlld192aWRlbyIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBob21lX3NlYXJjaCBzY3JlZW4KICAgICAgICAgICAgc2VhcmNoX2luZGljYXRvcnMgPSBbCiAgICAgICAgICAgICAgICAiVGjhu60gdMOsbSBraeG6v20gxJHhu4MgYuG6r3QgxJHhuqd1IiwKICAgICAgICAgICAgICAgICJUw6xtIHRyw6puIFlvdVR1YmUiCiAgICAgICAgICAgIF0KICAgICAgICAgICAgZm9yIGluZGljYXRvciBpbiBzZWFyY2hfaW5kaWNhdG9yczoKICAgICAgICAgICAgICAgIGlmIGluZGljYXRvciBpbiBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiaG9tZV9zZWFyY2giCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgaG9tZSBzY3JlZW4gKGvhur8gdGjhu6thIGxvZ2ljIHThu6sgaXNfaG9tZV9zY3JlZW4pCiAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiAiaG9tZSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2jDtG5nIHjDoWMgxJHhu4tuaCDEkcaw4bujYwogICAgICAgICAgICByZXR1cm4gInVua25vd24iCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBwaMOhdCBoaeG7h24gY3VycmVudCBzY3JlZW46IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAidW5rbm93biIKICAgIAogICAgZGVmIGVuc3VyZV9ob21lX3NjcmVlbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gbcOgbiBow6xuaCBob21lIFlvdVR1YmUKICAgICAgICBL4bq/dCBo4bujcCBnaeG7r2EgbsO6dCBiYWNrIHbDoCBi4bqlbSB2w6BvIFRyYW5nIGNo4bunL0hvbWUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZyB24buBIGhvbWUgc2NyZWVuCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIE7hur91IMSRw6Mg4bufIGhvbWUgdGjDrCBPSwogICAgICAgICAgICBzZWxmLl9oYW5kbGVfY2xvc2VfcG9wdXBzKCkKICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkGFuZyBj4buRIGfhuq9uZyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cgWW91VHViZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIDE6IFTDrG0gdsOgIGLhuqVtIG7DunQgIlRyYW5nIGNo4bunIiBob+G6t2MgIkhvbWUiIHRyxrDhu5tjCiAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IlRyYW5nIGNo4bunIikKICAgICAgICAgICAgaWYgbm90IGhvbWVfdGFiOgogICAgICAgICAgICAgICAgaG9tZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iSG9tZSIpCiAgICAgICAgICAgIGlmIG5vdCBob21lX3RhYjoKICAgICAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciKQogICAgICAgICAgICBpZiBub3QgaG9tZV90YWI6CiAgICAgICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IkhvbWUiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGhvbWVfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgbsO6dCBUcmFuZyBjaOG7py9Ib21lLCDEkWFuZyBi4bqlbS4uLiIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaG9tZV90YWIpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7rSAyOiBC4bqlbSBiYWNrIDEtMiBs4bqnbiBy4buTaSB0w6xtIEhvbWUgYnV0dG9uCiAgICAgICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKDIpOgogICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX2Nsb3NlX3BvcHVwcygpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVGjhu60gYuG6pW0gYmFjayBs4bqnbiB7YXR0ZW1wdCArIDF9IikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSDEkcOjIHbhu4EgaG9tZSBjaMawYQogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBIb21lIGJ1dHRvbiBzYXUga2hpIGJhY2sKICAgICAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IlRyYW5nIGNo4bunIikKICAgICAgICAgICAgICAgIGlmIG5vdCBob21lX3RhYjoKICAgICAgICAgICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJIb21lIikKICAgICAgICAgICAgICAgIGlmIG5vdCBob21lX3RhYjoKICAgICAgICAgICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIikKICAgICAgICAgICAgICAgIGlmIG5vdCBob21lX3RhYjoKICAgICAgICAgICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IkhvbWUiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgaG9tZV90YWI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgbsO6dCBUcmFuZyBjaOG7py9Ib21lIHNhdSBiYWNrLCDEkWFuZyBi4bqlbS4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfdGFiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu60gMzogQmFjayBuaGnhu4F1IGzhuqduIGjGoW4gbuG6v3UgduG6q24gY2jGsGEgduG7gSDEkcaw4bujYwogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUaOG7rSBiYWNrIG5oaeG7gXUgbOG6p24gxJHhu4MgduG7gSBob21lIikKICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UoMyk6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIDQ6IEN14buRaSBjw7luZyBt4bufIGzhuqFpIGFwcAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJN4bufIGzhuqFpIOG7qW5nIGThu6VuZyBZb3VUdWJlIikKICAgICAgICAgICAgc2VsZi5vcGVuX2FwcCgpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICByZXR1cm4gc2VsZi5pc19ob21lX3NjcmVlbigpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBlbnN1cmUgaG9tZSBzY3JlZW46IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdmFsaWRhdGVfYXBwX25vdF9iYW5uZWQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIGFwcCBjw7MgYuG7iyBiYW5uZWQga2jDtG5nCiAgICAgICAgWW91VHViZSDDrXQga2hpIGLhu4sgYmFuIG7Dqm4gbHXDtG4gcmV0dXJuIFRydWUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGtow7RuZyBi4buLIGJhbm5lZAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgQXBwIGNoxrBhIG3hu58KICAgICAgICAgICAgCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OhYyBk4bqldSBoaeG7h3UgYuG7iyBiYW4gKG7hur91IGPDsykKICAgICAgICAgICAgYmFuX2luZGljYXRvcnMgPSBbCiAgICAgICAgICAgICAgICAiQWNjb3VudCBzdXNwZW5kZWQiLAogICAgICAgICAgICAgICAgIlRoaXMgYWNjb3VudCBoYXMgYmVlbiB0ZXJtaW5hdGVkIiwKICAgICAgICAgICAgICAgICJDb21tdW5pdHkgR3VpZGVsaW5lcyB2aW9sYXRpb24iCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBpbmRpY2F0b3IgaW4gYmFuX2luZGljYXRvcnM6CiAgICAgICAgICAgICAgICBpZiBpbmRpY2F0b3IubG93ZXIoKSBpbiBzY3JlZW5feG1sLmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIlBow6F0IGhp4buHbiBhcHAgYuG7iyBiYW46IHtpbmRpY2F0b3J9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraeG7g20gdHJhIGFwcCBiYW5uZWQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlICAjIERlZmF1bHQga2jDtG5nIGLhu4sgYmFuCiAgICAKICAgIGRlZiBwZXJmb3JtX3JhbmRvbV92aWV3X3ZpZGVvX2NoYW5lbF9hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBow6BuaCDEkeG7mW5nIHhlbSB2aWRlby9jaGFubmVsIG5n4bqrdSBuaGnDqm4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlRo4buxYyBoaeG7h24gcmFuZG9tIHZpZXcgdmlkZW8vY2hhbm5lbCBjaG8ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0iKQogICAgICAgICAgICBzZWxmLl9oYW5kbGVfY2xvc2VfcG9wdXBzKCkKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgICAgIGN1cnJlbnRfc2NyZWVuID0gc2VsZi5nZXRfY3VycmVudF9zY3JlZW4oKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQ3VycmVudCBzY3JlZW46IHtjdXJyZW50X3NjcmVlbn0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBY4butIGzDvSB0aGVvIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfc2NyZWVuID09ICJ2aWV3X3ZpZGVvIjoKICAgICAgICAgICAgICAgICMgxJDDoyDEkWFuZyB4ZW0gdmlkZW8sIGPDsyB0aOG7gyB0aeG6v3AgdOG7pWMgeGVtIGhv4bq3YyB0aG/DoXQKICAgICAgICAgICAgICAgICMgxJBhbmcgeGVtIHZpZGVvLCBjw7MgdGjhu4MgdMOsbSB2w6AgYuG6pW0gdsOgbyBwbGF5bGlzdCBlbnRyeSBwb2ludAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJBhbmcgeGVtIHZpZGVvLCB0w6xtIHBsYXlsaXN0IGVudHJ5IHBvaW50IikKICAgICAgICAgICAgICAgIHBsYXlsaXN0X2VudHJ5ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uZ29vZ2xlLmFuZHJvaWQueW91dHViZTppZC9wbGF5bGlzdF9lbnRyeV9wb2ludF9jb250YWluZXIiKQogICAgICAgICAgICAgICAgaWYgcGxheWxpc3RfZW50cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgcGxheWxpc3QgZW50cnkgcG9pbnQsIMSRYW5nIGLhuqVtLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocGxheWxpc3RfZW50cnkpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBwbGF5bGlzdCBlbnRyeSBwb2ludCwgVGjhu60gdnXhu5F0IMSR4buBIHh14bqldCIpCgogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX2dldF9maXJzdF92aWRlb190b192aWV3KCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHZpZGVvIG7DoG8gxJHhu4MgeGVtIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpCgogICAgICAgICAgICBlbGlmIGN1cnJlbnRfc2NyZWVuID09ICJob21lX3NlYXJjaCI6CiAgICAgICAgICAgICAgICAjIMSQYW5nIOG7nyBtw6BuIGjDrG5oIHNlYXJjaCwgY8OzIHRo4buDIHTDrG0ga2nhur9tIGhv4bq3YyB24buBIGhvbWUKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQYW5nIOG7nyBtw6BuIGjDrG5oIHNlYXJjaCIpCiAgICAgICAgICAgICAgICBzZWxmLl9wZXJmb3JtX3NlYXJjaF9mcm9tX3NlYXJjaF9zY3JlZW4oKQogICAgICAgICAgICBlbGlmIGN1cnJlbnRfc2NyZWVuID09ICJob21lIjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQYW5nIOG7nyBtw6BuIGjDrG5oIGhvbWUiKQogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX2dldF9maXJzdF92aWRlb190b192aWV3KCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHZpZGVvIG7DoG8gxJHhu4MgeGVtIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICBzZWxmLl9wZXJmb3JtX3NlYXJjaF9mcm9tX3NlYXJjaF9zY3JlZW4oKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIHRo4buxYyBoaeG7h24gcmFuZG9tIHZpZXc6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX3BlcmZvcm1fc2VhcmNoX2Zyb21fc2VhcmNoX3NjcmVlbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gdMOsbSBraeG6v20ga2hpIMSRYW5nIOG7nyBtw6BuIGjDrG5oIHNlYXJjaAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUaOG7sWMgaGnhu4duIHNlYXJjaCB04burIG3DoG4gaMOsbmggc2VhcmNoIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgc2VhcmNoIHRlcm1zIHThu6sgY29uZmlnCiAgICAgICAgICAgIGNvbmZpZyA9IHNlbGYuZ2V0X2FwcF9jb25maWcoKQogICAgICAgICAgICBrZXlfc2VhcmNoX2lkID0gY29uZmlnLmdldCgia2V5X3NlYXJjaF9pZCIsICIiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYga2V5X3NlYXJjaF9pZDoKICAgICAgICAgICAgICAgICMgU3BsaXQgYuG6sW5nIGThuqV1IHBo4bqpeSB2w6AgbOG6pXkgcmFuZG9tCiAgICAgICAgICAgICAgICBzZWFyY2hfaWRzID0gW3Muc3RyaXAoKSBmb3IgcyBpbiBrZXlfc2VhcmNoX2lkLnNwbGl0KCIsIikgaWYgcy5zdHJpcCgpXQogICAgICAgICAgICAgICAgaWYgc2VhcmNoX2lkczoKICAgICAgICAgICAgICAgICAgICB0ZXJtID0gcmFuZG9tLmNob2ljZShzZWFyY2hfaWRzKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIG7hur91IGNvbmZpZyBy4buXbmcKICAgICAgICAgICAgICAgICAgICB0ZXJtID0gcmFuZG9tLmNob2ljZShbIm11c2ljIiwgInR1dG9yaWFsIiwgImdhbWluZyJdKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBGYWxsYmFjayBu4bq/dSBraMO0bmcgY8OzIGNvbmZpZwogICAgICAgICAgICAgICAgdGVybSA9IHJhbmRvbS5jaG9pY2UoWyJtdXNpYyIsICJ0dXRvcmlhbCIsICJnYW1pbmciXSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJTZWFyY2ggdGVybToge3Rlcm19IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBzZWFyY2ggYm94IHbhu5tpIG5oaeG7gXUgdmFyaWFudHMKICAgICAgICAgICAgc2VhcmNoX2JveCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0ic2VhcmNoX2VkaXRfdGV4dCIpCiAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfYm94OgogICAgICAgICAgICAgICAgc2VhcmNoX2JveCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlTDrG0ga2nhur9tIikKICAgICAgICAgICAgaWYgbm90IHNlYXJjaF9ib3g6CiAgICAgICAgICAgICAgICBzZWFyY2hfYm94ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IlTDrG0gdHLDqm4gWW91VHViZSIpCiAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfYm94OgogICAgICAgICAgICAgICAgc2VhcmNoX2JveCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmdvb2dsZS5hbmRyb2lkLnlvdXR1YmU6aWQvc2VhcmNoX2NsZWFyIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNlYXJjaF9ib3g6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX2JveCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5o4bqtcCBzZWFyY2ggdGVybQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuaW5wdXRfdGV4dCh0ZXJtKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmjhuqVuIHNlYXJjaAogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfZW50ZXIoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgeGVtIHZpZGVvIMSR4bqndSB0acOqbiBj4bunYSBrw6puaCDEkcOjIGNvbmZpZwogICAgICAgICAgICAgICAgdmlkZW9fZm91bmQgPSBzZWxmLl9nZXRfZmlyc3RfdmlkZW9fdG9fdmlldygpCiAgICAgICAgICAgICAgICBpZiB2aWRlb19mb3VuZDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSB2aWRlbyBj4bunYSBrw6puaCwgc2Nyb2xsIGvhur90IHF14bqjIHNlYXJjaAogICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UoMik6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFF1YXkgbOG6oWkgaG9tZQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBzZWFyY2ggYm94IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIHNlYXJjaCB04burIHNlYXJjaCBzY3JlZW46IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2dldF9maXJzdF92aWRlb190b192aWV3KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB2w6AgeGVtIHZpZGVvIMSR4bqndSB0acOqbiBj4bunYSBrw6puaCDEkcOjIGNvbmZpZyB0cm9uZyBr4bq/dCBxdeG6oyBzZWFyY2gKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHTDrG0gdGjhuqV5IHbDoCB4ZW0gdmlkZW8gdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IHTDqm4ga8OqbmggdOG7qyBjb25maWcKICAgICAgICAgICAgY29uZmlnID0gc2VsZi5nZXRfYXBwX2NvbmZpZygpCiAgICAgICAgICAgIHRhcmdldF9jaGFubmVsID0gY29uZmlnLmdldCgibmFtZV9jaGFubmVsIiwgIkTFqW5nIELDqW8gT2ZmaWNpYWwiKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdmlkZW8gY+G7p2Ega8Oqbmg6IHt0YXJnZXRfY2hhbm5lbH0iKQogICAgICAgICAgICBtYXhfc2Nyb2xscyA9IDE1ICAjIEdp4bubaSBo4bqhbiBz4buRIGzhuqduIHNjcm9sbAogICAgICAgICAgICBmb3Igc2Nyb2xsX2NvdW50IGluIHJhbmdlKG1heF9zY3JvbGxzKToKICAgICAgICAgICAgICAgICMgTOG6pXkgWE1MIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyBlcXVhbGl6ZXIgdGjDrCB2deG7kXQgbMOqbgogICAgICAgICAgICAgICAgZXF1YWxpemVyX2VsZW1lbnQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL2VxdWFsaXplciIpCiAgICAgICAgICAgICAgICBpZiBlcXVhbGl6ZXJfZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIHRo4bqleSBlcXVhbGl6ZXIsIMSRYW5nIHZ14buRdCBsw6puLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICB2aWRlb19idXR0b25zID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50cyhyZXNvdXJjZV9pZD0iY29tLmdvb2dsZS5hbmRyb2lkLnlvdXR1YmU6aWQvY2hhbm5lbCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCB2aWRlb19idXR0b25zOgogICAgICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIHZpZGVvIGJ1dHRvbnMgY8OzIHRow7RuZyB0aW4ga8OqbmggIAogICAgICAgICAgICAgICAgICAgIHZpZGVvX2J1dHRvbnMgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRzKAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGZvciBidXR0b24gaW4gdmlkZW9fYnV0dG9uczoKICAgICAgICAgICAgICAgICAgICBidXR0b25fZGVzYyA9IGJ1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBidXR0b25fZGVzYyBvciBidXR0b25fZGVzYyA9PSAibnVsbCI6ICAjIEZhbGxiYWNrIG7hur91IGNvbnRlbnQtZGVzYyBy4buXbmcKICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uX2Rlc2MgPSBidXR0b24uZ2V0KCJ0ZXh0IiwgIiIpCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGNvbnRlbnQtZGVzYyBjaOG7qWEgdMOqbiBrw6puaCB0YXJnZXQKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0X2NoYW5uZWwgaW4gYnV0dG9uX2Rlc2MgYW5kICJwaMOhdCB2aWRlbyIgaW4gYnV0dG9uX2Rlc2MpIG9yIHRhcmdldF9jaGFubmVsID09IGJ1dHRvbl9kZXNjOgogICAgICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IHZpZGVvIHRpdGxlIMSR4buDIGtp4buDbSB0cmEgbOG7i2NoIHPhu60KICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRpdGxlIHThu6sgcmVzb3VyY2UtaWQgdHLGsOG7m2MKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGVfZWxlbWVudCA9IHNlbGYuaGVscGVyLmdldF9uZXh0X2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGJ1dHRvbiwgcmVzb3VyY2VfaWQ9ImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL3RpdGxlIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGl0bGVfZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlX3RleHQgPSB0aXRsZV9lbGVtZW50LmdldCgidGV4dCIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGl0bGVfdGV4dCBhbmQgdGl0bGVfdGV4dC5zdHJpcCgpIGFuZCB0aXRsZV90ZXh0ICE9ICJudWxsIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb190aXRsZSA9IHRpdGxlX3RleHQuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB2aWRlbyB0aXRsZSB04burIHJlc291cmNlLWlkOiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9fdGl0bGUgPSBzZWxmLl9leHRyYWN0X3ZpZGVvX3RpdGxlX2Zyb21fZWxlbWVudChidXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb190aXRsZSA9IHNlbGYuX2V4dHJhY3RfdmlkZW9fdGl0bGVfZnJvbV9lbGVtZW50KGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdmlkZW8gxJHDoyB4ZW0gZ+G6p24gxJHDonkgY2jGsGEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdmlkZW9fdGl0bGUgYW5kIG5vdCBzZWxmLl9jYW5fd2F0Y2hfdmlkZW8odmlkZW9fdGl0bGUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhu48gcXVhIHZpZGVvIMSRw6MgeGVtIGfhuqduIMSRw6J5OiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgdmlkZW8gY+G7p2Ege3RhcmdldF9jaGFubmVsfToge2J1dHRvbl9kZXNjfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIENsaWNrIHbDoG8gdmlkZW8KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgxJHDoyB2w6BvIHZpZGVvIGNoxrBhCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfc2NyZWVuID0gc2VsZi5nZXRfY3VycmVudF9zY3JlZW4oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3NjcmVlbiA9PSAidmlld192aWRlbyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIGjDoG0gd2F0Y2hfdmlkZW8oKSDEkeG7gyB4ZW0gduG7m2kgeOG7rSBsw70gcXXhuqNuZyBjw6FvIHbDoCBraOG6o28gc8OhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHbDoCDEkcOzbmcgcG9wdXAvZGlhbG9nIG7hur91IGPDswogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX2Nsb3NlX3BvcHVwcygpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYud2F0Y2hfdmlkZW8oKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB2w6BvIMSRxrDhu6NjIHZpZGVvLCB0aOG7rSB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgdmlkZW8gY+G7p2Ega8OqbmggdGFyZ2V0LCBzY3JvbGwgeHXhu5FuZyDEkeG7gyB0w6xtIHRow6ptCiAgICAgICAgICAgICAgICBpZiBzY3JvbGxfY291bnQgPCBtYXhfc2Nyb2xscyAtIDE6ICAjIEtow7RuZyBzY3JvbGwg4bufIGzhuqduIGN14buRaQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJTY3JvbGwge3Njcm9sbF9jb3VudCArIDF9L3ttYXhfc2Nyb2xsc30gxJHhu4MgdMOsbSB2aWRlbyBj4bunYSB7dGFyZ2V0X2NoYW5uZWx9IikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDAuNSwgMS4wKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgdmlkZW8gY+G7p2Ega8Oqbmgge3RhcmdldF9jaGFubmVsfSBzYXUge21heF9zY3JvbGxzfSBs4bqnbiBzY3JvbGwiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIHTDrG0gdmlkZW8gxJHhuqd1IHRpw6puOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHdhdGNoX3ZpZGVvKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgWGVtIHZpZGVvIHbhu5tpIHjhu60gbMO9IHF14bqjbmcgY8OhbyB2w6Aga2jhuqNvIHPDoXQKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHhlbSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuq90IMSR4bqndSB4ZW0gdmlkZW8iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIHZpZGVvIHRyxrDhu5tjIGtoaSB4ZW0KICAgICAgICAgICAgdmlkZW9fdGl0bGUgPSAiIgogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgY29uZmlnIHRo4budaSBnaWFuIHhlbQogICAgICAgICAgICBjb25maWcgPSBzZWxmLmdldF9hcHBfY29uZmlnKCkKICAgICAgICAgICAgYWRfd2F0Y2hfbWluID0gY29uZmlnLmdldCgiYWRfd2F0Y2hfdGltZV9taW4iLCA1KQogICAgICAgICAgICBhZF93YXRjaF9tYXggPSBjb25maWcuZ2V0KCJhZF93YXRjaF90aW1lX21heCIsIDMwKQogICAgICAgICAgICB2aWRlb193YXRjaF9taW4gPSBjb25maWcuZ2V0KCJ2aWRlb193YXRjaF90aW1lX21pbiIsIDE1KQogICAgICAgICAgICB2aWRlb193YXRjaF9tYXggPSBjb25maWcuZ2V0KCJ2aWRlb193YXRjaF90aW1lX21heCIsIDEwMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhu6NpIHZpZGVvIGxvYWQKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgIHNlbGYuX2hhbmRsZV9jbG9zZV9wb3B1cHMoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAxLiBLaeG7g20gdHJhIHbDoCB44butIGzDvSAiQuG7jyBxdWEga2jhuqNvIHPDoXQiCiAgICAgICAgICAgIHNlbGYuX2hhbmRsZV9za2lwX3N1cnZleSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIDIuIEtp4buDbSB0cmEgdsOgIHjhu60gbMO9IHF14bqjbmcgY8OhbyAtIGzhurdwIGzhuqFpIMSR4bq/biBraGkgaOG6v3QgcXXhuqNuZyBjw6FvLCDDrXQgbmjhuqV0IDIgbOG6p24KICAgICAgICAgICAgYWRfaGFuZGxlZF9jb3VudCA9IDAKICAgICAgICAgICAgbWF4X3NhZmV0eV9saW1pdCA9IDEwICAjIEdp4bubaSBo4bqhbiBhbiB0b8OgbiDEkeG7gyB0csOhbmggdsO0IGjhuqFuCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgYWRfZm91bmQgPSBzZWxmLl9oYW5kbGVfYWR2ZXJ0aXNlbWVudChhZF93YXRjaF9taW4sIGFkX3dhdGNoX21heCkKICAgICAgICAgICAgICAgIGFkX2hhbmRsZWRfY291bnQgKz0gMQogICAgICAgICAgICAgICAgaWYgYWRfZm91bmQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgeOG7rSBsw70gcXXhuqNuZyBjw6FvIGzhuqduIHthZF9oYW5kbGVkX2NvdW50fSIpCiAgICAgICAgICAgICAgICAgICAgIyDEkOG7o2kgbeG7mXQgY2jDunQgdHLGsOG7m2Mga2hpIGtp4buDbSB0cmEgcXXhuqNuZyBjw6FvIHRp4bq/cCB0aGVvCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIHTDrG0gdGjhuqV5IHF14bqjbmcgY8OhbwogICAgICAgICAgICAgICAgICAgIGlmIGFkX2hhbmRsZWRfY291bnQgPj0gMjoKICAgICAgICAgICAgICAgICAgICAgICAgIyDEkMOjIHjhu60gbMO9IMOtdCBuaOG6pXQgMiBs4bqnbiB2w6Aga2jDtG5nIGPDsm4gcXXhuqNuZyBjw6FvIOKGkiBk4burbmcKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkhvw6BuIHRow6BuaCB44butIGzDvSB7YWRfaGFuZGxlZF9jb3VudH0gcXXhuqNuZyBjw6FvIikKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBlbGlmIGFkX2hhbmRsZWRfY291bnQgPT0gMToKICAgICAgICAgICAgICAgICAgICAgICAgIyBDaOG7iSB44butIGzDvSAxIGzhuqduLCB0aOG7rSB0aMOqbSAxIGzhuqduIG7hu69hCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgeOG7rSBsw70gMSBxdeG6o25nIGPDoW8sIGtp4buDbSB0cmEgdGjDqm0gbOG6p24gbuG7r2EuLi4iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyB0w6xtIHRo4bqleSBxdeG6o25nIGPDoW8gbsOgbyDihpIgZOG7q25nCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgR2nhu5tpIGjhuqFuIGFuIHRvw6BuCiAgICAgICAgICAgICAgICBpZiBhZF9oYW5kbGVkX2NvdW50ID49IG1heF9zYWZldHlfbGltaXQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIsSQ4bqhdCBnaeG7m2kgaOG6oW4gYW4gdG/DoG4ge21heF9zYWZldHlfbGltaXR9IHF14bqjbmcgY8OhbywgZOG7q25nIHjhu60gbMO9IikKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgYWRfaGFuZGxlZF9jb3VudCA+IDA6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG7lW5nIHPhu5EgcXXhuqNuZyBjw6FvIMSRw6MgeOG7rSBsw706IHthZF9oYW5kbGVkX2NvdW50fSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLl9oYW5kbGVfY2xvc2VfcG9wdXBzKCkKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgdmlkZW8gdGl0bGUgdOG7qyBYTUwgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICB4bWxfc3RyaW5nID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIGlmIHhtbF9zdHJpbmc6CiAgICAgICAgICAgICAgICAgICAgIyBQaMawxqFuZyBwaMOhcCAxOiBUw6xtIFZpZXdHcm91cCBjw7MgdGV4dCB2w6AgY29udGVudC1kZXNjIGdp4buRbmcgbmhhdSAoxJHDonkgbMOgIHRpdGxlIGNow61uaCkKICAgICAgICAgICAgICAgICAgICAjIMavdSB0acOqbiB0w6xtIGVsZW1lbnQgY8OzIHRleHQgZMOgaSBoxqFuIHbDoCBraMO0bmcgcGjhuqNpIHF14bqjbmcgY8OhbwogICAgICAgICAgICAgICAgICAgIGFsbF9lbGVtZW50cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCh4bWxfc3RyaW5nLCBjbGFzc19uYW1lPSJhbmRyb2lkLnZpZXcuVmlld0dyb3VwIikKICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVzID0gW10KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBmb3IgZWxlbWVudCBpbiBhbGxfZWxlbWVudHM6CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBlbGVtZW50LmdldCgidGV4dCIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBlbGVtZW50LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICMgVGl0bGUgdGjGsOG7nW5nIGPDsyB0ZXh0IHbDoCBjb250ZW50LWRlc2MgZ2nhu5FuZyBuaGF1IHbDoCBkw6BpID4gMTUga8O9IHThu7EKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQgYW5kIGNvbnRlbnRfZGVzYyBhbmQgdGV4dCA9PSBjb250ZW50X2Rlc2MgYW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuKHRleHQpID4gMTUgYW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImzGsOG7o3QgeGVtIiBub3QgaW4gdGV4dCBhbmQgInBow7p0IiBub3QgaW4gdGV4dCBhbmQgImdpw6J5IiBub3QgaW4gdGV4dCBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuxINtIHRyxrDhu5tjIiBub3QgaW4gdGV4dCBhbmQgInRow6FuZyB0csaw4bubYyIgbm90IGluIHRleHQgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAixJHGsOG7o2MgdMOgaSB0cuG7oyIgbm90IGluIHRleHQubG93ZXIoKSBhbmQgInNwb25zb3IiIG5vdCBpbiB0ZXh0Lmxvd2VyKCkpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlcy5hcHBlbmQoKHRleHQuc3RyaXAoKSwgbGVuKHRleHQpKSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENo4buNbiBjYW5kaWRhdGUgY8OzIHRleHQgZMOgaSBuaOG6pXQgKHRoxrDhu51uZyBsw6AgdGnDqnUgxJHhu4EgdmlkZW8gY2jDrW5oKQogICAgICAgICAgICAgICAgICAgIGlmIGNhbmRpZGF0ZXM6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZXMuc29ydChrZXk9bGFtYmRhIHg6IHhbMV0sIHJldmVyc2U9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9fdGl0bGUgPSBjYW5kaWRhdGVzWzBdWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB2aWRlbyB0aXRsZSB04burIFZpZXdHcm91cDoge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBQaMawxqFuZyBwaMOhcCAyOiBUw6xtIHThu6sgYnV0dG9uIGNo4bupYSB0b8OgbiBi4buZIHRow7RuZyB0aW4gdmlkZW8KICAgICAgICAgICAgICAgICAgICBpZiBub3QgdmlkZW9fdGl0bGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbl9lbGVtZW50cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCh4bWxfc3RyaW5nLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgYnV0dG9uIGluIGJ1dHRvbl9lbGVtZW50czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYyA9IGJ1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGJ1dHRvbiBjw7MgY29udGVudC1kZXNjIGNo4bupYSB0aXRsZSB2aWRlbyBkw6BpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudF9kZXNjIGFuZCBsZW4oY29udGVudF9kZXNjKSA+IDMwIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFueShrZXl3b3JkIGluIGNvbnRlbnRfZGVzYy5sb3dlcigpIGZvciBrZXl3b3JkIGluIFsibXYiLCAib2ZmaWNpYWwiLCAiY292ZXIiLCAibXVzaWMiLCAidmlkZW8iXSkgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIsSRxrDhu6NjIHTDoGkgdHLhu6MiIG5vdCBpbiBjb250ZW50X2Rlc2MubG93ZXIoKSBhbmQgInNwb25zb3IiIG5vdCBpbiBjb250ZW50X2Rlc2MubG93ZXIoKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDw7MgdGjhu4MgxJHDonkgbMOgIHRpdGxlIHRyb25nIGJ1dHRvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX3RpdGxlID0gY29udGVudF9kZXNjLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgdmlkZW8gdGl0bGUgdOG7qyBidXR0b24gY29udGVudC1kZXNjOiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBjb250ZW50X2Rlc2MgYW5kICJwaMOhdCB2aWRlbyIgaW4gY29udGVudF9kZXNjIGFuZCAiIC0gIiBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBQYXJzZSBjb250ZW50LWRlc2MgxJHhu4MgbOG6pXkgdGl0bGUgKHBo4bqnbiDEkeG6p3UgdHLGsOG7m2MgZOG6pXUgcGjhuql5IMSR4bqndSB0acOqbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0cyA9IGNvbnRlbnRfZGVzYy5zcGxpdCgiIC0gIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFydHMpID49IDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTOG6pXkgcGjhuqduIMSR4bqndSwgYuG7jyBwaOG6p24gY3Xhu5FpIGNo4bupYSBtZXRhZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZV9wYXJ0ID0gcGFydHNbMF0uc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIExv4bqhaSBi4buPIHBo4bqnbiB0aOG7nWkgZ2lhbiBu4bq/dSBjw7MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgInBow7p0IiBub3QgaW4gdGl0bGVfcGFydCBhbmQgImdpw6J5IiBub3QgaW4gdGl0bGVfcGFydDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX3RpdGxlID0gdGl0bGVfcGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHZpZGVvIHRpdGxlIHThu6sgYnV0dG9uOiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBQaMawxqFuZyBwaMOhcCAzOiBGYWxsYmFjayAtIHTDrG0gdGV4dCBkw6BpIG5o4bqldCBjw7Mgw70gbmdoxKlhIChsb+G6oWkgdHLhu6sgcXXhuqNuZyBjw6FvKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCB2aWRlb190aXRsZToKICAgICAgICAgICAgICAgICAgICAgICAgYWxsX2VsZW1lbnRzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHhtbF9zdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdlc3RfdGV4dCA9ICIiCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBlbGVtZW50IGluIGFsbF9lbGVtZW50czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBlbGVtZW50LmdldCgidGV4dCIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQgYW5kIGxlbih0ZXh0KSA+IGxlbihsb25nZXN0X3RleHQpIGFuZCBsZW4odGV4dCkgPiAxNSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImzGsOG7o3QgeGVtIiBub3QgaW4gdGV4dCBhbmQgInBow7p0IiBub3QgaW4gdGV4dCBhbmQgImdpw6J5IiBub3QgaW4gdGV4dCBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibsSDbSB0csaw4bubYyIgbm90IGluIHRleHQgYW5kICJ0aMOhbmcgdHLGsOG7m2MiIG5vdCBpbiB0ZXh0IGFuZCAibmfDoHkgdHLGsOG7m2MiIG5vdCBpbiB0ZXh0IGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLEkcaw4bujYyB0w6BpIHRy4bujIiBub3QgaW4gdGV4dC5sb3dlcigpIGFuZCAic3BvbnNvciIgbm90IGluIHRleHQubG93ZXIoKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9uZ2VzdF90ZXh0ID0gdGV4dAogICAgICAgICAgICAgICAgICAgICAgICBpZiBsb25nZXN0X3RleHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb190aXRsZSA9IGxvbmdlc3RfdGV4dC5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgdmlkZW8gdGl0bGUgdOG7qyB0ZXh0IGTDoGkgbmjhuqV0OiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgbOG6pXkgxJHGsOG7o2MgdmlkZW8gdGl0bGU6IHtlfSIpCgogICAgICAgICAgICAjIEhp4buDbiB0aOG7iyB0aMO0bmcgYsOhbyDEkWFuZyB4ZW0gdmlkZW8KICAgICAgICAgICAgaWYgdmlkZW9fdGl0bGU6CiAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCBmIsSQYW5nIHhlbSB2aWRlbyBZb3VUdWJlOiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkGFuZyB4ZW0gdmlkZW86IHt2aWRlb190aXRsZX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9tZXNzYWdlIiwgIsSQYW5nIHhlbSB2aWRlbyBZb3VUdWJlIikKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQYW5nIHhlbSB2aWRlbyBZb3VUdWJlOiAoa2jDtG5nIGzhuqV5IMSRxrDhu6NjIHRpdGxlKSIpCgogICAgICAgICAgICAjIDMuIFhlbSB2aWRlbyBjaMOtbmgKICAgICAgICAgICAgd2F0Y2hfdGltZSA9IHJhbmRvbS5yYW5kaW50KHZpZGVvX3dhdGNoX21pbiwgdmlkZW9fd2F0Y2hfbWF4KQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiWGVtIHZpZGVvIHRyb25nIHt3YXRjaF90aW1lfSBnacOieSIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YXRjaF90aW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyA0LiBMxrB1IHZpZGVvIHbDoG8gbOG7i2NoIHPhu60gbuG6v3UgbOG6pXkgxJHGsOG7o2MgdGl0bGUKICAgICAgICAgICAgaWYgdmlkZW9fdGl0bGU6CiAgICAgICAgICAgICAgICBzZWxmLl9zYXZlX3ZpZGVvX3RvX2hpc3RvcnkodmlkZW9fdGl0bGUpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHZpZGVvIHRpdGxlIMSR4buDIGzGsHUgdsOgbyBs4buLY2ggc+G7rSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHhlbSB2aWRlbzoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfaGFuZGxlX3NraXBfc3VydmV5KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gYuG7jyBxdWEga2jhuqNvIHPDoXQgbuG6v3UgY8OzCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0w6xtIHRo4bqleSB2w6AgYuG7jyBxdWEga2jhuqNvIHPDoXQKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVMOsbSBidXR0b24gIkLhu48gcXVhIGto4bqjbyBzw6F0IiBob+G6t2MgIlNraXAgc3VydmV5IgogICAgICAgICAgICBza2lwX3N1cnZleV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iQuG7jyBxdWEga2jhuqNvIHPDoXQiLCBjb250YWlucz1UcnVlKQogICAgICAgICAgICBpZiBub3Qgc2tpcF9zdXJ2ZXlfYnV0dG9uOgogICAgICAgICAgICAgICAgc2tpcF9zdXJ2ZXlfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IlNraXAgc3VydmV5IiwgY29udGFpbnM9VHJ1ZSkKICAgICAgICAgICAgaWYgbm90IHNraXBfc3VydmV5X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNraXBfc3VydmV5X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IkLhu48gcXVhIGto4bqjbyBzw6F0IiwgY29udGFpbnM9VHJ1ZSkKICAgICAgICAgICAgaWYgbm90IHNraXBfc3VydmV5X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNraXBfc3VydmV5X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlNraXAgc3VydmV5IiwgY29udGFpbnM9VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNraXBfc3VydmV5X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlTDrG0gdGjhuqV5IGto4bqjbyBzw6F0LCDEkWFuZyBi4buPIHF1YS4uLiIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2tpcF9zdXJ2ZXlfYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgeOG7rSBsw70ga2jhuqNvIHPDoXQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2hhbmRsZV9hZHZlcnRpc2VtZW50KHNlbGYsIGFkX3dhdGNoX21pbjogaW50LCBhZF93YXRjaF9tYXg6IGludCkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSBxdeG6o25nIGPDoW8gbuG6v3UgY8OzCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWRfd2F0Y2hfbWluOiBUaOG7nWkgZ2lhbiB4ZW0gcXXhuqNuZyBjw6FvIHThu5FpIHRoaeG7g3UKICAgICAgICAgICAgYWRfd2F0Y2hfbWF4OiBUaOG7nWkgZ2lhbiB4ZW0gcXXhuqNuZyBjw6FvIHThu5FpIMSRYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHTDrG0gdGjhuqV5IHbDoCB4ZW0gcXXhuqNuZyBjw6FvCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OhYyBpbmRpY2F0b3IgY+G7p2EgcXXhuqNuZyBjw6FvCiAgICAgICAgICAgIGFkX2luZGljYXRvcnMgPSBbCiAgICAgICAgICAgICAgICAjIFRleHQgaW5kaWNhdG9ycwogICAgICAgICAgICAgICAgKCJ0ZXh0IiwgIlF14bqjbmcgY8OhbyIsIFRydWUpLAogICAgICAgICAgICAgICAgKCJ0ZXh0IiwgIkFkdmVydGlzZW1lbnQiLCBUcnVlKSwKICAgICAgICAgICAgICAgICMgQ29udGVudC1kZXNjIGluZGljYXRvcnMKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIlF14bqjbmcgY8OhbyIsIFRydWUpLAogICAgICAgICAgICAgICAgKCJjb250ZW50X2Rlc2MiLCAiU2tpcCBhZCIsIFRydWUpLAogICAgICAgICAgICAgICAgKCJjb250ZW50X2Rlc2MiLCAiQuG7jyBxdWEgcXXhuqNuZyBjw6FvIiwgVHJ1ZSksCiAgICAgICAgICAgICAgICAjIFJlc291cmNlLWlkIGluZGljYXRvcnMKICAgICAgICAgICAgICAgICgicmVzb3VyY2VfaWQiLCAiY29tLmdvb2dsZS5hbmRyb2lkLnlvdXR1YmU6aWQvYWRfcHJvZ3Jlc3NfdGV4dCIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICgicmVzb3VyY2VfaWQiLCAic2tpcF9hZF9idXR0b24iLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoInJlc291cmNlX2lkIiwgInZpZGVvX2FkcyIsIEZhbHNlKSwKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHF14bqjbmcgY8OhbyAtIMSR4buNYyBYTUwgbeG7mXQgbOG6p24KICAgICAgICAgICAgYWRfZm91bmQgPSBGYWxzZQogICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpICAjIMSQ4buNYyBYTUwgbeG7mXQgbOG6p24gZHV5IG5o4bqldAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgeG1sX2NvbnRlbnQ6CiAgICAgICAgICAgICAgICBmb3IgaW5kaWNhdG9yX3R5cGUsIGluZGljYXRvcl92YWx1ZSwgdXNlX2NvbnRhaW5zIGluIGFkX2luZGljYXRvcnM6CiAgICAgICAgICAgICAgICAgICAgaWYgaW5kaWNhdG9yX3R5cGUgPT0gInRleHQiOgogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgdGV4dD1pbmRpY2F0b3JfdmFsdWUsIGNvbnRhaW5zPXVzZV9jb250YWlucykKICAgICAgICAgICAgICAgICAgICBlbGlmIGluZGljYXRvcl90eXBlID09ICJjb250ZW50X2Rlc2MiOgogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgY29udGVudF9kZXNjPWluZGljYXRvcl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgICAgIGVsaWYgaW5kaWNhdG9yX3R5cGUgPT0gInJlc291cmNlX2lkIjoKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIHJlc291cmNlX2lkPWluZGljYXRvcl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICAgICAgYWRfZm91bmQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBhZF9mb3VuZDoKICAgICAgICAgICAgICAgICMgWGVtIHF14bqjbmcgY8OhbyB0cm9uZyB0aOG7nWkgZ2lhbiByYW5kb20KICAgICAgICAgICAgICAgIGFkX3dhdGNoX3RpbWUgPSByYW5kb20ucmFuZGludChhZF93YXRjaF9taW4sIGFkX3dhdGNoX21heCkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSBxdeG6o25nIGPDoW8sIHhlbSB0cm9uZyB7YWRfd2F0Y2hfdGltZX0gZ2nDonkiKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKGFkX3dhdGNoX3RpbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSB2w6AgYuG6pW0gIlNraXAgYWQiIG7hur91IGPDswogICAgICAgICAgICAgICAgc2VsZi5fdHJ5X3NraXBfYWQoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgeOG7rSBsw70gcXXhuqNuZyBjw6FvOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF90cnlfc2tpcF9hZChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4butIGLhu48gcXVhIHF14bqjbmcgY8OhbyBu4bq/dSBjw7MgYnV0dG9uIHNraXAKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHTDrG0gdGjhuqV5IHbDoCBi4bqlbSBza2lwCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFTDrG0gYnV0dG9uIHNraXAgYWQKICAgICAgICAgICAgc2tpcF9idXR0b25zID0gWwogICAgICAgICAgICAgICAgKCJ0ZXh0IiwgIlNraXAiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgidGV4dCIsICJTa2lwIGFkIiwgVHJ1ZSksCiAgICAgICAgICAgICAgICAoInRleHQiLCAiU2tpcCBhZHMiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgidGV4dCIsICJC4buPIHF1YSIsIFRydWUpLAogICAgICAgICAgICAgICAgKCJ0ZXh0IiwgIkLhu48gcXVhIHF14bqjbmcgY8OhbyIsIFRydWUpLAogICAgICAgICAgICAgICAgKCJjb250ZW50X2Rlc2MiLCAiU2tpcCIsIFRydWUpLAogICAgICAgICAgICAgICAgKCJjb250ZW50X2Rlc2MiLCAiU2tpcCBhZCIsIFRydWUpLAogICAgICAgICAgICAgICAgKCJjb250ZW50X2Rlc2MiLCAiQuG7jyBxdWEiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgicmVzb3VyY2VfaWQiLCAic2tpcF9hZF9idXR0b24iLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoInJlc291cmNlX2lkIiwgInNraXBfYnV0dG9uIiwgRmFsc2UpLAogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgYnV0dG9uX3R5cGUsIGJ1dHRvbl92YWx1ZSwgdXNlX2NvbnRhaW5zIGluIHNraXBfYnV0dG9uczoKICAgICAgICAgICAgICAgIGlmIGJ1dHRvbl90eXBlID09ICJ0ZXh0IjoKICAgICAgICAgICAgICAgICAgICBza2lwX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PWJ1dHRvbl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgZWxpZiBidXR0b25fdHlwZSA9PSAiY29udGVudF9kZXNjIjoKICAgICAgICAgICAgICAgICAgICBza2lwX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9YnV0dG9uX3ZhbHVlLCBjb250YWlucz11c2VfY29udGFpbnMpCiAgICAgICAgICAgICAgICBlbGlmIGJ1dHRvbl90eXBlID09ICJyZXNvdXJjZV9pZCI6CiAgICAgICAgICAgICAgICAgICAgc2tpcF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9YnV0dG9uX3ZhbHVlLCBjb250YWlucz11c2VfY29udGFpbnMpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNraXBfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhu48gcXVhIHF14bqjbmcgY8OhbyIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNraXBfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBi4buPIHF1YSBxdeG6o25nIGPDoW86IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2hhbmRsZV9jbG9zZV9wb3B1cHMoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSDEkcOzbmcgY8OhYyBwb3B1cC9kaWFsb2cgbuG6v3UgY8OzCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0w6xtIHRo4bqleSB2w6AgxJHDs25nIHBvcHVwCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4buNYyBYTUwgbeG7mXQgbOG6p24gZHV5IG5o4bqldAogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBidXR0b24gIsSQw7NuZyIgdOG7qyBYTUwgxJHDoyDEkeG7jWMKICAgICAgICAgICAgY2xvc2VfYnV0dG9ucyA9IFsKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIsSQw7NuZyIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIkNsb3NlIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgKCJ0ZXh0IiwgIsSQw7NuZyIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICgidGV4dCIsICJDbG9zZSIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICgidGV4dCIsICLDlyIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIkRpc21pc3MiLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoInJlc291cmNlX2lkIiwgImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL21vZGVybl9taW5pcGxheWVyX2Nsb3NlIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgKCJyZXNvdXJjZV9pZCIsICJjb20uZ29vZ2xlLmFuZHJvaWQueW91dHViZTppZC9jbG9zZV9idXR0b24iLCBGYWxzZSksCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgIHBvcHVwX2Nsb3NlZCA9IEZhbHNlCiAgICAgICAgICAgIGZvciBidXR0b25fdHlwZSwgYnV0dG9uX3ZhbHVlLCB1c2VfY29udGFpbnMgaW4gY2xvc2VfYnV0dG9uczoKICAgICAgICAgICAgICAgIGlmIGJ1dHRvbl90eXBlID09ICJ0ZXh0IjoKICAgICAgICAgICAgICAgICAgICBjbG9zZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9YnV0dG9uX3ZhbHVlLCBjb250YWlucz11c2VfY29udGFpbnMpCiAgICAgICAgICAgICAgICBlbGlmIGJ1dHRvbl90eXBlID09ICJjb250ZW50X2Rlc2MiOgogICAgICAgICAgICAgICAgICAgIGNsb3NlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPWJ1dHRvbl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgZWxpZiBidXR0b25fdHlwZSA9PSAicmVzb3VyY2VfaWQiOgogICAgICAgICAgICAgICAgICAgIGNsb3NlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9YnV0dG9uX3ZhbHVlLCBjb250YWlucz11c2VfY29udGFpbnMpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGNsb3NlX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgcG9wdXAgduG7m2kge2J1dHRvbl90eXBlfT0ne2J1dHRvbl92YWx1ZX0nLCDEkWFuZyDEkcOzbmcuLi4iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjbG9zZV9idXR0b24pCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgcG9wdXBfY2xvc2VkID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcG9wdXBfY2xvc2VkCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgxJHDs25nIHBvcHVwOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgIyA9PT09PSBWSURFTyBISVNUT1JZIE1BTkFHRU1FTlQgPT09PT0KICAgIAogICAgZGVmIF9zYXZlX3ZpZGVvX3RvX2hpc3Rvcnkoc2VsZiwgdmlkZW9fdGl0bGU6IHN0cikgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBMxrB1IHZpZGVvIHbDoG8gbOG7i2NoIHPhu60gxJHDoyB4ZW0gdHJvbmcgam9ic19oaXN0b3J5IHRhYmxlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdmlkZW9fdGl0bGU6IFTDqm4gdmlkZW8KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCB2aWRlb190aXRsZSBvciB2aWRlb190aXRsZS5zdHJpcCgpID09ICIiOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBhY2NvdW50ICJuby5hY2NvdW50IiBjaG8gWW91VHViZQogICAgICAgICAgICBhY2NvdW50ID0gc2VsZi5kYi5nZXRfYWNjb3VudF9ieV91bmlxdWVfdXNlcm5hbWUoc2VsZi5hcHBfbmFtZSwgIm5vLmFjY291bnQiKQogICAgICAgICAgICBpZiBub3QgYWNjb3VudDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBhY2NvdW50IG5vLmFjY291bnQgY2hvIFlvdVR1YmUiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIGpvYiBkYXRhIGNobyB2aWRlbyBoaXN0b3J5CiAgICAgICAgICAgIGpvYl9kYXRhID0gewogICAgICAgICAgICAgICAgImFjY291bnRfdXVpZCI6IGFjY291bnRbImFjY291bnRfdXVpZCJdLAogICAgICAgICAgICAgICAgImFwcCI6IHNlbGYuYXBwX25hbWUsCiAgICAgICAgICAgICAgICAiam9iX3R5cGUiOiAidmlldyIsCiAgICAgICAgICAgICAgICAib2JqZWN0X2lkIjogdmlkZW9fdGl0bGUsICAjIEzGsHUgdmlkZW8gdGl0bGUgdsOgbyBvYmplY3RfaWQKICAgICAgICAgICAgICAgICJsaW5rIjogIiIsCiAgICAgICAgICAgICAgICAic3RhdHVzIjogMSwgICMgU3VjY2VzcwogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBUcnVlLAogICAgICAgICAgICAgICAgInByaWNlIjogMCwKICAgICAgICAgICAgICAgICJlcnJvcl9tZXNzYWdlIjogIiIKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IHbDoG8gam9ic19oaXN0b3J5CiAgICAgICAgICAgIGpvYl91dWlkID0gc2VsZi5kYi5hZGRfam9iX2hpc3Rvcnkoam9iX2RhdGEpCiAgICAgICAgICAgIGlmIGpvYl91dWlkOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgbMawdSB2aWRlbyB2w6BvIGzhu4tjaCBz4butOiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdGjhu4MgbMawdSB2aWRlbyB2w6BvIGzhu4tjaCBz4butOiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGzGsHUgdmlkZW8gaGlzdG9yeToge2V9IikKICAgIAogICAgZGVmIF9jYW5fd2F0Y2hfdmlkZW8oc2VsZiwgdmlkZW9fdGl0bGU6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBjw7MgdGjhu4MgeGVtIHZpZGVvIGtow7RuZyAocXVlcnkgdHLhu7FjIHRp4bq/cCBkYXRhYmFzZSkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB2aWRlb190aXRsZTogVMOqbiB2aWRlbwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGPDsyB0aOG7gyB4ZW0KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCB2aWRlb190aXRsZSBvciB2aWRlb190aXRsZS5zdHJpcCgpID09ICIiOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgYWNjb3VudCAibm8uYWNjb3VudCIgY2hvIFlvdVR1YmUKICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnRfYnlfdW5pcXVlX3VzZXJuYW1lKHNlbGYuYXBwX25hbWUsICJuby5hY2NvdW50IikKICAgICAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBLaMO0bmcgY8OzIGFjY291bnQgdGjDrCBjaG8gcGjDqXAgeGVtCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgY29uZmlnID0gc2VsZi5nZXRfYXBwX2NvbmZpZygpCiAgICAgICAgICAgIGNvb2xkb3duX21pbnV0ZXMgPSBjb25maWcuZ2V0KCJ2aWRlb19yZXdhdGNoX2Nvb2xkb3duX21pbnV0ZXMiLCAyNDApCiAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgY29vbGRvd25fc2Vjb25kcyA9IGNvb2xkb3duX21pbnV0ZXMgKiA2MAogICAgICAgICAgICBjdXRvZmZfdGltZSA9IGN1cnJlbnRfdGltZSAtIGNvb2xkb3duX3NlY29uZHMKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUXVlcnkgdHLhu7FjIHRp4bq/cCBkYXRhYmFzZSDEkeG7gyBraeG7g20gdHJhIHZpZGVvIMSRw6MgeGVtIGfhuqduIMSRw6J5IGNoxrBhCiAgICAgICAgICAgIGNvbm4gPSBzZWxmLmRiLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHF1ZXJ5ID0gIiIiCiAgICAgICAgICAgICAgICBTRUxFQ1QgY3JlYXRlZF9hdCBGUk9NIGpvYnNfaGlzdG9yeSAKICAgICAgICAgICAgICAgIFdIRVJFIGFjY291bnRfdXVpZCA9ID8gCiAgICAgICAgICAgICAgICBBTkQgam9iX3R5cGUgPSAndmlldycgCiAgICAgICAgICAgICAgICBBTkQgb2JqZWN0X2lkID0gPyAKICAgICAgICAgICAgICAgIEFORCBjcmVhdGVkX2F0ID4gPwogICAgICAgICAgICAgICAgT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDIAogICAgICAgICAgICAgICAgTElNSVQgMQogICAgICAgICAgICAiIiIKICAgICAgICAgICAgCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKHF1ZXJ5LCAoYWNjb3VudFsiYWNjb3VudF91dWlkIl0sIHZpZGVvX3RpdGxlLCBjdXRvZmZfdGltZSkpCiAgICAgICAgICAgIHJlc3VsdCA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXN1bHQ6CiAgICAgICAgICAgICAgICAjIFZpZGVvIMSRw6MgeGVtIHRyb25nIHRo4budaSBnaWFuIGNvb2xkb3duCiAgICAgICAgICAgICAgICBsYXN0X3dhdGNoZWQgPSByZXN1bHRbMF0KICAgICAgICAgICAgICAgIHRpbWVfZGlmZiA9IGN1cnJlbnRfdGltZSAtIGxhc3Rfd2F0Y2hlZAogICAgICAgICAgICAgICAgcmVtYWluaW5nX2hvdXJzID0gKGNvb2xkb3duX3NlY29uZHMgLSB0aW1lX2RpZmYpIC8gMzYwMAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlZpZGVvICd7dmlkZW9fdGl0bGV9JyDEkcOjIHhlbSBn4bqnbiDEkcOieSwgY8OybiB7cmVtYWluaW5nX2hvdXJzOi4xZn1oIMSR4buDIHhlbSBs4bqhaSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVmlkZW8gY2jGsGEgeGVtIGhv4bq3YyDEkcOjIMSR4bunIHRo4budaSBnaWFuIGNvb2xkb3duCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVmlkZW8gJ3t2aWRlb190aXRsZX0nIGPDsyB0aOG7gyB4ZW0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtp4buDbSB0cmEgY2FuIHdhdGNoIHZpZGVvOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBEZWZhdWx0IGNobyBwaMOpcCB4ZW0KICAgIAogICAgZGVmIF9leHRyYWN0X3ZpZGVvX3RpdGxlX2Zyb21fZWxlbWVudChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIFRyw61jaCB4deG6pXQgdMOqbiB2aWRlbyB04burIGVsZW1lbnQgdsOgIGzDoG0gc+G6oWNoIHRpw6p1IMSR4buBCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZWxlbWVudDogRWxlbWVudCBjaOG7qWEgdGjDtG5nIHRpbiB2aWRlbwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFTDqm4gdmlkZW8gxJHDoyBsw6BtIHPhuqFjaCBob+G6t2MgY2h14buXaSBy4buXbmcKICAgICAgICAiIiIKICAgICAgICBkZWYgY2xlYW5fdGl0bGUodGl0bGU6IHN0cikgLT4gc3RyOgogICAgICAgICAgICAiIiJMw6BtIHPhuqFjaCB2aWRlbyB0aXRsZSwgbG/huqFpIGLhu48gY8OhYyB0aMO0bmcgdGluIHRo4burYSIiIgogICAgICAgICAgICBpZiBub3QgdGl0bGU6CiAgICAgICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTG/huqFpIGLhu48gcGjhuqduIHRo4budaSBnaWFuIOG7nyBjdeG7kWkgbmjGsCAiLSAyIHBow7p0IiwgIi0gMSBnaeG7nSIsICItIDMwIGdpw6J5IgogICAgICAgICAgICB0aXRsZSA9IHJlLnN1YihyJ1xzKlst4oCTXVxzKlxkK1xzKihwaMO6dHxnacOieXxnaeG7nXx0aeG6v25nKVxzKiQnLCAnJywgdGl0bGUsIGZsYWdzPXJlLklHTk9SRUNBU0UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIHBo4bqnbiB0aOG7nWkgZ2lhbiBmb3JtYXQga2jDoWMgbmjGsCAiKDI6MzApIiwgIlszOjQ1XSIKICAgICAgICAgICAgdGl0bGUgPSByZS5zdWIocidccypbXFtcKF1ccypcZCs6XGQrXHMqW1xdXCldXHMqJCcsICcnLCB0aXRsZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTG/huqFpIGLhu48gdGjDtG5nIHRpbiBsxrDhu6N0IHhlbSDhu58gY3Xhu5FpIG5oxrAgIi0gMU0gdmlld3MiLCAiLSAxMDBLIGzGsOG7o3QgeGVtIgogICAgICAgICAgICB0aXRsZSA9IHJlLnN1YihyJ1xzKlst4oCTXVxzKlxkK1tLTUJdP1xzKih2aWV3cz98bMaw4bujdCB4ZW0pXHMqJCcsICcnLCB0aXRsZSwgZmxhZ3M9cmUuSUdOT1JFQ0FTRSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTG/huqFpIGLhu48ga2hv4bqjbmcgdHLhuq9uZyB0aOG7q2EgdsOgIHRy4bqjIHbhu4EKICAgICAgICAgICAgcmV0dXJuIHRpdGxlLnN0cmlwKCkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVGjhu60gbOG6pXkgdOG7qyB0ZXh0IHRyxrDhu5tjCiAgICAgICAgICAgIHRleHQgPSBlbGVtZW50LmdldCgidGV4dCIsICIiKQogICAgICAgICAgICBpZiB0ZXh0IGFuZCB0ZXh0ICE9ICJudWxsIiBhbmQgbGVuKHRleHQpID4gNToKICAgICAgICAgICAgICAgICMgQuG7jyBxdWEgbmjhu69uZyB0ZXh0IGtow7RuZyBwaOG6o2kgdMOqbiB2aWRlbwogICAgICAgICAgICAgICAgaWYgYW55KGtleXdvcmQgaW4gdGV4dC5sb3dlcigpIGZvciBrZXl3b3JkIGluIFsibMaw4bujdCB4ZW0iLCAicGjDunQiLCAiZ2nDonkiLCAibsSDbSB0csaw4bubYyIsICJ0aMOhbmcgdHLGsOG7m2MiLCAibmfDoHkgdHLGsOG7m2MiLCAiZ2nhu50gdHLGsOG7m2MiXSk6CiAgICAgICAgICAgICAgICAgICAgcGFzcyAgIyBLaMO0bmcgcGjhuqNpIHRpdGxlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBjbGVhbl90aXRsZSh0ZXh0LnN0cmlwKCkpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGzhuqV5IHThu6sgY29udGVudC1kZXNjCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYyA9IGVsZW1lbnQuZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGFuZCBjb250ZW50X2Rlc2MgIT0gIm51bGwiOgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjb250ZW50LWRlc2MgY8OzIGZvcm1hdDogIlTDqm4gdmlkZW8sIFTDqm4ga8OqbmgsIFggbMaw4bujdCB4ZW0sIFkgdGjhu51pIGdpYW4sIHBow6F0IHZpZGVvIgogICAgICAgICAgICAgICAgaWYgInBow6F0IHZpZGVvIiBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgcGFydHMgPSBjb250ZW50X2Rlc2Muc3BsaXQoIiwgIikKICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFydHMpID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9fdGl0bGUgPSBwYXJ0c1swXS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHZpZGVvX3RpdGxlIGFuZCBsZW4odmlkZW9fdGl0bGUpID4gNToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbGVhbl90aXRsZSh2aWRlb190aXRsZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBIb+G6t2MgY29udGVudC1kZXNjIGNo4buJIGNo4bupYSB0aMO0bmcgdGluIHZpZGVvCiAgICAgICAgICAgICAgICBpZiAibMaw4bujdCB4ZW0iIGluIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICAjIFTDrG0gcGjhuqduIHRyxrDhu5tjICJsxrDhu6N0IHhlbSIgY8OzIHRo4buDIGzDoCB0aXRsZQogICAgICAgICAgICAgICAgICAgIHBhcnRzID0gY29udGVudF9kZXNjLnNwbGl0KCJsxrDhu6N0IHhlbSIpWzBdLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAjIExv4bqhaSBi4buPIHBo4bqnbiBjdeG7kWkgY8OzIHRo4buDIGzDoCBz4buRCiAgICAgICAgICAgICAgICAgICAgdGl0bGVfcGFydHMgPSBwYXJ0cy5zcGxpdCgpCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHRpdGxlX3BhcnRzKSA+IDM6ICAjIMSQ4bqjbSBi4bqjbyBjw7MgxJHhu6cgdOG7qyDEkeG7gyBsw6AgdGl0bGUKICAgICAgICAgICAgICAgICAgICAgICAgIyBC4buPIDEtMiB04burIGN14buRaSBjw7MgdGjhu4MgbMOgIHPhu5EgbMaw4bujdCB4ZW0KICAgICAgICAgICAgICAgICAgICAgICAgcG90ZW50aWFsX3RpdGxlID0gIiAiLmpvaW4odGl0bGVfcGFydHNbOi0yXSkuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocG90ZW50aWFsX3RpdGxlKSA+IDEwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNsZWFuX3RpdGxlKHBvdGVudGlhbF90aXRsZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBGYWxsYmFjazogbuG6v3UgY29udGVudC1kZXNjIGTDoGkgdsOgIGPDsyDDvSBuZ2jEqWEKICAgICAgICAgICAgICAgIGlmIGxlbihjb250ZW50X2Rlc2MpID4gMTAgYW5kIG5vdCBhbnkoa2V5d29yZCBpbiBjb250ZW50X2Rlc2MubG93ZXIoKSBmb3Iga2V5d29yZCBpbiBbImJ1dHRvbiIsICJpbWFnZSIsICJ2aWV3Il0pOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBjbGVhbl90aXRsZShjb250ZW50X2Rlc2Muc3RyaXAoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kgZXh0cmFjdCB2aWRlbyB0aXRsZToge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAKICAgICMgPT09PT0gR09MSUtFIElOVEVHUkFUSU9OIChZT1VUVUJFIEtIw5RORyBTVVBQT1JUKSA9PT09PQogICAgCiAgICBkZWYgbWFwX2dvbGlrZV9hY2NvdW50cyhzZWxmLCBnb2xpa2VfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dLCBkZXZpY2VfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBZb3VUdWJlIGtow7RuZyBo4buXIHRy4bujIEdvTGlrZQogICAgICAgICIiIgogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIllvdVR1YmUga2jDtG5nIGjhu5cgdHLhu6MgR29MaWtlIGludGVncmF0aW9uIikKICAgICAgICByZXR1cm4gW10KICAgIAogICAgZGVmIGdldF9qb2JfcGFyYW1zKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiJZb3VUdWJlIGtow7RuZyBo4buXIHRy4bujIGpvYiBwYXJhbXMiIiIKICAgICAgICByZXR1cm4ge30KICAgIAogICAgZGVmIGV4ZWN1dGVfam9iKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBZb3VUdWJlIGtow7RuZyB0aOG7sWMgaGnhu4duIGpvYnMgdOG7qyBHb0xpa2UKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMCwgIllvdVR1YmUga2jDtG5nIGjhu5cgdHLhu6Mgam9icyIsIEZhbHNlKQo=').decode('utf-8'))
