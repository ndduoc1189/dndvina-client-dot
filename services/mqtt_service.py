import base64
exec(base64.b64decode('aW1wb3J0IHBhaG8ubXF0dC5jbGllbnQgYXMgbXF0dAppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCB1dWlkCmltcG9ydCBvcwpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBMaXN0LCBPcHRpb25hbCwgQ2FsbGFibGUsIFVuaW9uCmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCgojIExvZ2dlcgpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJNUVRUU2VydmljZSIpCgpjbGFzcyBNUVRUU2VydmljZToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9zZXJ2aWNlLCBkZXZpY2VfaWQsIGhlbHBlcl9zZXJ2aWNlPU5vbmUpOgogICAgICAgICMgS2jhu59pIHThuqFvIGPDoWMgc2VydmljZQogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgc2VsZi5oZWxwZXJfc2VydmljZSA9IGhlbHBlcl9zZXJ2aWNlCiAgICAgICAgCiAgICAgICAgIyBD4bqldSBow6xuaCBNUVRUCiAgICAgICAgc2VsZi5jbGllbnRfaWQgPSBmIntjb25maWcuTVFUVF9DTElFTlRfSURfUFJFRklYfV97ZGV2aWNlX2lkfSIKICAgICAgICBzZWxmLmJyb2tlcl91cmwgPSBjb25maWcuTVFUVF9TRVJWRVJTW2NvbmZpZy5NT0RFXQogICAgICAgIHNlbGYuYnJva2VyX2FkZHJlc3MgPSBzZWxmLmJyb2tlcl91cmwucmVwbGFjZSgibXF0dDovLyIsICIiKS5zcGxpdCgiOiIpWzBdCiAgICAgICAgc2VsZi5icm9rZXJfcG9ydCA9IGludChzZWxmLmJyb2tlcl91cmwuc3BsaXQoIjoiKVstMV0pIGlmICI6IiBpbiBzZWxmLmJyb2tlcl91cmwgZWxzZSAxODgzCiAgICAgICAgc2VsZi51c2VybmFtZSA9IGNvbmZpZy5NUVRUX1VTRVJOQU1FCiAgICAgICAgc2VsZi5wYXNzd29yZCA9IGNvbmZpZy5NUVRUX1BBU1NXT1JECiAgICAgICAgCiAgICAgICAgIyBUcuG6oW5nIHRow6FpIGvhur90IG7hu5FpCiAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHNlbGYuY2xpZW50ID0gTm9uZQogICAgICAgIHNlbGYuZGV2aWNlX2lkID0gZGV2aWNlX2lkCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgIyBUb3BpY3MKICAgICAgICBzZWxmLnRvcGljX2NsaWVudF9zeW5jID0gY29uZmlnLk1RVFRfVE9QSUNfQ0xJRU5UX1NZTkMKICAgICAgICBzZWxmLnRvcGljX3NlcnZlcl90YXNrID0gZiJ7Y29uZmlnLk1RVFRfVE9QSUNfU0VSVkVSX1RBU0tfUFJFRklYfS97c2VsZi5kZXZpY2VfaWR9IgogICAgICAgIAogICAgICAgICMgUXXhuqNuIGzDvSB0YXNrIHbDoCBzeW5jCiAgICAgICAgc2VsZi50YXNrX2hhbmRsZXJzID0ge30KICAgICAgICBzZWxmLnN5bmNfdGhyZWFkID0gTm9uZQogICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgc2VsZi5zdG9wX2V2ZW50ID0gdGhyZWFkaW5nLkV2ZW50KCkKICAgICAgICBzZWxmLnN5bmNfaW50ZXJ2YWwgPSBzZWxmLmRiLmdldF9kZXZpY2VfY29uZmlnKCJzeW5jX2ludGVydmFsIiwgY29uZmlnLlNZTkNfSU5URVJWQUwpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIG3DtGkgdHLGsOG7nW5nIFRlcm11eAogICAgICAgIHNlbGYuaXNfdGVybXV4ID0gJ1RFUk1VWF9WRVJTSU9OJyBpbiBvcy5lbnZpcm9uIG9yICcvZGF0YS9kYXRhL2NvbS50ZXJtdXgnIGluIG9zLmVudmlyb24uZ2V0KCdQQVRIJywgJycpCiAgICAgICAgaWYgc2VsZi5pc190ZXJtdXg6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkGFuZyBjaOG6oXkgdHJvbmcgbcO0aSB0csaw4budbmcgVGVybXV4IikKCiAgICBkZWYgX2NyZWF0ZV9jbGllbnQoc2VsZikgLT4gbXF0dC5DbGllbnQ6CiAgICAgICAgIiIiVOG6oW8gdsOgIGPhuqV1IGjDrG5oIE1RVFQgY2xpZW50IiIiCiAgICAgICAgY2xpZW50ID0gTm9uZQoKICAgICAgICAjIFRo4butIHThuqFvIHbhu5tpIEFQSSB2MgogICAgICAgIHRyeToKICAgICAgICAgICAgY2xpZW50ID0gbXF0dC5DbGllbnQoCiAgICAgICAgICAgICAgICBjbGllbnRfaWQ9c2VsZi5jbGllbnRfaWQsCiAgICAgICAgICAgICAgICBjbGVhbl9zZXNzaW9uPVRydWUsCiAgICAgICAgICAgICAgICBwcm90b2NvbD1tcXR0Lk1RVFR2MzExLAogICAgICAgICAgICAgICAgY2FsbGJhY2tfYXBpX3ZlcnNpb249Z2V0YXR0cihtcXR0LkNhbGxiYWNrQVBJVmVyc2lvbiwgJ1ZFUlNJT04yJywgTm9uZSkKICAgICAgICAgICAgKQogICAgICAgICAgICBsb2dnZXIuaW5mbygiVOG6oW8gTVFUVCBjbGllbnQgduG7m2kgQVBJIHYyIikKICAgICAgICBleGNlcHQgKEF0dHJpYnV0ZUVycm9yLCBUeXBlRXJyb3IpOgogICAgICAgICAgICAjIEZhbGxiYWNrIEFQSSB2MQogICAgICAgICAgICBjbGllbnQgPSBtcXR0LkNsaWVudCgKICAgICAgICAgICAgICAgIGNsaWVudF9pZD1zZWxmLmNsaWVudF9pZCwKICAgICAgICAgICAgICAgIGNsZWFuX3Nlc3Npb249VHJ1ZSwKICAgICAgICAgICAgICAgIHByb3RvY29sPW1xdHQuTVFUVHYzMTEKICAgICAgICAgICAgKQogICAgICAgICAgICBsb2dnZXIuaW5mbygiVOG6oW8gTVFUVCBjbGllbnQgduG7m2kgQVBJIHYxIikKICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIHjDoWMgdGjhu7FjIG7hur91IGPDswogICAgICAgIGlmIHNlbGYudXNlcm5hbWUgYW5kIHNlbGYucGFzc3dvcmQ6CiAgICAgICAgICAgIGNsaWVudC51c2VybmFtZV9wd19zZXQoc2VsZi51c2VybmFtZSwgc2VsZi5wYXNzd29yZCkKICAgICAgICAKICAgICAgICAjIMSQxINuZyBrw70gY2FsbGJhY2sKICAgICAgICBjbGllbnQub25fY29ubmVjdCA9IHNlbGYuX29uX2Nvbm5lY3QKICAgICAgICBjbGllbnQub25fbWVzc2FnZSA9IHNlbGYuX29uX21lc3NhZ2UKICAgICAgICBjbGllbnQub25fZGlzY29ubmVjdCA9IHNlbGYuX29uX2Rpc2Nvbm5lY3QKICAgICAgICAKICAgICAgICByZXR1cm4gY2xpZW50CgogICAgZGVmIGNvbm5lY3Qoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiJL4bq/dCBu4buRaSDEkeG6v24gTVFUVCBicm9rZXIiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVOG6oW8gY2xpZW50IG3hu5tpIG7hur91IGNoxrBhIGPDswogICAgICAgICAgICBpZiBzZWxmLmNsaWVudCBpcyBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5jbGllbnQgPSBzZWxmLl9jcmVhdGVfY2xpZW50KCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVzZXQgdHLhuqFuZyB0aMOhaQogICAgICAgICAgICBzZWxmLnN0b3BfZXZlbnQuY2xlYXIoKQogICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAgIyDEkOG6t3QgcmVjb25uZWN0IGRlbGF5IHRyxrDhu5tjCiAgICAgICAgICAgIHNlbGYuY2xpZW50LnJlY29ubmVjdF9kZWxheV9zZXQobWluX2RlbGF5PTEsIG1heF9kZWxheT02MCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS+G6v3QgbuG7kWkgYuG6pXQgxJHhu5NuZyBi4buZIGzhuqduIMSR4bqndQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGvhur90IG7hu5FpIHThu5tpIE1RVFQgYnJva2VyIHtzZWxmLmJyb2tlcl9hZGRyZXNzfTp7c2VsZi5icm9rZXJfcG9ydH0iKQogICAgICAgICAgICBzZWxmLmNsaWVudC5jb25uZWN0X2FzeW5jKHNlbGYuYnJva2VyX2FkZHJlc3MsIHNlbGYuYnJva2VyX3BvcnQsIGtlZXBhbGl2ZT02MCkKICAgICAgICAgICAgc2VsZi5jbGllbnQubG9vcF9zdGFydCgpCgogICAgICAgICAgICBkZWYgX3dhaXRfY29ubmVjdGVkKHRpbWVvdXRfc2VjOiBpbnQgPSAxMCkgLT4gYm9vbDoKICAgICAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKHRpbWVvdXRfc2VjKToKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgICAgICMgQ2jhu50ga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgIGlmIF93YWl0X2Nvbm5lY3RlZCgpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nIMSR4bq/biBNUVRUIGJyb2tlciIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQoKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkvhur90IG7hu5FpIE1RVFQgdGjhuqV0IGLhuqFpLCB0aOG7rSBk4buxIHBow7JuZyAxMC4wLjAuNTo5MDIwIikKCiAgICAgICAgICAgICMgROG7q25nIGxvb3AgxJHhu4MgxJHhu5VpIMSR4buLYSBjaOG7iSwgc2F1IMSRw7Mga2jhu59pIMSR4buZbmcgbOG6oWkKICAgICAgICAgICAgc2VsZi5jbGllbnQubG9vcF9zdG9wKCkKCiAgICAgICAgICAgIGZhbGxiYWNrX2hvc3QgPSAiMTAuMC4wLjUiCiAgICAgICAgICAgIGZhbGxiYWNrX3BvcnQgPSA5MDIwCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50LnJlY29ubmVjdF9kZWxheV9zZXQobWluX2RlbGF5PTEsIG1heF9kZWxheT02MCkKICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50LmNvbm5lY3RfYXN5bmMoZmFsbGJhY2tfaG9zdCwgZmFsbGJhY2tfcG9ydCwga2VlcGFsaXZlPTYwKQogICAgICAgICAgICAgICAgc2VsZi5jbGllbnQubG9vcF9zdGFydCgpCiAgICAgICAgICAgICAgICBpZiBfd2FpdF9jb25uZWN0ZWQoKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6Mga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nIHThu5tpIE1RVFQgYnJva2VyIGThu7EgcGjDsm5nIHtmYWxsYmFja19ob3N0fTp7ZmFsbGJhY2tfcG9ydH0iKQogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGJyb2tlciBhZGRyZXNzIMSR4buDIGPDoWMgbOG6p24gc2F1IHPhu60gZOG7pW5nCiAgICAgICAgICAgICAgICAgICAgc2VsZi5icm9rZXJfYWRkcmVzcyA9IGZhbGxiYWNrX2hvc3QKICAgICAgICAgICAgICAgICAgICBzZWxmLmJyb2tlcl9wb3J0ID0gZmFsbGJhY2tfcG9ydAogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS+G6v3QgbuG7kWkgTVFUVCBk4buxIHBow7JuZyB0aOG6pXQgYuG6oWkiKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkga+G6v3QgbuG7kWkgTVFUVCBk4buxIHBow7JuZzoge2V9IikKCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBr4bq/dCBu4buRaSBNUVRUOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBlbnN1cmVfY29ubmVjdGVkKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIixJDhuqNtIGLhuqNvIGvhur90IG7hu5FpIE1RVFQgdHLGsOG7m2Mga2hpIHRo4buxYyBoaeG7h24gY8OhYyB0aGFvIHTDoWMiIiIKICAgICAgICBpZiBzZWxmLmlzX2Nvbm5lY3RlZDoKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBsb2dnZXIud2FybmluZygiTVFUVCBjaMawYSBr4bq/dCBu4buRaSwgxJFhbmcgdGjhu60ga+G6v3QgbuG7kWkgbOG6oWkuLi4iKQogICAgICAgIHJldHVybiBzZWxmLmNvbm5lY3QoKQoKICAgIGRlZiBfb25fY29ubmVjdChzZWxmLCBjbGllbnQsIHVzZXJkYXRhLCBmbGFncywgcmMsIHByb3BlcnRpZXM9Tm9uZSk6CiAgICAgICAgIiIiQ2FsbGJhY2sga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZyIiIgogICAgICAgIGlmIHJjID09IDA6CiAgICAgICAgICAgIHNlbGYuaXNfY29ubmVjdGVkID0gVHJ1ZQogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcgdOG7m2kgTVFUVCBicm9rZXIiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMSDbmcga8O9IG5o4bqtbiB0YXNrCiAgICAgICAgICAgIHNlbGYuY2xpZW50LnN1YnNjcmliZShzZWxmLnRvcGljX3NlcnZlcl90YXNrLCBxb3M9MSkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMSRxINuZyBrw70gbmjhuq1uIHRhc2sgdOG6oWk6IHtzZWxmLnRvcGljX3NlcnZlcl90YXNrfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpCiAgICAgICAgICAgIHNlbGYuc2VuZF9jb25uZWN0X25vdGlmaWNhdGlvbigpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS+G6v3QgbuG7kWkgTVFUVCB0aOG6pXQgYuG6oWkgduG7m2kgbcOjIGzhu5dpOiB7cmN9IikKCiAgICBkZWYgX29uX2Rpc2Nvbm5lY3Qoc2VsZiwgY2xpZW50LCB1c2VyZGF0YSwgcmMsIHByb3BlcnRpZXM9Tm9uZSwgcmVhc29uX2NvZGU9Tm9uZSwgKiprd2FyZ3MpOgogICAgICAgICIiIkNhbGxiYWNrIGtoaSBuZ+G6r3Qga+G6v3QgbuG7kWkiIiIKICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgaWYgcmMgIT0gMDoKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJOZ+G6r3Qga+G6v3QgbuG7kWkgTVFUVCBraMO0bmcgbW9uZyBtdeG7kW4gduG7m2kgbcOjIGzhu5dpOiB7cmN9IikKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBuZ+G6r3Qga+G6v3QgbuG7kWkgTVFUVCIpCgogICAgZGVmIF9zYWZlX3B1Ymxpc2goc2VsZiwgdG9waWM6IHN0ciwgcGF5bG9hZDogc3RyLCBxb3M6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgR+G7rWkgbWVzc2FnZSBhbiB0b8OgbiB24bubaSBraeG7g20gdHJhIGvhur90IG7hu5FpIHRyxrDhu5tjIGtoaSBwdWJsaXNoCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdG9waWM6IE1RVFQgdG9waWMKICAgICAgICAgICAgcGF5bG9hZDogTuG7mWkgZHVuZyBtZXNzYWdlIChzdHJpbmcpCiAgICAgICAgICAgIHFvczogUXVhbGl0eSBvZiBTZXJ2aWNlICgwLCAxLCBob+G6t2MgMikKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBn4butaSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2Nvbm5lY3RlZCgpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGfhu61pIG1lc3NhZ2UgxJHhur9uIHt0b3BpY306IE1RVFQgY2jGsGEga+G6v3QgbuG7kWkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICByZXN1bHQgPSBzZWxmLmNsaWVudC5wdWJsaXNoKHRvcGljLCBwYXlsb2FkLCBxb3M9cW9zKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0LnJjID09IG1xdHQuTVFUVF9FUlJfU1VDQ0VTUzoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBn4butaSBtZXNzYWdlIHRow6BuaCBjw7RuZyDEkeG6v24ge3RvcGljfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIG1lc3NhZ2UgxJHhur9uIHt0b3BpY306IHttcXR0LmVycm9yX3N0cmluZyhyZXN1bHQucmMpfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7rWkgbWVzc2FnZSDEkeG6v24ge3RvcGljfToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgc2VuZF90YXNrX3JlcG9ydChzZWxmLCB0YXNrX2lkOiBzdHIsIGRldmljZV9pZDogc3RyLCBzdGF0dXM6IHN0ciwgY2xpZW50X21lc3NhZ2U6IHN0ciA9ICIiKToKICAgICAgICAiIiJH4butaSBiw6FvIGPDoW8ga+G6v3QgcXXhuqMgdGjhu7FjIGhp4buHbiB0YXNrIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXBvcnRfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJ0YXNrX2lkIjogdGFza19pZCwKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiBkZXZpY2VfaWQsCiAgICAgICAgICAgICAgICAic3RhdHVzIjogc3RhdHVzLAogICAgICAgICAgICAgICAgImNsaWVudF9tZXNzYWdlIjogY2xpZW50X21lc3NhZ2UsCiAgICAgICAgICAgICAgICAidGltZXN0YW1wIjogaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiBzZWxmLl9zYWZlX3B1Ymxpc2goImRuZHZpbmEvY2xpZW50L3Rhc2tfcmVwb3J0IiwganNvbi5kdW1wcyhyZXBvcnRfZGF0YSkpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGfhu61pIGLDoW8gY8OhbyB0YXNrIHt0YXNrX2lkfSB24bubaSB0cuG6oW5nIHRow6FpIHtzdGF0dXN9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4butaSBiw6FvIGPDoW8gdGFzazoge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgc2VuZF9jb25uZWN0X25vdGlmaWNhdGlvbihzZWxmKToKICAgICAgICAiIiJH4butaSB0aMO0bmcgYsOhbyBr4bq/dCBu4buRaSDEkeG6v24gc2VydmVyIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb25uZWN0X2RhdGEgPSB7CiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogc2VsZi5kZXZpY2VfaWQsCiAgICAgICAgICAgICAgICAidGltZXN0YW1wIjogaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiBzZWxmLl9zYWZlX3B1Ymxpc2goImRuZHZpbmEvY2xpZW50L2Nvbm5lY3QiLCBqc29uLmR1bXBzKGNvbm5lY3RfZGF0YSkpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpIGNobyB0aGnhur90IGLhu4sge3NlbGYuZGV2aWNlX2lkfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7rWkgdGjDtG5nIGLDoW8ga+G6v3QgbuG7kWk6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIHJlZ2lzdGVyX3Rhc2tfaGFuZGxlcihzZWxmLCB0YXNrX3R5cGU6IHN0ciwgaGFuZGxlcjogQ2FsbGFibGUpOgogICAgICAgICIiIgogICAgICAgIMSQxINuZyBrw70gaGFuZGxlciBjaG8gbG/huqFpIHRhc2sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX3R5cGU6IExv4bqhaSB0YXNrCiAgICAgICAgICAgIGhhbmRsZXI6IEjDoG0geOG7rSBsw70gdGFzawogICAgICAgICIiIgogICAgICAgIHNlbGYudGFza19oYW5kbGVyc1t0YXNrX3R5cGVdID0gaGFuZGxlcgogICAgCiAgICBkZWYgc3luY19kYXRhKHNlbGYpOgogICAgICAgICIiIsSQ4buTbmcgYuG7mSBk4buvIGxp4buHdSB24bubaSBzZXJ2ZXIiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTuG6v3UgY2jGsGEga+G6v3QgbuG7kWkgTVFUVCwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mQogICAgICAgICAgICBpZiBub3Qgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ2jGsGEga+G6v3QgbuG7kWkgTVFUVCwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGhlbHBlciBzZXJ2aWNlCiAgICAgICAgICAgIGhlbHBlciA9IHNlbGYuaGVscGVyX3NlcnZpY2UKICAgICAgICAgICAgaWYgbm90IGhlbHBlcjoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIGPDsyBoZWxwZXIgc2VydmljZSwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZAogICAgICAgICAgICBkZXZpY2VfaWQgPSBzZWxmLmRiLmdldF9vcl9jcmVhdGVfZGV2aWNlX2lkKCkKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pZDoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCBkZXZpY2VfaWQsIGtow7RuZyB0aOG7gyDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IE5vbmUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGV2aWNlX2luZm9fcmVzcG9uc2UgPSBoZWxwZXIuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBs4bqleSB0aMOgbmggY8O0bmcsIGzGsHUgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICAgICAgaWYgZGV2aWNlX2luZm9fcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvX3Jlc3BvbnNlOgogICAgICAgICAgICAgICAgICAgICMgTMawdSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iyB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zYXZlX2RldmljZV9pbmZvKGRldmljZV9pbmZvX3Jlc3BvbnNlWyJkYXRhIl0pCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBkZXZpY2VfaW5mb19yZXNwb25zZVsiZGF0YSJdCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBs4bqleSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7izoge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYyB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iywgc+G7rSBk4bulbmcgdGjDtG5nIHRpbiDEkcOjIGzGsHUgdHJvbmcgZGF0YWJhc2UKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmRiLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgdGjDtG5nIHRpbiB0aGnhur90IGLhu4ssIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSBjw7MgdGjhu4Mga2jDtG5nIMSR4bqneSDEkeG7pyIpCiAgICAgICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAgICAgZGV2aWNlX2NvbmZpZyA9IHNlbGYuZGIuZ2V0X2FsbF9kZXZpY2VfY29uZmlnKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7mXAgY8OhYyB0cuG6oW5nIHRow6FpIHJ1bnRpbWUgKHBhdXNlX2pvYiwgZGV2aWNlX2lzX3dvcmtpbmcsIGRldmljZV9tZXNzYWdlKSB2w6BvIGRldmljZV9pbmZvCiAgICAgICAgICAgIGZvciBydW50aW1lX2tleSBpbiBbInBhdXNlX2pvYiIsICJkZXZpY2VfaXNfd29ya2luZyIsICJkZXZpY2VfbWVzc2FnZSJdOgogICAgICAgICAgICAgICAgaWYgcnVudGltZV9rZXkgaW4gZGV2aWNlX2NvbmZpZzoKICAgICAgICAgICAgICAgICAgICBkZXZpY2VfaW5mb1tydW50aW1lX2tleV0gPSBkZXZpY2VfY29uZmlnLnBvcChydW50aW1lX2tleSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBHacOhIHRy4buLIG3hurdjIMSR4buLbmggbuG6v3UgY2jGsGEgY+G6pXUgaMOsbmgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VfaW5mb1tydW50aW1lX2tleV0gPSBGYWxzZSBpZiBydW50aW1lX2tleSAhPSAiZGV2aWNlX21lc3NhZ2UiIGVsc2UgIiIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTG/huqFpIGLhu48gZ29saWtlX3JlcG9ydCBraOG7j2kgZGV2aWNlX2NvbmZpZyDEkeG7gyBn4butaSByacOqbmcKICAgICAgICAgICAgZ29saWtlX3JlcG9ydCA9IE5vbmUKICAgICAgICAgICAgaWYgImdvbGlrZV9yZXBvcnQiIGluIGRldmljZV9jb25maWc6CiAgICAgICAgICAgICAgICBnb2xpa2VfcmVwb3J0ID0gZGV2aWNlX2NvbmZpZy5wb3AoImdvbGlrZV9yZXBvcnQiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBnb2xpa2VfYXBpX2Jhc2Uga2jhu49pIGRldmljZV9jb25maWcKICAgICAgICAgICAgaWYgImdvbGlrZV9hcGlfYmFzZSIgaW4gZGV2aWNlX2NvbmZpZzoKICAgICAgICAgICAgICAgIGRldmljZV9jb25maWcucG9wKCJnb2xpa2VfYXBpX2Jhc2UiKQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCLEkMOjIGxv4bqhaSBi4buPIGdvbGlrZV9hcGlfYmFzZSBraOG7j2kgZOG7ryBsaeG7h3UgxJHhu5NuZyBi4buZIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGPDoWMgdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICAgICBwZW5kaW5nX2FjY291bnRzID0gc2VsZi5kYi5nZXRfcGVuZGluZ19zeW5jX2l0ZW1zKCJhY2NvdW50cyIsIGxpbWl0PTUwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBjw6FjIGpvYiBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgcGVuZGluZ19qb2JzID0gc2VsZi5kYi5nZXRfcGVuZGluZ19zeW5jX2l0ZW1zKCJqb2JzX2hpc3RvcnkiLCBsaW1pdD01MCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHBheWxvYWQKICAgICAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiBkZXZpY2VfaWQsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2luZm8iOiBkZXZpY2VfaW5mbywKICAgICAgICAgICAgICAgICJkZXZpY2VfY29uZmlnIjogZGV2aWNlX2NvbmZpZywKICAgICAgICAgICAgICAgICJ0aW1lc3RhbXAiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gZ29saWtlX3JlcG9ydCBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgZ29saWtlX3JlcG9ydDoKICAgICAgICAgICAgICAgIHBheWxvYWRbImdvbGlrZV9yZXBvcnQiXSA9IGdvbGlrZV9yZXBvcnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIHTDoGkga2hv4bqjbiBjaMawYSDEkeG7k25nIGLhu5kgbuG6v3UgY8OzCiAgICAgICAgICAgIGlmIHBlbmRpbmdfYWNjb3VudHM6CiAgICAgICAgICAgICAgICBwYXlsb2FkWyJhY2NvdW50cyJdID0gcGVuZGluZ19hY2NvdW50cwogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkOG7k25nIGLhu5kge2xlbihwZW5kaW5nX2FjY291bnRzKX0gdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBqb2IgY2jGsGEgxJHhu5NuZyBi4buZIG7hur91IGPDswogICAgICAgICAgICBpZiBwZW5kaW5nX2pvYnM6CiAgICAgICAgICAgICAgICBwYXlsb2FkWyJqb2JzIl0gPSBwZW5kaW5nX2pvYnMKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDhu5NuZyBi4buZIHtsZW4ocGVuZGluZ19qb2JzKX0gam9iIGNoxrBhIMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBH4butaSBk4buvIGxp4buHdQogICAgICAgICAgICBzZWxmLl9zYWZlX3B1Ymxpc2goY29uZmlnLk1RVFRfVE9QSUNfQ0xJRU5UX1NZTkMsIGpzb24uZHVtcHMocGF5bG9hZCkpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSB24bubaSBzZXJ2ZXIiKQogICAgCiAgICBkZWYgc3RhcnRfc3luY190aHJlYWQoc2VsZik6CiAgICAgICAgIiIiQuG6r3QgxJHhuqd1IHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIiIiCiAgICAgICAgaWYgc2VsZi5zeW5jX3RocmVhZCBpcyBub3QgTm9uZSBhbmQgc2VsZi5zeW5jX3RocmVhZC5pc19hbGl2ZSgpOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiVGhyZWFkIMSR4buTbmcgYuG7mSDEkcOjIMSRYW5nIGNo4bqheSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBzZWxmLnJ1bm5pbmcgPSBUcnVlCiAgICAgICAgc2VsZi5zdG9wX2V2ZW50LmNsZWFyKCkKICAgICAgICBzZWxmLnN5bmNfdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5fc3luY19sb29wLCBkYWVtb249VHJ1ZSkKICAgICAgICBzZWxmLnN5bmNfdGhyZWFkLnN0YXJ0KCkKICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBraOG7n2kgxJHhu5luZyB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIpCiAgICAKICAgIGRlZiBfc3luY19sb29wKHNlbGYpOgogICAgICAgICIiIkxvb3AgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIiIgogICAgICAgIGxvZ2dlci5pbmZvKGYiQuG6r3QgxJHhuqd1IMSR4buTbmcgYuG7mSB04buxIMSR4buZbmcgbeG7l2kge3NlbGYuc3luY19pbnRlcnZhbH0gZ2nDonkiKQoKICAgICAgICB3aGlsZSBub3Qgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpIGFuZCBzZWxmLnJ1bm5pbmc6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc3luY19kYXRhKCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgdHJvbmcgcXXDoSB0csOsbmggxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZzoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmdo4buJIMSR4bq/biBs4bqnbiDEkeG7k25nIGLhu5kgdGnhur9wIHRoZW8KICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2Uoc2VsZi5zeW5jX2ludGVydmFsKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuc3RvcF9ldmVudC5pc19zZXQoKSBvciBub3Qgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAKICAgIGRlZiBzdG9wX3N5bmNfdGhyZWFkKHNlbGYpOgogICAgICAgICIiIkThu6tuZyB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIiIgogICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgc2VsZi5zdG9wX2V2ZW50LnNldCgpCiAgICAgICAgaWYgc2VsZi5zeW5jX3RocmVhZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5zeW5jX3RocmVhZC5qb2luKHRpbWVvdXQ9Mi4wKQogICAgICAgICAgICBzZWxmLnN5bmNfdGhyZWFkID0gTm9uZQogICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGThu6tuZyB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIpCiAgICAKICAgIGRlZiBkaXNjb25uZWN0KHNlbGYpOgogICAgICAgICIiIk5n4bqvdCBr4bq/dCBu4buRaSBNUVRUIiIiCiAgICAgICAgc2VsZi5zdG9wX3N5bmNfdGhyZWFkKCkKICAgICAgICAKICAgICAgICBpZiBzZWxmLmNsaWVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5jbGllbnQubG9vcF9zdG9wKCkKICAgICAgICAgICAgc2VsZi5jbGllbnQuZGlzY29ubmVjdCgpCiAgICAgICAgICAgIHNlbGYuaXNfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mgbmfhuq90IGvhur90IG7hu5FpIE1RVFQiKQogICAgCiAgICBkZWYgc2V0dXBfbXF0dF9oYW5kbGVycyhzZWxmKToKICAgICAgICAiIiJUaGnhur90IGzhuq1wIGPDoWMgaGFuZGxlciBjaG8gTVFUVCB0YXNrcyIiIgogICAgICAgICMgxJDEg25nIGvDvSBjw6FjIHRhc2sgaGFuZGxlciBt4bq3YyDEkeG7i25oCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoInVwZGF0ZV9jb25maWciLCBzZWxmLl9oYW5kbGVfdXBkYXRlX2RldmljZV9jb25maWcpCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoInVwZGF0ZV9zeW5jZWQiLCBzZWxmLl9oYW5kbGVfdXBkYXRlX3N5bmNlZCkKICAgICAgICBzZWxmLnJlZ2lzdGVyX3Rhc2tfaGFuZGxlcigiYWNjb3VudF91cGRhdGUiLCBzZWxmLl9oYW5kbGVfYWNjb3VudF91cGRhdGUpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgdGhp4bq/dCBs4bqtcCBjw6FjIE1RVFQgdGFzayBoYW5kbGVyIikKICAgICAgICAKICAgIGRlZiBfaGFuZGxlX3VwZGF0ZV9kZXZpY2VfY29uZmlnKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza19kYXRhOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXNrX2lkID0gdGFza19kYXRhLmdldCgidGFza19pZCIpCiAgICAgICAgICAgIGRldmljZV9pZCA9IHRhc2tfZGF0YS5nZXQoImRldmljZV9pZCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5o4bqtbiB5w6p1IGPhuqd1IGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICBjb25maWdfZGF0YSA9IHRhc2tfZGF0YS5nZXQoImNvbmZpZ19kYXRhIiwge30pCiAgICAgICAgICAgIGlmIG5vdCBjb25maWdfZGF0YToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJE4buvIGxp4buHdSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgcuG7l25nIikKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCAiROG7ryBsaeG7h3UgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLIHLhu5duZyIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSB04burbmcgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLmRiLnNhdmVfZGV2aWNlX2NvbmZpZyhjb25maWdfZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7izogeycsICcuam9pbihjb25maWdfZGF0YS5rZXlzKCkpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHN5bmNfaW50ZXJ2YWwgbuG6v3UgbsOzIHRoYXkgxJHhu5VpCiAgICAgICAgICAgICAgICBpZiAic3luY19pbnRlcnZhbCIgaW4gY29uZmlnX2RhdGE6CiAgICAgICAgICAgICAgICAgICAgbmV3X3N5bmNfaW50ZXJ2YWwgPSBjb25maWdfZGF0YVsic3luY19pbnRlcnZhbCJdCiAgICAgICAgICAgICAgICAgICAgaWYgbmV3X3N5bmNfaW50ZXJ2YWwgIT0gc2VsZi5zeW5jX2ludGVydmFsOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIkPhuq1wIG5o4bqtdCBzeW5jX2ludGVydmFsIHThu6sge3NlbGYuc3luY19pbnRlcnZhbH0gdGjDoG5oIHtuZXdfc3luY19pbnRlcnZhbH0iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN5bmNfaW50ZXJ2YWwgPSBuZXdfc3luY19pbnRlcnZhbAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaOG7n2kgxJHhu5luZyBs4bqhaSB0aHJlYWQgxJHhu5NuZyBi4buZIG7hur91IMSRYW5nIGNo4bqheQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnN5bmNfdGhyZWFkIGlzIG5vdCBOb25lIGFuZCBzZWxmLnN5bmNfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiS2jhu59pIMSR4buZbmcgbOG6oWkgdGhyZWFkIMSR4buTbmcgYuG7mSB24bubaSBraG/huqNuZyB0aOG7nWkgZ2lhbiBt4bubaSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN0b3Bfc3luY190aHJlYWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zdGFydF9zeW5jX3RocmVhZCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjDtG5nIGLDoW8gY2hvIEpvYlNlcnZpY2UgbuG6v3UgY8OzIHRoYXkgxJHhu5VpIGxpw6puIHF1YW4gxJHhur9uIGpvYnMKICAgICAgICAgICAgICAgIGpvYl9yZWxhdGVkX2tleXMgPSBbIm1heF9qb2JzX3Blcl9kYXkiLCAibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCAiam9iX2ludGVydmFsX3NlY29uZHMiLCJjYXJlX2luX3dvcmtpbmdfam9iIl0KICAgICAgICAgICAgICAgIGlmIGFueShrZXkgaW4gY29uZmlnX2RhdGEgZm9yIGtleSBpbiBqb2JfcmVsYXRlZF9rZXlzKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiw4FwIGThu6VuZyBj4bqldSBow6xuaCBt4bubaSBjaG8gSm9iU2VydmljZSIpCiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgY+G6p24ga2jhu59pIMSR4buZbmcgbOG6oWksIEpvYlNlcnZpY2Ugc+G6vSBs4bqleSBj4bqldSBow6xuaCBt4bubaSBraGkgY+G6p24KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBH4butaSBiw6FvIGPDoW8gdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAic3VjY2VzcyIsIGYixJDDoyBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLOiB7JywgJy5qb2luKGNvbmZpZ19kYXRhLmtleXMoKSl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gIktow7RuZyB0aOG7gyBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLIgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSB44butIGzDvSBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLOiB7c3RyKGUpfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQoKICAgIGRlZiBfaGFuZGxlX3VwZGF0ZV9zeW5jZWQoc2VsZiwgdGFza19kYXRhKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfZGF0YTogROG7ryBsaeG7h3UgdGFzayB04burIHNlcnZlcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk5o4bqtbiB5w6p1IGPhuqd1IGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mSB04burIHNlcnZlciIpCiAgICAgICAgICAgIGRhdGEgPSB0YXNrX2RhdGEuZ2V0KCJkYXRhIiwge30pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQw6FuaCBk4bqldSB0w6BpIGtob+G6o24gxJHDoyDEkeG7k25nIGLhu5kKICAgICAgICAgICAgaWYgImFjY291bnRzIiBpbiBkYXRhIGFuZCBpc2luc3RhbmNlKGRhdGFbImFjY291bnRzIl0sIGxpc3QpOgogICAgICAgICAgICAgICAgZm9yIGFjY291bnRfdXVpZCBpbiBkYXRhWyJhY2NvdW50cyJdOgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIubWFya19hc19zeW5jZWQoImFjY291bnRzIiwgYWNjb3VudF91dWlkKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIsSQw6FuaCBk4bqldSB0w6BpIGtob+G6o24gxJHDoyDEkeG7k25nIGLhu5k6IHthY2NvdW50X3V1aWR9IikKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQge2xlbihkYXRhWydhY2NvdW50cyddKX0gdMOgaSBraG/huqNuIMSRw6MgxJHhu5NuZyBi4buZIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IGpvYiDEkcOjIMSR4buTbmcgYuG7mQogICAgICAgICAgICBpZiAiam9icyIgaW4gZGF0YSBhbmQgaXNpbnN0YW5jZShkYXRhWyJqb2JzIl0sIGxpc3QpOgogICAgICAgICAgICAgICAgZm9yIGpvYl91dWlkIGluIGRhdGFbImpvYnMiXToKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLm1hcmtfYXNfc3luY2VkKCJqb2JzX2hpc3RvcnkiLCBqb2JfdXVpZCkKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkMOhbmggZOG6pXUgam9iIMSRw6MgxJHhu5NuZyBi4buZOiB7am9iX3V1aWR9IikKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQge2xlbihkYXRhWydqb2JzJ10pfSBqb2IgxJHDoyDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBIaeG7g24gdGjhu4sgdGjDtG5nIGLDoW8gdOG7qyBzZXJ2ZXIgbuG6v3UgY8OzCiAgICAgICAgICAgIGlmICJtZXNzYWdlIiBpbiB0YXNrX2RhdGE6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlRow7RuZyBiw6FvIHThu6sgc2VydmVyOiB7dGFza19kYXRhWydtZXNzYWdlJ119IikKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgeOG7rSBsw70gY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIAogICAgCiAgICBkZWYgX2hhbmRsZV9hY2NvdW50X3VwZGF0ZShzZWxmLCB0YXNrX2RhdGEpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgY+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza19kYXRhOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyIGPDsyBj4bqldSB0csO6YzoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInRhc2tfaWQiOiAidGFza18xNzQ5Mzk5NTM2MjcyXzY0MSIsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogImExMjVmNjI0ZjQxYTRmN2MiLAogICAgICAgICAgICAgICAgInRhc2tfdHlwZSI6ICJhY2NvdW50X3VwZGF0ZSIsCiAgICAgICAgICAgICAgICAiZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAiYXBwIjogImluc3RhZ3JhbSIsCiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJpbmFjdGl2ZSIsCiAgICAgICAgICAgICAgICAgICAgImpvYl9tYXhfZGF5IjogMTA4LAogICAgICAgICAgICAgICAgICAgICJqb2JfdG9kYXkiOiAzMCwKICAgICAgICAgICAgICAgICAgICAiam9iX2VuYWJsZSI6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgImFjY291bnRfdXVpZCI6ICI3ZWQ5NTU3ZC03NmE0LTQ3ZjctODg1MC03Y2VlZjBjNjkwYWYiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiAiIiwKICAgICAgICAgICAgICAgICJzdGF0dXMiOiAicGVuZGluZyIKICAgICAgICAgICAgfQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gecOqdSBj4bqndSBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHThu6sgc2VydmVyICh0YXNrX2lkOiB7dGFza19pZH0pIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBkYXRhIG9yICJhY2NvdW50X3V1aWQiIG5vdCBpbiBkYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkThu68gbGnhu4d1IHTDoGkga2hv4bqjbiBraMO0bmcgaOG7o3AgbOG7hyIpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgIkThu68gbGnhu4d1IHTDoGkga2hv4bqjbiBraMO0bmcgaOG7o3AgbOG7hyIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHTDoGkga2hv4bqjbiB04burIERCCiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50X2J5X3V1aWQoZGF0YVsiYWNjb3VudF91dWlkIl0pCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHbhu5tpIFVVSUQ6IHtkYXRhWydhY2NvdW50X3V1aWQnXX0iCiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7fQogICAgICAgICAgICB2YWxpZF9maWVsZHMgPSBbInN0YXR1cyIsICJqb2JfbWF4X2RheSIsICJtYXhfam9ic19wZXJfc2Vzc2lvbiIsICJqb2JfZW5hYmxlIiwiam9iX2Rpc2FibGVfdW50aWwiLCJtYXhfZm9sbG93X3Nlc3Npb24iLCJtYXhfZm9sbG93X2RheSIsImRpc2FibGVfZm9sbG93Il0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGRhdGEuaXRlbXMoKToKICAgICAgICAgICAgICAgIGlmIGtleSBpbiB2YWxpZF9maWVsZHM6CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGFba2V5XSA9IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCB1cGRhdGVfZGF0YToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJLaMO0bmcgY8OzIHRow7RuZyB0aW4gY+G6p24gY+G6rXAgbmjhuq10IikKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCAiS2jDtG5nIGPDsyB0aMO0bmcgdGluIGPhuqduIGPhuq1wIG5o4bqtdCIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IGzhuqFpIHbDoG8gREIKICAgICAgICAgICAgdXBkYXRlX2RhdGFbImlzX3N5bmMiXSA9IEZhbHNlCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHVwZGF0ZV9kYXRhKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJycpfSAoVVVJRDoge2RhdGFbJ2FjY291bnRfdXVpZCddfSkgduG7m2kgZOG7ryBsaeG7h3U6IHt1cGRhdGVfZGF0YX0iKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBmIsSQw6MgY+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICcnKX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdGjhu4MgY+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICcnKX0iCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSB44butIGzDvSBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuOiB7c3RyKGUpfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBraOG7n2kgxJHhu5luZyB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUaGnhur90IGzhuq1wIGPDoWMgaGFuZGxlciB0csaw4bubYyBraGkga+G6v3QgbuG7kWkKICAgICAgICAgICAgc2VsZi5zZXR1cF9tcXR0X2hhbmRsZXJzKCkKICAgICAgICAgICAgc2VsZi5jb25uZWN0KCkKICAgICAgICAgICAgIyBLaOG7n2kgxJHhu5luZyBzeW5jIHRocmVhZCBzYXUga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZwogICAgICAgICAgICBzZWxmLnN0YXJ0X3N5bmNfdGhyZWFkKCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlIHbDoCDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraOG7n2kgxJHhu5luZyBNUVRUIHNlcnZpY2UiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX29uX21lc3NhZ2Uoc2VsZiwgY2xpZW50LCB1c2VyZGF0YSwgbXNnLCBwcm9wZXJ0aWVzPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIENhbGxiYWNrIGtoaSBuaOG6rW4gxJHGsOG7o2MgbWVzc2FnZSB04burIE1RVFQgYnJva2VyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY2xpZW50OiBNUVRUIGNsaWVudCBpbnN0YW5jZQogICAgICAgICAgICB1c2VyZGF0YTogVXNlciBkYXRhIMSRxrDhu6NjIHRydXnhu4FuIHbDoG8gY2xpZW50CiAgICAgICAgICAgIG1zZzogTWVzc2FnZSBvYmplY3QgY2jhu6lhIHRvcGljIHbDoCBwYXlsb2FkCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFByb3BlcnRpZXMgY+G7p2EgbWVzc2FnZSAoTVFUVCB2NSkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIG1lc3NhZ2UgdOG7qyB0b3BpYzoge21zZy50b3BpY30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBQYXJzZSBwYXlsb2FkIEpTT04KICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcGF5bG9hZCA9IGpzb24ubG9hZHMobXNnLnBheWxvYWQuZGVjb2RlKCd1dGYtOCcpKQogICAgICAgICAgICBleGNlcHQganNvbi5KU09ORGVjb2RlRXJyb3I6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgcGFyc2UgSlNPTiB04burIHBheWxvYWQ6IHttc2cucGF5bG9hZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFjhu60gbMO9IG1lc3NhZ2UgZOG7sWEgdHLDqm4gdG9waWMKICAgICAgICAgICAgaWYgbXNnLnRvcGljID09IHNlbGYudG9waWNfc2VydmVyX3Rhc2s6CiAgICAgICAgICAgICAgICBzZWxmLl9oYW5kbGVfc2VydmVyX3Rhc2socGF5bG9hZCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTmjhuq1uIG1lc3NhZ2UgdOG7qyB0b3BpYyBraMO0bmcgeMOhYyDEkeG7i25oOiB7bXNnLnRvcGljfSIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHjhu60gbMO9IG1lc3NhZ2U6IHtzdHIoZSl9IikKCiAgICBkZWYgX2hhbmRsZV9zZXJ2ZXJfdGFzayhzZWxmLCBwYXlsb2FkOiBEaWN0W3N0ciwgQW55XSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayB04burIHNlcnZlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBheWxvYWQ6IEThu68gbGnhu4d1IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRhc2tfdHlwZSA9IHBheWxvYWQuZ2V0KCJ0YXNrX3R5cGUiKQogICAgICAgICAgICBpZiBub3QgdGFza190eXBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk5o4bqtbiB0YXNrIGtow7RuZyBjw7MgdGFza190eXBlIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gdGFzayB04burIHNlcnZlcjoge3Rhc2tfdHlwZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBoYW5kbGVyIHTGsMahbmcg4bupbmcgbuG6v3UgxJHDoyDEkcSDbmcga8O9CiAgICAgICAgICAgIGlmIHRhc2tfdHlwZSBpbiBzZWxmLnRhc2tfaGFuZGxlcnM6CiAgICAgICAgICAgICAgICBzZWxmLnRhc2tfaGFuZGxlcnNbdGFza190eXBlXShwYXlsb2FkKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgaGFuZGxlciBjaG8gdGFza190eXBlOiB7dGFza190eXBlfSIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgeOG7rSBsw70gdGFzayB04burIHNlcnZlcjoge3N0cihlKX0iKQ==').decode('utf-8'))
