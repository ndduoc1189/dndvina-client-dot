import base64
exec(base64.b64decode('aW1wb3J0IGRhdGV0aW1lCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IG9zCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIExpc3QsIE9wdGlvbmFsCmZyb20gam9icy5qb2JfYmFzZSBpbXBvcnQgQmFzZUpvYgoKY2xhc3MgSW5zdGFncmFtSm9iKEJhc2VKb2IpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZSkKICAgICAgICBzZWxmLmFwcF9wYWNrYWdlID0gImNvbS5pbnN0YWdyYW0uYW5kcm9pZCIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gImluc3RhZ3JhbSIKICAgICAgICAKICAgIGRlZiBkdW1wX3NjcmVlbl93aXRoX3JldHJ5KHNlbGYsIG1heF9yZXRyaWVzPTMsIHdhaXRfYmV0d2Vlbl9yZXRyaWVzPTAuNSk6CiAgICAgICAgIiIiCiAgICAgICAgRHVtcCBtw6BuIGjDrG5oIFhNTCB24bubaSBjxqEgY2jhur8gdGjhu60gbOG6oWkgbuG6v3UgZ+G6t3AgbOG7l2kKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtYXhfcmV0cmllczogU+G7kSBs4bqnbiB0aOG7rSB04buRaSDEkWEKICAgICAgICAgICAgd2FpdF9iZXR3ZWVuX3JldHJpZXM6IFRo4budaSBnaWFuIGNo4budIGdp4buvYSBjw6FjIGzhuqduIHRo4butIChnacOieSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBYTUwgY+G7p2EgbcOgbiBow6xuaCBob+G6t2MgTm9uZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfcmV0cmllcyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgxJDhu6NpIFVJIOG7lW4gxJHhu4tuaAogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhaXRfYmV0d2Vlbl9yZXRyaWVzKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICByZXR1cm4gc2NyZWVuX3htbAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIGR1bXAgWE1MIChs4bqnbiB7YXR0ZW1wdCsxfS97bWF4X3JldHJpZXN9KToge3N0cihlKX0iKQogICAgICAgICAgICAgICAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBjaG8gbOG6p24gdGjhu60gdGnhur9wIHRoZW8KICAgICAgICAgICAgICAgIHdhaXRfYmV0d2Vlbl9yZXRyaWVzICs9IDAuNQogICAgICAgICAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgZHVtcCBYTUwgc2F1IHttYXhfcmV0cmllc30gbOG6p24gdGjhu60iKQogICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICBkZWYgaXNfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcg4bufIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgSW5zdGFncmFtIGhheSBraMO0bmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRYW5nIOG7nyB0cmFuZyBjaOG7pywgRmFsc2UgbuG6v3Uga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgcGFja2FnZSBoaeG7h24gdOG6oWkgdHLGsOG7m2MgdGnDqm4KICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IFhNTCBtw6BuIGjDrG5oIGhp4buHbiB04bqhaSB24bubaSBjxqEgY2jhur8gdGjhu60gbOG6oWkKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgMTogQ8OzIG7DunQgIlRyYW5nIGNo4bunIiDEkcaw4bujYyBjaOG7jW4gKHNlbGVjdGVkPXRydWUpIHRyb25nIHRoYW5oIHRhYiBraMO0bmcKICAgICAgICAgICAgaG9tZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIgogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIGhvbWVfdGFiOgogICAgICAgICAgICAgICAgaWYgc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChob21lX3RhYik6CiAgICAgICAgICAgICAgICAgICAgbG9nb19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC90aXRsZV9sb2dvX2NoZXZyb25fY29udGFpbmVyIgogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgaWYgbG9nb19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxvZ29fYnV0dG9uLmdldCgidmlzaWJsZS10by11c2VyIikgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICAjIE7hur91IHTDrG0gdGjhuqV5IHRhYiAiVHJhbmcgY2jhu6ciIG5oxrBuZyBjaMawYSDEkcaw4bujYyBjaOG7jW4sIGNsaWNrIHbDoG8gxJHDswogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihob21lX3RhYikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDEuNXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIE7hur91IHTDrG0gdGjhuqV5IHRhYiAiVHJhbmcgY2jhu6ciIG5oxrBuZyBjaMawYSDEkcaw4bujYyBjaOG7jW4sIGNsaWNrIHbDoG8gxJHDswogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihob21lX3RhYikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDEuNXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAjIEtow7RuZyB0w6xtIHRo4bqleSBjw6FjIHnhur91IHThu5EgY+G7p2EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkga2nhu4NtIHRyYSBtw6BuIGjDrG5oIHRyYW5nIGNo4bunIEluc3RhZ3JhbSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBlbnN1cmVfaG9tZV9zY3JlZW4oc2VsZiwgbWF4X3JldHJpZXM6IGludCA9IDMpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyBtw6BuIGjDrG5oIHRyYW5nIGNo4bunIEluc3RhZ3JhbSwgbuG6v3Uga2jDtG5nIHRow6wga2jhu59pIMSR4buZbmcgbOG6oWkgYXBwCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbWF4X3JldHJpZXM6IFPhu5EgbOG6p24gdGjhu60gdOG7kWkgxJFhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKCgogICAgICAgIHJldHJ5X2NvdW50ID0gMAogICAgICAgIAogICAgICAgIHdoaWxlIHJldHJ5X2NvdW50IDwgbWF4X3JldHJpZXM6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIMSRYW5nIOG7nyB0cmFuZyBjaOG7pyBraMO0bmcKICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyDhu58gdHJhbmcgY2jhu6csIMSRw7NuZyB2w6AgbeG7nyBs4bqhaSBhcHAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIHBo4bqjaSB0cmFuZyBjaOG7pyBJbnN0YWdyYW0sIGto4bufaSDEkeG7mW5nIGzhuqFpIGFwcC4uLiIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcChzZWxmLmFwcF9wYWNrYWdlKQoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHNhZmVfc2xlZXAgcmV0dXJuIHZhbHVlIMSR4buDIGPDsyB0aOG7gyB0aG/DoXQgc+G7m20ga2hpIGPhuqduIHJlc3RhcnQgc2Vzc2lvbgogICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDIpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTmjhuq1uIMSRxrDhu6NjIHnDqnUgY+G6p3UgZOG7q25nIHRyb25nIHF1w6EgdHLDrG5oIGVuc3VyZV9ob21lX3NjcmVlbiIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcChzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHNhZmVfc2xlZXAgcmV0dXJuIHZhbHVlIMSR4buDIGPDsyB0aOG7gyB0aG/DoXQgc+G7m20ga2hpIGPhuqduIHJlc3RhcnQgc2Vzc2lvbiAgCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoNSk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJOaOG6rW4gxJHGsOG7o2MgecOqdSBj4bqndSBk4burbmcgdHJvbmcgcXXDoSB0csOsbmggZW5zdXJlX2hvbWVfc2NyZWVuIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnZhbGlkYXRlX2FwcF9ub3RfYmFubmVkKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgcmV0cnlfY291bnQgKz0gMQogICAgICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBt4bufIHRyYW5nIGNo4bunIEluc3RhZ3JhbSBzYXUge21heF9yZXRyaWVzfSBs4bqnbiB0aOG7rSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB2YWxpZGF0ZV9hcHBfbm90X2Jhbm5lZChzZWxmKToKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28ga2jDtG5nIGPDsyB0w6BpIGtob+G6o24gbsOgbyBi4buLIGJhbm5lZAogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIHRleHQgIlRyYW5nIG7DoHkgaGnhu4duIGtow7RuZyBoaeG7g24gdGjhu4siCiAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcGFnZV9ub3RfYXZhaWxhYmxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgdGV4dD0iVHJhbmcgbsOgeSBoaeG7h24ga2jDtG5nIGhp4buDbiB0aOG7iyIKICAgICAgICApCgogICAgICAgIGlmIHBhZ2Vfbm90X2F2YWlsYWJsZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiUGjDoXQgaGnhu4duIHRyYW5nIGtow7RuZyBoaeG7g24gdGjhu4ssIMSRYW5nIHJlc2V0IHByb3h5IHbDoCBsw6BtIG3hu5tpIikKICAgICAgICAgICAgIyBH4buNaSByZXNldF9jdXJyZW50X3Byb3h5IHRow7RuZyBxdWEgcHJveHlfc2VydmljZQogICAgICAgICAgICBpZiBzZWxmLnByb3h5X3NlcnZpY2U6CiAgICAgICAgICAgICAgICByZXNldF9zdWNjZXNzID0gc2VsZi5wcm94eV9zZXJ2aWNlLmZvcmNlX3Jlc2V0X2N1cnJlbnRfaXAoKQogICAgICAgICAgICAgICAgaWYgcmVzZXRfc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgc2FmZV9zbGVlcCByZXR1cm4gdmFsdWUgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoMik6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyB2YWxpZGF0ZV9hcHBfbm90X2Jhbm5lZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgYuG6pW0gdsOgbyBuw7p0ICJMw6BtIG3hu5tpIgogICAgICAgICAgICAgICAgICAgIHJlZnJlc2hfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dD0iTMOgbSBt4bubaSIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcmVmcmVzaF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihyZWZyZXNoX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHNhZmVfc2xlZXAgcmV0dXJuIHZhbHVlIMSR4buDIGPDsyB0aOG7gyB0aG/DoXQgc+G7m20KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgzKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyB2YWxpZGF0ZV9hcHBfbm90X2Jhbm5lZCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBi4bqlbSBuw7p0IGzDoG0gbeG7m2kgc2F1IGtoaSByZXNldCBwcm94eSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgJ0zDoG0gbeG7m2knIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIlJlc2V0IHByb3h5IHRo4bqldCBi4bqhaSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJQcm94eSBzZXJ2aWNlIGNoxrBhIMSRxrDhu6NjIHRoaeG6v3QgbOG6rXAiKQoKICAgICAgICAjIEtp4buDbSB0cmEgZGlhbG9nIGPhuqNuaCBiw6FvCiAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgYWxlcnRfY29udGFpbmVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9pZ2RzX2FsZXJ0X2RpYWxvZ190ZXh0X2NvbnRhaW5lciIKICAgICAgICApCiAgICAgICAgCiAgICAgICAgI0tp4buDbSB0cmEgY8OzIHRow7RuZyBiw6FvIHRo4bupIGzhuqFpIHNhdS4KICAgICAgICBpZiBhbGVydF9jb250YWluZXI6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0acOqdSDEkeG7gSBkaWFsb2cKICAgICAgICAgICAgaGVhZGxpbmUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvaWdkc19hbGVydF9kaWFsb2dfaGVhZGxpbmUiCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGhlYWRsaW5lIGFuZCBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KGhlYWRsaW5lKSA9PSAiVGjhu60gbOG6oWkgc2F1IjoKICAgICAgICAgICAgICAgICMgTOG6pXkgbuG7mWkgZHVuZyBj4bqjbmggYsOhbwogICAgICAgICAgICAgICAgc3VidGV4dCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2lnZHNfYWxlcnRfZGlhbG9nX3N1YnRleHQiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHN1YnRleHQ6CiAgICAgICAgICAgICAgICAgICAgd2FybmluZ19tZXNzYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dChzdWJ0ZXh0KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCBj4bqjbmggYsOhbyBoaeG7h24gdOG6oWkgdOG7qyBkYgogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfd2FybmluZ3MgPSBzZWxmLmRiLmdldCgibG9ncy13YXJuaW5nLW1lc3NhZ2UiLCBbXSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRow6ptIGPhuqNuaCBiw6FvIG3hu5tpCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF93YXJuaW5ncy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAidGltZSI6IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLmlzb2Zvcm1hdCgpLAogICAgICAgICAgICAgICAgICAgICAgICAibWVzcyI6IHdhcm5pbmdfbWVzc2FnZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBDaOG7iSBnaeG7ryBs4bqhaSB04buRaSDEkWEgMjAgbG9nIGfhuqduIG5o4bqldAogICAgICAgICAgICAgICAgICAgIGlmIGxlbihjdXJyZW50X3dhcm5pbmdzKSA+IDIwOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dhcm5pbmdzID0gY3VycmVudF93YXJuaW5nc1stMjA6XQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTMawdSBs4bqhaSB2w6BvIGRiCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImxvZ3Mtd2FybmluZy1tZXNzYWdlIiwgY3VycmVudF93YXJuaW5ncykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYixJDDoyBsxrB1IGPhuqNuaCBiw6FvOiB7d2FybmluZ19tZXNzYWdlfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBC4bqlbSBuw7p0IE9LIGxpw6puIHThu6VjIGNobyDEkeG6v24ga2hpIGtow7RuZyBjw7JuIGRpYWxvZwogICAgICAgICAgICAgICAgICAgIHNlbGYuX2Rpc21pc3NfYWxsX2RpYWxvZ3MoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgIAogICAgICAgICNLaeG7g20gdHJhIHhlbSBjw7MgdGjDtG5nIGLDoW8gcGjhuqNpIMSRxINuZyBuaOG6rXAga2jDtG5nCiAgICAgICAgIyBLaeG7g20gdHJhIGNvbnRhaW5lciBibG9rcwogICAgICAgIGJsb2tzX2NvbnRhaW5lciA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYmxva3NfY29udGFpbmVyIgogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiBibG9rc19jb250YWluZXI6CiAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIGPDoWMgdmlldyB0cm9uZyBjb250YWluZXIKICAgICAgICAgICAgdmlld3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXciCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdmlldyDEkeG6p3UgdGnDqm4gY8OzIHRleHQga2jDoWMgbnVsbAogICAgICAgICAgICB3YXJuaW5nX3RleHQgPSBOb25lCiAgICAgICAgICAgIGZvciB2aWV3IGluIHZpZXdzOgogICAgICAgICAgICAgICAgdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodmlldykKICAgICAgICAgICAgICAgIGlmIHRleHQgYW5kIHRleHQuc3RyaXAoKSBhbmQgdGV4dCAhPSAibnVsbCIgYW5kIHRleHQgIT0gIiAiIGFuZCBsZW4odGV4dC5zdHJpcCgpKSA+IDEwOgogICAgICAgICAgICAgICAgICAgIHdhcm5pbmdfdGV4dCA9IHRleHQKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgd2FybmluZ190ZXh0OiAKICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBsb2dvdXQgdsOgIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgQsaw4bubYyAxOiBC4bqlbSB2w6BvIG1lbnUKICAgICAgICAgICAgICAgICAgICBtZW51X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJNZW51IikKICAgICAgICAgICAgICAgICAgICBpZiBtZW51X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG1lbnVfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQsaw4bubYyAyOiDEkOG7jWMgbOG6oWkgWE1MIHbDoCB0w6xtIHRleHQgIsSQxINuZyB4deG6pXQga2jhu49pIgogICAgICAgICAgICAgICAgICAgICAgICBtZW51X3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1lbnVfeG1sOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwobWVudV94bWwsIGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nb3V0X3ZpZXcgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHZpZXcgaW4gdmlld3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld190ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh2aWV3KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHZpZXdfdGV4dCBhbmQgdmlld190ZXh0LnN0YXJ0c3dpdGgoIsSQxINuZyB4deG6pXQga2jhu49pIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ291dF92aWV3ID0gdmlldwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq90IGLhu48gIsSQxINuZyB4deG6pXQga2jhu49pIiB2w6AgdHJpbSDEkeG7gyBs4bqleSB1c2VybmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHZpZXdfdGV4dC5yZXBsYWNlKCLEkMSDbmcgeHXhuqV0IGto4buPaSIsICIiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxvZ291dF92aWV3IGFuZCB1c2VybmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIELGsOG7m2MgMzogQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgYWNjb3VudCB0cm9uZyBkYXRhYmFzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlZC8lbS8leSAlSDolTSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5hY3RpdmVfcmVhc29uID0gZiJQaMOhdCBoaeG7h24gecOqdSBj4bqndSB4w6FjIG1pbmggbMO6Yzoge2N1cnJlbnRfdGltZX0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHTDoGkga2hv4bqjbiB0aGVvIHVuaXF1ZV91c2VybmFtZSB2w6AgY+G6rXAgbmjhuq10CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9Imluc3RhZ3JhbSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gYWNjb3VudHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKSA9PSB1c2VybmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAibG9nb3V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogaW5hY3RpdmVfcmVhc29uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYixJDDoyBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfToge2luYWN0aXZlX3JlYXNvbn0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIELGsOG7m2MgNDogQuG6pW0gdsOgbyAixJDEg25nIHh14bqldCBraOG7j2kiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGxvZ291dF92aWV3KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQsaw4bubYyA1OiBYw6FjIG5o4bqtbiDEkcSDbmcgeHXhuqV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybV94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvbmZpcm1feG1sOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtX3htbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ9IsSQxINuZyB4deG6pXQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29uZmlybV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoY29uZmlybV9idXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDUpICAjIENo4budIDUgZ2nDonkgaG/DoG4gdOG6pXQgbG9nb3V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgxJHEg25nIHh14bqldCBraOG7j2kgdMOgaSBraG/huqNuIHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbWVudSDEkcSDbmcgeHXhuqV0IikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgxJHhu41jIFhNTCBtZW51IikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgTWVudSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gbG9nb3V0OiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAgICAgIyBGYWxsYmFjazogxJHDs25nIGFwcCBu4bq/dSBraMO0bmcgbG9nb3V0IMSRxrDhu6NjCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKHNlbGYuYXBwX3BhY2thZ2UpCgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgcmV0dXJuIFRydWUKICAgIAogICAgZGVmIGdldF9hY2NvdW50c19mcm9tX2RldmljZShzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiJM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0gdOG7qyB0aGnhur90IGLhu4siIiIKICAgICAgICBhY2NvdW50cyA9IFtdCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cgSW5zdGFncmFtCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6pW4gdsOgbyB0YWIgIlRyYW5nIGPDoSBuaMOibiIKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIHByb2ZpbGVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlRyYW5nIGPDoSBuaMOibiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcHJvZmlsZV90YWI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiBUcmFuZyBjw6EgbmjDom4iKQogICAgICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6pXAgdsOgbyB0YWIgVHJhbmcgY8OhIG5ow6JuCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihwcm9maWxlX3RhYikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gdMOgaSBraG/huqNuIGhp4buHbiB04bqhaSB04burIHRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB1c2VybmFtZSB04burIHRpw6p1IMSR4buBIGzhu5tuIHRyb25nIGFjdGlvbiBiYXIKICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfbGFyZ2VfdGl0bGVfYXV0b19zaXplIgogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHVzZXJuYW1lX3RpdGxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl90aXRsZSIKICAgICAgICAgICAgKQogICAgICAgICAgICBpZiBub3QgdXNlcm5hbWVfdGl0bGU6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX2Rvd24oKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX2Rvd24oKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIHVzZXJuYW1lX3RpdGxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfbGFyZ2VfdGl0bGVfYXV0b19zaXplIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgdXNlcm5hbWVfdGl0bGU6CiAgICAgICAgICAgICAgICBjdXJyZW50X3VzZXJuYW1lID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh1c2VybmFtZV90aXRsZSkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB1c2VybmFtZSBoaeG7h24gdOG6oWkgdOG7qyB0acOqdSDEkeG7gToge2N1cnJlbnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOaOG6pXAgdsOgbyB0acOqdSDEkeG7gSB1c2VybmFtZSDEkeG7gyBt4bufIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIodXNlcm5hbWVfdGl0bGUpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiAtIMSR4buNYyBs4bqnbiAxCiAgICAgICAgICAgICAgICBhY2NvdW50c194bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHBo4bqnbiB04butIFZpZXdHcm91cCBjw7MgY29udGVudC1kZXNjIChsw6AgdXNlcm5hbWUpCiAgICAgICAgICAgICAgICBhY2NvdW50X2l0ZW1zID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgIGFjY291bnRzX3htbCwKICAgICAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLnZpZXcuVmlld0dyb3VwIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IHTDoGkga2hv4bqjbiBs4bqnbiAxCiAgICAgICAgICAgICAgICBzZWxmLl9wcm9jZXNzX2FjY291bnRfaXRlbXMoYWNjb3VudF9pdGVtcywgYWNjb3VudHNfeG1sLCBhY2NvdW50cykKCiAgICAgICAgICAgICAgICAjIE7hur91IGPDsyBuaGnhu4F1IGjGoW4gNiB0w6BpIGtob+G6o24sIHZ14buRdCBsw6puIHbDoCDEkeG7jWMgdGnhur9wCiAgICAgICAgICAgICAgICBpZiBsZW4oYWNjb3VudHMpID4gNjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkge2xlbihhY2NvdW50cyl9IHTDoGkga2hv4bqjbiwgdnXhu5F0IGzDqm4gxJHhu4MgdMOsbSB0aMOqbSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gbOG6p24gMiBzYXUga2hpIHZ14buRdAogICAgICAgICAgICAgICAgICAgIGFjY291bnRzX3htbF8yID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgICAgICBhY2NvdW50X2l0ZW1zXzIgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRzX3htbF8yLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLnZpZXcuVmlld0dyb3VwIgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFjhu60gbMO9IHTDoGkga2hv4bqjbiBs4bqnbiAyCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudHNfYmVmb3JlXzJuZCA9IGxlbihhY2NvdW50cykKICAgICAgICAgICAgICAgICAgICBzZWxmLl9wcm9jZXNzX2FjY291bnRfaXRlbXMoYWNjb3VudF9pdGVtc18yLCBhY2NvdW50c194bWxfMiwgYWNjb3VudHMpCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudHNfYWRkZWQgPSBsZW4oYWNjb3VudHMpIC0gYWNjb3VudHNfYmVmb3JlXzJuZAogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJM4bqnbiDEkeG7jWMgdGjhu6kgMiB0w6xtIHRow6ptIHthY2NvdW50c19hZGRlZH0gdMOgaSBraG/huqNuIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkNo4buJIGPDsyB7bGVuKGFjY291bnRzKX0gdMOgaSBraG/huqNuLCBraMO0bmcgY+G6p24gdnXhu5F0IHRow6ptIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOaOG6pW4gYmFjayDEkeG7gyDEkcOzbmcgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFF1YXkgbOG6oWkgdHJhbmcgY2jhu6cgYuG6sW5nIHBoxrDGoW5nIHRo4bupYyBiYWNrX3RvX2hvbWUKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0iKQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gYWNjb3VudHMKICAgIAogICAgZGVmIF9wcm9jZXNzX2FjY291bnRfaXRlbXMoc2VsZiwgYWNjb3VudF9pdGVtczogTGlzdCwgYWNjb3VudHNfeG1sOiBzdHIsIGFjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSkgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSBkYW5oIHPDoWNoIGFjY291bnQgaXRlbXMgdsOgIHRow6ptIHbDoG8gYWNjb3VudHMgbGlzdAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnRfaXRlbXM6IERhbmggc8OhY2ggVmlld0dyb3VwIGVsZW1lbnRzCiAgICAgICAgICAgIGFjY291bnRzX3htbDogWE1MIGPhu6dhIG3DoG4gaMOsbmggY2jhu6lhIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgIGFjY291bnRzOiBMaXN0IMSR4buDIHRow6ptIHTDoGkga2hv4bqjbiB2w6BvCiAgICAgICAgIiIiCiAgICAgICAgIyBU4bqhbyBzZXQgxJHhu4MgdHLDoW5oIGR1cGxpY2F0ZSB1c2VybmFtZQogICAgICAgIGV4aXN0aW5nX3VzZXJuYW1lcyA9IHthY2MuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiLCAiIikubG93ZXIoKSBmb3IgYWNjIGluIGFjY291bnRzfQogICAgICAgIAogICAgICAgICMgTOG7jWMgdsOgIHjhu60gbMO9IGPDoWMgbeG7pWMgdMOgaSBraG/huqNuCiAgICAgICAgZm9yIGl0ZW0gaW4gYWNjb3VudF9pdGVtczoKICAgICAgICAgICAgIyBM4bqleSBjb250ZW50LWRlc2MgY+G7p2EgaXRlbQogICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBpdGVtLmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgIGlmIG5vdCBjb250ZW50X2Rlc2Mgb3IgY29udGVudF9kZXNjID09ICJudWxsIjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOieSBjw7MgcGjhuqNpIGzDoCBuw7p0ICLEkGkgxJHhur9uIFRydW5nIHTDom0gdMOgaSBraG/huqNuIiBraMO0bmcKICAgICAgICAgICAgaWYgIlRydW5nIHTDom0gdMOgaSBraG/huqNuIiBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQuG7jyBxdWEgbsO6dCAiVGjDqm0gdMOgaSBraG/huqNuIiAKICAgICAgICAgICAgaWYgIlRow6ptIHTDoGkga2hv4bqjbiIgaW4gY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgWOG7rSBsw70gdHLGsOG7nW5nIGjhu6NwIGPDsyB0aMO0bmcgYsOhbyB0cm9uZyBjb250ZW50LWRlc2MgKHZkOiAidXNlcm5hbWUsIDEwIHRow7RuZyBiw6FvIikKICAgICAgICAgICAgdXNlcm5hbWUgPSBjb250ZW50X2Rlc2MKICAgICAgICAgICAgaWYgIiwiIGluIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gY29udGVudF9kZXNjLnNwbGl0KCIsIilbMF0uc3RyaXAoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBQaMawxqFuZyBwaMOhcCAyOiBUw6xtIHRy4buxYyB0aeG6v3AgdHJvbmcgY8OhYyB2aWV3IGNvbgogICAgICAgICAgICBjaGlsZF92aWV3cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgICAgIGFjY291bnRzX3htbCwKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3IgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGJvdW5kcyBj4bunYSBpdGVtIGhp4buHbiB04bqhaSDEkeG7gyB0w6xtIHZpZXcgY29uIHRodeG7mWMgduG7gSBuw7MKICAgICAgICAgICAgaXRlbV9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoaXRlbSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciB2aWV3IGluIGNoaWxkX3ZpZXdzOgogICAgICAgICAgICAgICAgdmlld19ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHModmlldykKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdmlldyBjw7MgbuG6sW0gdHJvbmcgaXRlbSBraMO0bmcKICAgICAgICAgICAgICAgIGlmICh2aWV3X2JvdW5kc1swXSA+PSBpdGVtX2JvdW5kc1swXSBhbmQgCiAgICAgICAgICAgICAgICAgICAgdmlld19ib3VuZHNbMV0gPj0gaXRlbV9ib3VuZHNbMV0gYW5kIAogICAgICAgICAgICAgICAgICAgIHZpZXdfYm91bmRzWzJdIDw9IGl0ZW1fYm91bmRzWzJdIGFuZCAKICAgICAgICAgICAgICAgICAgICB2aWV3X2JvdW5kc1szXSA8PSBpdGVtX2JvdW5kc1szXSk6CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdmlld190ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh2aWV3KQogICAgICAgICAgICAgICAgICAgIGlmIHZpZXdfdGV4dCBhbmQgInRow7RuZyBiw6FvIiBub3QgaW4gdmlld190ZXh0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSB0aOG6pXkgdmlldyBjb24gY2jhu6lhIHTDqm4gdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gdmlld190ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgZHVwbGljYXRlIHVzZXJuYW1lCiAgICAgICAgICAgIGlmIHVzZXJuYW1lLmxvd2VyKCkgaW4gZXhpc3RpbmdfdXNlcm5hbWVzOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiBuw6B5IGPDsyDEkWFuZyDEkcaw4bujYyBjaOG7jW4ga2jDtG5nCiAgICAgICAgICAgIGlzX3NlbGVjdGVkID0gaXRlbS5nZXQoInNlbGVjdGVkIikgPT0gInRydWUiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGFjY291bnQgPSB7CiAgICAgICAgICAgICAgICAibmlja25hbWUiOiAiIiwKICAgICAgICAgICAgICAgICJ1bmlxdWVfdXNlcm5hbWUiOiB1c2VybmFtZSwKICAgICAgICAgICAgICAgICJ1bmlxdWVfaWQiOiAiIiwKICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiYWN0aXZlIiwKICAgICAgICAgICAgICAgICJpc19sb2dpbiI6IGlzX3NlbGVjdGVkLAogICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6ICIiLAogICAgICAgICAgICAgICAgImpvYl9lbmFibGUiOiBUcnVlLAogICAgICAgICAgICAgICAgImxldmVsIjogMywKICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKGFjY291bnQpCiAgICAgICAgICAgIGV4aXN0aW5nX3VzZXJuYW1lcy5hZGQodXNlcm5hbWUubG93ZXIoKSkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIEluc3RhZ3JhbToge3VzZXJuYW1lfSAoc2VsZWN0ZWQ6IHtpc19zZWxlY3RlZH0pIikKICAgIAogICAgZGVmIF9kaXNtaXNzX2FsbF9kaWFsb2dzKHNlbGYsIG1heF9hdHRlbXB0czogaW50ID0gNSkgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBC4bqlbSBuw7p0IE9LIGxpw6puIHThu6VjIGNobyDEkeG6v24ga2hpIGtow7RuZyBjw7JuIGRpYWxvZyBuw6BvCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbWF4X2F0dGVtcHRzOiBT4buRIGzhuqduIHRo4butIHThu5FpIMSRYQogICAgICAgICIiIgogICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKG1heF9hdHRlbXB0cyk6CiAgICAgICAgICAgICMgTOG6pXkgbOG6oWkgWE1MIMSR4buDIHTDrG0gbsO6dCBPSwogICAgICAgICAgICBjdXJyZW50X3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIGlmIG5vdCBjdXJyZW50X3htbDoKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgb2tfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgIGN1cnJlbnRfeG1sLAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9pZ2RzX2FsZXJ0X2RpYWxvZ19wcmltYXJ5X2J1dHRvbiIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgb2tfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG9rX2J1dHRvbikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgYuG6pW0gT0sgbOG6p24ge2F0dGVtcHQgKyAxfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEtow7RuZyBjw7JuIG7DunQgT0ssIHRob8OhdCB2w7JuZyBs4bq3cAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyDEkcOzbmcgaOG6v3QgZGlhbG9nIikKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAKICAgIGRlZiBiYWNrX3RvX2hvbWUoc2VsZiwgbWF4X2JhY2tfY291bnQ6IGludCA9IDUsIG1heF9yZXRyaWVzOiBpbnQgPSAxKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFF1YXkgbOG6oWkgbcOgbiBow6xuaCB0cmFuZyBjaOG7pyBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtYXhfYmFja19jb3VudDogU+G7kSBs4bqnbiBuaOG6pW4gQmFjayB04buRaSDEkWEgdHLGsOG7m2Mga2hpIHRo4butIGto4bufaSDEkeG7mW5nIGzhuqFpIGFwcAogICAgICAgICAgICBtYXhfcmV0cmllczogU+G7kSBs4bqnbiB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAgdOG7kWkgxJFhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6Mg4bufIHRyYW5nIGNo4bunIGNoxrBhCiAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkGFuZyB0w6xtIGPDoWNoIHF1YXkgduG7gSB0cmFuZyBjaOG7pyBJbnN0YWdyYW0uLi4iKQogICAgICAgIAogICAgICAgICMgVGjhu60gbOG6oWkgdG/DoG4gYuG7mSBxdcOhIHRyw6xuaCB04buRaSDEkWEgbWF4X3JldHJpZXMgbOG6p24KICAgICAgICBmb3IgcmV0cnkgaW4gcmFuZ2UobWF4X3JldHJpZXMpOgogICAgICAgICAgICAjIFRo4butIGLhuqVtIG7DunQgYmFjayB04buRaSDEkWEgbWF4X2JhY2tfY291bnQgbOG6p24KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobWF4X2JhY2tfY291bnQpOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBzYWZlX3NsZWVwIHJldHVybiB2YWx1ZSDEkeG7gyBjw7MgdGjhu4MgdGhvw6F0IHPhu5ttCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDEpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyBxdcOhIHRyw6xuaCBiYWNrX3RvX2hvbWUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6MgduG7gSB0cmFuZyBjaOG7pyBjaMawYQogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHF1YXkgduG7gSB0cmFuZyBjaOG7pyBzYXUge2krMX0gbOG6p24gYuG6pW0gYmFjayAobOG6p24gdGjhu60ge3JldHJ5KzF9KSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgduG6q24ga2jDtG5nIHbhu4EgxJHGsOG7o2MgdHJhbmcgY2jhu6csIGtpbGwgYXBwIHbDoCBt4bufIGzhuqFpCiAgICAgICAgICAgIGlmIHJldHJ5IDwgbWF4X3JldHJpZXMgLSAxOiAgIyBDaOG7iSBsb2cgY+G6o25oIGLDoW8gbuG6v3UgY8OybiBs4bqnbiB0aOG7rSB0aeG6v3AgdGhlbwogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIktow7RuZyB0aOG7gyB24buBIHRyYW5nIGNo4bunIHNhdSB7bWF4X2JhY2tfY291bnR9IGzhuqduIGLhuqVtIGJhY2ssIHRo4butIGto4bufaSDEkeG7mW5nIGzhuqFpIGFwcCAobOG6p24gdGjhu60ge3JldHJ5KzF9L3ttYXhfcmV0cmllc30pLi4uIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIHbhu4EgdHJhbmcgY2jhu6cgc2F1IHttYXhfYmFja19jb3VudH0gbOG6p24gYuG6pW0gYmFjayAobOG6p24gdGjhu60gY3Xhu5FpIHtyZXRyeSsxfS97bWF4X3JldHJpZXN9KS4uLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgc2FmZV9zbGVlcCByZXR1cm4gdmFsdWUgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbQogICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDIpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTmjhuq1uIMSRxrDhu6NjIHnDqnUgY+G6p3UgZOG7q25nIHRyb25nIHF1w6EgdHLDrG5oIGJhY2tfdG9faG9tZSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcChzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHNhZmVfc2xlZXAgcmV0dXJuIHZhbHVlIMSR4buDIGPDsyB0aOG7gyB0aG/DoXQgc+G7m20gIAogICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDUpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTmjhuq1uIMSRxrDhu6NjIHnDqnUgY+G6p3UgZOG7q25nIHRyb25nIHF1w6EgdHLDrG5oIGJhY2tfdG9faG9tZSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnZhbGlkYXRlX2FwcF9ub3RfYmFubmVkKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB4ZW0gY8OzIOG7nyB0cmFuZyBjaOG7pyBraMO0bmcKICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgcXVheSB24buBIHRyYW5nIGNo4bunIHNhdSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgYXBwIChs4bqnbiB0aOG7rSB7cmV0cnkrMX0pIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgduG7gSB0cmFuZyBjaOG7pyBuZ2F5IGPhuqMgc2F1IHttYXhfcmV0cmllc30gbOG6p24gdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgYXBwIikKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgCgogICAgCiAgICBkZWYgbWFwX2dvbGlrZV9hY2NvdW50cyhzZWxmLCBnb2xpa2VfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dLCBkZXZpY2VfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICDDgW5oIHjhuqEgdMOgaSBraG/huqNuIHThu6sgR29MaWtlIHbDoG8gdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGdvbGlrZV9hY2NvdW50czogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdOG7qyBHb0xpa2UgQVBJCiAgICAgICAgICAgIGRldmljZV9hY2NvdW50czogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdHLDqm4gdGhp4bq/dCBi4buLCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiDEkcOjIMOhbmggeOG6oQogICAgICAgICIiIgogICAgICAgIG1hcHBlZF9hY2NvdW50cyA9IFtdCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIENodeG6qW4gaMOzYSBk4buvIGxp4buHdSB04burIEdvTGlrZQogICAgICAgICAgICBnb2xpa2VfZGF0YSA9IHt9CiAgICAgICAgICAgIGZvciBhY2MgaW4gZ29saWtlX2FjY291bnRzOgogICAgICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IHRow7RuZyB0aW4gdOG7qyB0w6BpIGtob+G6o24gR29MaWtlCiAgICAgICAgICAgICAgICBnb2xpa2VfYWNjb3VudCA9IHsKICAgICAgICAgICAgICAgICAgICAiZ29saWtlX2lkIjogYWNjLmdldCgiaWQiKSwKICAgICAgICAgICAgICAgICAgICAibmlja25hbWUiOiBhY2MuZ2V0KCJpbnN0YWdyYW1fZnVsbF9uYW1lIikgb3IgYWNjLmdldCgiaW5zdGFncmFtX3VzZXJuYW1lIiksCiAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV9pZCI6IGFjYy5nZXQoImluc3RhZ3JhbV9pZCIpLAogICAgICAgICAgICAgICAgICAgICJ1bmlxdWVfdXNlcm5hbWUiOiBhY2MuZ2V0KCJpbnN0YWdyYW1fdXNlcm5hbWUiKSwKICAgICAgICAgICAgICAgICAgICAiYXZhdGFyX3RodW1iIjogYWNjLmdldCgicHJvZmlsZV9waWNfdXJsIikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBT4butIGThu6VuZyB1bmlxdWVfdXNlcm5hbWUgbMOgbSBraMOzYSDEkeG7gyBk4buFIMOhbmggeOG6oQogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBnb2xpa2VfYWNjb3VudFsidW5pcXVlX3VzZXJuYW1lIl0KICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgIGdvbGlrZV9kYXRhW3VzZXJuYW1lLmxvd2VyKCldID0gZ29saWtlX2FjY291bnQKICAgICAgICAgICAgCiAgICAgICAgICAgICMgw4FuaCB44bqhIHbhu5tpIHTDoGkga2hv4bqjbiB0csOqbiB0aGnhur90IGLhu4sKICAgICAgICAgICAgZm9yIGRldmljZV9hY2NvdW50IGluIGRldmljZV9hY2NvdW50czoKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gZGV2aWNlX2FjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiLCAiIikubG93ZXIoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB1c2VybmFtZSBpbiBnb2xpa2VfZGF0YToKICAgICAgICAgICAgICAgICAgICAjIMSQw6MgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHRyb25nIGRhbmggc8OhY2ggR29MaWtlCiAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiB04burIEdvTGlrZSB2w6BvIHTDoGkga2hv4bqjbiB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgICAgICBnb2xpa2VfaW5mbyA9IGdvbGlrZV9kYXRhW3VzZXJuYW1lXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4KICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImdvbGlrZV9pZCI6IGdvbGlrZV9pbmZvWyJnb2xpa2VfaWQiXSwKICAgICAgICAgICAgICAgICAgICAgICAgImlzX2dvbGlrZV9saW5rZWQiOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAiYXZhdGFyX3RodW1iIjogZ29saWtlX2luZm9bImF2YXRhcl90aHVtYiJdIG9yIGRldmljZV9hY2NvdW50LmdldCgiYXZhdGFyX3RodW1iIiwgIiIpLAogICAgICAgICAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogZ29saWtlX2luZm9bInVuaXF1ZV9pZCJdIG9yIGRldmljZV9hY2NvdW50LmdldCgidW5pcXVlX2lkIiwgIiIpLAogICAgICAgICAgICAgICAgICAgICAgICAibmlja25hbWUiOiBnb2xpa2VfaW5mb1sibmlja25hbWUiXSBvciBkZXZpY2VfYWNjb3VudC5nZXQoIm5pY2tuYW1lIiwgIiIpLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSBJRCB0w6BpIGtob+G6o24gdHJvbmcgREIKICAgICAgICAgICAgICAgICAgICBhY2NvdW50X2lkID0gZGV2aWNlX2FjY291bnQuZ2V0KCJpZCIpCiAgICAgICAgICAgICAgICAgICAgaWYgYWNjb3VudF9pZDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdsOgbyBEQgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRfaWQsIHVwZGF0ZV9kYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiB2w6BvIGRldmljZV9hY2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZV9hY2NvdW50LnVwZGF0ZSh1cGRhdGVfZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGVkX2FjY291bnRzLmFwcGVuZChkZXZpY2VfYWNjb3VudCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIMOhbmggeOG6oSB0w6BpIGtob+G6o24gSW5zdGFncmFtOiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBtYXBwZWRfYWNjb3VudHMKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgw6FuaCB44bqhIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0iKQogICAgICAgICAgICByZXR1cm4gW10KICAgIGRlZiBnZXRfcmVwb3J0X3BheWxvYWQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFThuqFvIHBheWxvYWQgY2hvIHZp4buHYyBiw6FvIGPDoW8gaG/DoG4gdGjDoG5oIGpvYgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IFBheWxvYWQgY2hvIEFQSSBiw6FvIGPDoW8KICAgICAgICAiIiIKICAgICAgICBnb2xpa2VfaWQgPSBhY2NvdW50LmdldCgiZ29saWtlX2lkIikKICAgICAgICBqb2JfaWQgPSBqb2IuZ2V0KCJpZCIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IGdvbGlrZV9pZCBvciBub3Qgam9iX2lkOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiVGhp4bq/dSB0aMO0bmcgdGluIHTDoGkga2hv4bqjbiBob+G6t2Mgam9iIMSR4buDIHThuqFvIHBheWxvYWQgYsOhbyBjw6FvIikKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImluc3RhZ3JhbV91c2Vyc19hZHZlcnRpc2luZ19pZCI6IGpvYl9pZCwKICAgICAgICAgICAgImluc3RhZ3JhbV9hY2NvdW50X2lkIjogZ29saWtlX2lkLAogICAgICAgICAgICAiYXN5bmMiOiBUcnVlLAogICAgICAgICAgICAiZGF0YSI6IE5vbmUKICAgICAgICB9ICAgIAogICAgICAgICAgCiAgICAKICAgIAogICAgZGVmIGV4ZWN1dGVfam9iKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGpvYgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIHRo4buxYyBoaeG7h24gam9iLCBiYW8gZ+G7k206CiAgICAgICAgICAgICAgICAtIHN0YXR1cyAoaW50KTogTcOjIHRy4bqhbmcgdGjDoWkgam9iCiAgICAgICAgICAgICAgICAgICAgMDogQ2jGsGEgdGjhu7FjIGhp4buHbgogICAgICAgICAgICAgICAgICAgIDE6IFRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIDI6IFRo4bqldCBi4bqhaSwga2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZwogICAgICAgICAgICAgICAgICAgIDM6IFRo4bqldCBi4bqhaSwgxJHDoyBi4buLIHVuZm9sbG93L3VubGlrZQogICAgICAgICAgICAgICAgICAgIDQ6IFRo4bqldCBi4bqhaSwgecOqdSBj4bqndSDEkWFuZyBjaOG7nQogICAgICAgICAgICAgICAgLSBtZXNzYWdlIChzdHIpOiBUaMO0bmcgYsOhbyBr4bq/dCBxdeG6owogICAgICAgICAgICAgICAgLSBzdWNjZXNzIChib29sKTogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgam9iX3R5cGUgPSBqb2IuZ2V0KCJ0eXBlIiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgam9iX2xpbmsgPSBqb2IuZ2V0KCJsaW5rIiwgIiIpCiAgICAgICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkGFuZyB0aOG7sWMgaGnhu4duIGpvYiB7am9iX2lkfSBsb+G6oWkge2pvYl90eXBlfSB24bubaSBsaW5rIHtqb2JfbGlua30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGxv4bqhaSBqb2IgxJHGsOG7o2MgaOG7lyB0cuG7owogICAgICAgICAgICBpZiBqb2JfdHlwZSBub3QgaW4gWyJmb2xsb3ciLCAibGlrZSJdOgogICAgICAgICAgICAgICAgbWVzc2FnZSA9IGYiTG/huqFpIGpvYiB7am9iX3R5cGV9IGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujIgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhtZXNzYWdlKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogMiwKICAgICAgICAgICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGpvYiB0aGVvIGxv4bqhaQogICAgICAgICAgICBqb2Jfc3RhdHVzID0gMCAgIyBN4bq3YyDEkeG7i25oIGzDoCBjaMawYSBsw6BtCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBqb2JfdHlwZSA9PSAiZm9sbG93IjoKICAgICAgICAgICAgICAgIGpvYl9zdGF0dXMgPSBzZWxmLl9wZXJmb3JtX2ZvbGxvd19qb2Ioam9iX2xpbmspCiAgICAgICAgICAgIGVsaWYgam9iX3R5cGUgPT0gImxpa2UiOgogICAgICAgICAgICAgICAgam9iX3N0YXR1cyA9IHNlbGYuX3BlcmZvcm1fbGlrZV9qb2Ioam9iX2xpbmspCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIGvhur90IHF14bqjIHRy4bqjIHbhu4EgZOG7sWEgdHLDqm4gam9iX3N0YXR1cwogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHRfZnJvbV9zdGF0dXMoam9iX3N0YXR1cywgam9iX3R5cGUpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYjoge3N0cihlKX0iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMiwgbWVzc2FnZSwgRmFsc2UpCiAgICAKICAgIGRlZiBfY3JlYXRlX2pvYl9yZXN1bHRfZnJvbV9zdGF0dXMoc2VsZiwgam9iX3N0YXR1czogaW50LCBqb2JfdHlwZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBU4bqhbyBr4bq/dCBxdeG6oyBqb2IgdOG7qyBzdGF0dXMgY29kZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl9zdGF0dXM6IE3DoyB0cuG6oW5nIHRow6FpIGpvYiB04burIF9wZXJmb3JtX3h4eF9qb2IKICAgICAgICAgICAgam9iX3R5cGU6IExv4bqhaSBqb2IgKGZvbGxvdywgbGlrZSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIGpvYgogICAgICAgICIiIgogICAgICAgIGlmIGpvYl9zdGF0dXMgPT0gMTogICMgVGjDoG5oIGPDtG5nCiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIsSQw6MgaG/DoG4gdGjDoG5oIGpvYiB7am9iX3R5cGV9IHRow6BuaCBjw7RuZyIKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMSwgbWVzc2FnZSwgVHJ1ZSkKICAgICAgICBlbGlmIGpvYl9zdGF0dXMgPT0gMjogICMgS2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZwogICAgICAgICAgICBtZXNzYWdlID0gZiJLaMO0bmcgdGjhu4MgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nIMSR4buDIHRo4buxYyBoaeG7h24gam9iIHtqb2JfdHlwZX0iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDIsIG1lc3NhZ2UsIEZhbHNlKQogICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSAzOiAgIyBC4buLIHVuZm9sbG93L3VubGlrZQogICAgICAgICAgICBtZXNzYWdlID0gZiLEkMOjIGLhu4sgdW5mb2xsb3cvdW5saWtlIHRyb25nIGpvYiB7am9iX3R5cGV9IgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IHVuZm9sbG93IMSR4buDIEpvYlNlcnZpY2UgeOG7rSBsw70KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDMsIG1lc3NhZ2UsIEZhbHNlLCB1bmZvbGxvdz1UcnVlKQogICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSA0OiAgIyBZw6p1IGPhuqd1IMSRYW5nIGNo4budCiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIlnDqnUgY+G6p3UgxJFhbmcgY2jhu50gdHJvbmcgam9iIHtqb2JfdHlwZX0iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDQsIG1lc3NhZ2UsIEZhbHNlKQogICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSA1OiAgIyBH4butaSB5w6p1IGPhuqd1IGNo4budIGR1eeG7h3QKICAgICAgICAgICAgbWVzc2FnZSA9IGYiR+G7rWkgecOqdSBj4bqndSBjaOG7nSBkdXnhu4d0IHtqb2JfdHlwZX0iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDUsIG1lc3NhZ2UsIEZhbHNlKQogICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSA2OiAgIyDEkOG6oXQgZ2nhu5tpIGjhuqFuIGhv4bq3YyBi4buLIGtow7NhCiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIkpvYiB7am9iX3R5cGV9IGLhu4sgaOG7p3kgZG8gxJHhuqF0IGdp4bubaSBo4bqhbiBob+G6t2MgdMOgaSBraG/huqNuIGLhu4sga2jDs2EiCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8obWVzc2FnZSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDYsIG1lc3NhZ2UsIEZhbHNlKQogICAgICAgIGVsc2U6ICAjIFRy4bqhbmcgdGjDoWkga2jDtG5nIHjDoWMgxJHhu4tuaAogICAgICAgICAgICBtZXNzYWdlID0gZiJUcuG6oW5nIHRow6FpIGtow7RuZyB4w6FjIMSR4buLbmgga2hpIHRo4buxYyBoaeG7h24gam9iIHtqb2JfdHlwZX0gKHN0YXR1czoge2pvYl9zdGF0dXN9KSIKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IobWVzc2FnZSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDAsIG1lc3NhZ2UsIEZhbHNlKQogICAgCiAgICBkZWYgX3BlcmZvcm1fZm9sbG93X2pvYihzZWxmLCBwcm9maWxlX2xpbms6IHN0cikgLT4gaW50OgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gam9iIGZvbGxvdyB0csOqbiBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm9maWxlX2xpbms6IExpbmsgxJHhur9uIHRyYW5nIGPDoSBuaMOibiBj4bqnbiBmb2xsb3cKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgaW50OiBUcuG6oW5nIHRow6FpIGpvYiAoMDogY2jGsGEgbMOgbSwgMTogaG/DoG4gdGjDoG5oLCAyOiBs4buXaSwgMzogYuG7iyB1bmZvbGxvdykKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IHVzZXJuYW1lIHThu6sgVVJMCiAgICAgICAgICAgIGltcG9ydCByZQogICAgICAgICAgICBpbXBvcnQgcmFuZG9tCiAgICAgICAgICAgIHVzZXJuYW1lX21hdGNoID0gcmUuc2VhcmNoKHInaW5zdGFncmFtXC5jb20vKFteL10rKScsIHByb2ZpbGVfbGluaykKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX21hdGNoOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgdHLDrWNoIHh14bqldCB1c2VybmFtZSB04burIGxpbms6IHtwcm9maWxlX2xpbmt9IikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdXNlcm5hbWUgPSB1c2VybmFtZV9tYXRjaC5ncm91cCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBSYW5kb20gY2jhu41uIDEgdHJvbmcgMiBjw6FjaDogdMOsbSBraeG6v20gaG/hurdjIG3hu58gdHLhu7FjIHRp4bq/cCBsaW5rCiAgICAgICAgICAgIGlmIHJhbmRvbS5jaG9pY2UoW1RydWUsIEZhbHNlXSk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTeG7nyB0cmFuZyBjw6EgbmjDom4gYuG6sW5nIGPDoWNoIHTDrG0ga2nhur9tOiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgICMgQ8OhY2ggMTogVMOsbSBraeG6v20gdXNlcm5hbWUgKGPDoWNoIGPFqSkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIMSQw7NuZyBjw6FjIGRpYWxvZyBu4bq/dSBjw7MKICAgICAgICAgICAgICAgICAgICBkaWFsb2cgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJEaWFsb2ciKQogICAgICAgICAgICAgICAgICAgIGlmIGRpYWxvZzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUYXAgdsOgbyBraHUgduG7sWMgdHLhu5FuZyDEkeG7gyDEkcOzbmcgZGlhbG9nCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoLCBoZWlnaHQgPSBzZWxmLmhlbHBlci5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXAoaW50KHdpZHRoKjAuMiksIGludChoZWlnaHQqMC4yKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiAxLjVzCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBN4bufIHRyYW5nIHTDrG0ga2nhur9tIAogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGR1bXAgbcOgbiBow6xuaCwgdGjhu60gbeG7nyBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocHJvZmlsZV9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDRzCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlYXJjaF90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvc2VhcmNoX3RhYiIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfdGFiOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiBUw6xtIGtp4bq/bSwgdGjhu60gbeG7nyBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocHJvZmlsZV9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDRzCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWFyY2hfdGFiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDJzCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3NlYXJjaF90YWIiKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfdGFiIG9yIG5vdCBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKHNlYXJjaF90YWIpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX3RhYikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkgCgogICAgICAgICAgICAgICAgICAgICMgTmjhuqVuIHbDoG8gdGhhbmggdMOsbSBraeG6v20KICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmgga2hpIHTDrG0gw7Qgbmjhuq1wLCB0aOG7rSBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDQpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlYXJjaF9pbnB1dCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX3NlYXJjaF9lZGl0X3RleHQiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfaW5wdXQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWFyY2hfdGFiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkgCiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaF9pbnB1dCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfc2VhcmNoX2VkaXRfdGV4dCIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlYXJjaF9pbnB1dDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSDDtCBuaOG6rXAgdMOsbSBraeG6v20sIHRo4butIG3hu58gYuG6sW5nIGxpbmsgdHLhu7FjIHRp4bq/cCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFjDs2EgbuG7mWkgZHVuZyB0w6xtIGtp4bq/bSBoaeG7h24gdOG6oWkgbuG6v3UgY8OzCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF9pbnB1dCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTmjhuq1wIHVzZXJuYW1lIGPhuqduIHTDrG0gduG7m2kga8O9IHThu7EgQCBwaMOtYSB0csaw4bubYwogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmlucHV0X3RleHQoZiJ7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNSkgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiA1cyDEkeG7gyBr4bq/dCBxdeG6oyB0w6xtIGtp4bq/bSBoaeG7h24gxJHhuqd5IMSR4bunCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGvhur90IHF14bqjIHRoZW8gcmVzb3VyY2UtaWQgY+G7pSB0aOG7gwogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkgICMgVGhvw6F0IHTDrG0ga2nhur9tCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGR1bXAgbcOgbiBow6xuaCBr4bq/dCBxdeG6oyB0w6xtIGtp4bq/bSwgdGjhu60gbeG7nyBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocHJvZmlsZV9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB1c2VyX3Jlc3VsdCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9yb3dfc2VhcmNoX3VzZXJfdXNlcm5hbWUiKQogICAgICAgICAgICAgICAgICAgIGlmIHVzZXJfcmVzdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIodXNlcl9yZXN1bHQpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5IHRoZW8gcmVzb3VyY2UtaWQsIHRo4butIHTDrG0gdGhlbyBr4bq/dCBxdeG6oyB0aMO0bmcgdGjGsOG7nW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuTGluZWFyTGF5b3V0IikKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0X2ZvdW5kID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciByZXN1bHQgaW4gcmVzdWx0czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdF90ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dChyZXN1bHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB1c2VybmFtZS5sb3dlcigpIGluIHJlc3VsdF90ZXh0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHJlc3VsdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRfZm91bmQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlc3VsdF9mb3VuZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IHRyb25nIGvhur90IHF14bqjIHTDrG0ga2nhur9tIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgdMOsbSBraeG6v20gdMOgaSBraG/huqNuOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBjw7MgbOG7l2ksIHPhu60gZOG7pW5nIHBoxrDGoW5nIHRo4bupYyBt4bufIGxpbmsKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiA0cwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBDw6FjaCAyOiBN4bufIHRy4buxYyB0aeG6v3AgVVJMIHRow7RuZyBxdWEgaGVscGVyLm9wZW5fdXJsKCkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJN4bufIHRyYW5nIGPDoSBuaMOibiBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wOiB7cHJvZmlsZV9saW5rfSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDRzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4budIHRow6ptIGNobyB0cmFuZyBo4buTIHPGoSB04bqjaSB4b25nCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gbsO6dCBGb2xsb3cgdGhlbyByZXNvdXJjZS1pZCBjaMOtbmggeMOhYwogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGR1bXAgbcOgbiBow6xuaCBraGkgdMOsbSBuw7p0IGZvbGxvdyIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcHJvZmlsZV9oZWFkZXJfZm9sbG93X2J1dHRvbiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSB0aGVvIHJlc291cmNlLWlkLCB0aOG7rSB0w6xtIHRoZW8gdGV4dAogICAgICAgICAgICBpZiBub3QgZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IHRoZW8gZMO1aSB0aGVvIHJlc291cmNlLWlkLCB0aOG7rSB0w6xtIHRoZW8gdGV4dCIpCiAgICAgICAgICAgICAgICAjIFTDrG0gbsO6dCB0aGVvIHRleHQKICAgICAgICAgICAgICAgIGZvbGxvd190ZXh0cyA9IFsiVGhlbyBkw7VpIiwgIkZvbGxvdyIsICLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIiwgIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgdGV4dCBpbiBmb2xsb3dfdGV4dHM6CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD10ZXh0KQogICAgICAgICAgICAgICAgICAgIGlmIGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGzhuqFpIGzhuqduIG7hu69hIG7hur91IGtow7RuZyB0w6xtIHRo4bqleSBuw7p0IGZvbGxvdwogICAgICAgICAgICBpZiBub3QgZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IHRoZW8gZMO1aSDhu58gbOG6p24gxJHhuqd1LCB0aOG7rSB2deG7kXQgbcOgbiBow6xuaCB2w6AgdMOsbSBs4bqhaSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIGtoaSB0w6xtIGzhuqFpIG7DunQgZm9sbG93IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9wcm9maWxlX2hlYWRlcl9mb2xsb3dfYnV0dG9uIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIG7DunQgdGhlbyB0ZXh0CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X3RleHRzID0gWyJUaGVvIGTDtWkiLCAiRm9sbG93IiwgIsSQYW5nIHRoZW8gZMO1aSIsICJGb2xsb3dpbmciLCAixJDDoyB5w6p1IGPhuqd1IiwgIlJlcXVlc3RlZCJdCiAgICAgICAgICAgICAgICAgICAgZm9yIHRleHQgaW4gZm9sbG93X3RleHRzOgogICAgICAgICAgICAgICAgICAgICAgICBmb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgdGhlbyBkw7VpIHNhdSBuaGnhu4F1IGzhuqduIHRo4butIikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHRleHQgY+G7p2EgbsO6dAogICAgICAgICAgICBidXR0b25fdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoZm9sbG93X2J1dHRvbikKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlRleHQgY+G7p2EgbsO6dCBmb2xsb3c6IHtidXR0b25fdGV4dH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBsw6AgIsSQYW5nIHRoZW8gZMO1aSIgaG/hurdjICJGb2xsb3dpbmciIHRow6wgxJHDoyBmb2xsb3cgcuG7k2kKICAgICAgICAgICAgaWYgYnV0dG9uX3RleHQgaW4gWyLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIl06CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0aGVvIGTDtWkgdMOgaSBraG/huqNuIHt1c2VybmFtZX0gdOG7qyB0csaw4bubYyIpCiAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBsw6AgIsSQw6MgecOqdSBj4bqndSIgaG/hurdjICJSZXF1ZXN0ZWQiIHRow6wgxJHDoyB5w6p1IGPhuqd1IGZvbGxvdyBy4buTaQogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHnDqnUgY+G6p3UgdGhlbyBkw7VpIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IHThu6sgdHLGsOG7m2MiKQogICAgICAgICAgICAgICAgcmV0dXJuIDUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgbMOgICJUaGVvIGTDtWkiIGhv4bq3YyAiRm9sbG93IiB0aMOsIGNsaWNrIHbDoG8gbsO6dAogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIlRoZW8gZMO1aSIsICJGb2xsb3ciXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRo4buxYyBoaeG7h24gY2xpY2sgdsOgbyBuw7p0IHRoZW8gZMO1aSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZm9sbG93X2J1dHRvbikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDJzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIGRpYWxvZyBoaeG7h24gbMOqbiBraMO0bmcKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdGjhu4Mga2nhu4NtIHRyYSBkaWFsb2csIG5oxrBuZyBjw7MgdGjhu4MgxJHDoyB0aGVvIGTDtWkgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHRy4bqhbmcgdGjDoWkgbsO6dAogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkaWFsb2dfY29udGFpbmVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2RpYWxvZ19jb250YWluZXIiKQogICAgICAgICAgICAgICAgaWYgZGlhbG9nX2NvbnRhaW5lcjoKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyB0aMO0bmcgYsOhbyAiVGjhu60gbOG6oWkgc2F1IiBraMO0bmcKICAgICAgICAgICAgICAgICAgICByZXRyeV90ZXh0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJUaOG7rSBs4bqhaSBzYXUiKQogICAgICAgICAgICAgICAgICAgIGlmIHJldHJ5X3RleHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQuG6pW0gbsO6dCBPSyBsacOqbiB04bulYyBjaG8gxJHhur9uIGtoaSBraMO0bmcgY8OybiBkaWFsb2cKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fZGlzbWlzc19hbGxfZGlhbG9ncygpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIkpvYiBraMO0bmcgaG/DoG4gdGjDoG5oLCBi4buLIGdp4bubaSBo4bqhbiB0aGVvIGTDtWkgKHRo4butIGzhuqFpIHNhdSkiKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyB0aMO0bmcgYsOhbyAiWcOqdSBj4bqndSBj4bunYSBi4bqhbiDEkWFuZyBjaOG7nSIga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgd2FpdGluZ190ZXh0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJZw6p1IGPhuqd1IGPhu6dhIGLhuqFuIMSRYW5nIGNo4budIikKICAgICAgICAgICAgICAgICAgICBpZiB3YWl0aW5nX3RleHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQuG6pW0gbsO6dCBPSyBsacOqbiB04bulYyBjaG8gxJHhur9uIGtoaSBraMO0bmcgY8OybiBkaWFsb2cKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fZGlzbWlzc19hbGxfZGlhbG9ncygpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkhvw6BuIHRow6BuaCwgecOqdSBj4bqndSB0aGVvIGTDtWkgxJFhbmcgY2jhu50gZHV54buHdCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAzCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBsw6AgZGlhbG9nIGtow6FjLCBi4bqlbSBPSyBsacOqbiB04bulYwogICAgICAgICAgICAgICAgICAgIHNlbGYuX2Rpc21pc3NfYWxsX2RpYWxvZ3MoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBj4bqnbiB4w6FjIG5o4bqtbiB0aGVvIGTDtWkga2jDtG5nICh0w6BpIGtob+G6o24gcmnDqm5nIHTGsCkKICAgICAgICAgICAgICAgIGNvbmZpcm1fY29udGFpbmVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2xheW91dF9jb250YWluZXJfYm90dG9tX3NoZWV0IikKICAgICAgICAgICAgICAgIGlmIGNvbmZpcm1fY29udGFpbmVyOgogICAgICAgICAgICAgICAgICAgICMgVMOsbSBuw7p0ICJUaGVvIGTDtWkiIHRyb25nIGNvbnRhaW5lcgogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1fZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iVGhlbyBkw7VpIixjbGFzc19uYW1lPSJhbmRyb2lkLnZpZXcuVmlldyIpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNvbmZpcm1fZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybV9mb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJGb2xsb3ciLGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3IikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgY29uZmlybV9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoY29uZmlybV9mb2xsb3dfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHRleHQgc2F1IGtoaSBuaOG6pW4gdGhlbyBkw7VpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdGjhu4Mga2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIG7DunQsIG5oxrBuZyBjw7MgdGjhu4MgxJHDoyB0aGVvIGTDtWkgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdXBkYXRlZF9mb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Byb2ZpbGVfaGVhZGVyX2ZvbGxvd19idXR0b24iKQogICAgICAgICAgICAgICAgaWYgbm90IHVwZGF0ZWRfZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gbOG6oWkgdGhlbyB0ZXh0CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X3RleHRzID0gWyLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIiwgIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiLCAiVGhlbyBkw7VpIiwgIkZvbGxvdyJdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yIHRleHQgaW4gZm9sbG93X3RleHRzOgogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2ZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9dGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodXBkYXRlZF9mb2xsb3dfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw6FjIHRyxrDhu51uZyBo4bujcCBraMOhYyBuaGF1CiAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF90ZXh0IGluIFsixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyJdOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJGb2xsb3cgdGjDoG5oIGPDtG5nISIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgICAgICAgICAgZWxpZiB1cGRhdGVkX3RleHQgaW4gWyLEkMOjIHnDqnUgY+G6p3UiLCAiUmVxdWVzdGVkIl06CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgZ+G7rWkgecOqdSBj4bqndSB0aGVvIGTDtWkgdGjDoG5oIGPDtG5nISIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA1CiAgICAgICAgICAgICAgICAgICAgZWxpZiB1cGRhdGVkX3RleHQgaW4gWyJUaGVvIGTDtWkiLCAiRm9sbG93Il06CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyB0aMO0bmcgYsOhbyAiWcOqdSBj4bqndSBj4bunYSBi4bqhbiDEkWFuZyBjaOG7nSIga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdGjhu4Mga2nhu4NtIHRyYSB0aeG6v3AsIGdp4bqjIMSR4buLbmggbMOgIMSRw6MgZ+G7rWkgecOqdSBj4bqndSB0aGVvIGTDtWkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgd2FpdGluZ190ZXh0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJZw6p1IGPhuqd1IGPhu6dhIGLhuqFuIMSRYW5nIGNo4budIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgd2FpdGluZ190ZXh0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBC4bqlbSBuw7p0IE9LIGxpw6puIHThu6VjIGNobyDEkeG6v24ga2hpIGtow7RuZyBjw7JuIGRpYWxvZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fZGlzbWlzc19hbGxfZGlhbG9ncygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJIb8OgbiB0aMOgbmgsIHnDqnUgY+G6p3UgdGhlbyBkw7VpIMSRYW5nIGNo4budIGR1eeG7h3QiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIAoKIAoKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkZvbGxvdyBraMO0bmcgdGjDoG5oIGPDtG5nLCB0ZXh0IGPhu6dhIG7DunQgbMOgOiB7dXBkYXRlZF90ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQsIGPDsyB0aOG7gyDEkcOjIGZvbGxvdyB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBmb2xsb3cgc2F1IGtoaSBuaOG6pW4sIGdp4bqjIMSR4buLbmggxJHDoyB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlRleHQgY+G7p2EgbsO6dCBraMO0bmcga2jhu5twIHbhu5tpICdUaGVvIGTDtWknIGhv4bq3YyAnRm9sbG93Jzoge2J1dHRvbl90ZXh0fSIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBqb2IgZm9sbG93OiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiAyCiAgICAKICAgIGRlZiBfcGVyZm9ybV9saWtlX2pvYihzZWxmLCBwb3N0X2xpbms6IHN0cikgLT4gaW50OgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gam9iIGxpa2UgYsOgaSDEkcSDbmcgdHLDqm4gSW5zdGFncmFtCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcG9zdF9saW5rOiBMaW5rIMSR4bq/biBiw6BpIMSRxINuZyBj4bqnbiBsaWtlCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGludDogVHLhuqFuZyB0aMOhaSBqb2IgKDA6IGNoxrBhIGzDoG0sIDE6IGhvw6BuIHRow6BuaCwgMjogbOG7l2ksIDM6IGLhu4sgdW5saWtlKQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTeG7nyBiw6BpIMSRxINuZyBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wOiB7cG9zdF9saW5rfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE3hu58gdHLhu7FjIHRp4bq/cCBVUkwgdGjDtG5nIHF1YSBoZWxwZXIub3Blbl91cmwoKQogICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwb3N0X2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2jhu50gdHJhbmcgYsOgaSDEkcSDbmcgdOG6o2kgeG9uZyB24bubaSB0aOG7nWkgZ2lhbiBuZ+G6q3Ugbmhpw6puCiAgICAgICAgICAgIHdhaXRfdGltZSA9IHJhbmRvbS5yYW5kaW50KDQsIDYpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gNC02cwogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgY2jhu50ge3dhaXRfdGltZX1zIMSR4buDIHRyYW5nIHThuqNpIHhvbmcuLi4iKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBWdeG7kXQgbmjhurkgbMOqbiB0csOqbiBraG/huqNuZyAxIG7hu61hIG3DoG4gaMOsbmggxJHhu4MgaGnhu4NuIHRo4buLIG7DunQgbGlrZQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJWdeG7kXQgbmjhurkgxJHhu4MgaGnhu4NuIHRo4buLIG7DunQgbGlrZSIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiAxLjVzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gbsO6dCBsaWtlIHRoZW8gcmVzb3VyY2UtaWQKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmgga2hpIHTDrG0gbsO6dCBsaWtlIikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcm93X2ZlZWRfYnV0dG9uX2xpa2UiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXksIHRo4butIHZ14buRdCBs4bqnbiBu4buvYQogICAgICAgICAgICBpZiBub3QgbGlrZV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBsaWtlLCB0aOG7rSB2deG7kXQgbOG6p24gbuG7r2EiKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGR1bXAgbcOgbiBow6xuaCBraGkgdMOsbSBs4bqhaSBuw7p0IGxpa2UiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9yb3dfZmVlZF9idXR0b25fbGlrZSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSB24bqrbiBraMO0bmcgdMOsbSB0aOG6pXkgdGhlbyByZXNvdXJjZS1pZCwgdGjhu60gdMOsbSB0aGVvIGNvbnRlbnQtZGVzYwogICAgICAgICAgICBpZiBub3QgbGlrZV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUaOG7rSB0w6xtIG7DunQgbGlrZSB0aGVvIGNvbnRlbnQtZGVzYyIpCiAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJUaMOtY2giKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgbGlrZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHbhu5tpIHRleHQgdGnhur9uZyBBbmgKICAgICAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJMaWtlIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgduG6q24ga2jDtG5nIHTDrG0gdGjhuqV5LCBiw6FvIGzhu5dpCiAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBsaWtlIHNhdSBuaGnhu4F1IGzhuqduIHRo4butIikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIGxpa2UgY2jGsGEgYuG6sW5nIHRodeG7mWMgdMOtbmggc2VsZWN0ZWQKICAgICAgICAgICAgaXNfc2VsZWN0ZWQgPSBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGxpa2VfYnV0dG9uKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBzZWxlY3RlZCBraMO0bmcgY8OzIGdpw6EgdHLhu4ssIHRo4butIHTDrG0gbsO6dCAiQuG7jyB0aMOtY2giIGhv4bq3YyAiVW5saWtlIgogICAgICAgICAgICBpZiBub3QgaXNfc2VsZWN0ZWQ6CiAgICAgICAgICAgICAgICB1bmxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IkLhu48gdGjDrWNoIikKICAgICAgICAgICAgICAgIGlmIG5vdCB1bmxpa2VfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHVubGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVW5saWtlIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXNfc2VsZWN0ZWQgPSBib29sKHVubGlrZV9idXR0b24pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSDEkcOjIGxpa2UgcuG7k2kgdGjDrCBob8OgbiB0aMOgbmgKICAgICAgICAgICAgaWYgaXNfc2VsZWN0ZWQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIGxpa2UgYsOgaSB2aeG6v3QgbsOgeSB04burIHRyxrDhu5tjIikKICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBMaWtlIGLDoGkgdmnhur90CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqlbiBuw7p0IGxpa2UiKQogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIobGlrZV9idXR0b24pCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDJzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgeGVtIMSRw6MgbGlrZSB0aMOgbmggY8O0bmcgY2jGsGEKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgIyBLaMO0bmcgdGjhu4Mga2nhu4NtIHRyYSwgZ2nhuqMgxJHhu4tuaCDEkcOjIGxpa2UgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdGjhu4Mga2nhu4NtIHRyYSBs4bqhaSB0cuG6oW5nIHRow6FpIGxpa2UsIGdp4bqjIMSR4buLbmggdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgY2hlY2tfdW5saWtlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IkLhu48gdGjDrWNoIikKICAgICAgICAgICAgaWYgbm90IGNoZWNrX3VubGlrZToKICAgICAgICAgICAgICAgIGNoZWNrX3VubGlrZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJVbmxpa2UiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSBi4bqxbmcgcmVzb3VyY2UtaWQgdsOgIHNlbGVjdGVkCiAgICAgICAgICAgIGlmIG5vdCBjaGVja191bmxpa2U6CiAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbl9hZnRlciA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9yb3dfZmVlZF9idXR0b25fbGlrZSIpCiAgICAgICAgICAgICAgICBpZiBsaWtlX2J1dHRvbl9hZnRlciBhbmQgc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChsaWtlX2J1dHRvbl9hZnRlcik6CiAgICAgICAgICAgICAgICAgICAgY2hlY2tfdW5saWtlID0gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGNoZWNrX3VubGlrZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgbGlrZSBiw6BpIHZp4bq/dCB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgeMOhYyBuaOG6rW4gxJHDoyBsaWtlIGLDoGkgdmnhur90IikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYiBsaWtlOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgIAogICAgZGVmIF9jYXJlX3N3aXBlX2ZlZWQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiVnXhu5F0IGLhuqNuZyB0aW4gSW5zdGFncmFtIHbhu5tpIHRo4budaSBnaWFuIDItNSBwaMO6dCwgY8OzIHRo4buDIGxpa2UgYsOgaSBu4bq/dSBk4burbmcgbMOidSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmFuZG9tIHRo4budaSBnaWFuIHZ14buRdCB04burIDItNSBwaMO6dAogICAgICAgICAgICB0b3RhbF90aW1lID0gcmFuZG9tLnJhbmRpbnQoMTIwLCAzMDApICAjIDItNSBwaMO6dAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQuG6r3QgxJHhuqd1IHZ14buRdCBi4bqjbmcgdGluIHRyb25nIHt0b3RhbF90aW1lfSBnacOieSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgc3dpcGVfY291bnQgPSAwCiAgICAgICAgICAgIGxpa2VfY291bnQgPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSAodGltZS50aW1lKCkgLSBzdGFydF90aW1lKSA8IHRvdGFsX3RpbWU6CiAgICAgICAgICAgICAgICBzd2lwZV9jb3VudCArPSAxCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu51pIGdpYW4gZOG7q25nIG5n4bqrdSBuaGnDqm4gdOG7qyAyLTEwIGdpw6J5CiAgICAgICAgICAgICAgICBwYXVzZV90aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgMTApCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIlZ14buRdCBs4bqnbiB7c3dpcGVfY291bnR9LCBk4burbmcge3BhdXNlX3RpbWV9cyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgZOG7q25nIGzDonUgaMahbiA1cyB0aMOsIGPDsyAyMCUgY2hhbmNlIGxpa2UgYsOgaQogICAgICAgICAgICAgICAgaWYgcGF1c2VfdGltZSA+IDUgYW5kIHJhbmRvbS5yYW5kaW50KDEsIDEwMCkgPD0gMjA6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVGjhu60gbGlrZSBiw6BpIHZp4bq/dCBuw6B5Li4uIikKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBuw7p0IGxpa2UgdHJvbmcgZmVlZAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Jvd19mZWVkX2J1dHRvbl9saWtlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxpa2VfYnV0dG9uIGFuZCBub3Qgc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChsaWtlX2J1dHRvbik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGxpa2VfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpa2VfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGxpa2UgYsOgaSB2aeG6v3QgKHThu5VuZzoge2xpa2VfY291bnR9IGxpa2VzKSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUaMOqbSB0aOG7nWkgZ2lhbiBjaOG7nSBzYXUga2hpIGxpa2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMikpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIktow7RuZyB0aOG7gyBsaWtlIGLDoGk6IHtlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgROG7q25nIHRoZW8gdGjhu51pIGdpYW4gxJHDoyByYW5kb20KICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAocGF1c2VfdGltZSk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBlbGFwc2VkID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJIb8OgbiB0aMOgbmggdnXhu5F0IGZlZWQ6IHtzd2lwZV9jb3VudH0gbOG6p24gdnXhu5F0LCB7bGlrZV9jb3VudH0gbGlrZXMgdHJvbmcge2VsYXBzZWQ6LjFmfXMiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBRdWF5IGzhuqFpIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgdnXhu5F0IGZlZWQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfY2FyZV93YXRjaF9yZWVscyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJMxrDhu5t0IHJlZWwgduG7m2kgdGjhu51pIGdpYW4gZOG7q25nIHJhbmRvbSB2w6AgY8OzIHRo4buDIGxpa2UgdmlkZW8gbuG6v3UgZOG7q25nIGzDonUiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuq90IMSR4bqndSBsxrDhu5t0IHJlZWwuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gduG7gSB0cmFuZyBjaOG7pyB0csaw4bubYwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDsyB0YWIgcmVlbCBraMO0bmcKICAgICAgICAgICAgcmVlbF90YWIgPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KHRpbWVvdXQ9NSwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9jbGlwc190YWIiKQogICAgICAgICAgICBpZiBub3QgcmVlbF90YWI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFJlZWwgKGNsaXBzX3RhYikiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHJlZWxfdGFiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICB0b3RhbF93YWl0ID0gcmFuZG9tLnJhbmRpbnQoMTIwLCAxODApICAjIDItMyBwaMO6dAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG7lW5nIHRo4budaSBnaWFuIGzGsOG7m3QgcmVlbCBz4bq9IGzDoCB7dG90YWxfd2FpdH0gZ2nDonkiKQogICAgICAgICAgICAKICAgICAgICAgICAgZWxhcHNlZCA9IDAKICAgICAgICAgICAgc3dpcGVfY291bnQgPSAwCiAgICAgICAgICAgIGxpa2VfY291bnQgPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSBlbGFwc2VkIDwgdG90YWxfd2FpdDoKICAgICAgICAgICAgICAgIHN3aXBlX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYixJBhbmcgdnXhu5F0IHJlZWwgbOG6p24gdGjhu6kge3N3aXBlX2NvdW50fSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu51pIGdpYW4geGVtIHZpZGVvIHJhbmRvbSB04burIDItMTBzCiAgICAgICAgICAgICAgICB2aWRlb190aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgMTApCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIlhlbSB2aWRlbyBuw6B5IHt2aWRlb190aW1lfSBnacOieS4uLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgZOG7q25nIGzDonUgaMahbiAzcyB0aMOsIGPDsyA2MCUgY2hhbmNlIGxpa2UgdmlkZW8KICAgICAgICAgICAgICAgIGlmIHZpZGVvX3RpbWUgPiAzIGFuZCByYW5kb20ucmFuZGludCgxLCAxMDApIDw9IDYwOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRo4butIGxpa2UgdmlkZW8gcmVlbCBuw6B5Li4uIikKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQ2jhu50gbeG7mXQgY2jDunQgxJHhu4MgdmlkZW8gbG9hZAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBuw7p0IGxpa2UgdHJvbmcgcmVlbAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSBuw7p0IGxpa2UgdGhlbyBjw6FjIHJlc291cmNlLWlkIGtow6FjIG5oYXUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2xpa2VfYnV0dG9uIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJUaMOtY2giKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGxpa2VfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9Ikxpa2UiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsaWtlX2J1dHRvbiBhbmQgbm90IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b24pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihsaWtlX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBsaWtlIHZpZGVvIHJlZWwgKHThu5VuZzoge2xpa2VfY291bnR9IGxpa2VzKSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBYZW0gdGjDqm0gMi0xMHMgc2F1IGtoaSBsaWtlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFfdGltZSA9IHJhbmRvbS5yYW5kaW50KDIsIDEwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYiWGVtIHRow6ptIHtleHRyYV90aW1lfXMgc2F1IGtoaSBsaWtlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKGV4dHJhX3RpbWUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYiS2jDtG5nIHRo4buDIGxpa2UgdmlkZW8gcmVlbDoge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBE4burbmcgdGhlbyB0aOG7nWkgZ2lhbiDEkcOjIHJhbmRvbQogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCh2aWRlb190aW1lKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxhcHNlZCA9IHRpbWUudGltZSgpIC0gc3RhcnRfdGltZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgZm9yY2Ugc3RvcAogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgwLjEpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlThu5VuZyBz4buRIGzhuqduIHZ14buRdDoge3N3aXBlX2NvdW50fSwge2xpa2VfY291bnR9IGxpa2VzIikKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBsxrDhu5t0IHhvbmcgY8OhYyByZWVsLCBxdWF5IGzhuqFpIHRyYW5nIGNo4bunLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUXVheSBs4bqhaSB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiBub3Qgc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIiwgdGltZW91dD01KToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBxdWF5IGzhuqFpIHRyYW5nIGNo4bunIHNhdSBraGkgbMaw4bubdCByZWVsLiIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBsxrDhu5t0IHJlZWw6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9jYXJlX3ZpZXdfc3RvcmllcyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJYZW0gc3RvcnkgMy01IHN0b3J5IHbhu5tpIHThu5FjIMSR4buZIG5n4bqrdSBuaGnDqm4iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgICAgICAjIEtp4buDbSB0cmEgdGjhu51pIGdpYW4geGVtIHN0b3J5IGN14buRaSBjw7luZyB04burIGFjY291bnQKICAgICAgICAgICAgbGFzdF92aWV3X3N0b3JpZXMgPSBhY2NvdW50LmdldCgibGFzdF92aWV3X3N0b3JpZXMiLCAwKQogICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIGlmIGxhc3Rfdmlld19zdG9yaWVzID4gMCBhbmQgKGN1cnJlbnRfdGltZSAtIGxhc3Rfdmlld19zdG9yaWVzKSA8IDEwODAwOiAgIyAzIHRp4bq/bmcgPSAxMDgwMCBnacOieQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiQ2jGsGEgxJHhu6cgMyB0aeG6v25nIGvhu4MgdOG7qyBs4bqnbiB4ZW0gc3RvcnkgY3Xhu5FpLCBi4buPIHF1YSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQoKICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgc3RvcnkgdGh1bWJuYWlscyB0aGVvIHJlc291cmNlLWlkCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICBzdG9yeV90aHVtYnMgPSBbXQogICAgICAgICAgICBpZiBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgc3RvcnlfdGh1bWJzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYXZhdGFyX2ltYWdlX3ZpZXciKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyDDrXQgbmjhuqV0IDIgc3RvcnkgdGjDrCBt4bubaSBsw6BtCiAgICAgICAgICAgIGlmIGxlbihzdG9yeV90aHVtYnMpIDwgMjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJLaMO0bmcgxJHhu6cgc3RvcnkgxJHhu4MgeGVtIChjaOG7iSBjw7Mge2xlbihzdG9yeV90aHVtYnMpfSBzdG9yeSksIGLhu48gcXVhIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJhbmRvbSBjaOG7jW4gc3RvcnkgdOG7qyB0aOG7qSAyIMSR4bq/biBjdeG7kWkKICAgICAgICAgICAgc3RhcnRfaW5kZXggPSByYW5kb20ucmFuZGludCgxLCBsZW4oc3RvcnlfdGh1bWJzKSAtIDEpCiAgICAgICAgICAgIHNlbGVjdGVkX3N0b3J5ID0gc3RvcnlfdGh1bWJzW3N0YXJ0X2luZGV4XQogICAgICAgICAgICAKICAgICAgICAgICAgIyBC4bqlbSB2w6BvIHN0b3J5IMSRxrDhu6NjIGNo4buNbgogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VsZWN0ZWRfc3RvcnkpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBYZW0gMy04IHN0b3J5IHbhu5tpIHThu5FjIMSR4buZIG5n4bqrdSBuaGnDqm4KICAgICAgICAgICAgbnVtX3N0b3JpZXMgPSByYW5kb20ucmFuZGludCgzLCA4KQogICAgICAgICAgICBmb3IgXyBpbiByYW5nZShudW1fc3Rvcmllcyk6CiAgICAgICAgICAgICAgICAjIFRo4budaSBnaWFuIHhlbSBzdG9yeTogbmfhuq9uIGhv4bq3YyBkw6BpIG5n4bqrdSBuaGnDqm4KICAgICAgICAgICAgICAgIHdhaXQgPSByYW5kb20udW5pZm9ybSgxLjAsIDMuMCkgaWYgcmFuZG9tLmNob2ljZShbVHJ1ZSwgRmFsc2VdKSBlbHNlIHJhbmRvbS51bmlmb3JtKDMuMCwgNS4wKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhaXQpCiAgICAgICAgICAgICAgICAjIENodXnhu4NuIHNhbmcgc3RvcnkgdGnhur9wIHRoZW8gYuG6sW5nIGPDoWNoIGLhuqVtIHbDoG8gduG7iyB0csOtIG5n4bqrdSBuaGnDqm4g4bufIGdp4buvYSBtw6BuIGjDrG5oCiAgICAgICAgICAgICAgICB3aWR0aCwgaGVpZ2h0ID0gc2VsZi5oZWxwZXIuZ2V0X3NjcmVlbl9zaXplKCkKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3JpZ2h0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGhvw6F0IHN0b3J5IHZpZXdlcgogICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRo4budaSBnaWFuIHhlbSBzdG9yeSBjdeG7kWkgY8O5bmcgdsOgbyBhY2NvdW50CiAgICAgICAgICAgIGlmIGFjY291bnQgYW5kICJpZCIgaW4gYWNjb3VudDoKICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgeyJsYXN0X3ZpZXdfc3RvcmllcyI6IGN1cnJlbnRfdGltZSwgImlzX3N5bmMiOiBGYWxzZX0pCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSB4ZW0gc3Rvcnk6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfY2FyZV92aWV3X25vdGlmaWNhdGlvbnMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiTeG7nyB0YWIgdGjDtG5nIGLDoW8gdsOgIGN14buZbiBuaOG6uSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIELGsOG7m2MgMTogS2nhu4NtIHRyYSBjw7Mgbm90aWZpY2F0aW9uIGJhZGdlIGtow7RuZwogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBub3RpZmljYXRpb25fYmFkZ2UgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvbGVkX2JhZGdlIikKICAgICAgICAgICAgaWYgbm90IG5vdGlmaWNhdGlvbl9iYWRnZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyBjw7Mgbm90aWZpY2F0aW9uIGJhZGdlLCBi4buPIHF1YSB4ZW0gdGjDtG5nIGLDoW8iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAyOiBC4bqlbSB2w6BvIG5vdGlmaWNhdGlvbiB0YWIKICAgICAgICAgICAgbm90aWZpY2F0aW9uX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9ub3RpZmljYXRpb24iKQogICAgICAgICAgICBpZiBub3Qgbm90aWZpY2F0aW9uX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBub3RpZmljYXRpb24gdGFiIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihub3RpZmljYXRpb25fdGFiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMiwgMykpICAjIMSQ4buNYyAyLTNzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELGsOG7m2MgMzogUmFuZG9tIHjhu60gbMO9CiAgICAgICAgICAgIGlmIHJhbmRvbS5jaG9pY2UoW1RydWUsIEZhbHNlXSk6CiAgICAgICAgICAgICAgICAjIFTDrG0gdsOgIGLhuqVtIHbDoG8gc3Rvcnkgcm93CiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgc3Rvcnlfcm93cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iYWN0aXZpdHlfZmVlZF9uZXdzZmVlZF9zdG9yeV9yb3ciKQogICAgICAgICAgICAgICAgICAgIGlmIHN0b3J5X3Jvd3MgYW5kIGxlbihzdG9yeV9yb3dzKSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICMgUmFuZG9tIGNo4buNbiBpbmRleCB04burIDEtMyAoaG/hurdjIMOtdCBoxqFuIG7hur91IGtow7RuZyDEkeG7pykKICAgICAgICAgICAgICAgICAgICAgICAgbWF4X2luZGV4ID0gbWluKDMsIGxlbihzdG9yeV9yb3dzKSAtIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1heF9pbmRleCA+PSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRfaW5kZXggPSByYW5kb20ucmFuZGludCgxLCBtYXhfaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9zdG9yeSA9IHN0b3J5X3Jvd3Nbc2VsZWN0ZWRfaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VsZWN0ZWRfc3RvcnkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMywgNCkpICAjIENo4budIDMtNHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBWdeG7kXQgbMOqbiAxLTMgbOG6p24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKHJhbmRvbS5yYW5kaW50KDEsIDMpKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDEsIDIpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBSYW5kb20gdnXhu5F0IGzDqm4gaG/hurdjIGtow7RuZwogICAgICAgICAgICAgICAgaWYgcmFuZG9tLmNob2ljZShbVHJ1ZSwgRmFsc2VdKToKICAgICAgICAgICAgICAgICAgICAjIFZ14buRdCBsw6puIDEtMyBs4bqnbgogICAgICAgICAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKHJhbmRvbS5yYW5kaW50KDEsIDMpKToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMikpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELGsOG7m2MgNDogUXVheSBs4bqhaSBob21lCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHhlbSB0aMO0bmcgYsOhbzoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIHBlcmZvcm1fY2FyZShzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSk6CiAgICAgICAgIiIiTGVnYWN5IG1ldGhvZCAtIHJlZGlyZWN0cyB0byBTbWFydCBDYXJlIFN5c3RlbSBmb3IgY29uc2lzdGVuY3kiIiIKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQ2h1eeG7g24gaMaw4bubbmcgcGVyZm9ybV9jYXJlIEluc3RhZ3JhbSBzYW5nIFNtYXJ0IENhcmUgU3lzdGVtIGNobyB0w6BpIGtob+G6o246IHthY2NvdW50Wyd1bmlxdWVfdXNlcm5hbWUnXX0iKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBSYW5kb20gY2jhu41uIDEgdHJvbmcgMyBTbWFydCBDYXJlIG1ldGhvZHMgxJHhu4MgdMawxqFuZyB0aMOtY2ggduG7m2kgbGVnYWN5CiAgICAgICAgICAgIHNtYXJ0X2NhcmVfYWN0aW9ucyA9IFsKICAgICAgICAgICAgICAgIHNlbGYuX2NhcmVfc3dpcGVfZmVlZCwKICAgICAgICAgICAgICAgIHNlbGYuX2NhcmVfd2F0Y2hfcmVlbHMsIAogICAgICAgICAgICAgICAgc2VsZi5fY2FyZV92aWV3X25vdGlmaWNhdGlvbnMKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgIyBSYW5kb20gY2jhu41uIGFjdGlvbgogICAgICAgICAgICBzZWxlY3RlZF9hY3Rpb24gPSByYW5kb20uY2hvaWNlKHNtYXJ0X2NhcmVfYWN0aW9ucykKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBTbWFydCBDYXJlIGFjdGlvbgogICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfYWN0aW9uKGFjY291bnQpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBTbWFydCBDYXJlIGNobyBJbnN0YWdyYW06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIHBvc3RfbmV3ZmVlZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkMSDbmcg4bqjbmggY2hvIEluc3RhZ3JhbSAtIG9wdGlvbmFsIGNhcmUgYWN0aXZpdHkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQuG6r3QgxJHhuqd1IMSRxINuZyDhuqNuaCBjaG8gdMOgaSBraG/huqNuOiB7YWNjb3VudFsndW5pcXVlX3VzZXJuYW1lJ119IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAxOiDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunIEluc3RhZ3JhbQogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyB2w6BvIHRyYW5nIGNo4bunIEluc3RhZ3JhbSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAyOiBSYW5kb20gc+G7kSBsxrDhu6NuZyDhuqNuaCB2w6AgdOG6o2kgduG7gQogICAgICAgICAgICBpbWFnZV9jb3VudCA9IHJhbmRvbS5yYW5kaW50KDEsIDUpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJSYW5kb20ge2ltYWdlX2NvdW50fSDhuqNuaCDEkeG7gyDEkcSDbmcgYsOgaSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBpbWFnZV9jb3VudCA+IDE6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG6o2kge2ltYWdlX2NvdW50fSDhuqNuaCB24buBIHRoaeG6v3QgYuG7iy4uLiIpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5oZWxwZXIuZG93bmxvYWRfaW1hZ2UoY291bnQ9aW1hZ2VfY291bnQpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIlThuqNpIOG6o25oIHRo4bqldCBi4bqhaSwgYuG7jyBxdWEgxJHEg25nIGLDoGkiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJDaOG7iSDEkcSDbmcgMSDhuqNuaCwgc+G6vSBkw7luZyDhuqNuaCBn4bqnbiBuaOG6pXQgY8OzIHPhurVuIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIELGsOG7m2MgMzogTmjhuqVuIG7DunQgdOG6oW8gYsOgaSB2aeG6v3QgKGNyZWF0aW9uX3RhYiBob+G6t2MgbsO6dCArKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4bqlbSBuw7p0IHThuqFvIGLDoGkgdmnhur90Li4uIikKICAgICAgICAgICAgYWRkX2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9jcmVhdGlvbl90YWIiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgIGlmIG5vdCBhZGRfYnV0dG9uOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIG7DunQgKyDhu58gduG7iyB0csOtIGtow6FjCiAgICAgICAgICAgICAgICBhZGRfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfYnV0dG9uc19jb250YWluZXJfbGVmdCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgIGlmIG5vdCBhZGRfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICMgVGjhu60gY8OhYyBjw6FjaCB0w6xtIGtow6FjCiAgICAgICAgICAgICAgICAgICAgYWRkX2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJOZXcgcG9zdCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgYWRkX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkX2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJBZGQiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhZGRfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgdOG6oW8gYsOgaSB2aeG6v3QiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaW1hZ2VfY291bnQgPiAxOgogICAgICAgICAgICAgICAgIyBCxrDhu5tjIDQ6IELhuqVtICJDSOG7jE4gTkhJ4buAVSIgbuG6v3UgY+G6p24gY2jhu41uIG5oaeG7gXUg4bqjbmgKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuqVtICdDSOG7jE4gTkhJ4buAVScuLi4iKQogICAgICAgICAgICAgICAgbXVsdGlfc2VsZWN0X2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQodGV4dD0iQ0jhu4xOIE5ISeG7gFUiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICBpZiBub3QgbXVsdGlfc2VsZWN0X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gdGhlbyBjb250ZW50LWRlc2MKICAgICAgICAgICAgICAgICAgICBtdWx0aV9zZWxlY3RfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChjb250ZW50X2Rlc2M9Ik7DunQgY2jhu41uIG5oaeG7gXUiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG11bHRpX3NlbGVjdF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSB0aGVvIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpX3NlbGVjdF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvbXVsdGlfc2VsZWN0X3NsaWRlX2J1dHRvbl9hbHQiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBtdWx0aV9zZWxlY3RfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgJ0NI4buMTiBOSEnhu4BVJyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIELGsOG7m2MgNTogQ2jhu41uIOG6o25oIHRoZW8gc+G7kSBsxrDhu6NuZyDEkcOjIHJhbmRvbQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkNo4buNbiB7aW1hZ2VfY291bnR9IOG6o25oIHThu6sgdGjGsCB2aeG7h24uLi4iKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIMSR4buDIHTDrG0g4bqjbmgiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2FsbGVyeV9pdGVtcyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2dhbGxlcnlfZ3JpZF9pdGVtX3RodW1ibmFpbCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBnYWxsZXJ5X2l0ZW1zOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSDhuqNuaCBuw6BvIHRyb25nIHRoxrAgdmnhu4duIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDaOG7jW4gc+G7kSBsxrDhu6NuZyDhuqNuaCB0aGVvIHnDqnUgY+G6p3UgKHThu5FpIMSRYSBsw6Agc+G7kSDhuqNuaCBjw7Mgc+G6tW4pCiAgICAgICAgICAgICAgICAjIELhu48gcXVhIOG6o25oIMSR4bqndSB0acOqbiB2w6wgSW5zdGFncmFtIMSRw6MgdOG7sSDEkeG7mW5nIGNo4buNbgogICAgICAgICAgICAgICAgaXRlbXNfdG9fc2VsZWN0ID0gbWluKGltYWdlX2NvdW50LCBsZW4oZ2FsbGVyeV9pdGVtcykpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkge2xlbihnYWxsZXJ5X2l0ZW1zKX0g4bqjbmgsIHPhur0gY2jhu41uIHtpdGVtc190b19zZWxlY3R9IOG6o25oIChi4buPIHF1YSDhuqNuaCDEkeG6p3UgdGnDqm4gxJHDoyDEkcaw4bujYyBjaOG7jW4gdOG7sSDEkeG7mW5nKSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQuG6r3QgxJHhuqd1IHThu6sg4bqjbmggdGjhu6kgMiAoaW5kZXggMSkgdsOsIOG6o25oIMSR4bqndSB0acOqbiDEkcOjIMSRxrDhu6NjIGNo4buNbiB04buxIMSR4buZbmcKICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEsIGl0ZW1zX3RvX3NlbGVjdCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGdhbGxlcnlfaXRlbXNbaV0pCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBjaOG7jW4g4bqjbmgge2krMX0ve2l0ZW1zX3RvX3NlbGVjdH0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG7lW5nIGPhu5luZyDEkcOjIGNo4buNbiB7aXRlbXNfdG9fc2VsZWN0fSDhuqNuaCAoMSDhuqNuaCB04buxIMSR4buZbmcgKyB7aXRlbXNfdG9fc2VsZWN0LTF9IOG6o25oIHRo4bunIGPDtG5nKSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQsaw4bubYyA2OiBC4bqlbSBuw7p0IE5leHQKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuqVtIG7DunQgTmV4dC4uLiIpCiAgICAgICAgICAgICAgICBuZXh0X2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9uZXh0X2J1dHRvbl90ZXh0dmlldyIsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgICAgICBpZiBub3QgbmV4dF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIG7DunQgTmV4dCBi4bqxbmcgdGV4dAogICAgICAgICAgICAgICAgICAgIG5leHRfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudCh0ZXh0PSJUaeG6v3AiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG5leHRfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBuZXh0X2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJUaeG6v3AiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBuZXh0X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IFRp4bq/cCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyDEkOG7kWkgduG7m2kgMSDhuqNuaCwgY2jhu4kgY+G6p24gY2jhu41uIOG6o25oIMSR4bqndSB0acOqbgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiQ2jhu41uIOG6o25oIMSR4bqndSB0acOqbiB0cm9uZyB0aMawIHZp4buHbi4uLiIpCiAgICAgICAgICAgICAgICAjIEtow7RuZyBj4bqnbiB3YWl0X3RvX3RhcF9lbGVtZW50IGNobyB4cGF0aCBwaOG7qWMgdOG6oXAsIGTDuW5nIGZpbmRfZWxlbWVudCB0aMO0bmcgdGjGsOG7nW5nCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmggxJHhu4MgdMOsbSDhuqNuaCIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSDhuqNuaCDEkeG6p3UgdGnDqm4gdHJvbmcgZ2FsbGVyeQogICAgICAgICAgICAgICAgZmlyc3RfaW1hZ2UgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkltYWdlVmlldyIpCiAgICAgICAgICAgICAgICBpZiBub3QgZmlyc3RfaW1hZ2U6CiAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRoZW8gcmVzb3VyY2UtaWQKICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5X2l0ZW1zID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvZ2FsbGVyeV9ncmlkX2l0ZW1fdGh1bWJuYWlsIikKICAgICAgICAgICAgICAgICAgICBpZiBnYWxsZXJ5X2l0ZW1zOgogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdF9pbWFnZSA9IGdhbGxlcnlfaXRlbXNbMF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGZpcnN0X2ltYWdlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSDhuqNuaCB0cm9uZyB0aMawIHZp4buHbiIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGFwIHbDoG8g4bqjbmggxJHhuqd1IHRpw6puCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZmlyc3RfaW1hZ2UpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMikpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQsaw4bubYyA2OiBOaOG6pW4gTmV4dAogICAgICAgICAgICAgICAgbmV4dF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHRleHQ9IlRp4bq/cCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgIGlmIG5vdCBuZXh0X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICBuZXh0X2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJUaeG6v3AiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG5leHRfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBUaeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgyLCAzKSkKCiAgICAgICAgICAgICMgQsaw4bubYyA3OiBOaOG6pW4gVGnhur9wIGzhuqduIG7hu69hIChi4buPIHF1YSBlZGl0KQogICAgICAgICAgICBuZXh0X2J1dHRvbjIgPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHRleHQ9IlRp4bq/cCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgaWYgbm90IG5leHRfYnV0dG9uMjoKICAgICAgICAgICAgICAgIG5leHRfYnV0dG9uMiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJUaeG6v3AiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgIGlmIG5leHRfYnV0dG9uMjoKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgyLCAzKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyA4OiBUaMOqbSBjYXB0aW9uICh0w7l5IGNo4buNbikKICAgICAgICAgICAgY2FwdGlvbl9maWVsZCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJXcml0ZSBhIGNhcHRpb24uLi4iKQogICAgICAgICAgICBpZiBub3QgY2FwdGlvbl9maWVsZDoKICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSB0aGVvIGPDoWNoIGtow6FjCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgY2FwdGlvbl9maWVsZCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iV3JpdGUgYSBjYXB0aW9uLi4uIikKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2FwdGlvbl9maWVsZDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGZpZWxkIGNo4bupYSB04burICJjYXB0aW9uIgogICAgICAgICAgICAgICAgICAgICAgICBhbGxfZWxlbWVudHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuRWRpdFRleHQiKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgZWxlbWVudCBpbiBhbGxfZWxlbWVudHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gZWxlbWVudC5nZXQoInRleHQiLCAiIikubG93ZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGludCA9IGVsZW1lbnQuZ2V0KCJoaW50IiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJjYXB0aW9uIiBpbiB0ZXh0IG9yICJjYXB0aW9uIiBpbiBoaW50OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb25fZmllbGQgPSBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgaWYgY2FwdGlvbl9maWVsZDoKICAgICAgICAgICAgICAgICMgUmFuZG9tIHRow6ptIGNhcHRpb24gaG/hurdjIGtow7RuZyAoNzAlIGPGoSBo4buZaSBjw7MgY2FwdGlvbikKICAgICAgICAgICAgICAgIGlmIHJhbmRvbS5jaG9pY2UoW1RydWUsIFRydWUsIFRydWUsIFRydWUsIFRydWUsIFRydWUsIFRydWUsIEZhbHNlLCBGYWxzZSwgRmFsc2VdKToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgxJDhu41jIGNhcHRpb25zIHThu6sgZmlsZSB0ZW1wbGF0ZQogICAgICAgICAgICAgICAgICAgICAgICBjYXB0aW9uX2ZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5kaXJuYW1lKF9fZmlsZV9fKSksICJ0ZW1wbGF0ZSIsICJjYXB0aW9uc19pbnN0YWdyYW0udHh0IikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoY2FwdGlvbl9maWxlX3BhdGgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGNhcHRpb25fZmlsZV9wYXRoLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbnMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGYucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjYXB0aW9uczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9jYXB0aW9uID0gcmFuZG9tLmNob2ljZShjYXB0aW9ucykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoY2FwdGlvbl9maWVsZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50eXBlX3RleHQoc2VsZWN0ZWRfY2FwdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0aMOqbSBjYXB0aW9uOiB7c2VsZWN0ZWRfY2FwdGlvbn0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJGaWxlIGNhcHRpb25zIHRy4buRbmciKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBGYWxsYmFjayB24buBIGVtb2ppIG7hur91IGtow7RuZyB0w6xtIHRo4bqleSBmaWxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxsYmFja19jYXB0aW9ucyA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi8J+MnyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIuKcqCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfmYIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLwn5O4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi8J+SqyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfjLgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLwn46JIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi8J+SnSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjYXB0aW9uX2ZpZWxkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50eXBlX3RleHQocmFuZG9tLmNob2ljZShmYWxsYmFja19jYXB0aW9ucykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBmaWxlIGNhcHRpb25zLCBz4butIGThu6VuZyBlbW9qaSBmYWxsYmFjayIpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIMSR4buNYyBmaWxlIGNhcHRpb25zOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIHbhu4EgZW1vamkgbuG6v3UgY8OzIGzhu5dpCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbGxiYWNrX2NhcHRpb25zID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfjJ8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIuKcqCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfmYIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfk7giCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGNhcHRpb25fZmllbGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnR5cGVfdGV4dChyYW5kb20uY2hvaWNlKGZhbGxiYWNrX2NhcHRpb25zKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAjIELGsOG7m2MgOTogTmjhuqVuIENoaWEgc+G6uyDEkeG7gyDEkcSDbmcgYsOgaQogICAgICAgICAgICBzaGFyZV9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHRleHQ9IkNoaWEgc+G6uyIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgaWYgbm90IHNoYXJlX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNoYXJlX2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJDaGlhIHPhursiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2hhcmVfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IENoaWEgc+G6uyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDMsIDUpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDEwOiBLaeG7g20gdHJhIMSRxINuZyB0aMOgbmggY8O0bmcgdsOgIHF1YXkgduG7gSBob21lCiAgICAgICAgICAgICMgQ8OzIHRo4buDIGPDsyBwb3B1cCAiUG9zdCBzaGFyZWQiIGhv4bq3YyB04buxIMSR4buZbmcgduG7gSBmZWVkCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9rX2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQodGV4dD0iT0siLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICBpZiBub3Qgb2tfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQodGV4dD0iWG9uZyIsIHRpbWVvdXQ9MykKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgUXVheSB24buBIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMSDbmcg4bqjbmggdGjDoG5oIGPDtG5nIGNobyB0w6BpIGtob+G6o246IHthY2NvdW50Wyd1bmlxdWVfdXNlcm5hbWUnXX0iKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgxJHEg25nIOG6o25oOiB7ZX0iKQogICAgICAgICAgICAjIFRo4butIHF1YXkgduG7gSB0cmFuZyBjaOG7pyBu4bq/dSBjw7MgbOG7l2kKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIF9wZXJmb3JtX2FjY291bnRfc3dpdGNoKHNlbGYsIHRhcmdldF9hY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBjw6FjIHRoYW8gdMOhYyBVSSDEkeG7gyBjaHV54buDbiB0w6BpIGtob+G6o24gSW5zdGFncmFtCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFyZ2V0X2FjY291bnQ6IFTDoGkga2hv4bqjbiBj4bqnbiBjaHV54buDbiDEkeG6v24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogYm9vbCwKICAgICAgICAgICAgICAgICdyZWFzb24nOiBzdHIgKG7hur91IHRo4bqldCBi4bqhaSksCiAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IHN0cgogICAgICAgICAgICB9CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAnbmF2aWdhdGlvbl9lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnS2jDtG5nIHRo4buDIMSR4bq/biB0cmFuZyBjaOG7pyBJbnN0YWdyYW0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6pW4gdsOgbyB0YWIgIlRyYW5nIGPDoSBuaMOibiIKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIHByb2ZpbGVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlRyYW5nIGPDoSBuaMOibiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcHJvZmlsZV90YWI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiBUcmFuZyBjw6EgbmjDom4iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ3VpX2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICdLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFRyYW5nIGPDoSBuaMOibicKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE5o4bqlcCB2w6BvIHRhYiBUcmFuZyBjw6EgbmjDom4KICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2ZpbGVfdGFiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB1c2VybmFtZSB04burIHRpw6p1IMSR4buBIGzhu5tuIHRyb25nIGFjdGlvbiBiYXIKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIHVzZXJuYW1lX3RpdGxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX2xhcmdlX3RpdGxlX2F1dG9fc2l6ZSIKICAgICAgICAgICAgKQogICAgICAgICAgICBpZiBub3QgdXNlcm5hbWVfdGl0bGU6CiAgICAgICAgICAgICAgICB1c2VybmFtZV90aXRsZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfdGl0bGUiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9sYXJnZV90aXRsZV9hdXRvX3NpemUiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgdXNlcm5hbWVfdGl0bGU6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IHRpw6p1IMSR4buBIHVzZXJuYW1lIikKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICd1aV9lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnS2jDtG5nIHTDrG0gdGjhuqV5IHRpw6p1IMSR4buBIHVzZXJuYW1lJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVwIHbDoG8gdGnDqnUgxJHhu4EgdXNlcm5hbWUgxJHhu4MgbeG7nyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIodXNlcm5hbWVfdGl0bGUpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0w6puIHTDoGkga2hv4bqjbiBj4bqnbiBjaHV54buDbiDEkeG6v24KICAgICAgICAgICAgdGFyZ2V0X3VzZXJuYW1lID0gdGFyZ2V0X2FjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB0cuG7sWMgdGnhur9wIHTDoGkga2hv4bqjbiB0aGVvIHRleHQgKGPDoWNoIMSRxqFuIGdp4bqjbiBuaOG6pXQpCiAgICAgICAgICAgIGFjY291bnRzX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIHRhcmdldF9pdGVtID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChhY2NvdW50c194bWwsIHRleHQ9dGFyZ2V0X3VzZXJuYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXksIHZ14buRdCBsw6puIHbDoCB0w6xtIGzhuqFpCiAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRfaXRlbToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IOG7nyBs4bqnbiDEkeG6p3UsIHZ14buRdCBsw6puIHbDoCB0w6xtIGzhuqFpIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzhuqV5IGzhuqFpIFhNTCB2w6AgdMOsbSBs4bqhaQogICAgICAgICAgICAgICAgYWNjb3VudHNfeG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIHRhcmdldF9pdGVtID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChhY2NvdW50c194bWwsIHRleHQ9dGFyZ2V0X3VzZXJuYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHRhcmdldF9pdGVtOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRoZW8gY29udGVudC1kZXNjIChjw7MgdGjhu4MgY2jhu6lhIHRow7RuZyBiw6FvKQogICAgICAgICAgICAgICAgdGFyZ2V0X2l0ZW1zID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKGFjY291bnRzX3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXdHcm91cCIpCiAgICAgICAgICAgICAgICBmb3IgaXRlbSBpbiB0YXJnZXRfaXRlbXM6CiAgICAgICAgICAgICAgICAgICAgY29udGVudF9kZXNjID0gaXRlbS5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldF91c2VybmFtZSBpbiBjb250ZW50X2Rlc2MgYW5kICJUaMOqbSB0w6BpIGtob+G6o24iIG5vdCBpbiBjb250ZW50X2Rlc2MgYW5kICJUcnVuZyB0w6JtIHTDoGkga2hv4bqjbiIgbm90IGluIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2l0ZW0gPSBpdGVtCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgdGFyZ2V0X2l0ZW06CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gdHJvbmcgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gSW5zdGFncmFtIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIGzDoCBi4buLIHbDtCBoaeG7h3UgaMOzYSB0cm9uZyBEQgogICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudCh0YXJnZXRfYWNjb3VudFsiaWQiXSwgewogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiZGlzYWJsZWQiLAogICAgICAgICAgICAgICAgICAgICJkaXNhYmxlX3JlYXNvbiI6ICJUw6BpIGtob+G6o24ga2jDtG5nIGPDsyB0csOqbiB0aGnhur90IGLhu4siLAogICAgICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOaOG6pW4gQmFjayDEkeG7gyDEkcOzbmcgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUXVheSB24buBIHRyYW5nIGNo4bunCiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdhY2NvdW50X25vdF9mb3VuZCcsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBmJ0tow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gdHJvbmcgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gSW5zdGFncmFtJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVwIHbDoG8gdMOgaSBraG/huqNuIG3hu6VjIHRpw6p1CiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih0YXJnZXRfaXRlbSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBzYWZlX3NsZWVwIHJldHVybiB2YWx1ZSDEkeG7gyBjw7MgdGjhu4MgdGhvw6F0IHPhu5ttCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoNSk6ICAjIMSQ4bujaSBjaHV54buDbiB0w6BpIGtob+G6o24gaG/DoG4gdOG6pXQKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyBzd2l0Y2hfdG9fYWNjb3VudCIpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAnaW50ZXJydXB0ZWQnLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogJ0Lhu4sgZOG7q25nIHRyb25nIHF1w6EgdHLDrG5oIGNodXnhu4NuIHTDoGkga2hv4bqjbicKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyBjaHV54buDbiB0w6BpIGtob+G6o24gdGjDoG5oIGPDtG5nIGNoxrBhCiAgICAgICAgICAgIGN1cnJlbnRfdXNlcm5hbWUgPSBzZWxmLmdldF9jdXJyZW50X2xvZ2dlZF9pbl91c2VybmFtZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBjdXJyZW50X3VzZXJuYW1lID09IHRhcmdldF91c2VybmFtZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGNodXnhu4NuIHTDoGkga2hv4bqjbiB0aMOgbmggY8O0bmcgc2FuZyB7dGFyZ2V0X3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBmJ8SQw6MgY2h1eeG7g24gdMOgaSBraG/huqNuIHRow6BuaCBjw7RuZyBzYW5nIHt0YXJnZXRfdXNlcm5hbWV9JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiLEkMOjIGLhuqVtIHbDoG8gdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IG5oxrBuZyBraeG7g20gdHJhIGzhuqFpIHRo4bqleSDEkWFuZyDEkcSDbmcgbmjhuq1wIGzDoCB7Y3VycmVudF91c2VybmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ3N3aXRjaF92ZXJpZmljYXRpb25fZmFpbGVkJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IGYnxJDDoyBi4bqlbSB2w6BvIHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSBuaMawbmcga2nhu4NtIHRyYSBs4bqhaSB0aOG6pXkgxJFhbmcgxJHEg25nIG5o4bqtcCBsw6Age2N1cnJlbnRfdXNlcm5hbWV9JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGNodXnhu4NuIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gcXVheSB24buBIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICdyZWFzb24nOiAnZXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZidM4buXaSBraGkgY2h1eeG7g24gdMOgaSBraG/huqNuIEluc3RhZ3JhbToge3N0cihlKX0nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKHNlbGYpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdXNlcm5hbWUgY+G7p2EgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHIgaG/hurdjIE5vbmU6IFVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wLCBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgIyBDw6FjaCAxOiDEkOG7jWMgdOG7qyBhdmF0YXJfaW1hZ2VfdmlldyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIGF2YXRhcl92aWV3ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2F2YXRhcl9pbWFnZV92aWV3IikKICAgICAgICAgICAgaWYgYXZhdGFyX3ZpZXc6CiAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBhdmF0YXJfdmlldy5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgIyBjb250ZW50LWRlc2MgZOG6oW5nOiAiVGluIGPhu6dhIG5nb3RoaXllbjI2MDEwMDU5LCAwLzEsIENoxrBhIHhlbSIKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBhbmQgIlRpbiBj4bunYSAiIGluIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gY29udGVudF9kZXNjLnNwbGl0KCJUaW4gY+G7p2EgIiwgMSlbMV0uc3BsaXQoIiwiLCAxKVswXS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgbOG6pXkgdXNlcm5hbWUgdOG7qyB0cmFuZyBjaOG7pzoge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlcm5hbWUKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgY+G6r3QgY2h14buXaSBs4bqleSB1c2VybmFtZSB04burIGNvbnRlbnQtZGVzYzoge2V9IikKCiAgICAgICAgICAgICMgQ8OhY2ggMjogTuG6v3Uga2jDtG5nIHRow6BuaCBjw7RuZyDhu58gY8OhY2ggMSwgdGjhu60gdsOgbyB0cmFuZyBjw6EgbmjDom4KICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHVzZXJuYW1lIHThu6sgdHJhbmcgY2jhu6csIHRo4butIHbDoG8gdHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVuIHbDoG8gdGFiICJUcmFuZyBjw6EgbmjDom4iCiAgICAgICAgICAgIHByb2ZpbGVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlRyYW5nIGPDoSBuaMOibiIpCiAgICAgICAgICAgIGlmIG5vdCBwcm9maWxlX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFRyYW5nIGPDoSBuaMOibiIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2ZpbGVfdGFiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKCiAgICAgICAgICAgICMgxJDhu41jIHVzZXJuYW1lIHThu6sgdGnDqnUgxJHhu4EgbOG7m24gdHJvbmcgYWN0aW9uIGJhcgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfbGFyZ2VfdGl0bGVfYXV0b19zaXplIgogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHVzZXJuYW1lX3RpdGxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl90aXRsZSIKICAgICAgICAgICAgKQogICAgICAgICAgICBpZiBub3QgdXNlcm5hbWVfdGl0bGU6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX2Rvd24oKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX2Rvd24oKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIHVzZXJuYW1lX3RpdGxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfbGFyZ2VfdGl0bGVfYXV0b19zaXplIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgdXNlcm5hbWVfdGl0bGU6CiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodXNlcm5hbWVfdGl0bGUpCiAgICAgICAgICAgICAgICAjIFF1YXkgbOG6oWkgdHJhbmcgY2jhu6cKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGzhuqV5IHVzZXJuYW1lIHThu6sgdHJhbmcgY8OhIG5ow6JuOiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiB1c2VybmFtZQoKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgdGnDqnUgxJHhu4EsIHRo4butIHTDrG0gYmnhu4N1IHTGsOG7o25nIHRyYW5nIGPDoSBuaMOibiBraMOhYwogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGnDqnUgxJHhu4EgdXNlcm5hbWUsIHRo4butIHTDrG0gdGhlbyBjw6FjaCBraMOhYyIpCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGzhuqV5IHVzZXJuYW1lIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wIikKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgZGVmIGdldF9qb2JfcGFyYW1zKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aGFtIHPhu5EgxJHhu4MgZ+G7jWkgQVBJIGzhuqV5IGpvYiBjaG8gSW5zdGFncmFtCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IFRoYW0gc+G7kQogICAgICAgICIiIgogICAgICAgIGdvbGlrZV9pZCA9IGFjY291bnQuZ2V0KCJnb2xpa2VfaWQiKQogICAgICAgIGlmIG5vdCBnb2xpa2VfaWQ6CiAgICAgICAgICAgIHJldHVybiB7fQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiaW5zdGFncmFtX2FjY291bnRfaWQiOiBnb2xpa2VfaWQsCiAgICAgICAgICAgICJkYXRhIjogIm51bGwiCiAgICAgICAgfQ==').decode('utf-8'))
