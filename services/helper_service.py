import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHJlCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBvcwppbXBvcnQgY29uZmlnCmltcG9ydCB1dGlscwpmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgcXVvdGUsIHVucXVvdGUKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgT3B0aW9uYWwsIFR1cGxlLCBMaXN0LCBVbmlvbgp0cnk6CiAgICBmcm9tIGx4bWwgaW1wb3J0IGV0cmVlCiAgICBMWE1MX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgTFhNTF9BVkFJTEFCTEUgPSBGYWxzZQoKIyBU4bqhbyBsb2dnZXIgY2hvIEhlbHBlclNlcnZpY2UKbG9nZ2VyID0gdXRpbHMuZ2V0X2xvZ2dlcigiSGVscGVyU2VydmljZSIpCgpjbGFzcyBIZWxwZXJTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGJhc2VfdXJsOiBzdHIgPSBOb25lLCBkYl9zZXJ2aWNlPU5vbmUpOgogICAgICAgICMgU+G7rSBk4bulbmcgY29uZmlnIG7hur91IGJhc2VfdXJsIGtow7RuZyDEkcaw4bujYyBjdW5nIGPhuqVwCiAgICAgICAgaWYgYmFzZV91cmwgaXMgTm9uZToKICAgICAgICAgICAgYmFzZV91cmwgPSBjb25maWcuSEVMUEVSX1NFUlZJQ0VfVVJMCiAgICAgICAgCiAgICAgICAgc2VsZi5iYXNlX3VybCA9IGJhc2VfdXJsCiAgICAgICAgc2VsZi5pc19hZGJfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICBzZWxmLmRldmljZV9pcCA9IGNvbmZpZy5ERVZJQ0VfSVAgICMgU+G7rSBk4bulbmcgREVWSUNFX0lQIHThu6sgY29uZmlnCiAgICAgICAgc2VsZi5kYl9zZXJ2aWNlID0gZGJfc2VydmljZQogICAgICAgIAogICAgICAgICMgTHXDtG4gdGjhu60ga+G6v3QgbuG7kWkgQURCIHbhu5tpIElQIHThu6sgY29uZmlnCiAgICAgICAgc2VsZi5jaGVja19hbmRfY29ubmVjdF9hZGIoKQoKICAgIGRlZiBjaGVja19hbmRfY29ubmVjdF9hZGIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHbDoCBr4bq/dCBu4buRaSBBREIgdOG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgQURCIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBraMO0bmcKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJhZGIiLCAiLS12ZXJzaW9uIl0sIGNoZWNrPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEvhur90IG7hu5FpIEFEQiDEkeG6v24gdGhp4bq/dCBi4buLIHPhu60gZOG7pW5nIMSR4buLYSBjaOG7iSB04burIGNvbmZpZwogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIMSR4bq/biB0aGnhur90IGLhu4sKICAgICAgICAgICAgY29ubmVjdF9wcm9jZXNzID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbImFkYiIsICJjb25uZWN0IiwgYWRiX2FkZHJlc3NdLAogICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyBr4bq/dCBu4buRaQogICAgICAgICAgICBpZiAiY29ubmVjdGVkIiBpbiBjb25uZWN0X3Byb2Nlc3Muc3Rkb3V0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBUcnVlCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6Mga+G6v3QgbuG7kWkgQURCIHRow6BuaCBjw7RuZyDEkeG6v24ge2FkYl9hZGRyZXNzfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IChzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciwgRmlsZU5vdEZvdW5kRXJyb3IpIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBr4bq/dCBu4buRaSBBREI6IHtlfSIpCiAgICAgICAgCiAgICAgICAgc2VsZi5pc19hZGJfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2dldF9hZGJfZGV2aWNlX3BhcmFtKHNlbGYpIC0+IExpc3Rbc3RyXToKICAgICAgICAiIiIKICAgICAgICBUcuG6oyB24buBIHRoYW0gc+G7kSB0aGnhur90IGLhu4sgY2hvIGzhu4duaCBBREIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W3N0cl06IERhbmggc8OhY2ggWy1zLCBkZXZpY2VfaWRdIGhv4bq3YyBsaXN0IHLhu5duZyBu4bq/dSBraMO0bmcgY8OzIHRoaeG6v3QgYuG7iwogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgYWRiX2FkZHJlc3MgPSBmIntjb25maWcuQURCX0hPU1R9Ontjb25maWcuQURCX1BPUlR9IgogICAgICAgICAgICByZXR1cm4gWyItcyIsIGFkYl9hZGRyZXNzXQogICAgICAgIHJldHVybiBbXQoKICAgIGRlZiBfbWFrZV9yZXF1ZXN0KHNlbGYsIGVuZHBvaW50OiBzdHIsIHBhcmFtczogRGljdFtzdHIsIEFueV0gPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIHJlcXVlc3QgQVBJIHbDoCB0cuG6oyB24buBIGvhur90IHF14bqjIGThuqFuZyBKU09OIGhv4bq3YyBYTUwKICAgICAgICAiIiIKICAgICAgICB1cmwgPSBmIntzZWxmLmJhc2VfdXJsfS97ZW5kcG9pbnR9IgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUaGnhur90IGzhuq1wIHRpbWVvdXQgY2hvIHJlcXVlc3QKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PTEwKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBDb250ZW50LVR5cGUKICAgICAgICAgICAgY29udGVudF90eXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICBpZiAnYXBwbGljYXRpb24veG1sJyBpbiBjb250ZW50X3R5cGUgb3IgZW5kcG9pbnQgPT0gJ2R1bXAtc2NyZWVuLXhtbCc6CiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgWE1MIGTGsOG7m2kgZOG6oW5nIHRleHQKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgImRhdGEiOiByZXNwb25zZS50ZXh0fQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUcuG6oyB24buBIEpTT04KICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5UaW1lb3V0OgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlJlcXVlc3QgdGltZW91dCBraGkgZ+G7jWkge3VybH0sIHRo4butIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAiKQogICAgICAgICAgICBzZWxmLl9yZXN0YXJ0X2hlbHBlcl9hcHAoKQogICAgICAgICAgICAjIFRo4butIGzhuqFpIHJlcXVlc3Qgc2F1IGtoaSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkgICMgQ2jhu50gMSBnacOieSDEkeG7gyDhu6luZyBk4bulbmcga2jhu59pIMSR4buZbmcKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgcGFyYW1zPXBhcmFtcywgdGltZW91dD0xMCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgICAgICBpZiAnYXBwbGljYXRpb24veG1sJyBpbiBjb250ZW50X3R5cGUgb3IgZW5kcG9pbnQgPT0gJ2R1bXAtc2NyZWVuLXhtbCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLnRleHR9CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yIGFzIGU6CiAgICAgICAgICAgICMgQuG6r3QgbOG7l2kga+G6v3QgbuG7kWkgYuG7iyB04burIGNo4buRaSBob+G6t2Mga2jDtG5nIHRo4buDIGvhur90IG7hu5FpCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga+G6v3QgbuG7kWkga2hpIGfhu41pIHt1cmx9LCB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICBzZWxmLl9yZXN0YXJ0X2hlbHBlcl9hcHAoKQogICAgICAgICAgICAjIFRo4butIGzhuqFpIHJlcXVlc3Qgc2F1IGtoaSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikgICMgQ2jhu50gMiBnacOieSDEkeG7gyDhu6luZyBk4bulbmcga2jhu59pIMSR4buZbmcKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgcGFyYW1zPXBhcmFtcywgdGltZW91dD0xMCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgICAgICBpZiAnYXBwbGljYXRpb24veG1sJyBpbiBjb250ZW50X3R5cGUgb3IgZW5kcG9pbnQgPT0gJ2R1bXAtc2NyZWVuLXhtbCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLnRleHR9CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiByZXF1ZXN0OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6IHN0cihlKX0KCiAgICBkZWYgX3Jlc3RhcnRfaGVscGVyX2FwcChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAgc+G7rSBk4bulbmcgQURCCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEto4bufaSDEkeG7mW5nIGhlbHBlciBhcHAgYuG6sW5nIEFEQgogICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbInNoZWxsIiwgImFtIiwgInN0YXJ0IiwgIi1uIiwgImNvbS5kbmR2aW5hLmhlbHBlci8uTWFpbkFjdGl2aXR5Il0KICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICB0ZXh0PVRydWUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAgcXVhIEFEQiIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHF1YSBBREI6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAgdsOsIEFEQiBjaMawYSDEkcaw4bujYyBr4bq/dCBu4buRaSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiB0YXAoc2VsZiwgeDogaW50LCB5OiBpbnQpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIHbhu4sgdHLDrSB4LHkgdHLDqm4gbcOgbiBow6xuaAogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInRhcCIsIHBhcmFtcz17IngiOiB4LCAieSI6IHl9KQoKICAgIGRlZiB0YXBfZWxlbWVudChzZWxmLCBib3VuZHM6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhuqFtIHbDoG8gbeG7mXQgcGjhuqduIHThu60gZOG7sWEgdHLDqm4gYm91bmRzIGPhu6dhIG7DswogICAgICAgIEZvcm1hdCBib3VuZHM6ICJbeDEseTFdW3gyLHkyXSIgaG/hurdjIGVsZW1lbnQgZGljdAogICAgICAgICIiIgogICAgICAgICMgTuG6v3UgYm91bmRzIGzDoCBt4buZdCBkaWN0IChlbGVtZW50KSwgbOG6pXkgYm91bmRzIHN0cmluZyB04burIMSRw7MKICAgICAgICBpZiBpc2luc3RhbmNlKGJvdW5kcywgZGljdCk6CiAgICAgICAgICAgIGJvdW5kcyA9IGJvdW5kcy5nZXQoImJvdW5kcyIsICJbMCwwXVswLDBdIikKICAgICAgICAgICAgCiAgICAgICAgIyBUaOG7rSBjw6FjIHBhdHRlcm4ga2jDoWMgbmhhdSDEkeG7gyBwYXJzZSBib3VuZHMsIGNobyBwaMOpcCBz4buRIMOibQogICAgICAgIHBhdHRlcm5zID0gWwogICAgICAgICAgICByIlxbKC0/XGQrKSwoLT9cZCspXF1cWygtP1xkKyksKC0/XGQrKVxdIiwgICMgW3gxLHkxXVt4Mix5Ml0gduG7m2kgc+G7kSDDom0KICAgICAgICAgICAgciIoLT9cZCspLCgtP1xkKyksKC0/XGQrKSwoLT9cZCspIiwgICAgICAgICAjIHgxLHkxLHgyLHkyCiAgICAgICAgICAgIHIiXFsoLT9cZCspOygtP1xkKylcXVxbKC0/XGQrKTsoLT9cZCspXF0iICAgIyBbeDE7eTFdW3gyO3kyXQogICAgICAgIF0KICAgICAgICAKICAgICAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICAgICAgbWF0Y2ggPSByZS5tYXRjaChwYXR0ZXJuLCBib3VuZHMpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBtYXAoaW50LCBtYXRjaC5ncm91cHMoKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBwcmludChmIk9yaWdpbmFsIGJvdW5kczogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikgICMgQuG7jyBsb2cgbsOgeQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFPhu61hIGNo4buvYSBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4cKICAgICAgICAgICAgICAgIGlmIHkxIDwgMCBvciB5MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJGaXhpbmcgbmVnYXRpdmUgWSBjb29yZGluYXRlcy4uLiIpCiAgICAgICAgICAgICAgICAgICAgaWYgeTIgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBhYnMoeTIgLSB5MSkKICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSBtYXgoMCwgeTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHkyID0geTEgKyBoZWlnaHQKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJBZGp1c3RlZCBZOiB5MT17eTF9LCB5Mj17eTJ9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgeDEgPCAwIG9yIHgyIDwgMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkZpeGluZyBuZWdhdGl2ZSBYIGNvb3JkaW5hdGVzLi4uIikKICAgICAgICAgICAgICAgICAgICBpZiB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gYWJzKHgyIC0geDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gbWF4KDAsIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHgxICsgd2lkdGgKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJBZGp1c3RlZCBYOiB4MT17eDF9LCB4Mj17eDJ9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGJvdW5kcyBo4bujcCBs4buHIHNhdSBraGkgxJFp4buBdSBjaOG7iW5oCiAgICAgICAgICAgICAgICBpZiB4MSA+PSB4MiBvciB5MSA+PSB5MjoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkludmFsaWQgYm91bmRzIGFmdGVyIGFkanVzdG1lbnQ6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ2jhu41uIG3hu5l0IMSRaeG7g20gdHJvbmcgYm91bmRzIHbhu5tpIG1hcmdpbiBhbiB0b8OgbgogICAgICAgICAgICAgICAgbWFyZ2luID0gbWluKDMsICh4MiAtIHgxKSAvLyA0LCAoeTIgLSB5MSkgLy8gNCkgICMgRHluYW1pYyBtYXJnaW4KICAgICAgICAgICAgICAgIG1hcmdpbiA9IG1heCgxLCBtYXJnaW4pICAjIMONdCBuaOG6pXQgMXB4IG1hcmdpbgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB4ID0gcmFuZG9tLnJhbmRpbnQoeDEgKyBtYXJnaW4sIG1heCh4MSArIG1hcmdpbiArIDEsIHgyIC0gbWFyZ2luKSkKICAgICAgICAgICAgICAgIHkgPSByYW5kb20ucmFuZGludCh5MSArIG1hcmdpbiwgbWF4KHkxICsgbWFyZ2luICsgMSwgeTIgLSBtYXJnaW4pKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIHByaW50KGYiRmluYWwgdGFwIGNvb3JkaW5hdGVzOiAoe3h9LCB7eX0pIHdpdGggbWFyZ2luIHttYXJnaW59IikgICMgQuG7jyBsb2cgbsOgeQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi50YXAoeCwgeSkKICAgICAgICAKICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6IGYixJDhu4tuaCBk4bqhbmcgYm91bmRzIGtow7RuZyBo4bujcCBs4buHOiB7Ym91bmRzfSJ9CgogICAgZGVmIHN3aXBlKHNlbGYsIHN0YXJ0WDogaW50LCBzdGFydFk6IGludCwgZW5kWDogaW50LCBlbmRZOiBpbnQsIGR1cmF0aW9uOiBpbnQgPSA4MDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gdGhhbyB0w6FjIHZ14buRdCB0w7l5IGNo4buJbmggduG7m2kgY8OhYyB0aGFtIHPhu5EgY+G7pSB0aOG7gwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHN0YXJ0WDogVOG7jWEgxJHhu5kgWCDEkWnhu4NtIGLhuq90IMSR4bqndQogICAgICAgICAgICBzdGFydFk6IFThu41hIMSR4buZIFkgxJFp4buDbSBi4bqvdCDEkeG6p3UgIAogICAgICAgICAgICBlbmRYOiBU4buNYSDEkeG7mSBYIMSRaeG7g20ga+G6v3QgdGjDumMKICAgICAgICAgICAgZW5kWTogVOG7jWEgxJHhu5kgWSDEkWnhu4NtIGvhur90IHRow7pjCiAgICAgICAgICAgIGR1cmF0aW9uOiBUaOG7nWkgZ2lhbiB0aOG7sWMgaGnhu4duIHRoYW8gdMOhYyB2deG7kXQgKG1pbGxpc2Vjb25kcykKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIHRo4buxYyBoaeG7h24gdGhhbyB0w6FjCiAgICAgICAgICAgIAogICAgICAgIEV4YW1wbGU6CiAgICAgICAgICAgICMgVnXhu5F0IHThu6sgdHLDqm4geHXhu5FuZyBkxrDhu5tpCiAgICAgICAgICAgIGhlbHBlci5zd2lwZSgxMDAsIDIwMCwgMTAwLCA2MDAsIDEwMDApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFZ14buRdCB04burIHRyw6FpIHF1YSBwaOG6o2kKICAgICAgICAgICAgaGVscGVyLnN3aXBlKDUwLCA0MDAsIDM1MCwgNDAwLCA1MDApCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAic3RhcnRYIjogc3RhcnRYLAogICAgICAgICAgICAic3RhcnRZIjogc3RhcnRZLCAKICAgICAgICAgICAgImVuZFgiOiBlbmRYLAogICAgICAgICAgICAiZW5kWSI6IGVuZFksCiAgICAgICAgICAgICJkdXJhdGlvbiI6IGR1cmF0aW9uCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlN3aXBlOiAoe3N0YXJ0WH0se3N0YXJ0WX0pIOKGkiAoe2VuZFh9LHtlbmRZfSkgdHJvbmcge2R1cmF0aW9ufW1zIikKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZSIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIHN3aXBlX3VwKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCBsw6puIHThu6sgduG7iyB0csOtIG5n4bqrdSBuaGnDqm4gcGjDuSBo4bujcAogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX3VwIikKCiAgICBkZWYgc3dpcGVfZG93bihzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgeHXhu5FuZyB04burIHbhu4sgdHLDrSBuZ+G6q3Ugbmhpw6puIHBow7kgaOG7o3AKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV9kb3duIikKCiAgICBkZWYgaW5wdXRfdGV4dChzZWxmLCB0ZXh0OiBzdHIsIHNwZWVkOiBmbG9hdCA9IDEuMCwgCiAgICAgICAgICAgICAgICAgIGRpcmVjdF9tb2RlOiBib29sID0gRmFsc2UsIHBlcmZlY3RfbW9kZTogYm9vbCA9IFRydWUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3DtCBwaOG7j25nIGfDtSBwaMOtbSB24bubaSB04buRYyDEkeG7mSBuZ+G6q3Ugbmhpw6puIGdp4buRbmcgbmfGsOG7nWkgdGjhuq10IGLhurFuZyBBREIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgICMgRXNjYXBlIHRleHQgxJHhu4MgdHLDoW5oIGzhu5dpIHbhu5tpIGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdAogICAgICAgICAgICAgICAgZXNjYXBlZF90ZXh0ID0gdGV4dC5yZXBsYWNlKCcgJywgJ1xcICcpLnJlcGxhY2UoJyYnLCAnXFwmJykucmVwbGFjZSgnKCcsICdcXCgnKS5yZXBsYWNlKCcpJywgJ1xcKScpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaOG7sWMgdGhpIEFEQiBpbnB1dCB0ZXh0CiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCAiaW5wdXQiLCAidGV4dCIsIGYiJ3tlc2NhcGVkX3RleHR9JyJdCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAibWVzc2FnZSI6IGYixJDDoyBuaOG6rXAgdGV4dCAne3RleHR9JyBi4bqxbmcgQURCIn0KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRmFsbGJhY2sgduG7gSBBUEkgbuG6v3Uga2jDtG5nIGPDsyBBREIKICAgICAgICAgICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgICAidGV4dCI6IHRleHQsCiAgICAgICAgICAgICAgICAgICAgInNwZWVkIjogc3BlZWQsCiAgICAgICAgICAgICAgICAgICAgImRpcmVjdF9tb2RlIjogc3RyKGRpcmVjdF9tb2RlKS5sb3dlcigpLAogICAgICAgICAgICAgICAgICAgICJwZXJmZWN0X21vZGUiOiBzdHIocGVyZmVjdF9tb2RlKS5sb3dlcigpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpbnB1dF90ZXh0IiwgcGFyYW1zPXBhcmFtcykKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlRpbWVvdXRFeHBpcmVkOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlRpbWVvdXQga2hpIGfhu61pIEFEQiBpbnB1dCB0ZXh0OiB7dGV4dH0iKQogICAgICAgICAgICAjIEZhbGxiYWNrIHbhu4EgQVBJCiAgICAgICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICJ0ZXh0IjogdGV4dCwKICAgICAgICAgICAgICAgICJzcGVlZCI6IHNwZWVkLAogICAgICAgICAgICAgICAgImRpcmVjdF9tb2RlIjogc3RyKGRpcmVjdF9tb2RlKS5sb3dlcigpLAogICAgICAgICAgICAgICAgInBlcmZlY3RfbW9kZSI6IHN0cihwZXJmZWN0X21vZGUpLmxvd2VyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpbnB1dF90ZXh0IiwgcGFyYW1zPXBhcmFtcykKICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgQURCIGlucHV0IHRleHQgJ3t0ZXh0fSc6IHtlfSIpCiAgICAgICAgICAgICMgRmFsbGJhY2sgduG7gSBBUEkKICAgICAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAgICAgInRleHQiOiB0ZXh0LAogICAgICAgICAgICAgICAgInNwZWVkIjogc3BlZWQsCiAgICAgICAgICAgICAgICAiZGlyZWN0X21vZGUiOiBzdHIoZGlyZWN0X21vZGUpLmxvd2VyKCksCiAgICAgICAgICAgICAgICAicGVyZmVjdF9tb2RlIjogc3RyKHBlcmZlY3RfbW9kZSkubG93ZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImlucHV0X3RleHQiLCBwYXJhbXM9cGFyYW1zKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2jDtG5nIHjDoWMgxJHhu4tuaCBraGkgZ+G7rWkgQURCIGlucHV0IHRleHQgJ3t0ZXh0fSc6IHtlfSIpCiAgICAgICAgICAgICMgRmFsbGJhY2sgduG7gSBBUEkKICAgICAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAgICAgInRleHQiOiB0ZXh0LAogICAgICAgICAgICAgICAgInNwZWVkIjogc3BlZWQsCiAgICAgICAgICAgICAgICAiZGlyZWN0X21vZGUiOiBzdHIoZGlyZWN0X21vZGUpLmxvd2VyKCksCiAgICAgICAgICAgICAgICAicGVyZmVjdF9tb2RlIjogc3RyKHBlcmZlY3RfbW9kZSkubG93ZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImlucHV0X3RleHQiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBzaG93X3RvYXN0KHNlbGYsIG1lc3NhZ2U6IHN0ciwgdHlwZV86IHN0ciA9ICJpbmZvIiwgCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBzdHIgPSAiYm90dG9tIikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIHRvYXN0CiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICJ0eXBlIjogdHlwZV8sCiAgICAgICAgICAgICJwb3NpdGlvbiI6IHBvc2l0aW9uCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInRvYXN0LW1lc3NhZ2UiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBnZXRfZGV2aWNlX2luZm8oc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGjDtG5nIHRpbiBjaGkgdGnhur90IHbhu4EgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0ID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJkZXZpY2UtaW5mbyIpCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBr4bq/dCBxdeG6oyB0aMOgbmggY8O0bmcsIHRow6ptIHRow7RuZyB0aW4gaW50ZXJuZXQgSVAgdsOgIHVzZXJfaWQKICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiByZXN1bHQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgaW50ZXJuZXQgSVAgYuG6sW5nIHJlcXVlc3RzCiAgICAgICAgICAgICAgICBpbnRlcm5ldF9pcCA9IHNlbGYuX2dldF9pbnRlcm5ldF9pcCgpCiAgICAgICAgICAgICAgICBpZiBpbnRlcm5ldF9pcDoKICAgICAgICAgICAgICAgICAgICByZXN1bHRbImRhdGEiXVsiaW50ZXJuZXRfaXAiXSA9IGludGVybmV0X2lwCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJpbnRlcm5ldF9pcCJdID0gInVua25vd24iCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGzhuqV5IGludGVybmV0IElQOiB7ZX0iKQogICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bImludGVybmV0X2lwIl0gPSAiZXJyb3IiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIHVzZXJfaWQgdOG7qyBkYXRhYmFzZSBjb25maWcgKMSRw6MgxJHGsOG7o2MgxJHhu41jIDEgbOG6p24ga2hpIGto4bufaSDEkeG7mW5nKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIENo4buJIGzhuqV5IHVzZXJfaWQgdOG7qyBkYXRhYmFzZSwga2jDtG5nIMSR4buNYyBmaWxlIG7hu69hCiAgICAgICAgICAgICAgICB1c2VyX2lkID0gc2VsZi5kYl9zZXJ2aWNlLmdldCgidXNlcl9pZCIpIGlmIGhhc2F0dHIoc2VsZiwgJ2RiX3NlcnZpY2UnKSBhbmQgc2VsZi5kYl9zZXJ2aWNlIGVsc2UgTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFRow6ptIHVzZXJfaWQgdsOgbyByZXN1bHQKICAgICAgICAgICAgICAgIGlmIHVzZXJfaWQ6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bInVzZXJfaWQiXSA9IHVzZXJfaWQKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bInVzZXJfaWQiXSA9ICJ1bmtub3duIgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBs4bqleSB1c2VyX2lkOiB7ZX0iKQogICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bInVzZXJfaWQiXSA9ICJlcnJvciIKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAKICAgIGRlZiBfZ2V0X2ludGVybmV0X2lwKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSDEkeG7i2EgY2jhu4kgSVAgY8O0bmcgY+G7mW5nIGLhurFuZyByZXF1ZXN0cwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogxJDhu4thIGNo4buJIElQIGPDtG5nIGPhu5luZyBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIiwgdGltZW91dD0zKQogICAgICAgICAgICBpcCA9IHJlc3BvbnNlLnRleHQuc3RyaXAoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIMSR4buLbmggZOG6oW5nIElQIMSRxqFuIGdp4bqjbgogICAgICAgICAgICBpZiByZS5tYXRjaChyJ15cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9JCcsIGlwKToKICAgICAgICAgICAgICAgIHJldHVybiBpcAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJL4bq/dCBxdeG6oyBraMO0bmcgcGjhuqNpIGzDoCBJUCBo4bujcCBs4buHOiB7aXB9IikKICAgICAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuVGltZW91dDoKICAgICAgICAgICAgcHJpbnQoIlRpbWVvdXQga2hpIGzhuqV5IGludGVybmV0IElQICgzIGdpw6J5KSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgaW50ZXJuZXQgSVA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraMO0bmcgeMOhYyDEkeG7i25oIGtoaSBs4bqleSBpbnRlcm5ldCBJUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIGNoZWNrX2ludGVybmV0KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSBr4bq/dCBu4buRaSBpbnRlcm5ldAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIGvhur90IG7hu5FpIGludGVybmV0LCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVGjhu60ga+G6v3QgbuG7kWkgxJHhur9uIEdvb2dsZSBETlMgduG7m2kgdGltZW91dCBuZ+G6r24KICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vOC44LjguOCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFRo4butIHbhu5tpIG3hu5l0IGRvbWFpbiBraMOhYwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vd3d3Lmdvb2dsZS5jb20iLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGdldF9sb2NhbF9pcChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgxJHhu4thIGNo4buJIElQIGxvY2FsIGPhu6dhIHRoaeG6v3QgYuG7iyB04burIGRldmljZSBpbmZvCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiDEkOG7i2EgY2jhu4kgSVAgbG9jYWwgaG/hurdjIGNodeG7l2kgcuG7l25nIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgIGlmIGRldmljZV9pbmZvLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gZGV2aWNlX2luZm86CiAgICAgICAgICAgICAgICByZXR1cm4gZGV2aWNlX2luZm9bImRhdGEiXS5nZXQoImxvY2FsX2lwIiwgIiIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgbG9jYWwgSVA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBkdW1wX3NjcmVlbl94bWwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIER1bXAgdG/DoG4gYuG7mSBj4bqldSB0csO6YyBYTUwgY+G7p2EgbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBUcuG6oyB24buBIG7hu5lpIGR1bmcgWE1MIGTGsOG7m2kgZOG6oW5nIGNodeG7l2kKICAgICAgICAiIiIKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiZHVtcC1zY3JlZW4teG1sIikKICAgICAgICBpZiByZXNwb25zZVsic3RhdHVzIl0gPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXQogICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBvcGVuX2FwcChzZWxmLCBwYWNrYWdlOiBzdHIsIGFjdGl2aXR5OiBzdHIgPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBN4bufIG3hu5l0IOG7qW5nIGThu6VuZyB24bubaSBwYWNrYWdlIG5hbWUgdsOgIGFjdGl2aXR5IGPhu6UgdGjhu4MKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7InBhY2thZ2UiOiBwYWNrYWdlfQogICAgICAgIGlmIGFjdGl2aXR5OgogICAgICAgICAgICBwYXJhbXNbImFjdGl2aXR5Il0gPSBhY3Rpdml0eQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoIm9wZW5fYXBwIiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgY2xvc2VfYXBwKHNlbGYsIHBhY2thZ2U6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgxJDDs25nIG3hu5l0IOG7qW5nIGThu6VuZyDEkWFuZyBjaOG6oXkKICAgICAgICDGr3UgdGnDqm4gc+G7rSBk4bulbmcgQURCIG7hur91IMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICAiIiIKICAgICAgICBpZiBzZWxmLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkMOzbmcg4bupbmcgZOG7pW5nIGLhurFuZyBBREIKICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJzaGVsbCIsIGYiYW0gZm9yY2Utc3RvcCB7cGFja2FnZX0iXQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJtZXNzYWdlIjogZiLEkMOjIMSRw7NuZyB7cGFja2FnZX0gYuG6sW5nIEFEQiJ9CiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHDs25nIOG7qW5nIGThu6VuZyBi4bqxbmcgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgIyBO4bq/dSBs4buXaSwgdGjhu60gcGjGsMahbmcgdGjhu6ljIEhUVFAKICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIEhUVFAgQVBJIG7hur91IGtow7RuZyBjw7MgQURCIGhv4bq3YyBBREIgYuG7iyBs4buXaQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2hvbWUiKQoKICAgIGRlZiBfc2FuaXRpemVfeG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MIMSR4buDIHRyw6FuaCBs4buXaSBraGkgcGjDom4gdMOtY2gKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogQ2h14buXaSBYTUwgY+G6p24geOG7rSBsw70KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBDaHXhu5dpIFhNTCDEkcOjIMSRxrDhu6NjIHjhu60gbMO9CiAgICAgICAgIiIiCiAgICAgICAgIyBUaGF5IHRo4bq/IGPDoWMga8O9IHThu7EgJiBraMO0bmcgaOG7o3AgbOG7hyBi4bqxbmcgJmFtcDsKICAgICAgICAjIE5oxrBuZyBnaeG7ryBuZ3V5w6puIGPDoWMgZW50aXR5IGjhu6NwIGzhu4cgbmjGsCAmYW1wOywgJmx0OywgJmd0OywgJnF1b3Q7LCAmYXBvczsKICAgICAgICB4bWxfY29udGVudCA9IHJlLnN1YihyJyYoPyEoYW1wfGx0fGd0fHF1b3R8YXBvcyk7KScsICcmYW1wOycsIHhtbF9jb250ZW50KQogICAgICAgIAogICAgICAgICMgTG/huqFpIGLhu48gY8OhYyBrw70gdOG7sSDEkWnhu4F1IGtoaeG7g24ga2jDtG5nIGjhu6NwIGzhu4cgdHJvbmcgWE1MCiAgICAgICAgeG1sX2NvbnRlbnQgPSByZS5zdWIocidbXHgwMC1ceDA4XHgwQlx4MENceDBFLVx4MUZdJywgJycsIHhtbF9jb250ZW50KQogICAgICAgIAogICAgICAgIHJldHVybiB4bWxfY29udGVudAoKICAgIGRlZiBmaW5kX2VsZW1lbnRfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIAogICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gcGjhuqduIHThu60gdHJvbmcgWE1MIGThu7FhIHRyw6puIHRleHQsIGNvbnRlbnQtZGVzYywgcmVzb3VyY2UtaWQsIGNsYXNzIGhv4bq3YyB2aXNpYmxlLXRvLXVzZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IFBo4bqnbiB04butIMSR4bqndSB0acOqbiB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjDonkgZOG7sW5nIFhQYXRoIHF1ZXJ5IGThu7FhIHRyw6puIGPDoWMgxJFp4buBdSBraeG7h24KICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBpZiBjb250YWluczoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYSB0cm9uZyB0ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnY29udGFpbnMoQHRleHQsICJ7dGV4dH0iKScpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMKICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdGV4dD0ie3RleHR9IicpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2MgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EgdHJvbmcgY29udGVudC1kZXNjCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnY29udGFpbnMoQGNvbnRlbnQtZGVzYywgIntjb250ZW50X2Rlc2N9IiknKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQGNvbnRlbnQtZGVzYz0ie2NvbnRlbnRfZGVzY30iJykKICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHJlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicpCiAgICAgICAgICAgICAgICBpZiBjbGFzc19uYW1lIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQGNsYXNzPSJ7Y2xhc3NfbmFtZX0iJykKICAgICAgICAgICAgICAgIGlmIHZpc2libGVfdG9fdXNlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3ZhbHVlID0gInRydWUiIGlmIHZpc2libGVfdG9fdXNlciBlbHNlICJmYWxzZSIKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0B2aXNpYmxlLXRvLXVzZXI9Int2aXNpYmxlX3ZhbHVlfSInKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSA9ICIvL25vZGUiCiAgICAgICAgICAgICAgICBpZiBjb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ICs9ICJbIiArICIgYW5kICIuam9pbihjb25kaXRpb25zKSArICJdIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gcGjhuqduIHThu60gxJHhuqd1IHRpw6puIHBow7kgaOG7o3AKICAgICAgICAgICAgICAgIGVsZW1lbnQgPSByb290LnhwYXRoKHhwYXRoX3F1ZXJ5KQogICAgICAgICAgICAgICAgaWYgZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZWxlbWVudF90b19kaWN0KGVsZW1lbnRbMF0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHTDrG0gcGjhuqduIHThu60gduG7m2kgbHhtbDoge2V9IikKICAgICAgICAKICAgICAgICAjIEZhbGxiYWNrOiBUw6xtIGtp4bq/bSBi4bqxbmcgcmVnZXgKICAgICAgICBpZiB0ZXh0OgogICAgICAgICAgICBpZiBjb250YWluczoKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EgdGhheSB2w6wga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZid0ZXh0PSJbXiJdKntyZS5lc2NhcGUodGV4dCl9W14iXSoiJwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUw6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMKICAgICAgICAgICAgICAgIHBhdHRlcm4gPSBmJ3RleHQ9Int0ZXh0fSInCiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNo4bupYSB0ZXh0CiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAKICAgICAgICBpZiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgIGlmIGNvbnRhaW5zOgogICAgICAgICAgICAgICAgIyBUw6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYSB0aGF5IHbDrCBraOG7m3AgY2jDrW5oIHjDoWMKICAgICAgICAgICAgICAgIHBhdHRlcm4gPSBmJ2NvbnRlbnQtZGVzYz0iW14iXSp7cmUuZXNjYXBlKGNvbnRlbnRfZGVzYyl9W14iXSoiJwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUw6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMKICAgICAgICAgICAgICAgIHBhdHRlcm4gPSBmJ2NvbnRlbnQtZGVzYz0ie2NvbnRlbnRfZGVzY30iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgY29udGVudC1kZXNjCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAKICAgICAgICBpZiByZXNvdXJjZV9pZDoKICAgICAgICAgICAgcGF0dGVybiA9IGYncmVzb3VyY2UtaWQ9IntyZXNvdXJjZV9pZH0iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgcmVzb3VyY2UtaWQKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgIGlmIGNsYXNzX25hbWU6CiAgICAgICAgICAgIHBhdHRlcm4gPSBmJ2NsYXNzPSJ7Y2xhc3NfbmFtZX0iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgY2xhc3MKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGRlZiBmaW5kX3BhcmVudF9lbGVtZW50X2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCBjaGlsZF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gZWxlbWVudCBjaGEgY+G7p2EgbeG7mXQgZWxlbWVudCBjb24gdHJvbmcgWE1MCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IE7hu5lpIGR1bmcgWE1MCiAgICAgICAgICAgIGNoaWxkX2VsZW1lbnQ6IEVsZW1lbnQgY29uIChkaWN0IHbhu5tpIGPDoWMgdGh14buZYyB0w61uaCBuaMawIGJvdW5kcywgdGV4dCwgZXRjLikKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBFbGVtZW50IGNoYSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQgb3Igbm90IGNoaWxkX2VsZW1lbnQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjDonkgZOG7sW5nIMSRaeG7gXUga2nhu4duIMSR4buDIHTDrG0gZWxlbWVudCBjb24gY2jDrW5oIHjDoWMKICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gY2hpbGRfZWxlbWVudC5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgIGlmIGtleSBpbiBbJ3RleHQnLCAnY29udGVudC1kZXNjJywgJ3Jlc291cmNlLWlkJywgJ2NsYXNzJywgJ2JvdW5kcycsICd2aXNpYmxlLXRvLXVzZXInXToKICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAe2tleX09Int2YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGNvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgPSAiLy9ub2RlWyIgKyAiIGFuZCAiLmpvaW4oY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgY29uCiAgICAgICAgICAgICAgICBjaGlsZF9ub2RlcyA9IHJvb3QueHBhdGgoeHBhdGhfcXVlcnkpCiAgICAgICAgICAgICAgICBpZiBjaGlsZF9ub2RlczoKICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IGVsZW1lbnQgY2hhIGPhu6dhIGVsZW1lbnQgY29uIMSR4bqndSB0acOqbiB0w6xtIMSRxrDhu6NjCiAgICAgICAgICAgICAgICAgICAgcGFyZW50X25vZGUgPSBjaGlsZF9ub2Rlc1swXS5nZXRwYXJlbnQoKQogICAgICAgICAgICAgICAgICAgIGlmIHBhcmVudF9ub2RlIGlzIG5vdCBOb25lIGFuZCBwYXJlbnRfbm9kZS50YWcgPT0gJ25vZGUnOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZWxlbWVudF90b19kaWN0KHBhcmVudF9ub2RlKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIGVsZW1lbnQgY2hhIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4IChwaOG7qWMgdOG6oXAgaMahbiBuaMawbmcgY+G6p24gdGhp4bq/dCkKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVMOsbSBib3VuZHMgY+G7p2EgZWxlbWVudCBjb24gxJHhu4MgeMOhYyDEkeG7i25oIHbhu4sgdHLDrQogICAgICAgICAgICBjaGlsZF9ib3VuZHMgPSBjaGlsZF9lbGVtZW50LmdldCgnYm91bmRzJywgJycpCiAgICAgICAgICAgIGlmIG5vdCBjaGlsZF9ib3VuZHM6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHBhdHRlcm4gY+G7p2EgZWxlbWVudCBjb24gdHJvbmcgWE1MCiAgICAgICAgICAgIGNoaWxkX3BhdHRlcm4gPSBOb25lCiAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGNoaWxkX2VsZW1lbnQuaXRlbXMoKToKICAgICAgICAgICAgICAgIGlmIGtleSBpbiBbJ3RleHQnLCAnY29udGVudC1kZXNjJywgJ3Jlc291cmNlLWlkJywgJ2NsYXNzJ10gYW5kIHZhbHVlOgogICAgICAgICAgICAgICAgICAgIGVzY2FwZWRfdmFsdWUgPSByZS5lc2NhcGUoc3RyKHZhbHVlKSkKICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZid7a2V5fT0ie2VzY2FwZWRfdmFsdWV9IicKICAgICAgICAgICAgICAgICAgICBpZiBwYXR0ZXJuIGluIHhtbF9jb250ZW50OgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZF9wYXR0ZXJuID0gcGF0dGVybgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGNoaWxkX3BhdHRlcm46CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHbhu4sgdHLDrSBj4bunYSBlbGVtZW50IGNvbiB0cm9uZyBYTUwKICAgICAgICAgICAgY2hpbGRfbWF0Y2ggPSByZS5zZWFyY2goY2hpbGRfcGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG5vdCBjaGlsZF9tYXRjaDoKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgcGF0dGVybiBuw6B5CiAgICAgICAgICAgIGNoaWxkX3N0YXJ0ID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgY2hpbGRfbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgaWYgY2hpbGRfc3RhcnQgPT0gLTE6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2hhIGLhurFuZyBjw6FjaCDEkeG6v20gbGV2ZWwKICAgICAgICAgICAgIyBUw6xtIG5nxrDhu6NjIGzhuqFpIMSR4buDIHTDrG0gdGjhursgbm9kZSBjaGEgZ+G6p24gbmjhuqV0CiAgICAgICAgICAgIHBhcmVudF9zdGFydCA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIGNoaWxkX3N0YXJ0KQogICAgICAgICAgICBpZiBwYXJlbnRfc3RhcnQgPT0gLTE6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgcGFyZW50X2VuZCA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBwYXJlbnRfc3RhcnQpICsgMQogICAgICAgICAgICBwYXJlbnRfY29udGVudCA9IHhtbF9jb250ZW50W3BhcmVudF9zdGFydDpwYXJlbnRfZW5kXQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhwYXJlbnRfY29udGVudCkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIGVsZW1lbnQgY2hhIHbhu5tpIHJlZ2V4OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZmluZF9jaGlsZF9lbGVtZW50c19pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgcGFyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgZWxlbWVudCBjb24gY+G7p2EgbeG7mXQgZWxlbWVudCBjaGEgdHJvbmcgWE1MCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IE7hu5lpIGR1bmcgWE1MCiAgICAgICAgICAgIHBhcmVudF9lbGVtZW50OiBFbGVtZW50IGNoYSAoZGljdCB24bubaSBjw6FjIHRodeG7mWMgdMOtbmggbmjGsCBib3VuZHMsIHRleHQsIGV0Yy4pCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggY8OhYyBlbGVtZW50IGNvbiB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIHJlc3VsdHMgPSBbXQogICAgICAgIAogICAgICAgIGlmIG5vdCB4bWxfY29udGVudCBvciBub3QgcGFyZW50X2VsZW1lbnQ6CiAgICAgICAgICAgIHJldHVybiByZXN1bHRzCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gZWxlbWVudCBjaGEgdHLGsOG7m2MKICAgICAgICAgICAgICAgIHBhcmVudF9jb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIHBhcmVudF9lbGVtZW50Lml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgaWYga2V5IGluIFsndGV4dCcsICdjb250ZW50LWRlc2MnLCAncmVzb3VyY2UtaWQnLCAnY2xhc3MnLCAnYm91bmRzJywgJ3Zpc2libGUtdG8tdXNlciddOgogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRfY29uZGl0aW9ucy5hcHBlbmQoZidAe2tleX09Int2YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHBhcmVudF9jb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHBhcmVudF94cGF0aCA9ICIvL25vZGVbIiArICIgYW5kICIuam9pbihwYXJlbnRfY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIHBhcmVudF9ub2RlcyA9IHJvb3QueHBhdGgocGFyZW50X3hwYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgcGFyZW50X25vZGVzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIGVsZW1lbnQgY29uIGPhu6dhIGVsZW1lbnQgY2hhCiAgICAgICAgICAgICAgICBmb3IgcGFyZW50X25vZGUgaW4gcGFyZW50X25vZGVzOgogICAgICAgICAgICAgICAgICAgICMgWMOieSBk4buxbmcgxJFp4buBdSBraeG7h24gdMOsbSBraeG6v20gY2hvIGVsZW1lbnQgY29uCiAgICAgICAgICAgICAgICAgICAgY2hpbGRfY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICAgICAgaWYgdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfY29uZGl0aW9ucy5hcHBlbmQoZidAdGV4dD0ie3RleHR9IicpCiAgICAgICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZF9jb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMuYXBwZW5kKGYnQHJlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicpCiAgICAgICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfY29uZGl0aW9ucy5hcHBlbmQoZidAY2xhc3M9IntjbGFzc19uYW1lfSInKQogICAgICAgICAgICAgICAgICAgIGlmIHZpc2libGVfdG9fdXNlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV92YWx1ZSA9ICJ0cnVlIiBpZiB2aXNpYmxlX3RvX3VzZXIgZWxzZSAiZmFsc2UiCiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMuYXBwZW5kKGYnQHZpc2libGUtdG8tdXNlcj0ie3Zpc2libGVfdmFsdWV9IicpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgY29uIHRyb25nIHBhcmVudCBub2RlCiAgICAgICAgICAgICAgICAgICAgY2hpbGRfeHBhdGggPSAiLi8vbm9kZSIKICAgICAgICAgICAgICAgICAgICBpZiBjaGlsZF9jb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZF94cGF0aCArPSAiWyIgKyAiIGFuZCAiLmpvaW4oY2hpbGRfY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjaGlsZF9ub2RlcyA9IHBhcmVudF9ub2RlLnhwYXRoKGNoaWxkX3hwYXRoKQogICAgICAgICAgICAgICAgICAgIGZvciBjaGlsZF9ub2RlIGluIGNoaWxkX25vZGVzOgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChzZWxmLl9lbGVtZW50X3RvX2RpY3QoY2hpbGRfbm9kZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIGVsZW1lbnQgY29uIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdHMKICAgIAogICAgZGVmIGZpbmRfY2hpbGRfZWxlbWVudF9pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgcGFyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gZWxlbWVudCBjb24gxJHhuqd1IHRpw6puIGPhu6dhIG3hu5l0IGVsZW1lbnQgY2hhIHRyb25nIFhNTAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICBwYXJlbnRfZWxlbWVudDogRWxlbWVudCBjaGEgKGRpY3QgduG7m2kgY8OhYyB0aHXhu5ljIHTDrW5oIG5oxrAgYm91bmRzLCB0ZXh0LCBldGMuKQogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogRWxlbWVudCBjb24gxJHhuqd1IHRpw6puIHTDrG0gdGjhuqV5IGhv4bq3YyBOb25lIG7hur91IGtow7RuZyB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIGNoaWxkX2VsZW1lbnRzID0gc2VsZi5maW5kX2NoaWxkX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgeG1sX2NvbnRlbnQsIHBhcmVudF9lbGVtZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIsIGNvbnRhaW5zCiAgICAgICAgKQogICAgICAgIHJldHVybiBjaGlsZF9lbGVtZW50c1swXSBpZiBjaGlsZF9lbGVtZW50cyBlbHNlIE5vbmUKICAgIAogICAgZGVmIGZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHBo4bqnbiB04butIHRyb25nIFhNTCBwaMO5IGjhu6NwIHbhu5tpIMSRaeG7gXUga2nhu4duCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IE7hu5lpIGR1bmcgWE1MCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggY8OhYyBwaOG6p24gdOG7rSB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIHJlc3VsdHMgPSBbXQogICAgICAgIAogICAgICAgIGlmIG5vdCB4bWxfY29udGVudDoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHMKICAgICAgICAgICAgCiAgICAgICAgaWYgTFhNTF9BVkFJTEFCTEU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTCDEkeG7gyB0csOhbmggbOG7l2kgRW50aXR5UmVmCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyBYUGF0aCBxdWVyeSBk4buxYSB0csOqbiBjw6FjIMSRaeG7gXUga2nhu4duCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EgdHJvbmcgdGV4dAogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ2NvbnRhaW5zKEB0ZXh0LCAie3RleHR9IiknKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRhaW5zOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRyb25nIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ2NvbnRhaW5zKEBjb250ZW50LWRlc2MsICJ7Y29udGVudF9kZXNjfSIpJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0BjbGFzcz0ie2NsYXNzX25hbWV9IicpCiAgICAgICAgICAgICAgICBpZiB2aXNpYmxlX3RvX3VzZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV92YWx1ZSA9ICJ0cnVlIiBpZiB2aXNpYmxlX3RvX3VzZXIgZWxzZSAiZmFsc2UiCiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdmlzaWJsZS10by11c2VyPSJ7dmlzaWJsZV92YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgPSAiLy9ub2RlIgogICAgICAgICAgICAgICAgaWYgY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSArPSAiWyIgKyAiIGFuZCAiLmpvaW4oY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgcGjhuqduIHThu60gcGjDuSBo4bujcAogICAgICAgICAgICAgICAgZWxlbWVudHMgPSByb290LnhwYXRoKHhwYXRoX3F1ZXJ5KQogICAgICAgICAgICAgICAgZm9yIGVsZW1lbnQgaW4gZWxlbWVudHM6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoc2VsZi5fZWxlbWVudF90b19kaWN0KGVsZW1lbnQpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIHBo4bqnbiB04butIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgICAgICAgICBwcmludChmIlRo4butIHTDrG0gcGjhuqduIHThu60gYuG6sW5nIHBoxrDGoW5nIHRo4bupYyB0aGF5IHRo4bq/Li4uIikKICAgICAgICAKICAgICAgICAjIEZhbGxiYWNrOiBUw6xtIGtp4bq/bSBi4bqxbmcgcmVnZXggKGNo4buJIHRy4bqjIHbhu4Ega+G6v3QgcXXhuqMgxJHGoW4gZ2nhuqNuKQogICAgICAgIGlmIG5vdCByZXN1bHRzIGFuZCB0ZXh0OgogICAgICAgICAgICBpZiBjb250YWluczoKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EgdGhheSB2w6wga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZid0ZXh0PSJbXiJdKntyZS5lc2NhcGUodGV4dCl9W14iXSoiJwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUw6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMKICAgICAgICAgICAgICAgIHBhdHRlcm4gPSBmJ3RleHQ9Int0ZXh0fSInCiAgICAgICAgICAgIGZvciBtYXRjaCBpbiByZS5maW5kaXRlcihwYXR0ZXJuLCB4bWxfY29udGVudCk6CiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KSkKICAgICAgICAKICAgICAgICBpZiBub3QgcmVzdWx0cyBhbmQgY29udGVudF9kZXNjOgogICAgICAgICAgICBpZiBjb250YWluczoKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EgdGhheSB2w6wga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZidjb250ZW50LWRlc2M9IlteIl0qe3JlLmVzY2FwZShjb250ZW50X2Rlc2MpfVteIl0qIicKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZidjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicKICAgICAgICAgICAgZm9yIG1hdGNoIGluIHJlLmZpbmRpdGVyKHBhdHRlcm4sIHhtbF9jb250ZW50KToKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzCiAgICAKICAgIGRlZiBfZXh0cmFjdF9hdHRyaWJ1dGVzKHNlbGYsIG5vZGVfY29udGVudDogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUcsOtY2ggeHXhuqV0IGPDoWMgdGh14buZYyB0w61uaCB04burIG7hu5lpIGR1bmcgY+G7p2EgbeG7mXQgdGjhursgbm9kZQogICAgICAgICIiIgogICAgICAgIGF0dHJpYnV0ZXMgPSB7fQogICAgICAgIAogICAgICAgICMgQ8OhYyB0aHXhu5ljIHTDrW5oIGPhuqduIHRyw61jaCB4deG6pXQKICAgICAgICBhdHRyX3BhdHRlcm5zID0gewogICAgICAgICAgICAiY2xhc3MiOiByJ2NsYXNzPSIoW14iXSopIicsCiAgICAgICAgICAgICJwYWNrYWdlIjogcidwYWNrYWdlPSIoW14iXSopIicsCiAgICAgICAgICAgICJyZXNvdXJjZS1pZCI6IHIncmVzb3VyY2UtaWQ9IihbXiJdKikiJywKICAgICAgICAgICAgInRleHQiOiByJ3RleHQ9IihbXiJdKikiJywKICAgICAgICAgICAgImNvbnRlbnQtZGVzYyI6IHInY29udGVudC1kZXNjPSIoW14iXSopIicsCiAgICAgICAgICAgICJib3VuZHMiOiByJ2JvdW5kcz0iKFteIl0qKSInLAogICAgICAgICAgICAiY2hlY2thYmxlIjogcidjaGVja2FibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImNoZWNrZWQiOiByJ2NoZWNrZWQ9IihbXiJdKikiJywKICAgICAgICAgICAgImNsaWNrYWJsZSI6IHInY2xpY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJlbmFibGVkIjogcidlbmFibGVkPSIoW14iXSopIicsCiAgICAgICAgICAgICJmb2N1c2FibGUiOiByJ2ZvY3VzYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAiZm9jdXNlZCI6IHInZm9jdXNlZD0iKFteIl0qKSInLAogICAgICAgICAgICAic2Nyb2xsYWJsZSI6IHInc2Nyb2xsYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAibG9uZy1jbGlja2FibGUiOiByJ2xvbmctY2xpY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJwYXNzd29yZCI6IHIncGFzc3dvcmQ9IihbXiJdKikiJywKICAgICAgICAgICAgInNlbGVjdGVkIjogcidzZWxlY3RlZD0iKFteIl0qKSInCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciBhdHRyX25hbWUsIHBhdHRlcm4gaW4gYXR0cl9wYXR0ZXJucy5pdGVtcygpOgogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCBub2RlX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgYXR0cmlidXRlc1thdHRyX25hbWVdID0gbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhdHRyaWJ1dGVzCgogICAgZGVmIF9lbGVtZW50X3RvX2RpY3Qoc2VsZiwgZWxlbWVudCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2h1eeG7g24gxJHhu5VpIG3hu5l0IHBo4bqnbiB04butIFhNTCB04burIGx4bWwgdGjDoG5oIGRpY3QKICAgICAgICAiIiIKICAgICAgICByZXN1bHQgPSB7fQogICAgICAgIAogICAgICAgICMgTOG6pXkgdOG6pXQgY+G6oyB0aHXhu5ljIHTDrW5oCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZWxlbWVudC5hdHRyaWIuaXRlbXMoKToKICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0CgogICAgZGVmIGZpbmRfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHBo4bqnbiB04butIHRyw6puIG3DoG4gaMOsbmggZOG7sWEgdHLDqm4gdGV4dCwgY29udGVudC1kZXNjLCByZXNvdXJjZS1pZCwgY2xhc3MgaG/hurdjIHZpc2libGUtdG8tdXNlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBQaOG6p24gdOG7rSDEkeG6p3UgdGnDqm4gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyLCBjb250YWlucykKCiAgICBkZWYgZmluZF9hbGxfZWxlbWVudHMoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHBo4bqnbiB04butIHRyw6puIG3DoG4gaMOsbmggcGjDuSBo4bujcCB24bubaSDEkWnhu4F1IGtp4buHbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggY8OhYyBwaOG6p24gdOG7rSB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCh4bWxfY29udGVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyLCBjb250YWlucykKCiAgICBkZWYgZmluZF9jaGlsZF9lbGVtZW50cyhzZWxmLCBwYXJlbnRfZWxlbWVudDogRGljdFtzdHIsIEFueV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBlbGVtZW50IGNvbiBj4bunYSBt4buZdCBlbGVtZW50IGNoYSB0csOqbiBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBhcmVudF9lbGVtZW50OiBFbGVtZW50IGNoYSAoZGljdCB24bubaSBjw6FjIHRodeG7mWMgdMOtbmggbmjGsCBib3VuZHMsIHRleHQsIGV0Yy4pCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggY8OhYyBlbGVtZW50IGNvbiB0w6xtIHRo4bqleQogICAgICAgICAgICAKICAgICAgICBFeGFtcGxlOgogICAgICAgICAgICAjIFTDrG0gdOG6pXQgY+G6oyBHcmlkVmlldyB0cm9uZyBt4buZdCBWaWV3R3JvdXAKICAgICAgICAgICAgcGFyZW50ID0gaGVscGVyLmZpbmRfZWxlbWVudChjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5WaWV3R3JvdXAiKQogICAgICAgICAgICBncmlkX3ZpZXdzID0gaGVscGVyLmZpbmRfY2hpbGRfZWxlbWVudHMocGFyZW50LCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5HcmlkVmlldyIpCiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9jaGlsZF9lbGVtZW50c19pbl94bWwoeG1sX2NvbnRlbnQsIHBhcmVudF9lbGVtZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIsIGNvbnRhaW5zKQoKICAgIGRlZiBmaW5kX2NoaWxkX2VsZW1lbnQoc2VsZiwgcGFyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gZWxlbWVudCBjb24gxJHhuqd1IHRpw6puIGPhu6dhIG3hu5l0IGVsZW1lbnQgY2hhIHRyw6puIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGFyZW50X2VsZW1lbnQ6IEVsZW1lbnQgY2hhIChkaWN0IHbhu5tpIGPDoWMgdGh14buZYyB0w61uaCBuaMawIGJvdW5kcywgdGV4dCwgZXRjLikKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IEVsZW1lbnQgY29uIMSR4bqndSB0acOqbiB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAgICAgCiAgICAgICAgRXhhbXBsZToKICAgICAgICAgICAgIyBUw6xtIG3hu5l0IFRleHRWaWV3IHRyb25nIG3hu5l0IExpbmVhckxheW91dCBj4bulIHRo4buDCiAgICAgICAgICAgIHBhcmVudCA9IGhlbHBlci5maW5kX2VsZW1lbnQoY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuTGluZWFyTGF5b3V0IiwgcmVzb3VyY2VfaWQ9ImNvbS5leGFtcGxlOmlkL2NvbnRhaW5lciIpCiAgICAgICAgICAgIHRleHRfdmlldyA9IGhlbHBlci5maW5kX2NoaWxkX2VsZW1lbnQocGFyZW50LCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5UZXh0VmlldyIpCiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9jaGlsZF9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgcGFyZW50X2VsZW1lbnQsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUsIHZpc2libGVfdG9fdXNlciwgY29udGFpbnMpCgogICAgZGVmIGdldF9uZXh0X2VsZW1lbnRfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIGN1cnJlbnRfZWxlbWVudDogRGljdFtzdHIsIEFueV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSBlbGVtZW50IHRp4bq/cCB0aGVvIChhbmggZW0pIGPhu6dhIGVsZW1lbnQgaGnhu4duIHThuqFpIHRyb25nIFhNTAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICBjdXJyZW50X2VsZW1lbnQ6IEVsZW1lbnQgaGnhu4duIHThuqFpIMSR4buDIGzDoG0gbeG7kWMKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBlbGVtZW50IHRp4bq/cCB0aGVvIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIGVsZW1lbnQgdGnhur9wIHRoZW8gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgZWxlbWVudCB0aeG6v3AgdGhlbyBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgZWxlbWVudCB0aeG6v3AgdGhlbyBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogRWxlbWVudCB0aeG6v3AgdGhlbyBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQgb3Igbm90IGN1cnJlbnRfZWxlbWVudDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgaWYgTFhNTF9BVkFJTEFCTEU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTAogICAgICAgICAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLl9zYW5pdGl6ZV94bWwoeG1sX2NvbnRlbnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUGFyc2UgWE1MIHbhu5tpIHTDuXkgY2jhu41uIHJlY292ZXIgxJHhu4MgeOG7rSBsw70gbOG7l2kKICAgICAgICAgICAgICAgIHBhcnNlciA9IGV0cmVlLlhNTFBhcnNlcihyZWNvdmVyPVRydWUpCiAgICAgICAgICAgICAgICByb290ID0gZXRyZWUuZnJvbXN0cmluZyh4bWxfY29udGVudC5lbmNvZGUoJ3V0Zi04JyksIHBhcnNlcj1wYXJzZXIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBlbGVtZW50IGhp4buHbiB04bqhaSB0csaw4bubYwogICAgICAgICAgICAgICAgY3VycmVudF9jb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGN1cnJlbnRfZWxlbWVudC5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgIGlmIGtleSBpbiBbJ3RleHQnLCAnY29udGVudC1kZXNjJywgJ3Jlc291cmNlLWlkJywgJ2NsYXNzJywgJ2JvdW5kcycsICd2aXNpYmxlLXRvLXVzZXInXToKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9jb25kaXRpb25zLmFwcGVuZChmJ0B7a2V5fT0ie3ZhbHVlfSInKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgY3VycmVudF9jb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN1cnJlbnRfeHBhdGggPSAiLy9ub2RlWyIgKyAiIGFuZCAiLmpvaW4oY3VycmVudF9jb25kaXRpb25zKSArICJdIgogICAgICAgICAgICAgICAgY3VycmVudF9ub2RlcyA9IHJvb3QueHBhdGgoY3VycmVudF94cGF0aCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGN1cnJlbnRfbm9kZXM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3VycmVudF9ub2RlID0gY3VycmVudF9ub2Rlc1swXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gZWxlbWVudCB0aeG6v3AgdGhlbyAoZm9sbG93aW5nLXNpYmxpbmcpCiAgICAgICAgICAgICAgICBuZXh0X2NvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBpZiBjb250YWluczoKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dF9jb25kaXRpb25zLmFwcGVuZChmJ2NvbnRhaW5zKEB0ZXh0LCAie3RleHR9IiknKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfY29uZGl0aW9ucy5hcHBlbmQoZidAdGV4dD0ie3RleHR9IicpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2MgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfY29uZGl0aW9ucy5hcHBlbmQoZidjb250YWlucyhAY29udGVudC1kZXNjLCAie2NvbnRlbnRfZGVzY30iKScpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dF9jb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBuZXh0X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHJlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicpCiAgICAgICAgICAgICAgICBpZiBjbGFzc19uYW1lIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIG5leHRfY29uZGl0aW9ucy5hcHBlbmQoZidAY2xhc3M9IntjbGFzc19uYW1lfSInKQogICAgICAgICAgICAgICAgaWYgdmlzaWJsZV90b191c2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdmFsdWUgPSAidHJ1ZSIgaWYgdmlzaWJsZV90b191c2VyIGVsc2UgImZhbHNlIgogICAgICAgICAgICAgICAgICAgIG5leHRfY29uZGl0aW9ucy5hcHBlbmQoZidAdmlzaWJsZS10by11c2VyPSJ7dmlzaWJsZV92YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGFuaCBlbSB0aeG6v3AgdGhlbwogICAgICAgICAgICAgICAgbmV4dF94cGF0aCA9ICJmb2xsb3dpbmctc2libGluZzo6bm9kZSIKICAgICAgICAgICAgICAgIGlmIG5leHRfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICBuZXh0X3hwYXRoICs9ICJbIiArICIgYW5kICIuam9pbihuZXh0X2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG5leHRfbm9kZXMgPSBjdXJyZW50X25vZGUueHBhdGgobmV4dF94cGF0aCkKICAgICAgICAgICAgICAgIGlmIG5leHRfbm9kZXM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VsZW1lbnRfdG9fZGljdChuZXh0X25vZGVzWzBdKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIGVsZW1lbnQgdGnhur9wIHRoZW8gduG7m2kgbHhtbDoge2V9IikKICAgICAgICAKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBnZXRfcHJldl9lbGVtZW50X2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCBjdXJyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gZWxlbWVudCB0csaw4bubYyDEkcOzIChhbmggZW0pIGPhu6dhIGVsZW1lbnQgaGnhu4duIHThuqFpIHRyb25nIFhNTAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICBjdXJyZW50X2VsZW1lbnQ6IEVsZW1lbnQgaGnhu4duIHThuqFpIMSR4buDIGzDoG0gbeG7kWMKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBlbGVtZW50IHRyxrDhu5tjIMSRw7MgY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgZWxlbWVudCB0csaw4bubYyDEkcOzIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgZWxlbWVudCB0csaw4bubYyDEkcOzIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBFbGVtZW50IHRyxrDhu5tjIMSRw7MgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50IG9yIG5vdCBjdXJyZW50X2VsZW1lbnQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gZWxlbWVudCBoaeG7h24gdOG6oWkgdHLGsOG7m2MKICAgICAgICAgICAgICAgIGN1cnJlbnRfY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBjdXJyZW50X2VsZW1lbnQuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBpZiBrZXkgaW4gWyd0ZXh0JywgJ2NvbnRlbnQtZGVzYycsICdyZXNvdXJjZS1pZCcsICdjbGFzcycsICdib3VuZHMnLCAndmlzaWJsZS10by11c2VyJ106CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfY29uZGl0aW9ucy5hcHBlbmQoZidAe2tleX09Int2YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGN1cnJlbnRfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdXJyZW50X3hwYXRoID0gIi8vbm9kZVsiICsgIiBhbmQgIi5qb2luKGN1cnJlbnRfY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIGN1cnJlbnRfbm9kZXMgPSByb290LnhwYXRoKGN1cnJlbnRfeHBhdGgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBjdXJyZW50X25vZGVzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN1cnJlbnRfbm9kZSA9IGN1cnJlbnRfbm9kZXNbMF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyAocHJlY2VkaW5nLXNpYmxpbmcpCiAgICAgICAgICAgICAgICBwcmV2X2NvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBpZiBjb250YWluczoKICAgICAgICAgICAgICAgICAgICAgICAgcHJldl9jb25kaXRpb25zLmFwcGVuZChmJ2NvbnRhaW5zKEB0ZXh0LCAie3RleHR9IiknKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZfY29uZGl0aW9ucy5hcHBlbmQoZidAdGV4dD0ie3RleHR9IicpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2MgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZfY29uZGl0aW9ucy5hcHBlbmQoZidjb250YWlucyhAY29udGVudC1kZXNjLCAie2NvbnRlbnRfZGVzY30iKScpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJldl9jb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBwcmV2X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHJlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicpCiAgICAgICAgICAgICAgICBpZiBjbGFzc19uYW1lIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHByZXZfY29uZGl0aW9ucy5hcHBlbmQoZidAY2xhc3M9IntjbGFzc19uYW1lfSInKQogICAgICAgICAgICAgICAgaWYgdmlzaWJsZV90b191c2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdmFsdWUgPSAidHJ1ZSIgaWYgdmlzaWJsZV90b191c2VyIGVsc2UgImZhbHNlIgogICAgICAgICAgICAgICAgICAgIHByZXZfY29uZGl0aW9ucy5hcHBlbmQoZidAdmlzaWJsZS10by11c2VyPSJ7dmlzaWJsZV92YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGFuaCBlbSB0csaw4bubYyDEkcOzIChs4bqleSBjw6FpIGN14buRaSBjw7luZyB2w6wgcHJlY2VkaW5nLXNpYmxpbmcgdHLhuqMgduG7gSB0aGVvIHRo4bupIHThu7EgbmfGsOG7o2MpCiAgICAgICAgICAgICAgICBwcmV2X3hwYXRoID0gInByZWNlZGluZy1zaWJsaW5nOjpub2RlIgogICAgICAgICAgICAgICAgaWYgcHJldl9jb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHByZXZfeHBhdGggKz0gIlsiICsgIiBhbmQgIi5qb2luKHByZXZfY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcHJldl9ub2RlcyA9IGN1cnJlbnRfbm9kZS54cGF0aChwcmV2X3hwYXRoKQogICAgICAgICAgICAgICAgaWYgcHJldl9ub2RlczoKICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IGVsZW1lbnQgY3Xhu5FpIGPDuW5nIHbDrCBwcmVjZWRpbmctc2libGluZyB0cuG6oyB24buBIHRoZW8gdGjhu6kgdOG7sSBuZ8aw4bujYwogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbGVtZW50X3RvX2RpY3QocHJldl9ub2Rlc1stMV0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHTDrG0gZWxlbWVudCB0csaw4bubYyDEkcOzIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgZ2V0X25leHRfZWxlbWVudChzZWxmLCBjdXJyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gZWxlbWVudCB0aeG6v3AgdGhlbyAoYW5oIGVtKSBj4bunYSBlbGVtZW50IGhp4buHbiB04bqhaSB0csOqbiBtw6BuIGjDrG5oCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY3VycmVudF9lbGVtZW50OiBFbGVtZW50IGhp4buHbiB04bqhaSDEkeG7gyBsw6BtIG3hu5FjCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgZWxlbWVudCB0aeG6v3AgdGhlbyBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBlbGVtZW50IHRp4bq/cCB0aGVvIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgdGnhur9wIHRoZW8gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIGVsZW1lbnQgdGnhur9wIHRoZW8gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IEVsZW1lbnQgdGnhur9wIHRoZW8gaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgICAgIAogICAgICAgIEV4YW1wbGU6CiAgICAgICAgICAgICMgVMOsbSBidXR0b24gdGnhur9wIHRoZW8gc2F1IGJ1dHRvbiBoaeG7h24gdOG6oWkKICAgICAgICAgICAgY3VycmVudF9idG4gPSBoZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IlByZXZpb3VzIikKICAgICAgICAgICAgbmV4dF9idG4gPSBoZWxwZXIuZ2V0X25leHRfZWxlbWVudChjdXJyZW50X2J0biwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuQnV0dG9uIikKICAgICAgICAiIiIKICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICByZXR1cm4gc2VsZi5nZXRfbmV4dF9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgY3VycmVudF9lbGVtZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIsIGNvbnRhaW5zKQoKICAgIGRlZiBnZXRfcHJldl9lbGVtZW50KHNlbGYsIGN1cnJlbnRfZWxlbWVudDogRGljdFtzdHIsIEFueV0sCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSBlbGVtZW50IHRyxrDhu5tjIMSRw7MgKGFuaCBlbSkgY+G7p2EgZWxlbWVudCBoaeG7h24gdOG6oWkgdHLDqm4gbcOgbiBow6xuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGN1cnJlbnRfZWxlbWVudDogRWxlbWVudCBoaeG7h24gdOG6oWkgxJHhu4MgbMOgbSBt4buRYwogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBlbGVtZW50IHRyxrDhu5tjIMSRw7MgY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgZWxlbWVudCB0csaw4bubYyDEkcOzIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBlbGVtZW50IHRyxrDhu5tjIMSRw7MgY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IEVsZW1lbnQgdHLGsOG7m2MgxJHDsyBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAgICAgCiAgICAgICAgRXhhbXBsZToKICAgICAgICAgICAgIyBUw6xtIGJ1dHRvbiB0csaw4bubYyDEkcOzIHRyxrDhu5tjIGJ1dHRvbiBoaeG7h24gdOG6oWkKICAgICAgICAgICAgY3VycmVudF9idG4gPSBoZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9Ik5leHQiKQogICAgICAgICAgICBwcmV2X2J0biA9IGhlbHBlci5nZXRfcHJldl9lbGVtZW50KGN1cnJlbnRfYnRuLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iKQogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmdldF9wcmV2X2VsZW1lbnRfaW5feG1sKHhtbF9jb250ZW50LCBjdXJyZW50X2VsZW1lbnQsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUsIHZpc2libGVfdG9fdXNlciwgY29udGFpbnMpCgogICAgZGVmIGlzX2VsZW1lbnRfc2VsZWN0ZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGNo4buNbiBoYXkga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJzZWxlY3RlZCIpID09ICJ0cnVlIgoKICAgIGRlZiB3YWl0X2Zvcl9lbGVtZW50KHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCB0aW1lb3V0OiBpbnQgPSAzMCwgCiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG3hu5l0IHBo4bqnbiB04butIHh14bqldCBoaeG7h24gdHLDqm4gbcOgbiBow6xuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgdGltZW91dDogVGjhu51pIGdpYW4gY2jhu50gdOG7kWkgxJFhIChnacOieSkKICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IEtob+G6o25nIHRo4budaSBnaWFuIGdp4buvYSBjw6FjIGzhuqduIGtp4buDbSB0cmEgKGdpw6J5KQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IFBo4bqnbiB04butIHTDrG0gdGjhuqV5IGhv4bq3YyBOb25lIG7hur91IHRpbWVvdXQKICAgICAgICAiIiIKICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5maW5kX2VsZW1lbnQodGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyLCBjb250YWlucykKICAgICAgICAgICAgaWYgZWxlbWVudDoKICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdGltZS5zbGVlcChjaGVja19pbnRlcnZhbCkKICAgICAgICAKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiB3YWl0X3RvX3RhcF9lbGVtZW50KHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCB0aW1lb3V0OiBpbnQgPSAzMCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxLCBkZWxheV9iZWZvcmVfdGFwOiBpbnQgPSAxLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIENo4budIMSR4bujaSBlbGVtZW50IHh14bqldCBoaeG7h24sIGRlbGF5IG3hu5l0IGtob+G6o25nIHRo4budaSBnaWFuLCBy4buTaSB0YXAgdsOgbyBlbGVtZW50CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICB0aW1lb3V0OiBUaOG7nWkgZ2lhbiBjaOG7nSB04buRaSDEkWEgxJHhu4MgdMOsbSBlbGVtZW50IChnacOieSkKICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IEtob+G6o25nIHRo4budaSBnaWFuIGdp4buvYSBjw6FjIGzhuqduIGtp4buDbSB0cmEgKGdpw6J5KQogICAgICAgICAgICBkZWxheV9iZWZvcmVfdGFwOiBUaOG7nWkgZ2lhbiBkZWxheSB0csaw4bubYyBraGkgdGFwIChnacOieSwgbeG6t2MgxJHhu4tuaCAxIGdpw6J5KQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIENo4budIGVsZW1lbnQgeHXhuqV0IGhp4buHbgogICAgICAgICAgICBlbGVtZW50ID0gc2VsZi53YWl0X2Zvcl9lbGVtZW50KAogICAgICAgICAgICAgICAgdGV4dD10ZXh0LCAKICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYz1jb250ZW50X2Rlc2MsIAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9cmVzb3VyY2VfaWQsIAogICAgICAgICAgICAgICAgY2xhc3NfbmFtZT1jbGFzc19uYW1lLAogICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyPXZpc2libGVfdG9fdXNlciwgCiAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQsIAogICAgICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw9Y2hlY2tfaW50ZXJ2YWwsCiAgICAgICAgICAgICAgICBjb250YWlucz1jb250YWlucwogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgICAgICMgVOG6oW8gdGjDtG5nIGLDoW8gbOG7l2kgY2hpIHRp4bq/dAogICAgICAgICAgICAgICAgY3JpdGVyaWEgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJ0ZXh0PSd7dGV4dH0nIikKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJjb250ZW50X2Rlc2M9J3tjb250ZW50X2Rlc2N9JyIpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZDoKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJyZXNvdXJjZV9pZD0ne3Jlc291cmNlX2lkfSciKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZToKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJjbGFzc19uYW1lPSd7Y2xhc3NfbmFtZX0nIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3JpdGVyaWFfc3RyID0gIiwgIi5qb2luKGNyaXRlcmlhKSBpZiBjcml0ZXJpYSBlbHNlICJraMO0bmcgeMOhYyDEkeG7i25oIgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdMOsbSB0aOG6pXkgZWxlbWVudCBzYXUge3RpbWVvdXR9cyB24bubaSB0acOqdSBjaMOtOiB7Y3JpdGVyaWFfc3RyfSIKICAgICAgICAgICAgICAgIHByaW50KGVycm9yX21zZykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIERlbGF5IHRyxrDhu5tjIGtoaSB0YXAKICAgICAgICAgICAgaWYgZGVsYXlfYmVmb3JlX3RhcCA+IDA6CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKGRlbGF5X2JlZm9yZV90YXApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRhcCB2w6BvIGVsZW1lbnQKICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi50YXBfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyB0YXAKICAgICAgICAgICAgaWYgcmVzdWx0LmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgZWxlbWVudF9pbmZvID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQ6CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9pbmZvLmFwcGVuZChmInRleHQ9J3t0ZXh0fSciKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mby5hcHBlbmQoZiJjb250ZW50X2Rlc2M9J3tjb250ZW50X2Rlc2N9JyIpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZDoKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8uYXBwZW5kKGYicmVzb3VyY2VfaWQ9J3tyZXNvdXJjZV9pZH0nIikKICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWU6CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9pbmZvLmFwcGVuZChmImNsYXNzX25hbWU9J3tjbGFzc19uYW1lfSciKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGVtZW50X3N0ciA9ICIsICIuam9pbihlbGVtZW50X2luZm8pIGlmIGVsZW1lbnRfaW5mbyBlbHNlICJlbGVtZW50IgogICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIHRhcCB0aMOgbmggY8O0bmcgdsOgbyB7ZWxlbWVudF9zdHJ9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0YXAgZWxlbWVudDoge3Jlc3VsdC5nZXQoJ21lc3NhZ2UnLCAnS2jDtG5nIHjDoWMgxJHhu4tuaCcpfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIHRyb25nIHdhaXRfdG9fdGFwX2VsZW1lbnQ6IHtzdHIoZSl9IgogICAgICAgICAgICBwcmludChlcnJvcl9tc2cpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBnZXRfZWxlbWVudF90ZXh0KHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGV4dCBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgidGV4dCIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY29udGVudF9kZXNjKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgY29udGVudC1kZXNjIGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X3Jlc291cmNlX2lkKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgcmVzb3VyY2UtaWQgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoInJlc291cmNlLWlkIiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jbGFzcyhzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGNsYXNzIGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjbGFzcyIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfZW5hYmxlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2Mga8OtY2ggaG/huqF0IGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiZW5hYmxlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2xpY2thYmxlKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyB0aOG7gyBuaOG6pXAgdsOgbyBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImNsaWNrYWJsZSIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfZm9jdXNlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2MgZm9jdXMga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJmb2N1c2VkIikgPT0gInRydWUiCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jaGVja2VkKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyDEkcaw4bujYyBjaOG7jW4ga2jDtG5nIChjaG8gY2hlY2tib3gpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjaGVja2VkIikgPT0gInRydWUiCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9ib3VuZHMoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IFR1cGxlW2ludCwgaW50LCBpbnQsIGludF06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdOG7jWEgxJHhu5kgYm91bmRzIGPhu6dhIHBo4bqnbiB04butIGTGsOG7m2kgZOG6oW5nIHR1cGxlICh4MSwgeTEsIHgyLCB5MikKICAgICAgICBY4butIGzDvSBjw6FjIHRyxrDhu51uZyBo4bujcCBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4cgKMOibSwgMCwgaG/hurdjIGZvcm1hdCBzYWkpCiAgICAgICAgIiIiCiAgICAgICAgYm91bmRzID0gZWxlbWVudC5nZXQoImJvdW5kcyIsICJbMCwwXVswLDBdIikKICAgICAgICAKICAgICAgICAjIFRo4butIGPDoWMgcGF0dGVybiBraMOhYyBuaGF1IMSR4buDIHBhcnNlIGJvdW5kcwogICAgICAgIHBhdHRlcm5zID0gWwogICAgICAgICAgICByIlxbKC0/XGQrKSwoLT9cZCspXF1cWygtP1xkKyksKC0/XGQrKVxdIiwgICMgUGF0dGVybiBoaeG7h24gdOG6oWksIGNobyBwaMOpcCBz4buRIMOibQogICAgICAgICAgICByIigtP1xkKyksKC0/XGQrKSwoLT9cZCspLCgtP1xkKykiLCAgICAgICAgICMgUGF0dGVybjogeDEseTEseDIseTIKICAgICAgICAgICAgciJcWygtP1xkKyk7KC0/XGQrKVxdXFsoLT9cZCspOygtP1xkKylcXSIgICAjIFBhdHRlcm4gduG7m2kgZOG6pXUgOwogICAgICAgIF0KICAgICAgICAKICAgICAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICAgICAgbWF0Y2ggPSByZS5tYXRjaChwYXR0ZXJuLCBib3VuZHMpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBtYXAoaW50LCBtYXRjaC5ncm91cHMoKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBT4butYSBjaOG7r2EgYm91bmRzIGtow7RuZyBo4bujcCBs4buHCiAgICAgICAgICAgICAgICAjIE7hur91IGPDsyB04buNYSDEkeG7mSDDom0sIMSRaeG7gXUgY2jhu4luaAogICAgICAgICAgICAgICAgaWYgeTEgPCAwIG9yIHkyIDwgMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBCb3VuZHMgY8OzIHThu41hIMSR4buZIHkgw6JtOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgeTIgw6JtLCBjw7MgdGjhu4MgZWxlbWVudCBu4bqxbSB0csOqbiB0aGFuaCBzdGF0dXMgYmFyCiAgICAgICAgICAgICAgICAgICAgaWYgeTIgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICAjIMSQaeG7gXUgY2jhu4luaCDEkeG7gyBlbGVtZW50IGPDsyB0aOG7gyB0YXAgxJHGsOG7o2MKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gYWJzKHkyIC0geTEpICAjIENoaeG7gXUgY2FvIGVsZW1lbnQKICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSBtYXgoMCwgeTEpICAjIMSQ4bqjbSBi4bqjbyB5MSA+PSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHkyID0geTEgKyBoZWlnaHQgICMgxJDhurd0IHkyIGTGsMahbmcKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIMSRaeG7gXUgY2jhu4luaCBib3VuZHMgdGjDoG5oOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB4MSA8IDAgb3IgeDIgPCAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW86IEJvdW5kcyBjw7MgdOG7jWEgxJHhu5kgeCDDom06ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgICAgICAgICAgIyBUxrDGoW5nIHThu7EgduG7m2kgeAogICAgICAgICAgICAgICAgICAgIGlmIHgyIDwgMDoKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSBhYnMoeDIgLSB4MSkKICAgICAgICAgICAgICAgICAgICAgICAgeDEgPSBtYXgoMCwgeDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHgyID0geDEgKyB3aWR0aAogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgxJFp4buBdSBjaOG7iW5oIGJvdW5kcyB0aMOgbmg6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBib3VuZHMgaOG7o3AgbOG7hyBzYXUga2hpIMSRaeG7gXUgY2jhu4luaAogICAgICAgICAgICAgICAgaWYgeDEgPCB4MiBhbmQgeTEgPCB5MiBhbmQgbm90ICh4MSA9PSAwIGFuZCB5MSA9PSAwIGFuZCB4MiA9PSAwIGFuZCB5MiA9PSAwKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHgxLCB5MSwgeDIsIHkyKQogICAgICAgIAogICAgICAgICMgTuG6v3Uga2jDtG5nIHBhcnNlIMSRxrDhu6NjIGhv4bq3YyB04bqldCBj4bqjIGzDoCAwLCB0aOG7rSBs4bqleSB04burIHRodeG7mWMgdMOtbmgga2jDoWMKICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBLaMO0bmcgdGjhu4MgcGFyc2UgYm91bmRzICd7Ym91bmRzfScgY+G7p2EgZWxlbWVudCwgdGjhu60gcGjGsMahbmcgcGjDoXAga2jDoWMuLi4iKQogICAgICAgIAogICAgICAgICMgVGjhu60gbOG6pXkgdOG7qyBjw6FjIHRodeG7mWMgdMOtbmgga2jDoWMgbuG6v3UgY8OzCiAgICAgICAgeCA9IGVsZW1lbnQuZ2V0KCJ4IiwgMCkKICAgICAgICB5ID0gZWxlbWVudC5nZXQoInkiLCAwKQogICAgICAgIHdpZHRoID0gZWxlbWVudC5nZXQoIndpZHRoIiwgMTAwKSAgIyBEZWZhdWx0IHdpZHRoCiAgICAgICAgaGVpZ2h0ID0gZWxlbWVudC5nZXQoImhlaWdodCIsIDUwKSAgIyBEZWZhdWx0IGhlaWdodAogICAgICAgIAogICAgICAgIGlmIHggb3IgeSBvciB3aWR0aCAhPSAxMDAgb3IgaGVpZ2h0ICE9IDUwOiAgIyBDw7Mgw610IG5o4bqldCBt4buZdCB0aHXhu5ljIHTDrW5oIGtow6FjIDAvZGVmYXVsdAogICAgICAgICAgICByZXR1cm4gKHgsIHksIHggKyB3aWR0aCwgeSArIGhlaWdodCkKICAgICAgICAKICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBFbGVtZW50IGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hywgc+G7rSBk4bulbmcgdOG7jWEgxJHhu5kgbeG6t2MgxJHhu4tuaCIpCiAgICAgICAgcmV0dXJuICgwLCAwLCAxMDAsIDUwKSAgIyBGYWxsYmFjayBib3VuZHMgbmjhu48KICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NlbnRlcihzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gVHVwbGVbaW50LCBpbnRdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHThu41hIMSR4buZIHRydW5nIHTDom0gY+G7p2EgcGjhuqduIHThu60gduG7m2kgeOG7rSBsw70gbOG7l2kgbsOibmcgY2FvCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgIHByaW50KCJD4bqjbmggYsOhbzogRWxlbWVudCBsw6AgTm9uZSBob+G6t2MgcuG7l25nIikKICAgICAgICAgICAgcmV0dXJuICgwLCAwKQogICAgICAgICAgICAKICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IHNlbGYuZ2V0X2VsZW1lbnRfYm91bmRzKGVsZW1lbnQpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGJvdW5kcyBo4bujcCBs4buHCiAgICAgICAgaWYgeDEgPj0geDIgb3IgeTEgPj0geTI6CiAgICAgICAgICAgIGJvdW5kc19zdHIgPSBlbGVtZW50LmdldCgiYm91bmRzIiwgIiIpCiAgICAgICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW86IEJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hyAne2JvdW5kc19zdHJ9JzogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgYm91bmRzIGtow7RuZyBo4bujcCBs4buHLCB0cuG6oyB24buBIHThu41hIMSR4buZIGFuIHRvw6BuIOG7nyBnaeG7r2EgbcOgbiBow6xuaAogICAgICAgICAgICBzY3JlZW5fd2lkdGgsIHNjcmVlbl9oZWlnaHQgPSBzZWxmLmdldF9zY3JlZW5fc2l6ZSgpCiAgICAgICAgICAgIGlmIHNjcmVlbl93aWR0aCA+IDAgYW5kIHNjcmVlbl9oZWlnaHQgPiAwOgogICAgICAgICAgICAgICAgY2VudGVyX3ggPSBzY3JlZW5fd2lkdGggLy8gMgogICAgICAgICAgICAgICAgY2VudGVyX3kgPSBzY3JlZW5faGVpZ2h0IC8vIDIKICAgICAgICAgICAgICAgIHJldHVybiAoY2VudGVyX3gsIGNlbnRlcl95KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuICg1NDAsIDk2MCkgICMgVOG7jWEgxJHhu5kgbeG6t2MgxJHhu4tuaCBjaG8gbcOgbiBow6xuaCAxMDgweDE5MjAKICAgICAgICAKICAgICAgICBjZW50ZXJfeCA9ICh4MSArIHgyKSAvLyAyCiAgICAgICAgY2VudGVyX3kgPSAoeTEgKyB5MikgLy8gMgogICAgICAgIAogICAgICAgICMgVGjDqm0gbeG7mXQgY2jDunQgcmFuZG9tIMSR4buDIHRyw6FuaCBkZXRlY3Rpb24gKMKxMyBwaXhlbHMpCiAgICAgICAgY2VudGVyX3ggKz0gcmFuZG9tLnJhbmRpbnQoLTMsIDMpCiAgICAgICAgY2VudGVyX3kgKz0gcmFuZG9tLnJhbmRpbnQoLTMsIDMpCiAgICAgICAgCiAgICAgICAgIyDEkOG6o20gYuG6o28gdOG7jWEgxJHhu5kgdHJvbmcgcGjhuqFtIHZpIG3DoG4gaMOsbmgKICAgICAgICBzY3JlZW5fd2lkdGgsIHNjcmVlbl9oZWlnaHQgPSBzZWxmLmdldF9zY3JlZW5fc2l6ZSgpCiAgICAgICAgaWYgc2NyZWVuX3dpZHRoID4gMCBhbmQgc2NyZWVuX2hlaWdodCA+IDA6CiAgICAgICAgICAgIGNlbnRlcl94ID0gbWF4KDEwLCBtaW4oY2VudGVyX3gsIHNjcmVlbl93aWR0aCAtIDEwKSkgICMgTWFyZ2luIDEwcHggdOG7qyBiacOqbgogICAgICAgICAgICBjZW50ZXJfeSA9IG1heCgxMCwgbWluKGNlbnRlcl95LCBzY3JlZW5faGVpZ2h0IC0gMTApKQogICAgICAgIAogICAgICAgIHJldHVybiAoY2VudGVyX3gsIGNlbnRlcl95KQogICAgCiAgICBkZWYgdGFwX2VsZW1lbnRfY2VudGVyKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaOG6oW0gdsOgbyBwaOG6p24gdOG7rSB24bubaSB0w61uaCByYW5kb20gKHPhu60gZOG7pW5nIHRhcF9lbGVtZW50IGLDqm4gdHJvbmcpCiAgICAgICAgTuG6v3UgZWxlbWVudCBxdcOhIG5o4buPIHRow6wgbeG7m2kgZMO5bmcgY2VudGVyLCBuZ8aw4bujYyBs4bqhaSBz4bq9IHRhcCByYW5kb20KICAgICAgICAiIiIKICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiAiRWxlbWVudCBsw6AgTm9uZSBob+G6t2MgcuG7l25nIn0KICAgICAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgdmlzaWJsZS10by11c2VyIHRyxrDhu5tjCiAgICAgICAgICAgIHZpc2libGUgPSBlbGVtZW50LmdldCgidmlzaWJsZS10by11c2VyIiwgInRydWUiKQogICAgICAgICAgICBpZiB2aXNpYmxlID09ICJmYWxzZSI6CiAgICAgICAgICAgICAgICBwcmludCgiQ+G6o25oIGLDoW86IEVsZW1lbnQgY8OzIHZpc2libGUtdG8tdXNlcj0nZmFsc2UnLCB24bqrbiB0aOG7rSB0YXAuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBib3VuZHMgY+G7p2EgZWxlbWVudCDEkeG7gyBraeG7g20gdHJhIGvDrWNoIHRoxrDhu5tjCiAgICAgICAgICAgIHgxLCB5MSwgeDIsIHkyID0gc2VsZi5nZXRfZWxlbWVudF9ib3VuZHMoZWxlbWVudCkKICAgICAgICAgICAgd2lkdGggPSB4MiAtIHgxCiAgICAgICAgICAgIGhlaWdodCA9IHkyIC0geTEKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgZWxlbWVudCBxdcOhIG5o4buPICg8IDIwcHggd2lkdGggaG/hurdjIGhlaWdodCksIGTDuW5nIGNlbnRlcgogICAgICAgICAgICBpZiB3aWR0aCA8IDIwIG9yIGhlaWdodCA8IDIwOgogICAgICAgICAgICAgICAgcHJpbnQoZiJFbGVtZW50IG5o4buPICh7d2lkdGh9eHtoZWlnaHR9cHgpLCBz4butIGThu6VuZyB0YXAgY2VudGVyIikKICAgICAgICAgICAgICAgIHgsIHkgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdOG7jWEgxJHhu5kgaOG7o3AgbOG7hwogICAgICAgICAgICAgICAgaWYgeCA8PSAwIGFuZCB5IDw9IDA6CiAgICAgICAgICAgICAgICAgICAgYm91bmRzX3N0ciA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiIikKICAgICAgICAgICAgICAgICAgICBpZiBib3VuZHNfc3RyIGFuZCBib3VuZHNfc3RyICE9ICJbMCwwXVswLDBdIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudGFwX2VsZW1lbnQoYm91bmRzX3N0cikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6ICJLaMO0bmcgdGjhu4MgeMOhYyDEkeG7i25oIHThu41hIMSR4buZIMSR4buDIHRhcCJ9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcCh4LCB5KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBFbGVtZW50IMSR4bunIGzhu5tuLCBz4butIGThu6VuZyB0YXBfZWxlbWVudCDEkeG7gyB0YXAgcmFuZG9tCiAgICAgICAgICAgICAgICAjIHByaW50KGYiRWxlbWVudCDEkeG7pyBs4bubbiAoe3dpZHRofXh7aGVpZ2h0fXB4KSwgc+G7rSBk4bulbmcgdGFwIHJhbmRvbSIpICAjIELhu48gbG9nIG7DoHkKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcF9lbGVtZW50KGVsZW1lbnQpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGFwIGVsZW1lbnQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogZiJM4buXaSBraGkgdGFwIGVsZW1lbnQ6IHtzdHIoZSl9In0KICAgIAogICAgZGVmIGxvbmdfcHJlc3Moc2VsZiwgeDogaW50LCB5OiBpbnQsIGR1cmF0aW9uOiBpbnQgPSAxMDAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gZ2nhu68gdOG6oWkgduG7iyB0csOtIHgseSB0cm9uZyBt4buZdCBraG/huqNuZyB0aOG7nWkgZ2lhbgogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgIngiOiB4LAogICAgICAgICAgICAieSI6IHksCiAgICAgICAgICAgICJkdXJhdGlvbiI6IGR1cmF0aW9uCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImxvbmdfcHJlc3MiLCBwYXJhbXM9cGFyYW1zKQogICAgCiAgICBkZWYgbG9uZ19wcmVzc19lbGVtZW50KHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLCBkdXJhdGlvbjogaW50ID0gMTAwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIGdp4buvIHThuqFpIHRydW5nIHTDom0gY+G7p2EgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICB4LCB5ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICByZXR1cm4gc2VsZi5sb25nX3ByZXNzKHgsIHksIGR1cmF0aW9uKQogICAgCiAgICBkZWYgc3dpcGVfYmV0d2Vlbl9lbGVtZW50cyhzZWxmLCBzdGFydF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBpbnQgPSA1MDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCB04burIHBo4bqnbiB04butIHN0YXJ0X2VsZW1lbnQgxJHhur9uIHBo4bqnbiB04butIGVuZF9lbGVtZW50CiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfeCwgc3RhcnRfeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKHN0YXJ0X2VsZW1lbnQpCiAgICAgICAgZW5kX3gsIGVuZF95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZW5kX2VsZW1lbnQpCiAgICAgICAgcmV0dXJuIHNlbGYuc3dpcGUoc3RhcnRfeCwgc3RhcnRfeSwgZW5kX3gsIGVuZF95LCBkdXJhdGlvbikKICAgIAogICAgZGVmIHdhaXRfZm9yX2VsZW1lbnRfdG9fZGlzYXBwZWFyKHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCB0aW1lb3V0OiBpbnQgPSAzMCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIENo4budIMSR4bujaSBjaG8gxJHhur9uIGtoaSBt4buZdCBwaOG6p24gdOG7rSBiaeG6v24gbeG6pXQga2jhu49pIG3DoG4gaMOsbmgKICAgICAgICAiIiIKICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5maW5kX2VsZW1lbnQodGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY29udGFpbnM9Y29udGFpbnMpCiAgICAgICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0aW1lLnNsZWVwKGNoZWNrX2ludGVydmFsKQogICAgICAgIAogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgd2FpdF9mb3JfYW55X2VsZW1lbnQoc2VsZiwgZWxlbWVudHNfdG9fZmluZDogTGlzdFtEaWN0W3N0ciwgc3RyXV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiBpbnQgPSAzMCwgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgYuG6pXQga+G7syBwaOG6p24gdOG7rSBuw6BvIHRyb25nIGRhbmggc8OhY2ggeHXhuqV0IGhp4buHbgogICAgICAgIAogICAgICAgIGVsZW1lbnRzX3RvX2ZpbmQgbMOgIGRhbmggc8OhY2ggY8OhYyBkaWN0IHbhu5tpIGPDoWMga2jDs2E6IHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQKICAgICAgICAiIiIKICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICBmb3IgZWxlbWVudF9jcml0ZXJpYSBpbiBlbGVtZW50c190b19maW5kOgogICAgICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuZmluZF9lbGVtZW50KAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfY3JpdGVyaWEuZ2V0KCJ0ZXh0IiksIAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfY3JpdGVyaWEuZ2V0KCJjb250ZW50X2Rlc2MiKSwgCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9jcml0ZXJpYS5nZXQoInJlc291cmNlX2lkIikKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0aW1lLnNsZWVwKGNoZWNrX2ludGVydmFsKQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGRlZiBnZXRfc2NyZWVuX3NpemUoc2VsZikgLT4gVHVwbGVbaW50LCBpbnRdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmggKHdpZHRoLCBoZWlnaHQpCiAgICAgICAgIiIiCiAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgaWYgZGV2aWNlX2luZm9bInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgcmV0dXJuIChkZXZpY2VfaW5mb1siZGF0YSJdWyJzY3JlZW5fd2lkdGgiXSwgZGV2aWNlX2luZm9bImRhdGEiXVsic2NyZWVuX2hlaWdodCJdKQogICAgICAgIHJldHVybiAoMCwgMCkKICAgIAogICAgZGVmIHRha2Vfc2NyZWVuc2hvdChzZWxmLCBmaWxlX3BhdGg6IHN0ciA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bulcCDhuqNuaCBtw6BuIGjDrG5oIHbDoCBsxrB1IHbDoG8gZmlsZV9wYXRoIChu4bq/dSDEkcaw4bujYyBjdW5nIGPhuqVwKQogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHt9CiAgICAgICAgaWYgZmlsZV9wYXRoOgogICAgICAgICAgICBwYXJhbXNbImZpbGVfcGF0aCJdID0gZmlsZV9wYXRoCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic2NyZWVuc2hvdCIsIHBhcmFtcz1wYXJhbXMpCiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9hY3Rpdml0eShzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdMOqbiBhY3Rpdml0eSBoaeG7h24gdOG6oWkKICAgICAgICAiIiIKICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICBpZiBkZXZpY2VfaW5mb1sic3RhdHVzIl0gPT0gInN1Y2Nlc3MiIGFuZCAiY3VycmVudF9hY3Rpdml0eSIgaW4gZGV2aWNlX2luZm9bImRhdGEiXToKICAgICAgICAgICAgcmV0dXJuIGRldmljZV9pbmZvWyJkYXRhIl1bImN1cnJlbnRfYWN0aXZpdHkiXQogICAgICAgIHJldHVybiAiIgogICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfcGFja2FnZShzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdMOqbiBwYWNrYWdlIGhp4buHbiB04bqhaQogICAgICAgICIiIgogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJjdXJyZW50LXBhY2thZ2UiKQogICAgICAgIGlmIHJlc3BvbnNlLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gcmVzcG9uc2U6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdLmdldCgicGFja2FnZSIsICIiKQogICAgICAgIHJldHVybiAiIgogICAgCiAgICBkZWYgcHJlc3NfZW50ZXIoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgRW50ZXIgYuG6sW5nIEFEQiBrZXlldmVudAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDGr3UgdGnDqm4gc+G7rSBk4bulbmcgQURCIG7hur91IMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFRo4buxYyB0aGkgQURCIGtleWV2ZW50IEVOVEVSICg2NikKICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJzaGVsbCIsICJpbnB1dCIsICJrZXlldmVudCIsICI2NiJdCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAibWVzc2FnZSI6ICLEkMOjIG5o4bqlbiBFbnRlciBi4bqxbmcgQURCIn0KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRmFsbGJhY2sgduG7gSBBUEkgbuG6v3Uga2jDtG5nIGPDsyBBREIKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2VudGVyIikKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlRpbWVvdXRFeHBpcmVkOgogICAgICAgICAgICBwcmludCgiVGltZW91dCBraGkgZ+G7rWkgQURCIGtleWV2ZW50IEVudGVyIikKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfZW50ZXIiKQogICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIEFEQiBrZXlldmVudCBFbnRlcjoge2V9IikKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfZW50ZXIiKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraMO0bmcgeMOhYyDEkeG7i25oIGtoaSBn4butaSBBREIga2V5ZXZlbnQgRW50ZXI6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2VudGVyIikKICAgIAogICAgZGVmIHByZXNzX2JhY2soc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgQmFjawogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2JhY2siKQogICAgCiAgICBkZWYgcHJlc3NfaG9tZShzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gbsO6dCBIb21lCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfaG9tZSIpCiAgICAKICAgIGRlZiBwcmVzc19yZWNlbnRfYXBwcyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gbsO6dCBSZWNlbnQgQXBwcwogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX3JlY2VudF9hcHBzIikKCiAgICBkZWYgaXNfYXBwX2luc3RhbGxlZChzZWxmLCBwYWNrYWdlX25hbWU6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSDhu6luZyBk4bulbmcgxJHDoyDEkcaw4bujYyBjw6BpIMSR4bq3dCB0csOqbiB0aGnhur90IGLhu4sgY2jGsGEKICAgICAgICDGr3UgdGnDqm4gc+G7rSBk4bulbmcgQURCIG7hur91IMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwYWNrYWdlX25hbWU6IFTDqm4gcGFja2FnZSBj4bunYSDhu6luZyBk4bulbmcgY+G6p24ga2nhu4NtIHRyYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IOG7qW5nIGThu6VuZyDEkcOjIGPDoGkgxJHhurd0LCBGYWxzZSBu4bq/dSBjaMawYQogICAgICAgICIiIgogICAgICAgICMgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSDhu6luZyBk4bulbmcgYuG6sW5nIEFEQgogICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbInNoZWxsIiwgZiJwbSBsaXN0IHBhY2thZ2VzIHwgZ3JlcCAteCBwYWNrYWdlOntwYWNrYWdlX25hbWV9Il0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICB0ZXh0PVRydWUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7Mga+G6v3QgcXXhuqMsIOG7qW5nIGThu6VuZyDEkcOjIMSRxrDhu6NjIGPDoGkgxJHhurd0CiAgICAgICAgICAgICAgICByZXR1cm4gcGFja2FnZV9uYW1lIGluIHJlc3VsdC5zdGRvdXQKICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yOgogICAgICAgICAgICAgICAgIyBO4bq/dSBs4buXaSBBREIsIHPhu60gZOG7pW5nIEFQSSBIVFRQCiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgCiAgICAgICAgIyBT4butIGThu6VuZyBIVFRQIEFQSQogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpc19pbnN0YWxsZWQiLCB7InBhY2thZ2UiOiBwYWNrYWdlX25hbWV9KQogICAgICAgIGlmIHJlc3BvbnNlWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdLmdldCgiaXNfaW5zdGFsbGVkIiwgRmFsc2UpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgZmluZF9lbGVtZW50cyhzZWxmLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLCB0ZXh0OiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSB0aGVvIGNsYXNzX25hbWUsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQgaG/hurdjIHZpc2libGUtdG8tdXNlcgogICAgICAgIMSQw6J5IGzDoCBt4buZdCBwaMawxqFuZyB0aOG7qWMgdGnhu4duIGzhu6NpIGvhur90IGjhu6NwIGR1bXBfc2NyZWVuX3htbCB2w6AgZmluZF9hbGxfZWxlbWVudHNfaW5feG1sCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCBjw6FjIHBo4bqnbiB04butIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgIyBM4bqleSBYTUwgbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgCiAgICAgICAgIyBT4butIGThu6VuZyBmaW5kX2FsbF9lbGVtZW50c19pbl94bWwgxJHhu4MgdMOsbSBjw6FjIHBo4bqnbiB04butCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgdGV4dD10ZXh0LCAKICAgICAgICAgICAgY29udGVudF9kZXNjPWNvbnRlbnRfZGVzYywgCiAgICAgICAgICAgIHJlc291cmNlX2lkPXJlc291cmNlX2lkLAogICAgICAgICAgICBjbGFzc19uYW1lPWNsYXNzX25hbWUsCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcj12aXNpYmxlX3RvX3VzZXIsCiAgICAgICAgICAgIGNvbnRhaW5zPWNvbnRhaW5zCiAgICAgICAgKQoKICAgIGRlZiBvcGVuX3VybChzZWxmLCB1cmw6IHN0ciwgcGFja2FnZTogc3RyID0gTm9uZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTeG7nyBt4buZdCBVUkwgdHLDqm4gdGhp4bq/dCBi4buLLiBI4buvdSDDrWNoIMSR4buDIG3hu58gY8OhYyBsaW5rIG3huqFuZyB4w6MgaOG7mWkgdHLhu7FjIHRp4bq/cC4KICAgICAgICBUcsaw4bubYyBraGkgbeG7nyBsaW5rIHPhur0gYuG6pW0gSG9tZSB2w6AgY2jhu50gMi01IGdpw6J5LgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHVybDogVVJMIGPhuqduIG3hu58gKHbDrSBk4bulOiBodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL3VzZXJuYW1lLykKICAgICAgICAgICAgcGFja2FnZTogUGFja2FnZSBuYW1lIGPhu6dhIOG7qW5nIGThu6VuZyDEkeG7gyBt4bufIFVSTCAodMO5eSBjaOG7jW4pCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyB04burIHNlcnZlcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBCxrDhu5tjIDE6IELhuqVtIG7DunQgSG9tZSB0csaw4bubYwogICAgICAgICAgICBwcmludCgiQuG6pW0gbsO6dCBIb21lIHRyxrDhu5tjIGtoaSBt4bufIFVSTC4uLiIpCiAgICAgICAgICAgIHNlbGYucHJlc3NfaG9tZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELGsOG7m2MgMjogQ2jhu50gbmfhuqt1IG5oacOqbiAyLTUgZ2nDonkKICAgICAgICAgICAgaW1wb3J0IHJhbmRvbQogICAgICAgICAgICBpbXBvcnQgdGltZQogICAgICAgICAgICB3YWl0X3RpbWUgPSByYW5kb20udW5pZm9ybSgyLCA1KQogICAgICAgICAgICBwcmludChmIkNo4budIHt3YWl0X3RpbWU6LjFmfXMgdHLGsOG7m2Mga2hpIG3hu58gVVJMLi4uIikKICAgICAgICAgICAgdGltZS5zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELGsOG7m2MgMzogVGnhur9uIGjDoG5oIG3hu58gVVJMCiAgICAgICAgICAgIHByaW50KGYiTeG7nyBVUkw6IHt1cmx9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVVJMIGVuY29kZSDEkeG7gyB0csOhbmggbOG7l2kgduG7m2kgY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0CiAgICAgICAgICAgICMgQ2jhu4kgZW5jb2RlIHBo4bqnbiBzYXUgZG9tYWluIMSR4buDIGdp4buvIG5ndXnDqm4gcHJvdG9jb2wgdsOgIGRvbWFpbgogICAgICAgICAgICBpZiAnOi8vJyBpbiB1cmw6CiAgICAgICAgICAgICAgICBwYXJ0cyA9IHVybC5zcGxpdCgnOi8vJywgMSkKICAgICAgICAgICAgICAgIGlmIGxlbihwYXJ0cykgPT0gMjoKICAgICAgICAgICAgICAgICAgICBwcm90b2NvbCA9IHBhcnRzWzBdCiAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nID0gcGFydHNbMV0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAnLycgaW4gcmVtYWluaW5nOgogICAgICAgICAgICAgICAgICAgICAgICBkb21haW5fcGFydHMgPSByZW1haW5pbmcuc3BsaXQoJy8nLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBkb21haW5fcGFydHNbMF0KICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IGRvbWFpbl9wYXJ0c1sxXQogICAgICAgICAgICAgICAgICAgICAgICAjIEVuY29kZSBwYXRoIHBhcnQsIG5oxrBuZyBnaeG7ryBuZ3V5w6puIGPDoWMga8O9IHThu7EgYW4gdG/DoG4KICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlZF9wYXRoID0gcXVvdGUocGF0aCwgc2FmZT0nL0A6PyNbXSEkJlwnKCkqKyw7PScpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZWRfdXJsID0gZiJ7cHJvdG9jb2x9Oi8ve2RvbWFpbn0ve2VuY29kZWRfcGF0aH0iCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlZF91cmwgPSB1cmwgICMgQ2jhu4kgY8OzIGRvbWFpbiwga2jDtG5nIGPhuqduIGVuY29kZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3VybCA9IHVybAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBLaMO0bmcgY8OzIHByb3RvY29sLCBlbmNvZGUgdG/DoG4gYuG7mQogICAgICAgICAgICAgICAgZW5jb2RlZF91cmwgPSBxdW90ZSh1cmwsIHNhZmU9Jy9AOj8jW10hJCZcJygpKissOz0nKQogICAgICAgICAgICAKICAgICAgICAgICAgcGFyYW1zID0geyJ1cmwiOiBlbmNvZGVkX3VybH0KICAgICAgICAgICAgaWYgcGFja2FnZToKICAgICAgICAgICAgICAgIHBhcmFtc1sicGFja2FnZSJdID0gcGFja2FnZQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJvcGVuX3VybCIsIHBhcmFtcz1wYXJhbXMpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgZW5jb2RlIFVSTDoge2V9IikKICAgICAgICAgICAgIyBGYWxsYmFjazogZ+G7rWkgVVJMIGfhu5FjIG7hur91IGPDsyBs4buXaSBlbmNvZGUKICAgICAgICAgICAgcGFyYW1zID0geyJ1cmwiOiB1cmx9CiAgICAgICAgICAgIGlmIHBhY2thZ2U6CiAgICAgICAgICAgICAgICBwYXJhbXNbInBhY2thZ2UiXSA9IHBhY2thZ2UKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgib3Blbl91cmwiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBnZXRfY2xpcGJvYXJkKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBu4buZaSBkdW5nIGNsaXBib2FyZCB04burIHRoaeG6v3QgYuG7iwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogTuG7mWkgZHVuZyBjbGlwYm9hcmQgaG/hurdjIGNodeG7l2kgcuG7l25nIG7hur91IGtow7RuZyBjw7MgbuG7mWkgZHVuZwogICAgICAgICIiIgogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJjbGlwYm9hcmQiKQogICAgICAgIGlmIHJlc3BvbnNlLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCByZXNwb25zZS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJoYXNfY29udGVudCIpOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXVsiY2xpcGJvYXJkX3RleHQiXQogICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBzd2lwZV9sZWZ0KHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCBzYW5nIHRyw6FpICh04buRaSDGsHUgY2hvIG5nw7NuIGPDoWkgdGF5IHBo4bqjaSkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV9sZWZ0IikKCiAgICBkZWYgc3dpcGVfcmlnaHQoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHNhbmcgcGjhuqNpICh04buRaSDGsHUgY2hvIG5nw7NuIGPDoWkgdGF5IHBo4bqjaSkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV9yaWdodCIpCgogICAgZGVmIHNldHVwX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBjaG8gcGhpw6puIGzDoG0gdmnhu4djCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSB24bubaSBjw6FjIHRyxrDhu51uZzoKICAgICAgICAgICAgICAgIC0gaWQ6IElEIGPhu6dhIHByb3h5CiAgICAgICAgICAgICAgICAtIHR5cGU6IExv4bqhaSBwcm94eSAocHBvZSwgaHR0cCwgc29ja3M1LCBldGMuKQogICAgICAgICAgICAgICAgLSBob3N0OiDEkOG7i2EgY2jhu4kgc2VydmVyIHByb3h5CiAgICAgICAgICAgICAgICAtIHBvcnQ6IFBvcnQgY+G7p2EgcHJveHkKICAgICAgICAgICAgICAgIC0gdXNlcm5hbWU6IFVzZXJuYW1lIChu4bq/dSBjw7MpCiAgICAgICAgICAgICAgICAtIHBhc3N3b3JkOiBQYXNzd29yZCAobuG6v3UgY8OzKQogICAgICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aGnhur90IGzhuq1wIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcm94eV90eXBlID0gcHJveHlfY29uZmlnLmdldCgidHlwZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcHJveHlfdHlwZSA9PSAicHBvZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fc2V0dXBfcHBvZV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSBpbiBbImh0dHAiLCAiaHR0cHMiXToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZXR1cF9odHRwX3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxpZiBwcm94eV90eXBlID09ICJzb2NrczUiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NldHVwX3NvY2tzNV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIkxv4bqhaSBwcm94eSBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7ozoge3Byb3h5X3R5cGV9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aGnhur90IGzhuq1wIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3NldHVwX3Bwb2VfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaGnhur90IGzhuq1wIHByb3h5IFBQUG9FCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBQUFBvRQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBob3N0ID0gcHJveHlfY29uZmlnLmdldCgic2VydmVyX2lwIikKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJwcm94eV9pZCIpCiAgICAgICAgICAgIHByb3h5X25hbWUgPSBwcm94eV9jb25maWcuZ2V0KCJuYW1lIikKICAgICAgICAgICAgaWYgbm90IGhvc3Q6CiAgICAgICAgICAgICAgICBwcmludCgiVGhp4bq/dSB0aMO0bmcgdGluIGhvc3QgY2hvIHByb3h5IFBQUG9FIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJIHJlZ2lzdGVyIHRyxrDhu5tjCiAgICAgICAgICAgIHJlZ2lzdGVyX3VybCA9IGYiaHR0cDovL3tob3N0fS9yZWdpc3RlciIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBkZXZpY2UgaW5mbwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgbG9jYWxfaXAgPSAiIgogICAgICAgICAgICBpZiBkZXZpY2VfaW5mby5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9jYWxfaXAgPSBkZXZpY2VfaW5mb1siZGF0YSJdLmdldCgibG9jYWxfaXAiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlZ2lzdGVyX2RhdGEgPSB7Im5hbWUiOiBwcm94eV9uYW1lfQogICAgICAgICAgICAgICAgaWYgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJfZGF0YVsibG9jYWxfaXAiXSA9IGxvY2FsX2lwCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZWdpc3Rlcl9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJfdXJsLCAKICAgICAgICAgICAgICAgICAgICBqc29uPXJlZ2lzdGVyX2RhdGEsIAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9LCAKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiByZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIMSRxINuZyBrw70gdGjDoG5oIGPDtG5nIHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge2hvc3R9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHEg25nIGvDvSB24bubaSBwcm94eSBQUFBvRSBzZXJ2ZXI6IHtyZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJLaMO0bmcgdGjhu4Mga+G6v3QgbuG7kWkgxJHhur9uIHByb3h5IFBQUG9FIHNlcnZlciB7aG9zdH06IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IElQIHByb3h5CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNldF9wcm94eV9pcChwcm94eV9jb25maWcpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eSBQUFBvRToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9zZXR1cF9odHRwX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBIVFRQL0hUVFBTCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBIVFRQCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhu5FpIHbhu5tpIEhUVFAgcHJveHksIGNo4buJIGPhuqduIHJlc2V0IElQCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNldF9wcm94eV9pcChwcm94eV9jb25maWcpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eSBIVFRQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3NldHVwX3NvY2tzNV9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgU09DS1M1CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBTT0NLUzUKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG7kWkgduG7m2kgU09DS1M1IHByb3h5LCBjaOG7iSBj4bqnbiByZXNldCBJUAogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRoaeG6v3QgbOG6rXAgcHJveHkgU09DS1M1OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3Jlc2V0X3Byb3h5X2lwKHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUmVzZXQgSVAgcHJveHkgKGxvZ2ljIGPFqSDEkcaw4bujYyBjaHV54buDbiB2w6BvIMSRw6J5KQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBMb2dpYyByZXNldCBJUCBwcm94eSBz4bq9IMSRxrDhu6NjIGltcGxlbWVudCB0w7l5IHRoZW8gbG/huqFpIHByb3h5CiAgICAgICAgICAgICMgSGnhu4duIHThuqFpIHJldHVybiBUcnVlIMSR4buDIGtow7RuZyBibG9jayB3b3JrZmxvdwogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgcHJveHlfdHlwZSA9IHByb3h5X2NvbmZpZy5nZXQoInR5cGUiLCAidW5rbm93biIpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChmIlJlc2V0IElQIGNobyBwcm94eSB7cHJveHlfaWR9ICh0eXBlOiB7cHJveHlfdHlwZX0pIikKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyB0aMO0bmcgdGluIHJlc2V0IElQCiAgICAgICAgICAgIHJlc2V0X2lwX2xpbmsgPSBwcm94eV9jb25maWcuZ2V0KCJsaW5rX3Jlc2V0X2lwIikKICAgICAgICAgICAgcHBvZV9uYW1lID0gcHJveHlfY29uZmlnLmdldCgicHBvZV9uYW1lIikKCiAgICAgICAgICAgIGlmIHJlc2V0X2lwX2xpbmsgYW5kIHBwb2VfbmFtZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIEfhu61pIFBPU1QgcmVxdWVzdCDEkeG7gyByZXNldCBJUAogICAgICAgICAgICAgICAgICAgIHJlc2V0X2RhdGEgPSB7InBwb2VfbmFtZSI6IHBwb2VfbmFtZX0KICAgICAgICAgICAgICAgICAgICByZXNldF9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0X2lwX2xpbmssIAogICAgICAgICAgICAgICAgICAgICAgICBqc29uPXJlc2V0X2RhdGEsIAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzZXRfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgcmVzZXQgSVAgdGjDoG5oIGPDtG5nIGNobyBwcm94eSB7cHBvZV9uYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgcmVzZXQgSVA6IEhUVFAge3Jlc2V0X3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgZ+G7rWkgcmVxdWVzdCByZXNldCBJUDoge2V9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJUaGnhur91IHRow7RuZyB0aW4gbGlua19yZXNldF9pcCBob+G6t2MgcHJveHlfbmFtZSIpCiAgICAgICAgICAgICMgVE9ETzogSW1wbGVtZW50IGxvZ2ljIHJlc2V0IElQIGPhu6UgdGjhu4MgY2hvIHThu6tuZyBsb+G6oWkgcHJveHkKICAgICAgICAgICAgIyBWw60gZOG7pTogZ+G7jWkgQVBJIHJlc2V0IElQLCBob+G6t2MgdGjhu7FjIGhp4buHbiBjw6FjIGzhu4duaCBj4bqnbiB0aGnhur90CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHJlc2V0IElQIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgcmVzZXRfcHJveHlfaXAoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBQaMawxqFuZyB0aOG7qWMgcHVibGljIMSR4buDIHJlc2V0IElQIHByb3h5ICjEkeG7gyB0xrDGoW5nIHRow61jaCB24bubaSBjb2RlIGPFqSkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQoKICAgIGRlZiB1bnJlZ2lzdGVyX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0gPSBOb25lKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEjhu6d5IMSRxINuZyBrw70gcHJveHkgc2F1IGtoaSBz4butIGThu6VuZyB4b25nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSAodMO5eSBjaOG7jW4sIGPDsyB0aOG7gyBs4bqleSB04burIGRhdGFiYXNlIG7hur91IGtow7RuZyB0cnV54buBbikKICAgICAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgaOG7p3kgxJHEg25nIGvDvSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdHJ1eeG7gW4gcHJveHlfY29uZmlnLCBjw7MgdGjhu4MgbOG6pXkgdOG7qyBkYXRhYmFzZSBob+G6t2MgY29udGV4dCBoaeG7h24gdOG6oWkKICAgICAgICAgICAgaWYgbm90IHByb3h5X2NvbmZpZzoKICAgICAgICAgICAgICAgIHByaW50KCJLaMO0bmcgY8OzIHByb3h5IGNvbmZpZyDEkeG7gyB1bnJlZ2lzdGVyIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlICAjIENvaSBuaMawIHRow6BuaCBjw7RuZyBu4bq/dSBraMO0bmcgY8OzIGfDrCDEkeG7gyB1bnJlZ2lzdGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcHJveHlfdHlwZSA9IHByb3h5X2NvbmZpZy5nZXQoInR5cGUiLCAiIikubG93ZXIoKQogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHByb3h5X3R5cGUgPT0gInBwb2UiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3VucmVnaXN0ZXJfcHBvZV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSBpbiBbImh0dHAiLCAiaHR0cHMiXToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl91bnJlZ2lzdGVyX2h0dHBfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbGlmIHByb3h5X3R5cGUgPT0gInNvY2tzNSI6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdW5yZWdpc3Rlcl9zb2NrczVfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJMb+G6oWkgcHJveHkga2jDtG5nIGPhuqduIHVucmVnaXN0ZXIgaG/hurdjIGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujOiB7cHJveHlfdHlwZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF91bnJlZ2lzdGVyX3Bwb2VfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IFBQUG9FCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBQUFBvRQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBob3N0ID0gcHJveHlfY29uZmlnLmdldCgic2VydmVyX2lwIikKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJwcm94eV9pZCIpCiAgICAgICAgICAgIHByb3h5X25hbWUgPSBwcm94eV9jb25maWcuZ2V0KCJuYW1lIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBob3N0OgogICAgICAgICAgICAgICAgcHJpbnQoIlRoaeG6v3UgdGjDtG5nIHRpbiBob3N0IGNobyBwcm94eSBQUFBvRSwgYuG7jyBxdWEgdW5yZWdpc3RlciIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJIHVucmVnaXN0ZXIKICAgICAgICAgICAgdW5yZWdpc3Rlcl91cmwgPSBmImh0dHA6Ly97aG9zdH0vdW5yZWdpc3RlciIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBkZXZpY2UgaW5mbwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgbG9jYWxfaXAgPSAiIgogICAgICAgICAgICBpZiBkZXZpY2VfaW5mby5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9jYWxfaXAgPSBkZXZpY2VfaW5mb1siZGF0YSJdLmdldCgibG9jYWxfaXAiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJfZGF0YSA9IHsibmFtZSI6IHByb3h5X25hbWV9CiAgICAgICAgICAgICAgICBpZiBsb2NhbF9pcDoKICAgICAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyX2RhdGFbImxvY2FsX2lwIl0gPSBsb2NhbF9pcAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl91cmwsIAogICAgICAgICAgICAgICAgICAgIGpzb249dW5yZWdpc3Rlcl9kYXRhLCAKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwgCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgdW5yZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIGjhu6d5IMSRxINuZyBrw70gdGjDoG5oIGPDtG5nIHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge2hvc3R9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge3VucmVnaXN0ZXJfcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIMSR4bq/biBwcm94eSBQUFBvRSBzZXJ2ZXIge2hvc3R9IMSR4buDIHVucmVnaXN0ZXI6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eSBQUFBvRToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF91bnJlZ2lzdGVyX2h0dHBfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IEhUVFAvSFRUUFMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IEhUVFAKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBIVFRQIHByb3h5IHRoxrDhu51uZyBraMO0bmcgY+G6p24gdW5yZWdpc3RlciDEkeG6t2MgYmnhu4d0CiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICBwcmludChmIkjhu6d5IMSRxINuZyBrw70gcHJveHkgSFRUUCB7cHJveHlfaWR9IChraMO0bmcgY+G6p24gdGhhbyB0w6FjIMSR4bq3YyBiaeG7h3QpIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHByb3h5IEhUVFA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfdW5yZWdpc3Rlcl9zb2NrczVfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IFNPQ0tTNQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgU09DS1M1CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgU09DS1M1IHByb3h5IHRoxrDhu51uZyBraMO0bmcgY+G6p24gdW5yZWdpc3RlciDEkeG6t2MgYmnhu4d0CiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICBwcmludChmIkjhu6d5IMSRxINuZyBrw70gcHJveHkgU09DS1M1IHtwcm94eV9pZH0gKGtow7RuZyBj4bqnbiB0aGFvIHTDoWMgxJHhurdjIGJp4buHdCkiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGjhu6d5IMSRxINuZyBrw70gcHJveHkgU09DS1M1OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZGVidWdfZWxlbWVudF9ib3VuZHMoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgRGVidWcgdGjDtG5nIHRpbiBib3VuZHMgY+G7p2EgZWxlbWVudCDEkeG7gyBraeG7g20gdHJhIHhlbSBjw7MgdGFwIMSRxrDhu6NjIGtow7RuZwogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICBwcmludCgiREVCVUc6IEVsZW1lbnQgaXMgTm9uZSBvciBlbXB0eSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBwcmludCgiPT09IERFQlVHIEVMRU1FTlQgQk9VTkRTID09PSIpCiAgICAgICAgYm91bmRzX3N0ciA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiIikKICAgICAgICBwcmludChmIk9yaWdpbmFsIGJvdW5kcyBzdHJpbmc6ICd7Ym91bmRzX3N0cn0nIikKICAgICAgICAKICAgICAgICAjIFRlc3QgZ2V0X2VsZW1lbnRfYm91bmRzCiAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyhlbGVtZW50KQogICAgICAgIHByaW50KGYiUGFyc2VkIGJvdW5kczogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAKICAgICAgICAjIFRlc3QgZ2V0X2VsZW1lbnRfY2VudGVyCiAgICAgICAgY2VudGVyX3gsIGNlbnRlcl95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICBwcmludChmIkNhbGN1bGF0ZWQgY2VudGVyOiAoe2NlbnRlcl94fSwge2NlbnRlcl95fSkiKQogICAgICAgIAogICAgICAgICMgVGVzdCB24bubaSB2w60gZOG7pSBj4bulIHRo4buDCiAgICAgICAgcHJpbnQoIlxuLS0tIFRlc3Rpbmcgd2l0aCBleGFtcGxlIGJvdW5kcyBbMzYsMF1bODQsLTMwXSAtLS0iKQogICAgICAgIHRlc3RfZWxlbWVudCA9IHsiYm91bmRzIjogIlszNiwwXVs4NCwtMzBdIiwgImNvbnRlbnQtZGVzYyI6ICJUw6xtIGtp4bq/bSJ9CiAgICAgICAgCiAgICAgICAgdGVzdF94MSwgdGVzdF95MSwgdGVzdF94MiwgdGVzdF95MiA9IHNlbGYuZ2V0X2VsZW1lbnRfYm91bmRzKHRlc3RfZWxlbWVudCkKICAgICAgICBwcmludChmIlRlc3QgcGFyc2VkIGJvdW5kczogKHt0ZXN0X3gxfSwge3Rlc3RfeTF9LCB7dGVzdF94Mn0sIHt0ZXN0X3kyfSkiKQogICAgICAgIAogICAgICAgIHRlc3RfY2VudGVyX3gsIHRlc3RfY2VudGVyX3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcih0ZXN0X2VsZW1lbnQpCiAgICAgICAgcHJpbnQoZiJUZXN0IGNhbGN1bGF0ZWQgY2VudGVyOiAoe3Rlc3RfY2VudGVyX3h9LCB7dGVzdF9jZW50ZXJfeX0pIikKICAgICAgICAKICAgICAgICAjIFRlc3QgdGFwX2VsZW1lbnQKICAgICAgICBwcmludCgiXG4tLS0gVGVzdGluZyB0YXBfZWxlbWVudCAtLS0iKQogICAgICAgIHJlc3VsdCA9IHNlbGYudGFwX2VsZW1lbnQodGVzdF9lbGVtZW50KQogICAgICAgIHByaW50KGYiVGFwIHJlc3VsdDoge3Jlc3VsdH0iKQogICAgICAgIAogICAgICAgIHByaW50KCI9PT0gRU5EIERFQlVHID09PSIpCgogICAgZGVmIGRvd25sb2FkX2ltYWdlKHNlbGYsIHNlcnZlcjogc3RyID0gImh0dHA6Ly9pbWcuZG5kdmluYS5jb20iLCBjb3VudDogaW50ID0gMSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBU4bqjaSDhuqNuaCB04burIHNlcnZlciB24buBIHRoaeG6v3QgYuG7iyB0aMO0bmcgcXVhIGhlbHBlciBzZXJ2aWNlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2VydmVyOiBTZXJ2ZXIgxJHhu4thIGNo4buJIChu4bq/dSBOb25lIHRow6wgxJHhu41jIHThu6sgY29uZmlnIGRiLCBt4bq3YyDEkeG7i25oICJodHRwOi8vaW1nLmRuZHZpbmEuY29tIikKICAgICAgICAgICAgY291bnQ6IFPhu5EgbMaw4bujbmcg4bqjbmggY+G6p24gdOG6o2kgKG3hurdjIMSR4buLbmggMSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB04bqjaSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBzZXJ2ZXIgdOG7qyBkYXRhYmFzZSBu4bq/dSBraMO0bmcgdHJ1eeG7gW4gdsOgbwogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gc2VydmVyIGPDsyBwcm90b2NvbAogICAgICAgICAgICBpZiBub3Qgc2VydmVyLnN0YXJ0c3dpdGgoKCJodHRwOi8vIiwgImh0dHBzOi8vIikpOgogICAgICAgICAgICAgICAgc2VydmVyID0gZiJodHRwOi8ve3NlcnZlcn0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDonkgZOG7sW5nIFVSTCBk4buxYSB0csOqbiBz4buRIGzGsOG7o25nIOG6o25oCiAgICAgICAgICAgIGlmIGNvdW50ID09IDE6CiAgICAgICAgICAgICAgICAjIFRyxrDhu51uZyBo4bujcCB04bqjaSAxIOG6o25oIC0gc+G7rSBk4bulbmcgZW5kcG9pbnQgcmFuZG9tLWF2YXRhcgogICAgICAgICAgICAgICAgaW1hZ2VfdXJsID0gZiJ7c2VydmVyfS9yYW5kb20tYXZhdGFyIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUcsaw4budbmcgaOG7o3AgdOG6o2kgbmhp4buBdSDhuqNuaCAtIHPhu60gZOG7pW5nIGVuZHBvaW50IGdldC1zaW1pbGFyLWltYWdlcwogICAgICAgICAgICAgICAgaW1hZ2VfdXJsID0gZiJ7c2VydmVyfS9nZXQtc2ltaWxhci1pbWFnZXM/Y291bnQ9e2NvdW50fSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU+G7rSBk4bulbmcgX21ha2VfcmVxdWVzdCDEkeG7gyB04bqtbiBk4bulbmcgY8ahIGNo4bq/IHJldHJ5IHbDoCBlcnJvciBoYW5kbGluZyBjw7Mgc+G6tW4KICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJkb3dubG9hZC1pbWFnZSIsIHBhcmFtcz17InVybCI6IGltYWdlX3VybH0pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFjhu60gbMO9IHJlc3BvbnNlIGZvcm1hdCB0aOG7sWMgdOG6vwogICAgICAgICAgICAjIFJlc3BvbnNlOiB7ImRhdGEiOiB7InN1Y2Nlc3MiOiB0cnVlLCAibWVzc2FnZSI6ICIuLi4iLCAiZGF0YSI6IHsuLi59fSwgIm1lc3NhZ2UiOiAiLi4uIiwgInN0YXR1cyI6ICJzdWNjZXNzIn0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXN1bHQsIGRpY3QpIGFuZCByZXN1bHQuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgZGF0YS5zdWNjZXNzIHbDoCBkYXRhLm1lc3NhZ2UKICAgICAgICAgICAgICAgIGRhdGFfc2VjdGlvbiA9IHJlc3VsdC5nZXQoImRhdGEiLCB7fSkKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBkYXRhX3NlY3Rpb24uZ2V0KCJzdWNjZXNzIiwgRmFsc2UpCiAgICAgICAgICAgICAgICBtZXNzYWdlID0gZGF0YV9zZWN0aW9uLmdldCgibWVzc2FnZSIsICIiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyBhbmQgInRow6BuaCBjw7RuZyIgaW4gbWVzc2FnZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdOG6o2kg4bqjbmg6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKIyBUZXN0IGZ1bmN0aW9uIGZvciB0aGUgcHJvYmxlbWF0aWMgZWxlbWVudApkZWYgdGVzdF9wcm9ibGVtYXRpY19lbGVtZW50KCk6CiAgICAiIiIKICAgIFRlc3QgZnVuY3Rpb24gxJHhu4Mga2nhu4NtIHRyYSBlbGVtZW50IGPDsyBib3VuZHMgw6JtCiAgICAiIiIKICAgIGhlbHBlciA9IEhlbHBlclNlcnZpY2UoKQogICAgCiAgICAjIEVsZW1lbnQgdOG7qyB2w60gZOG7pSBj4bunYSB1c2VyCiAgICBwcm9ibGVtYXRpY19lbGVtZW50ID0gewogICAgICAgICJjbGFzcyI6ICJhbmRyb2lkLndpZGdldC5JbWFnZVZpZXciLAogICAgICAgICJwYWNrYWdlIjogImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbCIsIAogICAgICAgICJyZXNvdXJjZS1pZCI6ICJjb20uc3MuYW5kcm9pZC51Z2MudHJpbGw6aWQvZGVsIiwKICAgICAgICAidGV4dCI6ICJudWxsIiwKICAgICAgICAiY29udGVudC1kZXNjIjogIlTDrG0ga2nhur9tIiwKICAgICAgICAiYm91bmRzIjogIlszNiwwXVs4NCwtMzBdIiwKICAgICAgICAiY2xpY2thYmxlIjogImZhbHNlIiwKICAgICAgICAiZW5hYmxlZCI6ICJ0cnVlIiwKICAgICAgICAidmlzaWJsZS10by11c2VyIjogImZhbHNlIgogICAgfQogICAgCiAgICBwcmludCgiVGVzdGluZyBwcm9ibGVtYXRpYyBlbGVtZW50IHdpdGggYm91bmRzIFszNiwwXVs4NCwtMzBdIikKICAgIGhlbHBlci5kZWJ1Z19lbGVtZW50X2JvdW5kcyhwcm9ibGVtYXRpY19lbGVtZW50KQogICAgCiAgICBwcmludCgiXG5UcnlpbmcgdG8gdGFwIHRoZSBlbGVtZW50Li4uIikKICAgIHJlc3VsdCA9IGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocHJvYmxlbWF0aWNfZWxlbWVudCkKICAgIHByaW50KGYiRmluYWwgdGFwIHJlc3VsdDoge3Jlc3VsdH0iKQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHRlc3RfcHJvYmxlbWF0aWNfZWxlbWVudCgpCiAgICAKICAgICMgVsOtIGThu6Ugc+G7rSBk4bulbmcKICAgIGhlbHBlciA9IEhlbHBlclNlcnZpY2UoKQogICAgCiAgICAjIEzhuqV5IGvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmgKICAgIHdpZHRoLCBoZWlnaHQgPSBoZWxwZXIuZ2V0X3NjcmVlbl9zaXplKCkKICAgIHByaW50KGYiS8OtY2ggdGjGsOG7m2MgbcOgbiBow6xuaDoge3dpZHRofXh7aGVpZ2h0fSIpCiAgICAKICAgICMgTeG7nyBUaWtUb2sKICAgIGhlbHBlci5vcGVuX2FwcCgiY29tLnNzLmFuZHJvaWQudWdjLnRyaWxsIikKICAgIAogICAgIyBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgbsO6dCAiVHJhbmcgY2jhu6ciIGhv4bq3YyBuw7p0ICJLaMOhbSBwaMOhIiB4deG6pXQgaGnhu4duCiAgICBlbGVtZW50c190b19maW5kID0gWwogICAgICAgIHsiY29udGVudF9kZXNjIjogIlRyYW5nIGNo4bunIn0sCiAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiS2jDoW0gcGjDoSJ9CiAgICBdCiAgICAKICAgIGVsZW1lbnQgPSBoZWxwZXIud2FpdF9mb3JfYW55X2VsZW1lbnQoZWxlbWVudHNfdG9fZmluZCkKICAgIAogICAgaWYgZWxlbWVudDoKICAgICAgICBwcmludChmIsSQw6MgdMOsbSB0aOG6pXkgcGjhuqduIHThu606IHtoZWxwZXIuZ2V0X2VsZW1lbnRfY29udGVudF9kZXNjKGVsZW1lbnQpfSIpCiAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgZWxzZToKICAgICAgICBwcmludCgiS2jDtG5nIHTDrG0gdGjhuqV5IHBo4bqnbiB04butIG7DoG8gc2F1IHRo4budaSBnaWFuIGNo4budIik=').decode('utf-8'))
