import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHRocmVhZGluZwppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHJhbmRvbQppbXBvcnQganNvbgpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBMaXN0LCBPcHRpb25hbAppbXBvcnQgY29uZmlnCmltcG9ydCB1dGlscwpmcm9tIHV0aWxzIGltcG9ydCBMb2dMZXZlbCwgTG9nZ2VyCmZyb20gam9icyBpbXBvcnQgVGlrdG9rSm9iLCBJbnN0YWdyYW1Kb2IKCiMgVOG6oW8gbG9nZ2VyIGNobyBKb2JTZXJ2aWNlCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIkpvYlNlcnZpY2UiKQoKIyBDb25zdGFudHMgZm9yIGJldHRlciBjb2RlIHJlYWRhYmlsaXR5CmNsYXNzIEpvYlNlcnZpY2VDb25zdGFudHM6CiAgICAiIiJDb25zdGFudHMgdXNlZCBpbiBKb2JTZXJ2aWNlIiIiCiAgICBERUZBVUxUX0NIRUNLX0lOVEVSVkFMID0gMC41ICAjIFNsZWVwIGNoZWNrIGludGVydmFsIGluIHNlY29uZHMKICAgIE1BWF9XQVJOSU5HX0xPR1MgPSAyMAogICAgCiAgICAjIFN0YXR1cyBtZXNzYWdlcwogICAgTVNHX0RFVklDRV9QQVVTRURfU0VSVkVSID0gIlThuqFtIGThu6tuZyAoU2V2ZXIgecOqdSBj4bqndSkiCiAgICBNU0dfREVWSUNFX05PX0FDQ09VTlRTID0gIlThuqFtIG5naOG7iSAoS2jDtG5nIGPDsyB0w6BpIGtob+G6o24pIgogICAgTVNHX1dBSVRJTkdfUFJPWFkgPSAixJBhbmcgY2jhu50gcHJveHkiCiAgICBNU0dfV09SS0lOR19TRVNTSU9OID0gIsSQYW5nIHRyb25nIHBoacOqbiBsw6BtIHZp4buHYyIKICAgIE1TR19TRVNTSU9OX0NPT0xET1dOID0gIk5naOG7iSBuZ8ahaSBnaeG7r2EgY8OhYyBwaGnDqm4iCiAgICAKICAgICMgQWNjb3VudCBzdGF0dXMgcmVhc29ucwogICAgUkVBU09OX0RBSUxZX0xJTUlUID0gIsSQw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHkiCiAgICBSRUFTT05fU0VTU0lPTl9MSU1JVCA9ICLEkMOjIGhvw6BuIHRow6BuaCBz4buRIGpvYiB04buRaSDEkWEgdHJvbmcgcGhpw6puIgogICAgUkVBU09OX0ZPTExPV19EQUlMWV9MSU1JVCA9ICLEkMOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIGZvbG93IHRyb25nIHBoacOqbiIKICAgIFJFQVNPTl9GT0xMT1dfU0VTU0lPTl9MSU1JVCA9ICLEkMOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIGZvbGxvdyB0cm9uZyBwaGnDqm4iCgpjbGFzcyBKb2JTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZSwgbXF0dF9zZXJ2aWNlPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBKb2JTZXJ2aWNlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZGJfc2VydmljZTogRGF0YWJhc2VTZXJ2aWNlIMSR4buDIGzGsHUgdHLhu68gZOG7ryBsaeG7h3UKICAgICAgICAgICAgaGVscGVyX3NlcnZpY2U6IEhlbHBlclNlcnZpY2UgxJHhu4MgdMawxqFuZyB0w6FjIHbhu5tpIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBnb2xpa2Vfc2VydmljZTogR29MaWtlU2VydmljZSDEkeG7gyBn4buNaSBBUEkgR29MaWtlCiAgICAgICAgICAgIG1xdHRfc2VydmljZTogTVFUVFNlcnZpY2UgxJHhu4MgZ+G7rWkgdGjDtG5nIGLDoW8gKG9wdGlvbmFsKQogICAgICAgICIiIgogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgc2VsZi5oZWxwZXIgPSBoZWxwZXJfc2VydmljZQogICAgICAgIHNlbGYuZ29saWtlX3NlcnZpY2UgPSBnb2xpa2Vfc2VydmljZQogICAgICAgIHNlbGYubXF0dF9zZXJ2aWNlID0gbXF0dF9zZXJ2aWNlCiAgICAgICAgc2VsZi5ydW5uaW5nID0gVHJ1ZQogICAgICAgIHNlbGYuZm9yY2Vfc3RvcCA9IEZhbHNlCiAgICAgICAgCiAgICAgICAgIyBLaOG7n2kgdOG6oW8gY8OhYyBqb2IgaGFuZGxlcgogICAgICAgIHNlbGYuam9iX2hhbmRsZXJzID0ge30KICAgICAgICAKICAgICAgICAjIEZsYWcgxJFp4buBdSBraGnhu4NuCiAgICAgICAgc2VsZi5pc19pbml0aWFsaXplZCA9IEZhbHNlCiAgICAgICAgCiAgICAgICAgIyBUaMO0bmcgdGluIHbhu4EgY8OhYyBhcHAgxJHGsOG7o2Mga8OtY2ggaG/huqF0IC0gbOG6pXkgdOG7qyBkYXRhYmFzZSBob+G6t2MgY29uZmlnCiAgICAgICAgc2VsZi5lbmFibGVkX2FwcHMgPSBzZWxmLmRiLmdldCgiZW5hYmxlZF9hcHBzIiwgY29uZmlnLkVOQUJMRURfQVBQUykKICAgICAgICAKICAgICAgICAjIExvY2sgxJHhu4MgxJHhu5NuZyBi4buZIHRy4bqhbmcgdGjDoWkKICAgICAgICBzZWxmLl9sb2NrID0gdGhyZWFkaW5nLkxvY2soKQogICAgICAgIAogICAgICAgICMgRGljdGlvbmFyeSDEkeG7gyBsxrB1IHPhu5EgbOG6p24gdGjhu60gam9iIHRo4bqldCBi4bqhaSB0aGVvIGFjY291bnRfaWQKICAgICAgICBzZWxmLmZhaWxlZF9qb2JfYXR0ZW1wdHMgPSB7fQogICAgICAgIAogICAgICAgICMgxJDhur9tIHPhu5EgbOG6p24gbGnDqm4gdGnhur9wIGpvYiBmb2xsb3cgdHLhuqMgduG7gSBzdGF0dXMgNCAocGVuZGluZykKICAgICAgICBzZWxmLmZvbGxvd19wZW5kaW5nX2NvdW50cyA9IHt9CiAgICAgICAgCiAgICAgICAgIyBUcuG6oW5nIHRow6FpIHByb3h5IGhp4buHbiB04bqhaQogICAgICAgIHNlbGYuY3VycmVudF9wcm94eV9pZCA9IE5vbmUKICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfbmFtZSA9IE5vbmUKICAgICAgICBzZWxmLnByb3h5X3Nlc3Npb25fZW5kX3RpbWUgPSAwCiAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlID0gTm9uZSAgIyBUYWJsZSBuYW1lIMSRxrDhu6NjIGPhuqVwIHThu6sgcHJveHkgc2VydmVyCiAgICAgICAgc2VsZi5wcm94eV9sYXN0X3VwZGF0ZSA9IDAgICMgVGjhu51pIGdpYW4gdXBkYXRlIGN14buRaSBjw7luZwogICAgICAgIAogICAgICAgICMgxJDhur9tIHPhu5EgbOG6p24gdGjhuqV0IGLhuqFpIGtoaSBzZXR1cCBwcm94eQogICAgICAgIHNlbGYucHJveHlfc2V0dXBfZmFpbF9jb3VudCA9IDAKICAgICAgICAKICAgICAgICAjIFjDs2EgcHJveHkgdGFibGUgbmFtZSBjxakga2jhu49pIGRldmljZSBjb25maWcga2hpIGto4bufaSB04bqhbwogICAgICAgIHNlbGYuZGIuc2V0X2RldmljZV9jb25maWcoInByb3h5X3RhYmxlX25hbWUiLCBOb25lKQogICAgICAgIAogICAgICAgICMgVHLhuqFuZyB0aMOhaSBj4bqtcCBuaOG6rXQgdOG7qyBzZXJ2ZXIgcXVhIE1RVFQKICAgICAgICBzZWxmLmZvcmNlX3Jlc3RhcnRfc2Vzc2lvbiA9IEZhbHNlICAjIEPhuqduIHJlc3RhcnQgc2Vzc2lvbiBkbyBjb25maWcgdGhheSDEkeG7lWkKICAgICAgICAKICAgIGRlZiBzYWZlX3NsZWVwKHNlbGYsIHNlY29uZHM6IGZsb2F0KSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIE5n4bunIGFuIHRvw6BuLCBjw7MgdGjhu4MgZOG7q25nIGzhuqFpIG5nYXkgbOG6rXAgdOG7qWMga2hpIGZvcmNlX3N0b3AgxJHGsOG7o2MgxJHhurd0IHRow6BuaCBUcnVlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2Vjb25kczogU+G7kSBnacOieSBj4bqnbiBuZ+G7pwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IG5n4bunIMSR4bunIHRo4budaSBnaWFuLCBGYWxzZSBu4bq/dSBi4buLIGThu6tuZyBs4bqhaQogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIGNoZWNrX2ludGVydmFsID0gSm9iU2VydmljZUNvbnN0YW50cy5ERUZBVUxUX0NIRUNLX0lOVEVSVkFMICAjIEtp4buDbSB0cmEgbeG7l2kgMC41IGdpw6J5CiAgICAgICAgCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgc2Vjb25kczoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyB5w6p1IGPhuqd1IGThu6tuZyBob+G6t2MgcmVzdGFydCBzZXNzaW9uCiAgICAgICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgICAgIGlmIHNlbGYuZm9yY2Vfc3RvcCBvciBub3Qgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7MgecOqdSBj4bqndSByZXN0YXJ0IHNlc3Npb24sIHRob8OhdCBraOG7j2kgc2xlZXAgbmdheSBs4bqtcCB04bupYwogICAgICAgICAgICAgICAgaWYgc2VsZi5mb3JjZV9yZXN0YXJ0X3Nlc3Npb246CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE5n4bunIG3hu5l0IGtob+G6o25nIG5n4bqvbgogICAgICAgICAgICBzbGVlcF90aW1lID0gbWluKGNoZWNrX2ludGVydmFsLCBzZWNvbmRzIC0gKHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSkpCiAgICAgICAgICAgIGlmIHNsZWVwX3RpbWUgPiAwOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcChzbGVlcF90aW1lKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICBkZWYgaW5pdGlhbGl6ZShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBKb2JTZXJ2aWNlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBraOG7n2kgdOG6oW8gdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygixJBhbmcga2jhu59pIHThuqFvIEpvYlNlcnZpY2UuLi4iKQogICAgICAgIAogICAgICAgICMgMS4gS2nhu4NtIHRyYSBIZWxwZXJTZXJ2aWNlCiAgICAgICAgaGVscGVyX3N1Y2Nlc3MsIGhlbHBlcl9kYXRhID0gdXRpbHMuY2hlY2tfaGVscGVyX3NlcnZpY2Uoc2VsZi5oZWxwZXIpCiAgICAgICAgaWYgbm90IGhlbHBlcl9zdWNjZXNzOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBr4bq/dCBu4buRaSDEkeG6v24gSGVscGVyU2VydmljZS4gVnVpIGzDsm5nIGtp4buDbSB0cmEgbOG6oWkuIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgTMawdSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iyBu4bq/dSBjw7MKICAgICAgICBpZiBoZWxwZXJfZGF0YSBhbmQgImRhdGEiIGluIGhlbHBlcl9kYXRhOgogICAgICAgICAgICBzZWxmLmRiLnNhdmVfZGV2aWNlX2luZm8oaGVscGVyX2RhdGEpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBsxrB1IHRow7RuZyB0aW4gdGhp4bq/dCBi4buLOiB7aGVscGVyX2RhdGFbJ2RhdGEnXS5nZXQoJ2RldmljZV9tb2RlbCcsICdVbmtub3duJyl9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICMgMy4gTMawdSBjw6FjIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmggdsOgbyBkYXRhYmFzZSBu4bq/dSBjaMawYSBjw7MKICAgICAgICBzZWxmLl9zYXZlX2RlZmF1bHRfY29uZmlncygpCiAgICAgICAgICAgIAogICAgICAgICMgNC4gS2nhu4NtIHRyYSB2w6AgbOG6pXkgR29MaWtlIGhlYWRlcnMgbuG6v3UgY+G6p24KICAgICAgICBnb2xpa2Vfc3VjY2VzcyA9IHNlbGYuZ29saWtlX3NlcnZpY2UuZmV0Y2hfZ29saWtlX2hlYWRlcnNfd2l0aF9yZXRyeSgpCiAgICAgICAgaWYgbm90IGdvbGlrZV9zdWNjZXNzOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBs4bqleSBHb0xpa2UgaGVhZGVycy4gVnVpIGzDsm5nIGtp4buDbSB0cmEgbOG6oWkuIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgIyA1LiBLaOG7n2kgdOG6oW8gY8OhYyBqb2IgaGFuZGxlcgogICAgICAgIHNlbGYuX2luaXRfam9iX2hhbmRsZXJzKCkKICAgICAgICAKICAgICAgICAjIDYuIEto4bufaSB04bqhbyBuZ8OgeSBjdeG7kWkgY8O5bmcgxJHDoyByZXNldCBu4bq/dSBjaMawYSBjw7MgdHJvbmcgZGF0YWJhc2UKICAgICAgICBub3cgPSBkYXRldGltZS5kYXRldGltZS5ub3coKQogICAgICAgIHRvZGF5ID0gbm93LmRhdGUoKQogICAgICAgIGpvYl9ob3VyID0gc2VsZi5kYi5nZXQoImpvYl9ob3VyIiwgY29uZmlnLkpPQl9IT1VSKQogICAgICAgIHJlc2V0X3RpbWUgPSBkYXRldGltZS5kYXRldGltZS5jb21iaW5lKHRvZGF5LCBkYXRldGltZS50aW1lKGhvdXI9am9iX2hvdXIsIG1pbnV0ZT0wKSkKICAgICAgICAKICAgICAgICAjIEzhuqV5IG5nw6B5IHJlc2V0IGN14buRaSBjw7luZyB04burIGRhdGFiYXNlCiAgICAgICAgbGFzdF9yZXNldF9kYXRlX3N0ciA9IHNlbGYuZGIuZ2V0KCJsYXN0X3Jlc2V0X2RhdGUiKQogICAgICAgIAogICAgICAgIGlmIG5vdCBsYXN0X3Jlc2V0X2RhdGVfc3RyOgogICAgICAgICAgICAjIE7hur91IGhp4buHbiB04bqhaSDEkcOjIHF1YSBnaeG7nSByZXNldCBj4bunYSBuZ8OgeSBow7RtIG5heSwgxJHDoW5oIGThuqV1IMSRw6MgcmVzZXQKICAgICAgICAgICAgaWYgbm93ID49IHJlc2V0X3RpbWU6CiAgICAgICAgICAgICAgICBsYXN0X3Jlc2V0X2RhdGUgPSB0b2RheQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBO4bq/dSBjaMawYSDEkeG6v24gZ2nhu50gcmVzZXQsIMSRw6FuaCBk4bqldSBsw6AgxJHDoyByZXNldCBuZ8OgeSBow7RtIHF1YQogICAgICAgICAgICAgICAgbGFzdF9yZXNldF9kYXRlID0gdG9kYXkgLSBkYXRldGltZS50aW1lZGVsdGEoZGF5cz0xKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJsYXN0X3Jlc2V0X2RhdGUiLCBsYXN0X3Jlc2V0X2RhdGUuaXNvZm9ybWF0KCkpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiS2jhu59pIHThuqFvIG5nw6B5IHJlc2V0OiB7bGFzdF9yZXNldF9kYXRlfSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIHTDrG0gdGjhuqV5IG5nw6B5IHJlc2V0IGN14buRaSBjw7luZzoge2xhc3RfcmVzZXRfZGF0ZV9zdHJ9IikKICAgICAgICAKICAgICAgICBzZWxmLmlzX2luaXRpYWxpemVkID0gVHJ1ZQogICAgICAgIGxvZ2dlci5pbmZvKCJLaOG7n2kgdOG6oW8gSm9iU2VydmljZSB0aMOgbmggY8O0bmcuIikKICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIAogICAgZGVmIF9jaGVja19hY2NvdW50X3N5bmNfc3RhdHVzKHNlbGYsIGFwcF9uYW1lOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mSB0w6BpIGtob+G6o24gY+G7p2EgbeG7mXQgYXBwCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYXBwX25hbWU6IFTDqm4g4bupbmcgZOG7pW5nIGPhuqduIGtp4buDbSB0cmEKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBj4bqnbiDEkeG7k25nIGLhu5kgbOG6oWksIEZhbHNlIG7hur91IGtow7RuZyBj4bqnbgogICAgICAgICIiIgogICAgICAgICMgTOG6pXkgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kgdOG7qyBkYXRhYmFzZQogICAgICAgIHN5bmNfc3RhdHVzX2tleSA9IGYie2FwcF9uYW1lfV9zeW5jX3N0YXR1cyIKICAgICAgICBzeW5jX3N0YXR1cyA9IHNlbGYuZGIuZ2V0KHN5bmNfc3RhdHVzX2tleSwgRmFsc2UpICAjIE3hurdjIMSR4buLbmggbMOgIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgIAogICAgICAgICMgTuG6v3UgY2jGsGEgxJHhu5NuZyBi4buZIHRow6wgY+G6p24gxJHhu5NuZyBi4buZIGzhuqFpCiAgICAgICAgcmV0dXJuIG5vdCBzeW5jX3N0YXR1cwogICAgICAgIAogICAgZGVmIF91cGRhdGVfYWNjb3VudF9zeW5jX3N0YXR1cyhzZWxmLCBhcHBfbmFtZTogc3RyLCBzdGF0dXM6IGJvb2wgPSBUcnVlKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIEPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mSB0w6BpIGtob+G6o24gY+G7p2EgbeG7mXQgYXBwCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYXBwX25hbWU6IFTDqm4g4bupbmcgZOG7pW5nIGPhuqduIGPhuq1wIG5o4bqtdAogICAgICAgICAgICBzdGF0dXM6IFRydWUgbuG6v3UgxJHDoyDEkeG7k25nIGLhu5ksIEZhbHNlIG7hur91IGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICIiIgogICAgICAgIHN5bmNfc3RhdHVzX2tleSA9IGYie2FwcF9uYW1lfV9zeW5jX3N0YXR1cyIKICAgICAgICAKICAgICAgICAjIEPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mQogICAgICAgIHNlbGYuZGIuc2V0KHN5bmNfc3RhdHVzX2tleSwgc3RhdHVzKQogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIHthcHBfbmFtZX06IHtzdGF0dXN9IikKICAgICAgICAKICAgIGRlZiBfc3luY19hY2NvdW50c19mb3JfYXBwKHNlbGYsIGFwcF9uYW1lOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgxJDhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB2w6AgbWFwIHTDoGkga2hv4bqjbiBHb0xpa2UgY2hvIG3hu5l0IGFwcCBj4bulIHRo4buDCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYXBwX25hbWU6IFTDqm4g4bupbmcgZOG7pW5nIGPhuqduIMSR4buTbmcgYuG7mQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSR4buTbmcgYuG7mSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIGlmIGFwcF9uYW1lIG5vdCBpbiBzZWxmLmpvYl9oYW5kbGVyczoKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgam9iIGhhbmRsZXIgY2hvIHthcHBfbmFtZX0sIGLhu48gcXVhIMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBoYW5kbGVyID0gc2VsZi5qb2JfaGFuZGxlcnNbYXBwX25hbWVdCiAgICAgICAgCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgIyAxLiDEkOG7k25nIGLhu5kgdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJBhbmcgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB7YXBwX25hbWV9Li4uIikKICAgICAgICAgICAgYWNjb3VudHMgPSBoYW5kbGVyLnN5bmNfYWNjb3VudHNfdG9fZGIoKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgxJHhu5NuZyBi4buZIHtsZW4oYWNjb3VudHMpfSB0w6BpIGtob+G6o24ge2FwcF9uYW1lfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIDIuIE1hcCB0w6BpIGtob+G6o24gR29MaWtlCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJBhbmcgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gR29MaWtlIGNobyB7YXBwX25hbWV9Li4uIikKICAgICAgICAgICAgZ29saWtlX2FjY291bnRzID0gaGFuZGxlci5nZXRfZ29saWtlX2FjY291bnRzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdvbGlrZV9hY2NvdW50czoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyB0w6xtIHRo4bqleSB7bGVuKGdvbGlrZV9hY2NvdW50cyl9IHTDoGkga2hv4bqjbiBHb0xpa2UgY2hvIHthcHBfbmFtZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzhuqV5IHTDoGkga2hv4bqjbiB04burIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX2FjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPWFwcF9uYW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMOBbmggeOG6oSB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIG1hcHBlZF9hY2NvdW50cyA9IGhhbmRsZXIubWFwX2dvbGlrZV9hY2NvdW50cyhnb2xpa2VfYWNjb3VudHMsIGRldmljZV9hY2NvdW50cykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMOhbmggeOG6oSB7bGVuKG1hcHBlZF9hY2NvdW50cyl9IHTDoGkga2hv4bqjbiB7YXBwX25hbWV9IHbhu5tpIEdvTGlrZSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gR29MaWtlIG7DoG8gY2hvIHthcHBfbmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgc2VsZi5fdXBkYXRlX2FjY291bnRfc3luY19zdGF0dXMoYXBwX25hbWUsIFRydWUpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIHbDoCBtYXAgR29MaWtlIGNobyB7YXBwX25hbWV9IikKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgbMOgIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICAgICBzZWxmLl91cGRhdGVfYWNjb3VudF9zeW5jX3N0YXR1cyhhcHBfbmFtZSwgRmFsc2UpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIF9zYXZlX2RlZmF1bHRfY29uZmlncyhzZWxmKToKICAgICAgICAiIiJMxrB1IGPDoWMgY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaCB2w6BvIGRhdGFiYXNlIG7hur91IGNoxrBhIGPDsyIiIgogICAgICAgIGRlZmF1bHRfY29uZmlncyA9IHsKICAgICAgICAgICAgIyBD4bqldSBow6xuaCBsacOqbiBxdWFuIMSR4bq/biB0aOG7nWkgZ2lhbiBsw6BtIGpvYgogICAgICAgICAgICAiam9iX2hvdXIiOiBjb25maWcuSk9CX0hPVVIsCiAgICAgICAgICAgICJqb2JfY29vbGRvd25fbWludXRlcyI6IGNvbmZpZy5ERUZBVUxUX0NPT0xET1dOX01JTlVURVMsCiAgICAgICAgICAgICJqb2JfY2hlY2tfaW50ZXJ2YWwiOiBjb25maWcuSk9CX0NIRUNLX0lOVEVSVkFMLAogICAgICAgICAgICAiY29vbGRvd25fZ2V0X2pvYl9nb2xpa2UiOiAzMCwgICMgVGjhu51pIGdpYW4gY2jhu50gKHBow7p0KSBraGkga2jDtG5nIHTDrG0gdGjhuqV5IGpvYiBHb0xpa2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6pXUgaMOsbmggbGnDqm4gcXVhbiDEkeG6v24gc+G7kSBsxrDhu6NuZyBqb2IKICAgICAgICAgICAgIm1heF9qb2JzX3Blcl9kYXkiOiBjb25maWcuTUFYX0pPQlNfUEVSX0RBWSwKICAgICAgICAgICAgIm1heF9qb2JzX3Blcl9zZXNzaW9uIjogY29uZmlnLk1BWF9KT0JTX1BFUl9TRVNTSU9OLAogICAgICAgICAgICAKICAgICAgICAgICAgIyBUcuG6oW5nIHRow6FpIHThuqFtIGThu6tuZyB04burIHNlcnZlcgogICAgICAgICAgICAicGF1c2Vfam9iIjogRmFsc2UsCiAgICAgICAgICAgICMgVHLhuqFuZyB0aMOhaSB0aGnhur90IGLhu4sgxJFhbmcgbMOgbSB2aeG7h2MKICAgICAgICAgICAgImRldmljZV9pc193b3JraW5nIjogRmFsc2UsCiAgICAgICAgICAgICJkZXZpY2VfbWVzc2FnZSI6ICIiLAogICAgICAgICAgICAKICAgICAgICAgICAgIyBEYW5oIHPDoWNoIGPDoWMgYXBwIMSRxrDhu6NjIGvDrWNoIGhv4bqhdAogICAgICAgICAgICAiZW5hYmxlZF9hcHBzIjogY29uZmlnLkVOQUJMRURfQVBQUywKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGhp4bq/dCBs4bqtcCBjaG8gcGjDqXAgY2jEg20gc8OzYyBraGkgbMOgbSBqb2IKICAgICAgICAgICAgImNhcmVfaW5fd29ya2luZ19qb2IiOiBGYWxzZSwKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6pXUgaMOsbmggZ2nDoSB04buRaSB0aGnhu4N1IGNobyBqb2IgZm9sbG93CiAgICAgICAgICAgICJtaW5fZm9sbG93X3ByaWNlIjogMjAsCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgICAgICJ1c2VfcHJveHkiOiBGYWxzZSwgICMgQ8OzIHPhu60gZOG7pW5nIHByb3h5IGtow7RuZwogICAgICAgICAgICAicHJveHlfc2VydmVyIjogImh0dHA6Ly8xMC4wLjAuNTo5MDMyIiwgICMgU2VydmVyIHByb3h5IG3hurdjIMSR4buLbmgKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZGVmYXVsdF9jb25maWdzLml0ZW1zKCk6CiAgICAgICAgICAgICMgQ2jhu4kgbMawdSBu4bq/dSBjaMawYSBjw7MgdHJvbmcgZGF0YWJhc2UKICAgICAgICAgICAgaWYgc2VsZi5kYi5nZXQoa2V5KSBpcyBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoa2V5LCB2YWx1ZSkKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIsSQw6MgbMawdSBj4bqldSBow6xuaCBt4bq3YyDEkeG7i25oOiB7a2V5fT17dmFsdWV9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkPhuqV1IGjDrG5oIHtrZXl9IMSRw6MgdOG7k24gdOG6oWk6IHtzZWxmLmRiLmdldChrZXkpfSIpCiAgICAgICAgCiAgICBkZWYgX2luaXRfam9iX2hhbmRsZXJzKHNlbGYpOgogICAgICAgICIiIkto4bufaSB04bqhbyBjw6FjIGpvYiBoYW5kbGVyIiIiCiAgICAgICAgIyBpbml0IHRow6wgc+G6vSBpbml0IGhhbmRsZXJzIGNobyB04bqldCBj4bqjIGPDoWMgYXBwLCBsw6BtIGFwcCBuw6BvIHRow6wgc+G6vSB0aGVvIGPhuqV1IGjDrG5oIGzhuqV5IHThu6sgZGF0YWJhc2UKICAgICAgICBmb3IgYXBwX25hbWUgaW4gY29uZmlnLkVOQUJMRURfQVBQUzoKICAgICAgICAgICAgaWYgYXBwX25hbWUgPT0gInRpa3RvayI6CiAgICAgICAgICAgICAgICBzZWxmLmpvYl9oYW5kbGVyc1thcHBfbmFtZV0gPSBUaWt0b2tKb2Ioc2VsZi5kYiwgc2VsZi5oZWxwZXIsIHNlbGYuZ29saWtlX3NlcnZpY2UpCiAgICAgICAgICAgICAgICAjIFRydXnhu4FuIHBoxrDGoW5nIHRo4bupYyBzYWZlX3NsZWVwIHbDoG8gam9iIGhhbmRsZXIKICAgICAgICAgICAgICAgIHNlbGYuam9iX2hhbmRsZXJzW2FwcF9uYW1lXS5zZXRfc2xlZXBfZnVuY3Rpb24oc2VsZi5zYWZlX3NsZWVwKQogICAgICAgICAgICBlbGlmIGFwcF9uYW1lID09ICJpbnN0YWdyYW0iOgogICAgICAgICAgICAgICAgc2VsZi5qb2JfaGFuZGxlcnNbYXBwX25hbWVdID0gSW5zdGFncmFtSm9iKHNlbGYuZGIsIHNlbGYuaGVscGVyLCBzZWxmLmdvbGlrZV9zZXJ2aWNlKQogICAgICAgICAgICAgICAgIyBUcnV54buBbiBwaMawxqFuZyB0aOG7qWMgc2FmZV9zbGVlcCB2w6BvIGpvYiBoYW5kbGVyCiAgICAgICAgICAgICAgICBzZWxmLmpvYl9oYW5kbGVyc1thcHBfbmFtZV0uc2V0X3NsZWVwX2Z1bmN0aW9uKHNlbGYuc2FmZV9zbGVlcCkKICAgICAgICAgICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBraOG7n2kgdOG6oW8ge2xlbihzZWxmLmpvYl9oYW5kbGVycyl9IGpvYiBoYW5kbGVyOiB7JywgJy5qb2luKHNlbGYuam9iX2hhbmRsZXJzLmtleXMoKSl9IikKICAgICAgICAKICAgIGRlZiBfcmVzZXRfZGFpbHlfY291bnRlcnMoc2VsZik6CiAgICAgICAgIiIiUmVzZXQgYuG7mSDEkeG6v20gaMOgbmcgbmfDoHkgdsOgbyBnaeG7nSDEkcaw4bujYyBj4bqldSBow6xuaCIiIgogICAgICAgIG5vdyA9IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpCiAgICAgICAgdG9kYXkgPSBub3cuZGF0ZSgpCiAgICAgICAgCiAgICAgICAgIyBM4bqleSBnaeG7nSByZXNldCB04burIGPhuqV1IGjDrG5oIGhv4bq3YyB04burIGRhdGFiYXNlIG7hur91IGPDswogICAgICAgIGpvYl9ob3VyID0gc2VsZi5kYi5nZXQoImpvYl9ob3VyIiwgY29uZmlnLkpPQl9IT1VSKQogICAgICAgIAogICAgICAgICMgVMOtbmggdGjhu51pIMSRaeG7g20gcmVzZXQgY+G7p2EgbmfDoHkgaMO0bSBuYXkKICAgICAgICByZXNldF90aW1lID0gZGF0ZXRpbWUuZGF0ZXRpbWUuY29tYmluZSh0b2RheSwgZGF0ZXRpbWUudGltZShob3VyPWpvYl9ob3VyLCBtaW51dGU9MCkpCiAgICAgICAgCiAgICAgICAgIyBM4bqleSBuZ8OgeSByZXNldCBjdeG7kWkgY8O5bmcgdOG7qyBkYXRhYmFzZQogICAgICAgIGxhc3RfcmVzZXRfZGF0ZV9zdHIgPSBzZWxmLmRiLmdldCgibGFzdF9yZXNldF9kYXRlIikKICAgICAgICBsYXN0X3Jlc2V0X2RhdGUgPSBOb25lCiAgICAgICAgCiAgICAgICAgaWYgbGFzdF9yZXNldF9kYXRlX3N0cjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbGFzdF9yZXNldF9kYXRlID0gZGF0ZXRpbWUuZGF0ZS5mcm9taXNvZm9ybWF0KGxhc3RfcmVzZXRfZGF0ZV9zdHIpCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYixJDhu4tuaCBk4bqhbmcgbmfDoHkgcmVzZXQga2jDtG5nIGjhu6NwIGzhu4c6IHtsYXN0X3Jlc2V0X2RhdGVfc3RyfSIpCiAgICAgICAgICAgICAgICBsYXN0X3Jlc2V0X2RhdGUgPSBOb25lCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIHF1YSBnaeG7nSByZXNldCBj4bunYSBuZ8OgeSBow7RtIG5heSBjaMawYSB2w6AgY2jGsGEgcmVzZXQgdHJvbmcgbmfDoHkgaMO0bSBuYXkKICAgICAgICBpZiBub3cgPj0gcmVzZXRfdGltZSBhbmQgKGxhc3RfcmVzZXRfZGF0ZSBpcyBOb25lIG9yIGxhc3RfcmVzZXRfZGF0ZSA8IHRvZGF5KToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUaOG7sWMgaGnhu4duIHJlc2V0IGLhu5kgxJHhur9tIGjDoG5nIG5nw6B5IChnaeG7nSByZXNldDoge2pvYl9ob3VyfTowMCkiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBSZXNldCBjw6FjIGLhu5kgxJHhur9tIGNobyB04bqldCBj4bqjIHTDoGkga2hv4bqjbgogICAgICAgICAgICBmb3IgYXBwX25hbWUgaW4gc2VsZi5lbmFibGVkX2FwcHM6CiAgICAgICAgICAgICAgICBhY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1hcHBfbmFtZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gYWNjb3VudHM6CiAgICAgICAgICAgICAgICAgICAgIyBSZXNldCBz4buRIGpvYiBow7RtIG5heSB2w6Agc+G7kSBqb2IgdHJvbmcgcGhpw6puCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfdG9kYXkiOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAiam9ic19kb25lX2luX3Nlc3Npb24iOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAiZm9sbG93X3RvZGF5IjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgImZvbGxvd19pbl9zZXNzaW9uIjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgImxhc3Rfdmlld19zdG9yaWVzIjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgImRpc2FibGVfZm9sbG93IjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICJmb2xsb3dfZGlzYWJsZV91bnRpbCI6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgdMOgaSBraG/huqNuIMSRYW5nIOG7nyB0cuG6oW5nIHRow6FpIGluYWN0aXZlIHbDrCDEkcOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIGjDoG5nIG5nw6B5LAogICAgICAgICAgICAgICAgICAgICMgxJHhurd0IGzhuqFpIHRy4bqhbmcgdGjDoWkgdGjDoG5oIGFjdGl2ZQogICAgICAgICAgICAgICAgICAgIGlmIGFjY291bnQuZ2V0KCJzdGF0dXMiKSA9PSAiaW5hY3RpdmUiIGFuZCBhY2NvdW50LmdldCgiaW5hY3RpdmVfcmVhc29uIikgPT0gIsSQw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHkiOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiYWN0aXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfZGlzYWJsZV91bnRpbCI6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDEkeG6t3QgbOG6oWkgdHLhuqFuZyB0aMOhaSBhY3RpdmUgY2hvIHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSBzYXUga2hpIHJlc2V0IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIHJlc2V0IGLhu5kgxJHhur9tIGjDoG5nIG5nw6B5IGNobyB04bqldCBj4bqjIHTDoGkga2hv4bqjbiB2w6BvIHtub3cuc3RyZnRpbWUoJyVZLSVtLSVkICVIOiVNOiVTJyl9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IG5nw6B5IMSRw6MgcmVzZXQgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICBzZWxmLmRiLnNldCgibGFzdF9yZXNldF9kYXRlIiwgdG9kYXkuaXNvZm9ybWF0KCkpCiAgICAgICAgCiAgICBkZWYgX2Nhbl9ydW5fam9iKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIGPDsyB0aOG7gyBjaOG6oXkgam9iIGNobyB0w6BpIGtob+G6o24ga2jDtG5nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBjw7MgdGjhu4MgY2jhuqF5IGpvYiwgRmFsc2UgbuG6v3Uga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdXNlcm5hbWUgPSBhY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJ1Vua25vd24nKQogICAgICAgIAogICAgICAgICMgMS4gS2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIGPGoSBi4bqjbgogICAgICAgIGlmIG5vdCBzZWxmLl9jaGVja19iYXNpY19hY2NvdW50X3N0YXR1cyhhY2NvdW50KToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgMi4gS2nhu4NtIHRyYSDEkWnhu4F1IGtp4buHbiBj4bqnbiB0aGnhur90CiAgICAgICAgaWYgbm90IHNlbGYuX2NoZWNrX2FjY291bnRfcHJlcmVxdWlzaXRlcyhhY2NvdW50KToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgMy4gxJDhuqNtIGLhuqNvIGPDoWMgZ2nhu5tpIGjhuqFuIMSRxrDhu6NjIHRoaeG6v3QgbOG6rXAKICAgICAgICBhY2NvdW50ID0gc2VsZi5fZW5zdXJlX2FjY291bnRfbGltaXRzX3NldChhY2NvdW50KQogICAgICAgIAogICAgICAgICMgNC4gS2nhu4NtIHRyYSBnaeG7m2kgaOG6oW4gam9iIGjDoG5nIG5nw6B5CiAgICAgICAgaWYgc2VsZi5faXNfYWNjb3VudF9hdF9kYWlseV9saW1pdChhY2NvdW50KToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge3VzZXJuYW1lfSDEkcOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIHRyb25nIG5nw6B5IikKICAgICAgICAgICAgc2VsZi5kYi5zZXRfYWNjb3VudF9pbmFjdGl2ZV91bnRpbF9uZXh0X3Jlc2V0KGFjY291bnRbImlkIl0sICLEkMOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIGjDoG5nIG5nw6B5IikKICAgICAgICAgICAgc2VsZi5fY2xvc2VfYXBwX2Zvcl9hY2NvdW50KGFjY291bnQpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAjIDUuIEtp4buDbSB0cmEgZ2nhu5tpIGjhuqFuIGpvYiB0cm9uZyBwaGnDqm4KICAgICAgICBpZiBzZWxmLl9pc19hY2NvdW50X2F0X3Nlc3Npb25fbGltaXQoYWNjb3VudCk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHt1c2VybmFtZX0gxJHDoyBsw6BtIMSR4bunIGpvYiB0cm9uZyBwaGnDqm4iKQogICAgICAgICAgICBzZWxmLmRiLnNldF9hY2NvdW50X2luYWN0aXZlKGFjY291bnRbImlkIl0sIGluYWN0aXZlX3JlYXNvbj0ixJDDoyBob8OgbiB0aMOgbmggc+G7kSBqb2IgdOG7kWkgxJFhIHRyb25nIHBoacOqbiIpCiAgICAgICAgICAgIHNlbGYuX2Nsb3NlX2FwcF9mb3JfYWNjb3VudChhY2NvdW50KQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIAogICAgZGVmIF9jaGVja19iYXNpY19hY2NvdW50X3N0YXR1cyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJLaeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgY8ahIGLhuqNuIGPhu6dhIHTDoGkga2hv4bqjbiIiIgogICAgICAgIGFjY291bnRfc3RhdHVzID0gYWNjb3VudC5nZXQoInN0YXR1cyIsICJhY3RpdmUiKQogICAgICAgIAogICAgICAgICMgTuG6v3UgdMOgaSBraG/huqNuIGLhu4sgZGlzYWJsZWQsIGtow7RuZyBjaG8gY2jhuqF5IGpvYgogICAgICAgIGlmIGFjY291bnRfc3RhdHVzID09ICJkaXNhYmxlZCI6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAjIE7hur91IHTDoGkga2hv4bqjbiDEkcOjIGxvZ291dCwga2jDtG5nIGNobyBjaOG6oXkgam9iCiAgICAgICAgaWYgYWNjb3VudF9zdGF0dXMgPT0gImxvZ291dCI6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAjIE7hur91IHTDoGkga2hv4bqjbiDEkWFuZyBpbmFjdGl2ZSwga2nhu4NtIHRyYSB0aOG7nWkgZ2lhbiBjb29sZG93bgogICAgICAgIGlmIGFjY291bnRfc3RhdHVzID09ICJpbmFjdGl2ZSI6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9oYW5kbGVfaW5hY3RpdmVfYWNjb3VudChhY2NvdW50KQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIAogICAgZGVmIF9oYW5kbGVfaW5hY3RpdmVfYWNjb3VudChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJY4butIGzDvSB0w6BpIGtob+G6o24gxJFhbmcg4bufIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUiIiIKICAgICAgICBqb2JfZGlzYWJsZV91bnRpbCA9IGFjY291bnQuZ2V0KCJqb2JfZGlzYWJsZV91bnRpbCIsIDApCiAgICAgICAgdXNlcm5hbWUgPSBhY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJ1Vua25vd24nKQogICAgICAgIAogICAgICAgICMgTuG6v3UgxJHDoyBo4bq/dCB0aOG7nWkgZ2lhbiBjb29sZG93biwgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgduG7gSBhY3RpdmUKICAgICAgICBpZiBqb2JfZGlzYWJsZV91bnRpbCA8PSB0aW1lLnRpbWUoKToKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSB24buBIGFjdGl2ZQogICAgICAgICAgICB1cGRhdGVfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiYWN0aXZlIiwKICAgICAgICAgICAgICAgICJsYXN0X2NhcmVfdGltZSI6IDAsCiAgICAgICAgICAgICAgICAiZGlzYWJsZV9mb2xsb3ciOiBGYWxzZSwKICAgICAgICAgICAgICAgICJmb2xsb3dfZGlzYWJsZV91bnRpbCI6IDAsCiAgICAgICAgICAgICAgICAiaW5hY3RpdmVfZm9sbG93X3JlYXNvbiI6ICIiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHVwZGF0ZV9kYXRhKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IMSRw6MgaOG6v3QgdGjhu51pIGdpYW4gY2jhu50sIMSRw6MgY2h1eeG7g24gduG7gSB0cuG6oW5nIHRow6FpIGFjdGl2ZSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBDaMawYSBo4bq/dCB0aOG7nWkgZ2lhbiBjaOG7nQogICAgICAgICAgICBjb29sZG93bl9yZW1haW4gPSBpbnQoKGpvYl9kaXNhYmxlX3VudGlsIC0gdGltZS50aW1lKCkpIC8gNjApCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHt1c2VybmFtZX0gxJFhbmcgdHJvbmcgdGjhu51pIGdpYW4gY2jhu50gKGPDsm4ge2Nvb2xkb3duX3JlbWFpbn0gcGjDunQpIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9jaGVja19hY2NvdW50X3ByZXJlcXVpc2l0ZXMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiS2nhu4NtIHRyYSBjw6FjIMSRaeG7gXUga2nhu4duIHRpw6puIHF1eeG6v3QgY+G7p2EgdMOgaSBraG/huqNuIiIiCiAgICAgICAgIyBLaeG7g20gdHJhIHhlbSB0w6BpIGtob+G6o24gY8OzIMSRxrDhu6NjIGLhuq10IGpvYiBraMO0bmcKICAgICAgICBpZiBub3QgYWNjb3VudC5nZXQoImpvYl9lbmFibGUiLCBGYWxzZSk6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiDEkcOjIMSRxrDhu6NjIGxpw6puIGvhur90IHbhu5tpIEdvTGlrZSBjaMawYQogICAgICAgIGlmIG5vdCBhY2NvdW50LmdldCgiaXNfZ29saWtlX2xpbmtlZCIsIEZhbHNlKToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICBkZWYgX2Vuc3VyZV9hY2NvdW50X2xpbWl0c19zZXQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIMSQ4bqjbSBi4bqjbyBjw6FjIGdp4bubaSBo4bqhbiBj4bunYSB0w6BpIGtob+G6o24gxJHGsOG7o2MgdGhp4bq/dCBs4bqtcCB24bubaSBnacOhIHRy4buLIG3hurdjIMSR4buLbmgKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24gxJHDoyDEkcaw4bujYyBj4bqtcCBuaOG6rXQKICAgICAgICAiIiIKICAgICAgICB1cGRhdGVfZGF0YSA9IHt9CiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHbDoCB0aGnhur90IGzhuq1wIG1heF9qb2JzX3Blcl9zZXNzaW9uCiAgICAgICAgaWYgYWNjb3VudC5nZXQoIm1heF9qb2JzX3Blcl9zZXNzaW9uIiwgMCkgPD0gMDoKICAgICAgICAgICAgdXBkYXRlX2RhdGFbIm1heF9qb2JzX3Blcl9zZXNzaW9uIl0gPSBjb25maWcuTUFYX0pPQlNfUEVSX1NFU1NJT04KICAgICAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHbDoCB0aGnhur90IGzhuq1wIGpvYl9tYXhfZGF5CiAgICAgICAgaWYgYWNjb3VudC5nZXQoImpvYl9tYXhfZGF5IiwgMCkgPD0gMDoKICAgICAgICAgICAgdXBkYXRlX2RhdGFbImpvYl9tYXhfZGF5Il0gPSBjb25maWcuTUFYX0pPQlNfUEVSX0RBWQogICAgICAgICAgICAKICAgICAgICAjIEPhuq1wIG5o4bqtdCB2w6BvIGRhdGFiYXNlIG7hur91IGPDsyB0aGF5IMSR4buVaQogICAgICAgIGlmIHVwZGF0ZV9kYXRhOgogICAgICAgICAgICB1cGRhdGVfZGF0YVsiaXNfc3luYyJdID0gRmFsc2UKICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgYWNjb3VudC51cGRhdGUodXBkYXRlX2RhdGEpCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhY2NvdW50CiAgICAgICAgCiAgICBkZWYgX2Nsb3NlX2FwcF9mb3JfYWNjb3VudChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICDEkMOzbmcgYXBwIHTGsMahbmcg4bupbmcgduG7m2kgdMOgaSBraG/huqNuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAiIiIKICAgICAgICBhcHBfbmFtZSA9IGFjY291bnQuZ2V0KCJhcHAiKQogICAgICAgIGlmIGFwcF9uYW1lIGFuZCBhcHBfbmFtZSBpbiBjb25maWcuQVBQX1BBQ0tBR0VTOgogICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoY29uZmlnLkFQUF9QQUNLQUdFU1thcHBfbmFtZV0pCiAgICAgICAgICAgIAogICAgZGVmIF9pc19hY2NvdW50X2F0X2RhaWx5X2xpbWl0KHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiBjw7MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHkga2jDtG5nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkcOjIMSR4bqhdCBnaeG7m2kgaOG6oW4KICAgICAgICAiIiIKICAgICAgICBqb2JfdG9kYXkgPSBhY2NvdW50LmdldCgiam9iX3RvZGF5IiwgMCkKICAgICAgICBqb2JfbWF4X2RheSA9IGFjY291bnQuZ2V0KCJqb2JfbWF4X2RheSIsIDApIG9yIGNvbmZpZy5NQVhfSk9CU19QRVJfREFZCiAgICAgICAgcmV0dXJuIGpvYl90b2RheSA+PSBqb2JfbWF4X2RheQogICAgICAgIAogICAgZGVmIF9pc19hY2NvdW50X2F0X3Nlc3Npb25fbGltaXQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIGPDsyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGpvYiB0cm9uZyBwaGnDqm4ga2jDtG5nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkcOjIMSR4bqhdCBnaeG7m2kgaOG6oW4KICAgICAgICAiIiIKICAgICAgICBqb2JzX2RvbmVfaW5fc2Vzc2lvbiA9IGFjY291bnQuZ2V0KCJqb2JzX2RvbmVfaW5fc2Vzc2lvbiIsIDApCiAgICAgICAgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPSBhY2NvdW50LmdldCgibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCAwKSBvciBjb25maWcuTUFYX0pPQlNfUEVSX1NFU1NJT04KICAgICAgICByZXR1cm4gam9ic19kb25lX2luX3Nlc3Npb24gPj0gbWF4X2pvYnNfcGVyX3Nlc3Npb24KICAgICAgICAKICAgIGRlZiBfdXBkYXRlX2pvYl9zdGF0cyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgc3VjY2VzczogYm9vbCA9IFRydWUsIGpvYl90eXBlOiBzdHIgPSBOb25lKToKICAgICAgICAiIiIKICAgICAgICBD4bqtcCBuaOG6rXQgdGjhu5FuZyBrw6ogam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgc3VjY2VzczogVHJ1ZSBu4bq/dSBqb2IgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAgICAgam9iX3R5cGU6IExv4bqhaSBqb2IgKGZvbGxvdywgbGlrZSwgZXRjLikKICAgICAgICAiIiIKICAgICAgICB1c2VybmFtZSA9IGFjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnVW5rbm93bicpCiAgICAgICAgCiAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiBqb2IgY8ahIGLhuqNuCiAgICAgICAgc2VsZi5fdXBkYXRlX2Jhc2ljX2pvYl9zdGF0cyhhY2NvdW50LCBzdWNjZXNzKQogICAgICAgIAogICAgICAgICMgUmVzZXQgc+G7kSBs4bqnbiB0aOG7rSBqb2IgdGjhuqV0IGLhuqFpIG7hur91IGpvYiB0aMOgbmggY8O0bmcKICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICBzZWxmLmZhaWxlZF9qb2JfYXR0ZW1wdHNbYWNjb3VudFsiaWQiXV0gPSAwCiAgICAgICAgCiAgICAgICAgIyDEkOG6o20gYuG6o28gY8OhYyBnaeG7m2kgaOG6oW4gxJHGsOG7o2MgdGhp4bq/dCBs4bqtcAogICAgICAgIGFjY291bnQgPSBzZWxmLl9lbnN1cmVfYWNjb3VudF9saW1pdHNfc2V0KGFjY291bnQpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHbDoCB44butIGzDvSBnaeG7m2kgaOG6oW4gcGhpw6puCiAgICAgICAgc2VsZi5fY2hlY2tfc2Vzc2lvbl9saW1pdF9hZnRlcl9qb2IoYWNjb3VudCkKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgdsOgIHjhu60gbMO9IGdp4bubaSBo4bqhbiBow6BuZyBuZ8OgeQogICAgICAgIHNlbGYuX2NoZWNrX2RhaWx5X2xpbWl0X2FmdGVyX2pvYihhY2NvdW50KQogICAgICAgIAogICAgICAgICMgWOG7rSBsw70gdGjhu5FuZyBrw6ogcmnDqm5nIGNobyBqb2IgZm9sbG93CiAgICAgICAgaWYgc3VjY2VzcyBhbmQgam9iX3R5cGUgYW5kIGpvYl90eXBlLmxvd2VyKCkgPT0gImZvbGxvdyI6CiAgICAgICAgICAgIHNlbGYuX3VwZGF0ZV9mb2xsb3dfc3RhdHMoYWNjb3VudCkKICAgICAgICAgICAgCiAgICBkZWYgX3VwZGF0ZV9iYXNpY19qb2Jfc3RhdHMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIHN1Y2Nlc3M6IGJvb2wpOgogICAgICAgICIiIkPhuq1wIG5o4bqtdCB0aOG7kW5nIGvDqiBqb2IgY8ahIGLhuqNuIC0gY2jhu4kgxJHhur9tIGpvYiB0aMOgbmggY8O0bmciIiIKICAgICAgICBqb2JfdG9kYXkgPSBhY2NvdW50LmdldCgiam9iX3RvZGF5IiwgMCkKICAgICAgICBqb2JzX2RvbmVfaW5fc2Vzc2lvbiA9IGFjY291bnQuZ2V0KCJqb2JzX2RvbmVfaW5fc2Vzc2lvbiIsIDApCiAgICAgICAgCiAgICAgICAgdXBkYXRlX2RhdGEgPSB7CiAgICAgICAgICAgICJsYXN0X2pvYl90aW1lIjogaW50KHRpbWUudGltZSgpKSwKICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgIH0KICAgICAgICAKICAgICAgICAjIENo4buJIHTEg25nIGNvdW50ZXJzIGtoaSBqb2IgdGjDoG5oIGPDtG5nCiAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgdXBkYXRlX2RhdGEudXBkYXRlKHsKICAgICAgICAgICAgICAgICJqb2JfdG9kYXkiOiBqb2JfdG9kYXkgKyAxLAogICAgICAgICAgICAgICAgImpvYnNfZG9uZV9pbl9zZXNzaW9uIjogam9ic19kb25lX2luX3Nlc3Npb24gKyAxLAogICAgICAgICAgICAgICAgInRvdGFsX2pvYnMiOiBhY2NvdW50LmdldCgidG90YWxfam9icyIsIDApICsgMQogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHVwZGF0ZV9kYXRhKQogICAgICAgIGFjY291bnQudXBkYXRlKHVwZGF0ZV9kYXRhKSAgIyBD4bqtcCBuaOG6rXQgbG9jYWwgZGF0YQogICAgICAgIAogICAgZGVmIF9jaGVja19zZXNzaW9uX2xpbWl0X2FmdGVyX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSk6CiAgICAgICAgIiIiS2nhu4NtIHRyYSBnaeG7m2kgaOG6oW4gcGhpw6puIHNhdSBraGkgbMOgbSBqb2IiIiIKICAgICAgICBqb2JzX2RvbmVfaW5fc2Vzc2lvbiA9IGFjY291bnQuZ2V0KCJqb2JzX2RvbmVfaW5fc2Vzc2lvbiIsIDApCiAgICAgICAgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPSBhY2NvdW50LmdldCgibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCAwKSBvciBjb25maWcuTUFYX0pPQlNfUEVSX1NFU1NJT04KICAgICAgICB1c2VybmFtZSA9IGFjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnVW5rbm93bicpCiAgICAgICAgCiAgICAgICAgaWYgam9ic19kb25lX2luX3Nlc3Npb24gPj0gbWF4X2pvYnNfcGVyX3Nlc3Npb246CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHt1c2VybmFtZX0gxJHDoyBsw6BtIMSR4bunIHttYXhfam9ic19wZXJfc2Vzc2lvbn0gam9iIHRyb25nIHBoacOqbiIpCiAgICAgICAgICAgIHNlbGYuZGIuc2V0X2FjY291bnRfaW5hY3RpdmUoYWNjb3VudFsiaWQiXSwgaW5hY3RpdmVfcmVhc29uPSLEkMOjIGhvw6BuIHRow6BuaCBz4buRIGpvYiB04buRaSDEkWEgdHJvbmcgcGhpw6puIikKICAgICAgICAgICAgc2VsZi5fY2xvc2VfYXBwX2Zvcl9hY2NvdW50KGFjY291bnQpCiAgICAgICAgICAgIAogICAgZGVmIF9jaGVja19kYWlseV9saW1pdF9hZnRlcl9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIktp4buDbSB0cmEgZ2nhu5tpIGjhuqFuIGjDoG5nIG5nw6B5IHNhdSBraGkgbMOgbSBqb2IiIiIKICAgICAgICBqb2JfdG9kYXkgPSBhY2NvdW50LmdldCgiam9iX3RvZGF5IiwgMCkKICAgICAgICBqb2JfbWF4X2RheSA9IGFjY291bnQuZ2V0KCJqb2JfbWF4X2RheSIsIDApIG9yIGNvbmZpZy5NQVhfSk9CU19QRVJfREFZCiAgICAgICAgdXNlcm5hbWUgPSBhY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJ1Vua25vd24nKQogICAgICAgIAogICAgICAgIGlmIGpvYl90b2RheSA+PSBqb2JfbWF4X2RheToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge3VzZXJuYW1lfSDEkcOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIHRyb25nIG5nw6B5ICh7am9iX3RvZGF5fS97am9iX21heF9kYXl9KSIpCiAgICAgICAgICAgIHNlbGYuZGIuc2V0X2FjY291bnRfaW5hY3RpdmVfdW50aWxfbmV4dF9yZXNldChhY2NvdW50WyJpZCJdLCAixJDDoyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGpvYiBow6BuZyBuZ8OgeSIpCiAgICAgICAgICAgIHNlbGYuX2Nsb3NlX2FwcF9mb3JfYWNjb3VudChhY2NvdW50KQogICAgICAgICAgICAKICAgIGRlZiBfc2V0X2FjY291bnRfbG9nb3V0KHNlbGYsIGFjY291bnRfaWQ6IGludCwgdXNlcm5hbWU6IHN0ciA9IE5vbmUpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgxJDDoW5oIGThuqV1IHTDoGkga2hv4bqjbiDEkcOjIGxvZ291dAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnRfaWQ6IElEIGPhu6dhIHTDoGkga2hv4bqjbgogICAgICAgICAgICB1c2VybmFtZTogVXNlcm5hbWUgxJHhu4MgbG9nIChvcHRpb25hbCkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVOG6oW8gbWVzc2FnZSB24bubaSBuZ8OgeSBnaeG7nSBoaeG7h24gdOG6oWkKICAgICAgICAgICAgaW1wb3J0IGRhdGV0aW1lCiAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlZC8lbS8lWSAlSDolTTolUyIpCiAgICAgICAgICAgIGxvZ291dF9tZXNzYWdlID0gZiJQaMOhdCBoaeG7h24gbG9nb3V0OiB7Y3VycmVudF90aW1lfSIKICAgICAgICAgICAgCiAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJsb2dvdXQiLAogICAgICAgICAgICAgICAgImluYWN0aXZlX3JlYXNvbiI6IGxvZ291dF9tZXNzYWdlLAogICAgICAgICAgICAgICAgImxhc3Rfam9iX3RpbWUiOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDEkcOhbmggZOG6pXUgdMOgaSBraG/huqNuIHt1c2VybmFtZSBvciBhY2NvdW50X2lkfSBsw6AgbG9nb3V0IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSBsb2dvdXQgY2hvIHTDoGkga2hv4bqjbiB7dXNlcm5hbWUgb3IgYWNjb3VudF9pZH0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgxJHDoW5oIGThuqV1IHTDoGkga2hv4bqjbiBsb2dvdXQ6IHtlfSIpCiAgICAgICAgICAgIAogICAgZGVmIF91cGRhdGVfZm9sbG93X3N0YXRzKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKToKICAgICAgICAiIiJD4bqtcCBuaOG6rXQgdGjhu5FuZyBrw6ogcmnDqm5nIGNobyBmb2xsb3cgam9iIHRow6BuaCBjw7RuZyAoxJHDoyBi4buPIGdp4bubaSBo4bqhbiBmb2xsb3cpIiIiCiAgICAgICAgdXNlcm5hbWUgPSBhY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJ1Vua25vd24nKQogICAgICAgIGZvbGxvd190b2RheSA9IGFjY291bnQuZ2V0KCJmb2xsb3dfdG9kYXkiLCAwKSArIDEKICAgICAgICBmb2xsb3dfaW5fc2Vzc2lvbiA9IGFjY291bnQuZ2V0KCJmb2xsb3dfaW5fc2Vzc2lvbiIsIDApICsgMQogICAgICAgIAogICAgICAgICMgQ+G6rXAgbmjhuq10IHPhu5EgbGnhu4d1IGZvbGxvdyB0aMOgbmggY8O0bmcKICAgICAgICB1cGRhdGVfZm9sbG93ID0gewogICAgICAgICAgICAiZm9sbG93X3RvZGF5IjogZm9sbG93X3RvZGF5LAogICAgICAgICAgICAiZm9sbG93X2luX3Nlc3Npb24iOiBmb2xsb3dfaW5fc2Vzc2lvbiwKICAgICAgICAgICAgImxhc3RfZm9sbG93X3RpbWUiOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAiZGlzYWJsZV9mb2xsb3ciOiBGYWxzZSwgICMgTHXDtG4gbHXDtG4gxJHhu4MgRmFsc2UgdsOsIMSRw6MgYuG7jyBnaeG7m2kgaOG6oW4KICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgIH0KICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHVwZGF0ZV9mb2xsb3cpCiAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge3VzZXJuYW1lfSDEkcOjIHRo4buxYyBoaeG7h24gZm9sbG93IHRow6BuaCBjw7RuZyAoe2ZvbGxvd190b2RheX0gZm9sbG93IGjDtG0gbmF5KSIpCiAgICAgICAgCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgSm9iU2VydmljZSB0cm9uZyB0aHJlYWQgcmnDqm5nCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgdGhyZWFkaW5nLlRocmVhZDogVGhyZWFkIMSRYW5nIGNo4bqheSBKb2JTZXJ2aWNlIGhv4bq3YyBOb25lIG7hur91IGzhu5dpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bq3dCB0cuG6oW5nIHRow6FpIHJ1bm5pbmcKICAgICAgICAgICAgc2VsZi5ydW5uaW5nID0gVHJ1ZQogICAgICAgICAgICBzZWxmLmZvcmNlX3N0b3AgPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyB0aHJlYWQKICAgICAgICAgICAgdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5ydW4pCiAgICAgICAgICAgIHRocmVhZC5kYWVtb24gPSBUcnVlCiAgICAgICAgICAgIHRocmVhZC5zdGFydCgpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdGhyZWFkCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkga2jhu59pIMSR4buZbmcgSm9iU2VydmljZSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgZGVmIHJlc2V0X2luYWN0aXZlX2FjY291bnRzKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgdsOgIGtow7RpIHBo4bulYyBjw6FjIHTDoGkga2hv4bqjbiBpbmFjdGl2ZSDEkcOjIGjhur90IHRo4budaSBnaWFuIGNo4budCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdOG6pXQgY+G6oyB0w6BpIGtob+G6o24g4bufIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUKICAgICAgICAgICAgZm9yIGFwcF9uYW1lIGluIHNlbGYuZW5hYmxlZF9hcHBzOgogICAgICAgICAgICAgICAgaW5hY3RpdmVfYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9YXBwX25hbWUsIHN0YXR1cz0iaW5hY3RpdmUiKSBvciBbXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBpbmFjdGl2ZV9hY2NvdW50czoKICAgICAgICAgICAgICAgICAgICBqb2JfZGlzYWJsZV91bnRpbCA9IGFjY291bnQuZ2V0KCJqb2JfZGlzYWJsZV91bnRpbCIsIDApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSDEkcOjIGjhur90IHRo4budaSBnaWFuIGNo4budLCBjaHV54buDbiB24buBIHRy4bqhbmcgdGjDoWkgYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgaWYgam9iX2Rpc2FibGVfdW50aWwgPD0gY3VycmVudF90aW1lOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHsic3RhdHVzIjogImFjdGl2ZSIsICJpc19zeW5jIjogRmFsc2V9KQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSAoSUQ6IHthY2NvdW50WydpZCddfSkgxJHDoyBo4bq/dCB0aOG7nWkgZ2lhbiBjaOG7nSwgxJHDoyBjaHV54buDbiB24buBIHRy4bqhbmcgdGjDoWkgYWN0aXZlIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdfbWludXRlcyA9IGludCgoam9iX2Rpc2FibGVfdW50aWwgLSBjdXJyZW50X3RpbWUpIC8gNjApCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSBjw7JuIHtyZW1haW5pbmdfbWludXRlc30gcGjDunQg4bufIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUiKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGtp4buDbSB0cmEgdsOgIGtow7RpIHBo4bulYyB0w6BpIGtob+G6o24gaW5hY3RpdmUiKQogICAgICAgICAgICAKICAgIGRlZiByZXNldF9sb2dvdXRfYWNjb3VudHMoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6AgcmVzZXQgY8OhYyB0w6BpIGtob+G6o24gbG9nb3V0IHbhu4EgYWN0aXZlIGtoaSBj4bqnbiB0aGnhur90CiAgICAgICAgQ2jhu4kgbsOqbiBn4buNaSBtZXRob2QgbsOgeSBraGkgY8OzIHnDqnUgY+G6p3UgxJHhurdjIGJp4buHdCB04burIGFkbWluCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdOG6pXQgY+G6oyB0w6BpIGtob+G6o24g4bufIHRy4bqhbmcgdGjDoWkgbG9nb3V0CiAgICAgICAgICAgIGZvciBhcHBfbmFtZSBpbiBzZWxmLmVuYWJsZWRfYXBwczoKICAgICAgICAgICAgICAgIGxvZ291dF9hY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1hcHBfbmFtZSwgc3RhdHVzPSJsb2dvdXQiKSBvciBbXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBsb2dvdXRfYWNjb3VudHM6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJSZXNldCB0w6BpIGtob+G6o24gbG9nb3V0IHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IHbhu4EgdHLhuqFuZyB0aMOhaSBhY3RpdmUiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgewogICAgICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogImFjdGl2ZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIHJlc2V0IHTDoGkga2hv4bqjbiBsb2dvdXQiKQogICAgCiAgICBkZWYgaXNfYWNjb3VudF9jYW5fcnVuX2pvYihzZWxmLCBhcHBfbmFtZTpzdHIgKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgY2jhuqF5IGpvYiBraMO0bmcKICAgICAgICAiIiIKICAgICAgICBhY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1hcHBfbmFtZSkKICAgICAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50czoKICAgICAgICAgICAgaWYoc2VsZi5fY2FuX3J1bl9qb2IoYWNjb3VudCkpOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHJ1bihzZWxmKToKICAgICAgICAiIiIKICAgICAgICBDaOG6oXkgSm9iU2VydmljZSB0cm9uZyBt4buZdCB2w7JuZyBs4bq3cCB24bubaSBsb2dpYyBsw6BtIHZp4buHYyB0aGVvIHBoacOqbgogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBzZWxmLmlzX2luaXRpYWxpemVkOgogICAgICAgICAgICBpZiBub3Qgc2VsZi5pbml0aWFsaXplKCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBraOG7n2kgdOG6oW8gSm9iU2VydmljZS4gS2jDtG5nIHRo4buDIGNo4bqheS4iKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIkLhuq90IMSR4bqndSBjaOG6oXkgSm9iU2VydmljZSB24bubaSBsb2dpYyBsw6BtIHZp4buHYyB0aGVvIHBoacOqbi4uLiIpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGRldmljZV9pZAogICAgICAgIGRldmljZV9pZCA9IHNlbGYuZGIuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgICAgICAKICAgICAgICBpZiBub3QgZGV2aWNlX2lkOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCBkZXZpY2VfaWQgaGnhu4duIHThuqFpLCBKb2JTZXJ2aWNlIGtow7RuZyB0aOG7gyBjaOG6oXkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgd2hpbGUgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAjIFJlc2V0IGJp4bq/biBmb3JjZV9zdG9wIG7hur91IGPDswogICAgICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgICAgICBzZWxmLmZvcmNlX3N0b3AgPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHnDqnUgY+G6p3UgdOG6oW0gZOG7q25nIHThu6sgc2VydmVyCiAgICAgICAgICAgIGlmIHNlbGYuZGIuZ2V0KCJwYXVzZV9qb2IiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiQ8OzIHnDqnUgY+G6p3UgdOG6oW0gZOG7q25nIHThu6sgc2VydmVyLCB04bqhbSBk4burbmcgeOG7rSBsw70gam9iIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOaOG6oyBwcm94eSBuZ2F5IGtoaSBi4buLIHThuqFtIGThu6tuZyB04burIHNlcnZlcgogICAgICAgICAgICAgICAgdXNlX3Byb3h5ID0gc2VsZi5kYi5nZXQoInVzZV9wcm94eSIsIEZhbHNlKQogICAgICAgICAgICAgICAgaWYgdXNlX3Byb3h5IGFuZCBoYXNhdHRyKHNlbGYsICdwcm94eV9yZWdpc3RlcmVkJykgYW5kIHNlbGYucHJveHlfcmVnaXN0ZXJlZDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiTmjhuqMgcHJveHkgZG8gYuG7iyB04bqhbSBk4burbmcgdOG7qyBzZXJ2ZXIiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3VucmVnaXN0ZXJfcHJveHkoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX2lzX3dvcmtpbmciLCBGYWxzZSkKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsIEpvYlNlcnZpY2VDb25zdGFudHMuTVNHX0RFVklDRV9QQVVTRURfU0VSVkVSKQogICAgICAgICAgICAgICAgam9iX2NoZWNrX2ludGVydmFsID0gc2VsZi5kYi5nZXQoImpvYl9jaGVja19pbnRlcnZhbCIsIGNvbmZpZy5KT0JfQ0hFQ0tfSU5URVJWQUwpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKGpvYl9jaGVja19pbnRlcnZhbCk6CiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgcGjhuqNpIGRvIGZvcmNlX3Jlc3RhcnRfc2Vzc2lvbiBraMO0bmcKICAgICAgICAgICAgICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuZm9yY2VfcmVzdGFydF9zZXNzaW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBsw6AgcmVzdGFydCBzZXNzaW9uLCB0aeG6v3AgdOG7pWMgdsOybmcgbOG6t3AgdGhheSB2w6wgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgcGjhuqNpIHJlc3RhcnQgc2Vzc2lvbiB0aMOsIG3hu5tpIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IGLhu5kgxJHhur9tIGjDoG5nIG5nw6B5IG7hur91IGPhuqduCiAgICAgICAgICAgIHNlbGYuX3Jlc2V0X2RhaWx5X2NvdW50ZXJzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2w6Aga2jDtGkgcGjhu6VjIGPDoWMgdMOgaSBraG/huqNuIGluYWN0aXZlIMSRw6MgaOG6v3QgdGjhu51pIGdpYW4gY2jhu50KICAgICAgICAgICAgc2VsZi5yZXNldF9pbmFjdGl2ZV9hY2NvdW50cygpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgY+G6rXAgbmjhuq10IHThu6sgc2VydmVyIHF1YSBNUVRUCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmNoZWNrX2FuZF9oYW5kbGVfc2VydmVyX3VwZGF0ZXMoKToKICAgICAgICAgICAgICAgICMgQ+G6p24gcmVzdGFydCBzZXNzaW9uIGRvIGNvbmZpZyB0aGF5IMSR4buVaQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlJlc3RhcnQgc2Vzc2lvbiBkbyBjb25maWcgdGhheSDEkeG7lWkgdOG7qyBzZXJ2ZXIiKQogICAgICAgICAgICAgICAgIyBSZXNldCB0aOG7nWkgZ2lhbiBjb29sZG93biDEkeG7gyBi4bqvdCDEkeG6p3Ugc2Vzc2lvbiBuZ2F5IGzhuq1wIHThu6ljCiAgICAgICAgICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lID0gMAogICAgICAgICAgICAgICAgIyBOaOG6oyBwcm94eSBu4bq/dSDEkWFuZyBz4butIGThu6VuZwogICAgICAgICAgICAgICAgdXNlX3Byb3h5ID0gc2VsZi5kYi5nZXQoInVzZV9wcm94eSIsIEZhbHNlKQogICAgICAgICAgICAgICAgaWYgdXNlX3Byb3h5IGFuZCBoYXNhdHRyKHNlbGYsICdwcm94eV9yZWdpc3RlcmVkJykgYW5kIHNlbGYucHJveHlfcmVnaXN0ZXJlZDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiTmjhuqMgcHJveHkgZG8gcmVzdGFydCBzZXNzaW9uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLl91bnJlZ2lzdGVyX3Byb3h5KCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlICAjIELhuq90IMSR4bqndSBs4bqhaSB04burIMSR4bqndSB2w7JuZyBs4bq3cAogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcgdHJvbmcgdGjhu51pIGdpYW4gbmdo4buJIGdp4buvYSBjw6FjIHBoacOqbiBraMO0bmcKICAgICAgICAgICAgICAgIGlmIHNlbGYuX2lzX2luX3Nlc3Npb25fY29vbGRvd24oKToKICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdfbWludXRlcyA9IGludCgoc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lIC0gaW50KHRpbWUudGltZSgpKSkgLyA2MCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCBmIntKb2JTZXJ2aWNlQ29uc3RhbnRzLk1TR19TRVNTSU9OX0NPT0xET1dOfSAoY8OybiB7cmVtYWluaW5nX21pbnV0ZXN9IHBow7p0KSIpCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIG3hu5dpIDUgZ2nDonkgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbSBraGkgY8OzIHnDqnUgY+G6p3UKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDUpOgogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBwaOG6o2kgZG8gZm9yY2VfcmVzdGFydF9zZXNzaW9uIGtow7RuZwogICAgICAgICAgICAgICAgICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmZvcmNlX3Jlc3RhcnRfc2Vzc2lvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE7hur91IGzDoCByZXN0YXJ0IHNlc3Npb24sIHRp4bq/cCB04bulYyB2w7JuZyBs4bq3cCB0aGF5IHbDrCBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHBo4bqjaSByZXN0YXJ0IHNlc3Npb24gdGjDrCBt4bubaSBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2w6AgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB0csaw4bubYyB0acOqbgogICAgICAgICAgICAgICAgZW5hYmxlZF9hcHBzID0gc2VsZi5kYi5nZXQoImVuYWJsZWRfYXBwcyIsIGNvbmZpZy5FTkFCTEVEX0FQUFMpCiAgICAgICAgICAgICAgICBmb3IgYXBwX25hbWUgaW4gZW5hYmxlZF9hcHBzOgogICAgICAgICAgICAgICAgICAgIGlmIGFwcF9uYW1lIGluIHNlbGYuam9iX2hhbmRsZXJzIGFuZCBzZWxmLl9jaGVja19hY2NvdW50X3N5bmNfc3RhdHVzKGFwcF9uYW1lKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkOG7k25nIGLhu5kgdMOgaSBraG/huqNuIGNobyB7YXBwX25hbWV9Li4uIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fc3luY19hY2NvdW50c19mb3JfYXBwKGFwcF9uYW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzhuqV5IHThuqV0IGPhuqMgdMOgaSBraG/huqNuIGPDsyB0aOG7gyBsw6BtIHZp4buHYyAoc2F1IGtoaSDEkcOjIMSR4buTbmcgYuG7mSkKICAgICAgICAgICAgICAgIGFsbF93b3JrYWJsZV9hY2NvdW50cyA9IHNlbGYuX2dldF9hbGxfd29ya2FibGVfYWNjb3VudHMoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgYWxsX3dvcmthYmxlX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJLaMO0bmcgY8OzIHTDoGkga2hv4bqjbiBuw6BvIHPhurVuIHPDoG5nIGzDoG0gdmnhu4djIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE5o4bqjIHByb3h5IG5nYXkgbuG6v3UgxJFhbmcgc+G7rSBk4bulbmcKICAgICAgICAgICAgICAgICAgICB1c2VfcHJveHkgPSBzZWxmLmRiLmdldCgidXNlX3Byb3h5IiwgRmFsc2UpCiAgICAgICAgICAgICAgICAgICAgaWYgdXNlX3Byb3h5IGFuZCBoYXNhdHRyKHNlbGYsICdwcm94eV9yZWdpc3RlcmVkJykgYW5kIHNlbGYucHJveHlfcmVnaXN0ZXJlZDoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk5o4bqjIHByb3h5IGRvIGtow7RuZyBjw7MgdMOgaSBraG/huqNuIHPhurVuIHPDoG5nIGzDoG0gdmnhu4djIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdW5yZWdpc3Rlcl9wcm94eSgpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9pc193b3JraW5nIiwgRmFsc2UpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9tZXNzYWdlIiwgSm9iU2VydmljZUNvbnN0YW50cy5NU0dfREVWSUNFX05PX0FDQ09VTlRTKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQuG6r3QgxJHhuqd1IHNlc3Npb24gY29vbGRvd24gdGhheSB2w6wgc2xlZXAgbmfhuq9uCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIktow7RuZyBjw7MgdMOgaSBraG/huqNuIMSR4buDIGzDoG0gdmnhu4djLCBi4bqvdCDEkeG6p3Ugbmdo4buJIG5nxqFpIG5oxrAgc2F1IHBoacOqbiBsw6BtIHZp4buHYyIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc3RhcnRfc2Vzc2lvbl9jb29sZG93bigpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDaOG7iSBs4bqleSBwcm94eSBraGkgxJHDoyBjaOG6r2MgY2jhuq9uIGPDsyB0w6BpIGtob+G6o24gc+G6tW4gc8OgbmcgbMOgbSB2aeG7h2MKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9jaGVja19wcm94eV9yZXF1aXJlbWVudCgpOgogICAgICAgICAgICAgICAgICAgICMgQ+G6p24gcHJveHkgbmjGsG5nIGNoxrBhIGPDsywgY2jhu50gMTAgZ2nDonkgcuG7k2kga2nhu4NtIHRyYSBs4bqhaQogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsIEpvYlNlcnZpY2VDb25zdGFudHMuTVNHX1dBSVRJTkdfUFJPWFkpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgxMCk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIHBo4bqjaSBkbyBmb3JjZV9yZXN0YXJ0X3Nlc3Npb24ga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuZm9yY2VfcmVzdGFydF9zZXNzaW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTuG6v3UgbMOgIHJlc3RhcnQgc2Vzc2lvbiwgdGnhur9wIHThu6VjIHbDsm5nIGzhurdwIHRoYXkgdsOsIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgcGjhuqNpIHJlc3RhcnQgc2Vzc2lvbiB0aMOsIG3hu5tpIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBC4bqvdCDEkeG6p3UgcGhpw6puIGzDoG0gdmnhu4djIHbhu5tpIGRhbmggc8OhY2ggdMOgaSBraG/huqNuIMSRw6Mgc+G6tW4gc8OgbmcKICAgICAgICAgICAgICAgIHNlbGYuX3dvcmtfc2Vzc2lvbihhbGxfd29ya2FibGVfYWNjb3VudHMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgR2nhuqNpIHBow7NuZyBwcm94eSB2w6AgYuG6r3QgxJHhuqd1IHRo4budaSBnaWFuIG5naOG7iQogICAgICAgICAgICAgICAgdXNlX3Byb3h5ID0gc2VsZi5kYi5nZXQoInVzZV9wcm94eSIsIEZhbHNlKQogICAgICAgICAgICAgICAgaWYgdXNlX3Byb3h5OgogICAgICAgICAgICAgICAgICAgIHNlbGYuX3JlbGVhc2VfcHJveHlfYWZ0ZXJfc2Vzc2lvbigpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLl9zdGFydF9zZXNzaW9uX2Nvb2xkb3duKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSB0cm9uZyB2w7JuZyBs4bq3cCBjaMOtbmgiKQogICAgICAgICAgICAgICAgIyBOZ2jhu4kgbeG7mXQgY2jDunQgdHLGsOG7m2Mga2hpIHRo4butIGzhuqFpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDMwKToKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBwaOG6o2kgZG8gZm9yY2VfcmVzdGFydF9zZXNzaW9uIGtow7RuZwogICAgICAgICAgICAgICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5mb3JjZV9yZXN0YXJ0X3Nlc3Npb246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE7hur91IGzDoCByZXN0YXJ0IHNlc3Npb24sIHRp4bq/cCB04bulYyB2w7JuZyBs4bq3cCB0aGF5IHbDrCBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyBwaOG6o2kgcmVzdGFydCBzZXNzaW9uIHRow6wgbeG7m2kgYnJlYWsKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbygiSm9iU2VydmljZSDEkcOjIGThu6tuZyIpCiAgICAgICAgICAgIAogICAgZGVmIHN0b3Aoc2VsZik6CiAgICAgICAgIiIiROG7q25nIEpvYlNlcnZpY2UiIiIKICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQYW5nIGThu6tuZyBKb2JTZXJ2aWNlLi4uIikKICAgICAgICAKICAgIGRlZiBmb3JjZV9zdG9wX2FsbChzZWxmKToKICAgICAgICAiIiJE4burbmcgbmdheSBs4bqtcCB04bupYyB04bqldCBj4bqjIGPDoWMgaG/huqF0IMSR4buZbmciIiIKICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgIHNlbGYuZm9yY2Vfc3RvcCA9IFRydWUKICAgICAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBsb2dnZXIuaW5mbygiROG7q25nIG5nYXkgbOG6rXAgdOG7qWMgdOG6pXQgY+G6oyBjw6FjIGhv4bqhdCDEkeG7mW5nLi4uIikKCiAgICBkZWYgaGFuZGxlX21xdHRfYWNjb3VudF91cGRhdGUoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gY+G6rXAgbmjhuq10IGFjY291bnQgdOG7qyBNUVRUIHNlcnZlcgogICAgICAgIEFjY291bnQgc+G6vSDEkcaw4bujYyByZWxvYWQgc2F1IG3hu5dpIGpvYiB0cm9uZyBfd29ya19hY2NvdW50X3Nlc3Npb24KICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygiTmjhuq1uIMSRxrDhu6NjIHRow7RuZyBiw6FvIGPhuq1wIG5o4bqtdCBhY2NvdW50IHThu6sgc2VydmVyIHF1YSBNUVRUIikKICAgIAogICAgZGVmIGhhbmRsZV9tcXR0X2ZvcmNlX3N0YXJ0X3Nlc3Npb24oc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gecOqdSBj4bqndSBi4bqvdCDEkeG6p3Ugc2Vzc2lvbiBuZ2F5IGzhuq1wIHThu6ljIHThu6sgTVFUVCBzZXJ2ZXIKICAgICAgICBC4buPIHF1YSB0aOG7nWkgZ2lhbiBuZ2jhu4kgaGnhu4duIHThuqFpCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGLhuq90IMSR4bqndSBzZXNzaW9uIG5nYXkgbOG6rXAgdOG7qWMgdOG7qyBzZXJ2ZXIgcXVhIE1RVFQiKQogICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgaWYgc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lID4gMDoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJC4buPIHF1YSB0aOG7nWkgZ2lhbiBuZ2jhu4kgdsOgIGLhuq90IMSR4bqndSBzZXNzaW9uIG5nYXkiKQogICAgICAgICAgICAgICAgc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lID0gMAogICAgICAgICAgICAKICAgIGRlZiBoYW5kbGVfbXF0dF9jb25maWdfdXBkYXRlKHNlbGYsIGNvbmZpZ19jaGFuZ2VzOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IGPhuq1wIG5o4bqtdCBjb25maWcgdOG7qyBNUVRUIHNlcnZlcgogICAgICAgIEtp4buDbSB0cmEgeGVtIGPDsyBj4bqnbiByZXN0YXJ0IHNlc3Npb24ga2jDtG5nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY29uZmlnX2NoYW5nZXM6IERpY3Rpb25hcnkgY2jhu6lhIGPDoWMgdGhheSDEkeG7lWkgY29uZmlnCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB0aMO0bmcgYsOhbyBj4bqtcCBuaOG6rXQgY29uZmlnIHThu6sgc2VydmVyIHF1YSBNUVRUIikKICAgICAgICAKICAgICAgICAjIEltcG9ydCBjb25maWcgxJHhu4MgbOG6pXkgZGFuaCBzw6FjaCByZXN0YXJ0IHJlcXVpcmVkIGNvbmZpZ3MKICAgICAgICBpbXBvcnQgY29uZmlnIGFzIGFwcF9jb25maWcKICAgICAgICByZXN0YXJ0X3JlcXVpcmVkX2NvbmZpZ3MgPSBnZXRhdHRyKGFwcF9jb25maWcsICdSRVNUQVJUX1JFUVVJUkVEX0NPTkZJR1MnLCBbCiAgICAgICAgICAgICJlbmFibGVkX2FwcHMiLCAibWF4X2pvYnNfcGVyX2RheSIsICJtYXhfam9ic19wZXJfc2Vzc2lvbiIsIAogICAgICAgICAgICAiam9iX2Nvb2xkb3duX21pbnV0ZXMiLCAidXNlX3Byb3h5IiwgInByb3h5X3NlcnZlciIsICJqb2JfaG91ciIKICAgICAgICBdKQogICAgICAgIAogICAgICAgIG5lZWRfcmVzdGFydCA9IEZhbHNlCiAgICAgICAgCiAgICAgICAgaWYgY29uZmlnX2NoYW5nZXM6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB04burbmcgY29uZmlnIGPDsyBj4bqnbiByZXN0YXJ0IGtow7RuZwogICAgICAgICAgICBmb3IgY29uZmlnX2tleSBpbiBjb25maWdfY2hhbmdlcy5rZXlzKCk6CiAgICAgICAgICAgICAgICBpZiBjb25maWdfa2V5IGluIHJlc3RhcnRfcmVxdWlyZWRfY29uZmlnczoKICAgICAgICAgICAgICAgICAgICBuZWVkX3Jlc3RhcnQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJDb25maWcge2NvbmZpZ19rZXl9IHRoYXkgxJHhu5VpLCBj4bqnbiByZXN0YXJ0IHNlc3Npb24iKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgY8OzIHRow7RuZyB0aW4gY2hpIHRp4bq/dCwgY29pIG5oxrAgY+G6p24gcmVzdGFydAogICAgICAgICAgICBuZWVkX3Jlc3RhcnQgPSBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGlmIG5lZWRfcmVzdGFydDoKICAgICAgICAgICAgd2l0aCBzZWxmLl9sb2NrOgogICAgICAgICAgICAgICAgc2VsZi5mb3JjZV9yZXN0YXJ0X3Nlc3Npb24gPSBUcnVlCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDhurd0IGZsYWcgcmVzdGFydCBzZXNzaW9uIGRvIGNvbmZpZyB0aGF5IMSR4buVaSIpCiAgICAgICAgICAgICAgICAKICAgIGRlZiBjaGVja19hbmRfaGFuZGxlX3NlcnZlcl91cGRhdGVzKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgdsOgIHjhu60gbMO9IGPDoWMgY+G6rXAgbmjhuq10IHThu6sgc2VydmVyCiAgICAgICAgxJDGsOG7o2MgZ+G7jWkgdHJvbmcgdsOybmcgbOG6t3AgY2jDrW5oIHbDoCB0cm9uZyBfd29ya19zZXNzaW9uCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBj4bqnbiB0aeG6v3AgdOG7pWMsIEZhbHNlIG7hur91IGPhuqduIHJlc3RhcnQgc2Vzc2lvbgogICAgICAgICIiIgogICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGZsYWcgcmVzdGFydCBzZXNzaW9uCiAgICAgICAgICAgIGlmIHNlbGYuZm9yY2VfcmVzdGFydF9zZXNzaW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiB5w6p1IGPhuqd1IHJlc3RhcnQgc2Vzc2lvbiBkbyBjb25maWcgdGhheSDEkeG7lWkiKQogICAgICAgICAgICAgICAgc2VsZi5mb3JjZV9yZXN0YXJ0X3Nlc3Npb24gPSBGYWxzZSAgIyBSZXNldCBmbGFnCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UgICMgQsOhbyBoaeG7h3UgY+G6p24gcmVzdGFydCBzZXNzaW9uCiAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gVHJ1ZSAgIyBUaeG6v3AgdOG7pWMgYsOsbmggdGjGsOG7nW5nCgogICAgZGVmIHNodXRkb3duKHNlbGYpOgogICAgICAgICIiIsSQw7NuZyBk4buLY2ggduG7pSwgZOG7q25nIHThuqV0IGPhuqMgd29ya2VyIHRocmVhZHMiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJE4burbmcgbmdheSBs4bqtcCB04bupYyB04bqldCBj4bqjIGPDoWMgaG/huqF0IMSR4buZbmcuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgZOG7q25nCiAgICAgICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYuZm9yY2Vfc3RvcCA9IFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR2nhuqNpIHBow7NuZyBwcm94eSBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICAgICAgc2VsZi5fcmVsZWFzZV9wcm94eV9hZnRlcl9zZXNzaW9uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDDs25nIGvhur90IG7hu5FpIGRhdGFiYXNlIMSR4buDIHRyw6FuaCBs4buXaSB0aHJlYWQKICAgICAgICAgICAgaWYgaGFzYXR0cihzZWxmLCAnZGInKSBhbmQgc2VsZi5kYjoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLmNsb3NlKCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgxJHDs25nIGvhur90IG7hu5FpIGRhdGFiYXNlOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIHNodXRkb3duIEpvYlNlcnZpY2UiKQogICAgCiAgICBkZWYgX3Byb3h5X2FwaV9jYWxsKHNlbGYsIGVuZHBvaW50OiBzdHIsIGRhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgR+G7jWkgQVBJIHByb3h5IHNlcnZlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGVuZHBvaW50OiBFbmRwb2ludCBBUEkgKHJlZ2lzdGVyLCB1cGRhdGUsIHVucmVnaXN0ZXIsIHJlc2V0LWlwKQogICAgICAgICAgICBkYXRhOiBE4buvIGxp4buHdSBn4butaQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0IHJlc3BvbnNlIGhv4bq3YyBOb25lIG7hur91IGzhu5dpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbXBvcnQgcmVxdWVzdHMKICAgICAgICAgICAgCiAgICAgICAgICAgIHByb3h5X3NlcnZlciA9IHNlbGYuZGIuZ2V0KCJwcm94eV9zZXJ2ZXIiLCAiaHR0cDovLzEwLjAuMC41OjkwMzIiKQogICAgICAgICAgICB1cmwgPSBmIntwcm94eV9zZXJ2ZXJ9L3tlbmRwb2ludH0iCiAgICAgICAgICAgIAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBqc29uPWRhdGEsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJQcm94eSBBUEkge2VuZHBvaW50fSBmYWlsZWQgd2l0aCBzdGF0dXMge3Jlc3BvbnNlLnN0YXR1c19jb2RlfToge3Jlc3BvbnNlLnRleHR9IikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4buNaSBQcm94eSBBUEkge2VuZHBvaW50fToge2V9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIF9yZWdpc3Rlcl9wcm94eShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQxINuZyBrw70gduG7m2kgcHJveHkgc2VydmVyIMSR4buDIMSRxrDhu6NjIGPhuqVwIHBow6F0IHRhYmxlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkcaw4bujYyBj4bqlcCB0YWJsZSBob+G6t2MgxJHDoyBjw7MgdGFibGUsIEZhbHNlIG7hur91IHbDoG8gcXVldWUgaG/hurdjIGzhu5dpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgaGVscGVyIHNlcnZpY2UKICAgICAgICAgICAgbG9jYWxfaXAgPSBzZWxmLmhlbHBlci5nZXRfbG9jYWxfaXAoKQogICAgICAgICAgICBpZiBub3QgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBs4bqleSBsb2NhbCBJUCwgYuG7jyBxdWEgxJHEg25nIGvDvSBwcm94eSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGRhdGEgPSB7ImxvY2FsX2lwIjogbG9jYWxfaXB9CiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5fcHJveHlfYXBpX2NhbGwoInJlZ2lzdGVyIiwgZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCByZXNwb25zZToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHN0YXR1cyA9IHJlc3BvbnNlLmdldCgic3RhdHVzIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN0YXR1cyA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICAjIMSQxrDhu6NjIGPhuqVwIHRhYmxlIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgdGFibGVfbmFtZSA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoInRhYmxlX25hbWUiKQogICAgICAgICAgICAgICAgYWN0aW9uID0gcmVzcG9uc2UuZ2V0KCJkYXRhIiwge30pLmdldCgiYWN0aW9uIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlID0gdGFibGVfbmFtZQogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X25hbWUgPSBmInt0YWJsZV9uYW1lfSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMxrB1IHByb3h5IHRhYmxlIG5hbWUgdsOgbyBkZXZpY2UgY29uZmlnIMSR4buDIGfhu61pIGzDqm4gc2VydmVyCiAgICAgICAgICAgICAgICBzZWxmLmRiLnNldF9kZXZpY2VfY29uZmlnKCJwcm94eV90YWJsZV9uYW1lIiwgdGFibGVfbmFtZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQcm94eSDEkcOjIMSRxrDhu6NjIGPhuqVwIHRhYmxlOiB7dGFibGVfbmFtZX0gKGFjdGlvbjoge2FjdGlvbn0pIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBH4buNaSByZXNldC1pcCDEkeG7gyDEkeG7lWkgSVAgbeG7m2kKICAgICAgICAgICAgICAgIGlmIHRhYmxlX25hbWU6CiAgICAgICAgICAgICAgICAgICAgcHBvZV9uYW1lID0gdGFibGVfbmFtZS5yZXBsYWNlKCJ0b18iLCAiIikgICMgQ2h1eeG7g24gInRvX3BwcG9lMiIgdGjDoG5oICJwcHBvZTIiCiAgICAgICAgICAgICAgICAgICAgcmVzZXRfZGF0YSA9IHsicHBvZV9uYW1lIjogZiJ7cHBvZV9uYW1lfSJ9IAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXNldF9yZXNwb25zZSA9IHNlbGYuX3Byb3h5X2FwaV9jYWxsKCJyZXNldC1pcCIsIHJlc2V0X2RhdGEpCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzZXRfcmVzcG9uc2UgYW5kIHJlc2V0X3Jlc3BvbnNlLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgcmVzZXQgSVAgY2hvIHtyZXNldF9kYXRhWydwcG9lX25hbWUnXX0iKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHRo4buDIHJlc2V0IElQIGNobyB7cmVzZXRfZGF0YVsncHBvZV9uYW1lJ119IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmIHN0YXR1cyA9PSAicXVldWVkIjoKICAgICAgICAgICAgICAgICMgVsOgbyBxdWV1ZSBjaOG7nQogICAgICAgICAgICAgICAgcXVldWVfcG9zaXRpb24gPSByZXNwb25zZS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJxdWV1ZV9wb3NpdGlvbiIsIDApCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlByb3h5IHNlcnZlciBmdWxsLCB2w6BvIGjDoG5nIMSR4bujaSB24buLIHRyw60ge3F1ZXVlX3Bvc2l0aW9ufSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiUHJveHkgcmVnaXN0ZXIgdGjhuqV0IGLhuqFpOiB7cmVzcG9uc2UuZ2V0KCdtZXNzYWdlJywgJ1Vua25vd24gZXJyb3InKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSDEkcSDbmcga8O9IHByb3h5IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfdXBkYXRlX3Byb3h5KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ+G6rXAgbmjhuq10IHRpbWVzdGFtcCBz4butIGThu6VuZyBwcm94eQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdXBkYXRlIHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBsb2NhbCBJUCB04burIGhlbHBlciBzZXJ2aWNlCiAgICAgICAgICAgIGxvY2FsX2lwID0gc2VsZi5oZWxwZXIuZ2V0X2xvY2FsX2lwKCkKICAgICAgICAgICAgaWYgbm90IGxvY2FsX2lwOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBs4bqleSBsb2NhbCBJUCwgYuG7jyBxdWEgdXBkYXRlIHByb3h5IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgZGF0YSA9IHsibG9jYWxfaXAiOiBsb2NhbF9pcH0KICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9wcm94eV9hcGlfY2FsbCgidXBkYXRlIiwgZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgIHNlbGYucHJveHlfbGFzdF91cGRhdGUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICAgICAgIyBMb2cgdGjDtG5nIHRpbiB04burIHJlc3BvbnNlIG7hur91IGPDswogICAgICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAgICAgdGFibGVfbmFtZSA9IGRhdGEuZ2V0KCJ0YWJsZV9uYW1lIiwgInVua25vd24iKQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiUHJveHkgdXBkYXRlIHRow6BuaCBjw7RuZyBjaG8gdGFibGU6IHt0YWJsZV9uYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJQcm94eSB1cGRhdGUgdGjhuqV0IGLhuqFpOiB7cmVzcG9uc2UuZ2V0KCdtZXNzYWdlJykgaWYgcmVzcG9uc2UgZWxzZSAnTm8gcmVzcG9uc2UnfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgdXBkYXRlIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF91bnJlZ2lzdGVyX3Byb3h5KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgSOG7p3kgxJHEg25nIGvDvSB2w6AgZ2nhuqNpIHBow7NuZyB0YWJsZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdW5yZWdpc3RlciB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBoZWxwZXIgc2VydmljZQogICAgICAgICAgICBsb2NhbF9pcCA9IHNlbGYuaGVscGVyLmdldF9sb2NhbF9pcCgpCiAgICAgICAgICAgIGlmIG5vdCBsb2NhbF9pcDoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgbOG6pXkgbG9jYWwgSVAsIGLhu48gcXVhIHVucmVnaXN0ZXIgcHJveHkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBkYXRhID0geyJsb2NhbF9pcCI6IGxvY2FsX2lwfQogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuX3Byb3h5X2FwaV9jYWxsKCJ1bnJlZ2lzdGVyIiwgZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgIHJlbGVhc2VkX3RhYmxlID0gcmVzcG9uc2UuZ2V0KCJkYXRhIiwge30pLmdldCgicmVsZWFzZWRfdGFibGUiKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIHVucmVnaXN0ZXIgcHJveHkgdsOgIGdp4bqjaSBwaMOzbmcgdGFibGU6IHtyZWxlYXNlZF90YWJsZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFJlc2V0IHRy4bqhbmcgdGjDoWkgcHJveHkKICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm94eV90YWJsZSA9IE5vbmUKICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm94eV9uYW1lID0gTm9uZQogICAgICAgICAgICAgICAgc2VsZi5wcm94eV9sYXN0X3VwZGF0ZSA9IDAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw7NhIHByb3h5IHRhYmxlIG5hbWUga2jhu49pIGRldmljZSBjb25maWcKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0X2RldmljZV9jb25maWcoInByb3h5X3RhYmxlX25hbWUiLCBOb25lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJQcm94eSB1bnJlZ2lzdGVyIHRo4bqldCBi4bqhaToge3Jlc3BvbnNlLmdldCgnbWVzc2FnZScpIGlmIHJlc3BvbnNlIGVsc2UgJ05vIHJlc3BvbnNlJ30iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHVucmVnaXN0ZXIgcHJveHk6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2NoZWNrX3Byb3h5X3JlcXVpcmVtZW50KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6AgxJHEg25nIGvDvSBwcm94eSBu4bq/dSBj4bqnbgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHByb3h5IGhv4bq3YyBraMO0bmcgY+G6p24gcHJveHksIEZhbHNlIG7hur91IGPhuqduIHByb3h5IG5oxrBuZyBjaMawYSDEkcaw4bujYyBj4bqlcAogICAgICAgICIiIgogICAgICAgIHVzZV9wcm94eSA9IHNlbGYuZGIuZ2V0KCJ1c2VfcHJveHkiLCBGYWxzZSkKICAgICAgICAKICAgICAgICBpZiBub3QgdXNlX3Byb3h5OgogICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBLaMO0bmcgY+G6p24gcHJveHkKICAgICAgICAgICAgCiAgICAgICAgIyBO4bq/dSDEkcOjIGPDsyB0YWJsZSB0aMOsIHJldHVybiBUcnVlCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAjIENoxrBhIGPDsyB0YWJsZSwgdGjhu60gxJHEg25nIGvDvQogICAgICAgIHJldHVybiBzZWxmLl9yZWdpc3Rlcl9wcm94eSgpCiAgICAgICAgICAgIAogICAgZGVmIF9nZXRfcHJveHlfZGlzcGxheV9uYW1lKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0w6puIGhp4buDbiB0aOG7iyBjaG8gcHJveHkgaGnhu4duIHThuqFpCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBUw6puIGhp4buDbiB0aOG7iyBj4bunYSBwcm94eQogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuY3VycmVudF9wcm94eV9uYW1lOgogICAgICAgICAgICByZXR1cm4gc2VsZi5jdXJyZW50X3Byb3h5X25hbWUKICAgICAgICBlbGlmIHNlbGYuY3VycmVudF9wcm94eV90YWJsZToKICAgICAgICAgICAgcmV0dXJuIGYie3NlbGYuY3VycmVudF9wcm94eV90YWJsZX0iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJVbmtub3duIgogICAgICAgICAgICAKICAgIGRlZiBfc2V0dXBfcHJveHlfZm9yX3Nlc3Npb24oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaGnhur90IGzhuq1wIHByb3h5IGNobyBwaGnDqm4gbMOgbSB2aeG7h2MKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRoaeG6v3QgbOG6rXAgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICAjIE7hur91IMSRw6MgY8OzIHRhYmxlIHByb3h5IHRow6wgc2V0dXAgeG9uZyBy4buTaQogICAgICAgIGlmIHNlbGYuY3VycmVudF9wcm94eV90YWJsZToKICAgICAgICAgICAgcHJveHlfbmFtZSA9IHNlbGYuX2dldF9wcm94eV9kaXNwbGF5X25hbWUoKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlByb3h5IHtwcm94eV9uYW1lfSDEkcOjIHPhurVuIHPDoG5nIGNobyBwaGnDqm4gbMOgbSB2aeG7h2MiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAjIE7hur91IGNoxrBhIGPDsyB0aMOsIMSRxINuZyBrw70KICAgICAgICByZXR1cm4gc2VsZi5fcmVnaXN0ZXJfcHJveHkoKQogICAgZGVmIF9yZWxlYXNlX3Byb3h5X2FmdGVyX3Nlc3Npb24oc2VsZik6CiAgICAgICAgIiIiR2nhuqNpIHBow7NuZyBwcm94eSBzYXUga2hpIGvhur90IHRow7pjIHBoacOqbiBsw6BtIHZp4buHYyIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICAgICAgcHJveHlfbmFtZSA9IHNlbGYuX2dldF9wcm94eV9kaXNwbGF5X25hbWUoKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyBnaeG6o2kgcGjDs25nIHByb3h5IHtwcm94eV9uYW1lfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgR+G7jWkgQVBJIHVucmVnaXN0ZXIKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3VucmVnaXN0ZXJfcHJveHkoKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgZ2nhuqNpIHBow7NuZyBwcm94eSB7cHJveHlfbmFtZX0gdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJHaeG6o2kgcGjDs25nIHByb3h5IHtwcm94eV9uYW1lfSB0aOG6pXQgYuG6oWkiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSBnaeG6o2kgcGjDs25nIHByb3h5IikKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSBnaeG6o2kgcGjDs25nIHByb3h5IHtzZWxmLmN1cnJlbnRfcHJveHlfbmFtZSBvciBzZWxmLmN1cnJlbnRfcHJveHlfaWQgb3IgJ3Vua25vd24nfSIpCiAgICAgICAgICAgIAogICAgIyBERVBSRUNBVEVEOiBLaMO0bmcgZMO5bmcgbuG7r2EsIHRoYXkgYuG6sW5nIF9nZXRfYWxsX3dvcmthYmxlX2FjY291bnRzKCkKICAgICMgZGVmIF9oYXNfYWNjb3VudHNfcmVhZHlfZm9yX3dvcmsoc2VsZikgLT4gYm9vbDoKICAgICMgICAgICIiIgogICAgIyAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIHTDoGkga2hv4bqjbiBuw6BvIHPhurVuIHPDoG5nIGzDoG0gdmnhu4djIGtow7RuZwogICAgIyAgICAgCiAgICAjICAgICBSZXR1cm5zOgogICAgIyAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgbMOgbSB2aeG7h2MKICAgICMgICAgICIiIgogICAgIyAgICAgZW5hYmxlZF9hcHBzID0gc2VsZi5kYi5nZXQoImVuYWJsZWRfYXBwcyIsIGNvbmZpZy5FTkFCTEVEX0FQUFMpCiAgICAjICAgICAKICAgICMgICAgIGZvciBhcHBfbmFtZSBpbiBlbmFibGVkX2FwcHM6CiAgICAjICAgICAgICAgaWYgc2VsZi5pc19hY2NvdW50X2Nhbl9ydW5fam9iKGFwcF9uYW1lKToKICAgICMgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICMgICAgICAgICAgICAgCiAgICAjICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgIGRlZiBfZ2V0X2FsbF93b3JrYWJsZV9hY2NvdW50cyhzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB04bqldCBj4bqjIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgbMOgbSB2aeG7h2MgdOG7qyB04bqldCBj4bqjIGFwcCB2w6Agc+G6r3AgeOG6v3AgdGhlbyBhcHAsIG5nw6B5IHThuqFvCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggdMOgaSBraG/huqNuIMSRw6MgxJHGsOG7o2Mgc+G6r3AgeOG6v3AKICAgICAgICAiIiIKICAgICAgICBlbmFibGVkX2FwcHMgPSBzZWxmLmRiLmdldCgiZW5hYmxlZF9hcHBzIiwgY29uZmlnLkVOQUJMRURfQVBQUykKICAgICAgICBhbGxfd29ya2FibGVfYWNjb3VudHMgPSBbXQogICAgICAgIAogICAgICAgIGZvciBhcHBfbmFtZSBpbiBlbmFibGVkX2FwcHM6CiAgICAgICAgICAgIGFjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPWFwcF9uYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6v20gc+G7kSBsxrDhu6NuZyB0w6BpIGtob+G6o24gdGhlbyB0cuG6oW5nIHRow6FpCiAgICAgICAgICAgIHN0YXR1c19jb3VudHMgPSB7fQogICAgICAgICAgICBmb3IgYWNjIGluIGFjY291bnRzOgogICAgICAgICAgICAgICAgc3RhdHVzID0gYWNjLmdldCgnc3RhdHVzJywgJ2FjdGl2ZScpCiAgICAgICAgICAgICAgICBzdGF0dXNfY291bnRzW3N0YXR1c10gPSBzdGF0dXNfY291bnRzLmdldChzdGF0dXMsIDApICsgMQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMb2cgdGjhu5FuZyBrw6ogdHLhuqFuZyB0aMOhaQogICAgICAgICAgICBzdGF0dXNfaW5mbyA9ICIsICIuam9pbihbZiJ7c3RhdHVzfToge2NvdW50fSIgZm9yIHN0YXR1cywgY291bnQgaW4gc3RhdHVzX2NvdW50cy5pdGVtcygpXSkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge2FwcF9uYW1lfSAtIHtzdGF0dXNfaW5mb30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4buNYyBjw6FjIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgbMOgbSB2aeG7h2MKICAgICAgICAgICAgd29ya2FibGVfYWNjb3VudHMgPSBbYWNjIGZvciBhY2MgaW4gYWNjb3VudHMgaWYgc2VsZi5fY2FuX3J1bl9qb2IoYWNjKV0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHdvcmthYmxlX2FjY291bnRzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB7bGVuKHdvcmthYmxlX2FjY291bnRzKX0gdMOgaSBraG/huqNuIGPDsyB0aOG7gyBsw6BtIHZp4buHYyBjaG8ge2FwcF9uYW1lfSIpCiAgICAgICAgICAgICAgICBhbGxfd29ya2FibGVfYWNjb3VudHMuZXh0ZW5kKHdvcmthYmxlX2FjY291bnRzKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaMO0bmcgY8OzIHTDoGkga2hv4bqjbiBuw6BvIGPDsyB0aOG7gyBsw6BtIHZp4buHYyBjaG8ge2FwcF9uYW1lfSIpCiAgICAgICAgCiAgICAgICAgIyBT4bqvcCB44bq/cCB0aGVvOgogICAgICAgICMgMS4gQXBwIG5hbWUgKMSR4buDIG5ow7NtIGPDuW5nIGFwcCBs4bqhaSB24bubaSBuaGF1KQogICAgICAgICMgMi4gTmfDoHkgdOG6oW8gdMOgaSBraG/huqNuIChjcmVhdGVkX2F0KSAtIGPFqSBuaOG6pXQgdHLGsOG7m2MKICAgICAgICAjIDMuIFPhu5Egam9iIMSRw6MgbMOgbSB0cm9uZyBwaGnDqm4gKMOtdCBuaOG6pXQgdHLGsOG7m2MpCiAgICAgICAgYWxsX3dvcmthYmxlX2FjY291bnRzLnNvcnQoa2V5PWxhbWJkYSB4OiAoCiAgICAgICAgICAgIHguZ2V0KCJhcHAiLCAiIiksCiAgICAgICAgICAgIHguZ2V0KCJjcmVhdGVkX2F0IiwgMCksCiAgICAgICAgICAgIHguZ2V0KCJqb2JzX2RvbmVfaW5fc2Vzc2lvbiIsIDApCiAgICAgICAgKSkKICAgICAgICAKICAgICAgICByZXR1cm4gYWxsX3dvcmthYmxlX2FjY291bnRzCiAgICAgICAgCiAgICBkZWYgX3dvcmtfc2Vzc2lvbihzZWxmLCBhbGxfd29ya2FibGVfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dID0gTm9uZSk6CiAgICAgICAgIiIiVGjhu7FjIGhp4buHbiBt4buZdCBwaGnDqm4gbMOgbSB2aeG7h2MgaG/DoG4gY2jhu4luaCB24bubaSBjxqEgY2jhur8gbeG7m2kiIiIKICAgICAgICBsb2dnZXIuaW5mbygiQuG6r3QgxJHhuqd1IHBoacOqbiBsw6BtIHZp4buHYyIpCiAgICAgICAgCiAgICAgICAgIyDEkMOhbmggZOG6pXUgxJFhbmcgdHJvbmcgcGhpw6puIGzDoG0gdmnhu4djCiAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9pc193b3JraW5nIiwgVHJ1ZSkKICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCBKb2JTZXJ2aWNlQ29uc3RhbnRzLk1TR19XT1JLSU5HX1NFU1NJT04pCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0cnV54buBbiBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiwgbOG6pXkgbOG6oWkgdOG7qyBkYXRhYmFzZQogICAgICAgICAgICBpZiBhbGxfd29ya2FibGVfYWNjb3VudHMgaXMgTm9uZToKICAgICAgICAgICAgICAgIGFsbF93b3JrYWJsZV9hY2NvdW50cyA9IHNlbGYuX2dldF9hbGxfd29ya2FibGVfYWNjb3VudHMoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGFsbF93b3JrYWJsZV9hY2NvdW50czoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJLaMO0bmcgY8OzIHTDoGkga2hv4bqjbiBuw6BvIHPhurVuIHPDoG5nIGzDoG0gdmnhu4djIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkge2xlbihhbGxfd29ya2FibGVfYWNjb3VudHMpfSB0w6BpIGtob+G6o24gc+G6tW4gc8OgbmcgbMOgbSB2aeG7h2MiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMw6BtIHZp4buHYyB0deG6p24gdOG7sSB24bubaSB04burbmcgdMOgaSBraG/huqNuCiAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGFsbF93b3JrYWJsZV9hY2NvdW50czoKICAgICAgICAgICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmZvcmNlX3N0b3Agb3Igbm90IHNlbGYucnVubmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHnDqnUgY+G6p3UgdOG6oW0gZOG7q25nIHThu6sgc2VydmVyCiAgICAgICAgICAgICAgICBpZiBzZWxmLmRiLmdldCgicGF1c2Vfam9iIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJQaMOhdCBoaeG7h24gecOqdSBj4bqndSB04bqhbSBk4burbmcgdOG7qyBzZXJ2ZXIgdHJvbmcgcGhpw6puIGzDoG0gdmnhu4djIikKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgY+G6rXAgbmjhuq10IGNvbmZpZyB04burIHNlcnZlcgogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuY2hlY2tfYW5kX2hhbmRsZV9zZXJ2ZXJfdXBkYXRlcygpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJQaMOhdCBoaeG7h24gecOqdSBj4bqndSByZXN0YXJ0IHNlc3Npb24gZG8gY29uZmlnIHRoYXkgxJHhu5VpIHRyb25nIHBoacOqbiBsw6BtIHZp4buHYyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICAjIFRob8OhdCBraOG7j2kgX3dvcmtfc2Vzc2lvbiDEkeG7gyByZXN0YXJ0IHThu6sgcnVuKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIHTDoGkga2hv4bqjbiBt4bubaSBuaOG6pXQgdOG7qyBkYXRhYmFzZQogICAgICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnQoYWNjb3VudFsiaWQiXSkKICAgICAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgeGVtIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgbMOgbSB2aeG7h2Mga2jDtG5nCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5fY2FuX3J1bl9qb2IoYWNjb3VudCk6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYXBwX25hbWUgPSBhY2NvdW50LmdldCgiYXBwIikKICAgICAgICAgICAgICAgIGlmIGFwcF9uYW1lIG5vdCBpbiBzZWxmLmpvYl9oYW5kbGVyczoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSBqb2IgaGFuZGxlciBjaG8ge2FwcF9uYW1lfSwgYuG7jyBxdWEgdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdsOgIMSR4buTbmcgYuG7mSB0w6BpIGtob+G6o24gbuG6v3Ugc2VydmVyIHnDqnUgY+G6p3UKICAgICAgICAgICAgICAgIGlmIHNlbGYuX2NoZWNrX2FjY291bnRfc3luY19zdGF0dXMoYXBwX25hbWUpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiU2VydmVyIHnDqnUgY+G6p3UgxJHhu5NuZyBi4buZIGzhuqFpIHTDoGkga2hv4bqjbiBjaG8ge2FwcF9uYW1lfS4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc3luY19hY2NvdW50c19mb3JfYXBwKGFwcF9uYW1lKQogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgbOG6oWkgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24gc2F1IGtoaSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgICAgICAgICBhY2NvdW50ID0gc2VsZi5kYi5nZXRfYWNjb3VudChhY2NvdW50WyJpZCJdKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50IG9yIG5vdCBzZWxmLl9jYW5fcnVuX2pvYihhY2NvdW50KToKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMw6BtIHZp4buHYyB24bubaSB0w6BpIGtob+G6o24gbsOgeQogICAgICAgICAgICAgICAgaGFuZGxlciA9IHNlbGYuam9iX2hhbmRsZXJzW2FwcF9uYW1lXQogICAgICAgICAgICAgICAgYWNjb3VudF9yZXN1bHQgPSBzZWxmLl93b3JrX2FjY291bnRfc2Vzc2lvbihhY2NvdW50LCBoYW5kbGVyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMSQw7NuZyBhcHAgc2F1IGtoaSBsw6BtIHhvbmcgdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBoYW5kbGVyLmNsb3NlX2FwcCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTMOgbSBjaMSDbSBzw7NjIHNhdSBraGkgaOG6v3Qgam9iIChu4bq/dSDEkcaw4bujYyBi4bqtdCkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjYXJlX2luX3dvcmtpbmdfam9iID0gc2VsZi5kYi5nZXQoImNhcmVfaW5fd29ya2luZ19qb2IiLCBGYWxzZSkKICAgICAgICAgICAgICAgICAgICBpZiBjYXJlX2luX3dvcmtpbmdfam9iIGFuZCBoYXNhdHRyKGhhbmRsZXIsICJwZXJmb3JtX2NhcmUiKSBhbmQgY2FsbGFibGUoaGFuZGxlci5wZXJmb3JtX2NhcmUpOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlRo4buxYyBoaeG7h24gY2jEg20gc8OzYyBjaG8gdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5wZXJmb3JtX2NhcmUoYWNjb3VudCkKICAgICAgICAgICAgICAgICAgICBlbGlmIG5vdCBjYXJlX2luX3dvcmtpbmdfam9iOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJDaMSDbSBzw7NjIGLhu4sgdOG6r3QsIGLhu48gcXVhIGNoxINtIHPDs2MgY2hvIHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSIpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgY2jEg20gc8OzYyB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX06IHtlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgYuG7iyBnacOhbiDEkW/huqFuLCBk4burbmcgcGhpw6puCiAgICAgICAgICAgICAgICBpZiBub3QgYWNjb3VudF9yZXN1bHQ6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOZ2jhu4kgbmfhuq9uIGdp4buvYSBjw6FjIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgzKToKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kgdHJvbmcgcGhpw6puIGzDoG0gdmnhu4djIikKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICAjIMSQw6FuaCBk4bqldSBr4bq/dCB0aMO6YyBwaGnDqm4gbMOgbSB2aeG7h2MKICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9pc193b3JraW5nIiwgRmFsc2UpCiAgICAgICAgICAgIAogICAgIyBERVBSRUNBVEVEOiBQaMawxqFuZyB0aOG7qWMgbsOgeSBraMO0bmcgZMO5bmcgbuG7r2EgZG8gY2h1eeG7g24gc2FuZyBjxqEgY2jhur8gbeG7m2kKICAgICMgZGVmIF93b3JrX3dpdGhfYXBwKHNlbGYsIGFwcF9uYW1lOiBzdHIpIC0+IGJvb2w6CiAgICAjICAgICAiIiIKICAgICMgICAgIEzDoG0gdmnhu4djIHbhu5tpIG3hu5l0IGFwcCBj4bulIHRo4buDCiAgICAjICAgICAKICAgICMgICAgIEFyZ3M6CiAgICAjICAgICAgICAgYXBwX25hbWU6IFTDqm4gYXBwIGPhuqduIGzDoG0gdmnhu4djCiAgICAjICAgICAgICAgCiAgICAjICAgICBSZXR1cm5zOgogICAgIyAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgaG/DoG4gdGjDoG5oLCBGYWxzZSBu4bq/dSBi4buLIGdpw6FuIMSRb+G6oW4KICAgICMgICAgICIiIgogICAgIyAgICAgbG9nZ2VyLmluZm8oZiJC4bqvdCDEkeG6p3UgbMOgbSB2aeG7h2MgduG7m2kge2FwcF9uYW1lfSIpCiAgICAjICAgICAKICAgICMgICAgIGhhbmRsZXIgPSBzZWxmLmpvYl9oYW5kbGVyc1thcHBfbmFtZV0KICAgICMgICAgIAogICAgIyAgICAgIyBMw6BtIHZp4buHYyB0deG6p24gdOG7sSB24bubaSB04burbmcgdMOgaSBraG/huqNuIChyZWFsLXRpbWUgcmVsb2FkKQogICAgIyAgICAgd2hpbGUgVHJ1ZToKICAgICMgICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAjICAgICAgICAgICAgIGlmIHNlbGYuZm9yY2Vfc3RvcCBvciBub3Qgc2VsZi5ydW5uaW5nOgogICAgIyAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAjICAgICAgICAgICAgICAgICAKICAgICMgICAgICAgICAjIEtp4buDbSB0cmEgecOqdSBj4bqndSB04bqhbSBk4burbmcgdOG7qyBzZXJ2ZXIKICAgICMgICAgICAgICBpZiBzZWxmLmRiLmdldCgicGF1c2Vfam9iIiwgRmFsc2UpOgogICAgIyAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlBow6F0IGhp4buHbiB5w6p1IGPhuqd1IHThuqFtIGThu6tuZyB04burIHNlcnZlciBraGkgbMOgbSB2aeG7h2MgduG7m2kge2FwcF9uYW1lfSIpCiAgICAjICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgIyAgICAgICAgIAogICAgIyAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gbeG7m2kgbmjhuqV0IChjw7MgdGjhu4MgdGhheSDEkeG7lWkgdOG7qyBzZXJ2ZXIpCiAgICAjICAgICAgICAgYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9YXBwX25hbWUpCiAgICAjICAgICAgICAgCiAgICAjICAgICAgICAgIyBM4buNYyBjw6FjIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgbMOgbSB2aeG7h2MKICAgICMgICAgICAgICB3b3JrYWJsZV9hY2NvdW50cyA9IFthY2MgZm9yIGFjYyBpbiBhY2NvdW50cyBpZiBzZWxmLl9jYW5fcnVuX2pvYihhY2MpXQogICAgIyAgICAgICAgIAogICAgIyAgICAgICAgIGlmIG5vdCB3b3JrYWJsZV9hY2NvdW50czoKICAgICMgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaMO0bmcgY8OzIHTDoGkga2hv4bqjbiBuw6BvIGPDsyB0aOG7gyBsw6BtIHZp4buHYyBjaG8ge2FwcF9uYW1lfSIpCiAgICAjICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAjICAgICAgICAgICAgIAogICAgIyAgICAgICAgICMgVMOsbSB0w6BpIGtob+G6o24gY8OzIGpvYnNfZG9uZV9pbl9zZXNzaW9uIHRo4bqlcCBuaOG6pXQgxJHhu4MgbMOgbSB2aeG7h2MKICAgICMgICAgICAgICB3b3JrYWJsZV9hY2NvdW50cy5zb3J0KGtleT1sYW1iZGEgeDogeC5nZXQoJ2pvYnNfZG9uZV9pbl9zZXNzaW9uJywgMCkpCiAgICAjICAgICAgICAgYWNjb3VudCA9IHdvcmthYmxlX2FjY291bnRzWzBdCiAgICAjICAgICAgICAgCiAgICAjICAgICAgICAgbG9nZ2VyLmluZm8oZiJC4bqvdCDEkeG6p3UgbMOgbSB2aeG7h2MgduG7m2kgdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICMgICAgICAgICAKICAgICMgICAgICAgICAjIENodXnhu4NuIHNhbmcgdMOgaSBraG/huqNuIG7DoHkKICAgICMgICAgICAgICBzd2l0Y2hfcmVzdWx0ID0gaGFuZGxlci5zd2l0Y2hfdG9fYWNjb3VudChhY2NvdW50KQogICAgIyAgICAgICAgIGlmIG5vdCBzd2l0Y2hfcmVzdWx0OgogICAgIyAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgY2h1eeG7g24gc2FuZyB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0iKQogICAgIyAgICAgICAgICAgICAjIMSQw6FuaCBk4bqldSB0w6BpIGtob+G6o24gbsOgeSBjw7MgduG6pW4gxJHhu4EgdsOgIHRo4butIHTDoGkga2hv4bqjbiBraMOhYwogICAgIyAgICAgICAgICAgICBzZWxmLmRiLnNldF9hY2NvdW50X2luYWN0aXZlKGFjY291bnRbImlkIl0sIGluYWN0aXZlX3JlYXNvbj0iTOG7l2kgY2h1eeG7g24gdMOgaSBraG/huqNuIikKICAgICMgICAgICAgICAgICAgY29udGludWUKICAgICMgICAgICAgICAgICAgCiAgICAjICAgICAgICAgIyBMw6BtIMSR4bunIHPhu5Egam9iIHRyb25nIHBoacOqbiBjaG8gdMOgaSBraG/huqNuIG7DoHkKICAgICMgICAgICAgICBhY2NvdW50X3Jlc3VsdCA9IHNlbGYuX3dvcmtfYWNjb3VudF9zZXNzaW9uKGFjY291bnQsIGhhbmRsZXIpCiAgICAjICAgICAgICAgCiAgICAjICAgICAgICAgIyBMw6BtIGNoxINtIHPDs2Mgc2F1IGtoaSBo4bq/dCBqb2IKICAgICMgICAgICAgICB0cnk6CiAgICAjICAgICAgICAgICAgIGlmIGhhc2F0dHIoaGFuZGxlciwgInBlcmZvcm1fY2FyZSIpIGFuZCBjYWxsYWJsZShoYW5kbGVyLnBlcmZvcm1fY2FyZSk6CiAgICAjICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlRo4buxYyBoaeG7h24gY2jEg20gc8OzYyBjaG8gdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICMgICAgICAgICAgICAgICAgIGhhbmRsZXIucGVyZm9ybV9jYXJlKGFjY291bnQpCiAgICAjICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgIyAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBjaMSDbSBzw7NjIHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfToge2V9IikKICAgICMgICAgICAgICAgICAgCiAgICAjICAgICAgICAgIyBO4bq/dSBi4buLIGdpw6FuIMSRb+G6oW4sIHJldHVybiBGYWxzZQogICAgIyAgICAgICAgIGlmIG5vdCBhY2NvdW50X3Jlc3VsdDoKICAgICMgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAjICAgICAgICAgICAgIAogICAgIyAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB4ZW0gY8OybiB0w6BpIGtob+G6o24gbsOgbyBjw7MgdGjhu4MgbMOgbSB2aeG7h2Mga2jDtG5nCiAgICAjICAgICAgICAgIyAoY8OzIHRo4buDIGPDsyB0aGF5IMSR4buVaSB04burIHNlcnZlciB0cm9uZyBsw7pjIGzDoG0gdmnhu4djKQogICAgIyAgICAgICAgIHVwZGF0ZWRfYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9YXBwX25hbWUpCiAgICAjICAgICAgICAgcmVtYWluaW5nX3dvcmthYmxlID0gW2FjYyBmb3IgYWNjIGluIHVwZGF0ZWRfYWNjb3VudHMgaWYgc2VsZi5fY2FuX3J1bl9qb2IoYWNjKV0KICAgICMgICAgICAgICAKICAgICMgICAgICAgICBpZiBub3QgcmVtYWluaW5nX3dvcmthYmxlOgogICAgIyAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgaG/DoG4gdGjDoG5oIHThuqV0IGPhuqMgdMOgaSBraG/huqNuIGPDsyB0aOG7gyBsw6BtIHZp4buHYyBjaG8ge2FwcF9uYW1lfSIpCiAgICAjICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgIGRlZiBfd29ya19hY2NvdW50X3Nlc3Npb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGhhbmRsZXIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgTMOgbSB2aeG7h2MgduG7m2kgbeG7mXQgdMOgaSBraG/huqNuIHRyb25nIHBoacOqbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGhhbmRsZXI6IEpvYiBoYW5kbGVyCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgaG/DoG4gdGjDoG5oLCBGYWxzZSBu4bq/dSBi4buLIGdpw6FuIMSRb+G6oW4KICAgICAgICAiIiIKICAgICAgICB1c2VybmFtZSA9IGFjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnVW5rbm93bicpCiAgICAgICAgam9ic19kb25lID0gMAogICAgICAgIGNhcmVfY291bnRlciA9IDAKICAgICAgICBjb25maWdfcmVsb2FkX2NvdW50ZXIgPSAwICAjIMSQ4bq/bSDEkeG7gyByZWxvYWQgY+G6pXUgaMOsbmggxJHhu4tuaCBr4buzCiAgICAgICAgbm9fam9iX2NvdW50ID0gMCAgIyDEkOG6v20gc+G7kSBs4bqnbiBraMO0bmcgbOG6pXkgxJHGsOG7o2Mgam9iIGxpw6puIHRp4bq/cAogICAgICAgIG1heF9ub19qb2JfYXR0ZW1wdHMgPSAzICAjIFPhu5EgbOG6p24gdOG7kWkgxJFhIHRo4butIGzhuqV5IGpvYiBraGkga2jDtG5nIGPDswogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYiTMOgbSB2aeG7h2MgduG7m2kgdMOgaSBraG/huqNuIHt1c2VybmFtZX0iKQogICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gc2FuZyB0w6BpIGtob+G6o24gbsOgeQogICAgICAgIHN3aXRjaF9yZXN1bHQgPSBoYW5kbGVyLnN3aXRjaF90b19hY2NvdW50KGFjY291bnQpCiAgICAgICAgaWYgbm90IHN3aXRjaF9yZXN1bHQ6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBjaHV54buDbiBzYW5nIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IHTDoGkga2hv4bqjbiDEkcOjIGxvZ291dCBraGkga2jDtG5nIHRo4buDIGNodXnhu4NuIMSRxrDhu6NjCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiVMOgaSBraG/huqNuIHt1c2VybmFtZX0ga2jDtG5nIHRo4buDIGNodXnhu4NuIMSRxrDhu6NjLCDEkcOhbmggZOG6pXUgbG9nb3V0IikKICAgICAgICAgICAgIyBU4bqhbyBtZXNzYWdlIHbhu5tpIG5nw6B5IGdp4budIGhp4buHbiB04bqhaQogICAgICAgICAgICBpbXBvcnQgZGF0ZXRpbWUKICAgICAgICAgICAgY3VycmVudF90aW1lID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVkLyVtLyVZICVIOiVNOiVTIikKICAgICAgICAgICAgbG9nb3V0X21lc3NhZ2UgPSBmIlBow6F0IGhp4buHbiBsb2dvdXQ6IHtjdXJyZW50X3RpbWV9IgogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAic3RhdHVzIjogImxvZ291dCIsCiAgICAgICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogbG9nb3V0X21lc3NhZ2UsCiAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHJldHVybiBUcnVlICAjIFJldHVybiBUcnVlIMSR4buDIHRp4bq/cCB04bulYyB24bubaSB0w6BpIGtob+G6o24gdGnhur9wIHRoZW8KICAgICAgICAKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmZvcmNlX3N0b3Agb3Igbm90IHNlbGYucnVubmluZzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTHXDtG4gcmVsb2FkIGFjY291bnQg4bufIMSR4bqndSB2w7JuZyBs4bq3cCDEkeG7gyDEkeG6o20gYuG6o28gZOG7ryBsaeG7h3UgbeG7m2kgbmjhuqV0IHThu6sgc2VydmVyCiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50KGFjY291bnRbImlkIl0pCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHt1c2VybmFtZX0gc2F1IGtoaSByZWxvYWQsIGThu6tuZyBzZXNzaW9uIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgeGVtIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgY2jhuqF5IGpvYiBraMO0bmcgc2F1IGtoaSByZWxvYWQKICAgICAgICAgICAgaWYgbm90IHNlbGYuX2Nhbl9ydW5fam9iKGFjY291bnQpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge3VzZXJuYW1lfSBraMO0bmcgdGjhu4MgY2jhuqF5IGpvYiBu4buvYSBzYXUga2hpIHJlbG9hZCIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgecOqdSBj4bqndSB04bqhbSBk4burbmcgdOG7qyBzZXJ2ZXIKICAgICAgICAgICAgaWYgc2VsZi5kYi5nZXQoInBhdXNlX2pvYiIsIEZhbHNlKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiUGjDoXQgaGnhu4duIHnDqnUgY+G6p3UgdOG6oW0gZOG7q25nIHThu6sgc2VydmVyIGtoaSBsw6BtIHZp4buHYyB24bubaSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgY+G6rXAgbmjhuq10IGNvbmZpZyB04burIHNlcnZlcgogICAgICAgICAgICBpZiBub3Qgc2VsZi5jaGVja19hbmRfaGFuZGxlX3NlcnZlcl91cGRhdGVzKCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlBow6F0IGhp4buHbiB5w6p1IGPhuqd1IHJlc3RhcnQgc2Vzc2lvbiBkbyBjb25maWcgdGhheSDEkeG7lWkga2hpIGzDoG0gdmnhu4djIHbhu5tpIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZSAgIyBUaG/DoXQgxJHhu4MgcmVzdGFydCBzZXNzaW9uCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVXBkYXRlIHByb3h5IHRpbWVzdGFtcCBt4buXaSAyMCBnacOieSBu4bq/dSDEkWFuZyBz4butIGThu6VuZyBwcm94eQogICAgICAgICAgICB1c2VfcHJveHkgPSBzZWxmLmRiLmdldCgidXNlX3Byb3h5IiwgRmFsc2UpCiAgICAgICAgICAgIGlmIHVzZV9wcm94eSBhbmQgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICAgICAgY3VycmVudF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgICAgIGlmIGN1cnJlbnRfdGltZSAtIHNlbGYucHJveHlfbGFzdF91cGRhdGUgPj0gMjA6CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5fdXBkYXRlX3Byb3h5KCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygixJDDoyB1cGRhdGUgcHJveHkgdGltZXN0YW1wIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiVXBkYXRlIHByb3h5IHRpbWVzdGFtcCB0aOG6pXQgYuG6oWkiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlbG9hZCBj4bqldSBow6xuaCB0w6BpIGtob+G6o24gdOG7qyBkYXRhYmFzZSBt4buXaSA1IGpvYiDEkeG7gyBwaOG6o24gw6FuaCB0aGF5IMSR4buVaSB04burIHNlcnZlcgogICAgICAgICAgICBjb25maWdfcmVsb2FkX2NvdW50ZXIgKz0gMQogICAgICAgICAgICBpZiBjb25maWdfcmVsb2FkX2NvdW50ZXIgPj0gNToKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlJlbG9hZCBj4bqldSBow6xuaCB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSB04burIGRhdGFiYXNlICjEkcOjIHJlbG9hZCDhu58gxJHhuqd1IHbDsm5nIGzhurdwKSIpCiAgICAgICAgICAgICAgICBjb25maWdfcmVsb2FkX2NvdW50ZXIgPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgZ2nhu5tpIGjhuqFuIHBoacOqbiBoaeG7h24gdOG6oWkKICAgICAgICAgICAgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPSBhY2NvdW50LmdldCgibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCAwKSBvciBjb25maWcuTUFYX0pPQlNfUEVSX1NFU1NJT04KICAgICAgICAgICAgam9ic19kb25lX2luX3Nlc3Npb24gPSBhY2NvdW50LmdldCgiam9ic19kb25lX2luX3Nlc3Npb24iLCAwKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgam9ic19kb25lX2luX3Nlc3Npb24gPj0gbWF4X2pvYnNfcGVyX3Nlc3Npb246CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IMSRw6MgaG/DoG4gdGjDoG5oIMSR4bunIGpvYiB0cm9uZyBwaGnDqm4gKHtqb2JzX2RvbmVfaW5fc2Vzc2lvbn0ve21heF9qb2JzX3Blcl9zZXNzaW9ufSkiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IGpvYgogICAgICAgICAgICAgICAgam9iID0gaGFuZGxlci5mZXRjaF9qb2IoYWNjb3VudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGpvYjoKICAgICAgICAgICAgICAgICAgICBub19qb2JfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiS2jDtG5nIGPDsyBqb2IgY2hvIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IChs4bqnbiB7bm9fam9iX2NvdW50fS97bWF4X25vX2pvYl9hdHRlbXB0c30pIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYyBqb2IgcXXDoSBuaGnhu4F1IGzhuqduLCBk4burbmcgcGhpw6puIGzDoG0gdmnhu4djCiAgICAgICAgICAgICAgICAgICAgaWYgbm9fam9iX2NvdW50ID49IG1heF9ub19qb2JfYXR0ZW1wdHM6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiVMOgaSBraG/huqNuIHt1c2VybmFtZX0ga2jDtG5nIGzhuqV5IMSRxrDhu6NjIGpvYiBzYXUge21heF9ub19qb2JfYXR0ZW1wdHN9IGzhuqduIHRo4butLCBk4burbmcgcGhpw6puIGzDoG0gdmnhu4djIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE5naOG7iSBt4buZdCBjaMO6dCB0csaw4bubYyBraGkgdGjhu60gbOG6oWkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS5yYW5kaW50KDEwLCAyMCkpOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFJlc2V0IGNvdW50ZXIga2hpIGzhuqV5IMSRxrDhu6NjIGpvYgogICAgICAgICAgICAgICAgbm9fam9iX2NvdW50ID0gMAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgZGV2aWNlIG1lc3NhZ2UKICAgICAgICAgICAgICAgIGxpbmsgPSBqb2IuZ2V0KCdsaW5rJywgJycpCiAgICAgICAgICAgICAgICBpZiBsaW5rLnN0YXJ0c3dpdGgoJ2h0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vJyk6CiAgICAgICAgICAgICAgICAgICAgbGluayA9IGxpbmsucmVwbGFjZSgnaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS8nLCAnJykKICAgICAgICAgICAgICAgIGVsaWYgbGluay5zdGFydHN3aXRoKCdodHRwczovL3d3dy50aWt0b2suY29tLycpOgogICAgICAgICAgICAgICAgICAgIGxpbmsgPSBsaW5rLnJlcGxhY2UoJ2h0dHBzOi8vd3d3LnRpa3Rvay5jb20vJywgJycpCiAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCBmIlt7YWNjb3VudC5nZXQoJ2FwcCcpfV1be3VzZXJuYW1lfV1be2pvYi5nZXQoJ3R5cGUnKX1dW3tsaW5rfV0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFZhbGlkYXRlIGpvYgogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9yZXN1bHQgPSBoYW5kbGVyLnZhbGlkYXRlX2pvYl9iZWZvcmVfZXhlY3V0aW9uKGFjY291bnQsIGpvYikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHZhbGlkYXRpb25fcmVzdWx0LmdldCgidmFsaWQiLCBUcnVlKToKICAgICAgICAgICAgICAgICAgICBpZiB2YWxpZGF0aW9uX3Jlc3VsdC5nZXQoInNob3VsZF9za2lwIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgICAgICAgICAjIFNraXAgam9iCiAgICAgICAgICAgICAgICAgICAgICAgIHNraXBfbWVzc2FnZSA9IHZhbGlkYXRpb25fcmVzdWx0LmdldCgibWVzc2FnZSIsICJKb2Iga2jDtG5nIGjhu6NwIGzhu4ciKQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlNraXAgam9iOiB7c2tpcF9tZXNzYWdlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLnJlY29yZF9qb2JfaGlzdG9yeShhY2NvdW50LCBqb2IsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogMiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiBza2lwX21lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLnNraXBfam9iKGFjY291bnQsIGpvYikKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJTa2lwIGpvYiBs4buXaToge2V9IikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgR2nDo24gdGjhu51pIGdpYW4gc2F1IGtoaSBza2lwIGpvYiDEkeG7gyB0csOhbmggc3BhbSBs4bqleS9o4buneSBqb2IgbGnDqm4gdOG7pWMKICAgICAgICAgICAgICAgICAgICAgICAgc2tpcF9zbGVlcF90aW1lID0gcmFuZG9tLnJhbmRpbnQoMywgMTApCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmdo4buJIHtza2lwX3NsZWVwX3RpbWV9cyBzYXUga2hpIHNraXAgam9iIMSR4buDIHRyw6FuaCBzcGFtIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcChza2lwX3NsZWVwX3RpbWUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJKb2Iga2jDtG5nIGjhu6NwIGzhu4c6IHt2YWxpZGF0aW9uX3Jlc3VsdC5nZXQoJ21lc3NhZ2UnLCAnVW5rbm93biBlcnJvcicpfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGpvYgogICAgICAgICAgICAgICAgam9iX3Jlc3VsdCA9IGhhbmRsZXIuZXhlY3V0ZV9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGvhur90IHF14bqjCiAgICAgICAgICAgICAgICBqb2Jfc3RhdHVzID0gam9iX3Jlc3VsdFsic3RhdHVzIl0KICAgICAgICAgICAgICAgIGpvYl9zdWNjZXNzID0gam9iX3Jlc3VsdFsic3VjY2VzcyJdCiAgICAgICAgICAgICAgICBqb2JfbWVzc2FnZSA9IGpvYl9yZXN1bHRbIm1lc3NhZ2UiXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGzhu5dpIGZvbGxvdyBwZW5kaW5nCiAgICAgICAgICAgICAgICBpZiBqb2Jfc3RhdHVzID09IDQgYW5kIGpvYi5nZXQoInR5cGUiLCAiIikubG93ZXIoKSA9PSAiZm9sbG93IjoKICAgICAgICAgICAgICAgICAgICBjbnQgPSBzZWxmLmZvbGxvd19wZW5kaW5nX2NvdW50cy5nZXQoYWNjb3VudFsiaWQiXSwgMCkgKyAxCiAgICAgICAgICAgICAgICAgICAgc2VsZi5mb2xsb3dfcGVuZGluZ19jb3VudHNbYWNjb3VudFsiaWQiXV0gPSBjbnQKICAgICAgICAgICAgICAgICAgICBpZiBjbnQgPj0gNToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJUw6BpIGtob+G6o24ge3VzZXJuYW1lfSDEkcOjIDUgbOG6p24gbGnDqm4gdGnhur9wIGZvbGxvdyBwZW5kaW5nLCB04bqhbSBk4burbmcgdMOgaSBraG/huqNuIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXRfYWNjb3VudF9pbmFjdGl2ZShhY2NvdW50WyJpZCJdLCBpbmFjdGl2ZV9yZWFzb249Ikxpw6puIHRp4bq/cCBs4buXaSBmb2xsb3cgcGVuZGluZyIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZm9sbG93X3BlbmRpbmdfY291bnRzW2FjY291bnRbImlkIl1dID0gMAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxpZiBqb2IuZ2V0KCJ0eXBlIiwgIiIpLmxvd2VyKCkgPT0gImZvbGxvdyI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5mb2xsb3dfcGVuZGluZ19jb3VudHNbYWNjb3VudFsiaWQiXV0gPSAwCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIELDoW8gY8OhbyBr4bq/dCBxdeG6owogICAgICAgICAgICAgICAgaGFuZGxlci5yZXBvcnRfam9iKGFjY291bnQsIGpvYiwgam9iX3Jlc3VsdCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjhu5FuZyBrw6oKICAgICAgICAgICAgICAgIHNlbGYuX3VwZGF0ZV9qb2Jfc3RhdHMoYWNjb3VudCwgam9iX3N1Y2Nlc3MsIGpvYi5nZXQoInR5cGUiLCAiIikpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUmVsb2FkIGFjY291bnQgc2F1IGtoaSB1cGRhdGUgxJHhu4MgY8OzIGThu68gbGnhu4d1IG3hu5tpIG5o4bqldAogICAgICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnQoYWNjb3VudFsiaWQiXSkKICAgICAgICAgICAgICAgIGpvYnNfZG9uZV9pbl9zZXNzaW9uID0gYWNjb3VudC5nZXQoImpvYnNfZG9uZV9pbl9zZXNzaW9uIiwgMCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJL4bq/dCBxdeG6oyBqb2Ige2pvYnNfZG9uZV9pbl9zZXNzaW9ufS97bWF4X2pvYnNfcGVyX3Nlc3Npb259OiB7am9iX21lc3NhZ2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDaOG7iSB0xINuZyBjYXJlX2NvdW50ZXIga2hpIGpvYiB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIGlmIGpvYl9zdWNjZXNzOgogICAgICAgICAgICAgICAgICAgIGpvYnNfZG9uZSArPSAxCiAgICAgICAgICAgICAgICAgICAgY2FyZV9jb3VudGVyICs9IDEKICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBDaMSDbSBzw7NjIHNhdSBt4buXaSAzLTUgam9iIHRow6BuaCBjw7RuZyAocmFuZG9tKQogICAgICAgICAgICAgICAgICAgICMgaWYgY2FyZV9jb3VudGVyID49IHJhbmRvbS5yYW5kaW50KDMsIDUpOgogICAgICAgICAgICAgICAgICAgICMgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjICAgICAgICAgaWYgaGFzYXR0cihoYW5kbGVyLCAicGVyZm9ybV9jYXJlIikgYW5kIGNhbGxhYmxlKGhhbmRsZXIucGVyZm9ybV9jYXJlKToKICAgICAgICAgICAgICAgICAgICAjICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVGjhu7FjIGhp4buHbiBjaMSDbSBzw7NjIG5o4bq5IGNobyB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgIyAgICAgICAgICAgICBoYW5kbGVyLnBlcmZvcm1fY2FyZShhY2NvdW50KQogICAgICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgY2FyZV9jb3VudGVyID0gMAogICAgICAgICAgICAgICAgICAgICMgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAjICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgY2jEg20gc8OzYyBuaOG6uToge2V9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOZ2jhu4kgbmfhuq9uIGdp4buvYSBjw6FjIGpvYgogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcChyYW5kb20ucmFuZGludCgyLCA1KSk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBqb2IgY2hvIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICBkZWYgX3N0YXJ0X3Nlc3Npb25fY29vbGRvd24oc2VsZik6CiAgICAgICAgIiIiQuG6r3QgxJHhuqd1IHRo4budaSBnaWFuIG5naOG7iSBnaeG7r2EgY8OhYyBwaGnDqm4iIiIKICAgICAgICBjb29sZG93bl9taW51dGVzID0gc2VsZi5kYi5nZXQoImpvYl9jb29sZG93bl9taW51dGVzIiwgNjApCiAgICAgICAgc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lID0gaW50KHRpbWUudGltZSgpKSArIChjb29sZG93bl9taW51dGVzICogNjApCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiJC4bqvdCDEkeG6p3Ugbmdo4buJIG5nxqFpIHtjb29sZG93bl9taW51dGVzfSBwaMO6dCBnaeG7r2EgY8OhYyBwaGnDqm4iKQogICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsIGYie0pvYlNlcnZpY2VDb25zdGFudHMuTVNHX1NFU1NJT05fQ09PTERPV059ICh7Y29vbGRvd25fbWludXRlc30gcGjDunQpIikKICAgICAgICAKICAgICAgICAjIELhuqVtIG7DunQgSG9tZSB2w6AgbeG7nyBUZXJtdXgga2hpIGLhuq90IMSR4bqndSBuZ2jhu4kgbmfGoWkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJC4bqlbSBuw7p0IEhvbWUgdsOgIG3hu58gVGVybXV4IMSR4buDIG5naOG7iSBuZ8ahaSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELhuqVtIG7DunQgSG9tZQogICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2jhu50gbeG7mXQgY2jDunQgcuG7k2kgbeG7nyBUZXJtdXgKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcCgiY29tLnRlcm11eCIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgYuG6pW0gSG9tZSB2w6AgbeG7nyBUZXJtdXg6IHtlfSIpCiAgICAgICAgCiAgICBkZWYgX2lzX2luX3Nlc3Npb25fY29vbGRvd24oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcgdHJvbmcgdGjhu51pIGdpYW4gbmdo4buJIGdp4buvYSBjw6FjIHBoacOqbiBraMO0bmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRYW5nIHRyb25nIHRo4budaSBnaWFuIG5naOG7iQogICAgICAgICIiIgogICAgICAgICMgTuG6v3UgY8OzIHnDqnUgY+G6p3UgcmVzdGFydCBzZXNzaW9uLCBi4buPIHF1YSBjb3VudGRvd24KICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgIGlmIHNlbGYuZm9yY2VfcmVzdGFydF9zZXNzaW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkPDsyB5w6p1IGPhuqd1IHJlc3RhcnQgc2Vzc2lvbiwgYuG7jyBxdWEgdGjhu51pIGdpYW4gbmdo4buJIikKICAgICAgICAgICAgICAgIHNlbGYucHJveHlfc2Vzc2lvbl9lbmRfdGltZSA9IDAKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgIGlmIHNlbGYucHJveHlfc2Vzc2lvbl9lbmRfdGltZSA8PSAwOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgdGjhu51pIGdpYW4gY29vbGRvd24gaGnhu4duIHThuqFpCiAgICAgICAgY3VycmVudF90aW1lID0gaW50KHRpbWUudGltZSgpKQogICAgICAgIGlmIGN1cnJlbnRfdGltZSA8IHNlbGYucHJveHlfc2Vzc2lvbl9lbmRfdGltZToKICAgICAgICAgICAgcmVtYWluaW5nX21pbnV0ZXMgPSBpbnQoKHNlbGYucHJveHlfc2Vzc2lvbl9lbmRfdGltZSAtIGN1cnJlbnRfdGltZSkgLyA2MCkKICAgICAgICAgICAgcmVtYWluaW5nX3NlY29uZHMgPSAoc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lIC0gY3VycmVudF90aW1lKSAlIDYwCiAgICAgICAgICAgIGlmIHJlbWFpbmluZ19taW51dGVzID4gMDoKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkPDsm4ge3JlbWFpbmluZ19taW51dGVzfSBwaMO6dCB7cmVtYWluaW5nX3NlY29uZHN9IGdpw6J5IG5naOG7iSBuZ8ahaSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJDw7JuIHtyZW1haW5pbmdfc2Vjb25kc30gZ2nDonkgbmdo4buJIG5nxqFpIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBo4bq/dCB0aOG7nWkgZ2lhbiBuZ2jhu4kgbmfGoWksIGLhuq90IMSR4bqndSBwaGnDqm4gbMOgbSB2aeG7h2MgbeG7m2kiKQogICAgICAgICAgICBzZWxmLnByb3h5X3Nlc3Npb25fZW5kX3RpbWUgPSAwCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ==').decode('utf-8'))
