import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBMaXN0CmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCmZyb20gdXRpbHMgaW1wb3J0IExvZ0xldmVsLCBMb2dnZXIKCiMgVOG6oW8gbG9nZ2VyIHJpw6puZyBjaG8gR29MaWtlU2VydmljZQpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJHb0xpa2VTZXJ2aWNlIikKCiMgS2nhu4NtIHRyYSB2w6AgaW1wb3J0IGPDoWMgdGjGsCB2aeG7h24gY+G6p24gdGhp4bq/dAp0cnk6CiAgICBpbXBvcnQgcHljaHJvbWUKICAgIFBZQ0hST01FX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLndhcm5pbmcoIlRoxrAgdmnhu4duIHB5Y2hyb21lIGtow7RuZyBraOG6oyBk4bulbmcuIEjDo3kgY8OgaSDEkeG6t3QgYuG6sW5nIGzhu4duaDogcGlwIGluc3RhbGwgcHljaHJvbWUiKQogICAgUFlDSFJPTUVfQVZBSUxBQkxFID0gRmFsc2UKCnRyeToKICAgIGltcG9ydCBjbG91ZHNjcmFwZXIKICAgIENMT1VEU0NSQVBFUl9BVkFJTEFCTEUgPSBUcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIGxvZ2dlci53YXJuaW5nKCJUaMawIHZp4buHbiBjbG91ZHNjcmFwZXIga2jDtG5nIGto4bqjIGThu6VuZy4gSMOjeSBjw6BpIMSR4bq3dCBi4bqxbmcgbOG7h25oOiBwaXAgaW5zdGFsbCBjbG91ZHNjcmFwZXIiKQogICAgQ0xPVURTQ1JBUEVSX0FWQUlMQUJMRSA9IEZhbHNlCgp0cnk6CiAgICBpbXBvcnQgY3VybF9jZmZpCiAgICBmcm9tIGN1cmxfY2ZmaSBpbXBvcnQgcmVxdWVzdHMgYXMgY3VybF9yZXF1ZXN0cwogICAgQ1VSTF9DRkZJX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLndhcm5pbmcoIlRoxrAgdmnhu4duIGN1cmxfY2ZmaSBraMO0bmcga2jhuqMgZOG7pW5nLiBIw6N5IGPDoGkgxJHhurd0IGLhurFuZyBs4buHbmg6IHBpcCBpbnN0YWxsIGN1cmwtY2ZmaSIpCiAgICBDVVJMX0NGRklfQVZBSUxBQkxFID0gRmFsc2UKCmNsYXNzIEJyb3dzZXI6CiAgICAiIiIKICAgIEzhu5twIGdp4bqjIGzhuq1wIEJyb3dzZXIgY+G7p2EgcHljaHJvbWUgbuG6v3UgdGjGsCB2aeG7h24ga2jDtG5nIGto4bqjIGThu6VuZwogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgdXJsKToKICAgICAgICBzZWxmLnVybCA9IHVybAogICAgICAgIAogICAgZGVmIGxpc3RfdGFiKHNlbGYpOgogICAgICAgIHJldHVybiBbXQogICAgICAgIAogICAgZGVmIG5ld190YWIoc2VsZik6CiAgICAgICAgcmV0dXJuIE5vbmUKCmNsYXNzIEdvTGlrZVNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBHb0xpa2UgU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGRiX3NlcnZpY2U6IERhdGFiYXNlIHNlcnZpY2UgxJHhu4MgbMawdSB0aMO0bmcgdGluCiAgICAgICAgICAgIGhlbHBlcl9zZXJ2aWNlOiBIZWxwZXIgc2VydmljZSDEkeG7gyB0xrDGoW5nIHTDoWMgduG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5kYiA9IGRiX3NlcnZpY2UKICAgICAgICBzZWxmLmhlbHBlciA9IGhlbHBlcl9zZXJ2aWNlCiAgICAgICAgCiAgICAgICAgIyBD4bqldSBow6xuaCBjaG8gQVBJIHJlcXVlc3RzCiAgICAgICAgc2VsZi51c2VyX2FnZW50ID0gIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgSykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzExNC4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiIKICAgICAgICAKICAgICAgICAjIFF1eeG6v3QgxJHhu4tuaCBz4butIGThu6VuZyBjdXJsX2NmZmkgaGF5IGNsb3Vkc2NyYXBlcgogICAgICAgICMgVHLDqm4gVGVybXV4IHRoxrDhu51uZyBz4butIGThu6VuZyBjbG91ZHNjcmFwZXIgZG8gY3VybF9jZmZpIGPDsyB0aOG7gyBraMO0bmcgdMawxqFuZyB0aMOtY2gKICAgICAgICBpc190ZXJtdXggPSBzZWxmLl9jaGVja19pc190ZXJtdXgoKQogICAgICAgIHNlbGYudXNlX2N1cmxfY2ZmaSA9IG5vdCBpc190ZXJtdXggYW5kIENVUkxfQ0ZGSV9BVkFJTEFCTEUKICAgICAgICAKICAgICAgICAjIEto4bufaSB04bqhbyBjbGllbnQKICAgICAgICBpZiBub3Qgc2VsZi51c2VfY3VybF9jZmZpIGFuZCBDTE9VRFNDUkFQRVJfQVZBSUxBQkxFOgogICAgICAgICAgICBzZWxmLmNsaWVudCA9IGNsb3Vkc2NyYXBlci5jcmVhdGVfc2NyYXBlcigKICAgICAgICAgICAgICAgIGJyb3dzZXI9ewogICAgICAgICAgICAgICAgICAgICdicm93c2VyJzogJ2Nocm9tZScsCiAgICAgICAgICAgICAgICAgICAgJ3BsYXRmb3JtJzogJ2FuZHJvaWQnLAogICAgICAgICAgICAgICAgICAgICdkZXNrdG9wJzogRmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgRmFsbGJhY2sgdG8gcmVndWxhciByZXF1ZXN0cyBpZiBuZWl0aGVyIGlzIGF2YWlsYWJsZQogICAgICAgICAgICBzZWxmLmNsaWVudCA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIHTDuXkgY2jhu41uIGNobyBjdXJsX2NmZmkKICAgICAgICBzZWxmLmltcGVyc29uYXRlID0gImNocm9tZTExMCIKICAgICAgICAKICAgICAgICAjIEJp4bq/biB0aGVvIGTDtWkgdGhyZWFkIHJlcG9ydAogICAgICAgIHNlbGYucmVwb3J0X3RocmVhZCA9IE5vbmUKICAgICAgICAKICAgICAgICAjIEto4bufaSDEkeG7mW5nIHRocmVhZCByZXBvcnQKICAgICAgICBzZWxmLnN0YXJ0X3JlcG9ydF90aHJlYWQoKQoKICAgIGRlZiBfY2hlY2tfaXNfdGVybXV4KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIGPDsyDEkWFuZyBjaOG6oXkgdHLDqm4gVGVybXV4IGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJFhbmcgY2jhuqF5IHRyw6puIFRlcm11eAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGJp4bq/biBtw7RpIHRyxrDhu51uZyBURVJNVVhfVkVSU0lPTiBob+G6t2MgxJHGsOG7nW5nIGThuqtuIFRlcm11eCB0cm9uZyBQQVRICiAgICAgICAgICAgIGltcG9ydCBvcwogICAgICAgICAgICByZXR1cm4gJ1RFUk1VWF9WRVJTSU9OJyBpbiBvcy5lbnZpcm9uIG9yICcvZGF0YS9kYXRhL2NvbS50ZXJtdXgnIGluIG9zLmVudmlyb24uZ2V0KCdQQVRIJywgJycpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZmV0Y2hfZ29saWtlX2hlYWRlcnMoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBoZWFkZXJzIHThu6sgQ2hyb21lIHbDoCBsxrB1IHbDoG8gZGF0YWJhc2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IFBZQ0hST01FX0FWQUlMQUJMRToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgbOG6pXkgR29MaWtlIGhlYWRlcnM6IHRoxrAgdmnhu4duIHB5Y2hyb21lIGtow7RuZyBraOG6oyBk4bulbmciKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICBmcm9tIHB5Y2hyb21lIGltcG9ydCBCcm93c2VyCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgQ2hyb21lIMSRw6MgY8OgaSDEkeG6t3QgY2jGsGEKICAgICAgICAgICAgaWYgbm90IHNlbGYuaGVscGVyLmlzX2FwcF9pbnN0YWxsZWQoImNvbS5hbmRyb2lkLmNocm9tZSIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJDaHJvbWUgY2jGsGEgxJHGsOG7o2MgY8OgaSDEkeG6t3QgdHLDqm4gdGhp4bq/dCBi4buLIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTeG7nyBDaHJvbWUKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk3hu58g4bupbmcgZOG7pW5nIENocm9tZS4uLiIpCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuaGVscGVyLm9wZW5fYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiLCAiY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4iKQogICAgICAgICAgICBpZiByZXN1bHRbInN0YXR1cyJdICE9ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIG3hu58gQ2hyb21lIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgdGltZS5zbGVlcCg2KSAgIAoKICAgICAgICAgICAgaWYgbm90IHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5hbmRyb2lkLmNocm9tZTppZC9tZW51X2J1dHRvbl93cmFwcGVyIix0aW1lb3V0PTMwKToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIG3hu58gxJHGsOG7o2MgY2hyb21lIHRyb25nIDMwcyIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE3hu58gQ2hyb21lIGRlYnVnIHBvcnQgYuG6sW5nIEFEQgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIEFEQiDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgICAgICAgICBpZiBzZWxmLmhlbHBlci5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iyB04burIGhlbHBlcgogICAgICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLmhlbHBlci5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBs4buHbmggZm9yd2FyZCB24bubaSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbImZvcndhcmQiLCAidGNwOjkyMjIiLCAibG9jYWxhYnN0cmFjdDpjaHJvbWVfZGV2dG9vbHNfcmVtb3RlIl0KICAgICAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkFEQiBraMO0bmcgxJHGsOG7o2Mga+G6v3QgbuG7kWksIGtow7RuZyB0aOG7gyBt4bufIENocm9tZSBkZWJ1ZyBwb3J0IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbeG7nyBDaHJvbWUgZGVidWcgcG9ydDoge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgS+G6v3QgbuG7kWkgxJHhur9uIENocm9tZSBi4bqxbmcgcHljaHJvbWUKICAgICAgICAgICAgYnJvd3NlciA9IEJyb3dzZXIoImh0dHA6Ly9sb2NhbGhvc3Q6OTIyMiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OhYyB0YWIgxJFhbmcgbeG7nwogICAgICAgICAgICBnb2xpa2VfdGFiID0gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7Mgc2VhcmNoIGJveCBraMO0bmcKICAgICAgICAgICAgc2VhcmNoX2JveCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmFuZHJvaWQuY2hyb21lOmlkL3NlYXJjaF9ib3giKQogICAgICAgICAgICBpZiBzZWFyY2hfYm94OgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlThuqFvIHRhYiBt4bubaS4uLiIpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSB04bqhbyB0YWIgbeG7m2kgduG7m2kgeOG7rSBsw70gbOG7l2kgSlNPTkRlY29kZUVycm9yCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBnb2xpa2VfdGFiID0gYnJvd3Nlci5uZXdfdGFiKCkKICAgICAgICAgICAgICAgICAgICAgICAgZ29saWtlX3RhYi5zdGFydCgpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IChqc29uLkpTT05EZWNvZGVFcnJvciwgcmVxdWVzdHMuZXhjZXB0aW9ucy5KU09ORGVjb2RlRXJyb3IpIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIEpTT04ga2hpIHThuqFvIHRhYiBt4bubaToge2V9LiBUaOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBDaHJvbWUuIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiLCAiY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4iKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFRo4buxYyBoaeG7h24gbOG6oWkgbOG7h25oIGZvcndhcmQKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuaGVscGVyLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJmb3J3YXJkIiwgInRjcDo5MjIyIiwgImxvY2FsYWJzdHJhY3Q6Y2hyb21lX2RldnRvb2xzX3JlbW90ZSJdCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu60ga+G6v3QgbuG7kWkgbOG6oWkKICAgICAgICAgICAgICAgICAgICAgICAgYnJvd3NlciA9IEJyb3dzZXIoImh0dHA6Ly9sb2NhbGhvc3Q6OTIyMiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGdvbGlrZV90YWIgPSBicm93c2VyLm5ld190YWIoKQogICAgICAgICAgICAgICAgICAgICAgICBnb2xpa2VfdGFiLnN0YXJ0KCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBpZiAiV2ViU29ja2V0Q29ubmVjdGlvbkNsb3NlZEV4Y2VwdGlvbiIgaW4gc3RyKGUpOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkvhur90IG7hu5FpIFdlYlNvY2tldCDEkcOjIMSRw7NuZyBraGkgdOG6oW8gdGFiIG3hu5tpLiBUaOG7rSDEkcOzbmcgdsOgIG3hu58gbOG6oWkgQ2hyb21lLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIiwgImNvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgdOG6oW8gdGFiIG3hu5tpIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OhYyB0YWIgxJFhbmcgbeG7nwogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgdGFicyA9IGJyb3dzZXIubGlzdF90YWIoKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoanNvbi5KU09ORGVjb2RlRXJyb3IsIHJlcXVlc3RzLmV4Y2VwdGlvbnMuSlNPTkRlY29kZUVycm9yKSBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBKU09OIGtoaSBsaeG7h3Qga8OqIHRhYjoge2V9LiBUaOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBDaHJvbWUuIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiLCAiY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4iKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFRo4buxYyBoaeG7h24gbOG6oWkgbOG7h25oIGZvcndhcmQKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuaGVscGVyLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJmb3J3YXJkIiwgInRjcDo5MjIyIiwgImxvY2FsYWJzdHJhY3Q6Y2hyb21lX2RldnRvb2xzX3JlbW90ZSJdCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu60ga+G6v3QgbuG7kWkgbOG6oWkKICAgICAgICAgICAgICAgICAgICAgICAgYnJvd3NlciA9IEJyb3dzZXIoImh0dHA6Ly9sb2NhbGhvc3Q6OTIyMiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYnMgPSBicm93c2VyLmxpc3RfdGFiKCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFTDrG0gdGFiIGdvbGlrZQogICAgICAgICAgICAgICAgICAgIGZvciB0YWIgaW4gdGFiczoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiLnN0YXJ0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYl9pbmZvID0gdGFiLmNhbGxfbWV0aG9kKCJSdW50aW1lLmV2YWx1YXRlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbj0id2luZG93LmxvY2F0aW9uLmhyZWYiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0YWJfaW5mbyBhbmQgInJlc3VsdCIgaW4gdGFiX2luZm8gYW5kICJ2YWx1ZSIgaW4gdGFiX2luZm9bInJlc3VsdCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdXJsID0gdGFiX2luZm9bInJlc3VsdCJdWyJ2YWx1ZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgImFwcC5nb2xpa2UubmV0IiBpbiBjdXJyZW50X3VybDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgdMOsbSB0aOG6pXkgdGFiIEdvTGlrZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvbGlrZV90YWIgPSB0YWIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIldlYlNvY2tldENvbm5lY3Rpb25DbG9zZWRFeGNlcHRpb24iIGluIHN0cihlKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkvhur90IG7hu5FpIFdlYlNvY2tldCDEkcOjIMSRw7NuZyBraGkga2nhu4NtIHRyYSB0YWI6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkga2nhu4NtIHRyYSB0YWI6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnb2xpa2VfdGFiOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiBHb0xpa2UsIHThuqFvIHRhYiBt4bubaS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb2xpa2VfdGFiID0gYnJvd3Nlci5uZXdfdGFiKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb2xpa2VfdGFiLnN0YXJ0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoanNvbi5KU09ORGVjb2RlRXJyb3IsIHJlcXVlc3RzLmV4Y2VwdGlvbnMuSlNPTkRlY29kZUVycm9yKSBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIEpTT04ga2hpIHThuqFvIHRhYiBt4bubaToge2V9LiBUaOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBDaHJvbWUuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiLCAiY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRo4buxYyBoaeG7h24gbOG6oWkgbOG7h25oIGZvcndhcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5oZWxwZXIuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsiZm9yd2FyZCIsICJ0Y3A6OTIyMiIsICJsb2NhbGFic3RyYWN0OmNocm9tZV9kZXZ0b29sc19yZW1vdGUiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSBr4bq/dCBu4buRaSBs4bqhaQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyb3dzZXIgPSBCcm93c2VyKCJodHRwOi8vbG9jYWxob3N0OjkyMjIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvbGlrZV90YWIgPSBicm93c2VyLm5ld190YWIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvbGlrZV90YWIuc3RhcnQoKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiV2ViU29ja2V0Q29ubmVjdGlvbkNsb3NlZEV4Y2VwdGlvbiIgaW4gc3RyKGUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS+G6v3QgbuG7kWkgV2ViU29ja2V0IMSRw6MgxJHDs25nIGtoaSB04bqhbyB0YWIgbeG7m2kuIFRo4butIMSRw7NuZyB2w6AgbeG7nyBs4bqhaSBDaHJvbWUuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiLCAiY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIHThuqFvIHRhYiBt4bubaSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgaWYgIldlYlNvY2tldENvbm5lY3Rpb25DbG9zZWRFeGNlcHRpb24iIGluIHN0cihlKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJL4bq/dCBu4buRaSBXZWJTb2NrZXQgxJHDoyDEkcOzbmcga2hpIGxp4buHdCBrw6ogdGFiLiBUaOG7rSDEkcOzbmcgdsOgIG3hu58gbOG6oWkgQ2hyb21lLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIiwgImNvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkga2nhu4NtIHRyYSBjw6FjIHRhYiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBC4bqtdCB0aGVvIGTDtWkgbeG6oW5nCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGdvbGlrZV90YWIuTmV0d29yay5lbmFibGUoKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBpZiAiV2ViU29ja2V0Q29ubmVjdGlvbkNsb3NlZEV4Y2VwdGlvbiIgaW4gc3RyKGUpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS+G6v3QgbuG7kWkgV2ViU29ja2V0IMSRw6MgxJHDs25nIGtoaSBi4bqtdCB0aGVvIGTDtWkgbeG6oW5nLiBUaOG7rSDEkcOzbmcgdsOgIG3hu58gbOG6oWkgQ2hyb21lLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGLhuq10IHRoZW8gZMO1aSBt4bqhbmciKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCaeG6v24gxJHhu4Mga2nhu4NtIHRyYSB4ZW0gcmVxdWVzdCDEkcOjIMSRxrDhu6NjIGdoaSBuaOG6rW4gY2jGsGEKICAgICAgICAgICAgcmVxdWVzdF9jYXB0dXJlZCA9IEZhbHNlCiAgICAgICAgICAgIGhlYWRlcnMgPSBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQxINuZyBrw70gc+G7sSBraeG7h24gcmVxdWVzdFdpbGxCZVNlbnQKICAgICAgICAgICAgZGVmIHJlcXVlc3RfY2FsbGJhY2soKiprd2FyZ3MpOgogICAgICAgICAgICAgICAgbm9ubG9jYWwgcmVxdWVzdF9jYXB0dXJlZCwgaGVhZGVycwogICAgICAgICAgICAgICAgaWYgcmVxdWVzdF9jYXB0dXJlZDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVxdWVzdCA9IGt3YXJncy5nZXQoInJlcXVlc3QiLCB7fSkKICAgICAgICAgICAgICAgIHVybCA9IHJlcXVlc3QuZ2V0KCJ1cmwiLCAiIikKICAgICAgICAgICAgICAgIG1ldGhvZCA9IHJlcXVlc3QuZ2V0KCJtZXRob2QiLCAiIikKICAgICAgICAgICAgICAgIGlmICJodHRwczovL2dhdGV3YXkuZ29saWtlLm5ldC9hcGkvc3RhdGlzdGljcy9yZXBvcnQiIGluIHVybCBhbmQgbWV0aG9kID09ICJHRVQiOgogICAgICAgICAgICAgICAgICAgIGhlYWRlcnMgPSByZXF1ZXN0LmdldCgiaGVhZGVycyIsIHt9KQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGdoaSBuaOG6rW4gaGVhZGVycyBHb0xpa2UgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0X2NhcHR1cmVkID0gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgZ29saWtlX3RhYi5OZXR3b3JrLnJlcXVlc3RXaWxsQmVTZW50ID0gcmVxdWVzdF9jYWxsYmFjawogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqjaSBs4bqhaSB0cmFuZyDEkeG7gyBnaGkgbmjhuq1uIHJlcXVlc3QKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ29saWtlX3RhYi5jYWxsX21ldGhvZCgiUGFnZS5uYXZpZ2F0ZSIsIHVybD0iaHR0cHM6Ly9hcHAuZ29saWtlLm5ldCIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGlmICJXZWJTb2NrZXRDb25uZWN0aW9uQ2xvc2VkRXhjZXB0aW9uIiBpbiBzdHIoZSk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJL4bq/dCBu4buRaSBXZWJTb2NrZXQgxJHDoyDEkcOzbmcga2hpIHThuqNpIGzhuqFpIHRyYW5nLiBUaOG7rSDEkcOzbmcgdsOgIG3hu58gbOG6oWkgQ2hyb21lLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIHThuqNpIGzhuqFpIHRyYW5nIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhu6NpIDEwIGdpw6J5IMSR4buDIGdoaSBuaOG6rW4gcmVxdWVzdAogICAgICAgICAgICB0aW1lLnNsZWVwKDEwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqvdCB0aGVvIGTDtWkgbeG6oW5nIHbDoCB4w7NhIGxpc3RlbmVyCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGdvbGlrZV90YWIuTmV0d29yay5kaXNhYmxlKCkKICAgICAgICAgICAgICAgIGdvbGlrZV90YWIuTmV0d29yay5yZXF1ZXN0V2lsbEJlU2VudCA9IE5vbmUKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgaWYgIldlYlNvY2tldENvbm5lY3Rpb25DbG9zZWRFeGNlcHRpb24iIGluIHN0cihlKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiS+G6v3QgbuG7kWkgV2ViU29ja2V0IMSRw6MgxJHDs25nIGtoaSB04bqvdCB0aGVvIGTDtWkgbeG6oW5nLiBUaeG6v3AgdOG7pWMgeOG7rSBsw70uIikKICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyByZXR1cm4gdsOsIMSRw6MgY8OzIHRo4buDIGzhuqV5IMSRxrDhu6NjIGhlYWRlcnMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgdOG6r3QgdGhlbyBkw7VpIG3huqFuZzoge3N0cihlKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaGVhZGVyczoKICAgICAgICAgICAgICAgICMgTMawdSBoZWFkZXJzIHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgICAgIHNlbGYuc2F2ZV9nb2xpa2VfaGVhZGVycyhoZWFkZXJzKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgbMawdSBoZWFkZXJzIHbDoG8gZGF0YWJhc2UiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgbOG6pXkgdGjDtG5nIHRpbiB4w6FjIHRo4buxYyBHb0xpa2UsIHZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBpZiAiV2ViU29ja2V0Q29ubmVjdGlvbkNsb3NlZEV4Y2VwdGlvbiIgaW4gc3RyKGUpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJL4bq/dCBu4buRaSBXZWJTb2NrZXQgxJHDoyDEkcOzbmcuIFRo4butIMSRw7NuZyB2w6AgbeG7nyBs4bqhaSBDaHJvbWUuIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIG3hu58gQ2hyb21lIHbDoCBr4bq/dCBu4buRaSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHNhdmVfZ29saWtlX2hlYWRlcnMoc2VsZiwgaGVhZGVyczogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgTMawdSBHb0xpa2UgaGVhZGVycyB2w6BvIGRhdGFiYXNlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgaGVhZGVyczogSGVhZGVycyB04burIHJlcXVlc3QgR29MaWtlCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ2jhu4kgbMawdSB2w6BvIGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyDEkeG7gyDEkeG7k25nIGLhu5kgduG7m2kgc2VydmVyCiAgICAgICAgICAgIHNlbGYuZGIuc2V0X2RldmljZV9jb25maWcoImdvbGlrZV9oZWFkZXJzIiwgaGVhZGVycykKICAgICAgICAgICAgc2VsZi5kYi5zZXRfZGV2aWNlX2NvbmZpZygiZ29saWtlX2hlYWRlcnNfdXBkYXRlZCIsIGludCh0aW1lLnRpbWUoKSkpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGzGsHUgR29MaWtlIGhlYWRlcnM6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgZ2V0X2dvbGlrZV9oZWFkZXJzKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IEdvTGlrZSBoZWFkZXJzIHThu6sgZGF0YWJhc2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogSGVhZGVycyBob+G6t2MgZGljdGlvbmFyeSBy4buXbmcgbuG6v3Uga2jDtG5nIGPDswogICAgICAgICIiIgogICAgICAgICMgQ2jhu4kgbOG6pXkgdOG7qyBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICByZXR1cm4gc2VsZi5kYi5nZXRfZGV2aWNlX2NvbmZpZygiZ29saWtlX2hlYWRlcnMiLCB7fSkKICAgICAgICAKICAgIGRlZiBpc19nb2xpa2VfYXV0aGVudGljYXRlZChzZWxmKSAtPiBib29sOgogICAgICAgICIiIn4KICAgICAgICBLaeG7g20gdHJhIHhlbSDEkcOjIGPDsyB0aMO0bmcgdGluIHjDoWMgdGjhu7FjIEdvTGlrZSBjaMawYQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJHDoyB4w6FjIHRo4buxYywgRmFsc2UgbuG6v3UgY2jGsGEKICAgICAgICAiIiIKICAgICAgICBoZWFkZXJzID0gc2VsZi5nZXRfZ29saWtlX2hlYWRlcnMoKQogICAgICAgICMgS2nhu4NtIHRyYSBjw7MgYXV0aG9yaXphdGlvbiB0cm9uZyBoZWFkZXJzCiAgICAgICAgcmV0dXJuIGJvb2woaGVhZGVycykKICAgIAogICAgZGVmIGZldGNoX2dvbGlrZV9oZWFkZXJzX3dpdGhfcmV0cnkoc2VsZiwgZm9yY2VfcmVmcmVzaDogYm9vbCA9IEZhbHNlKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IEdvTGlrZSBoZWFkZXJzIHbhu5tpIGPGoSBjaOG6vyB0aOG7rSBs4bqhaS4gVGjhu60gbOG6oWkgdOG7kWkgxJFhIDUgbOG6p24gbuG6v3UgdGjhuqV0IGLhuqFpLgogICAgICAgIENo4buJIGzhuqV5IGzhuqFpIGhlYWRlcnMgMSBs4bqnbiBt4buXaSBuZ8OgeSBk4buxYSB2w6BvIHRo4budaSBnaWFuIGPhuq1wIG5o4bqtdCBjdeG7kWkgY8O5bmcuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZm9yY2VfcmVmcmVzaDogTuG6v3UgVHJ1ZSwgc+G6vSBsdcO0biBs4bqleSBs4bqhaSBoZWFkZXJzIGLhuqV0IGvhu4MgdGjhu51pIGdpYW4gY+G6rXAgbmjhuq10IGN14buRaQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRw6MgY8OzIGhlYWRlcnMgaOG7o3AgbOG7hyBob+G6t2MgbOG6pXkgxJHGsOG7o2MgaGVhZGVycyBt4bubaSwgRmFsc2UgbuG6v3Uga2jDtG5nIGzhuqV5IMSRxrDhu6NjCiAgICAgICAgIiIiCiAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIGPDsyB0aMO0bmcgdGluIHjDoWMgdGjhu7FjIEdvTGlrZSBjaMawYQogICAgICAgIGlmIHNlbGYuaXNfZ29saWtlX2F1dGhlbnRpY2F0ZWQoKSBhbmQgbm90IGZvcmNlX3JlZnJlc2g6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0aOG7nWkgZ2lhbiBj4bqtcCBuaOG6rXQgY3Xhu5FpCiAgICAgICAgICAgIGxhc3RfdXBkYXRlID0gc2VsZi5kYi5nZXQoImdvbGlrZV9oZWFkZXJzX3VwZGF0ZWQiLCAwKQogICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IMSRw6MgY+G6rXAgbmjhuq10IHRyb25nIHbDsm5nIDI0IGdp4budIHF1YSwga2jDtG5nIGPhuqduIGzhuqV5IGzhuqFpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfdGltZSAtIGxhc3RfdXBkYXRlIDwgODY0MDA6ICAjIDI0IGdp4budID0gODY0MDAgZ2nDonkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGPDsyB0aMO0bmcgdGluIHjDoWMgdGjhu7FjIEdvTGlrZSB2w6AgY2jGsGEgcXXDoSAyNCBnaeG7nSB04burIGzhuqduIGPhuq1wIG5o4bqtdCBjdeG7kWkiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIHF1w6EgMjQgZ2nhu50gdOG7qyBs4bqnbiBj4bqtcCBuaOG6rXQgY3Xhu5FpLCBz4bq9IGzDoG0gbeG7m2kgaGVhZGVycyBHb0xpa2UiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGZvcmNlX3JlZnJlc2g6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiQuG6r3QgYnXhu5ljIGzDoG0gbeG7m2kgaGVhZGVycyBHb0xpa2UiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkNoxrBhIGPDsyB0aMO0bmcgdGluIHjDoWMgdGjhu7FjIEdvTGlrZSwgc+G6vSBs4bqleSBoZWFkZXJzIG3hu5tpIikKICAgICAgICAKICAgICAgICAjIFRo4buxYyBoaeG7h24gbOG6pXkgaGVhZGVycyB24bubaSBjxqEgY2jhur8gdGjhu60gbOG6oWkKICAgICAgICBtYXhfYXR0ZW1wdHMgPSA1ICAjIFTEg25nIHPhu5EgbOG6p24gdGjhu60gdOG7qyAzIGzDqm4gNQogICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKDEsIG1heF9hdHRlbXB0cyArIDEpOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGzhuqV5IEdvTGlrZSBoZWFkZXJzIChs4bqnbiB0aOG7rSB7YXR0ZW1wdH0ve21heF9hdHRlbXB0c30pLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgVGjhu60gbOG6pXkgaGVhZGVycwogICAgICAgICAgICAgICAgc3VjY2VzcyA9IHNlbGYuZmV0Y2hfZ29saWtlX2hlYWRlcnMoKQogICAgICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBs4bqleSB2w6AgbMawdSBoZWFkZXJzIEdvTGlrZSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHRo4buDIGzhuqV5IGhlYWRlcnMgR29MaWtlIGzhuqduIHthdHRlbXB0fSwgc+G6vSB0aOG7rSBs4bqhaS4uLiIpCiAgICAgICAgICAgICAgICAgICAgIyDEkMOzbmcgQ2hyb21lIG7hur91IGPDsm4gbeG7nwogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X2F0dGVtcHRzOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIHRoZW8gc+G7kSBs4bqnbiB0aOG7rSAoMTBzLCAyMHMsIDMwcywgNDBzKQogICAgICAgICAgICAgICAgICAgICAgICB3YWl0X3RpbWUgPSBhdHRlbXB0ICogMTAKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkOG7o2kge3dhaXRfdGltZX0gZ2nDonkgdHLGsOG7m2Mga2hpIHRo4butIGzhuqFpLi4uIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBs4bqleSBoZWFkZXJzIEdvTGlrZToge2V9IikKICAgICAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIENocm9tZSDEkcaw4bujYyDEkcOzbmcKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCBtYXhfYXR0ZW1wdHM6CiAgICAgICAgICAgICAgICAgICAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSB0aGVvIHPhu5EgbOG6p24gdGjhu60gKDEwcywgMjBzLCAzMHMsIDQwcykKICAgICAgICAgICAgICAgICAgICB3YWl0X3RpbWUgPSBhdHRlbXB0ICogMTAKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQ4bujaSB7d2FpdF90aW1lfSBnacOieSB0csaw4bubYyBraGkgdGjhu60gbOG6oWkuLi4iKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAod2FpdF90aW1lKQogICAgICAgIAogICAgICAgIGxvZ2dlci5lcnJvcihmIsSQw6MgdGjhu60gbOG6pXkgR29MaWtlIGhlYWRlcnMge21heF9hdHRlbXB0c30gbOG6p24gbmjGsG5nIGtow7RuZyB0aMOgbmggY8O0bmciKQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBhcGlfcmVxdWVzdChzZWxmLCB1cmwsIG1ldGhvZD0iR0VUIiwgcGF5bG9hZD1Ob25lKToKICAgICAgICAiIiIKICAgICAgICBH4buNaSBBUEkgY+G7p2EgR29MaWtlIHbhu5tpIGhlYWRlcnMgxJHDoyBsxrB1CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdXJsOiBVUkwgY+G7p2EgQVBJCiAgICAgICAgICAgIG1ldGhvZDogUGjGsMahbmcgdGjhu6ljIEhUVFAgKEdFVCBob+G6t2MgUE9TVCkKICAgICAgICAgICAgcGF5bG9hZDogROG7ryBsaeG7h3UgZ+G7rWkgxJFpIChjaG8gUE9TVCByZXF1ZXN0KQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0IGhv4bq3YyBOb25lOiBL4bq/dCBxdeG6oyBBUEkgbuG6v3UgdGjDoG5oIGPDtG5nLCBOb25lIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBoZWFkZXJzIHThu6sgZGF0YWJhc2UKICAgICAgICAgICAgaGVhZGVycyA9IHNlbGYuZ2V0X2dvbGlrZV9oZWFkZXJzKCkKICAgICAgICAgICAgaWYgbm90IGhlYWRlcnM6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBHb0xpa2UgaGVhZGVycyIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gaGVhZGVycyBjw7MgdXNlci1hZ2VudAogICAgICAgICAgICBpZiAidXNlci1hZ2VudCIgbm90IGluIGhlYWRlcnMgYW5kICJVc2VyLUFnZW50IiBub3QgaW4gaGVhZGVyczoKICAgICAgICAgICAgICAgIGhlYWRlcnNbInVzZXItYWdlbnQiXSA9IHNlbGYudXNlcl9hZ2VudAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgQVBJIGJhc2UgVVJMIHThu6sgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLIGhv4bq3YyBz4butIGThu6VuZyBt4bq3YyDEkeG7i25oIHThu6sgY29uZmlnCiAgICAgICAgICAgIGFwaV9iYXNlID0gc2VsZi5kYi5nZXRfZGV2aWNlX2NvbmZpZygiZ29saWtlX2FwaV9iYXNlIiwgY29uZmlnLkdPTElLRV9BUElfQkFTRSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgVVJMIGtow7RuZyBi4bqvdCDEkeG6p3UgYuG6sW5nIGh0dHAsIHRow6ptIGFwaV9iYXNlIHbDoG8gdHLGsOG7m2MKICAgICAgICAgICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgICAgICAgICB1cmwgPSBmInthcGlfYmFzZX0ve3VybC5sc3RyaXAoJy8nKX0iCgogICAgICAgICAgICAjIFPhu60gZOG7pW5nIGN1cmxfY2ZmaSBob+G6t2MgY2xvdWRzY3JhcGVyIHTDuXkgdGhlbyBtw7RpIHRyxrDhu51uZwogICAgICAgICAgICBpZiBzZWxmLnVzZV9jdXJsX2NmZmkgYW5kIENVUkxfQ0ZGSV9BVkFJTEFCTEU6CiAgICAgICAgICAgICAgICBpZiBtZXRob2QgPT0gIkdFVCI6CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjdXJsX3JlcXVlc3RzLmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGltcGVyc29uYXRlPXNlbGYuaW1wZXJzb25hdGUKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBlbGlmIG1ldGhvZCA9PSAiUE9TVCI6CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjdXJsX3JlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICAgICAganNvbj1wYXlsb2FkLAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGltcGVyc29uYXRlPXNlbGYuaW1wZXJzb25hdGUKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIk1ldGhvZCBraMO0bmcgaOG7o3AgbOG7hzoge21ldGhvZH0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIGNsb3Vkc2NyYXBlciBob+G6t2MgZmFsbGJhY2sgdG8gcmVxdWVzdHMKICAgICAgICAgICAgICAgIGlmIG1ldGhvZCA9PSAiR0VUIjoKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuY2xpZW50LmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBlbGlmIG1ldGhvZCA9PSAiUE9TVCI6CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmNsaWVudC5wb3N0KAogICAgICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb249cGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJNZXRob2Qga2jDtG5nIGjhu6NwIGzhu4c6IHttZXRob2R9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBoaeG7g24gdGjhu4sgbOG7l2kgZOG7hSDEkeG7jWMgaMahbgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gcmVzcG9uc2UudGV4dAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgUGFyc2UgcmVzcG9uc2UgbMOgIEpTT04KICAgICAgICAgICAgICAgICAgICBlcnJvcl9qc29uID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgICAgICAgICAgIyBGb3JtYXQgbG9nIHRow6BuaCAxIGTDsm5nCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gZXJyb3JfanNvbi5nZXQoJ3N0YXR1cycsIHJlc3BvbnNlLnN0YXR1c19jb2RlKQogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBlcnJvcl9qc29uLmdldCgnc3VjY2VzcycsIEZhbHNlKQogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBlcnJvcl9qc29uLmdldCgnbWVzc2FnZScsICdLaMO0bmcgY8OzIHRow7RuZyBiw6FvIGzhu5dpJykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEfhu5lwIHRow6BuaCAxIGTDsm5nCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiQVBJIHRy4bqjIHbhu4EgbOG7l2kgW3tzdGF0dXN9XSBbc3VjY2Vzczoge3N1Y2Nlc3N9XSB7bWVzc2FnZX0iKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHBo4bqjaSBKU09OLCBoaeG7g24gdGjhu4sgdGV4dCB0aMO0CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiQVBJIHRy4bqjIHbhu4EgbOG7l2kge3Jlc3BvbnNlLnN0YXR1c19jb2RlfToge2Vycm9yX21zZ30iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7jWkgQVBJOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIF9jdXJsX2NmZmlfcmVxdWVzdChzZWxmLCB1cmw6IHN0ciwgbWV0aG9kOiBzdHIgPSAiZ2V0IiwgaGVhZGVyczogRGljdFtzdHIsIHN0cl0gPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUsIHRpbWVvdXQ6IGludCA9IDMwKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiByZXF1ZXN0IHPhu60gZOG7pW5nIGN1cmxfY2ZmaSAoaGnhu4d1IHF14bqjIGNobyBDbG91ZGZsYXJlKQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbWV0aG9kLmxvd2VyKCkgPT0gImdldCI6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGN1cmxfcmVxdWVzdHMuZ2V0KAogICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgZGF0YT1kYXRhLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dCwKICAgICAgICAgICAgICAgICAgICBpbXBlcnNvbmF0ZT0iY2hyb21lMTEwIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbHNlOiAgIyBQT1NUCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGN1cmxfcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgIGRhdGE9ZGF0YSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQsCiAgICAgICAgICAgICAgICAgICAgaW1wZXJzb25hdGU9ImNocm9tZTExMCIKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHN0YXR1cyBjb2RlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7jWkgQVBJOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgZGVmIGZldGNoX2dvbGlrZV9yZXBvcnQoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgdOG7qyBHb0xpa2UgdsOgIHThu5VuZyBo4bujcCBs4bqhaQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBUaMO0bmcgdGluIHJlcG9ydCDEkcOjIHThu5VuZyBo4bujcCBob+G6t2MgZGljdCBy4buXbmcgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEfhu41pIEFQSSByZXBvcnQKICAgICAgICAgICAgcmVwb3J0X2RhdGEgPSBzZWxmLmFwaV9yZXF1ZXN0KCJzdGF0aXN0aWNzL3JlcG9ydCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcmVwb3J0X2RhdGEgb3IgInN1Y2Nlc3MiIG5vdCBpbiByZXBvcnRfZGF0YSBvciBub3QgcmVwb3J0X2RhdGFbInN1Y2Nlc3MiXToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IHThu6sgR29MaWtlIikKICAgICAgICAgICAgICAgIHJldHVybiB7fQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG7lW5nIGjhu6NwIHRow7RuZyB0aW4KICAgICAgICAgICAgY3VycmVudF9jb2luID0gcmVwb3J0X2RhdGEuZ2V0KCJjdXJyZW50X2NvaW4iLCAwKQogICAgICAgICAgICBtZXNzYWdlID0gcmVwb3J0X2RhdGEuZ2V0KCJtZXNzYWdlIiwgIiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrW5oIHThu5VuZyBwZW5kaW5nX2NvaW4gdsOgIGhvbGRfY29pbiB04burIGPDoWMgYXBwIHF1YW4gdMOibQogICAgICAgICAgICBhcHBzID0gWyJpbnN0YWdyYW0iLCAidGlrdG9rIiwgInNuYXBjaGF0Il0KICAgICAgICAgICAgdG90YWxfcGVuZGluZ19jb2luID0gMAogICAgICAgICAgICB0b3RhbF9ob2xkX2NvaW4gPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgYXBwIGluIGFwcHM6CiAgICAgICAgICAgICAgICBpZiBhcHAgaW4gcmVwb3J0X2RhdGE6CiAgICAgICAgICAgICAgICAgICAgYXBwX2RhdGEgPSByZXBvcnRfZGF0YVthcHBdCiAgICAgICAgICAgICAgICAgICAgdG90YWxfcGVuZGluZ19jb2luICs9IGFwcF9kYXRhLmdldCgicGVuZGluZ19jb2luIiwgMCkKICAgICAgICAgICAgICAgICAgICB0b3RhbF9ob2xkX2NvaW4gKz0gYXBwX2RhdGEuZ2V0KCJob2xkX2NvaW4iLCAwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBkaWN0IGvhur90IHF14bqjIHThu5VuZyBo4bujcAogICAgICAgICAgICBzdW1tYXJ5ID0gewogICAgICAgICAgICAgICAgImN1cnJlbnRfY29pbiI6IGN1cnJlbnRfY29pbiwKICAgICAgICAgICAgICAgICJ0b3RhbF9wZW5kaW5nX2NvaW4iOiB0b3RhbF9wZW5kaW5nX2NvaW4sCiAgICAgICAgICAgICAgICAidG90YWxfaG9sZF9jb2luIjogdG90YWxfaG9sZF9jb2luLAogICAgICAgICAgICAgICAgImdvbGlrZV9yZXBvcnRfbWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICAgICAiZ29saWtlX3JlcG9ydF91cGRhdGVkX2F0IjogaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICBzZWxmLmRiLnNldCgiZ29saWtlX3JlcG9ydCIsIHN1bW1hcnkpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiBHb0xpa2UgcmVwb3J0OiB4dSBoaeG7h24gdOG6oWk9e2N1cnJlbnRfY29pbn0sIHh1IMSRYW5nIGNo4budPXt0b3RhbF9wZW5kaW5nX2NvaW59LCB4dSBnaeG7rz17dG90YWxfaG9sZF9jb2lufSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc3VtbWFyeQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IHThu6sgR29MaWtlOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgCiAgICBkZWYgc3RhcnRfcmVwb3J0X3RocmVhZChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgxJHhu5luZyB0aHJlYWQgxJHhu4tuaCBr4buzIGzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IHThu6sgR29MaWtlCiAgICAgICAgIiIiCiAgICAgICAgIyBLaeG7g20gdHJhIHRocmVhZCDEkcOjIGNo4bqheSBjaMawYQogICAgICAgIGlmIHNlbGYucmVwb3J0X3RocmVhZCBpcyBub3QgTm9uZSBhbmQgc2VsZi5yZXBvcnRfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJUaHJlYWQgcmVwb3J0IEdvTGlrZSDEkcOjIMSRYW5nIGNo4bqheSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBpbXBvcnQgdGhyZWFkaW5nCiAgICAgICAgCiAgICAgICAgZGVmIHJlcG9ydF9sb29wKCk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJC4bqvdCDEkeG6p3UgdGhyZWFkIGzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IEdvTGlrZSDEkeG7i25oIGvhu7MiKQogICAgICAgICAgICAKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6MgY8OzIGhlYWRlcnMgY2jGsGEKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2dvbGlrZV9hdXRoZW50aWNhdGVkKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgTOG6pXkgdGjDtG5nIHRpbiByZXBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5mZXRjaF9nb2xpa2VfcmVwb3J0KCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ2jGsGEgY8OzIGhlYWRlcnMgR29MaWtlLCBraMO0bmcgdGjhu4MgbOG6pXkgdGjDtG5nIHRpbiByZXBvcnQiKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB0cm9uZyB0aHJlYWQgcmVwb3J0IEdvTGlrZToge2V9IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmfhu6cgMTAgcGjDunQKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoNjAwKQogICAgICAgIAogICAgICAgICMgVOG6oW8gdsOgIGto4bufaSDEkeG7mW5nIHRocmVhZAogICAgICAgIHNlbGYucmVwb3J0X3RocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PXJlcG9ydF9sb29wLCBkYWVtb249VHJ1ZSkKICAgICAgICBzZWxmLnJlcG9ydF90aHJlYWQuc3RhcnQoKQogICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGto4bufaSDEkeG7mW5nIHRocmVhZCBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCBHb0xpa2UgxJHhu4tuaCBr4buzIikKCiAgICBkZWYgZ2V0X2dvbGlrZV9yZXBvcnQoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgR29MaWtlIMSRw6MgbMawdSB0cm9uZyBkYXRhYmFzZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBUaMO0bmcgdGluIHJlcG9ydCBob+G6t2MgZGljdCBy4buXbmcgbuG6v3Uga2jDtG5nIGPDswogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLmRiLmdldCgiZ29saWtlX3JlcG9ydCIsIHt9KQo=').decode('utf-8'))
