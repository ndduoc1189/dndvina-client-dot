import base64
exec(base64.b64decode('aW1wb3J0IGRhdGV0aW1lCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IHJlCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIExpc3QsIE9wdGlvbmFsCmZyb20gam9icy5qb2JfYmFzZSBpbXBvcnQgQmFzZUpvYgoKY2xhc3MgVGlrdG9rSm9iKEJhc2VKb2IpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZSkKICAgICAgICBzZWxmLmFwcF9wYWNrYWdlID0gImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbCIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gInRpa3RvayIKICAgICAgICAKICAgIGRlZiBnZXRfYWNjb3VudHNfZnJvbV9kZXZpY2Uoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gVGlrdG9rIHThu6sgdGhp4bq/dCBi4buLIiIiCiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBN4bufIOG7qW5nIGThu6VuZyBUaWtUb2sKICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2jhu50gbcOgbiBow6xuaCBjaMOtbmggdOG6o2kgLSBraeG7g20gdHJhIGNobyDEkeG6v24ga2hpIGPDsyAiVHJhbmcgY2jhu6ciIGhv4bq3YyB04buRaSDEkWEgMjBzCiAgICAgICAgICAgIGhvbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudChjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIiwgdGltZW91dD0yMCkKICAgICAgICAgICAgaWYgbm90IGhvbWVfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB04bqjaSBtw6BuIGjDrG5oIGNow61uaCBUaWtUb2sgc2F1IDIwIGdpw6J5IikKICAgICAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBuw7p0ICJI4buTIHPGoSIgdsOgIG5o4bqlcCB2w6BvCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9uYXZpZ2F0ZV90b19wcm9maWxlX3RhYigpOgogICAgICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIG1lbnUgaOG7kyBzxqEgxJHhu4MgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAgICAgaWYgbm90IHNlbGYuX29wZW5fcHJvZmlsZV9tZW51KCk6CiAgICAgICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgWE1MIG3DoG4gaMOsbmggc2F1IGtoaSBt4bufIG1lbnUKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gbsO6dCAiVGjDqm0gdMOgaSBraG/huqNuIgogICAgICAgICAgICBhZGRfYWNjb3VudF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVGjDqm0gdMOgaSBraG/huqNuIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGFkZF9hY2NvdW50X2J1dHRvbjoKICAgICAgICAgICAgICAgICMgVMOsbSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiAoUmVjeWNsZXJWaWV3KSAtIGzDoCBjaGEgY+G7p2EgbsO6dCAiVGjDqm0gdMOgaSBraG/huqNuIgogICAgICAgICAgICAgICAgcmVjeWNsZXJfdmlldyA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgUmVjeWNsZXJWaWV3CiAgICAgICAgICAgICAgICBhbGxfcmVjeWNsZXJfdmlld3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZHgucmVjeWNsZXJ2aWV3LndpZGdldC5SZWN5Y2xlclZpZXciCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBSZWN5Y2xlclZpZXcgY2jhu6lhIGPDoWMgdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBmb3IgcnYgaW4gYWxsX3JlY3ljbGVyX3ZpZXdzOgogICAgICAgICAgICAgICAgICAgIHJ2X2JvdW5kcyA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X2JvdW5kcyhydikKICAgICAgICAgICAgICAgICAgICBhZGRfYWNjb3VudF9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoYWRkX2FjY291bnRfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gYWRkX2FjY291bnRfYnV0dG9uIGPDsyBu4bqxbSB0cm9uZyByZWN5Y2xlcl92aWV3IGtow7RuZwogICAgICAgICAgICAgICAgICAgIGlmIChydl9ib3VuZHNbMF0gPD0gYWRkX2FjY291bnRfYm91bmRzWzBdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICBydl9ib3VuZHNbMV0gPD0gYWRkX2FjY291bnRfYm91bmRzWzFdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICBydl9ib3VuZHNbMl0gPj0gYWRkX2FjY291bnRfYm91bmRzWzJdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICBydl9ib3VuZHNbM10gPj0gYWRkX2FjY291bnRfYm91bmRzWzNdKToKICAgICAgICAgICAgICAgICAgICAgICAgcmVjeWNsZXJfdmlldyA9IHJ2CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHJlY3ljbGVyX3ZpZXc6CiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgbsO6dCAoQnV0dG9uKSB0cm9uZyBSZWN5Y2xlclZpZXcgYuG6sW5nIGNsYXNzIHRoYXkgdsOsIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9idXR0b25zID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGZvciBidXR0b24gaW4gYWNjb3VudF9idXR0b25zOgogICAgICAgICAgICAgICAgICAgICAgICAjIELhu48gcXVhIG7DunQgIlRow6ptIHTDoGkga2hv4bqjbiIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnV0dG9uLmdldCgiY29udGVudC1kZXNjIikgPT0gIlRow6ptIHTDoGkga2hv4bqjbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBM4bqleSB0w6puIHTDoGkga2hv4bqjbiB04burIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGJ1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gVGV4dFZpZXcgdHJvbmcgYnV0dG9uIGLhurFuZyBjbGFzcyB0aGF5IHbDrCByZXNvdXJjZS1pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dHZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuVGV4dFZpZXciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTOG7jWMgdGV4dHZpZXcgdGhlbyBib3VuZHMgxJHhu4MgdMOsbSDEkcO6bmcgY8OhaSB0aHXhu5ljIHbhu4EgYnV0dG9uIG7DoHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbl9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHR2IGluIHRleHR2aWV3czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dl9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHModHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR2X2JvdW5kc1swXSA+PSBidXR0b25fYm91bmRzWzBdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dl9ib3VuZHNbMV0gPj0gYnV0dG9uX2JvdW5kc1sxXSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHZfYm91bmRzWzJdIDw9IGJ1dHRvbl9ib3VuZHNbMl0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR2X2JvdW5kc1szXSA8PSBidXR0b25fYm91bmRzWzNdKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSDEkeG7gyBraMO0bmcgbOG6pXkgcGjhuqNpIHRleHQgcuG7l25nIGhv4bq3YyAibnVsbCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGV4dCBhbmQgdGV4dCAhPSAibnVsbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIELhu48gcXVhIG7DunQgIsSQw7NuZyIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUgPT0gIsSQw7NuZyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSB0w6BpIGtob+G6o24gY8OzIMSRYW5nIMSRxINuZyBuaOG6rXAga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlzX2N1cnJlbnQgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGThuqV1IGtp4buDbSB0cm9uZyBidXR0b24gYuG6sW5nIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgICAgICAgICBjaGVja21hcmtzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYz0iROG6pXUga2nhu4NtIgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGThuqV1IGtp4buDbSBjw7MgdGh14buZYyB24buBIGJ1dHRvbiBuw6B5IGtow7RuZwogICAgICAgICAgICAgICAgICAgICAgICBidXR0b25fYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGNoZWNrIGluIGNoZWNrbWFya3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoY2hlY2spCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tfYm91bmRzWzBdID49IGJ1dHRvbl9ib3VuZHNbMF0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfYm91bmRzWzFdID49IGJ1dHRvbl9ib3VuZHNbMV0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfYm91bmRzWzJdIDw9IGJ1dHRvbl9ib3VuZHNbMl0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfYm91bmRzWzNdIDw9IGJ1dHRvbl9ib3VuZHNbM10pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2N1cnJlbnQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ8WpbmcgY8OzIHRo4buDIGtp4buDbSB0cmEgdGh14buZYyB0w61uaCBzZWxlY3RlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBidXR0b24uZ2V0KCJzZWxlY3RlZCIpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2N1cnJlbnQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdXNlcm5hbWUgaOG7o3AgbOG7hyB0csaw4bubYyBraGkgdGjDqm0gdsOgbyBkYW5oIHPDoWNoCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lIGFuZCB1c2VybmFtZSAhPSAibnVsbCIgYW5kIHVzZXJuYW1lLnN0cmlwKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEzhu41jIHRow6ptIGPDoWMgdMOqbiBraMO0bmcgcGjhuqNpIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUgbm90IGluIFsiQ8OgaSDEkeG6t3QiLCAiQ8OgaSDEkeG6t3QgdMOgaSBraG/huqNuIiwgIlTDuXkgY2jhu41uIiwgIk1lbnUiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmlja25hbWUiOiB1c2VybmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV91c2VybmFtZSI6IHVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogdXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiYWN0aXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzX2xvZ2luIjogaXNfY3VycmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2VuYWJsZSI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsZXZlbCI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKGFjY291bnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUXVheSBs4bqhaSBtw6BuIGjDrG5oIGNow61uaAogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gVGlrVG9rIikKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGFjY291bnRzCiAgICAKICAgIGRlZiBwZXJmb3JtX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSk6CiAgICAgICAgIiIiVGjhu7FjIGhp4buHbiBjw7RuZyB2aeG7h2MgduG7m2kgdMOgaSBraG/huqNuIFRpa1RvayIiIgogICAgICAgICMgU+G7rSBk4bulbmcgcGjGsMahbmcgdGjhu6ljIGPhu6dhIGzhu5twIGNoYQogICAgICAgIHN1cGVyKCkucGVyZm9ybV9qb2IoYWNjb3VudCkKICAgICAgICAKICAgIGRlZiBwZXJmb3JtX2NhcmUoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIgogICAgICAgIE51w7RpIHTDoGkga2hv4bqjbiBUaWtUb2sgLSBMZWdhY3kgbWV0aG9kLCBz4butIGThu6VuZyBTbWFydCBDYXJlIG3hu5tpCiAgICAgICAgQmFja3dhcmQgY29tcGF0aWJpbGl0eTogY2h1eeG7g24gaMaw4bubbmcgc2FuZyBTbWFydCBDYXJlIG1ldGhvZHMKICAgICAgICAiIiIKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgbnXDtGkgdMOgaSBraG/huqNuIFRpa1Rvazoge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSAobGVnYWN5IG1ldGhvZCkiKQogICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgU21hcnQgQ2FyZSBtZXRob2QgdGhheSB2w6wgbWluaSBjYXJlIGPFqQogICAgICAgIGltcG9ydCByYW5kb20KICAgICAgICBjYXJlX21ldGhvZHMgPSBbIl9jYXJlX3N3aXBlX2ZlZWQiLCAiX2NhcmVfd2F0Y2hfdmlkZW9zIl0KICAgICAgICBzZWxlY3RlZF9tZXRob2QgPSByYW5kb20uY2hvaWNlKGNhcmVfbWV0aG9kcykKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIG1ldGhvZCA9IGdldGF0dHIoc2VsZiwgc2VsZWN0ZWRfbWV0aG9kKQogICAgICAgICAgICBzdWNjZXNzID0gbWV0aG9kKGFjY291bnQpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJMZWdhY3kgY2FyZSB1c2luZyB7c2VsZWN0ZWRfbWV0aG9kfTogeydzdWNjZXNzJyBpZiBzdWNjZXNzIGVsc2UgJ2ZhaWxlZCd9IikKICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTGVnYWN5IGNhcmUgZXJyb3I6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIHBlcmZvcm1fbWluaV9jYXJlKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gbWluaSBjYXJlIGNobyB0w6BpIGtob+G6o24gVGlrVG9rOgogICAgICAgIDEuIFbhu4EgdHJhbmcgY2jhu6csIHjDoWMgbmjhuq1uIHRhYiDEkeG7gSB4deG6pXQKICAgICAgICAyLiBMxrDhu5t0IMSR4buBIHh14bqldCB0cm9uZyAyLTMgcGjDunQKICAgICAgICAzLiBOZ+G6q3Ugbmhpw6puIGLhuqVtIHbDoG8gSOG7mXAgdGjGsCwgZOG7q25nIDItNXMsIHZ14buRdCBsw6puLCBxdWF5IGzhuqFpIHRyYW5nIGNo4bunCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSBtaW5pIGNhcmUgY2hvIHTDoGkga2hv4bqjbiBUaWtUb2s6IHthY2NvdW50Wyd1bmlxdWVfdXNlcm5hbWUnXX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAxLiDEkOG6o20gYuG6o28gduG7gSB0cmFuZyBjaOG7pyB2w6AgeMOhYyBuaOG6rW4gdGFiIMSR4buBIHh14bqldAogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgduG7gSB0cmFuZyBjaOG7pyBUaWtUb2siKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHbDoCBjbGljayB2w6BvIHRhYiAiRMOgbmggY2hvIGLhuqFuIiAodGFiIMSR4buBIHh14bqldCkKICAgICAgICAgICAgZm9yX3lvdV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iRMOgbmggY2hvIGLhuqFuIikKICAgICAgICAgICAgaWYgbm90IGZvcl95b3VfdGFiOgogICAgICAgICAgICAgICAgZm9yX3lvdV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJEw6BuaCBjaG8gYuG6oW4iKQogICAgICAgICAgICBpZiBub3QgZm9yX3lvdV90YWI6CiAgICAgICAgICAgICAgICBmb3JfeW91X3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJGb3IgWW91IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiBmb3JfeW91X3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlTDrG0gdGjhuqV5IHRhYiDEkeG7gSB4deG6pXQsIMSRYW5nIGNsaWNrIHbDoG8uLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGZvcl95b3VfdGFiKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIMSR4buBIHh14bqldCwgZ2nhuqMgxJHhu4tuaCDEkWFuZyDhu58gdGFiIMSRw7puZyIpCgogICAgICAgICAgICAjIDIuIEzGsOG7m3QgxJHhu4EgeHXhuqV0IHRyb25nIDEtMyBwaMO6dAogICAgICAgICAgICBzY3JvbGxfZHVyYXRpb24gPSByYW5kb20ucmFuZGludCg2MCwgMTgwKSAgIyAxLTMgcGjDunQKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSBsxrDhu5t0IMSR4buBIHh14bqldCB0cm9uZyB7c2Nyb2xsX2R1cmF0aW9ufSBnacOieS4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgdmlkZW9fY291bnQgPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSAodGltZS50aW1lKCkgLSBzdGFydF90aW1lKSA8IHNjcm9sbF9kdXJhdGlvbjoKICAgICAgICAgICAgICAgICMgTMaw4bubdCBsw6puIMSR4buDIGNodXnhu4NuIHZpZGVvIHRp4bq/cCB0aGVvCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICB2aWRlb19jb3VudCArPSAxCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmdo4buJIG5n4bqrdSBuaGnDqm4gMy04IGdpw6J5IGdp4buvYSBjw6FjIHZpZGVvIChuaMawIG5nxrDhu51pIGTDuW5nIHRo4bqtdCkKICAgICAgICAgICAgICAgIHdhdGNoX3RpbWUgPSByYW5kb20ucmFuZGludCgzLCA4KQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhdGNoX3RpbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUmFuZG9tIGPDsyAxMCUga2jhuqMgbsSDbmcgYuG6pW0gbGlrZSB2aWRlbwogICAgICAgICAgICAgICAgaWYgcmFuZG9tLnJhbmRvbSgpIDwgMC4xOiAgIyAxMCUgY2hhbmNlCiAgICAgICAgICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLl9maW5kX2xpa2VfYnV0dG9uKCkKICAgICAgICAgICAgICAgICAgICBpZiBsaWtlX2J1dHRvbiBhbmQgbm90IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b24pOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJSYW5kb20gbGlrZSB2aWRlbyB0cm9uZyBraGkgbWluaSBjYXJlIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGxpa2VfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBSYW5kb20gY8OzIDUlIGto4bqjIG7Eg25nIGLhuqVtIHNoYXJlCiAgICAgICAgICAgICAgICBpZiByYW5kb20ucmFuZG9tKCkgPCAwLjA1OiAgIyA1JSBjaGFuY2UKICAgICAgICAgICAgICAgICAgICBzaGFyZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJDaGlhIHPhursiKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzaGFyZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlNoYXJlIikKICAgICAgICAgICAgICAgICAgICBpZiBzaGFyZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlJhbmRvbSBjbGljayBzaGFyZSB0cm9uZyBraGkgbWluaSBjYXJlIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNoYXJlX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICMgTmjhuqVuIGJhY2sgxJHhu4MgxJHDs25nIGRpYWxvZyBzaGFyZQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBsxrDhu5t0IHt2aWRlb19jb3VudH0gdmlkZW8gdHJvbmcge3Njcm9sbF9kdXJhdGlvbn0gZ2nDonkiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAzLiBOZ+G6q3Ugbmhpw6puIGLhuqVtIHbDoG8gSOG7mXAgdGjGsCAoNTAlIGto4bqjIG7Eg25nKQogICAgICAgICAgICBpZiByYW5kb20ucmFuZG9tKCkgPCAwLjU6ICAjIDUwJSBjaGFuY2UKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlJhbmRvbSB0cnV5IGPhuq1wIEjhu5lwIHRoxrAuLi4iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gdsOgIGNsaWNrIHbDoG8gSOG7mXAgdGjGsAogICAgICAgICAgICAgICAgaW5ib3hfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iSOG7mXAgdGjGsCIpCiAgICAgICAgICAgICAgICBpZiBpbmJveF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgSOG7mXAgdGjGsCwgxJFhbmcgY2xpY2sgdsOgby4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGluYm94X2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEThu6tuZyBs4bqhaSAyLTUgZ2nDonkKICAgICAgICAgICAgICAgICAgICB3YWl0X3RpbWUgPSByYW5kb20ucmFuZGludCgyLCA1KQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJE4burbmcgbOG6oWkge3dhaXRfdGltZX0gZ2nDonkgdHJvbmcgSOG7mXAgdGjGsC4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhaXRfdGltZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFZ14buRdCBsw6puIHRyb25nIEjhu5lwIHRoxrAKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJWdeG7kXQgbMOqbiB0cm9uZyBI4buZcCB0aMawLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBRdWF5IGzhuqFpIHRyYW5nIGNo4bunCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiUXVheSBs4bqhaSB0cmFuZyBjaOG7pyB04burIEjhu5lwIHRoxrAuLi4iKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmJhY2tfdG9faG9tZSgpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgcXVheSB24buBIHRyYW5nIGNo4bunIHThu6sgSOG7mXAgdGjGsCIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IEjhu5lwIHRoxrAiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiU2tpcCB0cnV5IGPhuq1wIEjhu5lwIHRoxrAgbOG6p24gbsOgeSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyB24buBIHRyYW5nIGNo4bunIGN14buRaSBjw7luZwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyDEkeG6o20gYuG6o28gduG7gSB0cmFuZyBjaOG7pyBzYXUgbWluaSBjYXJlIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiSG/DoG4gdGjDoG5oIG1pbmkgY2FyZSBjaG8gdMOgaSBraG/huqNuIFRpa1Rvazoge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gbWluaSBjYXJlIGNobyB0w6BpIGtob+G6o24gVGlrVG9rOiB7YWNjb3VudFsndW5pcXVlX3VzZXJuYW1lJ119IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G7kSBn4bqvbmcgduG7gSB0cmFuZyBjaOG7pyBu4bq/dSBjw7MgbOG7l2kKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfZW5zdXJlX2Zvcl95b3VfdGFiKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0YWIgxJHhu4EgeHXhuqV0IChGb3IgWW91KQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVMOsbSB0YWIgIkTDoG5oIGNobyBi4bqhbiIgaG/hurdjICJGb3IgWW91IgogICAgICAgICAgICBmb3JfeW91X3RleHRzID0gWyJEw6BuaCBjaG8gYuG6oW4iLCAiRm9yIFlvdSIsICLEkOG7gSB4deG6pXQiXQogICAgICAgICAgICBmb3JfeW91X3RhYiA9IE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciB0ZXh0IGluIGZvcl95b3VfdGV4dHM6CiAgICAgICAgICAgICAgICBmb3JfeW91X3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICBpZiBmb3JfeW91X3RhYjoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGZvcl95b3VfdGFiOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRoZW8gY29udGVudC1kZXNjCiAgICAgICAgICAgICAgICBmb3IgZGVzYyBpbiBmb3JfeW91X3RleHRzOgogICAgICAgICAgICAgICAgICAgIGZvcl95b3VfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz1kZXNjKQogICAgICAgICAgICAgICAgICAgIGlmIGZvcl95b3VfdGFiOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZm9yX3lvdV90YWI6CiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHRhYiBjw7MgxJHGsOG7o2MgY2jhu41uIGtow7RuZwogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQoZm9yX3lvdV90YWIpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRhYiDEkeG7gSB4deG6pXQgY2jGsGEgxJHGsOG7o2MgY2jhu41uLCDEkWFuZyBjbGljayB2w6BvLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZm9yX3lvdV90YWIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgeMOhYyBuaOG6rW4gdGFiIMSR4buBIHh14bqldCIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiDEkeG7gSB4deG6pXQiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIHjDoWMgbmjhuq1uIHRhYiDEkeG7gSB4deG6pXQiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9zY3JvbGxfZm9yX3lvdV9mZWVkKHNlbGYsIGR1cmF0aW9uX3NlY29uZHM6IGludCkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBMxrDhu5t0IGZlZWQgxJHhu4EgeHXhuqV0IHRyb25nIGtob+G6o25nIHRo4budaSBnaWFuIG5o4bqldCDEkeG7i25oCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZHVyYXRpb25fc2Vjb25kczogVGjhu51pIGdpYW4gbMaw4bubdCAoZ2nDonkpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICBzY3JvbGxfY291bnQgPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCBkdXJhdGlvbl9zZWNvbmRzOgogICAgICAgICAgICAgICAgIyBWdeG7kXQgbMOqbiDEkeG7gyBjaHV54buDbiB2aWRlbyB0aeG6v3AgdGhlbwogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2Nyb2xsX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOZ2jhu4kgbmfhuqt1IG5oacOqbiAyLTYgZ2nDonkgbmjGsCBuZ8aw4budaSBkw7luZyB0aOG6rXQgeGVtIHZpZGVvCiAgICAgICAgICAgICAgICB3YXRjaF90aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgNikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YXRjaF90aW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFJhbmRvbSB0aOG7iW5oIHRob+G6o25nIGThu6tuZyBsw6J1IGjGoW4gKG5oxrAgxJFhbmcgeGVtIHZpZGVvIHRow7ogduG7iykKICAgICAgICAgICAgICAgIGlmIHJhbmRvbS5yYW5kaW50KDEsIDEwKSA9PSAxOiAgIyAxMCUgeMOhYyBzdeG6pXQKICAgICAgICAgICAgICAgICAgICBsb25nX3dhdGNoX3RpbWUgPSByYW5kb20ucmFuZGludCg4LCAxNSkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiROG7q25nIHhlbSB2aWRlbyBsw6J1IGjGoW46IHtsb25nX3dhdGNoX3RpbWV9cyIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKGxvbmdfd2F0Y2hfdGltZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMb2cgdGnhur9uIHRyw6xuaCBt4buXaSAzMCBnacOieQogICAgICAgICAgICAgICAgZWxhcHNlZCA9IHRpbWUudGltZSgpIC0gc3RhcnRfdGltZQogICAgICAgICAgICAgICAgaWYgZWxhcHNlZCA+IDAgYW5kIGludChlbGFwc2VkKSAlIDMwID09IDAgYW5kIHNjcm9sbF9jb3VudCA+IDA6CiAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nID0gZHVyYXRpb25fc2Vjb25kcyAtIGVsYXBzZWQKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBsxrDhu5t0IHtzY3JvbGxfY291bnR9IHZpZGVvLCBjw7JuIGzhuqFpIHtpbnQocmVtYWluaW5nKX1zIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJIb8OgbiB0aMOgbmggbMaw4bubdCDEkeG7gSB4deG6pXQ6IHtzY3JvbGxfY291bnR9IHZpZGVvIHRyb25nIHtkdXJhdGlvbl9zZWNvbmRzfXMiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGzGsOG7m3QgZmVlZCDEkeG7gSB4deG6pXQiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9pbnRlcmFjdF93aXRoX2luYm94KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVMawxqFuZyB0w6FjIHbhu5tpIEjhu5lwIHRoxrA6IGLhuqVtIHbDoG8sIGThu6tuZyAyLTVzLCB2deG7kXQgbMOqbgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVMOsbSBuw7p0IEjhu5lwIHRoxrAKICAgICAgICAgICAgaW5ib3hfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iSOG7mXAgdGjGsCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgaW5ib3hfYnV0dG9uOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRoZW8gdGV4dAogICAgICAgICAgICAgICAgaW5ib3hfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9Ikjhu5lwIHRoxrAiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGluYm94X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IEjhu5lwIHRoxrAiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENsaWNrIHbDoG8gSOG7mXAgdGjGsAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkGFuZyBjbGljayB2w6BvIEjhu5lwIHRoxrAiKQogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaW5ib3hfYnV0dG9uKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBE4burbmcgbOG6oWkgMi01IGdpw6J5CiAgICAgICAgICAgIHdhaXRfdGltZSA9IHJhbmRvbS5yYW5kaW50KDIsIDUpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJE4burbmcgdHJvbmcgSOG7mXAgdGjGsCB7d2FpdF90aW1lfXMiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBWdeG7kXQgbMOqbiB0cm9uZyBI4buZcCB0aMawCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlZ14buRdCBsw6puIHRyb25nIEjhu5lwIHRoxrAiKQogICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSB0aGFvIHTDoWMgdnXhu5F0IGzDqm4gdGjDqm0gMS0yIGzhuqduIG7hu69hCiAgICAgICAgICAgIGFkZGl0aW9uYWxfc3dpcGVzID0gcmFuZG9tLnJhbmRpbnQoMSwgMikKICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoYWRkaXRpb25hbF9zd2lwZXMpOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDAuNSwgMS41KSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkhvw6BuIHRow6BuaCB0xrDGoW5nIHTDoWMgduG7m2kgSOG7mXAgdGjGsCIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgdMawxqFuZyB0w6FjIHbhu5tpIEjhu5lwIHRoxrAiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZ2V0X2F2YWlsYWJsZV9qb2JzKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBkYW5oIHPDoWNoIGPDoWMgam9iIGto4bqjIGThu6VuZyB04burIEdvTGlrZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGpvYiBob+G6t2MgbGlzdCBy4buXbmcgbuG6v3Uga2jDtG5nIGPDswogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBzZWxmLmdvbGlrZV9zZXJ2aWNlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGzhuqV5IGpvYjogR29MaWtlU2VydmljZSBjaMawYSDEkcaw4bujYyBjdW5nIGPhuqVwIikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBH4buNaSBBUEkgbOG6pXkgam9iCiAgICAgICAgICAgIGpvYl91cmwgPSBzZWxmLmdldF9qb2JzX3VybCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHRoYW0gc+G7kQogICAgICAgICAgICBwYXJhbXMgPSBzZWxmLmdldF9qb2JfcGFyYW1zKGFjY291bnQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSQogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuYXBpX3JlcXVlc3Qoam9iX3VybCwgIkdFVCIsIHBhcmFtcykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN1Y2Nlc3MiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBqb2JfZGF0YSA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIE5vbmUpCiAgICAgICAgICAgICAgICBpZiBqb2JfZGF0YToKICAgICAgICAgICAgICAgICAgICAjIENodeG6qW4gaMOzYSBk4buvIGxp4buHdSBqb2IKICAgICAgICAgICAgICAgICAgICBqb2IgPSBzZWxmLm1hcF9qb2JfZGF0YShqb2JfZGF0YSkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0w6xtIHRo4bqleSBqb2Ige2pvYlsnaWQnXX0gbG/huqFpIHtqb2JbJ3R5cGUnXX0gY2hvIHTDoGkga2hv4bqjbiB7YWNjb3VudFsndW5pcXVlX3VzZXJuYW1lJ119IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2pvYl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gW10KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGzhuqV5IGRhbmggc8OhY2ggam9iIikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBleGVjdXRlX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIGpvYiwgYmFvIGfhu5NtOgogICAgICAgICAgICAgICAgLSBzdGF0dXMgKGludCk6IE3DoyB0cuG6oW5nIHRow6FpIGpvYgogICAgICAgICAgICAgICAgICAgIDA6IENoxrBhIHRo4buxYyBoaeG7h24KICAgICAgICAgICAgICAgICAgICAxOiBUaMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICAyOiBUaOG6pXQgYuG6oWksIGtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcKICAgICAgICAgICAgICAgICAgICAzOiBUaOG6pXQgYuG6oWksIMSRw6MgYuG7iyB1bmZvbGxvdy91bmxpa2UKICAgICAgICAgICAgICAgICAgICA0OiBUaOG6pXQgYuG6oWksIHnDqnUgY+G6p3UgxJFhbmcgY2jhu50KICAgICAgICAgICAgICAgIC0gbWVzc2FnZSAoc3RyKTogVGjDtG5nIGLDoW8ga+G6v3QgcXXhuqMKICAgICAgICAgICAgICAgIC0gc3VjY2VzcyAoYm9vbCk6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGpvYl90eXBlID0gam9iLmdldCgidHlwZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIGpvYl9saW5rID0gam9iLmdldCgibGluayIsICIiKQogICAgICAgICAgICBqb2JfaWQgPSBqb2IuZ2V0KCJpZCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgdGjhu7FjIGhp4buHbiBqb2Ige2pvYl9pZH0gbG/huqFpIHtqb2JfdHlwZX0gduG7m2kgbGluayB7am9iX2xpbmt9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBsb+G6oWkgam9iIMSRxrDhu6NjIGjhu5cgdHLhu6MKICAgICAgICAgICAgaWYgam9iX3R5cGUgbm90IGluIFsiZm9sbG93IiwgImxpa2UiXToKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBmIkxv4bqhaSBqb2Ige2pvYl90eXBlfSBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7oyIKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IDIsCiAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBqb2IgdGhlbyBsb+G6oWkKICAgICAgICAgICAgam9iX3N0YXR1cyA9IDAgICMgTeG6t2MgxJHhu4tuaCBsw6AgY2jGsGEgbMOgbQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgam9iX3R5cGUgPT0gImZvbGxvdyI6CiAgICAgICAgICAgICAgICBqb2Jfc3RhdHVzID0gc2VsZi5fcGVyZm9ybV9mb2xsb3dfam9iKGpvYl9saW5rKQogICAgICAgICAgICBlbGlmIGpvYl90eXBlID09ICJsaWtlIjoKICAgICAgICAgICAgICAgIGpvYl9zdGF0dXMgPSBzZWxmLl9wZXJmb3JtX2xpa2Vfam9iKGpvYl9saW5rKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBW4buBIHRyYW5nIGNo4bunIHbDoCB2deG7kXQgYuG6o25nIHRpbiBu4bq/dSBqb2IgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgIGlmIHNlbGYuYmFja190b19ob21lKCk6CiAgICAgICAgICAgICAgICBpZiBqb2Jfc3RhdHVzID09IDE6ICAjIENo4buJIHZ14buRdCBraGkgam9iIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIHNlbGYuX3Njcm9sbF9mZWVkX2FmdGVyX2pvYigpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIGvhur90IHF14bqjIHRy4bqjIHbhu4EgZOG7sWEgdHLDqm4gam9iX3N0YXR1cwogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHRfZnJvbV9zdGF0dXMoam9iX3N0YXR1cywgam9iX3R5cGUpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYjoge3N0cihlKX0iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMiwgbWVzc2FnZSwgRmFsc2UpCiAgICAKICAgIGRlZiBfY3JlYXRlX2pvYl9yZXN1bHRfZnJvbV9zdGF0dXMoc2VsZiwgam9iX3N0YXR1czogaW50LCBqb2JfdHlwZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBU4bqhbyBr4bq/dCBxdeG6oyBqb2IgdOG7qyBzdGF0dXMgY29kZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl9zdGF0dXM6IE3DoyB0cuG6oW5nIHRow6FpIGpvYiB04burIF9wZXJmb3JtX3h4eF9qb2IKICAgICAgICAgICAgam9iX3R5cGU6IExv4bqhaSBqb2IgKGZvbGxvdywgbGlrZSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIGpvYgogICAgICAgICIiIgogICAgICAgIGlmIGpvYl9zdGF0dXMgPT0gMTogICMgVGjDoG5oIGPDtG5nCiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIsSQw6MgaG/DoG4gdGjDoG5oIGpvYiB7am9iX3R5cGV9IHRow6BuaCBjw7RuZyIKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMSwgbWVzc2FnZSwgVHJ1ZSkKICAgICAgICBlbGlmIGpvYl9zdGF0dXMgPT0gMjogICMgS2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZwogICAgICAgICAgICBtZXNzYWdlID0gZiJLaMO0bmcgdGjhu4MgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nIMSR4buDIHRo4buxYyBoaeG7h24gam9iIHtqb2JfdHlwZX0iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDIsIG1lc3NhZ2UsIEZhbHNlKQogICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSAzOiAgIyBC4buLIHVuZm9sbG93L3VubGlrZQogICAgICAgICAgICBtZXNzYWdlID0gZiLEkOG7kWkgdMaw4bujbmcgxJHDoyBi4buLIHVuZm9sbG93L3VubGlrZSIKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhtZXNzYWdlKQogICAgICAgICAgICAjIMSQw6FuaCBk4bqldSB1bmZvbGxvdyDEkeG7gyBKb2JTZXJ2aWNlIHjhu60gbMO9CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCgzLCBtZXNzYWdlLCBGYWxzZSwgdW5mb2xsb3c9VHJ1ZSkKICAgICAgICBlbGlmIGpvYl9zdGF0dXMgPT0gNDogICMgWcOqdSBj4bqndSDEkWFuZyBjaOG7nQogICAgICAgICAgICBtZXNzYWdlID0gZiJZw6p1IGPhuqd1IMSRYW5nIGNo4budIHRyb25nIGpvYiB7am9iX3R5cGV9IgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCg0LCBtZXNzYWdlLCBGYWxzZSkKICAgICAgICBlbHNlOiAgIyBUaOG6pXQgYuG6oWkgaG/hurdjIHRy4bqhbmcgdGjDoWkga2jDoWMKICAgICAgICAgICAgbWVzc2FnZSA9IGYiVGjhu7FjIGhp4buHbiBqb2Ige2pvYl90eXBlfSB0aOG6pXQgYuG6oWkgduG7m2kgdHLhuqFuZyB0aMOhaSB7am9iX3N0YXR1c30iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdChqb2Jfc3RhdHVzIGlmIGpvYl9zdGF0dXMgPiAwIGVsc2UgMCwgbWVzc2FnZSwgRmFsc2UpCiAgICAgICAgICAgIAogICAgZGVmIF9jaGVja19hY2NvdW50X3N0YXR1c19kaWFsb2coc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIGRpYWxvZyAiVHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24iIHbDoCB44butIGzDvSBu4bq/dSBjw7MKICAgICAgICBTYXUga2hpIGLhuqVtIE9LLCBraeG7g20gdHJhIHhlbSBjw7MgduG7gSB0cmFuZyBjaOG7pyBraMO0bmcgdsOgIHN5bmMgYWNjb3VudHMKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGPDsyBkaWFsb2cgdsOgIGPhuqduIG5n4burbmcgaG/huqF0IMSR4buZbmcgdMOgaSBraG/huqNuLCBGYWxzZSBu4bq/dSBraMO0bmcgY8OzIGRpYWxvZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaOG7nSBt4buZdCBjaMO6dCDEkeG7gyBkaWFsb2cgY8OzIHRo4buDIHh14bqldCBoaeG7h24KICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gZGlhbG9nIGPDsyB0ZXh0ICJUcuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbiIKICAgICAgICAgICAgc3RhdHVzX2RpYWxvZyA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJUcuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdGF0dXNfZGlhbG9nOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiUGjDoXQgaGnhu4duIGRpYWxvZyAnVHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24nIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgY8OzIHJlc291cmNlLWlkPSJhbmRyb2lkOmlkL21lc3NhZ2UiCiAgICAgICAgICAgICAgICBtZXNzYWdlX2VsZW1lbnQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImFuZHJvaWQ6aWQvbWVzc2FnZSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG1lc3NhZ2VfZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlX3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KG1lc3NhZ2VfZWxlbWVudCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlRow7RuZyBiw6FvIHRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuOiB7bWVzc2FnZV90ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBMxrB1IHRow7RuZyBiw6FvIHbDoG8gZGF0YWJhc2UgaG/hurdjIGxvZwogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiQ1JJVElDQUw6IFTDoGkga2hv4bqjbiBi4buLIGjhuqFuIGNo4bq/IC0ge21lc3NhZ2VfdGV4dH0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgY2xpY2sgbsO6dCBPSy/EkMOzbmcgxJHhu4MgxJHDs25nIGRpYWxvZwogICAgICAgICAgICAgICAgICAgIG9rX2NsaWNrZWQgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgIG9rX2J1dHRvbnMgPSBbIk9LIiwgIsSQw7NuZyIsICJUw7RpIGhp4buDdSIsICLEkOG7k25nIMO9Il0KICAgICAgICAgICAgICAgICAgICBmb3IgYnRuX3RleHQgaW4gb2tfYnV0dG9uczoKICAgICAgICAgICAgICAgICAgICAgICAgb2tfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9YnRuX3RleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9rX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihva19idXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBi4bqlbSBuw7p0ICd7YnRuX3RleHR9JyDEkeG7gyDEkcOzbmcgZGlhbG9nIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rX2NsaWNrZWQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG9rX2NsaWNrZWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQ2jhu50gNSBnacOieSB2w6Aga2nhu4NtIHRyYSB0cmFuZyBjaOG7pyB0cm9uZyA1IGzhuqduCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkNo4budIDVzIHbDoCBraeG7g20gdHJhIHRyYW5nIGNo4bunIHRyb25nIDUgbOG6p24uLi4iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGhvbWVfc2NyZWVuX2RldGVjdGVkID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UoNSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiS2nhu4NtIHRyYSB0cmFuZyBjaOG7pyBs4bqnbiB7YXR0ZW1wdCArIDF9LzUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiDEkcOjIHbhu4EgdHJhbmcgY2jhu6cgLSBjw7Mga2jhuqMgbsSDbmcgdMOgaSBraG/huqNuIGLhu4sgbG9nb3V0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob21lX3NjcmVlbl9kZXRlY3RlZCA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBob21lX3NjcmVlbl9kZXRlY3RlZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBzeW5jIGFjY291bnRzIMSR4buDIGtp4buDbSB0cmEgYWNjb3VudCBjw7MgY8OybiB0cm9uZyBkYW5oIHPDoWNoIGtow7RuZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVGjhu7FjIGhp4buHbiBzeW5jIGFjY291bnRzIMSR4buDIGtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24uLi4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gaGnhu4duIHThuqFpIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9kZXZpY2VfYWNjb3VudHMgPSBzZWxmLmdldF9hY2NvdW50c19mcm9tX2RldmljZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF91c2VybmFtZXMgPSB7YWNjLmdldCgidW5pcXVlX3VzZXJuYW1lIiwgIiIpLmxvd2VyKCkgZm9yIGFjYyBpbiBjdXJyZW50X2RldmljZV9hY2NvdW50c30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIFRpa1RvayB04burIERCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJfYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9c2VsZi5hcHBfbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OhYyB0w6BpIGtob+G6o24gdHJvbmcgREIgY8OzIGPDsm4gdOG7k24gdOG6oWkgdHLDqm4gdGhp4bq/dCBi4buLIGtow7RuZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBkYl9hY2NvdW50IGluIGRiX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYl91c2VybmFtZSA9IGRiX2FjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiLCAiIikubG93ZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkYl91c2VybmFtZSBhbmQgZGJfdXNlcm5hbWUgbm90IGluIGN1cnJlbnRfdXNlcm5hbWVzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6BpIGtob+G6o24ga2jDtG5nIGPDsm4gdOG7k24gdOG6oWkgdHLDqm4gdGhp4bq/dCBi4buLIC0gxJHDoW5oIGThuqV1IG5n4burbmcgaG/huqF0IMSR4buZbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJUw6BpIGtob+G6o24ge2RiX2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0ga2jDtG5nIGPDsm4gdHJvbmcgZGFuaCBzw6FjaCB0aGnhur90IGLhu4sgLSDEkcOhbmggZOG6pXUgbmfhu6tuZyBob+G6oXQgxJHhu5luZyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiaW5hY3RpdmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfZW5hYmxlIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJlYXNvbiI6ICJUw6BpIGtob+G6o24gYuG7iyBsb2cgb3V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoZGJfYWNjb3VudFsiaWQiXSwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyDEkcOhbmggZOG6pXUgdMOgaSBraG/huqNuIHtkYl9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IG5n4burbmcgaG/huqF0IMSR4buZbmcgduG7m2kgbMO9IGRvOiBUw6BpIGtob+G6o24gYuG7iyBsb2cgb3V0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFN5bmMgbOG6oWkgYWNjb3VudHMgbeG7m2kKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN5bmNfYWNjb3VudHNfdG9fZGIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBzeW5jX2Vycm9yOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihzeW5jX2Vycm9yLCAiTOG7l2kga2hpIHN5bmMgYWNjb3VudHMgc2F1IGtoaSBwaMOhdCBoaeG7h24gZGlhbG9nIHRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJUw6xtIHRo4bqleSBkaWFsb2cgJ1Ry4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuJyBuaMawbmcga2jDtG5nIHTDrG0gdGjhuqV5IG1lc3NhZ2UiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraeG7g20gdHJhIGRpYWxvZyB0cuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfcGVyZm9ybV9mb2xsb3dfam9iKHNlbGYsIHByb2ZpbGVfbGluazogc3RyKSAtPiBpbnQ6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IgZm9sbG93IHRyw6puIFRpa1RvawogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb2ZpbGVfbGluazogTGluayDEkeG6v24gdHJhbmcgY8OhIG5ow6JuIGPhuqduIGZvbGxvdyAoZOG6oW5nOiBodHRwczovL3d3dy50aWt0b2suY29tL0B1c2VybmFtZSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgaW50OiBUcuG6oW5nIHRow6FpIGpvYiAoMDogY2jGsGEgbMOgbSwgMTogaG/DoG4gdGjDoG5oLCAyOiBs4buXaSwgMzogYuG7iyB1bmZvbGxvdywgNDogecOqdSBj4bqndSBjaOG7nSwgNTogZ+G7rWkgecOqdSBj4bqndSkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IHVzZXJuYW1lIHThu6sgVVJMIFRpa1RvayDEkeG7gyBz4butIGThu6VuZyBjaG8gbG9nZ2luZwogICAgICAgICAgICB1c2VybmFtZV9tYXRjaCA9IHJlLnNlYXJjaChyJ3Rpa3Rva1wuY29tL0AoW14vP10rKScsIHByb2ZpbGVfbGluaykKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX21hdGNoOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgdHLDrWNoIHh14bqldCB1c2VybmFtZSB04burIGxpbms6IHtwcm9maWxlX2xpbmt9IikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdXNlcm5hbWUgPSB1c2VybmFtZV9tYXRjaC5ncm91cCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIHRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICBpZiBub3Qgc2VsZi5fb3Blbl9wcm9maWxlX3BhZ2UocHJvZmlsZV9saW5rKToKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4budIHRow6ptIGNobyB0cmFuZyBo4buTIHPGoSB04bqjaSB4b25nCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIG7DunQgRm9sbG93IHRoZW8gY8OhYyBjw6FjaCBraMOhYyBuaGF1CiAgICAgICAgICAgIGZvbGxvd19idXR0b24gPSBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPDoWNoIDE6IFTDrG0gdGhlbyB0ZXh0IHRp4bq/bmcgVmnhu4d0IHbDoCB0aeG6v25nIEFuaAogICAgICAgICAgICBmb2xsb3dfdGV4dHMgPSBbIlRoZW8gZMO1aSIsICJGb2xsb3ciLCAixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyIsICLEkMOjIHnDqnUgY+G6p3UiLCAiUmVxdWVzdGVkIl0KICAgICAgICAgICAgZm9yIHRleHQgaW4gZm9sbG93X3RleHRzOgogICAgICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICBpZiBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPDoWNoIDI6IFTDrG0gdGhlbyBjb250ZW50LWRlc2MKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBmb2xsb3dfZGVzY3MgPSBbIlRoZW8gZMO1aSIsICJGb2xsb3ciLCAixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyJdCiAgICAgICAgICAgICAgICBmb3IgZGVzYyBpbiBmb2xsb3dfZGVzY3M6CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9ZGVzYykKICAgICAgICAgICAgICAgICAgICBpZiBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSBs4bqnbiBu4buvYSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBmb2xsb3cKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCB0aGVvIGTDtWkg4bufIGzhuqduIMSR4bqndSwgdGjhu60gdnXhu5F0IG3DoG4gaMOsbmggdsOgIHTDrG0gbOG6oWkiKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSB04bqldCBj4bqjIGPDoWMgY8OhY2gKICAgICAgICAgICAgICAgIGZvciB0ZXh0IGluIGZvbGxvd190ZXh0czoKICAgICAgICAgICAgICAgICAgICBmb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9dGV4dCkKICAgICAgICAgICAgICAgICAgICBpZiBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgdGhlbyBkw7VpIHNhdSBuaGnhu4F1IGzhuqduIHRo4butIikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHRleHQgY+G7p2EgbsO6dAogICAgICAgICAgICBidXR0b25fdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoZm9sbG93X2J1dHRvbikKICAgICAgICAgICAgYnV0dG9uX3Jlc291cmNlX2lkID0gZm9sbG93X2J1dHRvbi5nZXQoInJlc291cmNlLWlkIiwgIiIpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUZXh0IGPhu6dhIG7DunQgZm9sbG93OiAne2J1dHRvbl90ZXh0fScsIHJlc291cmNlLWlkOiAne2J1dHRvbl9yZXNvdXJjZV9pZH0nIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIGhp4buHbiB04bqhaQogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIsSQYW5nIHRoZW8gZMO1aSIsICJGb2xsb3dpbmciXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHRoZW8gZMO1aSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSB04burIHRyxrDhu5tjIikKICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHnDqnUgY+G6p3UgdGhlbyBkw7VpIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IHThu6sgdHLGsOG7m2MiKQogICAgICAgICAgICAgICAgcmV0dXJuIDUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgbMOgICJUaGVvIGTDtWkiIGhv4bq3YyAiRm9sbG93IiB0aMOsIGNsaWNrIHbDoG8gbsO6dAogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIlRoZW8gZMO1aSIsICJGb2xsb3ciXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRo4buxYyBoaeG7h24gY2xpY2sgdsOgbyBuw7p0IHRoZW8gZMO1aSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgcmVzb3VyY2VfaWQgY+G7p2EgYnV0dG9uIMSR4buDIGtp4buDbSB0cmEgbOG6oWkgc2F1CiAgICAgICAgICAgICAgICBidXR0b25fcmVzb3VyY2VfaWQgPSBmb2xsb3dfYnV0dG9uLmdldCgicmVzb3VyY2UtaWQiLCAiIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGZvbGxvd19idXR0b24pCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGRpYWxvZyAiVHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24iCiAgICAgICAgICAgICAgICBpZiBzZWxmLl9jaGVja19hY2NvdW50X3N0YXR1c19kaWFsb2coKToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiVMOgaSBraG/huqNuIGLhu4sgaOG6oW4gY2jhur8sIG5n4burbmcgaG/huqF0IMSR4buZbmcgdsOgIGjhu6d5IGpvYiIpCiAgICAgICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIG5n4burbmcgaG/huqF0IMSR4buZbmcKICAgICAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4Egc3RhdHVzIDIgxJHhu4MgYsOhbyBs4buXaSB2w6AgaOG7p3kgam9iCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBWdeG7kXQgeHXhu5FuZyAxIGzhuqduIMSR4buDIHJlZnJlc2ggdHLhuqFuZyB0aMOhaQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIGRpYWxvZyBoaeG7h24gbMOqbiBraMO0bmcKICAgICAgICAgICAgICAgICMgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAjIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAjICAgICAjIEtp4buDbSB0cmEgZGlhbG9nIGPhuqNuaCBiw6FvIGhv4bq3YyBnaeG7m2kgaOG6oW4KICAgICAgICAgICAgICAgICMgICAgIGRpYWxvZ3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC5hcHAuRGlhbG9nIikKICAgICAgICAgICAgICAgICMgICAgIGZvciBkaWFsb2cgaW4gZGlhbG9nczoKICAgICAgICAgICAgICAgICMgICAgICAgICBkaWFsb2dfdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoZGlhbG9nKQogICAgICAgICAgICAgICAgIyAgICAgICAgIGlmIGFueShrZXl3b3JkIGluIGRpYWxvZ190ZXh0Lmxvd2VyKCkgZm9yIGtleXdvcmQgaW4gWyJ0aOG7rSBs4bqhaSBzYXUiLCAiZ2nhu5tpIGjhuqFuIiwgImxpbWl0IiwgInRyeSBhZ2FpbiJdKToKICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgIyBUw6xtIHbDoCBuaOG6pW4gbsO6dCBPSy/EkMOzbmcKICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgb2tfYnV0dG9ucyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzY3JlZW5feG1sLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iKQogICAgICAgICAgICAgICAgIyAgICAgICAgICAgICBmb3IgYnRuIGluIG9rX2J1dHRvbnM6CiAgICAgICAgICAgICAgICAjICAgICAgICAgICAgICAgICBidG5fdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoYnRuKQogICAgICAgICAgICAgICAgIyAgICAgICAgICAgICAgICAgaWYgYnRuX3RleHQgYW5kIGJ0bl90ZXh0Lmxvd2VyKCkgaW4gWyJvayIsICLEkcOzbmciLCAidMO0aSBoaeG7g3UiLCAixJHhu5NuZyDDvSJdOgogICAgICAgICAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihidG4pCiAgICAgICAgICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiSm9iIGtow7RuZyBob8OgbiB0aMOgbmgsIGLhu4sgZ2nhu5tpIGjhuqFuIHRoZW8gZMO1aSIpCiAgICAgICAgICAgICAgICAjICAgICAgICAgICAgIHJldHVybiAzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB0ZXh0IHNhdSBraGkgbmjhuqVuIHRoZW8gZMO1aQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBs4bqhaSBuw7p0IGZvbGxvdyDEkeG7gyBraeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgLSDGsHUgdGnDqm4gdGhlbyByZXNvdXJjZS1pZCBu4bq/dSBjw7MKICAgICAgICAgICAgICAgIHVwZGF0ZWRfZm9sbG93X2J1dHRvbiA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7MgcmVzb3VyY2VfaWQsIHTDrG0gdGhlbyByZXNvdXJjZV9pZCB0csaw4bubYwogICAgICAgICAgICAgICAgaWYgYnV0dG9uX3Jlc291cmNlX2lkOgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD1idXR0b25fcmVzb3VyY2VfaWQpCiAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0w6xtIGzhuqFpIG7DunQgZm9sbG93IHRoZW8gcmVzb3VyY2UtaWQ6IHtidXR0b25fcmVzb3VyY2VfaWR9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgdGhlbyByZXNvdXJjZV9pZCBob+G6t2Mga2jDtG5nIGPDsyByZXNvdXJjZV9pZCwgdMOsbSB0aGVvIHRleHQKICAgICAgICAgICAgICAgIGlmIG5vdCB1cGRhdGVkX2ZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X3RleHRzID0gWyLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIiwgIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiLCAiVGhlbyBkw7VpIiwgIkZvbGxvdyJdCiAgICAgICAgICAgICAgICAgICAgZm9yIHRleHQgaW4gZm9sbG93X3RleHRzOgogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2ZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD10ZXh0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiB1cGRhdGVkX2ZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEZhbGxiYWNrOiB0w6xtIHRoZW8gY29udGVudC1kZXNjCiAgICAgICAgICAgICAgICBpZiBub3QgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIGZvbGxvd19kZXNjcyA9IFsiVGhlbyBkw7VpIiwgIkZvbGxvdyIsICLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIl0KICAgICAgICAgICAgICAgICAgICBmb3IgZGVzYyBpbiBmb2xsb3dfZGVzY3M6CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9ZGVzYykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodXBkYXRlZF9mb2xsb3dfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfcmVzb3VyY2VfaWQgPSB1cGRhdGVkX2ZvbGxvd19idXR0b24uZ2V0KCJyZXNvdXJjZS1pZCIsICIiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJTYXUga2hpIGNsaWNrIGZvbGxvdzogdGV4dD0ne3VwZGF0ZWRfdGV4dH0nLCByZXNvdXJjZS1pZD0ne3VwZGF0ZWRfcmVzb3VyY2VfaWR9JyIpCiAgICAgICAgICAgICAgICAgICAgIyBUcmltIHdoaXRlc3BhY2UgdOG7qyB1cGRhdGVkX3RleHQKICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX3RleHQgPSB1cGRhdGVkX3RleHQuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw6FjIHRyxrDhu51uZyBo4bujcCBraMOhYyBuaGF1CiAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF90ZXh0IGluIFsixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyIsICJOaOG6r24gdGluIiwgIk1lc3NhZ2UiXToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiRm9sbG93IHRow6BuaCBjw7RuZyEiKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICAgICAgICAgIGVsaWYgdXBkYXRlZF90ZXh0IGluIFsixJDDoyB5w6p1IGPhuqd1IiwgIlJlcXVlc3RlZCJdOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIGfhu61pIHnDqnUgY+G6p3UgdGhlbyBkw7VpIHRow6BuaCBjw7RuZyEiKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNQogICAgICAgICAgICAgICAgICAgIGVsaWYgdXBkYXRlZF90ZXh0IGluIFsiVGhlbyBkw7VpIiwgIkZvbGxvdyJdOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkZvbGxvdyBraMO0bmcgdGjDoG5oIGPDtG5nLCB0ZXh0IGPhu6dhIG7DunQgduG6q24gbMOgOiB7dXBkYXRlZF90ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAzCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJGb2xsb3cga2jDtG5nIHRow6BuaCBjw7RuZywgdGV4dCBj4bunYSBuw7p0IGzDoDoge3VwZGF0ZWRfdGV4dH0iKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyB0w6xtIHRo4bqleSBuw7p0LCBjw7MgdGjhu4MgxJHDoyBmb2xsb3cgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgZm9sbG93IHNhdSBraGkgbmjhuqVuLCBnaeG6oyDEkeG7i25oIMSRw6MgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJUZXh0IGPhu6dhIG7DunQga2jDtG5nIGto4bubcCB24bubaSAnVGhlbyBkw7VpJyBob+G6t2MgJ0ZvbGxvdyc6IHtidXR0b25fdGV4dH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gam9iIGZvbGxvdzoge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gMgogICAgCiAgICBkZWYgX3Njcm9sbF9mZWVkX2FmdGVyX2pvYihzZWxmKToKICAgICAgICAiIiJWdeG7kXQgYuG6o25nIHRpbiAxLTUgbOG6p24gc2F1IGtoaSBqb2IgdGjDoG5oIGPDtG5nIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFJhbmRvbSBz4buRIGzhuqduIHZ14buRdCB04burIDEtNQogICAgICAgICAgICBzY3JvbGxfY291bnQgPSByYW5kb20ucmFuZGludCgxLCA1KQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVnXhu5F0IGLhuqNuZyB0aW4ge3Njcm9sbF9jb3VudH0gbOG6p24gc2F1IGtoaSBqb2IgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKHNjcm9sbF9jb3VudCk6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAjIE5naOG7iSByYW5kb20gMi00IGdpw6J5IGdp4buvYSBjw6FjIGzhuqduIHZ14buRdAogICAgICAgICAgICAgICAgd2FpdF90aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgNSkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJIb8OgbiB0aMOgbmggdnXhu5F0IGLhuqNuZyB0aW4gc2F1IGpvYiIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgdnXhu5F0IGLhuqNuZyB0aW4gc2F1IGpvYjoge3N0cihlKX0iKQogICAgCiAgICBkZWYgX29wZW5fcHJvZmlsZV9wYWdlKHNlbGYsIHByb2ZpbGVfbGluazogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIE3hu58gdHJhbmcgcHJvZmlsZSBUaWtUb2sgYuG6sW5nIHTDrG0ga2nhur9tIGhv4bq3YyBsaW5rIHRy4buxYyB0aeG6v3AKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm9maWxlX2xpbms6IExpbmsgxJHhur9uIHRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRyw61jaCB4deG6pXQgdXNlcm5hbWUgdOG7qyBVUkwgVGlrVG9rCiAgICAgICAgICAgIHVzZXJuYW1lX21hdGNoID0gcmUuc2VhcmNoKHIndGlrdG9rXC5jb20vQChbXi8/XSspJywgcHJvZmlsZV9saW5rKQogICAgICAgICAgICBpZiBub3QgdXNlcm5hbWVfbWF0Y2g6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyB0csOtY2ggeHXhuqV0IHVzZXJuYW1lIHThu6sgbGluazoge3Byb2ZpbGVfbGlua30iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdXNlcm5hbWUgPSB1c2VybmFtZV9tYXRjaC5ncm91cCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBSYW5kb20gY2jhu41uIDEgdHJvbmcgMiBjw6FjaDogdMOsbSBraeG6v20gaG/hurdjIG3hu58gdHLhu7FjIHRp4bq/cCBsaW5rCiAgICAgICAgICAgIGlmIHJhbmRvbS5jaG9pY2UoW1RydWUsIEZhbHNlXSk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTeG7nyB0cmFuZyBjw6EgbmjDom4gYuG6sW5nIGPDoWNoIHTDrG0ga2nhur9tOiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgICMgVGjhu60gbeG7nyBi4bqxbmcgdMOsbSBraeG6v20KICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9vcGVuX3Byb2ZpbGVfYnlfc2VhcmNoKHVzZXJuYW1lKToKICAgICAgICAgICAgICAgICAgICAjIE7hur91IHTDrG0ga2nhur9tIHRo4bqldCBi4bqhaSwgZmFsbGJhY2sgc2FuZyBt4bufIGxpbmsKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIGtp4bq/bSB0aOG6pXQgYuG6oWksIG3hu58gYuG6sW5nIGxpbmsgdHLhu7FjIHRp4bq/cCIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocHJvZmlsZV9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEPDoWNoIDI6IE3hu58gdHLhu7FjIHRp4bq/cCBVUkwgdGjDtG5nIHF1YSBoZWxwZXIub3Blbl91cmwoKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIk3hu58gdHJhbmcgY8OhIG5ow6JuIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3A6IHtwcm9maWxlX2xpbmt9IikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4budIHRow6ptIGNobyB0cmFuZyBo4buTIHPGoSB04bqjaSB4b25nCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIHbDoG8gxJHDum5nIHByb2ZpbGUga2jDtG5nIGLhurFuZyBjw6FjaCB0w6xtIGJ1dHRvbiBjw7MgdGV4dCA9IEB1c2VybmFtZQogICAgICAgICAgICAjIFTDrG0gYnV0dG9uIGPDsyB0ZXh0IGNow61uaCB4w6FjIGLhurFuZyBAdXNlcm5hbWUgKFRpa1RvayBsdcO0biBjw7MgQCB0csaw4bubYyB1c2VybmFtZSkKICAgICAgICAgICAgYXRfdXNlcm5hbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIsIHRleHQ9ZiJAe3VzZXJuYW1lfSIpCiAgICAgICAgICAgIGlmIGF0X3VzZXJuYW1lX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHjDoWMgbmjhuq1uIHbDoG8gxJHDum5nIHByb2ZpbGUgY+G7p2Ege3VzZXJuYW1lfSAodMOsbSB0aOG6pXkgYnV0dG9uIGPDsyB0ZXh0OiAnQHt1c2VybmFtZX0nKSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdMOsbSB0aOG6pXkgYnV0dG9uIGPDsyB0ZXh0ID0gJ0B7dXNlcm5hbWV9JyB0csOqbiBtw6BuIGjDrG5oLCBjw7MgdGjhu4Mga2jDtG5nIHbDoG8gxJHDum5nIHByb2ZpbGUiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIG3hu58gdHJhbmcgcHJvZmlsZToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9vcGVuX3Byb2ZpbGVfYnlfc2VhcmNoKHNlbGYsIHVzZXJuYW1lOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgTeG7nyB0cmFuZyBwcm9maWxlIFRpa1RvayBi4bqxbmcgY8OhY2ggdMOsbSBraeG6v20gdXNlcm5hbWUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB1c2VybmFtZTogVXNlcm5hbWUgY+G7p2EgdMOgaSBraG/huqNuIGPhuqduIHTDrG0KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUw6xtIHRhYiB0w6xtIGtp4bq/bQogICAgICAgICAgICBzZWFyY2hfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVMOsbSBraeG6v20iKQogICAgICAgICAgICBpZiBub3Qgc2VhcmNoX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFTDrG0ga2nhur9tIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWFyY2hfdGFiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKCiAgICAgICAgICAgICMgVMOsbSDDtCBuaOG6rXAgdMOsbSBraeG6v20KICAgICAgICAgICAgc2VhcmNoX2lucHV0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkVkaXRUZXh0IikKICAgICAgICAgICAgaWYgbm90IHNlYXJjaF9pbnB1dDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgw7Qgbmjhuq1wIHTDrG0ga2nhur9tIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6rXAgdXNlcm5hbWUgY+G6p24gdMOsbQogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX2lucHV0KQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBow6BtIGlucHV0X3RleHQgbeG7mXQgbOG6p24gZHV5IG5o4bqldAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgbmjhuq1wIHRleHQ6ICd7dXNlcm5hbWV9JyIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLmlucHV0X3RleHQoZiJ7dXNlcm5hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg2KQoKCiAgICAgICAgICAgICMgVMOsbSBuw7p0IFTDrG0ga2nhur9tIHbDoCBjbGljawogICAgICAgICAgICBzZWFyY2hfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIsIHRleHQ9IlTDrG0ga2nhur9tIikKICAgICAgICAgICAgaWYgc2VhcmNoX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlTDrG0gdGjhuqV5IG7DunQgJ1TDrG0ga2nhur9tJywgxJFhbmcgY2xpY2suLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF9idXR0b24pCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0ICdUw6xtIGtp4bq/bSciKQogICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIHNlYXJjaCB24bubaSBlbnRlciBrZXkKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2VudGVyKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKSAKCiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHRhYiAiTmfGsOG7nWkgZMO5bmciIHbDoCBjbGljayB2w6BvIG7DsyAtIMSR4bujaSB04buRaSDEkWEgMTBzCiAgICAgICAgICAgIHVzZXJfdGFiID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudCh0ZXh0PSJOZ8aw4budaSBkw7luZyIsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIGlmIG5vdCB1c2VyX3RhYjoKICAgICAgICAgICAgICAgIHVzZXJfdGFiID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudChjb250ZW50X2Rlc2M9Ik5nxrDhu51pIGTDuW5nIiwgdGltZW91dD02KQoKICAgICAgICAgICAgaWYgdXNlcl90YWI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIHRo4bqleSB0YWIgTmfGsOG7nWkgZMO5bmcsIMSRYW5nIGNsaWNrIHbDoG8uLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHVzZXJfdGFiKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIE5nxrDhu51pIGTDuW5nIHNhdSAxMHMiKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBUZXh0VmlldyBjw7MgdGV4dCBjaMOtbmggeMOhYyBi4bqxbmcgdXNlcm5hbWUgKGtow7RuZyBjw7MgQCkgLSDEkeG7o2kgdOG7kWkgxJFhIDZzCiAgICAgICAgICAgIHVzZXJuYW1lX2VsZW1lbnQgPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KHRleHQ9dXNlcm5hbWUsIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LlRleHRWaWV3IiwgdGltZW91dD02KQoKICAgICAgICAgICAgaWYgdXNlcm5hbWVfZWxlbWVudDoKICAgICAgICAgICAgICAgICMgQ2xpY2sgdsOgbyBlbGVtZW50IMSR4bqndSB0acOqbiB0w6xtIMSRxrDhu6NjCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHt1c2VybmFtZX0sIMSRYW5nIGNsaWNrIHbDoG8uLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHVzZXJuYW1lX2VsZW1lbnQpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IHRyb25nIGvhur90IHF14bqjIHTDrG0ga2nhur9tIHNhdSAxMHMiKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgdMOsbSBraeG6v20gdMOgaSBraG/huqNuOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX3BlcmZvcm1fbGlrZV9qb2Ioc2VsZiwgcG9zdF9saW5rOiBzdHIpIC0+IGludDoKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGpvYiBsaWtlIHZpZGVvIHRyw6puIFRpa1RvawogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBvc3RfbGluazogTGluayDEkeG6v24gdmlkZW8gY+G6p24gbGlrZQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBpbnQ6IFRy4bqhbmcgdGjDoWkgam9iICgwOiBjaMawYSBsw6BtLCAxOiBob8OgbiB0aMOgbmgsIDI6IGzhu5dpLCAzOiDEkcOjIGxpa2UgdHLGsOG7m2MgxJHDsykKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pwoKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJN4bufIHZpZGVvIFRpa1RvayBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wOiB7cG9zdF9saW5rfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE3hu58gdHLhu7FjIHRp4bq/cCBVUkwgdGjDtG5nIHF1YSBoZWxwZXIub3Blbl91cmwoKQogICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwb3N0X2xpbmssc2VsZi5hcHBfcGFja2FnZSkKCiAgICAgICAgICAgICMgUmFuZG9tIG5naOG7iSAzLTEwIGdpw6J5IG5oxrAgbmfGsOG7nWkgZMO5bmcgdGjDtG5nIHRoxrDhu51uZwogICAgICAgICAgICB3YWl0X3RpbWUgPSByYW5kb20ucmFuZGludCgzLCAxMCkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQYW5nIG5naOG7iSB7d2FpdF90aW1lfXMgbmjGsCBuZ8aw4budaSBkw7luZyB0aMO0bmcgdGjGsOG7nW5nLi4uIikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhaXRfdGltZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBuw7p0IGxpa2UgYuG6sW5nIGNvbnRlbnQtZGVzYyAiVGjDrWNoIHZpZGVvLiIKICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLl9maW5kX2xpa2VfYnV0dG9uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGxpa2UgdHLDqm4gbcOgbiBow6xuaCIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIG7DunQgbGlrZSBiYW4gxJHhuqd1CiAgICAgICAgICAgIGluaXRpYWxfY29udGVudF9kZXNjID0gbGlrZV9idXR0b24uZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgICAgICAgICAgaW5pdGlhbF9yZXNvdXJjZV9pZCA9IGxpa2VfYnV0dG9uLmdldCgicmVzb3VyY2UtaWQiLCAiIikKICAgICAgICAgICAgaW5pdGlhbF9zZWxlY3RlZCA9IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b24pCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVHLhuqFuZyB0aMOhaSBuw7p0IGxpa2UgYmFuIMSR4bqndTogc2VsZWN0ZWQ9e2luaXRpYWxfc2VsZWN0ZWR9LCBjb250ZW50LWRlc2M9J3tpbml0aWFsX2NvbnRlbnRfZGVzY30nLCByZXNvdXJjZS1pZD0ne2luaXRpYWxfcmVzb3VyY2VfaWR9JyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgbuG6v3UgxJHDoyBsaWtlIHThu6sgdHLGsOG7m2MKICAgICAgICAgICAgaWYgaW5pdGlhbF9zZWxlY3RlZCBvciAiQuG7jyB0aMOtY2giIGluIGluaXRpYWxfY29udGVudF9kZXNjIG9yICJVbmxpa2UiIGluIGluaXRpYWxfY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVmlkZW8gxJHDoyDEkcaw4bujYyBsaWtlIHThu6sgdHLGsOG7m2MiKQogICAgICAgICAgICAgICAgcmVzdWx0ID0gMyAgIyDEkMOjIGxpa2UgdHLGsOG7m2MgxJHDswogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGxpa2UgdmlkZW8KICAgICAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuX2F0dGVtcHRfbGlrZV92aWRlbyhsaWtlX2J1dHRvbikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU2F1IGtoaSBsaWtlIHhvbmcsIHZ14buRdCByYW5kb20gMi01IHZpZGVvIHLhu5NpIHbhu4EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgcmVzdWx0ID09IDE6ICAjIFRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgc2VsZi5fc2Nyb2xsX3ZpZGVvc19hbmRfcmV0dXJuX2hvbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBqb2IgbGlrZToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gMgoKICAgIGRlZiBfZmluZF9saWtlX2J1dHRvbihzZWxmKToKICAgICAgICAiIiJUw6xtIG7DunQgbGlrZSB0csOqbiB2aWRlbyBUaWtUb2siIiIKICAgICAgICAjIFRo4butIGPDoWMgY8OhY2ggdMOsbSBraMOhYyBuaGF1IGNobyBuw7p0IGxpa2UKICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlRow61jaCIpCiAgICAgICAgaWYgbm90IGxpa2VfYnV0dG9uOgogICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9Ikxpa2UiKQogICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgIyBUw6xtIHRoZW8gcmVzb3VyY2UtaWQgaG/hurdjIHhwYXRoCiAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uc3MuYW5kcm9pZC51Z2MudHJpbGw6aWQvbGlrZV9idXR0b24iKQogICAgICAgIHJldHVybiBsaWtlX2J1dHRvbgoKICAgIGRlZiBfYXR0ZW1wdF9saWtlX3ZpZGVvKHNlbGYsIGxpa2VfYnV0dG9uKToKICAgICAgICAiIiJUaOG7sWMgaGnhu4duIGxpa2UgdmlkZW8sIMawdSB0acOqbiBi4bqlbSByYW5kb20gdOG7jWEgxJHhu5ksIGZhbGxiYWNrIHNhbmcgYuG6pW0gbsO6dCBsaWtlIiIiCiAgICAgICAgIyBM4bqleSBrw61jaCB0aMaw4bubYyBtw6BuIGjDrG5oIMSR4buDIHTDrW5oIHThu41hIMSR4buZIHJhbmRvbQogICAgICAgIHdpZHRoLCBoZWlnaHQgPSBzZWxmLmhlbHBlci5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgIAogICAgICAgICMgVGjhu60gYuG6pW0gcmFuZG9tIHThu41hIMSR4buZIHRyxrDhu5tjIChkb3VibGUgY2xpY2spCiAgICAgICAgeCA9IGludCh3aWR0aCAqIHJhbmRvbS51bmlmb3JtKDAuNSwgMC42KSkKICAgICAgICB5ID0gaW50KGhlaWdodCAqIHJhbmRvbS51bmlmb3JtKDAuNSwgMC42KSkKICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVGjhu60gZG91YmxlIGNsaWNrIHThuqFpIHThu41hIMSR4buZICh7eH0sIHt5fSkgxJHhu4MgbGlrZSB2aWRlbyIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7sWMgaGnhu4duIGRvdWJsZSBjbGljawogICAgICAgIHNlbGYuaGVscGVyLnRhcCh4LCB5KQogICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjEpCiAgICAgICAgc2VsZi5oZWxwZXIudGFwKHgsIHkpCiAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpICAjIENo4budIGFuaW1hdGlvbgogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyBzYXUgZG91YmxlIGNsaWNrCiAgICAgICAgaWYgc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0ixJDDoyB0aMOtY2ggdmlkZW8iKToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBsaWtlIHZpZGVvIHRow6BuaCBjw7RuZyBi4bqxbmcgZG91YmxlIGNsaWNrIikKICAgICAgICAgICAgcmV0dXJuIDEKCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBkb3VibGUgY2xpY2sga2jDtG5nIHRow6BuaCBjw7RuZywgYuG6pW0gdHLhu7FjIHRp4bq/cCB2w6BvIG7DunQgbGlrZQogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkRvdWJsZSBjbGljayBjaMawYSBsaWtlIMSRxrDhu6NjLCBi4bqlbSB0cuG7sWMgdGnhur9wIHbDoG8gbsO6dCBsaWtlIikKICAgICAgICAKICAgICAgICAjIEzhuqV5IGzhuqFpIHRow7RuZyB0aW4gbsO6dCBsaWtlIG3hu5tpIG5o4bqldAogICAgICAgIGN1cnJlbnRfbGlrZV9idXR0b24gPSBzZWxmLl9maW5kX2xpa2VfYnV0dG9uKCkKICAgICAgICBpZiBub3QgY3VycmVudF9saWtlX2J1dHRvbjoKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgbGlrZSDEkeG7gyBi4bqlbSB0cuG7sWMgdGnhur9wIikKICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAKICAgICAgICAjIELhuqVtIHbDoG8gbsO6dCBsaWtlCiAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnQoY3VycmVudF9saWtlX2J1dHRvbikKICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEga+G6v3QgcXXhuqMgc2F1IGtoaSBi4bqlbSBuw7p0CiAgICAgICAgbGlrZV9idXR0b25fZmluYWwgPSBzZWxmLl9maW5kX2xpa2VfYnV0dG9uKCkKICAgICAgICBpZiBsaWtlX2J1dHRvbl9maW5hbDoKICAgICAgICAgICAgaXNfc2VsZWN0ZWRfZmluYWwgPSBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGxpa2VfYnV0dG9uX2ZpbmFsKQogICAgICAgICAgICBjb250ZW50X2Rlc2NfZmluYWwgPSBsaWtlX2J1dHRvbl9maW5hbC5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICByZXNvdXJjZV9pZF9maW5hbCA9IGxpa2VfYnV0dG9uX2ZpbmFsLmdldCgicmVzb3VyY2UtaWQiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJTYXUga2hpIGLhuqVtIG7DunQgbGlrZTogc2VsZWN0ZWQ9e2lzX3NlbGVjdGVkX2ZpbmFsfSwgY29udGVudC1kZXNjPSd7Y29udGVudF9kZXNjX2ZpbmFsfScsIHJlc291cmNlLWlkPSd7cmVzb3VyY2VfaWRfZmluYWx9JyIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBpc19zZWxlY3RlZF9maW5hbCBvciAiQuG7jyB0aMOtY2giIGluIGNvbnRlbnRfZGVzY19maW5hbCBvciAiVW5saWtlIiBpbiBjb250ZW50X2Rlc2NfZmluYWw6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIGxpa2UgdmlkZW8gdGjDoG5oIGPDtG5nIGLhurFuZyBjbGljayBuw7p0IikKICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgbGlrZSB2aWRlbyBzYXUga2hpIHRo4butIGPhuqMgMiBjw6FjaCIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgxJHhu4Mga2nhu4NtIHRyYSwgZ2nhuqMgxJHhu4tuaCB0aMOgbmggY8O0bmcKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgbGlrZSDEkeG7gyBraeG7g20gdHJhLCBnaeG6oyDEkeG7i25oIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgIHJldHVybiAxCgogICAgZGVmIF9zY3JvbGxfdmlkZW9zX2FuZF9yZXR1cm5faG9tZShzZWxmKToKICAgICAgICAiIiJWdeG7kXQgcmFuZG9tIDItNSB2aWRlbyBy4buTaSB24buBIHRyYW5nIGNo4bunIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFJhbmRvbSBz4buRIGzGsOG7o25nIHZpZGVvIHPhur0gdnXhu5F0ICgyLTUpCiAgICAgICAgICAgIG51bV92aWRlb3MgPSByYW5kb20ucmFuZGludCgyLCA1KQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiU+G6vSB2deG7kXQgcXVhIHtudW1fdmlkZW9zfSB2aWRlbyB0csaw4bubYyBraGkgduG7gSB0cmFuZyBjaOG7pyIpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aWR0aCwgaGVpZ2h0ID0gc2VsZi5oZWxwZXIuZ2V0X3NjcmVlbl9zaXplKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKG51bV92aWRlb3MpOgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVnXhu5F0IHZpZGVvIHRo4bupIHtpKzF9L3tudW1fdmlkZW9zfSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmdo4buJIHJhbmRvbSAyLTQgZ2nDonkgbmjGsCBuZ8aw4budaSBkw7luZyB0aOG6rXQKICAgICAgICAgICAgICAgIHdhaXRfdGltZSA9IHJhbmRvbS5yYW5kaW50KDIsIDQpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBW4buBIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkhvw6BuIHRow6BuaCB2deG7kXQgdmlkZW8sIMSRYW5nIHF1YXkgduG7gSB0cmFuZyBjaOG7pyIpCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB2deG7kXQgdmlkZW86IHtzdHIoZSl9IikKICAgICAgICAgICAgIyBW4bqrbiBj4buRIGfhuq9uZyB24buBIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgCiAgICBkZWYgZ2V0X2pvYl9wYXJhbXMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRoYW0gc+G7kSDEkeG7gyBn4buNaSBBUEkgbOG6pXkgam9iIGNobyBUaWtUb2sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogVGhhbSBz4buRCiAgICAgICAgIiIiCiAgICAgICAgZ29saWtlX2lkID0gYWNjb3VudC5nZXQoImdvbGlrZV9pZCIpCiAgICAgICAgaWYgbm90IGdvbGlrZV9pZDoKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJhY2NvdW50X2lkIjogZ29saWtlX2lkLAogICAgICAgICAgICAiZGF0YSI6ICJudWxsIgogICAgICAgIH0KICAgICAgICAKICAgIGRlZiBzeW5jX2FjY291bnRzX3RvX2RiKHNlbGYpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIMSQ4buTbmcgYuG7mSB0w6BpIGtob+G6o24gdOG7qyB0aGnhur90IGLhu4sgdsOgbyBkYXRhYmFzZQogICAgICAgIEdoaSDEkcOoIHBoxrDGoW5nIHRo4bupYyBj4bunYSBs4bubcCBjaGEgxJHhu4MgxJHhuqNtIGLhuqNvIGNo4buJIGPDsyBt4buZdCB0w6BpIGtob+G6o24gxJHGsOG7o2MgxJHDoW5oIGThuqV1IGzDoCDEkWFuZyBsb2dpbgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG6t3QgbOG6oWkgdHLhuqFuZyB0aMOhaSBsb2dpbiBjaG8gdOG6pXQgY+G6oyB0w6BpIGtob+G6o24gVGlrVG9rIHRyb25nIERCCiAgICAgICAgICAgIHNlbGYuZGIucmVzZXRfbG9naW5fc3RhdHVzX2J5X2FwcChzZWxmLmFwcF9uYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiB04burIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBkZXZpY2VfYWNjb3VudHMgPSBzZWxmLmdldF9hY2NvdW50c19mcm9tX2RldmljZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZCB04burIGRhdGFiYXNlCiAgICAgICAgICAgIGFuZHJvaWRfaWQgPSBzZWxmLmRiLmdldF9vcl9jcmVhdGVfZGV2aWNlX2lkKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gaGnhu4duIGPDsyB0cm9uZyBEQiBjaG8gYXBwIG7DoHkKICAgICAgICAgICAgZXhpc3RpbmdfYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9c2VsZi5hcHBfbmFtZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6oW8gc2V0IGPDoWMgdW5pcXVlX3VzZXJuYW1lIHThu6sgdGhp4bq/dCBi4buLIMSR4buDIGThu4Ugc28gc8OhbmgKICAgICAgICAgICAgZGV2aWNlX3VzZXJuYW1lcyA9IHNldCgpCiAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGRldmljZV9hY2NvdW50czoKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgICAgICBpZiB1c2VybmFtZToKICAgICAgICAgICAgICAgICAgICBkZXZpY2VfdXNlcm5hbWVzLmFkZCh1c2VybmFtZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0w6BpIGtob+G6o24gdHJvbmcgREIgbcOgIGtow7RuZyBjw7JuIHRyw6puIHRoaeG6v3QgYuG7iyAtPiDEkcOhbmggZOG6pXUgbG9nb3V0CiAgICAgICAgICAgIGZvciBleGlzdGluZ19hY2NvdW50IGluIGV4aXN0aW5nX2FjY291bnRzOgogICAgICAgICAgICAgICAgZXhpc3RpbmdfdXNlcm5hbWUgPSBleGlzdGluZ19hY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIikKICAgICAgICAgICAgICAgIGlmIGV4aXN0aW5nX3VzZXJuYW1lIGFuZCBleGlzdGluZ191c2VybmFtZSBub3QgaW4gZGV2aWNlX3VzZXJuYW1lczoKICAgICAgICAgICAgICAgICAgICAjIFTDoGkga2hv4bqjbiBjw7MgdHJvbmcgREIgbmjGsG5nIGtow7RuZyBjw7MgdHLDqm4gdGhp4bq/dCBi4buLIC0+IGxvZ291dAogICAgICAgICAgICAgICAgICAgIGlmIGV4aXN0aW5nX2FjY291bnQuZ2V0KCJzdGF0dXMiKSAhPSAibG9nb3V0IjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7ZXhpc3RpbmdfdXNlcm5hbWV9IGtow7RuZyBjw7JuIHRyw6puIHRoaeG6v3QgYuG7iywgxJHDoW5oIGThuqV1IGxvZ291dCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoZXhpc3RpbmdfYWNjb3VudFsiaWQiXSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJsb2dvdXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImluYWN0aXZlX3JlYXNvbiI6ICJUw6BpIGtob+G6o24ga2jDtG5nIGPDsm4gdHLDqm4gdGhp4bq/dCBi4buLIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc19sb2dpbiI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgaG/hurdjIHRow6ptIG3hu5tpIHbDoG8gREIKICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gZGV2aWNlX2FjY291bnRzOgogICAgICAgICAgICAgICAgIyBUaMOqbSB0aMO0bmcgdGluIGFwcCB2w6AgZGV2aWNlX2lkCiAgICAgICAgICAgICAgICBhY2NvdW50WyJhcHAiXSA9IHNlbGYuYXBwX25hbWUKICAgICAgICAgICAgICAgIGFjY291bnRbImRldmljZV9pZCJdID0gYW5kcm9pZF9pZAogICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgbMOgIGNoxrBhIMSR4buTbmcgYuG7mSDEkeG7gyBn4butaSBsw6puIHNlcnZlcgogICAgICAgICAgICAgICAgYWNjb3VudFsiaXNfc3luYyJdID0gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHTDoGkga2hv4bqjbiDEkcOjIHThu5NuIHThuqFpIGNoxrBhIGThu7FhIHbDoG8gdW5pcXVlX3VzZXJuYW1lICsgYXBwCiAgICAgICAgICAgICAgICBleGlzdGluZ19hY2NvdW50ID0gc2VsZi5kYi5nZXRfYWNjb3VudF9ieV91bmlxdWVfdXNlcm5hbWUoc2VsZi5hcHBfbmFtZSwgYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBleGlzdGluZ19hY2NvdW50OgogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiBoaeG7h24gY8OzIC0gY2jhu4kgxJHhu5NuZyBi4buZIHRy4bqhbmcgdGjDoWkgbG9naW4vbG9nb3V0CiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9pZCA9IGV4aXN0aW5nX2FjY291bnRbImlkIl0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENodeG6qW4gYuG7iyBk4buvIGxp4buHdSBj4bqtcCBuaOG6rXQgdOG7kWkgdGhp4buDdQogICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAiaXNfbG9naW4iOiBhY2NvdW50LmdldCgiaXNfbG9naW4iLCBGYWxzZSksCiAgICAgICAgICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGFjY291bnQuZ2V0KCJsYXN0X3VwZGF0ZSIsIGludCh0aW1lLnRpbWUoKSkpLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSB0w6BpIGtob+G6o24gdHJvbmcgREIgxJFhbmcg4bufIHRy4bqhbmcgdGjDoWkgbG9nb3V0IG5oxrBuZyB4deG6pXQgaGnhu4duIGzhuqFpIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgICAgIGlmIGV4aXN0aW5nX2FjY291bnQuZ2V0KCJzdGF0dXMiKSA9PSAibG9nb3V0IjoKICAgICAgICAgICAgICAgICAgICAgICAgIyBSZXNldCB04burIGxvZ291dCB24buBIGFjdGl2ZSB2w6AgeMOzYSBpbmFjdGl2ZV9yZWFzb24KICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGFbInN0YXR1cyJdID0gImFjdGl2ZSIKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGFbImluYWN0aXZlX3JlYXNvbiJdID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSDEkcOjIHh14bqldCBoaeG7h24gbOG6oWkgdHLDqm4gdGhp4bq/dCBi4buLLCByZXNldCB04burIGxvZ291dCB24buBIGFjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSDEkcOjIGFjdGl2ZSB0aMOsIGdp4buvIG5ndXnDqm4gc3RhdHVzLCBraMO0bmcgdGhheSDEkeG7lWkgZ8OsIGtow6FjCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkcSDbmcgbmjhuq1wIGNobyB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gdHJvbmcge3NlbGYuYXBwX25hbWV9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBUaMOqbSB0w6BpIGtob+G6o24gbeG7m2kgduG7m2kgdHLhuqFuZyB0aMOhaSBhY3RpdmUKICAgICAgICAgICAgICAgICAgICBhY2NvdW50WyJzdGF0dXMiXSA9ICJhY3RpdmUiCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5hZGRfYWNjb3VudChhY2NvdW50KQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHRow6ptIHTDoGkga2hv4bqjbiBt4bubaSB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSBjaG8ge3NlbGYuYXBwX25hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZGV2aWNlX2FjY291bnRzCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB7c2VsZi5hcHBfbmFtZX0iKQogICAgICAgICAgICByZXR1cm4gW10KCiAgICBkZWYgbWFwX2dvbGlrZV9hY2NvdW50cyhzZWxmLCBnb2xpa2VfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dLCBkZXZpY2VfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICDDgW5oIHjhuqEgdMOgaSBraG/huqNuIHThu6sgR29MaWtlIHbDoG8gdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGdvbGlrZV9hY2NvdW50czogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdOG7qyBHb0xpa2UgQVBJCiAgICAgICAgICAgIGRldmljZV9hY2NvdW50czogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdHLDqm4gdGhp4bq/dCBi4buLCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiDEkcOjIMOhbmggeOG6oQogICAgICAgICIiIgogICAgICAgIG1hcHBlZF9hY2NvdW50cyA9IFtdCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIENodeG6qW4gaMOzYSBk4buvIGxp4buHdSB04burIEdvTGlrZQogICAgICAgICAgICBnb2xpa2VfZGF0YSA9IHt9CiAgICAgICAgICAgIGZvciBhY2MgaW4gZ29saWtlX2FjY291bnRzOgogICAgICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IHRow7RuZyB0aW4gdOG7qyB0w6BpIGtob+G6o24gR29MaWtlCiAgICAgICAgICAgICAgICBnb2xpa2VfYWNjb3VudCA9IHsKICAgICAgICAgICAgICAgICAgICAiZ29saWtlX2lkIjogYWNjLmdldCgiaWQiKSwKICAgICAgICAgICAgICAgICAgICAibmlja25hbWUiOiBhY2MuZ2V0KCJuaWNrbmFtZSIpLAogICAgICAgICAgICAgICAgICAgICJ1bmlxdWVfaWQiOiBhY2MuZ2V0KCJ1bmlxdWVfaWQiKSwKICAgICAgICAgICAgICAgICAgICAidW5pcXVlX3VzZXJuYW1lIjogYWNjLmdldCgidW5pcXVlX3VzZXJuYW1lIiksCiAgICAgICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6IGFjYy5nZXQoImF2YXRhcl90aHVtYiIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU+G7rSBk4bulbmcgdW5pcXVlX3VzZXJuYW1lIGzDoG0ga2jDs2EgxJHhu4MgZOG7hSDDoW5oIHjhuqEKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gZ29saWtlX2FjY291bnRbInVuaXF1ZV91c2VybmFtZSJdCiAgICAgICAgICAgICAgICBpZiB1c2VybmFtZToKICAgICAgICAgICAgICAgICAgICBnb2xpa2VfZGF0YVt1c2VybmFtZS5sb3dlcigpXSA9IGdvbGlrZV9hY2NvdW50CiAgICAgICAgICAgIAogICAgICAgICAgICAjIMOBbmggeOG6oSB24bubaSB0w6BpIGtob+G6o24gdHLDqm4gdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGZvciBkZXZpY2VfYWNjb3VudCBpbiBkZXZpY2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGRldmljZV9hY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUgaW4gZ29saWtlX2RhdGE6CiAgICAgICAgICAgICAgICAgICAgIyDEkMOjIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB0cm9uZyBkYW5oIHPDoWNoIEdvTGlrZQogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdOG7qyBHb0xpa2UgdsOgbyB0w6BpIGtob+G6o24gdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICAgICAgZ29saWtlX2luZm8gPSBnb2xpa2VfZGF0YVt1c2VybmFtZV0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJnb2xpa2VfaWQiOiBnb2xpa2VfaW5mb1siZ29saWtlX2lkIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICJpc19nb2xpa2VfbGlua2VkIjogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6IGdvbGlrZV9pbmZvWyJhdmF0YXJfdGh1bWIiXSBvciBkZXZpY2VfYWNjb3VudC5nZXQoImF2YXRhcl90aHVtYiIsICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV9pZCI6IGdvbGlrZV9pbmZvWyJ1bmlxdWVfaWQiXSBvciBkZXZpY2VfYWNjb3VudC5nZXQoInVuaXF1ZV9pZCIsICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFTDrG0gSUQgdMOgaSBraG/huqNuIHRyb25nIERCCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9pZCA9IGRldmljZV9hY2NvdW50LmdldCgiaWQiKQogICAgICAgICAgICAgICAgICAgIGlmIGFjY291bnRfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHbDoG8gREIKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdsOgbyBkZXZpY2VfYWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfYWNjb3VudC51cGRhdGUodXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBlZF9hY2NvdW50cy5hcHBlbmQoZGV2aWNlX2FjY291bnQpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyDDoW5oIHjhuqEgdMOgaSBraG/huqNuIFRpa1Rvazoge3VzZXJuYW1lfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gbWFwcGVkX2FjY291bnRzCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMOhbmggeOG6oSB0w6BpIGtob+G6o24gVGlrVG9rIikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBfbmF2aWdhdGVfdG9fcHJvZmlsZV90YWIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkGnhu4F1IGjGsOG7m25nIMSR4bq/biB0YWIgaOG7kyBzxqEgVGlrVG9rCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gdsOgIGLhuqVtIHbDoG8gbsO6dCAiSOG7kyBzxqEiCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICBwcm9maWxlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJI4buTIHPGoSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcHJvZmlsZV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgSOG7kyBzxqEiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2ZpbGVfYnV0dG9uKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2w6AgeOG7rSBsw70gZGlhbG9nICJLaMO0bmcgY2hvIHBow6lwIiBu4bq/dSBjw7MKICAgICAgICAgICAgbm90X2FsbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJLaMO0bmcgY2hvIHBow6lwIikKICAgICAgICAgICAgaWYgbm90X2FsbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiBkaWFsb2cgJ0tow7RuZyBjaG8gcGjDqXAnLCDEkWFuZyBjbGljayDEkeG7gyDEkcOzbmcuLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG5vdF9hbGxvd19idXR0b24pCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2w6AgeOG7rSBsw70gZGlhbG9nICJMxrB1IGzhuqFpIMSRxINuZyBuaOG6rXAgbOG6p24gc2F1IiBu4bq/dSBjw7MKICAgICAgICAgICAgc2F2ZV9sb2dpbl9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iTMawdSB0aMO0bmcgdGluIMSRxINuZyBuaOG6rXAiKQogICAgICAgICAgICBpZiBzYXZlX2xvZ2luX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiBkaWFsb2cgJ0zGsHUgbOG6oWkgxJHEg25nIG5o4bqtcCBs4bqnbiBzYXUnLCDEkWFuZyBjbGljayDEkeG7gyDEkcOzbmcuLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNhdmVfbG9naW5fYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCgoKICAgICAgICAgICAgIyBWdeG7kXQgbMOqbiAxIGzhuqduIMSR4buDIHThuqNpIMSR4bqneSDEkeG7pyBu4buZaSBkdW5nCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMSRaeG7gXUgaMaw4bubbmcgxJHhur9uIHRhYiBo4buTIHPGoSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX29wZW5fcHJvZmlsZV9tZW51KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgTeG7nyBtZW51IGjhu5Mgc8ahIChkYW5oIHPDoWNoIHTDoGkga2hv4bqjbikKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgIyBUw6xtIG7DunQgbWVudSBo4buTIHPGoQogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgbWVudV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iTWVudSBo4buTIHPGoSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgbWVudV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgTWVudSBo4buTIHPGoSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHThu41hIMSR4buZIGPhu6dhIG7DunQgbWVudSB2w6AgY2xpY2sgduG7m2kgxJHhu5kgbOG7h2NoIG5n4bqrdSBuaGnDqm4KICAgICAgICAgICAgYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKG1lbnVfYnV0dG9uKQogICAgICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IGJvdW5kcwogICAgICAgICAgICB5ID0gKCh5MiAtIHkxKSAvLyAyKSArIHkxCiAgICAgICAgICAgIHggPSB4MiAvLyAyCiAgICAgICAgICAgIHggKz0gcmFuZG9tLnJhbmRpbnQoLTEwLCAxMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcCh4LCB5KQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKCiAgICAgICAgICAgICMga2nhu4NtIHRyYSBkaWFsb2cgdGV4dD0iRm9sbG93IGLhuqFuIGLDqCBj4bunYSBi4bqhbiIKCiAgICAgICAgICAgIGZvbGxvd19mcmllbmRzX2RpYWxvZyA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJGb2xsb3cgYuG6oW4gYsOoIGPhu6dhIGLhuqFuIikKICAgICAgICAgICAgaWYgZm9sbG93X2ZyaWVuZHNfZGlhbG9nOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiUGjDoXQgaGnhu4duIGRpYWxvZyAnRm9sbG93IGLhuqFuIGLDqCBj4bunYSBi4bqhbicsIMSRYW5nIGNsaWNrIMSR4buDIMSRw7NuZy4uLiIpCiAgICAgICAgICAgICAgICBjbG9zZV9kaWFsb2cgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSLEkMOzbmciKQogICAgICAgICAgICAgICAgaWYgY2xvc2VfZGlhbG9nOgogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjbG9zZV9kaWFsb2cpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIG3hu58gbWVudSBo4buTIHPGoSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBpc19ob21lX3NjcmVlbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIGPDsyDEkWFuZyDhu58gbcOgbiBow6xuaCB0cmFuZyBjaOG7pyBUaWtUb2sga2jDtG5nCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkWFuZyDhu58gdHJhbmcgY2jhu6csIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHBhY2thZ2UgaGnhu4duIHThuqFpIHRyxrDhu5tjIHRpw6puCiAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICBpZiBjdXJyZW50X3BhY2thZ2UgIT0gc2VsZi5hcHBfcGFja2FnZToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDsyBuw7p0ICJUcmFuZyBjaOG7pyIgxJHGsOG7o2MgY2jhu41uIChzZWxlY3RlZD10cnVlKSB0cm9uZyB0aGFuaCB0YWIga2jDtG5nCiAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciKQogICAgICAgICAgICBpZiBob21lX3RhYjoKICAgICAgICAgICAgICAgIGlmIHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQoaG9tZV90YWIpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgdMOsbSB0aOG6pXkgdGFiICJUcmFuZyBjaOG7pyIgbmjGsG5nIGNoxrBhIMSRxrDhu6NjIGNo4buNbiwgY2xpY2sgdsOgbyDEkcOzCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfdGFiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgY8OhYyB54bq/dSB04buRIGPhu6dhIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGtp4buDbSB0cmEgbcOgbiBow6xuaCB0cmFuZyBjaOG7pyBUaWtUb2siKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGVuc3VyZV9ob21lX3NjcmVlbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gbcOgbiBow6xuaCB0cmFuZyBjaOG7pyBUaWtUb2sKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZyB24buBIHRyYW5nIGNo4bunCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgcGFja2FnZSBoaeG7h24gdOG6oWkgdHLGsOG7m2MgdGnDqm4KICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkFwcCBoaeG7h24gdOG6oWkgKHtjdXJyZW50X3BhY2thZ2V9KSBraMO0bmcgcGjhuqNpIFRpa1RvaywgbeG7nyBhcHAgVGlrVG9rLi4uIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMTApICAjIFTEg25nIGzDqm4gMTAgZ2nDonkgxJHhu4MgYXBwIGto4bufaSDEkeG7mW5nIGhvw6BuIHRvw6BuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBwb3B1cCBQSU4gdHJvbmcgNXMgc2F1IGtoaSBt4bufIGFwcAogICAgICAgICAgICAgICAgc2VsZi5fY2hlY2tfcGluX3BvcHVwKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBWYWxpZGF0ZSBhcHAga2jDtG5nIGLhu4sgYmFubmVkIHNhdSBraGkgbeG7nwogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYudmFsaWRhdGVfYXBwX25vdF9iYW5uZWQoKToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiQXBwIFRpa1RvayBjw7MgduG6pW4gxJHhu4EgKGJhbm5lZC9j4bqjbmggYsOhbykiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIOG7nyB0cmFuZyBjaOG7pyBjaMawYQogICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIOG7nyB0cmFuZyBjaOG7pyBUaWtUb2siKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGNoxrBhLCBj4buRIGfhuq9uZyB24buBIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHJldHVybiBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgxJHhuqNtIGLhuqNvIHbhu4EgdHJhbmcgY2jhu6cgVGlrVG9rIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB2YWxpZGF0ZV9hcHBfbm90X2Jhbm5lZChzZWxmKToKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28ga2jDtG5nIGPDsyB0w6BpIGtob+G6o24gbsOgbyBi4buLIGJhbm5lZAogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSBkaWFsb2cgY+G6o25oIGLDoW8gY2h1bmcKICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAjIEtp4buDbSB0cmEgZGlhbG9nICJD4bqtcCBuaOG6rXQgQ2jDrW5oIHPDoWNoIHF1eeG7gW4gcmnDqm5nIHTGsCIKICAgICAgICBwcml2YWN5X3VwZGF0ZV9lbGVtZW50cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgdGV4dD0iQ+G6rXAgbmjhuq10IENow61uaCBzw6FjaCBxdXnhu4FuIHJpw6puZyB0xrAiCiAgICAgICAgKQoKICAgICAgICBpZiBwcml2YWN5X3VwZGF0ZV9lbGVtZW50czoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiUGjDoXQgaGnhu4duIGRpYWxvZyAnQ+G6rXAgbmjhuq10IENow61uaCBzw6FjaCBxdXnhu4FuIHJpw6puZyB0xrAnLCDEkWFuZyB44butIGzDvS4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gbsO6dCAixJDDoyBoaeG7g3UiIHbDoCBi4bqlbSB0cuG7sWMgdGnhur9wCiAgICAgICAgICAgIHVuZGVyc3RhbmRfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IsSQw6MgaGnhu4N1IikKICAgICAgICAgICAgaWYgdW5kZXJzdGFuZF9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIodW5kZXJzdGFuZF9idXR0b24pCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHbhu5tpIGPDoWMgdGV4dCBraMOhYwogICAgICAgICAgICAgICAgZm9yIHRleHQgaW4gWyJUaeG6v3AgdOG7pWMiLCAixJDhu5NuZyDDvSIsICJDb250aW51ZSIsICJBZ3JlZSIsICJDaOG6pXAgbmjhuq1uIiwgIkFjY2VwdCJdOgogICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICAgICAgaWYgYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgIyBLaeG7g20gdHJhIGRpYWxvZyAiVHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24iCiAgICAgICAgYWNjb3VudF9zdGF0dXNfZWxlbWVudHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgIHRleHQ9IlRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuIgogICAgICAgICkKCiAgICAgICAgaWYgYWNjb3VudF9zdGF0dXNfZWxlbWVudHM6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiBkaWFsb2cgxJHEg25nIHh14bqldCB0w6BpIGtob+G6o24uLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIG7DunQgY8OzIGlkIGzDoCBidXR0b24xIHbDoCBi4bqlbQogICAgICAgICAgICBidXR0b24xID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHJlc291cmNlX2lkPSJhbmRyb2lkOmlkL2J1dHRvbjEiKQogICAgICAgICAgICBpZiBidXR0b24xOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGJ1dHRvbjEpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMTApCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKCiAgICAgICAgIyBUw6xtIGRpYWxvZyBj4bqjbmggYsOhbyBi4bqxbmcgSUQgaG/hurdjIGNvbnRlbnQtZGVzYyBjw7MgY2jhu6lhICJj4bqjbmggYsOhbyIsICJs4buXaSIsICJ0aMO0bmcgYsOhbyIKICAgICAgICBhbGVydF9kaWFsb2dzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLmFwcC5EaWFsb2ciCiAgICAgICAgKQogICAgICAgIAogICAgICAgIGZvciBkaWFsb2cgaW4gYWxlcnRfZGlhbG9nczoKICAgICAgICAgICAgIyBUw6xtIHRleHQgdHJvbmcgZGlhbG9nCiAgICAgICAgICAgIHRleHRfdmlld3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuVGV4dFZpZXciCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciB0ZXh0X3ZpZXcgaW4gdGV4dF92aWV3czoKICAgICAgICAgICAgICAgIHRleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHRleHRfdmlldykKICAgICAgICAgICAgICAgIGlmIHRleHQgYW5kIGFueShrZXl3b3JkIGluIHRleHQubG93ZXIoKSBmb3Iga2V5d29yZCBpbiBbImPhuqNuaCBiw6FvIiwgImzhu5dpIiwgInRow7RuZyBiw6FvIiwgImLhu4sga2jDs2EiLCAidmkgcGjhuqFtIl0pOgogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCBj4bqjbmggYsOhbyBoaeG7h24gdOG6oWkgdOG7qyBkYgogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfd2FybmluZ3MgPSBzZWxmLmRiLmdldCgibG9ncy13YXJuaW5nLW1lc3NhZ2UiLCBbXSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRow6ptIGPhuqNuaCBiw6FvIG3hu5tpCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF93YXJuaW5ncy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAidGltZSI6IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLmlzb2Zvcm1hdCgpLAogICAgICAgICAgICAgICAgICAgICAgICAibWVzcyI6IHRleHQKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQ2jhu4kgZ2nhu68gbOG6oWkgdOG7kWkgxJFhIDIwIGxvZyBn4bqnbiBuaOG6pXQKICAgICAgICAgICAgICAgICAgICBpZiBsZW4oY3VycmVudF93YXJuaW5ncykgPiAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF93YXJuaW5ncyA9IGN1cnJlbnRfd2FybmluZ3NbLTIwOl0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEzGsHUgbOG6oWkgdsOgbyBkYgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJsb2dzLXdhcm5pbmctbWVzc2FnZSIsIGN1cnJlbnRfd2FybmluZ3MpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIsSQw6MgbMawdSBj4bqjbmggYsOhbyBUaWtUb2s6IHt0ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIG7DunQgT0sgaG/hurdjIMSQw7NuZyDEkeG7gyDEkcOzbmcgZGlhbG9nCiAgICAgICAgICAgICAgICAgICAgYnV0dG9ucyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuQnV0dG9uIgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBmb3IgYnV0dG9uIGluIGJ1dHRvbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbl90ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dChidXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJ1dHRvbl90ZXh0IGFuZCBidXR0b25fdGV4dC5sb3dlcigpIGluIFsib2siLCAixJHDs25nIiwgInTDtGkgaGnhu4N1IiwgIsSR4buTbmcgw70iXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihidXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlICAjIEPDsyBj4bqjbmggYsOhbyB0aMOsIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiBUcnVlICAjIEtow7RuZyBjw7MgY+G6o25oIGLDoW8KICAgICAgICAKICAgIGRlZiBiYWNrX3RvX2hvbWUoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBRdWF5IHbhu4EgdHJhbmcgY2jhu6cgVGlrVG9rIHThu6sgYuG6pXQga+G7syBtw6BuIGjDrG5oIG7DoG8KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZyB24buBIHRyYW5nIGNo4bunCiAgICAgICAgIiIiCiAgICAgICAgbWF4X2F0dGVtcHRzID0gNQogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlF1YXkgduG7gSB0cmFuZyBjaOG7pyBUaWtUb2siKQogICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKG1heF9hdHRlbXB0cyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyDhu58gdHJhbmcgY2jhu6cgY2jGsGEKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIOG7nyB0cmFuZyBjaOG7pyBUaWtUb2siKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBwYWNrYWdlIGhp4buHbiB04bqhaSB0csaw4bubYyBraGkgdGjhu7FjIGhp4buHbiB0aGFvIHTDoWMKICAgICAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICAgICAgaWYgY3VycmVudF9wYWNrYWdlICE9IHNlbGYuYXBwX3BhY2thZ2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkFwcCBoaeG7h24gdOG6oWkgKHtjdXJyZW50X3BhY2thZ2V9KSBraMO0bmcgcGjhuqNpIFRpa1RvaywgbeG7nyBs4bqhaSBhcHAgVGlrVG9rLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcChzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxMCkgICMgVMSDbmcgbMOqbiAxMCBnacOieSDEkeG7gyBhcHAga2jhu59pIMSR4buZbmcgaG/DoG4gdG/DoG4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgc2F1IGtoaSBt4bufIGFwcAogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gbsO6dCAiVHJhbmcgY2jhu6ciIOG7nyBib3R0b20gbmF2aWdhdGlvCiAgICAgICAgICAgICAgICBob21lX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJUcmFuZyBjaOG7pyIpCiAgICAgICAgICAgICAgICBpZiBub3QgaG9tZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgaG9tZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJUcmFuZyBjaOG7pyIpCiAgICAgICAgICAgICAgICBpZiBub3QgaG9tZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgaG9tZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iSG9tZSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBob21lX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaG9tZV9idXR0b24pCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSBuw7p0IGhvbWUsIHRo4butIG5o4bqlbiBiYWNrCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgY+G7kSBn4bqvbmcgduG7gSB0cmFuZyBjaOG7pyAobOG6p24ge2F0dGVtcHQgKyAxfSk6IHtlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIHF1YXkgduG7gSB0cmFuZyBjaOG7pyBUaWtUb2sgc2F1IG5oaeG7gXUgbOG6p24gdGjhu60iKQogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgc3dpdGNoX2FjY291bnQoc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaHV54buDbiBzYW5nIHTDoGkga2hv4bqjbiBUaWtUb2sga2jDoWMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXJnZXRfYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogYm9vbCwKICAgICAgICAgICAgICAgICdyZWFzb24nOiBzdHIgKG7hur91IHRo4bqldCBi4bqhaSksCiAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IHN0cgogICAgICAgICAgICB9CiAgICAgICAgIiIiCiAgICAgICAgdGFyZ2V0X3VzZXJuYW1lID0gdGFyZ2V0X2FjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiLCAiIikKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkGFuZyBjaHV54buDbiBzYW5nIHTDoGkga2hv4bqjbiBUaWtUb2s6IHt0YXJnZXRfdXNlcm5hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICduYXZpZ2F0aW9uX2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICdLaMO0bmcgdGjhu4MgxJHhur9uIHRyYW5nIGNo4bunIFRpa1RvaycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgVsOgbyB0cmFuZyBo4buTIHPGoQogICAgICAgICAgICBpZiBub3Qgc2VsZi5fbmF2aWdhdGVfdG9fcHJvZmlsZV90YWIoKToKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICduYXZpZ2F0aW9uX2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICdLaMO0bmcgdGjhu4MgdsOgbyB0cmFuZyBo4buTIHPGoSBUaWtUb2snCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBWdeG7kXQgbMOqbiAxIGzhuqduCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTeG7nyBtZW51IGjhu5Mgc8ahCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9vcGVuX3Byb2ZpbGVfbWVudSgpOgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ3VpX2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICdLaMO0bmcgdGjhu4MgbeG7nyBtZW51IGjhu5Mgc8ahIFRpa1RvaycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIGFkZF9hY2NvdW50X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJUaMOqbSB0w6BpIGtob+G6o24iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGFkZF9hY2NvdW50X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgbWVudSB0w6BpIGtob+G6o24iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ3VpX2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICdLaMO0bmcgdMOsbSB0aOG6pXkgbWVudSB0w6BpIGtob+G6o24gVGlrVG9rJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB0w6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24KICAgICAgICAgICAgYWNjb3VudF9idXR0b25zID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgdGFyZ2V0X2l0ZW0gPSBOb25lCiAgICAgICAgICAgIGZvciBidXR0b24gaW4gYWNjb3VudF9idXR0b25zOgogICAgICAgICAgICAgICAgaWYgYnV0dG9uLmdldCgiY29udGVudC1kZXNjIikgPT0gIlRow6ptIHTDoGkga2hv4bqjbiIgb3IgYnV0dG9uLmdldCgiY29udGVudC1kZXNjIikgPT0gIsSQw7NuZyI6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gYnV0dG9uLmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgICAgICBpZiBub3QgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgdGV4dHZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5UZXh0VmlldyIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uX2JvdW5kcyA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X2JvdW5kcyhidXR0b24pCiAgICAgICAgICAgICAgICAgICAgZm9yIHR2IGluIHRleHR2aWV3czoKICAgICAgICAgICAgICAgICAgICAgICAgdHZfYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKHR2KQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHZfYm91bmRzWzBdID49IGJ1dHRvbl9ib3VuZHNbMF0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dl9ib3VuZHNbMV0gPj0gYnV0dG9uX2JvdW5kc1sxXSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR2X2JvdW5kc1syXSA8PSBidXR0b25fYm91bmRzWzJdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHZfYm91bmRzWzNdIDw9IGJ1dHRvbl9ib3VuZHNbM10pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0ZXh0IGFuZCB0ZXh0ICE9ICJudWxsIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB1c2VybmFtZSA9PSB0YXJnZXRfdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2l0ZW0gPSBidXR0b24KICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgdGFyZ2V0X2l0ZW06CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gdHJvbmcgZGFuaCBzw6FjaCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IHTDoGkga2hv4bqjbiBsw6AgYuG7iyB2w7QgaGnhu4d1IGjDs2EgdHJvbmcgREIKICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQodGFyZ2V0X2FjY291bnRbImlkIl0sIHsKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogImRpc2FibGVkIiwKICAgICAgICAgICAgICAgICAgICAiZGlzYWJsZV9yZWFzb24iOiAiVMOgaSBraG/huqNuIGtow7RuZyBjw7MgdHLDqm4gdGhp4bq/dCBi4buLIiwKICAgICAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmjhuqVuIEJhY2sgxJHhu4MgxJHDs25nIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFF1YXkgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAnYWNjb3VudF9ub3RfZm91bmQnLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZidLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IHRyb25nIGRhbmggc8OhY2ggVGlrVG9rJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVwIHbDoG8gdMOgaSBraG/huqNuIG3hu6VjIHRpw6p1CiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih0YXJnZXRfaXRlbSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBzYWZlX3NsZWVwIHJldHVybiB2YWx1ZSDEkeG7gyBjw7MgdGjhu4MgdGhvw6F0IHPhu5ttCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoNik6ICAjIMSQ4bujaSBjaHV54buDbiB0w6BpIGtob+G6o24gaG/DoG4gdOG6pXQKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyBzd2l0Y2hfdG9fYWNjb3VudCIpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAnaW50ZXJydXB0ZWQnLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogJ0Lhu4sgZOG7q25nIHRyb25nIHF1w6EgdHLDrG5oIGNodXnhu4NuIHTDoGkga2hv4bqjbiBUaWtUb2snCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6MgY2h1eeG7g24gdMOgaSBraG/huqNuIHRow6BuaCBjw7RuZyBjaMawYQogICAgICAgICAgICBjdXJyZW50X3VzZXJuYW1lID0gc2VsZi5nZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgY3VycmVudF91c2VybmFtZSA9PSB0YXJnZXRfdXNlcm5hbWU6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBjaHV54buDbiB0w6BpIGtob+G6o24gdGjDoG5oIGPDtG5nIHNhbmcge3RhcmdldF91c2VybmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IFRydWUsIAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZifEkMOjIGNodXnhu4NuIHTDoGkga2hv4bqjbiB0aMOgbmggY8O0bmcgc2FuZyB7dGFyZ2V0X3VzZXJuYW1lfScKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYixJDDoyBi4bqlbSB2w6BvIHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSBuaMawbmcga2nhu4NtIHRyYSBs4bqhaSB0aOG6pXkgxJFhbmcgxJHEg25nIG5o4bqtcCBsw6Age2N1cnJlbnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdzd2l0Y2hfdmVyaWZpY2F0aW9uX2ZhaWxlZCcsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBmJ8SQw6MgYuG6pW0gdsOgbyB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gbmjGsG5nIGtp4buDbSB0cmEgbOG6oWkgdGjhuqV5IMSRYW5nIMSRxINuZyBuaOG6rXAgbMOgIHtjdXJyZW50X3VzZXJuYW1lfScKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgY2h1eeG7g24gdMOgaSBraG/huqNuIFRpa1RvayIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdleGNlcHRpb24nLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBmJ0zhu5dpIGtoaSBjaHV54buDbiB0w6BpIGtob+G6o24gVGlrVG9rOiB7c3RyKGUpfScKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgIGRlZiBfcGVyZm9ybV9hY2NvdW50X3N3aXRjaChzZWxmLCB0YXJnZXRfYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gY8OhYyB0aGFvIHTDoWMgVUkgxJHhu4MgY2h1eeG7g24gdMOgaSBraG/huqNuIFRpa1RvawogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhcmdldF9hY2NvdW50OiBUw6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24gxJHhur9uCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiB7CiAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IGJvb2wsCiAgICAgICAgICAgICAgICAncmVhc29uJzogc3RyIChu4bq/dSB0aOG6pXQgYuG6oWkpLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBzdHIKICAgICAgICAgICAgfQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc3dpdGNoX3Jlc3VsdCA9IHNlbGYuc3dpdGNoX2FjY291bnQodGFyZ2V0X2FjY291bnQpCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc3dpdGNoX3Jlc3VsdCwgZGljdCk6CiAgICAgICAgICAgICAgICByZXR1cm4gc3dpdGNoX3Jlc3VsdAogICAgICAgICAgICBlbGlmIHN3aXRjaF9yZXN1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4geydzdWNjZXNzJzogVHJ1ZSwgJ21lc3NhZ2UnOiAnQ2h1eeG7g24gdMOgaSBraG/huqNuIFRpa1RvayB0aMOgbmggY8O0bmcnfQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ3N3aXRjaF9mYWlsZWQnLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogJ0tow7RuZyB0aOG7gyBjaHV54buDbiB0w6BpIGtob+G6o24gVGlrVG9rJwogICAgICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBjaHV54buDbiB0w6BpIGtob+G6o24gVGlrVG9rIikKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdleGNlcHRpb24nLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBmJ0zhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGNodXnhu4NuIHTDoGkga2hv4bqjbiBUaWtUb2s6IHtzdHIoZSl9JwogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoc2VsZikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB1c2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gVGlrVG9rIMSRYW5nIMSRxINuZyBuaOG6rXAKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHIgaG/hurdjIE5vbmU6IFVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wLCBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgIyBWw6BvIHRyYW5nIGjhu5Mgc8ahIMSR4buDIGzhuqV5IHVzZXJuYW1lCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9uYXZpZ2F0ZV90b19wcm9maWxlX3RhYigpOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVnXhu5F0IHh14buRbmcgdsOgIGNo4budIDIgZ2nDonkKICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQoKICAgICAgICAgICAgIyBUw6xtIHVzZXJuYW1lIHRyb25nIHRyYW5nIGjhu5Mgc8ahCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHRyb25nIGPDoWMgVGV4dFZpZXcgY8OzIHRo4buDIGNo4bupYSB1c2VybmFtZQogICAgICAgICAgICB0ZXh0X3ZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgdXNlcm5hbWUgPSBOb25lCiAgICAgICAgICAgIGZvciB0ZXh0X3ZpZXcgaW4gdGV4dF92aWV3czoKICAgICAgICAgICAgICAgIHRleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHRleHRfdmlldykKICAgICAgICAgICAgICAgIGlmIHRleHQgYW5kIHRleHQuc3RhcnRzd2l0aCgiQCIpIGFuZCBsZW4odGV4dCkgPiAxOgogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gdGV4dFsxOl0gICMgQuG7jyBrw70gdOG7sSBACiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBRdWF5IGzhuqFpIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHVzZXJuYW1lOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgbOG6pXkgdXNlcm5hbWUgdOG7qyB0cmFuZyBo4buTIHPGoToge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gdXNlcm5hbWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBs4bqleSB1c2VybmFtZSB04burIHRyYW5nIGjhu5Mgc8ahIikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGzhuqV5IHVzZXJuYW1lIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wIikKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAKICAgICMgPT09PT09PT09PT09PT09PT09PT09PT09PSBTTUFSVCBDQVJFIE1FVEhPRFMgKMSQ4buTbmcgbmjhuqV0IHbhu5tpIEluc3RhZ3JhbSkgPT09PT09PT09PT09PT09PT09PT09PT09PQogICAgCiAgICBkZWYgX2NhcmVfc3dpcGVfZmVlZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJMxrDhu5t0IGZlZWQgVGlrVG9rIG5o4bq5IG5ow6BuZyAtIHTGsMahbmcgxJHGsMahbmcgSW5zdGFncmFtIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4bqvdCDEkeG6p3UgbMaw4bubdCBmZWVkIFRpa1Rvay4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrDhu5t0IDUtMTAgdmlkZW8gbmfhuqt1IG5oacOqbgogICAgICAgICAgICBudW1fc3dpcGVzID0gcmFuZG9tLnJhbmRpbnQoNSwgMTApCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKG51bV9zd2lwZXMpOgogICAgICAgICAgICAgICAgIyBUaOG7nWkgZ2lhbiB4ZW0gbmfhuqt1IG5oacOqbiAyLTUgZ2nDonkKICAgICAgICAgICAgICAgIHdhdGNoX3RpbWUgPSByYW5kb20udW5pZm9ybSgyLCA1KQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJMxrDhu5t0IHZpZGVvIHtpKzF9L3tudW1fc3dpcGVzfSwgeGVtIHt3YXRjaF90aW1lOi4xZn1zIikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YXRjaF90aW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEPDsyAxMCUga2jhuqMgbsSDbmcgbGlrZSB2aWRlbyBraGkgeGVtID49IDMgZ2nDonkgKGdp4bqjbSB04burIDE1JSkKICAgICAgICAgICAgICAgIGlmIHdhdGNoX3RpbWUgPj0gMyBhbmQgcmFuZG9tLnJhbmRvbSgpIDwgMC4xMDoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5fZmluZF9saWtlX2J1dHRvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxpa2VfYnV0dG9uIGFuZCBub3Qgc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChsaWtlX2J1dHRvbik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRo4butIGRvdWJsZSB0YXAgxJHhu4MgbGlrZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGgsIGhlaWdodCA9IHNlbGYuaGVscGVyLmdldF9zY3JlZW5fc2l6ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gaW50KHdpZHRoICogcmFuZG9tLnVuaWZvcm0oMC41LCAwLjYpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGludChoZWlnaHQgKiByYW5kb20udW5pZm9ybSgwLjUsIDAuNikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXAoeCwgeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXAoeCwgeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIsSQw6MgbGlrZSB2aWRlbyB7aSsxfSB0cm9uZyBjYXJlIGZlZWQiKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcyAgIyBC4buPIHF1YSBs4buXaSBsaWtlLCB0aeG6v3AgdOG7pWMgeGVtCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGZvcmNlIHN0b3AKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoMC4xKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGzGsOG7m3Qge251bV9zd2lwZXN9IHZpZGVvIFRpa1RvayIpCiAgICAgICAgICAgICMgVuG7gSB0cmFuZyBjaOG7pyBzYXUga2hpIGNhcmUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBsxrDhu5t0IGZlZWQgVGlrVG9rOiB7ZX0iKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfY2FyZV93YXRjaF92aWRlb3Moc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiWGVtIHZpZGVvIFRpa1RvayB0cm9uZyB0aOG7nWkgZ2lhbiBkw6BpIC0gdMawxqFuZyDEkcawxqFuZyB3YXRjaF9yZWVscyBJbnN0YWdyYW0iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuq90IMSR4bqndSB4ZW0gdmlkZW8gVGlrVG9rLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgdG90YWxfd2F0Y2hfdGltZSA9IHJhbmRvbS5yYW5kaW50KDEyMCwgMTgwKSAgIyAyLTMgcGjDunQKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlPhur0geGVtIHZpZGVvIFRpa1RvayB0cm9uZyB7dG90YWxfd2F0Y2hfdGltZX0gZ2nDonkiKQogICAgICAgICAgICAKICAgICAgICAgICAgdmlkZW9fY291bnQgPSAwCiAgICAgICAgICAgIHdoaWxlICh0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUpIDwgdG90YWxfd2F0Y2hfdGltZToKICAgICAgICAgICAgICAgIHZpZGVvX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYZW0gdmlkZW8gaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICB3YXRjaF9kdXJhdGlvbiA9IHJhbmRvbS5yYW5kaW50KDMsIDEyKSAgIyAzLTEyIGdpw6J5IG3hu5dpIHZpZGVvCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIlhlbSB2aWRlbyB7dmlkZW9fY291bnR9IHRyb25nIHt3YXRjaF9kdXJhdGlvbn1zIikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YXRjaF9kdXJhdGlvbikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDw7MgMjUlIGto4bqjIG7Eg25nIGxpa2UgdmlkZW8ga2hpIHhlbSA+PSA1IGdpw6J5IChnaeG6o20gdOG7qyAyMCUpCiAgICAgICAgICAgICAgICBpZiB3YXRjaF9kdXJhdGlvbiA+PSA1IGFuZCByYW5kb20ucmFuZG9tKCkgPCAwLjI1OgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLl9maW5kX2xpa2VfYnV0dG9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGlrZV9idXR0b24gYW5kIG5vdCBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGxpa2VfYnV0dG9uKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu60gZG91YmxlIHRhcCDEkeG7gyBsaWtlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCwgaGVpZ2h0ID0gc2VsZi5oZWxwZXIuZ2V0X3NjcmVlbl9zaXplKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPSBpbnQod2lkdGggKiByYW5kb20udW5pZm9ybSgwLjUsIDAuNikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gaW50KGhlaWdodCAqIHJhbmRvbS51bmlmb3JtKDAuNSwgMC42KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcCh4LCB5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcCh4LCB5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYixJDDoyBsaWtlIHZpZGVvIHt2aWRlb19jb3VudH0gdHJvbmcgY2FyZSB3YXRjaCIpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzICAjIELhu48gcXVhIGzhu5dpIGxpa2UsIHRp4bq/cCB04bulYyB4ZW0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBWdeG7kXQgc2FuZyB2aWRlbyB0aeG6v3AgdGhlbwogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGZvcmNlIHN0b3AKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoMC4xKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHhlbSB7dmlkZW9fY291bnR9IHZpZGVvIFRpa1RvayB0cm9uZyB7aW50KHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSl9cyIpCiAgICAgICAgICAgICMgVuG7gSB0cmFuZyBjaOG7pyBzYXUga2hpIGNhcmUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSB4ZW0gdmlkZW8gVGlrVG9rOiB7ZX0iKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfY2FyZV92aWV3X25vdGlmaWNhdGlvbnMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiWGVtIHRow7RuZyBiw6FvIFRpa1RvayAtIHTGsMahbmcgxJHGsMahbmcgSW5zdGFncmFtIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4bqvdCDEkeG6p3UgeGVtIHRow7RuZyBiw6FvIFRpa1Rvay4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHbDoCBi4bqlbSB2w6BvIEjhu5lwIHRoxrAgKGluYm94KQogICAgICAgICAgICBpbmJveF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KAogICAgICAgICAgICAgICAgdGltZW91dD01LAogICAgICAgICAgICAgICAgY29udGVudF9kZXNjPSJI4buZcCB0aMawIgogICAgICAgICAgICApIG9yIHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoCiAgICAgICAgICAgICAgICB0aW1lb3V0PTUsCiAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLnNzLmFuZHJvaWQudWdjLnRyaWxsOmlkL2N1OSIgICMgVGlrVG9rIGluYm94IGJ1dHRvbgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgaW5ib3hfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgSOG7mXAgdGjGsCBUaWtUb2siKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaW5ib3hfYnV0dG9uKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykKICAgICAgICAgICAgCiAgICAgICAgICAgICMgWGVtIHRow7RuZyBiw6FvIHRyb25nIDEwLTIwIGdpw6J5CiAgICAgICAgICAgIHZpZXdfdGltZSA9IHJhbmRvbS5yYW5kaW50KDEwLCAyMCkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJYZW0gdGjDtG5nIGLDoW8gdHJvbmcge3ZpZXdfdGltZX1zIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVnXhu5F0IGzDqm4geHXhu5FuZyDEkeG7gyB4ZW0gdGjDtG5nIGLDoW8KICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UocmFuZG9tLnJhbmRpbnQoMiwgNCkpOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDEsIDMpKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHZpZXdfdGltZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUXVheSBs4bqhaSB0cmFuZyBjaOG7pwogICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIHhlbSB0aMO0bmcgYsOhbyBUaWtUb2siKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgeGVtIHRow7RuZyBiw6FvIFRpa1Rvazoge2V9IikKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICAjID09PT09PT09PT09PT09PT09PT09PT09PT0gRU5EIFNNQVJUIENBUkUgTUVUSE9EUyA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAKICAgIGRlZiBfY2hlY2tfcGluX3BvcHVwKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgcG9wdXAgUElOIHbDoCBuaOG6rXAgbcOjIFBJTiBu4bq/dSBjw7MKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCJLaeG7g20gdHJhIHBvcHVwIFBJTiBUaWtUb2sgdHJvbmcgNSBnacOieS4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFPhu60gZOG7pW5nIHdhaXRfZm9yX2VsZW1lbnQgxJHhu4Mga2nhu4NtIHRyYSBwb3B1cCB0cm9uZyA1IGdpw6J5CiAgICAgICAgICAgIHBpbl9wb3B1cCA9IHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoCiAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2M9IkLhuqFuIMSRw6Mgc+G6tW4gc8OgbmcgxJHDs25nIFRpa1Rvaz8iLAogICAgICAgICAgICAgICAgdGltZW91dD01CiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHBpbl9wb3B1cDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiBwb3B1cCBQSU4gVGlrVG9rLCDEkWFuZyBuaOG6rXAgbcOjLi4uIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHbDoCBi4bqlbSB2w6BvIHPhu5EgIjEiIAogICAgICAgICAgICAgICAgZGlnaXRfMSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSIxIikKICAgICAgICAgICAgICAgIGlmIGRpZ2l0XzE6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGRpZ2l0XzEpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE5o4bqtcCBtw6MgUElOIDEyMzQKICAgICAgICAgICAgICAgICAgICBmb3IgZGlnaXQgaW4gWyIyIiwgIjMiLCAiNCJdOgogICAgICAgICAgICAgICAgICAgICAgICBkaWdpdF9lbGVtZW50ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9ZGlnaXQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRpZ2l0X2VsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZGlnaXRfZWxlbWVudCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHTDrG0gdGjhuqV5IHPhu5Ege2RpZ2l0fSB0cm9uZyBwb3B1cCBQSU4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIG5o4bqtcCBtw6MgUElOIDEyMzQiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKSAgIyBDaOG7nSBwb3B1cCDEkcOzbmcKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiVMOsbSB0aOG6pXkgcG9wdXAgUElOIG5oxrBuZyBraMO0bmcgdMOsbSB0aOG6pXkgc+G7kSAxIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCJLaMO0bmcgY8OzIHBvcHVwIFBJTiIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIGtp4buDbSB0cmEgcG9wdXAgUElOOiB7ZX0iKQogICAgCiAgICBkZWYgcG9zdF9uZXdmZWVkKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQxINuZyB2aWRlbyBjaG8gVGlrVG9rIC0gcGxhY2Vob2xkZXIgbWV0aG9kIMSR4buDIMSR4buTbmcgbmjhuqV0IHbhu5tpIEluc3RhZ3JhbQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgKHBsYWNlaG9sZGVyIGltcGxlbWVudGF0aW9uKQogICAgICAgICIiIgogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJwb3N0X25ld2ZlZWQgcGxhY2Vob2xkZXIgY2hvIFRpa1RvayB0w6BpIGtob+G6o246IHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJ1Vua25vd24nKX0iKQogICAgICAgIHJldHVybiBUcnVl').decode('utf-8'))
