import base64
exec(base64.b64decode('IiIiCk1pbmluZyBNYW5hZ2VtZW50IFNlcnZpY2UKUXXhuqNuIGzDvSBtaW5pbmcgdGjDtG5nIHF1YSBBUEkKIiIiCgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHRpbWUKaW1wb3J0IGpzb24KZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIExpc3QsIEFueSwgT3B0aW9uYWwKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IGNvbmZpZwppbXBvcnQgdXRpbHMKCiMgTG9nZ2VyCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIk1pbmluZ1NlcnZpY2UiKQoKCmNsYXNzIE1pbmluZ1NlcnZpY2U6CiAgICAiIiIKICAgIFNlcnZpY2UgcXXhuqNuIGzDvSBtaW5pbmcgdGjDtG5nIHF1YSBBUEkKICAgIC0gU3luYyBjb25maWcgdOG7qyBzZXJ2ZXIgduG7gSBjbGllbnQgcXVhIE1RVFQKICAgIC0gQXV0by1zdGFydCBtaW5lcnMga2hpIGJvb3QKICAgIC0gTW9uaXRvciBoYXNoIHJhdGUgdsOgIHN0YXR1cwogICAgIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9zZXJ2aWNlLCBiYXNlX3VybDogT3B0aW9uYWxbc3RyXSA9IE5vbmUpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBNaW5pbmcgU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGRiX3NlcnZpY2U6IERhdGFiYXNlIHNlcnZpY2UgxJHhu4MgbMawdSB0aMO0bmcgdGluCiAgICAgICAgICAgIGJhc2VfdXJsOiBVUkwgY+G7p2EgbWluaW5nIEFQSSBzZXJ2ZXIgKG3hurdjIMSR4buLbmggbOG6pXkgdOG7qyBjb25maWcuREVWSUNFX0lQKQogICAgICAgICIiIgogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgIyBT4butIGThu6VuZyBERVZJQ0VfSVAgdOG7qyBjb25maWcgbuG6v3Uga2jDtG5nIHRydXnhu4FuIGJhc2VfdXJsCiAgICAgICAgaWYgYmFzZV91cmwgaXMgTm9uZToKICAgICAgICAgICAgYmFzZV91cmwgPSBmImh0dHA6Ly97Y29uZmlnLkRFVklDRV9JUH06OTA5OCIKICAgICAgICBzZWxmLmJhc2VfdXJsID0gYmFzZV91cmwKICAgICAgICAKICAgICAgICAjIExvYWQgbWluaW5nIGluZm8gdOG7qyBEQgogICAgICAgIHNlbGYuX2xvYWRfbWluaW5nX2luZm8oKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB2w6Agc3luYyBjb25maWcga2hpIGto4bufaSDEkeG7mW5nCiAgICAgICAgc2VsZi5fY2hlY2tfYW5kX3N5bmNfb25fc3RhcnR1cCgpCiAgICAgICAgCiAgICBkZWYgX2xvYWRfbWluaW5nX2luZm8oc2VsZik6CiAgICAgICAgIiIiTG9hZCBtaW5pbmcgaW5mbyB2w6AgY29uZmlnIHThu6sgZGF0YWJhc2UiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTWluaW5nIGNvbmZpZzogQ+G6pXUgaMOsbmggdOG7qyBNUVRULCBjaOG7iSB1cGRhdGUga2hpIGPDsyBNUVRUCiAgICAgICAgICAgIHNlbGYubWluaW5nX2NvbmZpZyA9IHNlbGYuZGIuZ2V0KCJtaW5pbmctY29uZmlnIiwgewogICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiAwLAogICAgICAgICAgICAgICAgImF1dG9fc3RhcnQiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJtaW5lcnMiOiBbXQogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBNaW5pbmcgaW5mbzogVHLhuqFuZyB0aMOhaSB0aOG7sWMgdOG6vyB04burIEFQSSwgc3luYyDEkeG7i25oIGvhu7MKICAgICAgICAgICAgc2VsZi5taW5pbmdfaW5mbyA9IHNlbGYuZGIuZ2V0KCJtaW5pbmctaW5mbyIsIHsKICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IDAsCiAgICAgICAgICAgICAgICAidG90YWxfbWluZXJzIjogMCwKICAgICAgICAgICAgICAgICJydW5uaW5nX21pbmVycyI6IDAsCiAgICAgICAgICAgICAgICAic3RvcHBlZF9taW5lcnMiOiAwLAogICAgICAgICAgICAgICAgIm1pbmVycyI6IFtdLAogICAgICAgICAgICAgICAgImVycm9yX21lc3NhZ2UiOiAiIgogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiTG9hZGVkIG1pbmluZyBjb25maWc6IHtsZW4oc2VsZi5taW5pbmdfY29uZmlnLmdldCgnbWluZXJzJywgW10pKX0gbWluZXJzIikKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiTG9hZGVkIG1pbmluZyBpbmZvOiB7c2VsZi5taW5pbmdfaW5mby5nZXQoJ3J1bm5pbmdfbWluZXJzJywgMCl9L3tzZWxmLm1pbmluZ19pbmZvLmdldCgndG90YWxfbWluZXJzJywgMCl9IHJ1bm5pbmciKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGxvYWQgbWluaW5nIGRhdGE6IHtlfSIpCiAgICAgICAgICAgIHNlbGYubWluaW5nX2NvbmZpZyA9IHsKICAgICAgICAgICAgICAgICJsYXN0X3N5bmNfY29uZmlnIjogMCwKICAgICAgICAgICAgICAgICJhdXRvX3N0YXJ0IjogRmFsc2UsCiAgICAgICAgICAgICAgICAibWluZXJzIjogW10KICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLm1pbmluZ19pbmZvID0gewogICAgICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogMCwKICAgICAgICAgICAgICAgICJ0b3RhbF9taW5lcnMiOiAwLAogICAgICAgICAgICAgICAgInJ1bm5pbmdfbWluZXJzIjogMCwKICAgICAgICAgICAgICAgICJzdG9wcGVkX21pbmVycyI6IDAsCiAgICAgICAgICAgICAgICAibWluZXJzIjogW10sCiAgICAgICAgICAgICAgICAiZXJyb3JfbWVzc2FnZSI6IHN0cihlKQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBfc2F2ZV9taW5pbmdfY29uZmlnKHNlbGYpOgogICAgICAgICIiIkzGsHUgbWluaW5nIGNvbmZpZyB2w6BvIGRhdGFiYXNlIChjaOG7iSBraGkgY8OzIE1RVFQgdXBkYXRlKSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5kYi5zZXQoIm1pbmluZy1jb25maWciLCBzZWxmLm1pbmluZ19jb25maWcpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiU2F2ZWQgbWluaW5nIGNvbmZpZyB0byBkYXRhYmFzZSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbMawdSBtaW5pbmcgY29uZmlnOiB7ZX0iKQogICAgCiAgICBkZWYgX3NhdmVfbWluaW5nX2luZm8oc2VsZik6CiAgICAgICAgIiIiTMawdSBtaW5pbmcgaW5mbyB2w6BvIGRhdGFiYXNlIChzeW5jIMSR4buLbmgga+G7syB04burIEFQSSBzdGF0dXMpIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmRiLnNldCgibWluaW5nLWluZm8iLCBzZWxmLm1pbmluZ19pbmZvKQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIlNhdmVkIG1pbmluZyBpbmZvIHRvIGRhdGFiYXNlIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBsxrB1IG1pbmluZyBpbmZvOiB7ZX0iKQogICAgCiAgICBkZWYgX2NoZWNrX2FuZF9zeW5jX29uX3N0YXJ0dXAoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6Agc3luYyBtaW5pbmcgY29uZmlnIGtoaSBraOG7n2kgxJHhu5luZyDhu6luZyBk4bulbmcKICAgICAgICAKICAgICAgICBMb2dpYzoKICAgICAgICAxLiBLaeG7g20gdHJhIGPDsyBtaW5pbmctY29uZmlnIGtow7RuZwogICAgICAgIDIuIEtp4buDbSB0cmEgbWluaW5nIEFQSSBjw7MgY2jhuqF5IGtow7RuZwogICAgICAgIDMuIE7hur91IEFQSSBraMO0bmcgY2jhuqF5IOKGkiBTdGFydCBtaW5pbmcgc2VydmVyIGLhurFuZyB0bXV4CiAgICAgICAgNC4gxJDhu6NpIDIwcyDihpIgQ2hlY2sgbOG6oWkKICAgICAgICA1LiBO4bq/dSBr4bq/dCBu4buRaSDEkcaw4bujYyBuaMawbmcga2jDtG5nIGPDsyBtaW5lciBydW5uaW5nIOKGkiBVcGRhdGUgY29uZmlnCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OzIGNvbmZpZyBraMO0bmcKICAgICAgICAgICAgaWYgbm90IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoIm1pbmVycyIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkNoxrBhIGPDsyBtaW5pbmcgY29uZmlnLCBi4buPIHF1YSBzeW5jIGzDumMgc3RhcnR1cCIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsX3ZlcnNpb24gPSBzZWxmLm1pbmluZ19jb25maWcuZ2V0KCJsYXN0X3N5bmNfY29uZmlnIiwgMCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaeG7g20gdHJhIG1pbmluZyBjb25maWcgbMO6YyBzdGFydHVwIChsb2NhbCB2ZXJzaW9uOiB7bG9jYWxfdmVyc2lvbn0pLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBtaW5pbmcgQVBJIGPDsyBob+G6oXQgxJHhu5luZyBraMO0bmcKICAgICAgICAgICAgaWYgbm90IHNlbGYuY2hlY2tfbWluaW5nX2FwaV9oZWFsdGgoKToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJNaW5pbmcgQVBJIGNoxrBhIGNo4bqheSwgxJFhbmcga2jhu59pIMSR4buZbmcgbWluaW5nIHNlcnZlci4uLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU3RhcnQgbWluaW5nIHNlcnZlciBi4bqxbmcgdG11eAogICAgICAgICAgICAgICAgaWYgc2VsZi5fc3RhcnRfbWluaW5nX3NlcnZlcigpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGfhu61pIGzhu4duaCBraOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyLCDEkeG7o2kgMjBzLi4uIikKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIwKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgbOG6oWkgc2F1IDIwcwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmNoZWNrX21pbmluZ19hcGlfaGVhbHRoKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiTWluaW5nIEFQSSB24bqrbiBjaMawYSBz4bq1biBzw6BuZyBzYXUgMjBzLCBi4buPIHF1YSBzeW5jIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk1pbmluZyBBUEkgxJHDoyBz4bq1biBzw6BuZyBzYXUga2hpIGto4bufaSDEkeG7mW5nIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4Mga2jhu59pIMSR4buZbmcgbWluaW5nIHNlcnZlciwgYuG7jyBxdWEgc3luYyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHN0YXR1cyB04burIEFQSQogICAgICAgICAgICBzdGF0dXMgPSBzZWxmLmdldF9zdGF0dXMoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHN0YXR1cy5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHN0YXR1cyB04burIG1pbmluZyBBUEk6IHtzdGF0dXMuZ2V0KCdlcnJvcicpfSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIG1pbmVycyA9IHN0YXR1cy5nZXQoIm1pbmVycyIsIFtdKQogICAgICAgICAgICBydW5uaW5nX21pbmVycyA9IFttIGZvciBtIGluIG1pbmVycyBpZiBtLmdldCgic3RhdHVzIikgPT0gInJ1bm5pbmciXQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgY8OzIG1pbmVycyDEkWFuZyBjaOG6oXkg4oaSIFVwZGF0ZSBjb25maWcKICAgICAgICAgICAgaWYgbm90IHJ1bm5pbmdfbWluZXJzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJNaW5pbmcgQVBJIGPDsyB7bGVuKG1pbmVycyl9IG1pbmVycyBuaMawbmcga2jDtG5nIGPDsyBtaW5lciBuw6BvIMSRYW5nIGNo4bqheSwgxJFhbmcgdXBkYXRlIGNvbmZpZy4uLiIpCiAgICAgICAgICAgICAgICBzZWxmLl9mb3JjZV91cGRhdGVfY29uZmlnKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTWluaW5nIEFQSSDEkWFuZyBjaOG6oXkge2xlbihydW5uaW5nX21pbmVycyl9L3tsZW4obWluZXJzKX0gbWluZXJzLCBraMO0bmcgY+G6p24gdXBkYXRlIikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgY2hlY2sgdsOgIHN5bmMgbMO6YyBzdGFydHVwOiB7ZX0iKQogICAgCiAgICBkZWYgX3N0YXJ0X21pbmluZ19zZXJ2ZXIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyIGLhurFuZyB0bXV4IHRyb25nIFRlcm11eAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgZ+G7rWkgbOG7h25oIHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0IHN1YnByb2Nlc3MKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG7h25oIHRtdXggxJHhu4Mgc3RhcnQgbWluaW5nIHNlcnZlcgogICAgICAgICAgICBjbWQgPSBbCiAgICAgICAgICAgICAgICAidG11eCIsICJuZXctc2Vzc2lvbiIsICItZCIsICItcyIsICJtaW5pbmciLAogICAgICAgICAgICAgICAgIi9kYXRhL2RhdGEvY29tLnRlcm11eC9maWxlcy9ob21lL3J1bi1taW5pbmciCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiS2jhu59pIMSR4buZbmcgbWluaW5nIHNlcnZlcjogeycgJy5qb2luKGNtZCl9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdGV4dD1UcnVlLAogICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBn4butaSBs4buHbmgga2jhu59pIMSR4buZbmcgbWluaW5nIHNlcnZlciB0aMOgbmggY8O0bmciKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGto4bufaSDEkeG7mW5nIG1pbmluZyBzZXJ2ZXI6IHtlLnN0ZGVycn0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IGzhu4duaCB0bXV4IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraMO0bmcgeMOhYyDEkeG7i25oIGtoaSBraOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9mb3JjZV91cGRhdGVfY29uZmlnKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIMOJcCBideG7mWMgdXBkYXRlIGNvbmZpZyBsw6puIG1pbmluZyBBUEkKICAgICAgICBEw7luZyBraGkga2jhu59pIMSR4buZbmcgaG/hurdjIGtoaSBwaMOhdCBoaeG7h24gY29uZmlnIGtow7RuZyBraOG7m3AKICAgICAgICBC4buPIHF1YSBraeG7g20gdHJhIHRpbWVzdGFtcAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoIm1pbmVycyIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgbWluaW5nIGNvbmZpZyDEkeG7gyB1cGRhdGUiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEZvcmNlPVRydWUgxJHhu4MgYuG7jyBxdWEga2nhu4NtIHRyYSB0aW1lc3RhbXAKICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi51cGRhdGVfY29uZmlnKHNlbGYubWluaW5nX2NvbmZpZywgZm9yY2U9VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLinIUgxJDDoyBmb3JjZSB1cGRhdGUgbWluaW5nIGNvbmZpZyIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiLinYwgTOG7l2kga2hpIGZvcmNlIHVwZGF0ZSBjb25maWc6IHtyZXN1bHQuZ2V0KCdlcnJvcicpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBmb3JjZSB1cGRhdGUgY29uZmlnOiB7ZX0iKQogICAgCiAgICBkZWYgZ2V0X3N0YXR1cyhzZWxmLCBzYXZlX3RvX2RiOiBib29sID0gRmFsc2UpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRy4bqhbmcgdGjDoWkgbWluaW5nIHThu6sgQVBJCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2F2ZV90b19kYjogREVQUkVDQVRFRCAtIGtow7RuZyBjw7JuIHPhu60gZOG7pW5nIG7hu69hCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdDogU3RhdHVzIGPhu6dhIHThuqV0IGPhuqMgbWluZXJzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChmIntzZWxmLmJhc2VfdXJsfS9hcGkvc3RhdHVzIiwgdGltZW91dD01KQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgcmVzdWx0ID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIGtoaSBs4bqleSBzdGF0dXM6IHtlfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpLAogICAgICAgICAgICAgICAgIm1pbmVycyI6IFtdCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIGdldF9taW5lcl9zdGF0dXMoc2VsZiwgbmFtZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0cuG6oW5nIHRow6FpIGPhu6dhIG3hu5l0IG1pbmVyIGPhu6UgdGjhu4MKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBuYW1lOiBUw6puIG1pbmVyCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IFN0YXR1cyBj4bunYSBtaW5lcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoCiAgICAgICAgICAgICAgICBmIntzZWxmLmJhc2VfdXJsfS9hcGkvc3RhdHVzIiwKICAgICAgICAgICAgICAgIHBhcmFtcz17Im5hbWUiOiBuYW1lfSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9NQogICAgICAgICAgICApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kga2hpIGzhuqV5IHN0YXR1cyBtaW5lciB7bmFtZX06IHtlfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIHVwZGF0ZV9jb25maWcoc2VsZiwgbXF0dF9taW5pbmdfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwgZm9yY2U6IGJvb2wgPSBUcnVlKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBVcGRhdGUgbWluaW5nIGNvbmZpZyB04burIE1RVFQgc2VydmVyCiAgICAgICAgQ29uZmlnIG7DoHkgQ0jhu4ggdXBkYXRlIGtoaSBjw7MgTVFUVCB1cGRhdGUsIEtIw5RORyBzeW5jIMSR4buLbmgga+G7swogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1xdHRfbWluaW5nX2NvbmZpZzogewogICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiB0aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAiYXV0b19zdGFydCI6IGJvb2wsCiAgICAgICAgICAgICAgICAibWluZXJzIjogWy4uLl0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JjZTogTeG6t2MgxJHhu4tuaCBUcnVlIC0gTHXDtG4gdXBkYXRlIMSRw6ggbMOqbiBtaW5pbmcgQVBJCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IEvhur90IHF14bqjIHVwZGF0ZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBWYWxpZGF0ZSBjb25maWcKICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UobXF0dF9taW5pbmdfY29uZmlnLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZXJyb3IiOiAiSW52YWxpZCBjb25maWcgZm9ybWF0IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aW1lc3RhbXAKICAgICAgICAgICAgbmV3X3RpbWVzdGFtcCA9IG1xdHRfbWluaW5nX2NvbmZpZy5nZXQoImxhc3Rfc3luY19jb25maWciLCAwKQogICAgICAgICAgICBjdXJyZW50X3RpbWVzdGFtcCA9IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoImxhc3Rfc3luY19jb25maWciLCAwKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJVcGRhdGUgY29uZmlnOiBuZXdfdGltZXN0YW1wPXtuZXdfdGltZXN0YW1wfSwgY3VycmVudD17Y3VycmVudF90aW1lc3RhbXB9LCBmb3JjZT17Zm9yY2V9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgZm9yY2U9RmFsc2UgKHThu6sgTVFUVCk6IExVw5ROIHVwZGF0ZSDEkcOoIGzDqm4gbWluaW5nIEFQSQogICAgICAgICAgICAjIE7hur91IGZvcmNlPVRydWUgKHThu6sgc3RhcnR1cCk6IEtow7RuZyBsw6BtIGfDrCBj4bqjIChjaOG7iSDEkeG7gyB0xrDGoW5nIHRow61jaCkKICAgICAgICAgICAgaWYgZm9yY2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiRm9yY2UgdXBkYXRlIHThu6sgc3RhcnR1cCwgYuG7jyBxdWEiKQogICAgICAgICAgICAgICAgIyBGb3JjZSB1cGRhdGUga2jDtG5nIGPhuqduIGtp4buDbSB0cmEgZ8OsLCB1cGRhdGUgbHXDtG4KICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7rWkgY29uZmlnIMSR4bq/biBtaW5pbmcgQVBJCiAgICAgICAgICAgIG1pbmVyc19kYXRhID0gbXF0dF9taW5pbmdfY29uZmlnLmdldCgibWluZXJzIiwgW10pCiAgICAgICAgICAgIAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICBmIntzZWxmLmJhc2VfdXJsfS9hcGkvdXBkYXRlLWNvbmZpZyIsCiAgICAgICAgICAgICAgICBqc29uPW1pbmVyc19kYXRhLAogICAgICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sCiAgICAgICAgICAgICAgICB0aW1lb3V0PTMwCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSB1cGRhdGUgQVBJIHRow6BuaCBjw7RuZywgbMawdSBjb25maWcgdsOgbyBtaW5pbmctY29uZmlnCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgICMgTMawdSB2w6BvIG1pbmluZy1jb25maWcgKGNo4buJIHVwZGF0ZSBraGkgY8OzIE1RVFQpCiAgICAgICAgICAgICAgICBzZWxmLm1pbmluZ19jb25maWcgPSBtcXR0X21pbmluZ19jb25maWcKICAgICAgICAgICAgICAgIHNlbGYuX3NhdmVfbWluaW5nX2NvbmZpZygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIFVwZGF0ZWQgbWluaW5nIGNvbmZpZzoge3Jlc3VsdC5nZXQoJ3VwZGF0ZWQnLCAwKX0ve3Jlc3VsdC5nZXQoJ3RvdGFsJywgMCl9IG1pbmVycyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTG9nIGF1dG8tc3RhcnQgcmVzdWx0IG7hur91IGPDswogICAgICAgICAgICAgICAgYXV0b19zdGFydF9yZXN1bHQgPSByZXN1bHQuZ2V0KCJhdXRvX3N0YXJ0X3Jlc3VsdCIpCiAgICAgICAgICAgICAgICBpZiBhdXRvX3N0YXJ0X3Jlc3VsdDoKICAgICAgICAgICAgICAgICAgICBzdG9wcGVkID0gYXV0b19zdGFydF9yZXN1bHQuZ2V0KCJzdG9wcGVkIiwgW10pCiAgICAgICAgICAgICAgICAgICAgc3RhcnRlZCA9IGF1dG9fc3RhcnRfcmVzdWx0LmdldCgic3RhcnRlZCIsIFtdKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiQXV0by1yZXN0YXJ0OiBzdG9wcGVkPXtsZW4oc3RvcHBlZCl9LCBzdGFydGVkPXtsZW4oc3RhcnRlZCl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBNaW5pbmcgQVBJIMSRw6MgdOG7sSDEkeG7mW5nIHN0b3Avc3RhcnQga2hpIGF1dG9fc3RhcnQ9dHJ1ZQogICAgICAgICAgICAgICAgIyBTdGF0dXMgc+G6vSDEkcaw4bujYyBzeW5jIMSR4buLbmgga+G7syBi4bufaSBzeW5jX3N0YXR1c19mcm9tX2FwaSgpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSBraGkgdXBkYXRlIGNvbmZpZzoge2V9IgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZXJyb3IiOiBzdHIoZSkKICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSBraMO0bmcgbW9uZyDEkeG7o2kga2hpIHVwZGF0ZSBjb25maWc6IHtlfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIHN0YXJ0X21pbmVyKHNlbGYsIG5hbWU6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgU3RhcnQgbeG7mXQgbWluZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBuYW1lOiBUw6puIG1pbmVyCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IEvhur90IHF14bqjIHN0YXJ0CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICBmIntzZWxmLmJhc2VfdXJsfS9hcGkvc3RhcnQiLAogICAgICAgICAgICAgICAganNvbj17Im5hbWUiOiBuYW1lfSwKICAgICAgICAgICAgICAgIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9LAogICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIFN0YXJ0ZWQgbWluZXI6IHtuYW1lfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKdjCBGYWlsZWQgdG8gc3RhcnQgbWluZXIge25hbWV9OiB7cmVzdWx0LmdldCgnbWVzc2FnZScpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHN0YXJ0IG1pbmVyIHtuYW1lfToge2V9IikKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZXJyb3IiOiBzdHIoZSkKICAgICAgICAgICAgfQogICAgCiAgICBkZWYgc3RvcF9taW5lcihzZWxmLCBuYW1lOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFN0b3AgbeG7mXQgbWluZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBuYW1lOiBUw6puIG1pbmVyCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IEvhur90IHF14bqjIHN0b3AKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgIGYie3NlbGYuYmFzZV91cmx9L2FwaS9zdG9wIiwKICAgICAgICAgICAgICAgIGpzb249eyJuYW1lIjogbmFtZX0sCiAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgcmVzdWx0ID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdWNjZXNzIik6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBTdG9wcGVkIG1pbmVyOiB7bmFtZX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiLinYwgRmFpbGVkIHRvIHN0b3AgbWluZXIge25hbWV9OiB7cmVzdWx0LmdldCgnbWVzc2FnZScpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHN0b3AgbWluZXIge25hbWV9OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJlcnJvciI6IHN0cihlKQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBzdG9wX21pbmVycyhzZWxmLCBuYW1lczogTGlzdFtzdHJdKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBTdG9wIG5oaeG7gXUgbWluZXJzCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbmFtZXM6IERhbmggc8OhY2ggdMOqbiBtaW5lcnMKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdDogS+G6v3QgcXXhuqMgc3RvcAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgZiJ7c2VsZi5iYXNlX3VybH0vYXBpL3N0b3AiLAogICAgICAgICAgICAgICAganNvbj17Im5hbWVzIjogbmFtZXN9LAogICAgICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sCiAgICAgICAgICAgICAgICB0aW1lb3V0PTMwCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0LmdldCgic3VjY2VzcyIpOgogICAgICAgICAgICAgICAgc3RvcHBlZCA9IHJlc3VsdC5nZXQoInN0b3BwZWQiLCBbXSkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIFN0b3BwZWQge2xlbihzdG9wcGVkKX0gbWluZXJzIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgc3RvcCBtaW5lcnM6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIGZvcmNlX3N0b3BfYWxsKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEVtZXJnZW5jeSBzdG9wIHThuqV0IGPhuqMgbWluaW5nIHByb2Nlc3NlcwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IEvhur90IHF14bqjIGZvcmNlIHN0b3AKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgIGYie3NlbGYuYmFzZV91cmx9L2FwaS9mb3JjZS1zdG9wLWFsbCIsCiAgICAgICAgICAgICAgICB0aW1lb3V0PTMwCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0LmdldCgic3VjY2VzcyIpOgogICAgICAgICAgICAgICAga2lsbGVkX2NvdW50ID0gcmVzdWx0LmdldCgia2lsbGVkX2NvdW50IiwgMCkKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYi4pqg77iPIEZvcmNlIGtpbGxlZCB7a2lsbGVkX2NvdW50fSBtaW5pbmcgcHJvY2Vzc2VzIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZm9yY2Ugc3RvcCBhbGw6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIGZvcm1hdF9oYXNoX3JhdGUoc2VsZiwgaGFzaF9yYXRlX2hzOiBmbG9hdCkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEZvcm1hdCBoYXNoIHJhdGUgdOG7qyBIL3Mgc2FuZyBLSC9zLCBNSC9zLCBHSC9zCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgaGFzaF9yYXRlX2hzOiBIYXNoIHJhdGUgdHJvbmcgSC9zCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogRm9ybWF0dGVkIGhhc2ggcmF0ZQogICAgICAgICIiIgogICAgICAgIGlmIGhhc2hfcmF0ZV9ocyA+PSAxZTk6CiAgICAgICAgICAgIHJldHVybiBmIntoYXNoX3JhdGVfaHMvMWU5Oi4yZn0gR0gvcyIKICAgICAgICBlbGlmIGhhc2hfcmF0ZV9ocyA+PSAxZTY6CiAgICAgICAgICAgIHJldHVybiBmIntoYXNoX3JhdGVfaHMvMWU2Oi4yZn0gTUgvcyIKICAgICAgICBlbGlmIGhhc2hfcmF0ZV9ocyA+PSAxZTM6CiAgICAgICAgICAgIHJldHVybiBmIntoYXNoX3JhdGVfaHMvMWUzOi4yZn0gS0gvcyIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gZiJ7aGFzaF9yYXRlX2hzOi4yZn0gSC9zIgogICAgCiAgICBkZWYgc3luY19jb25maWdfZnJvbV9tcXR0KHNlbGYsIG1xdHRfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBTeW5jIGNvbmZpZyB04burIE1RVFQgc2VydmVyIHbhu4EgY2xpZW50CiAgICAgICAgQ0jhu4ggZ+G7jWkga2hpIGPDsyBNUVRUIHVwZGF0ZSwgS0jDlE5HIGfhu41pIMSR4buLbmgga+G7swogICAgICAgIAogICAgICAgIExvZ2ljOgogICAgICAgIDEuIEzhuqV5IGxhc3Rfc3luY19jb25maWcgdOG7qyBtaW5pbmctY29uZmlnCiAgICAgICAgMi4gU28gc8OhbmggduG7m2kgdGltZXN0YW1wIHThu6sgTVFUVAogICAgICAgIDMuIE7hur91IE1RVFQgbeG7m2kgaMahbjoKICAgICAgICAgICAtIEtp4buDbSB0cmEgbWluaW5nIEFQSSBjw7MgxJFhbmcgY2jhuqF5IGtow7RuZwogICAgICAgICAgIC0gTuG6v3UgxJFhbmcgY2jhuqF5OiBLaeG7g20gdHJhIHZlcnNpb24g4oaSIFVwZGF0ZSBu4bq/dSBj4bqnbgogICAgICAgICAgIC0gTuG6v3Uga2jDtG5nIGNo4bqheTogVXBkYXRlIGx1w7RuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbXF0dF9jb25maWc6IENvbmZpZyBuaOG6rW4gdOG7qyBNUVRUIHNlcnZlciB24bubaSBj4bqldSB0csO6YzoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibGFzdF9zeW5jX2NvbmZpZyI6IHRpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgICAiYXV0b19zdGFydCI6IGJvb2wsCiAgICAgICAgICAgICAgICAgICAgIm1pbmVycyI6IFsuLi5dCiAgICAgICAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBzeW5jIHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgbXF0dF90aW1lc3RhbXAgPSBtcXR0X2NvbmZpZy5nZXQoImxhc3Rfc3luY19jb25maWciLCAwKQogICAgICAgICAgICBsb2NhbF90aW1lc3RhbXAgPSBzZWxmLm1pbmluZ19jb25maWcuZ2V0KCJsYXN0X3N5bmNfY29uZmlnIiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiU3luYyBjb25maWcgZnJvbSBNUVRUOiBNUVRUIHRpbWVzdGFtcD17bXF0dF90aW1lc3RhbXB9LCBMb2NhbCB0aW1lc3RhbXA9e2xvY2FsX3RpbWVzdGFtcH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbXF0dF90aW1lc3RhbXAgPiBsb2NhbF90aW1lc3RhbXA6CiAgICAgICAgICAgICAgICAjIE1RVFQgY29uZmlnIG3hu5tpIGjGoW4KICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJNUVRUIGNvbmZpZyBt4bubaSBoxqFuLCDEkWFuZyBraeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgbWluaW5nIEFQSS4uLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBtaW5pbmcgQVBJIGPDsyBob+G6oXQgxJHhu5luZyBraMO0bmcKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmNoZWNrX21pbmluZ19hcGlfaGVhbHRoKCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk1pbmluZyBBUEkgY2jGsGEgc+G6tW4gc8OgbmcsIGzGsHUgY29uZmlnIG5oxrBuZyBjaMawYSB1cGRhdGUiKQogICAgICAgICAgICAgICAgICAgICMgTMawdSBjb25maWcgxJHhu4MgbOG6p24gc2F1IGNoZWNrIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5taW5pbmdfY29uZmlnID0gbXF0dF9jb25maWcKICAgICAgICAgICAgICAgICAgICBzZWxmLl9zYXZlX21pbmluZ19jb25maWcoKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzhuqV5IHN0YXR1cyB04burIEFQSQogICAgICAgICAgICAgICAgc3RhdHVzID0gc2VsZi5nZXRfc3RhdHVzKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHN0YXR1cy5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgICAgICAjIEFQSSBs4buXaSDihpIgVXBkYXRlIGx1w7RuCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk1pbmluZyBBUEkgbOG7l2ksIMSRYW5nIHVwZGF0ZSBjb25maWcuLi4iKQogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYudXBkYXRlX2NvbmZpZyhtcXR0X2NvbmZpZykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmdldCgic3VjY2VzcyIsIEZhbHNlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBtaW5lcnMgPSBzdGF0dXMuZ2V0KCJtaW5lcnMiLCBbXSkKICAgICAgICAgICAgICAgIGFwaV92ZXJzaW9uID0gc3RhdHVzLmdldCgiY29uZmlnX3ZlcnNpb24iLCAwKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyBjw7MgbWluZXJzIOKGkiBVcGRhdGUgbHXDtG4KICAgICAgICAgICAgICAgIGlmIG5vdCBtaW5lcnM6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk1pbmluZyBBUEkgY2jGsGEgY8OzIG1pbmVycywgxJFhbmcgdXBkYXRlIGNvbmZpZy4uLiIpCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi51cGRhdGVfY29uZmlnKG1xdHRfY29uZmlnKQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIG1pbmVycyDihpIgS2nhu4NtIHRyYSB2ZXJzaW9uCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk1pbmluZyBBUEkgxJFhbmcgY2jhuqF5IHtsZW4obWluZXJzKX0gbWluZXJzICh2ZXJzaW9uOiB7YXBpX3ZlcnNpb259KSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGFwaV92ZXJzaW9uICE9IG1xdHRfdGltZXN0YW1wOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVmVyc2lvbiBraMOhYyBuaGF1LCDEkWFuZyB1cGRhdGUgY29uZmlnLi4uIikKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBzZWxmLnVwZGF0ZV9jb25maWcobXF0dF9jb25maWcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXQoInN1Y2Nlc3MiLCBGYWxzZSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBWZXJzaW9uIMSRw6Mga2jhu5twLCBjaOG7iSBj4bqnbiBsxrB1IHbDoG8gREIKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiTWluaW5nIEFQSSDEkcOjIGPDsyBjb25maWcgdmVyc2lvbiBt4bubaSBuaOG6pXQiKQogICAgICAgICAgICAgICAgICAgIHNlbGYubWluaW5nX2NvbmZpZyA9IG1xdHRfY29uZmlnCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2F2ZV9taW5pbmdfY29uZmlnKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBDb25maWcgxJHDoyBzeW5jIGhv4bq3YyBNUVRUIGPFqSBoxqFuLCBi4buPIHF1YQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkNvbmZpZyDEkcOjIMSRxrDhu6NjIHN5bmMsIGtow7RuZyBj4bqnbiB1cGRhdGUiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHN5bmMgY29uZmlnIHThu6sgTVFUVDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBnZXRfbWluaW5nX3N1bW1hcnkoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdOG7lW5nIGjhu6NwIHRow7RuZyB0aW4gbWluaW5nCiAgICAgICAgR+G7jEkgVFLhu7BDIFRJ4bq+UCBBUEkgxJHhu4MgbOG6pXkgc3RhdHVzIHJlYWwtdGltZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IFN1bW1hcnkgYmFvIGfhu5NtOgogICAgICAgICAgICAgICAgLSBDb25maWcgdOG7qyBtaW5pbmctY29uZmlnIChsYXN0X3N5bmNfY29uZmlnLCBhdXRvX3N0YXJ0KQogICAgICAgICAgICAgICAgLSBTdGF0dXMgcmVhbC10aW1lIHThu6sgbWluaW5nIEFQSQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBH4buNaSBBUEkgxJHhu4MgbOG6pXkgc3RhdHVzIHJlYWwtdGltZQogICAgICAgICAgICBzdGF0dXMgPSBzZWxmLmdldF9zdGF0dXMoc2F2ZV90b19kYj1GYWxzZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBzdGF0dXMuZ2V0KCJzdWNjZXNzIik6CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgImVycm9yIjogc3RhdHVzLmdldCgiZXJyb3IiLCAiVW5rbm93biBlcnJvciIpLAogICAgICAgICAgICAgICAgICAgICJlcnJvcl9tZXNzYWdlIjogc3RhdHVzLmdldCgiZXJyb3IiLCAiIikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgbWluZXJzIHThu6sgQVBJIHJlc3BvbnNlCiAgICAgICAgICAgIG1pbmVycyA9IHN0YXR1cy5nZXQoIm1pbmVycyIsIFtdKQogICAgICAgICAgICBydW5uaW5nX2NvdW50ID0gc3VtKDEgZm9yIG0gaW4gbWluZXJzIGlmIG0uZ2V0KCJzdGF0dXMiKSA9PSAicnVubmluZyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEZvcm1hdCBoYXNoIHJhdGUgY2hvIG3hu5dpIG1pbmVyCiAgICAgICAgICAgIG1pbmVyc19kZXRhaWwgPSBbXQogICAgICAgICAgICBmb3IgbWluZXIgaW4gbWluZXJzOgogICAgICAgICAgICAgICAgaGFzaF9yYXRlX2hzID0gbWluZXIuZ2V0KCJoYXNoX3JhdGUiLCAwKQogICAgICAgICAgICAgICAgbWluZXJzX2RldGFpbC5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogbWluZXIuZ2V0KCJuYW1lIiksCiAgICAgICAgICAgICAgICAgICAgImNvaW5fbmFtZSI6IG1pbmVyLmdldCgiY29pbl9uYW1lIiksCiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IG1pbmVyLmdldCgic3RhdHVzIiksCiAgICAgICAgICAgICAgICAgICAgImhhc2hfcmF0ZV9ocyI6IGhhc2hfcmF0ZV9ocywKICAgICAgICAgICAgICAgICAgICAiaGFzaF9yYXRlX2Zvcm1hdHRlZCI6IHNlbGYuZm9ybWF0X2hhc2hfcmF0ZShoYXNoX3JhdGVfaHMpLAogICAgICAgICAgICAgICAgICAgICJtaW5pbmdfdG9vbCI6IG1pbmVyLmdldCgibWluaW5nX3Rvb2wiKSwKICAgICAgICAgICAgICAgICAgICAicGlkIjogbWluZXIuZ2V0KCJwaWQiKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IFRydWUsCiAgICAgICAgICAgICAgICAjIFRow7RuZyB0aW4gY29uZmlnIHThu6sgbWluaW5nLWNvbmZpZwogICAgICAgICAgICAgICAgImF1dG9fc3RhcnQiOiBzZWxmLm1pbmluZ19jb25maWcuZ2V0KCJhdXRvX3N0YXJ0IiwgRmFsc2UpLAogICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiBzZWxmLm1pbmluZ19jb25maWcuZ2V0KCJsYXN0X3N5bmNfY29uZmlnIiwgMCksCiAgICAgICAgICAgICAgICAjIFRow7RuZyB0aW4gc3RhdHVzIHJlYWwtdGltZSB04burIEFQSQogICAgICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogaW50KHRpbWUudGltZSgpKSwKICAgICAgICAgICAgICAgICJ0b3RhbF9taW5lcnMiOiBsZW4obWluZXJzKSwKICAgICAgICAgICAgICAgICJydW5uaW5nX21pbmVycyI6IHJ1bm5pbmdfY291bnQsCiAgICAgICAgICAgICAgICAic3RvcHBlZF9taW5lcnMiOiBsZW4obWluZXJzKSAtIHJ1bm5pbmdfY291bnQsCiAgICAgICAgICAgICAgICAiZXJyb3JfbWVzc2FnZSI6ICIiLAogICAgICAgICAgICAgICAgIm1pbmVycyI6IG1pbmVyc19kZXRhaWwKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kga2hpIGzhuqV5IG1pbmluZyBzdW1tYXJ5OiB7ZX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJlcnJvciI6IHN0cihlKSwKICAgICAgICAgICAgICAgICJlcnJvcl9tZXNzYWdlIjogZXJyb3JfbXNnCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIGNoZWNrX21pbmluZ19hcGlfaGVhbHRoKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSBtaW5pbmcgQVBJIHNlcnZlciBjw7MgaG/huqF0IMSR4buZbmcga2jDtG5nCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBzZXJ2ZXIgaG/huqF0IMSR4buZbmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGYie3NlbGYuYmFzZV91cmx9L2FwaS9zdGF0dXMiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQo=').decode('utf-8'))
