import base64
exec(base64.b64decode('aW1wb3J0IHBhaG8ubXF0dC5jbGllbnQgYXMgbXF0dAppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCB1dWlkCmltcG9ydCBvcwpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBMaXN0LCBPcHRpb25hbCwgQ2FsbGFibGUsIFVuaW9uCmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCmltcG9ydCBzb2NrZXQKCiMgTG9nZ2VyCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIk1RVFRTZXJ2aWNlIikKCmNsYXNzIE1RVFRTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGRldmljZV9pZCwgaGVscGVyX3NlcnZpY2U9Tm9uZSk6CiAgICAgICAgIyBLaOG7n2kgdOG6oW8gY8OhYyBzZXJ2aWNlCiAgICAgICAgc2VsZi5kYiA9IGRiX3NlcnZpY2UKICAgICAgICBzZWxmLmhlbHBlcl9zZXJ2aWNlID0gaGVscGVyX3NlcnZpY2UKICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIE1RVFQKICAgICAgICBzZWxmLmNsaWVudF9pZCA9IGYie2NvbmZpZy5NUVRUX0NMSUVOVF9JRF9QUkVGSVh9X3tkZXZpY2VfaWR9IgogICAgICAgIHNlbGYuYnJva2VyX3VybCA9IGNvbmZpZy5NUVRUX1NFUlZFUlNbY29uZmlnLk1PREVdCiAgICAgICAgc2VsZi5icm9rZXJfYWRkcmVzcyA9IHNlbGYuYnJva2VyX3VybC5yZXBsYWNlKCJtcXR0Oi8vIiwgIiIpLnNwbGl0KCI6IilbMF0KICAgICAgICBzZWxmLmJyb2tlcl9wb3J0ID0gaW50KHNlbGYuYnJva2VyX3VybC5zcGxpdCgiOiIpWy0xXSkgaWYgIjoiIGluIHNlbGYuYnJva2VyX3VybCBlbHNlIDE4ODMKICAgICAgICBzZWxmLnVzZXJuYW1lID0gY29uZmlnLk1RVFRfVVNFUk5BTUUKICAgICAgICBzZWxmLnBhc3N3b3JkID0gY29uZmlnLk1RVFRfUEFTU1dPUkQKICAgICAgICAKICAgICAgICAjIFRy4bqhbmcgdGjDoWkga+G6v3QgbuG7kWkKICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5jbGllbnQgPSBOb25lCiAgICAgICAgc2VsZi5kZXZpY2VfaWQgPSBkZXZpY2VfaWQKICAgICAgICAKICAgICAgICAjIFJlY29ubmVjdGlvbiBsb2dpYwogICAgICAgIHNlbGYucmVjb25uZWN0X2RlbGF5ID0gMSAgIyBC4bqvdCDEkeG6p3UgduG7m2kgMSBnacOieQogICAgICAgIHNlbGYubWF4X3JlY29ubmVjdF9kZWxheSA9IDYwICAjIFThu5FpIMSRYSA2MCBnacOieQogICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ID0gMAogICAgICAgIHNlbGYubGFzdF9kaXNjb25uZWN0X3RpbWUgPSAwCiAgICAgICAgc2VsZi5tYW51YWxfZGlzY29ubmVjdCA9IEZhbHNlICAjIEZsYWcgxJHhu4MgcGjDom4gYmnhu4d0IGRpc2Nvbm5lY3QgY8OzIGNo4bunIMO9IHbDoCBraMO0bmcgY2jhu6cgw70KICAgICAgICAKICAgICAgICAjIFRvcGljcwogICAgICAgIHNlbGYudG9waWNfY2xpZW50X3N5bmMgPSBjb25maWcuTVFUVF9UT1BJQ19DTElFTlRfU1lOQwogICAgICAgIHNlbGYudG9waWNfc2VydmVyX3Rhc2sgPSBmIntjb25maWcuTVFUVF9UT1BJQ19TRVJWRVJfVEFTS19QUkVGSVh9L3tzZWxmLmRldmljZV9pZH0iCiAgICAgICAgCiAgICAgICAgIyBRdeG6o24gbMO9IHRhc2sgdsOgIHN5bmMKICAgICAgICBzZWxmLnRhc2tfaGFuZGxlcnMgPSB7fQogICAgICAgIHNlbGYuc3luY190aHJlYWQgPSBOb25lCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBzZWxmLnN0b3BfZXZlbnQgPSB0aHJlYWRpbmcuRXZlbnQoKQogICAgICAgIHNlbGYuc3luY19pbnRlcnZhbCA9IHNlbGYuZGIuZ2V0X2RldmljZV9jb25maWcoInN5bmNfaW50ZXJ2YWwiLCBjb25maWcuU1lOQ19JTlRFUlZBTCkKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgbcO0aSB0csaw4budbmcgVGVybXV4CiAgICAgICAgc2VsZi5pc190ZXJtdXggPSAnVEVSTVVYX1ZFUlNJT04nIGluIG9zLmVudmlyb24gb3IgJy9kYXRhL2RhdGEvY29tLnRlcm11eCcgaW4gb3MuZW52aXJvbi5nZXQoJ1BBVEgnLCAnJykKICAgICAgICBpZiBzZWxmLmlzX3Rlcm11eDoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQYW5nIGNo4bqheSB0cm9uZyBtw7RpIHRyxrDhu51uZyBUZXJtdXgiKQoKICAgIGRlZiBfY3JlYXRlX2NsaWVudChzZWxmKSAtPiBtcXR0LkNsaWVudDoKICAgICAgICAiIiJU4bqhbyB2w6AgY+G6pXUgaMOsbmggTVFUVCBjbGllbnQiIiIKICAgICAgICBjbGllbnQgPSBOb25lCgogICAgICAgICMgVGjhu60gdOG6oW8gduG7m2kgQVBJIHYyCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjbGllbnQgPSBtcXR0LkNsaWVudCgKICAgICAgICAgICAgICAgIGNsaWVudF9pZD1zZWxmLmNsaWVudF9pZCwKICAgICAgICAgICAgICAgIGNsZWFuX3Nlc3Npb249VHJ1ZSwKICAgICAgICAgICAgICAgIHByb3RvY29sPW1xdHQuTVFUVHYzMTEsCiAgICAgICAgICAgICAgICBjYWxsYmFja19hcGlfdmVyc2lvbj1nZXRhdHRyKG1xdHQuQ2FsbGJhY2tBUElWZXJzaW9uLCAnVkVSU0lPTjInLCBOb25lKQogICAgICAgICAgICApCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJU4bqhbyBNUVRUIGNsaWVudCB24bubaSBBUEkgdjIiKQogICAgICAgIGV4Y2VwdCAoQXR0cmlidXRlRXJyb3IsIFR5cGVFcnJvcik6CiAgICAgICAgICAgICMgRmFsbGJhY2sgQVBJIHYxCiAgICAgICAgICAgIGNsaWVudCA9IG1xdHQuQ2xpZW50KAogICAgICAgICAgICAgICAgY2xpZW50X2lkPXNlbGYuY2xpZW50X2lkLAogICAgICAgICAgICAgICAgY2xlYW5fc2Vzc2lvbj1UcnVlLAogICAgICAgICAgICAgICAgcHJvdG9jb2w9bXF0dC5NUVRUdjMxMQogICAgICAgICAgICApCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJU4bqhbyBNUVRUIGNsaWVudCB24bubaSBBUEkgdjEiKQogICAgICAgIAogICAgICAgICMgQ+G6pXUgaMOsbmggeMOhYyB0aOG7sWMgbuG6v3UgY8OzCiAgICAgICAgaWYgc2VsZi51c2VybmFtZSBhbmQgc2VsZi5wYXNzd29yZDoKICAgICAgICAgICAgY2xpZW50LnVzZXJuYW1lX3B3X3NldChzZWxmLnVzZXJuYW1lLCBzZWxmLnBhc3N3b3JkKQogICAgICAgIAogICAgICAgICMgxJDEg25nIGvDvSBjYWxsYmFjawogICAgICAgIGNsaWVudC5vbl9jb25uZWN0ID0gc2VsZi5fb25fY29ubmVjdAogICAgICAgIGNsaWVudC5vbl9tZXNzYWdlID0gc2VsZi5fb25fbWVzc2FnZQogICAgICAgIGNsaWVudC5vbl9kaXNjb25uZWN0ID0gc2VsZi5fb25fZGlzY29ubmVjdAogICAgICAgIAogICAgICAgICMgQ+G6pXUgaMOsbmgga2VlcC1hbGl2ZSBkw6BpIGjGoW4gdsOgIHJlY29ubmVjdGlvbgogICAgICAgIGNsaWVudC5yZWNvbm5lY3RfZGVsYXlfc2V0KG1pbl9kZWxheT0xLCBtYXhfZGVsYXk9NjApCiAgICAgICAgCiAgICAgICAgcmV0dXJuIGNsaWVudAoKICAgIGRlZiBjb25uZWN0KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiS+G6v3QgbuG7kWkgxJHhur9uIE1RVFQgYnJva2VyIHbhu5tpIGV4cG9uZW50aWFsIGJhY2tvZmYiIiIKICAgICAgICBkZWYgY2FuX2Nvbm5lY3QoaG9zdDogc3RyLCBwb3J0OiBpbnQsIHRpbWVvdXQ6IGZsb2F0ID0gMy4wKSAtPiBib29sOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB3aXRoIHNvY2tldC5jcmVhdGVfY29ubmVjdGlvbigoaG9zdCwgcG9ydCksIHRpbWVvdXQ9dGltZW91dCk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBtYWluX2hvc3QgPSBzZWxmLmJyb2tlcl9hZGRyZXNzCiAgICAgICAgbWFpbl9wb3J0ID0gc2VsZi5icm9rZXJfcG9ydAogICAgICAgIGZhbGxiYWNrX2hvc3QgPSAiMTAuMC4wLjUiCiAgICAgICAgZmFsbGJhY2tfcG9ydCA9IDkwMjAKCiAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IG7hu5FpIHNvY2tldCB04bubaSBj4bqjIDIgSVAKICAgICAgICBtYWluX29rID0gY2FuX2Nvbm5lY3QobWFpbl9ob3N0LCBtYWluX3BvcnQpCiAgICAgICAgZmFsbGJhY2tfb2sgPSBjYW5fY29ubmVjdChmYWxsYmFja19ob3N0LCBmYWxsYmFja19wb3J0KQoKICAgICAgICBpZiBtYWluX29rOgogICAgICAgICAgICBjb25uZWN0X2hvc3QgPSBtYWluX2hvc3QKICAgICAgICAgICAgY29ubmVjdF9wb3J0ID0gbWFpbl9wb3J0CiAgICAgICAgZWxpZiBmYWxsYmFja19vazoKICAgICAgICAgICAgY29ubmVjdF9ob3N0ID0gZmFsbGJhY2tfaG9zdAogICAgICAgICAgICBjb25uZWN0X3BvcnQgPSBmYWxsYmFja19wb3J0CiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIGvhur90IG7hu5FpIMSRxrDhu6NjIHNvY2tldCB04bubaSBj4bqjIHttYWluX2hvc3R9OnttYWluX3BvcnR9IGzhuqtuIHtmYWxsYmFja19ob3N0fTp7ZmFsbGJhY2tfcG9ydH0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFThuqFvIGNsaWVudCBt4bubaSBu4bq/dSBjaMawYSBjw7MgaG/hurdjIGNsaWVudCBjxakgYuG7iyBs4buXaQogICAgICAgICAgICBpZiBzZWxmLmNsaWVudCBpcyBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5jbGllbnQgPSBzZWxmLl9jcmVhdGVfY2xpZW50KCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVzZXQgdHLhuqFuZyB0aMOhaQogICAgICAgICAgICBzZWxmLnN0b3BfZXZlbnQuY2xlYXIoKQogICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYubWFudWFsX2Rpc2Nvbm5lY3QgPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyBr4bq/dCBu4buRaSB04bubaSBNUVRUIGJyb2tlciB7Y29ubmVjdF9ob3N0fTp7Y29ubmVjdF9wb3J0fSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFPhu60gZOG7pW5nIGtlZXBhbGl2ZSBs4bubbiBoxqFuICgxMjAgZ2nDonkgdGhheSB2w6wgNjApCiAgICAgICAgICAgIHNlbGYuY2xpZW50LmNvbm5lY3RfYXN5bmMoY29ubmVjdF9ob3N0LCBjb25uZWN0X3BvcnQsIGtlZXBhbGl2ZT0xMjApCiAgICAgICAgICAgIHNlbGYuY2xpZW50Lmxvb3Bfc3RhcnQoKQoKICAgICAgICAgICAgZGVmIF93YWl0X2Nvbm5lY3RlZCh0aW1lb3V0X3NlYzogaW50ID0gMTUpIC0+IGJvb2w6CiAgICAgICAgICAgICAgICBmb3IgXyBpbiByYW5nZSh0aW1lb3V0X3NlYyk6CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgICAgICBpZiBfd2FpdF9jb25uZWN0ZWQoKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcgxJHhur9uIE1RVFQgYnJva2VyIHtjb25uZWN0X2hvc3R9Ontjb25uZWN0X3BvcnR9IikKICAgICAgICAgICAgICAgIHNlbGYuYnJva2VyX2FkZHJlc3MgPSBjb25uZWN0X2hvc3QKICAgICAgICAgICAgICAgIHNlbGYuYnJva2VyX3BvcnQgPSBjb25uZWN0X3BvcnQKICAgICAgICAgICAgICAgICMgUmVzZXQgcmVjb25uZWN0IGRlbGF5IGtoaSBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIHNlbGYucmVjb25uZWN0X2RlbGF5ID0gMQogICAgICAgICAgICAgICAgc2VsZi5yZWNvbm5lY3RfY291bnQgPSAwCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS+G6v3QgbuG7kWkgTVFUVCB0aOG6pXQgYuG6oWkgdOG7m2kge2Nvbm5lY3RfaG9zdH06e2Nvbm5lY3RfcG9ydH0iKQogICAgICAgICAgICAgICAgc2VsZi5fY2xlYW51cF9jbGllbnQoKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkga+G6v3QgbuG7kWkgTVFUVDoge3N0cihlKX0iKQogICAgICAgICAgICBzZWxmLl9jbGVhbnVwX2NsaWVudCgpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfY2xlYW51cF9jbGllbnQoc2VsZik6CiAgICAgICAgIiIiROG7jW4gZOG6uXAgTVFUVCBjbGllbnQiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIHNlbGYuY2xpZW50OgogICAgICAgICAgICAgICAgc2VsZi5jbGllbnQubG9vcF9zdG9wKCkKICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50LmRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgc2VsZi5jbGllbnQgPSBOb25lCiAgICAgICAgICAgIHNlbGYuaXNfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIGThu41uIGThurlwIE1RVFQgY2xpZW50OiB7ZX0iKQoKICAgIGRlZiBlbnN1cmVfY29ubmVjdGVkKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIixJDhuqNtIGLhuqNvIGvhur90IG7hu5FpIE1RVFQgdHLGsOG7m2Mga2hpIHRo4buxYyBoaeG7h24gY8OhYyB0aGFvIHTDoWMgduG7m2kgcmF0ZSBsaW1pdGluZyIiIgogICAgICAgIGlmIHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyDEkWFuZyB0cm9uZyBxdcOhIHRyw6xuaCByZWNvbm5lY3Qga2jDtG5nCiAgICAgICAgY3VycmVudF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICBpZiBjdXJyZW50X3RpbWUgLSBzZWxmLmxhc3RfZGlzY29ubmVjdF90aW1lIDwgNTogICMgQ2jhu50gw610IG5o4bqldCA1IGdpw6J5IHThu6sgbOG6p24gZGlzY29ubmVjdCBjdeG7kWkKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCLEkGFuZyB0cm9uZyB0aOG7nWkgZ2lhbiBjb29sZG93biByZWNvbm5lY3QsIGNo4budLi4uIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGxvZ2dlci53YXJuaW5nKCJNUVRUIGNoxrBhIGvhur90IG7hu5FpLCDEkWFuZyB0aOG7rSBr4bq/dCBu4buRaSBs4bqhaS4uLiIpCiAgICAgICAgcmV0dXJuIHNlbGYuY29ubmVjdCgpCgogICAgZGVmIF9vbl9jb25uZWN0KHNlbGYsIGNsaWVudCwgdXNlcmRhdGEsIGZsYWdzLCByYywgcHJvcGVydGllcz1Ob25lKToKICAgICAgICAiIiJDYWxsYmFjayBraGkga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nIiIiCiAgICAgICAgaWYgcmMgPT0gMDoKICAgICAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBUcnVlCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZyB04bubaSBNUVRUIGJyb2tlciIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQxINuZyBrw70gbmjhuq1uIHRhc2sKICAgICAgICAgICAgc2VsZi5jbGllbnQuc3Vic2NyaWJlKHNlbGYudG9waWNfc2VydmVyX3Rhc2ssIHFvcz0xKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgxJHEg25nIGvDvSBuaOG6rW4gdGFzayB04bqhaToge3NlbGYudG9waWNfc2VydmVyX3Rhc2t9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7rWkgdGjDtG5nIGLDoW8ga+G6v3QgbuG7kWkKICAgICAgICAgICAgc2VsZi5zZW5kX2Nvbm5lY3Rfbm90aWZpY2F0aW9uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVzZXQgcmVjb25uZWN0IGNvdW50ZXIga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZwogICAgICAgICAgICBzZWxmLnJlY29ubmVjdF9jb3VudCA9IDAKICAgICAgICAgICAgc2VsZi5yZWNvbm5lY3RfZGVsYXkgPSAxCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS+G6v3QgbuG7kWkgTVFUVCB0aOG6pXQgYuG6oWkgduG7m2kgbcOjIGzhu5dpOiB7cmN9IikKICAgICAgICAgICAgIyBUxINuZyByZWNvbm5lY3QgY291bnQga2hpIGvhur90IG7hu5FpIHRo4bqldCBi4bqhaQogICAgICAgICAgICBzZWxmLnJlY29ubmVjdF9jb3VudCArPSAxCgogICAgZGVmIF9vbl9kaXNjb25uZWN0KHNlbGYsIGNsaWVudCwgdXNlcmRhdGEsIHJjLCBwcm9wZXJ0aWVzPU5vbmUsIHJlYXNvbl9jb2RlPU5vbmUsICoqa3dhcmdzKToKICAgICAgICAiIiJDYWxsYmFjayBraGkgbmfhuq90IGvhur90IG7hu5FpIHbhu5tpIGPGoSBjaOG6vyByZWNvbm5lY3QgdGjDtG5nIG1pbmgiIiIKICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5sYXN0X2Rpc2Nvbm5lY3RfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgCiAgICAgICAgaWYgc2VsZi5tYW51YWxfZGlzY29ubmVjdDoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mgbmfhuq90IGvhur90IG7hu5FpIE1RVFQgdGhlbyB5w6p1IGPhuqd1IikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgIGlmIHJjICE9IDA6CiAgICAgICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ICs9IDEKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJOZ+G6r3Qga+G6v3QgbuG7kWkgTVFUVCBraMO0bmcgbW9uZyBtdeG7kW4gbOG6p24ge3NlbGYucmVjb25uZWN0X2NvdW50fSB24bubaSBtw6MgbOG7l2k6IHtyY30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaOG7iSBhdXRvLXJlY29ubmVjdCBu4bq/dSBraMO0bmcgcGjhuqNpIG1hbnVhbCBkaXNjb25uZWN0CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnN0b3BfZXZlbnQuaXNfc2V0KCk6CiAgICAgICAgICAgICAgICBzZWxmLl9zY2hlZHVsZV9yZWNvbm5lY3QoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIG5n4bqvdCBr4bq/dCBu4buRaSBNUVRUIikKCiAgICBkZWYgX3NjaGVkdWxlX3JlY29ubmVjdChzZWxmKToKICAgICAgICAiIiJMw6puIGzhu4tjaCBr4bq/dCBu4buRaSBs4bqhaSB24bubaSBleHBvbmVudGlhbCBiYWNrb2ZmIiIiCiAgICAgICAgIyBUw61uaCBkZWxheSB24bubaSBleHBvbmVudGlhbCBiYWNrb2ZmCiAgICAgICAgZGVsYXkgPSBtaW4oc2VsZi5yZWNvbm5lY3RfZGVsYXkgKiAoMiAqKiBtaW4oc2VsZi5yZWNvbm5lY3RfY291bnQgLSAxLCA2KSksIHNlbGYubWF4X3JlY29ubmVjdF9kZWxheSkKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmIlPhur0gdGjhu60ga+G6v3QgbuG7kWkgbOG6oWkgc2F1IHtkZWxheX0gZ2nDonkuLi4iKQogICAgICAgIAogICAgICAgIGRlZiByZWNvbm5lY3RfYWZ0ZXJfZGVsYXkoKToKICAgICAgICAgICAgaWYgbm90IHNlbGYuc3RvcF9ldmVudC53YWl0KGRlbGF5KTogICMgQ2jhu50gZGVsYXkgc2Vjb25kcywgdHLhu6sga2hpIGLhu4sgc3RvcAogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuaXNfY29ubmVjdGVkIGFuZCBub3Qgc2VsZi5tYW51YWxfZGlzY29ubmVjdDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlRo4butIGvhur90IG7hu5FpIGzhuqFpIE1RVFQgKGzhuqduIHtzZWxmLnJlY29ubmVjdF9jb3VudH0pIikKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmNvbm5lY3QoKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkvhur90IG7hu5FpIGzhuqFpIE1RVFQgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIE7hur91IHbhuqtuIHRo4bqldCBi4bqhaSwgbMOqbiBs4buLY2ggdGjhu60gbOG6oWkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5yZWNvbm5lY3RfY291bnQgPCAxMDogICMgR2nhu5tpIGjhuqFuIHPhu5EgbOG6p24gdGjhu60KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3NjaGVkdWxlX3JlY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIsSQw6MgdGjhu60ga+G6v3QgbuG7kWkgbOG6oWkgTVFUVCBxdcOhIG5oaeG7gXUgbOG6p24sIHThuqFtIGThu6tuZyBhdXRvLXJlY29ubmVjdCIpCiAgICAgICAgCiAgICAgICAgIyBDaOG6oXkgdHJvbmcgdGhyZWFkIHJpw6puZyDEkeG7gyBraMO0bmcgYmxvY2sKICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1yZWNvbm5lY3RfYWZ0ZXJfZGVsYXksIGRhZW1vbj1UcnVlKS5zdGFydCgpCgogICAgZGVmIF9zYWZlX3B1Ymxpc2goc2VsZiwgdG9waWM6IHN0ciwgcGF5bG9hZDogc3RyLCBxb3M6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgR+G7rWkgbWVzc2FnZSBhbiB0b8OgbiB24bubaSBraeG7g20gdHJhIGvhur90IG7hu5FpIHRyxrDhu5tjIGtoaSBwdWJsaXNoCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdG9waWM6IE1RVFQgdG9waWMKICAgICAgICAgICAgcGF5bG9hZDogTuG7mWkgZHVuZyBtZXNzYWdlIChzdHJpbmcpCiAgICAgICAgICAgIHFvczogUXVhbGl0eSBvZiBTZXJ2aWNlICgwLCAxLCBob+G6t2MgMikKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBn4butaSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2Nvbm5lY3RlZCgpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGfhu61pIG1lc3NhZ2UgxJHhur9uIHt0b3BpY306IE1RVFQgY2jGsGEga+G6v3QgbuG7kWkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICByZXN1bHQgPSBzZWxmLmNsaWVudC5wdWJsaXNoKHRvcGljLCBwYXlsb2FkLCBxb3M9cW9zKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0LnJjID09IG1xdHQuTVFUVF9FUlJfU1VDQ0VTUzoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBn4butaSBtZXNzYWdlIHRow6BuaCBjw7RuZyDEkeG6v24ge3RvcGljfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIG1lc3NhZ2UgxJHhur9uIHt0b3BpY306IHttcXR0LmVycm9yX3N0cmluZyhyZXN1bHQucmMpfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7rWkgbWVzc2FnZSDEkeG6v24ge3RvcGljfToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgc2VuZF90YXNrX3JlcG9ydChzZWxmLCB0YXNrX2lkOiBzdHIsIGRldmljZV9pZDogc3RyLCBzdGF0dXM6IHN0ciwgY2xpZW50X21lc3NhZ2U6IHN0ciA9ICIiKToKICAgICAgICAiIiJH4butaSBiw6FvIGPDoW8ga+G6v3QgcXXhuqMgdGjhu7FjIGhp4buHbiB0YXNrIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXBvcnRfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJ0YXNrX2lkIjogdGFza19pZCwKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiBkZXZpY2VfaWQsCiAgICAgICAgICAgICAgICAic3RhdHVzIjogc3RhdHVzLAogICAgICAgICAgICAgICAgImNsaWVudF9tZXNzYWdlIjogY2xpZW50X21lc3NhZ2UsCiAgICAgICAgICAgICAgICAidGltZXN0YW1wIjogaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiBzZWxmLl9zYWZlX3B1Ymxpc2goImRuZHZpbmEvY2xpZW50L3Rhc2tfcmVwb3J0IiwganNvbi5kdW1wcyhyZXBvcnRfZGF0YSkpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGfhu61pIGLDoW8gY8OhbyB0YXNrIHt0YXNrX2lkfSB24bubaSB0cuG6oW5nIHRow6FpIHtzdGF0dXN9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4butaSBiw6FvIGPDoW8gdGFzazoge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgc2VuZF9jb25uZWN0X25vdGlmaWNhdGlvbihzZWxmKToKICAgICAgICAiIiJH4butaSB0aMO0bmcgYsOhbyBr4bq/dCBu4buRaSDEkeG6v24gc2VydmVyIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb25uZWN0X2RhdGEgPSB7CiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogc2VsZi5kZXZpY2VfaWQsCiAgICAgICAgICAgICAgICAidGltZXN0YW1wIjogaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiBzZWxmLl9zYWZlX3B1Ymxpc2goImRuZHZpbmEvY2xpZW50L2Nvbm5lY3QiLCBqc29uLmR1bXBzKGNvbm5lY3RfZGF0YSkpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpIGNobyB0aGnhur90IGLhu4sge3NlbGYuZGV2aWNlX2lkfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7rWkgdGjDtG5nIGLDoW8ga+G6v3QgbuG7kWk6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIHJlZ2lzdGVyX3Rhc2tfaGFuZGxlcihzZWxmLCB0YXNrX3R5cGU6IHN0ciwgaGFuZGxlcjogQ2FsbGFibGUpOgogICAgICAgICIiIgogICAgICAgIMSQxINuZyBrw70gaGFuZGxlciBjaG8gbG/huqFpIHRhc2sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX3R5cGU6IExv4bqhaSB0YXNrCiAgICAgICAgICAgIGhhbmRsZXI6IEjDoG0geOG7rSBsw70gdGFzawogICAgICAgICIiIgogICAgICAgIHNlbGYudGFza19oYW5kbGVyc1t0YXNrX3R5cGVdID0gaGFuZGxlcgogICAgCiAgICBkZWYgc3luY19kYXRhKHNlbGYpOgogICAgICAgICIiIsSQ4buTbmcgYuG7mSBk4buvIGxp4buHdSB24bubaSBzZXJ2ZXIiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTuG6v3UgY2jGsGEga+G6v3QgbuG7kWkgTVFUVCwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mQogICAgICAgICAgICBpZiBub3Qgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ2jGsGEga+G6v3QgbuG7kWkgTVFUVCwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGhlbHBlciBzZXJ2aWNlCiAgICAgICAgICAgIGhlbHBlciA9IHNlbGYuaGVscGVyX3NlcnZpY2UKICAgICAgICAgICAgaWYgbm90IGhlbHBlcjoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIGPDsyBoZWxwZXIgc2VydmljZSwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZAogICAgICAgICAgICBkZXZpY2VfaWQgPSBzZWxmLmRiLmdldF9vcl9jcmVhdGVfZGV2aWNlX2lkKCkKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pZDoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCBkZXZpY2VfaWQsIGtow7RuZyB0aOG7gyDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IE5vbmUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGV2aWNlX2luZm9fcmVzcG9uc2UgPSBoZWxwZXIuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBs4bqleSB0aMOgbmggY8O0bmcsIGzGsHUgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICAgICAgaWYgZGV2aWNlX2luZm9fcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvX3Jlc3BvbnNlOgogICAgICAgICAgICAgICAgICAgICMgTMawdSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iyB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zYXZlX2RldmljZV9pbmZvKGRldmljZV9pbmZvX3Jlc3BvbnNlWyJkYXRhIl0pCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBkZXZpY2VfaW5mb19yZXNwb25zZVsiZGF0YSJdCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBs4bqleSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7izoge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYyB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iywgc+G7rSBk4bulbmcgdGjDtG5nIHRpbiDEkcOjIGzGsHUgdHJvbmcgZGF0YWJhc2UKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmRiLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgdGjDtG5nIHRpbiB0aGnhur90IGLhu4ssIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSBjw7MgdGjhu4Mga2jDtG5nIMSR4bqneSDEkeG7pyIpCiAgICAgICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAgICAgZGV2aWNlX2NvbmZpZyA9IHNlbGYuZGIuZ2V0X2FsbF9kZXZpY2VfY29uZmlnKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7mXAgY8OhYyB0cuG6oW5nIHRow6FpIHJ1bnRpbWUgKHBhdXNlX2pvYiwgZGV2aWNlX2lzX3dvcmtpbmcsIGRldmljZV9tZXNzYWdlKSB2w6BvIGRldmljZV9pbmZvCiAgICAgICAgICAgIGZvciBydW50aW1lX2tleSBpbiBbInBhdXNlX2pvYiIsICJkZXZpY2VfaXNfd29ya2luZyIsICJkZXZpY2VfbWVzc2FnZSJdOgogICAgICAgICAgICAgICAgaWYgcnVudGltZV9rZXkgaW4gZGV2aWNlX2NvbmZpZzoKICAgICAgICAgICAgICAgICAgICBkZXZpY2VfaW5mb1tydW50aW1lX2tleV0gPSBkZXZpY2VfY29uZmlnLnBvcChydW50aW1lX2tleSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBHacOhIHRy4buLIG3hurdjIMSR4buLbmggbuG6v3UgY2jGsGEgY+G6pXUgaMOsbmgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VfaW5mb1tydW50aW1lX2tleV0gPSBGYWxzZSBpZiBydW50aW1lX2tleSAhPSAiZGV2aWNlX21lc3NhZ2UiIGVsc2UgIiIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTG/huqFpIGLhu48gZ29saWtlX3JlcG9ydCBraOG7j2kgZGV2aWNlX2NvbmZpZyDEkeG7gyBn4butaSByacOqbmcKICAgICAgICAgICAgZ29saWtlX3JlcG9ydCA9IE5vbmUKICAgICAgICAgICAgaWYgImdvbGlrZV9yZXBvcnQiIGluIGRldmljZV9jb25maWc6CiAgICAgICAgICAgICAgICBnb2xpa2VfcmVwb3J0ID0gZGV2aWNlX2NvbmZpZy5wb3AoImdvbGlrZV9yZXBvcnQiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBnb2xpa2VfYXBpX2Jhc2Uga2jhu49pIGRldmljZV9jb25maWcKICAgICAgICAgICAgaWYgImdvbGlrZV9hcGlfYmFzZSIgaW4gZGV2aWNlX2NvbmZpZzoKICAgICAgICAgICAgICAgIGRldmljZV9jb25maWcucG9wKCJnb2xpa2VfYXBpX2Jhc2UiKQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCLEkMOjIGxv4bqhaSBi4buPIGdvbGlrZV9hcGlfYmFzZSBraOG7j2kgZOG7ryBsaeG7h3UgxJHhu5NuZyBi4buZIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGPDoWMgdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICAgICBwZW5kaW5nX2FjY291bnRzID0gc2VsZi5kYi5nZXRfcGVuZGluZ19zeW5jX2l0ZW1zKCJhY2NvdW50cyIsIGxpbWl0PTUwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBjw6FjIGpvYiBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgcGVuZGluZ19qb2JzID0gc2VsZi5kYi5nZXRfcGVuZGluZ19zeW5jX2l0ZW1zKCJqb2JzX2hpc3RvcnkiLCBsaW1pdD01MCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHBheWxvYWQKICAgICAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiBkZXZpY2VfaWQsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2luZm8iOiBkZXZpY2VfaW5mbywKICAgICAgICAgICAgICAgICJkZXZpY2VfY29uZmlnIjogZGV2aWNlX2NvbmZpZywKICAgICAgICAgICAgICAgICJ0aW1lc3RhbXAiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gZ29saWtlX3JlcG9ydCBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgZ29saWtlX3JlcG9ydDoKICAgICAgICAgICAgICAgIHBheWxvYWRbImdvbGlrZV9yZXBvcnQiXSA9IGdvbGlrZV9yZXBvcnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIHTDoGkga2hv4bqjbiBjaMawYSDEkeG7k25nIGLhu5kgbuG6v3UgY8OzCiAgICAgICAgICAgIGlmIHBlbmRpbmdfYWNjb3VudHM6CiAgICAgICAgICAgICAgICBwYXlsb2FkWyJhY2NvdW50cyJdID0gcGVuZGluZ19hY2NvdW50cwogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkOG7k25nIGLhu5kge2xlbihwZW5kaW5nX2FjY291bnRzKX0gdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBqb2IgY2jGsGEgxJHhu5NuZyBi4buZIG7hur91IGPDswogICAgICAgICAgICBpZiBwZW5kaW5nX2pvYnM6CiAgICAgICAgICAgICAgICBwYXlsb2FkWyJqb2JzIl0gPSBwZW5kaW5nX2pvYnMKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDhu5NuZyBi4buZIHtsZW4ocGVuZGluZ19qb2JzKX0gam9iIGNoxrBhIMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBH4butaSBk4buvIGxp4buHdQogICAgICAgICAgICBzZWxmLl9zYWZlX3B1Ymxpc2goY29uZmlnLk1RVFRfVE9QSUNfQ0xJRU5UX1NZTkMsIGpzb24uZHVtcHMocGF5bG9hZCkpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSB24bubaSBzZXJ2ZXIiKQogICAgCiAgICBkZWYgc3RhcnRfc3luY190aHJlYWQoc2VsZik6CiAgICAgICAgIiIiQuG6r3QgxJHhuqd1IHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIiIiCiAgICAgICAgaWYgc2VsZi5zeW5jX3RocmVhZCBpcyBub3QgTm9uZSBhbmQgc2VsZi5zeW5jX3RocmVhZC5pc19hbGl2ZSgpOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiVGhyZWFkIMSR4buTbmcgYuG7mSDEkcOjIMSRYW5nIGNo4bqheSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBzZWxmLnJ1bm5pbmcgPSBUcnVlCiAgICAgICAgc2VsZi5zdG9wX2V2ZW50LmNsZWFyKCkKICAgICAgICBzZWxmLnN5bmNfdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5fc3luY19sb29wLCBkYWVtb249VHJ1ZSkKICAgICAgICBzZWxmLnN5bmNfdGhyZWFkLnN0YXJ0KCkKICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBraOG7n2kgxJHhu5luZyB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIpCiAgICAKICAgIGRlZiBfc3luY19sb29wKHNlbGYpOgogICAgICAgICIiIkxvb3AgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIiIgogICAgICAgIGxvZ2dlci5pbmZvKGYiQuG6r3QgxJHhuqd1IMSR4buTbmcgYuG7mSB04buxIMSR4buZbmcgbeG7l2kge3NlbGYuc3luY19pbnRlcnZhbH0gZ2nDonkiKQoKICAgICAgICB3aGlsZSBub3Qgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpIGFuZCBzZWxmLnJ1bm5pbmc6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc3luY19kYXRhKCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgdHJvbmcgcXXDoSB0csOsbmggxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZzoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmdo4buJIMSR4bq/biBs4bqnbiDEkeG7k25nIGLhu5kgdGnhur9wIHRoZW8KICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2Uoc2VsZi5zeW5jX2ludGVydmFsKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuc3RvcF9ldmVudC5pc19zZXQoKSBvciBub3Qgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAKICAgIGRlZiBzdG9wX3N5bmNfdGhyZWFkKHNlbGYpOgogICAgICAgICIiIkThu6tuZyB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIiIgogICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgc2VsZi5zdG9wX2V2ZW50LnNldCgpCiAgICAgICAgaWYgc2VsZi5zeW5jX3RocmVhZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5zeW5jX3RocmVhZC5qb2luKHRpbWVvdXQ9Mi4wKQogICAgICAgICAgICBzZWxmLnN5bmNfdGhyZWFkID0gTm9uZQogICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGThu6tuZyB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIpCiAgICAKICAgIGRlZiBkaXNjb25uZWN0KHNlbGYpOgogICAgICAgICIiIk5n4bqvdCBr4bq/dCBu4buRaSBNUVRUIiIiCiAgICAgICAgc2VsZi5tYW51YWxfZGlzY29ubmVjdCA9IFRydWUgICMgxJDDoW5oIGThuqV1IMSRw6J5IGzDoCBkaXNjb25uZWN0IGPDsyBjaOG7pyDDvQogICAgICAgIHNlbGYuc3RvcF9zeW5jX3RocmVhZCgpCiAgICAgICAgCiAgICAgICAgaWYgc2VsZi5jbGllbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuY2xpZW50Lmxvb3Bfc3RvcCgpCiAgICAgICAgICAgIHNlbGYuY2xpZW50LmRpc2Nvbm5lY3QoKQogICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIG5n4bqvdCBr4bq/dCBu4buRaSBNUVRUIikKICAgICAgICAKICAgICAgICAjIEThu6tuZyB04bqldCBj4bqjIGF1dG8tcmVjb25uZWN0CiAgICAgICAgc2VsZi5zdG9wX2V2ZW50LnNldCgpCiAgICAKICAgIGRlZiBzZXR1cF9tcXR0X2hhbmRsZXJzKHNlbGYpOgogICAgICAgICIiIlRoaeG6v3QgbOG6rXAgY8OhYyBoYW5kbGVyIGNobyBNUVRUIHRhc2tzIiIiCiAgICAgICAgIyDEkMSDbmcga8O9IGPDoWMgdGFzayBoYW5kbGVyIG3hurdjIMSR4buLbmgKICAgICAgICBzZWxmLnJlZ2lzdGVyX3Rhc2tfaGFuZGxlcigidXBkYXRlX2NvbmZpZyIsIHNlbGYuX2hhbmRsZV91cGRhdGVfZGV2aWNlX2NvbmZpZykKICAgICAgICBzZWxmLnJlZ2lzdGVyX3Rhc2tfaGFuZGxlcigidXBkYXRlX3N5bmNlZCIsIHNlbGYuX2hhbmRsZV91cGRhdGVfc3luY2VkKQogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJhY2NvdW50X3VwZGF0ZSIsIHNlbGYuX2hhbmRsZV9hY2NvdW50X3VwZGF0ZSkKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbygixJDDoyB0aGnhur90IGzhuq1wIGPDoWMgTVFUVCB0YXNrIGhhbmRsZXIiKQogICAgICAgIAogICAgZGVmIF9oYW5kbGVfdXBkYXRlX2RldmljZV9jb25maWcoc2VsZiwgdGFza19kYXRhKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX2RhdGE6IEThu68gbGnhu4d1IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIHnDqnUgY+G6p3UgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyB04burIHNlcnZlciAodGFza19pZDoge3Rhc2tfaWR9KSIpCiAgICAgICAgICAgIGNvbmZpZ19kYXRhID0gdGFza19kYXRhLmdldCgiY29uZmlnX2RhdGEiLCB7fSkKICAgICAgICAgICAgaWYgbm90IGNvbmZpZ19kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkThu68gbGnhu4d1IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyBy4buXbmciKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsICJE4buvIGxp4buHdSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgcuG7l25nIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IHThu6tuZyBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAgICAgc3VjY2VzcyA9IHNlbGYuZGIuc2F2ZV9kZXZpY2VfY29uZmlnKGNvbmZpZ19kYXRhKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLOiB7JywgJy5qb2luKGNvbmZpZ19kYXRhLmtleXMoKSl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgc3luY19pbnRlcnZhbCBu4bq/dSBuw7MgdGhheSDEkeG7lWkKICAgICAgICAgICAgICAgIGlmICJzeW5jX2ludGVydmFsIiBpbiBjb25maWdfZGF0YToKICAgICAgICAgICAgICAgICAgICBuZXdfc3luY19pbnRlcnZhbCA9IGNvbmZpZ19kYXRhWyJzeW5jX2ludGVydmFsIl0KICAgICAgICAgICAgICAgICAgICBpZiBuZXdfc3luY19pbnRlcnZhbCAhPSBzZWxmLnN5bmNfaW50ZXJ2YWw6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiQ+G6rXAgbmjhuq10IHN5bmNfaW50ZXJ2YWwgdOG7qyB7c2VsZi5zeW5jX2ludGVydmFsfSB0aMOgbmgge25ld19zeW5jX2ludGVydmFsfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3luY19pbnRlcnZhbCA9IG5ld19zeW5jX2ludGVydmFsCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEto4bufaSDEkeG7mW5nIGzhuqFpIHRocmVhZCDEkeG7k25nIGLhu5kgbuG6v3UgxJFhbmcgY2jhuqF5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuc3luY190aHJlYWQgaXMgbm90IE5vbmUgYW5kIHNlbGYuc3luY190aHJlYWQuaXNfYWxpdmUoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJLaOG7n2kgxJHhu5luZyBs4bqhaSB0aHJlYWQgxJHhu5NuZyBi4buZIHbhu5tpIGtob+G6o25nIHRo4budaSBnaWFuIG3hu5tpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3RvcF9zeW5jX3RocmVhZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0X3N5bmNfdGhyZWFkKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaMO0bmcgYsOhbyBjaG8gSm9iU2VydmljZSBu4bq/dSBjw7MgdGhheSDEkeG7lWkgbGnDqm4gcXVhbiDEkeG6v24gam9icwogICAgICAgICAgICAgICAgam9iX3JlbGF0ZWRfa2V5cyA9IFsibWF4X2pvYnNfcGVyX2RheSIsICJtYXhfam9ic19wZXJfc2Vzc2lvbiIsICJqb2JfaW50ZXJ2YWxfc2Vjb25kcyIsImNhcmVfaW5fd29ya2luZ19qb2IiXQogICAgICAgICAgICAgICAgaWYgYW55KGtleSBpbiBjb25maWdfZGF0YSBmb3Iga2V5IGluIGpvYl9yZWxhdGVkX2tleXMpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLDgXAgZOG7pW5nIGPhuqV1IGjDrG5oIG3hu5tpIGNobyBKb2JTZXJ2aWNlIikKICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyBj4bqnbiBraOG7n2kgxJHhu5luZyBs4bqhaSwgSm9iU2VydmljZSBz4bq9IGzhuqV5IGPhuqV1IGjDrG5oIG3hu5tpIGtoaSBj4bqnbgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEfhu61pIGLDoW8gY8OhbyB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJzdWNjZXNzIiwgZiLEkMOjIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4s6IHsnLCAnLmpvaW4oY29uZmlnX2RhdGEua2V5cygpKX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSAiS2jDtG5nIHRo4buDIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4siCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIHjhu60gbMO9IGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4s6IHtzdHIoZSl9IgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICB0YXNrX2lkID0gdGFza19kYXRhLmdldCgidGFza19pZCIpCiAgICAgICAgICAgIGRldmljZV9pZCA9IHRhc2tfZGF0YS5nZXQoImRldmljZV9pZCIpCiAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCgogICAgZGVmIF9oYW5kbGVfdXBkYXRlX3N5bmNlZChzZWxmLCB0YXNrX2RhdGEpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza19kYXRhOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2dnZXIuaW5mbygiTmjhuq1uIHnDqnUgY+G6p3UgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZIHThu6sgc2VydmVyIikKICAgICAgICAgICAgZGF0YSA9IHRhc2tfZGF0YS5nZXQoImRhdGEiLCB7fSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IHTDoGkga2hv4bqjbiDEkcOjIMSR4buTbmcgYuG7mQogICAgICAgICAgICBpZiAiYWNjb3VudHMiIGluIGRhdGEgYW5kIGlzaW5zdGFuY2UoZGF0YVsiYWNjb3VudHMiXSwgbGlzdCk6CiAgICAgICAgICAgICAgICBmb3IgYWNjb3VudF91dWlkIGluIGRhdGFbImFjY291bnRzIl06CiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5tYXJrX2FzX3N5bmNlZCgiYWNjb3VudHMiLCBhY2NvdW50X3V1aWQpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYixJDDoW5oIGThuqV1IHTDoGkga2hv4bqjbiDEkcOjIMSR4buTbmcgYuG7mToge2FjY291bnRfdXVpZH0iKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCB7bGVuKGRhdGFbJ2FjY291bnRzJ10pfSB0w6BpIGtob+G6o24gxJHDoyDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgam9iIMSRw6MgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIGlmICJqb2JzIiBpbiBkYXRhIGFuZCBpc2luc3RhbmNlKGRhdGFbImpvYnMiXSwgbGlzdCk6CiAgICAgICAgICAgICAgICBmb3Igam9iX3V1aWQgaW4gZGF0YVsiam9icyJdOgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIubWFya19hc19zeW5jZWQoImpvYnNfaGlzdG9yeSIsIGpvYl91dWlkKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIsSQw6FuaCBk4bqldSBqb2IgxJHDoyDEkeG7k25nIGLhu5k6IHtqb2JfdXVpZH0iKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCB7bGVuKGRhdGFbJ2pvYnMnXSl9IGpvYiDEkcOjIMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEhp4buDbiB0aOG7iyB0aMO0bmcgYsOhbyB04burIHNlcnZlciBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgIm1lc3NhZ2UiIGluIHRhc2tfZGF0YToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVGjDtG5nIGLDoW8gdOG7qyBzZXJ2ZXI6IHt0YXNrX2RhdGFbJ21lc3NhZ2UnXX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB44butIGzDvSBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5k6IHtzdHIoZSl9IikKICAgICAgICAgICAgCiAgICAKICAgIGRlZiBfaGFuZGxlX2FjY291bnRfdXBkYXRlKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayBj4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX2RhdGE6IEThu68gbGnhu4d1IHRhc2sgdOG7qyBzZXJ2ZXIgY8OzIGPhuqV1IHRyw7pjOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAidGFza19pZCI6ICJ0YXNrXzE3NDkzOTk1MzYyNzJfNjQxIiwKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiAiYTEyNWY2MjRmNDFhNGY3YyIsCiAgICAgICAgICAgICAgICAidGFza190eXBlIjogImFjY291bnRfdXBkYXRlIiwKICAgICAgICAgICAgICAgICJkYXRhIjogewogICAgICAgICAgICAgICAgICAgICJhcHAiOiAiaW5zdGFncmFtIiwKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogImluYWN0aXZlIiwKICAgICAgICAgICAgICAgICAgICAiam9iX21heF9kYXkiOiAxMDgsCiAgICAgICAgICAgICAgICAgICAgImpvYl90b2RheSI6IDMwLAogICAgICAgICAgICAgICAgICAgICJqb2JfZW5hYmxlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAiYWNjb3VudF91dWlkIjogIjdlZDk1NTdkLTc2YTQtNDdmNy04ODUwLTdjZWVmMGM2OTBhZiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibWVzc2FnZSI6ICIiLAogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJwZW5kaW5nIgogICAgICAgICAgICB9CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXNrX2lkID0gdGFza19kYXRhLmdldCgidGFza19pZCIpCiAgICAgICAgICAgIGRldmljZV9pZCA9IHRhc2tfZGF0YS5nZXQoImRldmljZV9pZCIpCiAgICAgICAgICAgIGRhdGEgPSB0YXNrX2RhdGEuZ2V0KCJkYXRhIiwge30pCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5o4bqtbiB5w6p1IGPhuqd1IGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24gdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGRhdGEgb3IgImFjY291bnRfdXVpZCIgbm90IGluIGRhdGE6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiROG7ryBsaeG7h3UgdMOgaSBraG/huqNuIGtow7RuZyBo4bujcCBs4buHIikKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCAiROG7ryBsaeG7h3UgdMOgaSBraG/huqNuIGtow7RuZyBo4bujcCBs4buHIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdMOgaSBraG/huqNuIHThu6sgREIKICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnRfYnlfdXVpZChkYXRhWyJhY2NvdW50X3V1aWQiXSkKICAgICAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gduG7m2kgVVVJRDoge2RhdGFbJ2FjY291bnRfdXVpZCddfSIKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICB1cGRhdGVfZGF0YSA9IHt9CiAgICAgICAgICAgIHZhbGlkX2ZpZWxkcyA9IFsic3RhdHVzIiwgImpvYl9tYXhfZGF5IiwgIm1heF9qb2JzX3Blcl9zZXNzaW9uIiwgImpvYl9lbmFibGUiLCJqb2JfZGlzYWJsZV91bnRpbCIsIm1heF9mb2xsb3dfc2Vzc2lvbiIsIm1heF9mb2xsb3dfZGF5IiwiZGlzYWJsZV9mb2xsb3ciXQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZGF0YS5pdGVtcygpOgogICAgICAgICAgICAgICAgaWYga2V5IGluIHZhbGlkX2ZpZWxkczoKICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YVtrZXldID0gdmFsdWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHVwZGF0ZV9kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgdGjDtG5nIHRpbiBj4bqnbiBj4bqtcCBuaOG6rXQiKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsICJLaMO0bmcgY8OzIHRow7RuZyB0aW4gY+G6p24gY+G6rXAgbmjhuq10IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgbOG6oWkgdsOgbyBEQgogICAgICAgICAgICB1cGRhdGVfZGF0YVsiaXNfc3luYyJdID0gRmFsc2UKICAgICAgICAgICAgc3VjY2VzcyA9IHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnJyl9IChVVUlEOiB7ZGF0YVsnYWNjb3VudF91dWlkJ119KSB24bubaSBk4buvIGxp4buHdToge3VwZGF0ZV9kYXRhfSIpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAic3VjY2VzcyIsIGYixJDDoyBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJycpfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIktow7RuZyB0aOG7gyBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJycpfSIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIHjhu60gbMO9IGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o246IHtzdHIoZSl9IgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQoKICAgIGRlZiBzdGFydChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgxJHhu5luZyBNUVRUIHNlcnZpY2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGto4bufaSDEkeG7mW5nIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRoaeG6v3QgbOG6rXAgY8OhYyBoYW5kbGVyIHRyxrDhu5tjIGtoaSBr4bq/dCBu4buRaQogICAgICAgICAgICBzZWxmLnNldHVwX21xdHRfaGFuZGxlcnMoKQogICAgICAgICAgICBzZWxmLmNvbm5lY3QoKQogICAgICAgICAgICAjIEto4bufaSDEkeG7mW5nIHN5bmMgdGhyZWFkIHNhdSBraGkga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgIHNlbGYuc3RhcnRfc3luY190aHJlYWQoKQogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBraOG7n2kgxJHhu5luZyBNUVRUIHNlcnZpY2UgdsOgIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGto4bufaSDEkeG7mW5nIE1RVFQgc2VydmljZSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfb25fbWVzc2FnZShzZWxmLCBjbGllbnQsIHVzZXJkYXRhLCBtc2csIHByb3BlcnRpZXM9Tm9uZSk6CiAgICAgICAgIiIiCiAgICAgICAgQ2FsbGJhY2sga2hpIG5o4bqtbiDEkcaw4bujYyBtZXNzYWdlIHThu6sgTVFUVCBicm9rZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBjbGllbnQ6IE1RVFQgY2xpZW50IGluc3RhbmNlCiAgICAgICAgICAgIHVzZXJkYXRhOiBVc2VyIGRhdGEgxJHGsOG7o2MgdHJ1eeG7gW4gdsOgbyBjbGllbnQKICAgICAgICAgICAgbXNnOiBNZXNzYWdlIG9iamVjdCBjaOG7qWEgdG9waWMgdsOgIHBheWxvYWQKICAgICAgICAgICAgcHJvcGVydGllczogUHJvcGVydGllcyBj4bunYSBtZXNzYWdlIChNUVRUIHY1KQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gbWVzc2FnZSB04burIHRvcGljOiB7bXNnLnRvcGljfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFBhcnNlIHBheWxvYWQgSlNPTgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBwYXlsb2FkID0ganNvbi5sb2Fkcyhtc2cucGF5bG9hZC5kZWNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBwYXJzZSBKU09OIHThu6sgcGF5bG9hZDoge21zZy5wYXlsb2FkfSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgWOG7rSBsw70gbWVzc2FnZSBk4buxYSB0csOqbiB0b3BpYwogICAgICAgICAgICBpZiBtc2cudG9waWMgPT0gc2VsZi50b3BpY19zZXJ2ZXJfdGFzazoKICAgICAgICAgICAgICAgIHNlbGYuX2hhbmRsZV9zZXJ2ZXJfdGFzayhwYXlsb2FkKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJOaOG6rW4gbWVzc2FnZSB04burIHRvcGljIGtow7RuZyB4w6FjIMSR4buLbmg6IHttc2cudG9waWN9IikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgeOG7rSBsw70gbWVzc2FnZToge3N0cihlKX0iKQoKICAgIGRlZiBfaGFuZGxlX3NlcnZlcl90YXNrKHNlbGYsIHBheWxvYWQ6IERpY3Rbc3RyLCBBbnldKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIHThu6sgc2VydmVyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGF5bG9hZDogROG7ryBsaeG7h3UgdGFzayB04burIHNlcnZlcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgdGFza190eXBlID0gcGF5bG9hZC5nZXQoInRhc2tfdHlwZSIpCiAgICAgICAgICAgIGlmIG5vdCB0YXNrX3R5cGU6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiTmjhuq1uIHRhc2sga2jDtG5nIGPDsyB0YXNrX3R5cGUiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5o4bqtbiB0YXNrIHThu6sgc2VydmVyOiB7dGFza190eXBlfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIGhhbmRsZXIgdMawxqFuZyDhu6luZyBu4bq/dSDEkcOjIMSRxINuZyBrw70KICAgICAgICAgICAgaWYgdGFza190eXBlIGluIHNlbGYudGFza19oYW5kbGVyczoKICAgICAgICAgICAgICAgIHNlbGYudGFza19oYW5kbGVyc1t0YXNrX3R5cGVdKHBheWxvYWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSBoYW5kbGVyIGNobyB0YXNrX3R5cGU6IHt0YXNrX3R5cGV9IikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB44butIGzDvSB0YXNrIHThu6sgc2VydmVyOiB7c3RyKGUpfSIp').decode('utf-8'))
