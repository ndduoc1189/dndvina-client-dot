import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHJlCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBvcwppbXBvcnQgY29uZmlnCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCBxdW90ZSwgdW5xdW90ZQpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBPcHRpb25hbCwgVHVwbGUsIExpc3QsIFVuaW9uCnRyeToKICAgIGZyb20gbHhtbCBpbXBvcnQgZXRyZWUKICAgIExYTUxfQVZBSUxBQkxFID0gVHJ1ZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBMWE1MX0FWQUlMQUJMRSA9IEZhbHNlCgpjbGFzcyBIZWxwZXJTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGJhc2VfdXJsOiBzdHIgPSAiaHR0cDovL2xvY2FsaG9zdDo4MDgwIik6CiAgICAgICAgc2VsZi5iYXNlX3VybCA9IGJhc2VfdXJsCiAgICAgICAgc2VsZi5pc19hZGJfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICBzZWxmLmRldmljZV9pcCA9IE5vbmUKICAgICAgICAKICAgICAgICAjIE7hur91IGJhc2VfdXJsIGNo4bupYSDEkeG7i2EgY2jhu4kgSVAsIHRo4butIGvhur90IG7hu5FpIEFEQgogICAgICAgIGlwX21hdGNoID0gcmUuc2VhcmNoKHIiaHR0cDovLyhbMC05XStcLlswLTldK1wuWzAtOV0rXC5bMC05XSspIiwgYmFzZV91cmwpCiAgICAgICAgaWYgaXBfbWF0Y2g6CiAgICAgICAgICAgIHNlbGYuZGV2aWNlX2lwID0gaXBfbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgc2VsZi5jaGVja19hbmRfY29ubmVjdF9hZGIoKQoKICAgIGRlZiBjaGVja19hbmRfY29ubmVjdF9hZGIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHbDoCBr4bq/dCBu4buRaSBBREIgdOG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgQURCIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBraMO0bmcKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJhZGIiLCAiLS12ZXJzaW9uIl0sIGNoZWNrPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEvhur90IG7hu5FpIEFEQiDEkeG6v24gdGhp4bq/dCBi4buLIHPhu60gZOG7pW5nIMSR4buLYSBjaOG7iSB04burIGNvbmZpZwogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIMSR4bq/biB0aGnhur90IGLhu4sKICAgICAgICAgICAgY29ubmVjdF9wcm9jZXNzID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbImFkYiIsICJjb25uZWN0IiwgYWRiX2FkZHJlc3NdLAogICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyBr4bq/dCBu4buRaQogICAgICAgICAgICBpZiAiY29ubmVjdGVkIiBpbiBjb25uZWN0X3Byb2Nlc3Muc3Rkb3V0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBUcnVlCiAgICAgICAgICAgICAgICBwcmludChmIsSQw6Mga+G6v3QgbuG7kWkgQURCIHRow6BuaCBjw7RuZyDEkeG6v24ge2FkYl9hZGRyZXNzfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IChzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciwgRmlsZU5vdEZvdW5kRXJyb3IpIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIEFEQjoge2V9IikKICAgICAgICAKICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfZ2V0X2FkYl9kZXZpY2VfcGFyYW0oc2VsZikgLT4gTGlzdFtzdHJdOgogICAgICAgICIiIgogICAgICAgIFRy4bqjIHbhu4EgdGhhbSBz4buRIHRoaeG6v3QgYuG7iyBjaG8gbOG7h25oIEFEQgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3Rbc3RyXTogRGFuaCBzw6FjaCBbLXMsIGRldmljZV9pZF0gaG/hurdjIGxpc3QgcuG7l25nIG7hur91IGtow7RuZyBjw7MgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIHJldHVybiBbIi1zIiwgYWRiX2FkZHJlc3NdCiAgICAgICAgcmV0dXJuIFtdCgogICAgZGVmIF9tYWtlX3JlcXVlc3Qoc2VsZiwgZW5kcG9pbnQ6IHN0ciwgcGFyYW1zOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gcmVxdWVzdCBBUEkgdsOgIHRy4bqjIHbhu4Ega+G6v3QgcXXhuqMgZOG6oW5nIEpTT04gaG/hurdjIFhNTAogICAgICAgICIiIgogICAgICAgIHVybCA9IGYie3NlbGYuYmFzZV91cmx9L3tlbmRwb2ludH0iCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRoaeG6v3QgbOG6rXAgdGltZW91dCBjaG8gcmVxdWVzdAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIENvbnRlbnQtVHlwZQogICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICMgVHLhuqMgduG7gSBYTUwgZMaw4bubaSBk4bqhbmcgdGV4dAogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLnRleHR9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgSlNPTgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlRpbWVvdXQ6CiAgICAgICAgICAgIHByaW50KGYiUmVxdWVzdCB0aW1lb3V0IGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCIpCiAgICAgICAgICAgIHNlbGYuX3Jlc3RhcnRfaGVscGVyX2FwcCgpCiAgICAgICAgICAgICMgVGjhu60gbOG6oWkgcmVxdWVzdCBzYXUga2hpIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKSAgIyBDaOG7nSAxIGdpw6J5IMSR4buDIOG7qW5nIGThu6VuZyBraOG7n2kgxJHhu5luZwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJkYXRhIjogcmVzcG9uc2UudGV4dH0KICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIlbhuqtuIGzhu5dpIHNhdSBraGkgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvciBhcyBlOgogICAgICAgICAgICAjIELhuq90IGzhu5dpIGvhur90IG7hu5FpIGLhu4sgdOG7qyBjaOG7kWkgaG/hurdjIGtow7RuZyB0aOG7gyBr4bq/dCBu4buRaQogICAgICAgICAgICBwcmludChmIkzhu5dpIGvhur90IG7hu5FpIGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgc2VsZi5fcmVzdGFydF9oZWxwZXJfYXBwKCkKICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSByZXF1ZXN0IHNhdSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpICAjIENo4budIDIgZ2nDonkgxJHhu4Mg4bupbmcgZOG7pW5nIGto4bufaSDEkeG7mW5nCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29udGVudF90eXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICAgICAgaWYgJ2FwcGxpY2F0aW9uL3htbCcgaW4gY29udGVudF90eXBlIG9yIGVuZHBvaW50ID09ICdkdW1wLXNjcmVlbi14bWwnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgImRhdGEiOiByZXNwb25zZS50ZXh0fQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIHJlcXVlc3Q6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQoKICAgIGRlZiBfcmVzdGFydF9oZWxwZXJfYXBwKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBz4butIGThu6VuZyBBREIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgaGVscGVyIGFwcCBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCAiYW0iLCAic3RhcnQiLCAiLW4iLCAiY29tLmRuZHZpbmEuaGVscGVyLy5NYWluQWN0aXZpdHkiXQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcHJpbnQoIsSQw6Mga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIktow7RuZyB0aOG7gyBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHbDrCBBREIgY2jGsGEgxJHGsOG7o2Mga+G6v3QgbuG7kWkiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgdGFwKHNlbGYsIHg6IGludCwgeTogaW50KSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaOG6oW0gdsOgbyB24buLIHRyw60geCx5IHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJ0YXAiLCBwYXJhbXM9eyJ4IjogeCwgInkiOiB5fSkKCiAgICBkZWYgdGFwX2VsZW1lbnQoc2VsZiwgYm91bmRzOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIG3hu5l0IHBo4bqnbiB04butIGThu7FhIHRyw6puIGJvdW5kcyBj4bunYSBuw7MKICAgICAgICBGb3JtYXQgYm91bmRzOiAiW3gxLHkxXVt4Mix5Ml0iIGhv4bq3YyBlbGVtZW50IGRpY3QKICAgICAgICAiIiIKICAgICAgICAjIE7hur91IGJvdW5kcyBsw6AgbeG7mXQgZGljdCAoZWxlbWVudCksIGzhuqV5IGJvdW5kcyBzdHJpbmcgdOG7qyDEkcOzCiAgICAgICAgaWYgaXNpbnN0YW5jZShib3VuZHMsIGRpY3QpOgogICAgICAgICAgICBib3VuZHMgPSBib3VuZHMuZ2V0KCJib3VuZHMiLCAiWzAsMF1bMCwwXSIpCiAgICAgICAgICAgIAogICAgICAgICMgVGjhu60gY8OhYyBwYXR0ZXJuIGtow6FjIG5oYXUgxJHhu4MgcGFyc2UgYm91bmRzLCBjaG8gcGjDqXAgc+G7kSDDom0KICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgciJcWygtP1xkKyksKC0/XGQrKVxdXFsoLT9cZCspLCgtP1xkKylcXSIsICAjIFt4MSx5MV1beDIseTJdIHbhu5tpIHPhu5Egw6JtCiAgICAgICAgICAgIHIiKC0/XGQrKSwoLT9cZCspLCgtP1xkKyksKC0/XGQrKSIsICAgICAgICAgIyB4MSx5MSx4Mix5MgogICAgICAgICAgICByIlxbKC0/XGQrKTsoLT9cZCspXF1cWygtP1xkKyk7KC0/XGQrKVxdIiAgICMgW3gxO3kxXVt4Mjt5Ml0KICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUubWF0Y2gocGF0dGVybiwgYm91bmRzKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIHgxLCB5MSwgeDIsIHkyID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHByaW50KGYiT3JpZ2luYWwgYm91bmRzOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFPhu61hIGNo4buvYSBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4cKICAgICAgICAgICAgICAgIGlmIHkxIDwgMCBvciB5MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJGaXhpbmcgbmVnYXRpdmUgWSBjb29yZGluYXRlcy4uLiIpCiAgICAgICAgICAgICAgICAgICAgaWYgeTIgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBhYnMoeTIgLSB5MSkKICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSBtYXgoMCwgeTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHkyID0geTEgKyBoZWlnaHQKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJBZGp1c3RlZCBZOiB5MT17eTF9LCB5Mj17eTJ9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgeDEgPCAwIG9yIHgyIDwgMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkZpeGluZyBuZWdhdGl2ZSBYIGNvb3JkaW5hdGVzLi4uIikKICAgICAgICAgICAgICAgICAgICBpZiB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gYWJzKHgyIC0geDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gbWF4KDAsIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHgxICsgd2lkdGgKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJBZGp1c3RlZCBYOiB4MT17eDF9LCB4Mj17eDJ9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGJvdW5kcyBo4bujcCBs4buHIHNhdSBraGkgxJFp4buBdSBjaOG7iW5oCiAgICAgICAgICAgICAgICBpZiB4MSA+PSB4MiBvciB5MSA+PSB5MjoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkludmFsaWQgYm91bmRzIGFmdGVyIGFkanVzdG1lbnQ6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ2jhu41uIG3hu5l0IMSRaeG7g20gdHJvbmcgYm91bmRzIHbhu5tpIG1hcmdpbiBhbiB0b8OgbgogICAgICAgICAgICAgICAgbWFyZ2luID0gbWluKDMsICh4MiAtIHgxKSAvLyA0LCAoeTIgLSB5MSkgLy8gNCkgICMgRHluYW1pYyBtYXJnaW4KICAgICAgICAgICAgICAgIG1hcmdpbiA9IG1heCgxLCBtYXJnaW4pICAjIMONdCBuaOG6pXQgMXB4IG1hcmdpbgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB4ID0gcmFuZG9tLnJhbmRpbnQoeDEgKyBtYXJnaW4sIG1heCh4MSArIG1hcmdpbiArIDEsIHgyIC0gbWFyZ2luKSkKICAgICAgICAgICAgICAgIHkgPSByYW5kb20ucmFuZGludCh5MSArIG1hcmdpbiwgbWF4KHkxICsgbWFyZ2luICsgMSwgeTIgLSBtYXJnaW4pKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwcmludChmIkZpbmFsIHRhcCBjb29yZGluYXRlczogKHt4fSwge3l9KSB3aXRoIG1hcmdpbiB7bWFyZ2lufSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcCh4LCB5KQogICAgICAgIAogICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogZiLEkOG7i25oIGThuqFuZyBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4c6IHtib3VuZHN9In0KCiAgICBkZWYgc3dpcGVfdXAoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IGzDqm4gdOG7qyB24buLIHRyw60gbmfhuqt1IG5oacOqbiBwaMO5IGjhu6NwCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGVfdXAiKQoKICAgIGRlZiBzd2lwZV9kb3duKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCB4deG7kW5nIHThu6sgduG7iyB0csOtIG5n4bqrdSBuaGnDqm4gcGjDuSBo4bujcAogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX2Rvd24iKQoKICAgIGRlZiBpbnB1dF90ZXh0KHNlbGYsIHRleHQ6IHN0ciwgc3BlZWQ6IGZsb2F0ID0gMS4wLCAKICAgICAgICAgICAgICAgICAgZGlyZWN0X21vZGU6IGJvb2wgPSBGYWxzZSwgcGVyZmVjdF9tb2RlOiBib29sID0gVHJ1ZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTcO0IHBo4buPbmcgZ8O1IHBow61tIHbhu5tpIHThu5FjIMSR4buZIG5n4bqrdSBuaGnDqm4gZ2nhu5FuZyBuZ8aw4budaSB0aOG6rXQKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICJ0ZXh0IjogdGV4dCwKICAgICAgICAgICAgInNwZWVkIjogc3BlZWQsCiAgICAgICAgICAgICJkaXJlY3RfbW9kZSI6IHN0cihkaXJlY3RfbW9kZSkubG93ZXIoKSwKICAgICAgICAgICAgInBlcmZlY3RfbW9kZSI6IHN0cihwZXJmZWN0X21vZGUpLmxvd2VyKCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgiaW5wdXRfdGV4dCIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIHNob3dfdG9hc3Qoc2VsZiwgbWVzc2FnZTogc3RyLCB0eXBlXzogc3RyID0gImluZm8iLCAKICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHN0ciA9ICJib3R0b20iKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBIaeG7g24gdGjhu4sgdGjDtG5nIGLDoW8gdG9hc3QKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgInR5cGUiOiB0eXBlXywKICAgICAgICAgICAgInBvc2l0aW9uIjogcG9zaXRpb24KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgidG9hc3QtbWVzc2FnZSIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIGdldF9kZXZpY2VfaW5mbyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIGNoaSB0aeG6v3QgduG7gSB0aGnhur90IGLhu4sKICAgICAgICAiIiIKICAgICAgICByZXN1bHQgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImRldmljZS1pbmZvIikKICAgICAgICAKICAgICAgICAjIE7hur91IGvhur90IHF14bqjIHRow6BuaCBjw7RuZywgdGjDqm0gdGjDtG5nIHRpbiBpbnRlcm5ldCBJUAogICAgICAgIGlmIHJlc3VsdC5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIHJlc3VsdDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSBpbnRlcm5ldCBJUCBi4bqxbmcgcmVxdWVzdHMKICAgICAgICAgICAgICAgIGludGVybmV0X2lwID0gc2VsZi5fZ2V0X2ludGVybmV0X2lwKCkKICAgICAgICAgICAgICAgIGlmIGludGVybmV0X2lwOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJpbnRlcm5ldF9pcCJdID0gaW50ZXJuZXRfaXAKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bImludGVybmV0X2lwIl0gPSAidW5rbm93biIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgaW50ZXJuZXQgSVA6IHtlfSIpCiAgICAgICAgICAgICAgICByZXN1bHRbImRhdGEiXVsiaW50ZXJuZXRfaXAiXSA9ICJlcnJvciIKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAKICAgIGRlZiBfZ2V0X2ludGVybmV0X2lwKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSDEkeG7i2EgY2jhu4kgSVAgY8O0bmcgY+G7mW5nIGLhurFuZyByZXF1ZXN0cwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogxJDhu4thIGNo4buJIElQIGPDtG5nIGPhu5luZyBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIiwgdGltZW91dD0zKQogICAgICAgICAgICBpcCA9IHJlc3BvbnNlLnRleHQuc3RyaXAoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIMSR4buLbmggZOG6oW5nIElQIMSRxqFuIGdp4bqjbgogICAgICAgICAgICBpZiByZS5tYXRjaChyJ15cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9JCcsIGlwKToKICAgICAgICAgICAgICAgIHJldHVybiBpcAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJL4bq/dCBxdeG6oyBraMO0bmcgcGjhuqNpIGzDoCBJUCBo4bujcCBs4buHOiB7aXB9IikKICAgICAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuVGltZW91dDoKICAgICAgICAgICAgcHJpbnQoIlRpbWVvdXQga2hpIGzhuqV5IGludGVybmV0IElQICgzIGdpw6J5KSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgaW50ZXJuZXQgSVA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraMO0bmcgeMOhYyDEkeG7i25oIGtoaSBs4bqleSBpbnRlcm5ldCBJUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIGNoZWNrX2ludGVybmV0KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSBr4bq/dCBu4buRaSBpbnRlcm5ldAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIGvhur90IG7hu5FpIGludGVybmV0LCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVGjhu60ga+G6v3QgbuG7kWkgxJHhur9uIEdvb2dsZSBETlMgduG7m2kgdGltZW91dCBuZ+G6r24KICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vOC44LjguOCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFRo4butIHbhu5tpIG3hu5l0IGRvbWFpbiBraMOhYwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vd3d3Lmdvb2dsZS5jb20iLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGdldF9sb2NhbF9pcChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgxJHhu4thIGNo4buJIElQIGxvY2FsIGPhu6dhIHRoaeG6v3QgYuG7iyB04burIGRldmljZSBpbmZvCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiDEkOG7i2EgY2jhu4kgSVAgbG9jYWwgaG/hurdjIGNodeG7l2kgcuG7l25nIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgIGlmIGRldmljZV9pbmZvLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gZGV2aWNlX2luZm86CiAgICAgICAgICAgICAgICByZXR1cm4gZGV2aWNlX2luZm9bImRhdGEiXS5nZXQoImxvY2FsX2lwIiwgIiIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgbG9jYWwgSVA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBkdW1wX3NjcmVlbl94bWwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIER1bXAgdG/DoG4gYuG7mSBj4bqldSB0csO6YyBYTUwgY+G7p2EgbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBUcuG6oyB24buBIG7hu5lpIGR1bmcgWE1MIGTGsOG7m2kgZOG6oW5nIGNodeG7l2kKICAgICAgICAiIiIKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiZHVtcC1zY3JlZW4teG1sIikKICAgICAgICBpZiByZXNwb25zZVsic3RhdHVzIl0gPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXQogICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBvcGVuX2FwcChzZWxmLCBwYWNrYWdlOiBzdHIsIGFjdGl2aXR5OiBzdHIgPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBN4bufIG3hu5l0IOG7qW5nIGThu6VuZyB24bubaSBwYWNrYWdlIG5hbWUgdsOgIGFjdGl2aXR5IGPhu6UgdGjhu4MKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7InBhY2thZ2UiOiBwYWNrYWdlfQogICAgICAgIGlmIGFjdGl2aXR5OgogICAgICAgICAgICBwYXJhbXNbImFjdGl2aXR5Il0gPSBhY3Rpdml0eQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoIm9wZW5fYXBwIiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgY2xvc2VfYXBwKHNlbGYsIHBhY2thZ2U6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgxJDDs25nIG3hu5l0IOG7qW5nIGThu6VuZyDEkWFuZyBjaOG6oXkKICAgICAgICDGr3UgdGnDqm4gc+G7rSBk4bulbmcgQURCIG7hur91IMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICAiIiIKICAgICAgICBpZiBzZWxmLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkMOzbmcg4bupbmcgZOG7pW5nIGLhurFuZyBBREIKICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJzaGVsbCIsIGYiYW0gZm9yY2Utc3RvcCB7cGFja2FnZX0iXQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJtZXNzYWdlIjogZiLEkMOjIMSRw7NuZyB7cGFja2FnZX0gYuG6sW5nIEFEQiJ9CiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHDs25nIOG7qW5nIGThu6VuZyBi4bqxbmcgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgIyBO4bq/dSBs4buXaSwgdGjhu60gcGjGsMahbmcgdGjhu6ljIEhUVFAKICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIEhUVFAgQVBJIG7hur91IGtow7RuZyBjw7MgQURCIGhv4bq3YyBBREIgYuG7iyBs4buXaQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2hvbWUiKQoKICAgIGRlZiBfc2FuaXRpemVfeG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MIMSR4buDIHRyw6FuaCBs4buXaSBraGkgcGjDom4gdMOtY2gKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogQ2h14buXaSBYTUwgY+G6p24geOG7rSBsw70KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBDaHXhu5dpIFhNTCDEkcOjIMSRxrDhu6NjIHjhu60gbMO9CiAgICAgICAgIiIiCiAgICAgICAgIyBUaGF5IHRo4bq/IGPDoWMga8O9IHThu7EgJiBraMO0bmcgaOG7o3AgbOG7hyBi4bqxbmcgJmFtcDsKICAgICAgICAjIE5oxrBuZyBnaeG7ryBuZ3V5w6puIGPDoWMgZW50aXR5IGjhu6NwIGzhu4cgbmjGsCAmYW1wOywgJmx0OywgJmd0OywgJnF1b3Q7LCAmYXBvczsKICAgICAgICB4bWxfY29udGVudCA9IHJlLnN1YihyJyYoPyEoYW1wfGx0fGd0fHF1b3R8YXBvcyk7KScsICcmYW1wOycsIHhtbF9jb250ZW50KQogICAgICAgIAogICAgICAgICMgTG/huqFpIGLhu48gY8OhYyBrw70gdOG7sSDEkWnhu4F1IGtoaeG7g24ga2jDtG5nIGjhu6NwIGzhu4cgdHJvbmcgWE1MCiAgICAgICAgeG1sX2NvbnRlbnQgPSByZS5zdWIocidbXHgwMC1ceDA4XHgwQlx4MENceDBFLVx4MUZdJywgJycsIHhtbF9jb250ZW50KQogICAgICAgIAogICAgICAgIHJldHVybiB4bWxfY29udGVudAoKICAgIGRlZiBmaW5kX2VsZW1lbnRfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIAogICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gcGjhuqduIHThu60gdHJvbmcgWE1MIGThu7FhIHRyw6puIHRleHQsIGNvbnRlbnQtZGVzYywgcmVzb3VyY2UtaWQsIGNsYXNzIGhv4bq3YyB2aXNpYmxlLXRvLXVzZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IFBo4bqnbiB04butIMSR4bqndSB0acOqbiB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjDonkgZOG7sW5nIFhQYXRoIHF1ZXJ5IGThu7FhIHRyw6puIGPDoWMgxJFp4buBdSBraeG7h24KICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0B0ZXh0PSJ7dGV4dH0iJykKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0BjbGFzcz0ie2NsYXNzX25hbWV9IicpCiAgICAgICAgICAgICAgICBpZiB2aXNpYmxlX3RvX3VzZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV92YWx1ZSA9ICJ0cnVlIiBpZiB2aXNpYmxlX3RvX3VzZXIgZWxzZSAiZmFsc2UiCiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdmlzaWJsZS10by11c2VyPSJ7dmlzaWJsZV92YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgPSAiLy9ub2RlIgogICAgICAgICAgICAgICAgaWYgY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSArPSAiWyIgKyAiIGFuZCAiLmpvaW4oY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHBo4bqnbiB04butIMSR4bqndSB0acOqbiBwaMO5IGjhu6NwCiAgICAgICAgICAgICAgICBlbGVtZW50ID0gcm9vdC54cGF0aCh4cGF0aF9xdWVyeSkKICAgICAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VsZW1lbnRfdG9fZGljdChlbGVtZW50WzBdKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIHBo4bqnbiB04butIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4CiAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgcGF0dGVybiA9IGYndGV4dD0ie3RleHR9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIHRleHQKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KQogICAgICAgIAogICAgICAgIGlmIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgcGF0dGVybiA9IGYnY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInCiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNo4bupYSBjb250ZW50LWRlc2MKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KQogICAgICAgIAogICAgICAgIGlmIHJlc291cmNlX2lkOgogICAgICAgICAgICBwYXR0ZXJuID0gZidyZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInCiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNo4bupYSByZXNvdXJjZS1pZAogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgaWYgY2xhc3NfbmFtZToKICAgICAgICAgICAgcGF0dGVybiA9IGYnY2xhc3M9IntjbGFzc19uYW1lfSInCiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNo4bupYSBjbGFzcwogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIGZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHBo4bqnbiB04butIHRyb25nIFhNTCBwaMO5IGjhu6NwIHbhu5tpIMSRaeG7gXUga2nhu4duCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IE7hu5lpIGR1bmcgWE1MCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggY8OhYyBwaOG6p24gdOG7rSB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIHJlc3VsdHMgPSBbXQogICAgICAgIAogICAgICAgIGlmIG5vdCB4bWxfY29udGVudDoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHMKICAgICAgICAgICAgCiAgICAgICAgaWYgTFhNTF9BVkFJTEFCTEU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTCDEkeG7gyB0csOhbmggbOG7l2kgRW50aXR5UmVmCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyBYUGF0aCBxdWVyeSBk4buxYSB0csOqbiBjw6FjIMSRaeG7gXUga2nhu4duCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdGV4dD0ie3RleHR9IicpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2MgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAcmVzb3VyY2UtaWQ9IntyZXNvdXJjZV9pZH0iJykKICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY2xhc3M9IntjbGFzc19uYW1lfSInKQogICAgICAgICAgICAgICAgaWYgdmlzaWJsZV90b191c2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdmFsdWUgPSAidHJ1ZSIgaWYgdmlzaWJsZV90b191c2VyIGVsc2UgImZhbHNlIgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHZpc2libGUtdG8tdXNlcj0ie3Zpc2libGVfdmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ID0gIi8vbm9kZSIKICAgICAgICAgICAgICAgIGlmIGNvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgKz0gIlsiICsgIiBhbmQgIi5qb2luKGNvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIHBo4bqnbiB04butIHBow7kgaOG7o3AKICAgICAgICAgICAgICAgIGVsZW1lbnRzID0gcm9vdC54cGF0aCh4cGF0aF9xdWVyeSkKICAgICAgICAgICAgICAgIGZvciBlbGVtZW50IGluIGVsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2VsZW1lbnRfdG9fZGljdChlbGVtZW50KSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBwaOG6p24gdOG7rSB24bubaSBseG1sOiB7ZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiJUaOG7rSB0w6xtIHBo4bqnbiB04butIGLhurFuZyBwaMawxqFuZyB0aOG7qWMgdGhheSB0aOG6vy4uLiIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4IChjaOG7iSB0cuG6oyB24buBIGvhur90IHF14bqjIMSRxqFuIGdp4bqjbikKICAgICAgICBpZiBub3QgcmVzdWx0cyBhbmQgdGV4dDoKICAgICAgICAgICAgcGF0dGVybiA9IGYndGV4dD0ie3RleHR9IicKICAgICAgICAgICAgZm9yIG1hdGNoIGluIHJlLmZpbmRpdGVyKHBhdHRlcm4sIHhtbF9jb250ZW50KToKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzCiAgICAKICAgIGRlZiBfZXh0cmFjdF9hdHRyaWJ1dGVzKHNlbGYsIG5vZGVfY29udGVudDogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUcsOtY2ggeHXhuqV0IGPDoWMgdGh14buZYyB0w61uaCB04burIG7hu5lpIGR1bmcgY+G7p2EgbeG7mXQgdGjhursgbm9kZQogICAgICAgICIiIgogICAgICAgIGF0dHJpYnV0ZXMgPSB7fQogICAgICAgIAogICAgICAgICMgQ8OhYyB0aHXhu5ljIHTDrW5oIGPhuqduIHRyw61jaCB4deG6pXQKICAgICAgICBhdHRyX3BhdHRlcm5zID0gewogICAgICAgICAgICAiY2xhc3MiOiByJ2NsYXNzPSIoW14iXSopIicsCiAgICAgICAgICAgICJwYWNrYWdlIjogcidwYWNrYWdlPSIoW14iXSopIicsCiAgICAgICAgICAgICJyZXNvdXJjZS1pZCI6IHIncmVzb3VyY2UtaWQ9IihbXiJdKikiJywKICAgICAgICAgICAgInRleHQiOiByJ3RleHQ9IihbXiJdKikiJywKICAgICAgICAgICAgImNvbnRlbnQtZGVzYyI6IHInY29udGVudC1kZXNjPSIoW14iXSopIicsCiAgICAgICAgICAgICJib3VuZHMiOiByJ2JvdW5kcz0iKFteIl0qKSInLAogICAgICAgICAgICAiY2hlY2thYmxlIjogcidjaGVja2FibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImNoZWNrZWQiOiByJ2NoZWNrZWQ9IihbXiJdKikiJywKICAgICAgICAgICAgImNsaWNrYWJsZSI6IHInY2xpY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJlbmFibGVkIjogcidlbmFibGVkPSIoW14iXSopIicsCiAgICAgICAgICAgICJmb2N1c2FibGUiOiByJ2ZvY3VzYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAiZm9jdXNlZCI6IHInZm9jdXNlZD0iKFteIl0qKSInLAogICAgICAgICAgICAic2Nyb2xsYWJsZSI6IHInc2Nyb2xsYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAibG9uZy1jbGlja2FibGUiOiByJ2xvbmctY2xpY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJwYXNzd29yZCI6IHIncGFzc3dvcmQ9IihbXiJdKikiJywKICAgICAgICAgICAgInNlbGVjdGVkIjogcidzZWxlY3RlZD0iKFteIl0qKSInCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciBhdHRyX25hbWUsIHBhdHRlcm4gaW4gYXR0cl9wYXR0ZXJucy5pdGVtcygpOgogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCBub2RlX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgYXR0cmlidXRlc1thdHRyX25hbWVdID0gbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhdHRyaWJ1dGVzCgogICAgZGVmIF9lbGVtZW50X3RvX2RpY3Qoc2VsZiwgZWxlbWVudCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2h1eeG7g24gxJHhu5VpIG3hu5l0IHBo4bqnbiB04butIFhNTCB04burIGx4bWwgdGjDoG5oIGRpY3QKICAgICAgICAiIiIKICAgICAgICByZXN1bHQgPSB7fQogICAgICAgIAogICAgICAgICMgTOG6pXkgdOG6pXQgY+G6oyB0aHXhu5ljIHTDrW5oCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZWxlbWVudC5hdHRyaWIuaXRlbXMoKToKICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0CgogICAgZGVmIGZpbmRfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHBo4bqnbiB04butIHRyw6puIG3DoG4gaMOsbmggZOG7sWEgdHLDqm4gdGV4dCwgY29udGVudC1kZXNjLCByZXNvdXJjZS1pZCwgY2xhc3MgaG/hurdjIHZpc2libGUtdG8tdXNlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBQaOG6p24gdOG7rSDEkeG6p3UgdGnDqm4gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyKQoKICAgIGRlZiBmaW5kX2FsbF9lbGVtZW50cyhzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgcGjhuqduIHThu60gdHLDqm4gbcOgbiBow6xuaCBwaMO5IGjhu6NwIHbhu5tpIMSRaeG7gXUga2nhu4duCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCBjw6FjIHBo4bqnbiB04butIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHhtbF9jb250ZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIpCgogICAgZGVmIGlzX2VsZW1lbnRfc2VsZWN0ZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGNo4buNbiBoYXkga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJzZWxlY3RlZCIpID09ICJ0cnVlIgoKICAgIGRlZiB3YWl0X2Zvcl9lbGVtZW50KHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCB0aW1lb3V0OiBpbnQgPSAzMCwgCiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG3hu5l0IHBo4bqnbiB04butIHh14bqldCBoaeG7h24gdHLDqm4gbcOgbiBow6xuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgdGltZW91dDogVGjhu51pIGdpYW4gY2jhu50gdOG7kWkgxJFhIChnacOieSkKICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IEtob+G6o25nIHRo4budaSBnaWFuIGdp4buvYSBjw6FjIGzhuqduIGtp4buDbSB0cmEgKGdpw6J5KQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IFBo4bqnbiB04butIHTDrG0gdGjhuqV5IGhv4bq3YyBOb25lIG7hur91IHRpbWVvdXQKICAgICAgICAiIiIKICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5maW5kX2VsZW1lbnQodGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyKQogICAgICAgICAgICBpZiBlbGVtZW50OgogICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0aW1lLnNsZWVwKGNoZWNrX2ludGVydmFsKQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIHdhaXRfdG9fdGFwX2VsZW1lbnQoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIHRpbWVvdXQ6IGludCA9IDMwLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEsIGRlbGF5X2JlZm9yZV90YXA6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGVsZW1lbnQgeHXhuqV0IGhp4buHbiwgZGVsYXkgbeG7mXQga2hv4bqjbmcgdGjhu51pIGdpYW4sIHLhu5NpIHRhcCB2w6BvIGVsZW1lbnQKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIHRpbWVvdXQ6IFRo4budaSBnaWFuIGNo4budIHThu5FpIMSRYSDEkeG7gyB0w6xtIGVsZW1lbnQgKGdpw6J5KQogICAgICAgICAgICBjaGVja19pbnRlcnZhbDogS2hv4bqjbmcgdGjhu51pIGdpYW4gZ2nhu69hIGPDoWMgbOG6p24ga2nhu4NtIHRyYSAoZ2nDonkpCiAgICAgICAgICAgIGRlbGF5X2JlZm9yZV90YXA6IFRo4budaSBnaWFuIGRlbGF5IHRyxrDhu5tjIGtoaSB0YXAgKGdpw6J5LCBt4bq3YyDEkeG7i25oIDEgZ2nDonkpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ2jhu50gZWxlbWVudCB4deG6pXQgaGnhu4duCiAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLndhaXRfZm9yX2VsZW1lbnQoCiAgICAgICAgICAgICAgICB0ZXh0PXRleHQsIAogICAgICAgICAgICAgICAgY29udGVudF9kZXNjPWNvbnRlbnRfZGVzYywgCiAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD1yZXNvdXJjZV9pZCwgCiAgICAgICAgICAgICAgICBjbGFzc19uYW1lPWNsYXNzX25hbWUsCiAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI9dmlzaWJsZV90b191c2VyLCAKICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dCwgCiAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbD1jaGVja19pbnRlcnZhbAogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgICAgICMgVOG6oW8gdGjDtG5nIGLDoW8gbOG7l2kgY2hpIHRp4bq/dAogICAgICAgICAgICAgICAgY3JpdGVyaWEgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJ0ZXh0PSd7dGV4dH0nIikKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJjb250ZW50X2Rlc2M9J3tjb250ZW50X2Rlc2N9JyIpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZDoKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJyZXNvdXJjZV9pZD0ne3Jlc291cmNlX2lkfSciKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZToKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJjbGFzc19uYW1lPSd7Y2xhc3NfbmFtZX0nIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3JpdGVyaWFfc3RyID0gIiwgIi5qb2luKGNyaXRlcmlhKSBpZiBjcml0ZXJpYSBlbHNlICJraMO0bmcgeMOhYyDEkeG7i25oIgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdMOsbSB0aOG6pXkgZWxlbWVudCBzYXUge3RpbWVvdXR9cyB24bubaSB0acOqdSBjaMOtOiB7Y3JpdGVyaWFfc3RyfSIKICAgICAgICAgICAgICAgIHByaW50KGVycm9yX21zZykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIERlbGF5IHRyxrDhu5tjIGtoaSB0YXAKICAgICAgICAgICAgaWYgZGVsYXlfYmVmb3JlX3RhcCA+IDA6CiAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgdMOsbSB0aOG6pXkgZWxlbWVudCwgZGVsYXkge2RlbGF5X2JlZm9yZV90YXB9cyB0csaw4bubYyBraGkgdGFwLi4uIikKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoZGVsYXlfYmVmb3JlX3RhcCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGFwIHbDoG8gZWxlbWVudAogICAgICAgICAgICByZXN1bHQgPSBzZWxmLnRhcF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IHF14bqjIHRhcAogICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8gPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8uYXBwZW5kKGYidGV4dD0ne3RleHR9JyIpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9pbmZvLmFwcGVuZChmImNvbnRlbnRfZGVzYz0ne2NvbnRlbnRfZGVzY30nIikKICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkOgogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mby5hcHBlbmQoZiJyZXNvdXJjZV9pZD0ne3Jlc291cmNlX2lkfSciKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZToKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8uYXBwZW5kKGYiY2xhc3NfbmFtZT0ne2NsYXNzX25hbWV9JyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsZW1lbnRfc3RyID0gIiwgIi5qb2luKGVsZW1lbnRfaW5mbykgaWYgZWxlbWVudF9pbmZvIGVsc2UgImVsZW1lbnQiCiAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgdGFwIHRow6BuaCBjw7RuZyB2w6BvIHtlbGVtZW50X3N0cn0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7cmVzdWx0LmdldCgnbWVzc2FnZScsICdLaMO0bmcgeMOhYyDEkeG7i25oJyl9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kgdHJvbmcgd2FpdF90b190YXBfZWxlbWVudDoge3N0cihlKX0iCiAgICAgICAgICAgIHByaW50KGVycm9yX21zZykKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfdGV4dChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRleHQgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NvbnRlbnRfZGVzYyhzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGNvbnRlbnQtZGVzYyBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9yZXNvdXJjZV9pZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHJlc291cmNlLWlkIGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJyZXNvdXJjZS1pZCIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2xhc3Moc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBjbGFzcyBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2xhc3MiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2VuYWJsZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGvDrWNoIGhv4bqhdCBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImVuYWJsZWQiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NsaWNrYWJsZShzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgdGjhu4MgbmjhuqVwIHbDoG8ga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjbGlja2FibGUiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2ZvY3VzZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGZvY3VzIGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiZm9jdXNlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2hlY2tlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2MgY2jhu41uIGtow7RuZyAoY2hvIGNoZWNrYm94KQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2hlY2tlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfYm91bmRzKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBUdXBsZVtpbnQsIGludCwgaW50LCBpbnRdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHThu41hIMSR4buZIGJvdW5kcyBj4bunYSBwaOG6p24gdOG7rSBkxrDhu5tpIGThuqFuZyB0dXBsZSAoeDEsIHkxLCB4MiwgeTIpCiAgICAgICAgWOG7rSBsw70gY8OhYyB0csaw4budbmcgaOG7o3AgYm91bmRzIGtow7RuZyBo4bujcCBs4buHICjDom0sIDAsIGhv4bq3YyBmb3JtYXQgc2FpKQogICAgICAgICIiIgogICAgICAgIGJvdW5kcyA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiWzAsMF1bMCwwXSIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7rSBjw6FjIHBhdHRlcm4ga2jDoWMgbmhhdSDEkeG7gyBwYXJzZSBib3VuZHMKICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgciJcWygtP1xkKyksKC0/XGQrKVxdXFsoLT9cZCspLCgtP1xkKylcXSIsICAjIFBhdHRlcm4gaGnhu4duIHThuqFpLCBjaG8gcGjDqXAgc+G7kSDDom0KICAgICAgICAgICAgciIoLT9cZCspLCgtP1xkKyksKC0/XGQrKSwoLT9cZCspIiwgICAgICAgICAjIFBhdHRlcm46IHgxLHkxLHgyLHkyCiAgICAgICAgICAgIHIiXFsoLT9cZCspOygtP1xkKylcXVxbKC0/XGQrKTsoLT9cZCspXF0iICAgIyBQYXR0ZXJuIHbhu5tpIGThuqV1IDsKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUubWF0Y2gocGF0dGVybiwgYm91bmRzKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIHgxLCB5MSwgeDIsIHkyID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU+G7rWEgY2jhu69hIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hwogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7MgdOG7jWEgxJHhu5kgw6JtLCDEkWnhu4F1IGNo4buJbmgKICAgICAgICAgICAgICAgIGlmIHkxIDwgMCBvciB5MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogQm91bmRzIGPDsyB04buNYSDEkeG7mSB5IMOibTogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgICAgICAjIE7hur91IHkyIMOibSwgY8OzIHRo4buDIGVsZW1lbnQgbuG6sW0gdHLDqm4gdGhhbmggc3RhdHVzIGJhcgogICAgICAgICAgICAgICAgICAgIGlmIHkyIDwgMDoKICAgICAgICAgICAgICAgICAgICAgICAgIyDEkGnhu4F1IGNo4buJbmggxJHhu4MgZWxlbWVudCBjw7MgdGjhu4MgdGFwIMSRxrDhu6NjCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGFicyh5MiAtIHkxKSAgIyBDaGnhu4F1IGNhbyBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gbWF4KDAsIHkxKSAgIyDEkOG6o20gYuG6o28geTEgPj0gMAogICAgICAgICAgICAgICAgICAgICAgICB5MiA9IHkxICsgaGVpZ2h0ICAjIMSQ4bq3dCB5MiBkxrDGoW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyDEkWnhu4F1IGNo4buJbmggYm91bmRzIHRow6BuaDogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgeDEgPCAwIG9yIHgyIDwgMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBCb3VuZHMgY8OzIHThu41hIMSR4buZIHggw6JtOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgICAgICMgVMawxqFuZyB04buxIHbhu5tpIHgKICAgICAgICAgICAgICAgICAgICBpZiB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gYWJzKHgyIC0geDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gbWF4KDAsIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHgxICsgd2lkdGgKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIMSRaeG7gXUgY2jhu4luaCBib3VuZHMgdGjDoG5oOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgYm91bmRzIGjhu6NwIGzhu4cgc2F1IGtoaSDEkWnhu4F1IGNo4buJbmgKICAgICAgICAgICAgICAgIGlmIHgxIDwgeDIgYW5kIHkxIDwgeTIgYW5kIG5vdCAoeDEgPT0gMCBhbmQgeTEgPT0gMCBhbmQgeDIgPT0gMCBhbmQgeTIgPT0gMCk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh4MSwgeTEsIHgyLCB5MikKICAgICAgICAKICAgICAgICAjIE7hur91IGtow7RuZyBwYXJzZSDEkcaw4bujYyBob+G6t2MgdOG6pXQgY+G6oyBsw6AgMCwgdGjhu60gbOG6pXkgdOG7qyB0aHXhu5ljIHTDrW5oIGtow6FjCiAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogS2jDtG5nIHRo4buDIHBhcnNlIGJvdW5kcyAne2JvdW5kc30nIGPhu6dhIGVsZW1lbnQsIHRo4butIHBoxrDGoW5nIHBow6FwIGtow6FjLi4uIikKICAgICAgICAKICAgICAgICAjIFRo4butIGzhuqV5IHThu6sgY8OhYyB0aHXhu5ljIHTDrW5oIGtow6FjIG7hur91IGPDswogICAgICAgIHggPSBlbGVtZW50LmdldCgieCIsIDApCiAgICAgICAgeSA9IGVsZW1lbnQuZ2V0KCJ5IiwgMCkKICAgICAgICB3aWR0aCA9IGVsZW1lbnQuZ2V0KCJ3aWR0aCIsIDEwMCkgICMgRGVmYXVsdCB3aWR0aAogICAgICAgIGhlaWdodCA9IGVsZW1lbnQuZ2V0KCJoZWlnaHQiLCA1MCkgICMgRGVmYXVsdCBoZWlnaHQKICAgICAgICAKICAgICAgICBpZiB4IG9yIHkgb3Igd2lkdGggIT0gMTAwIG9yIGhlaWdodCAhPSA1MDogICMgQ8OzIMOtdCBuaOG6pXQgbeG7mXQgdGh14buZYyB0w61uaCBraMOhYyAwL2RlZmF1bHQKICAgICAgICAgICAgcmV0dXJuICh4LCB5LCB4ICsgd2lkdGgsIHkgKyBoZWlnaHQpCiAgICAgICAgCiAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogRWxlbWVudCBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4csIHPhu60gZOG7pW5nIHThu41hIMSR4buZIG3hurdjIMSR4buLbmgiKQogICAgICAgIHJldHVybiAoMCwgMCwgMTAwLCA1MCkgICMgRmFsbGJhY2sgYm91bmRzIG5o4buPCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jZW50ZXIoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IFR1cGxlW2ludCwgaW50XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB04buNYSDEkeG7mSB0cnVuZyB0w6JtIGPhu6dhIHBo4bqnbiB04butIHbhu5tpIHjhu60gbMO9IGzhu5dpIG7Dom5nIGNhbwogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICBwcmludCgiQ+G6o25oIGLDoW86IEVsZW1lbnQgbMOgIE5vbmUgaG/hurdjIHLhu5duZyIpCiAgICAgICAgICAgIHJldHVybiAoMCwgMCkKICAgICAgICAgICAgCiAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyhlbGVtZW50KQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBib3VuZHMgaOG7o3AgbOG7hwogICAgICAgIGlmIHgxID49IHgyIG9yIHkxID49IHkyOgogICAgICAgICAgICBib3VuZHNfc3RyID0gZWxlbWVudC5nZXQoImJvdW5kcyIsICIiKQogICAgICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBCb3VuZHMga2jDtG5nIGjhu6NwIGzhu4cgJ3tib3VuZHNfc3RyfSc6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hywgdHLhuqMgduG7gSB04buNYSDEkeG7mSBhbiB0b8OgbiDhu58gZ2nhu69hIG3DoG4gaMOsbmgKICAgICAgICAgICAgc2NyZWVuX3dpZHRoLCBzY3JlZW5faGVpZ2h0ID0gc2VsZi5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgICAgICBpZiBzY3JlZW5fd2lkdGggPiAwIGFuZCBzY3JlZW5faGVpZ2h0ID4gMDoKICAgICAgICAgICAgICAgIGNlbnRlcl94ID0gc2NyZWVuX3dpZHRoIC8vIDIKICAgICAgICAgICAgICAgIGNlbnRlcl95ID0gc2NyZWVuX2hlaWdodCAvLyAyCiAgICAgICAgICAgICAgICByZXR1cm4gKGNlbnRlcl94LCBjZW50ZXJfeSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiAoNTQwLCA5NjApICAjIFThu41hIMSR4buZIG3hurdjIMSR4buLbmggY2hvIG3DoG4gaMOsbmggMTA4MHgxOTIwCiAgICAgICAgCiAgICAgICAgY2VudGVyX3ggPSAoeDEgKyB4MikgLy8gMgogICAgICAgIGNlbnRlcl95ID0gKHkxICsgeTIpIC8vIDIKICAgICAgICAKICAgICAgICAjIFRow6ptIG3hu5l0IGNow7p0IHJhbmRvbSDEkeG7gyB0csOhbmggZGV0ZWN0aW9uICjCsTMgcGl4ZWxzKQogICAgICAgIGNlbnRlcl94ICs9IHJhbmRvbS5yYW5kaW50KC0zLCAzKQogICAgICAgIGNlbnRlcl95ICs9IHJhbmRvbS5yYW5kaW50KC0zLCAzKQogICAgICAgIAogICAgICAgICMgxJDhuqNtIGLhuqNvIHThu41hIMSR4buZIHRyb25nIHBo4bqhbSB2aSBtw6BuIGjDrG5oCiAgICAgICAgc2NyZWVuX3dpZHRoLCBzY3JlZW5faGVpZ2h0ID0gc2VsZi5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgIGlmIHNjcmVlbl93aWR0aCA+IDAgYW5kIHNjcmVlbl9oZWlnaHQgPiAwOgogICAgICAgICAgICBjZW50ZXJfeCA9IG1heCgxMCwgbWluKGNlbnRlcl94LCBzY3JlZW5fd2lkdGggLSAxMCkpICAjIE1hcmdpbiAxMHB4IHThu6sgYmnDqm4KICAgICAgICAgICAgY2VudGVyX3kgPSBtYXgoMTAsIG1pbihjZW50ZXJfeSwgc2NyZWVuX2hlaWdodCAtIDEwKSkKICAgICAgICAKICAgICAgICByZXR1cm4gKGNlbnRlcl94LCBjZW50ZXJfeSkKICAgIAogICAgZGVmIHRhcF9lbGVtZW50X2NlbnRlcihzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhuqFtIHbDoG8gdHJ1bmcgdMOibSBj4bunYSBwaOG6p24gdOG7rSB24bubaSB44butIGzDvSBs4buXaSBuw6JuZyBjYW8KICAgICAgICAiIiIKICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiAiRWxlbWVudCBsw6AgTm9uZSBob+G6t2MgcuG7l25nIn0KICAgICAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgdmlzaWJsZS10by11c2VyIHRyxrDhu5tjCiAgICAgICAgICAgIHZpc2libGUgPSBlbGVtZW50LmdldCgidmlzaWJsZS10by11c2VyIiwgInRydWUiKQogICAgICAgICAgICBpZiB2aXNpYmxlID09ICJmYWxzZSI6CiAgICAgICAgICAgICAgICBwcmludCgiQ+G6o25oIGLDoW86IEVsZW1lbnQgY8OzIHZpc2libGUtdG8tdXNlcj0nZmFsc2UnLCB24bqrbiB0aOG7rSB0YXAuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgeCwgeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgdOG7jWEgxJHhu5kgaOG7o3AgbOG7hwogICAgICAgICAgICBpZiB4IDw9IDAgYW5kIHkgPD0gMDoKICAgICAgICAgICAgICAgICMgVGjhu60gcGjGsMahbmcgcGjDoXAgYWx0ZXJuYXRpdmUgbuG6v3UgZ2V0X2VsZW1lbnRfY2VudGVyIHRy4bqjIHbhu4EgdOG7jWEgxJHhu5kga2jDtG5nIGjhu6NwIGzhu4cKICAgICAgICAgICAgICAgIGJvdW5kc19zdHIgPSBlbGVtZW50LmdldCgiYm91bmRzIiwgIiIpCiAgICAgICAgICAgICAgICB0ZXh0ID0gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYyA9IGVsZW1lbnQuZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogZ2V0X2VsZW1lbnRfY2VudGVyIHRy4bqjIHbhu4EgdOG7jWEgxJHhu5kga2jDtG5nIGjhu6NwIGzhu4cgKHt4fSwge3l9KSBjaG8gZWxlbWVudDoiKQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0gYm91bmRzOiB7Ym91bmRzX3N0cn0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0gdGV4dDogJ3t0ZXh0fSciKQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0gY29udGVudC1kZXNjOiAne2NvbnRlbnRfZGVzY30nIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaOG7rSB0YXAgYuG6sW5nIGJvdW5kcyBzdHJpbmcgdHLhu7FjIHRp4bq/cAogICAgICAgICAgICAgICAgaWYgYm91bmRzX3N0ciBhbmQgYm91bmRzX3N0ciAhPSAiWzAsMF1bMCwwXSI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudGFwX2VsZW1lbnQoYm91bmRzX3N0cikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiAiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCB04buNYSDEkeG7mSDEkeG7gyB0YXAifQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHNlbGYudGFwKHgsIHkpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGFwIGVsZW1lbnQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogZiJM4buXaSBraGkgdGFwIGVsZW1lbnQ6IHtzdHIoZSl9In0KICAgIAogICAgZGVmIGxvbmdfcHJlc3Moc2VsZiwgeDogaW50LCB5OiBpbnQsIGR1cmF0aW9uOiBpbnQgPSAxMDAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gZ2nhu68gdOG6oWkgduG7iyB0csOtIHgseSB0cm9uZyBt4buZdCBraG/huqNuZyB0aOG7nWkgZ2lhbgogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgIngiOiB4LAogICAgICAgICAgICAieSI6IHksCiAgICAgICAgICAgICJkdXJhdGlvbiI6IGR1cmF0aW9uCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImxvbmdfcHJlc3MiLCBwYXJhbXM9cGFyYW1zKQogICAgCiAgICBkZWYgbG9uZ19wcmVzc19lbGVtZW50KHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLCBkdXJhdGlvbjogaW50ID0gMTAwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIGdp4buvIHThuqFpIHRydW5nIHTDom0gY+G7p2EgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICB4LCB5ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICByZXR1cm4gc2VsZi5sb25nX3ByZXNzKHgsIHksIGR1cmF0aW9uKQogICAgCiAgICBkZWYgc3dpcGUoc2VsZiwgc3RhcnRfeDogaW50LCBzdGFydF95OiBpbnQsIGVuZF94OiBpbnQsIGVuZF95OiBpbnQsIAogICAgICAgICAgICAgZHVyYXRpb246IGludCA9IDUwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHThu6sgxJFp4buDbSAoc3RhcnRfeCwgc3RhcnRfeSkgxJHhur9uIMSRaeG7g20gKGVuZF94LCBlbmRfeSkKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICJzdGFydF94Ijogc3RhcnRfeCwKICAgICAgICAgICAgInN0YXJ0X3kiOiBzdGFydF95LAogICAgICAgICAgICAiZW5kX3giOiBlbmRfeCwKICAgICAgICAgICAgImVuZF95IjogZW5kX3ksCiAgICAgICAgICAgICJkdXJhdGlvbiI6IGR1cmF0aW9uCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlIiwgcGFyYW1zPXBhcmFtcykKICAgIAogICAgZGVmIHN3aXBlX2JldHdlZW5fZWxlbWVudHMoc2VsZiwgc3RhcnRfZWxlbWVudDogRGljdFtzdHIsIEFueV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRfZWxlbWVudDogRGljdFtzdHIsIEFueV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogaW50ID0gNTAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgdOG7qyBwaOG6p24gdOG7rSBzdGFydF9lbGVtZW50IMSR4bq/biBwaOG6p24gdOG7rSBlbmRfZWxlbWVudAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3gsIHN0YXJ0X3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihzdGFydF9lbGVtZW50KQogICAgICAgIGVuZF94LCBlbmRfeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVuZF9lbGVtZW50KQogICAgICAgIHJldHVybiBzZWxmLnN3aXBlKHN0YXJ0X3gsIHN0YXJ0X3ksIGVuZF94LCBlbmRfeSwgZHVyYXRpb24pCiAgICAKICAgIGRlZiB3YWl0X2Zvcl9lbGVtZW50X3RvX2Rpc2FwcGVhcihzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgdGltZW91dDogaW50ID0gMzAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbDogaW50ID0gMSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgbeG7mXQgcGjhuqduIHThu60gYmnhur9uIG3huqV0IGto4buPaSBtw6BuIGjDrG5oCiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgdGltZW91dDoKICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuZmluZF9lbGVtZW50KHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQpCiAgICAgICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0aW1lLnNsZWVwKGNoZWNrX2ludGVydmFsKQogICAgICAgIAogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgd2FpdF9mb3JfYW55X2VsZW1lbnQoc2VsZiwgZWxlbWVudHNfdG9fZmluZDogTGlzdFtEaWN0W3N0ciwgc3RyXV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiBpbnQgPSAzMCwgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgYuG6pXQga+G7syBwaOG6p24gdOG7rSBuw6BvIHRyb25nIGRhbmggc8OhY2ggeHXhuqV0IGhp4buHbgogICAgICAgIAogICAgICAgIGVsZW1lbnRzX3RvX2ZpbmQgbMOgIGRhbmggc8OhY2ggY8OhYyBkaWN0IHbhu5tpIGPDoWMga2jDs2E6IHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQKICAgICAgICAiIiIKICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICBmb3IgZWxlbWVudF9jcml0ZXJpYSBpbiBlbGVtZW50c190b19maW5kOgogICAgICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuZmluZF9lbGVtZW50KAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfY3JpdGVyaWEuZ2V0KCJ0ZXh0IiksIAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfY3JpdGVyaWEuZ2V0KCJjb250ZW50X2Rlc2MiKSwgCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9jcml0ZXJpYS5nZXQoInJlc291cmNlX2lkIikKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0aW1lLnNsZWVwKGNoZWNrX2ludGVydmFsKQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGRlZiBnZXRfc2NyZWVuX3NpemUoc2VsZikgLT4gVHVwbGVbaW50LCBpbnRdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmggKHdpZHRoLCBoZWlnaHQpCiAgICAgICAgIiIiCiAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgaWYgZGV2aWNlX2luZm9bInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgcmV0dXJuIChkZXZpY2VfaW5mb1siZGF0YSJdWyJzY3JlZW5fd2lkdGgiXSwgZGV2aWNlX2luZm9bImRhdGEiXVsic2NyZWVuX2hlaWdodCJdKQogICAgICAgIHJldHVybiAoMCwgMCkKICAgIAogICAgZGVmIHRha2Vfc2NyZWVuc2hvdChzZWxmLCBmaWxlX3BhdGg6IHN0ciA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bulcCDhuqNuaCBtw6BuIGjDrG5oIHbDoCBsxrB1IHbDoG8gZmlsZV9wYXRoIChu4bq/dSDEkcaw4bujYyBjdW5nIGPhuqVwKQogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHt9CiAgICAgICAgaWYgZmlsZV9wYXRoOgogICAgICAgICAgICBwYXJhbXNbImZpbGVfcGF0aCJdID0gZmlsZV9wYXRoCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic2NyZWVuc2hvdCIsIHBhcmFtcz1wYXJhbXMpCiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9hY3Rpdml0eShzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdMOqbiBhY3Rpdml0eSBoaeG7h24gdOG6oWkKICAgICAgICAiIiIKICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICBpZiBkZXZpY2VfaW5mb1sic3RhdHVzIl0gPT0gInN1Y2Nlc3MiIGFuZCAiY3VycmVudF9hY3Rpdml0eSIgaW4gZGV2aWNlX2luZm9bImRhdGEiXToKICAgICAgICAgICAgcmV0dXJuIGRldmljZV9pbmZvWyJkYXRhIl1bImN1cnJlbnRfYWN0aXZpdHkiXQogICAgICAgIHJldHVybiAiIgogICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfcGFja2FnZShzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdMOqbiBwYWNrYWdlIGhp4buHbiB04bqhaQogICAgICAgICIiIgogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJjdXJyZW50LXBhY2thZ2UiKQogICAgICAgIGlmIHJlc3BvbnNlLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gcmVzcG9uc2U6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdLmdldCgicGFja2FnZSIsICIiKQogICAgICAgIHJldHVybiAiIgogICAgCiAgICBkZWYgcHJlc3NfZW50ZXIoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgRW50ZXIKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19lbnRlciIpCiAgICAKICAgIGRlZiBwcmVzc19iYWNrKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IEJhY2sKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19iYWNrIikKICAgIAogICAgZGVmIHByZXNzX2hvbWUoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgSG9tZQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2hvbWUiKQogICAgCiAgICBkZWYgcHJlc3NfcmVjZW50X2FwcHMoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgUmVjZW50IEFwcHMKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19yZWNlbnRfYXBwcyIpCgogICAgZGVmIGlzX2FwcF9pbnN0YWxsZWQoc2VsZiwgcGFja2FnZV9uYW1lOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIMSRw6MgxJHGsOG7o2MgY8OgaSDEkeG6t3QgdHLDqm4gdGhp4bq/dCBi4buLIGNoxrBhCiAgICAgICAgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGFja2FnZV9uYW1lOiBUw6puIHBhY2thZ2UgY+G7p2Eg4bupbmcgZOG7pW5nIGPhuqduIGtp4buDbSB0cmEKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDhu6luZyBk4bulbmcgxJHDoyBjw6BpIMSR4bq3dCwgRmFsc2UgbuG6v3UgY2jGsGEKICAgICAgICAiIiIKICAgICAgICAjIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEg4bupbmcgZOG7pW5nIGLhurFuZyBBREIKICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJzaGVsbCIsIGYicG0gbGlzdCBwYWNrYWdlcyB8IGdyZXAgLXggcGFja2FnZTp7cGFja2FnZV9uYW1lfSJdCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIGvhur90IHF14bqjLCDhu6luZyBk4bulbmcgxJHDoyDEkcaw4bujYyBjw6BpIMSR4bq3dAogICAgICAgICAgICAgICAgcmV0dXJuIHBhY2thZ2VfbmFtZSBpbiByZXN1bHQuc3Rkb3V0CiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvcjoKICAgICAgICAgICAgICAgICMgTuG6v3UgbOG7l2kgQURCLCBz4butIGThu6VuZyBBUEkgSFRUUAogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgSFRUUCBBUEkKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiYXBwLWluc3RhbGxlZCIsIHsicGFja2FnZSI6IHBhY2thZ2VfbmFtZX0pCiAgICAgICAgaWYgcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJkYXRhIl0uZ2V0KCJpbnN0YWxsZWQiLCBGYWxzZSkKICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgIGRlZiBmaW5kX2VsZW1lbnRzKHNlbGYsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsIHRleHQ6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHBo4bqnbiB04butIHRoZW8gY2xhc3NfbmFtZSwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCBob+G6t2MgdmlzaWJsZS10by11c2VyCiAgICAgICAgxJDDonkgbMOgIG3hu5l0IHBoxrDGoW5nIHRo4bupYyB0aeG7h24gbOG7o2kga+G6v3QgaOG7o3AgZHVtcF9zY3JlZW5feG1sIHbDoCBmaW5kX2FsbF9lbGVtZW50c19pbl94bWwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgcGjhuqduIHThu60gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICAjIEzhuqV5IFhNTCBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIGZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCDEkeG7gyB0w6xtIGPDoWMgcGjhuqduIHThu60KICAgICAgICByZXR1cm4gc2VsZi5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICB0ZXh0PXRleHQsIAogICAgICAgICAgICBjb250ZW50X2Rlc2M9Y29udGVudF9kZXNjLCAKICAgICAgICAgICAgcmVzb3VyY2VfaWQ9cmVzb3VyY2VfaWQsCiAgICAgICAgICAgIGNsYXNzX25hbWU9Y2xhc3NfbmFtZSwKICAgICAgICAgICAgdmlzaWJsZV90b191c2VyPXZpc2libGVfdG9fdXNlcgogICAgICAgICkKCiAgICBkZWYgb3Blbl91cmwoc2VsZiwgdXJsOiBzdHIsIHBhY2thZ2U6IHN0ciA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3hu58gbeG7mXQgVVJMIHRyw6puIHRoaeG6v3QgYuG7iy4gSOG7r3Ugw61jaCDEkeG7gyBt4bufIGPDoWMgbGluayBt4bqhbmcgeMOjIGjhu5lpIHRy4buxYyB0aeG6v3AuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdXJsOiBVUkwgY+G6p24gbeG7nyAodsOtIGThu6U6IGh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vdXNlcm5hbWUvKQogICAgICAgICAgICBwYWNrYWdlOiBQYWNrYWdlIG5hbWUgY+G7p2Eg4bupbmcgZOG7pW5nIMSR4buDIG3hu58gVVJMICh0w7l5IGNo4buNbikKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIHThu6sgc2VydmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFVSTCBlbmNvZGUgxJHhu4MgdHLDoW5oIGzhu5dpIHbhu5tpIGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdAogICAgICAgICAgICAjIENo4buJIGVuY29kZSBwaOG6p24gc2F1IGRvbWFpbiDEkeG7gyBnaeG7ryBuZ3V5w6puIHByb3RvY29sIHbDoCBkb21haW4KICAgICAgICAgICAgaWYgJzovLycgaW4gdXJsOgogICAgICAgICAgICAgICAgcGFydHMgPSB1cmwuc3BsaXQoJzovLycsIDEpCiAgICAgICAgICAgICAgICBpZiBsZW4ocGFydHMpID09IDI6CiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2wgPSBwYXJ0c1swXQogICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZyA9IHBhcnRzWzFdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgJy8nIGluIHJlbWFpbmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluX3BhcnRzID0gcmVtYWluaW5nLnNwbGl0KCcvJywgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluID0gZG9tYWluX3BhcnRzWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBkb21haW5fcGFydHNbMV0KICAgICAgICAgICAgICAgICAgICAgICAgIyBFbmNvZGUgcGF0aCBwYXJ0LCBuaMawbmcgZ2nhu68gbmd1ecOqbiBjw6FjIGvDvSB04buxIGFuIHRvw6BuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZWRfcGF0aCA9IHF1b3RlKHBhdGgsIHNhZmU9Jy9AOj8jW10hJCZcJygpKissOz0nKQogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3VybCA9IGYie3Byb3RvY29sfTovL3tkb21haW59L3tlbmNvZGVkX3BhdGh9IgogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZWRfdXJsID0gdXJsICAjIENo4buJIGPDsyBkb21haW4sIGtow7RuZyBj4bqnbiBlbmNvZGUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZW5jb2RlZF91cmwgPSB1cmwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgS2jDtG5nIGPDsyBwcm90b2NvbCwgZW5jb2RlIHRvw6BuIGLhu5kKICAgICAgICAgICAgICAgIGVuY29kZWRfdXJsID0gcXVvdGUodXJsLCBzYWZlPScvQDo/I1tdISQmXCcoKSorLDs9JykKICAgICAgICAgICAgCiAgICAgICAgICAgIHBhcmFtcyA9IHsidXJsIjogZW5jb2RlZF91cmx9CiAgICAgICAgICAgIGlmIHBhY2thZ2U6CiAgICAgICAgICAgICAgICBwYXJhbXNbInBhY2thZ2UiXSA9IHBhY2thZ2UKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgib3Blbl91cmwiLCBwYXJhbXM9cGFyYW1zKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGVuY29kZSBVUkw6IHtlfSIpCiAgICAgICAgICAgICMgRmFsbGJhY2s6IGfhu61pIFVSTCBn4buRYyBu4bq/dSBjw7MgbOG7l2kgZW5jb2RlCiAgICAgICAgICAgIHBhcmFtcyA9IHsidXJsIjogdXJsfQogICAgICAgICAgICBpZiBwYWNrYWdlOgogICAgICAgICAgICAgICAgcGFyYW1zWyJwYWNrYWdlIl0gPSBwYWNrYWdlCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoIm9wZW5fdXJsIiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgZ2V0X2NsaXBib2FyZChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgbuG7mWkgZHVuZyBjbGlwYm9hcmQgdOG7qyB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IE7hu5lpIGR1bmcgY2xpcGJvYXJkIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSBraMO0bmcgY8OzIG7hu5lpIGR1bmcKICAgICAgICAiIiIKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiY2xpcGJvYXJkIikKICAgICAgICBpZiByZXNwb25zZS5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgcmVzcG9uc2UuZ2V0KCJkYXRhIiwge30pLmdldCgiaGFzX2NvbnRlbnQiKToKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJkYXRhIl1bImNsaXBib2FyZF90ZXh0Il0KICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgc3dpcGVfbGVmdChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgc2FuZyB0csOhaSAodOG7kWkgxrB1IGNobyBuZ8OzbiBjw6FpIHRheSBwaOG6o2kpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGVfbGVmdCIpCgogICAgZGVmIHN3aXBlX3JpZ2h0KHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCBzYW5nIHBo4bqjaSAodOG7kWkgxrB1IGNobyBuZ8OzbiBjw6FpIHRheSBwaOG6o2kpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGVfcmlnaHQiKQoKICAgIGRlZiBpc19pbnN0YWxsZWQoc2VsZiwgcGFja2FnZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSDhu6luZyBk4bulbmcgY8OzIMSRxrDhu6NjIGPDoGkgxJHhurd0IGhheSBraMO0bmcgKGTDuW5nIEFQSSBt4bubaSkKICAgICAgICBBcmdzOgogICAgICAgICAgICBwYWNrYWdlOiBUw6puIHBhY2thZ2UgY+G7p2Eg4bupbmcgZOG7pW5nCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgZGljdDogS+G6v3QgcXXhuqMga2nhu4NtIHRyYQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImlzX2luc3RhbGxlZCIsIHBhcmFtcz17InBhY2thZ2UiOiBwYWNrYWdlfSkKCiAgICBkZWYgc2V0dXBfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaGnhur90IGzhuq1wIHByb3h5IGNobyBwaGnDqm4gbMOgbSB2aeG7h2MKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IHbhu5tpIGPDoWMgdHLGsOG7nW5nOgogICAgICAgICAgICAgICAgLSBpZDogSUQgY+G7p2EgcHJveHkKICAgICAgICAgICAgICAgIC0gdHlwZTogTG/huqFpIHByb3h5IChwcG9lLCBodHRwLCBzb2NrczUsIGV0Yy4pCiAgICAgICAgICAgICAgICAtIGhvc3Q6IMSQ4buLYSBjaOG7iSBzZXJ2ZXIgcHJveHkKICAgICAgICAgICAgICAgIC0gcG9ydDogUG9ydCBj4bunYSBwcm94eQogICAgICAgICAgICAgICAgLSB1c2VybmFtZTogVXNlcm5hbWUgKG7hur91IGPDsykKICAgICAgICAgICAgICAgIC0gcGFzc3dvcmQ6IFBhc3N3b3JkIChu4bq/dSBjw7MpCiAgICAgICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRoaeG6v3QgbOG6rXAgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByb3h5X3R5cGUgPSBwcm94eV9jb25maWcuZ2V0KCJ0eXBlIiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJpZCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwcm94eV90eXBlID09ICJwcG9lIjoKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZXR1cF9wcG9lX3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxpZiBwcm94eV90eXBlIGluIFsiaHR0cCIsICJodHRwcyJdOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NldHVwX2h0dHBfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbGlmIHByb3h5X3R5cGUgPT0gInNvY2tzNSI6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fc2V0dXBfc29ja3M1X3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiTG/huqFpIHByb3h5IGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujOiB7cHJveHlfdHlwZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRoaeG6v3QgbOG6rXAgcHJveHk6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfc2V0dXBfcHBvZV9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgUFBQb0UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IFBQUG9FCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGhvc3QgPSBwcm94eV9jb25maWcuZ2V0KCJzZXJ2ZXJfaXAiKQogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoInByb3h5X2lkIikKICAgICAgICAgICAgcHJveHlfbmFtZSA9IHByb3h5X2NvbmZpZy5nZXQoIm5hbWUiKQogICAgICAgICAgICBpZiBub3QgaG9zdDoKICAgICAgICAgICAgICAgIHByaW50KCJUaGnhur91IHRow7RuZyB0aW4gaG9zdCBjaG8gcHJveHkgUFBQb0UiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBBUEkgcmVnaXN0ZXIgdHLGsOG7m2MKICAgICAgICAgICAgcmVnaXN0ZXJfdXJsID0gZiJodHRwOi8ve2hvc3R9L3JlZ2lzdGVyIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBsb2NhbCBJUCB04burIGRldmljZSBpbmZvCiAgICAgICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgICAgICBsb2NhbF9pcCA9ICIiCiAgICAgICAgICAgIGlmIGRldmljZV9pbmZvLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gZGV2aWNlX2luZm86CiAgICAgICAgICAgICAgICBsb2NhbF9pcCA9IGRldmljZV9pbmZvWyJkYXRhIl0uZ2V0KCJsb2NhbF9pcCIsICIiKQogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmVnaXN0ZXJfZGF0YSA9IHsibmFtZSI6IHByb3h5X25hbWV9CiAgICAgICAgICAgICAgICBpZiBsb2NhbF9pcDoKICAgICAgICAgICAgICAgICAgICByZWdpc3Rlcl9kYXRhWyJsb2NhbF9pcCJdID0gbG9jYWxfaXAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlZ2lzdGVyX3Jlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgICAgICByZWdpc3Rlcl91cmwsIAogICAgICAgICAgICAgICAgICAgIGpzb249cmVnaXN0ZXJfZGF0YSwgCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sIAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIHJlZ2lzdGVyX3Jlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgxJHEg25nIGvDvSB0aMOgbmggY8O0bmcgduG7m2kgcHJveHkgUFBQb0Ugc2VydmVyOiB7aG9zdH0iKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSDEkcSDbmcga8O9IHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge3JlZ2lzdGVyX3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIktow7RuZyB0aOG7gyBr4bq/dCBu4buRaSDEkeG6v24gcHJveHkgUFBQb0Ugc2VydmVyIHtob3N0fToge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVzZXQgSVAgcHJveHkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Jlc2V0X3Byb3h5X2lwKHByb3h5X2NvbmZpZykKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aGnhur90IGzhuq1wIHByb3h5IFBQUG9FOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3NldHVwX2h0dHBfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaGnhur90IGzhuq1wIHByb3h5IEhUVFAvSFRUUFMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IEhUVFAKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG7kWkgduG7m2kgSFRUUCBwcm94eSwgY2jhu4kgY+G6p24gcmVzZXQgSVAKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Jlc2V0X3Byb3h5X2lwKHByb3h5X2NvbmZpZykKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aGnhur90IGzhuq1wIHByb3h5IEhUVFA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfc2V0dXBfc29ja3M1X3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBTT0NLUzUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IFNPQ0tTNQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4buRaSB24bubaSBTT0NLUzUgcHJveHksIGNo4buJIGPhuqduIHJlc2V0IElQCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNldF9wcm94eV9pcChwcm94eV9jb25maWcpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eSBTT0NLUzU6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfcmVzZXRfcHJveHlfaXAoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBSZXNldCBJUCBwcm94eSAobG9naWMgY8WpIMSRxrDhu6NjIGNodXnhu4NuIHbDoG8gxJHDonkpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIExvZ2ljIHJlc2V0IElQIHByb3h5IHPhur0gxJHGsOG7o2MgaW1wbGVtZW50IHTDuXkgdGhlbyBsb+G6oWkgcHJveHkKICAgICAgICAgICAgIyBIaeG7h24gdOG6oWkgcmV0dXJuIFRydWUgxJHhu4Mga2jDtG5nIGJsb2NrIHdvcmtmbG93CiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICBwcm94eV90eXBlID0gcHJveHlfY29uZmlnLmdldCgidHlwZSIsICJ1bmtub3duIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KGYiUmVzZXQgSVAgY2hvIHByb3h5IHtwcm94eV9pZH0gKHR5cGU6IHtwcm94eV90eXBlfSkiKQogICAgICAgICAgICAjIEtp4buDbSB0cmEgbuG6v3UgY8OzIHRow7RuZyB0aW4gcmVzZXQgSVAKICAgICAgICAgICAgcmVzZXRfaXBfbGluayA9IHByb3h5X2NvbmZpZy5nZXQoImxpbmtfcmVzZXRfaXAiKQogICAgICAgICAgICBwcG9lX25hbWUgPSBwcm94eV9jb25maWcuZ2V0KCJwcG9lX25hbWUiKQoKICAgICAgICAgICAgaWYgcmVzZXRfaXBfbGluayBhbmQgcHBvZV9uYW1lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgR+G7rWkgUE9TVCByZXF1ZXN0IMSR4buDIHJlc2V0IElQCiAgICAgICAgICAgICAgICAgICAgcmVzZXRfZGF0YSA9IHsicHBvZV9uYW1lIjogcHBvZV9uYW1lfQogICAgICAgICAgICAgICAgICAgIHJlc2V0X3Jlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXRfaXBfbGluaywgCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb249cmVzZXRfZGF0YSwgCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9LCAKICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiByZXNldF9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyByZXNldCBJUCB0aMOgbmggY8O0bmcgY2hvIHByb3h5IHtwcG9lX25hbWV9IikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSByZXNldCBJUDogSFRUUCB7cmVzZXRfcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBn4butaSByZXF1ZXN0IHJlc2V0IElQOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIlRoaeG6v3UgdGjDtG5nIHRpbiBsaW5rX3Jlc2V0X2lwIGhv4bq3YyBwcm94eV9uYW1lIikKICAgICAgICAgICAgIyBUT0RPOiBJbXBsZW1lbnQgbG9naWMgcmVzZXQgSVAgY+G7pSB0aOG7gyBjaG8gdOG7q25nIGxv4bqhaSBwcm94eQogICAgICAgICAgICAjIFbDrSBk4bulOiBn4buNaSBBUEkgcmVzZXQgSVAsIGhv4bq3YyB0aOG7sWMgaGnhu4duIGPDoWMgbOG7h25oIGPhuqduIHRoaeG6v3QKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgcmVzZXQgSVAgcHJveHk6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiByZXNldF9wcm94eV9pcChzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFBoxrDGoW5nIHRo4bupYyBwdWJsaWMgxJHhu4MgcmVzZXQgSVAgcHJveHkgKMSR4buDIHTGsMahbmcgdGjDrWNoIHbhu5tpIGNvZGUgY8WpKQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9yZXNldF9wcm94eV9pcChwcm94eV9jb25maWcpCgogICAgZGVmIHVucmVnaXN0ZXJfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgSOG7p3kgxJHEg25nIGvDvSBwcm94eSBzYXUga2hpIHPhu60gZOG7pW5nIHhvbmcKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5ICh0w7l5IGNo4buNbiwgY8OzIHRo4buDIGzhuqV5IHThu6sgZGF0YWJhc2UgbuG6v3Uga2jDtG5nIHRydXnhu4FuKQogICAgICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBo4buneSDEkcSDbmcga8O9IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0cnV54buBbiBwcm94eV9jb25maWcsIGPDsyB0aOG7gyBs4bqleSB04burIGRhdGFiYXNlIGhv4bq3YyBjb250ZXh0IGhp4buHbiB04bqhaQogICAgICAgICAgICBpZiBub3QgcHJveHlfY29uZmlnOgogICAgICAgICAgICAgICAgcHJpbnQoIktow7RuZyBjw7MgcHJveHkgY29uZmlnIMSR4buDIHVucmVnaXN0ZXIiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgQ29pIG5oxrAgdGjDoG5oIGPDtG5nIG7hur91IGtow7RuZyBjw7MgZ8OsIMSR4buDIHVucmVnaXN0ZXIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBwcm94eV90eXBlID0gcHJveHlfY29uZmlnLmdldCgidHlwZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcHJveHlfdHlwZSA9PSAicHBvZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdW5yZWdpc3Rlcl9wcG9lX3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxpZiBwcm94eV90eXBlIGluIFsiaHR0cCIsICJodHRwcyJdOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3VucmVnaXN0ZXJfaHR0cF9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSA9PSAic29ja3M1IjoKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl91bnJlZ2lzdGVyX3NvY2tzNV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIkxv4bqhaSBwcm94eSBraMO0bmcgY+G6p24gdW5yZWdpc3RlciBob+G6t2Mga2jDtG5nIMSRxrDhu6NjIGjhu5cgdHLhu6M6IHtwcm94eV90eXBlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3VucmVnaXN0ZXJfcHBvZV9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEjhu6d5IMSRxINuZyBrw70gcHJveHkgUFBQb0UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IFBQUG9FCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGhvc3QgPSBwcm94eV9jb25maWcuZ2V0KCJzZXJ2ZXJfaXAiKQogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoInByb3h5X2lkIikKICAgICAgICAgICAgcHJveHlfbmFtZSA9IHByb3h5X2NvbmZpZy5nZXQoIm5hbWUiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGhvc3Q6CiAgICAgICAgICAgICAgICBwcmludCgiVGhp4bq/dSB0aMO0bmcgdGluIGhvc3QgY2hvIHByb3h5IFBQUG9FLCBi4buPIHF1YSB1bnJlZ2lzdGVyIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBBUEkgdW5yZWdpc3RlcgogICAgICAgICAgICB1bnJlZ2lzdGVyX3VybCA9IGYiaHR0cDovL3tob3N0fS91bnJlZ2lzdGVyIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBsb2NhbCBJUCB04burIGRldmljZSBpbmZvCiAgICAgICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgICAgICBsb2NhbF9pcCA9ICIiCiAgICAgICAgICAgIGlmIGRldmljZV9pbmZvLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gZGV2aWNlX2luZm86CiAgICAgICAgICAgICAgICBsb2NhbF9pcCA9IGRldmljZV9pbmZvWyJkYXRhIl0uZ2V0KCJsb2NhbF9pcCIsICIiKQogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl9kYXRhID0geyJuYW1lIjogcHJveHlfbmFtZX0KICAgICAgICAgICAgICAgIGlmIGxvY2FsX2lwOgogICAgICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJfZGF0YVsibG9jYWxfaXAiXSA9IGxvY2FsX2lwCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyX3Jlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyX3VybCwgCiAgICAgICAgICAgICAgICAgICAganNvbj11bnJlZ2lzdGVyX2RhdGEsIAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9LCAKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiB1bnJlZ2lzdGVyX3Jlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgaOG7p3kgxJHEg25nIGvDvSB0aMOgbmggY8O0bmcgduG7m2kgcHJveHkgUFBQb0Ugc2VydmVyOiB7aG9zdH0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGjhu6d5IMSRxINuZyBrw70gduG7m2kgcHJveHkgUFBQb0Ugc2VydmVyOiB7dW5yZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJLaMO0bmcgdGjhu4Mga+G6v3QgbuG7kWkgxJHhur9uIHByb3h5IFBQUG9FIHNlcnZlciB7aG9zdH0gxJHhu4MgdW5yZWdpc3Rlcjoge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHByb3h5IFBQUG9FOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3VucmVnaXN0ZXJfaHR0cF9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEjhu6d5IMSRxINuZyBrw70gcHJveHkgSFRUUC9IVFRQUwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgSFRUUAogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEhUVFAgcHJveHkgdGjGsOG7nW5nIGtow7RuZyBj4bqnbiB1bnJlZ2lzdGVyIMSR4bq3YyBiaeG7h3QKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJpZCIpCiAgICAgICAgICAgIHByaW50KGYiSOG7p3kgxJHEg25nIGvDvSBwcm94eSBIVFRQIHtwcm94eV9pZH0gKGtow7RuZyBj4bqnbiB0aGFvIHTDoWMgxJHhurdjIGJp4buHdCkiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGjhu6d5IMSRxINuZyBrw70gcHJveHkgSFRUUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF91bnJlZ2lzdGVyX3NvY2tzNV9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEjhu6d5IMSRxINuZyBrw70gcHJveHkgU09DS1M1CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBTT0NLUzUKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBTT0NLUzUgcHJveHkgdGjGsOG7nW5nIGtow7RuZyBj4bqnbiB1bnJlZ2lzdGVyIMSR4bq3YyBiaeG7h3QKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJpZCIpCiAgICAgICAgICAgIHByaW50KGYiSOG7p3kgxJHEg25nIGvDvSBwcm94eSBTT0NLUzUge3Byb3h5X2lkfSAoa2jDtG5nIGPhuqduIHRoYW8gdMOhYyDEkeG6t2MgYmnhu4d0KSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eSBTT0NLUzU6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBkZWJ1Z19lbGVtZW50X2JvdW5kcyhzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBEZWJ1ZyB0aMO0bmcgdGluIGJvdW5kcyBj4bunYSBlbGVtZW50IMSR4buDIGtp4buDbSB0cmEgeGVtIGPDsyB0YXAgxJHGsOG7o2Mga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgIHByaW50KCJERUJVRzogRWxlbWVudCBpcyBOb25lIG9yIGVtcHR5IikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgIHByaW50KCI9PT0gREVCVUcgRUxFTUVOVCBCT1VORFMgPT09IikKICAgICAgICBib3VuZHNfc3RyID0gZWxlbWVudC5nZXQoImJvdW5kcyIsICIiKQogICAgICAgIHByaW50KGYiT3JpZ2luYWwgYm91bmRzIHN0cmluZzogJ3tib3VuZHNfc3RyfSciKQogICAgICAgIAogICAgICAgICMgVGVzdCBnZXRfZWxlbWVudF9ib3VuZHMKICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IHNlbGYuZ2V0X2VsZW1lbnRfYm91bmRzKGVsZW1lbnQpCiAgICAgICAgcHJpbnQoZiJQYXJzZWQgYm91bmRzOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgIAogICAgICAgICMgVGVzdCBnZXRfZWxlbWVudF9jZW50ZXIKICAgICAgICBjZW50ZXJfeCwgY2VudGVyX3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgICAgIHByaW50KGYiQ2FsY3VsYXRlZCBjZW50ZXI6ICh7Y2VudGVyX3h9LCB7Y2VudGVyX3l9KSIpCiAgICAgICAgCiAgICAgICAgIyBUZXN0IHbhu5tpIHbDrSBk4bulIGPhu6UgdGjhu4MKICAgICAgICBwcmludCgiXG4tLS0gVGVzdGluZyB3aXRoIGV4YW1wbGUgYm91bmRzIFszNiwwXVs4NCwtMzBdIC0tLSIpCiAgICAgICAgdGVzdF9lbGVtZW50ID0geyJib3VuZHMiOiAiWzM2LDBdWzg0LC0zMF0iLCAiY29udGVudC1kZXNjIjogIlTDrG0ga2nhur9tIn0KICAgICAgICAKICAgICAgICB0ZXN0X3gxLCB0ZXN0X3kxLCB0ZXN0X3gyLCB0ZXN0X3kyID0gc2VsZi5nZXRfZWxlbWVudF9ib3VuZHModGVzdF9lbGVtZW50KQogICAgICAgIHByaW50KGYiVGVzdCBwYXJzZWQgYm91bmRzOiAoe3Rlc3RfeDF9LCB7dGVzdF95MX0sIHt0ZXN0X3gyfSwge3Rlc3RfeTJ9KSIpCiAgICAgICAgCiAgICAgICAgdGVzdF9jZW50ZXJfeCwgdGVzdF9jZW50ZXJfeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKHRlc3RfZWxlbWVudCkKICAgICAgICBwcmludChmIlRlc3QgY2FsY3VsYXRlZCBjZW50ZXI6ICh7dGVzdF9jZW50ZXJfeH0sIHt0ZXN0X2NlbnRlcl95fSkiKQogICAgICAgIAogICAgICAgICMgVGVzdCB0YXBfZWxlbWVudAogICAgICAgIHByaW50KCJcbi0tLSBUZXN0aW5nIHRhcF9lbGVtZW50IC0tLSIpCiAgICAgICAgcmVzdWx0ID0gc2VsZi50YXBfZWxlbWVudCh0ZXN0X2VsZW1lbnQpCiAgICAgICAgcHJpbnQoZiJUYXAgcmVzdWx0OiB7cmVzdWx0fSIpCiAgICAgICAgCiAgICAgICAgcHJpbnQoIj09PSBFTkQgREVCVUcgPT09IikKCiMgVGVzdCBmdW5jdGlvbiBmb3IgdGhlIHByb2JsZW1hdGljIGVsZW1lbnQKZGVmIHRlc3RfcHJvYmxlbWF0aWNfZWxlbWVudCgpOgogICAgIiIiCiAgICBUZXN0IGZ1bmN0aW9uIMSR4buDIGtp4buDbSB0cmEgZWxlbWVudCBjw7MgYm91bmRzIMOibQogICAgIiIiCiAgICBoZWxwZXIgPSBIZWxwZXJTZXJ2aWNlKCkKICAgIAogICAgIyBFbGVtZW50IHThu6sgdsOtIGThu6UgY+G7p2EgdXNlcgogICAgcHJvYmxlbWF0aWNfZWxlbWVudCA9IHsKICAgICAgICAiY2xhc3MiOiAiYW5kcm9pZC53aWRnZXQuSW1hZ2VWaWV3IiwKICAgICAgICAicGFja2FnZSI6ICJjb20uc3MuYW5kcm9pZC51Z2MudHJpbGwiLCAKICAgICAgICAicmVzb3VyY2UtaWQiOiAiY29tLnNzLmFuZHJvaWQudWdjLnRyaWxsOmlkL2RlbCIsCiAgICAgICAgInRleHQiOiAibnVsbCIsCiAgICAgICAgImNvbnRlbnQtZGVzYyI6ICJUw6xtIGtp4bq/bSIsCiAgICAgICAgImJvdW5kcyI6ICJbMzYsMF1bODQsLTMwXSIsCiAgICAgICAgImNsaWNrYWJsZSI6ICJmYWxzZSIsCiAgICAgICAgImVuYWJsZWQiOiAidHJ1ZSIsCiAgICAgICAgInZpc2libGUtdG8tdXNlciI6ICJmYWxzZSIKICAgIH0KICAgIAogICAgcHJpbnQoIlRlc3RpbmcgcHJvYmxlbWF0aWMgZWxlbWVudCB3aXRoIGJvdW5kcyBbMzYsMF1bODQsLTMwXSIpCiAgICBoZWxwZXIuZGVidWdfZWxlbWVudF9ib3VuZHMocHJvYmxlbWF0aWNfZWxlbWVudCkKICAgIAogICAgcHJpbnQoIlxuVHJ5aW5nIHRvIHRhcCB0aGUgZWxlbWVudC4uLiIpCiAgICByZXN1bHQgPSBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2JsZW1hdGljX2VsZW1lbnQpCiAgICBwcmludChmIkZpbmFsIHRhcCByZXN1bHQ6IHtyZXN1bHR9IikKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICB0ZXN0X3Byb2JsZW1hdGljX2VsZW1lbnQoKQogICAgCiAgICAjIFbDrSBk4bulIHPhu60gZOG7pW5nCiAgICBoZWxwZXIgPSBIZWxwZXJTZXJ2aWNlKCkKICAgIAogICAgIyBM4bqleSBrw61jaCB0aMaw4bubYyBtw6BuIGjDrG5oCiAgICB3aWR0aCwgaGVpZ2h0ID0gaGVscGVyLmdldF9zY3JlZW5fc2l6ZSgpCiAgICBwcmludChmIkvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmg6IHt3aWR0aH14e2hlaWdodH0iKQogICAgCiAgICAjIE3hu58gVGlrVG9rCiAgICBoZWxwZXIub3Blbl9hcHAoImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbCIpCiAgICAKICAgICMgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG7DunQgIlRyYW5nIGNo4bunIiBob+G6t2MgbsO6dCAiS2jDoW0gcGjDoSIgeHXhuqV0IGhp4buHbgogICAgZWxlbWVudHNfdG9fZmluZCA9IFsKICAgICAgICB7ImNvbnRlbnRfZGVzYyI6ICJUcmFuZyBjaOG7pyJ9LAogICAgICAgIHsiY29udGVudF9kZXNjIjogIktow6FtIHBow6EifQogICAgXQogICAgCiAgICBlbGVtZW50ID0gaGVscGVyLndhaXRfZm9yX2FueV9lbGVtZW50KGVsZW1lbnRzX3RvX2ZpbmQpCiAgICAKICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgcHJpbnQoZiLEkMOjIHTDrG0gdGjhuqV5IHBo4bqnbiB04butOiB7aGVscGVyLmdldF9lbGVtZW50X2NvbnRlbnRfZGVzYyhlbGVtZW50KX0iKQogICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIktow7RuZyB0w6xtIHRo4bqleSBwaOG6p24gdOG7rSBuw6BvIHNhdSB0aOG7nWkgZ2lhbiBjaOG7nSIp').decode('utf-8'))
