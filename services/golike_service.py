import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBMaXN0CmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCmZyb20gdXRpbHMgaW1wb3J0IExvZ0xldmVsLCBMb2dnZXIKCiMgVOG6oW8gbG9nZ2VyIHJpw6puZyBjaG8gR29MaWtlU2VydmljZQpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJHb0xpa2VTZXJ2aWNlIikKCiMgS2nhu4NtIHRyYSB2w6AgaW1wb3J0IGPDoWMgdGjGsCB2aeG7h24gY+G6p24gdGhp4bq/dAp0cnk6CiAgICBpbXBvcnQgcHljaHJvbWUKICAgIFBZQ0hST01FX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLndhcm5pbmcoIlRoxrAgdmnhu4duIHB5Y2hyb21lIGtow7RuZyBraOG6oyBk4bulbmcuIEjDo3kgY8OgaSDEkeG6t3QgYuG6sW5nIGzhu4duaDogcGlwIGluc3RhbGwgcHljaHJvbWUiKQogICAgUFlDSFJPTUVfQVZBSUxBQkxFID0gRmFsc2UKCnRyeToKICAgIGltcG9ydCBjbG91ZHNjcmFwZXIKICAgIENMT1VEU0NSQVBFUl9BVkFJTEFCTEUgPSBUcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIGxvZ2dlci53YXJuaW5nKCJUaMawIHZp4buHbiBjbG91ZHNjcmFwZXIga2jDtG5nIGto4bqjIGThu6VuZy4gSMOjeSBjw6BpIMSR4bq3dCBi4bqxbmcgbOG7h25oOiBwaXAgaW5zdGFsbCBjbG91ZHNjcmFwZXIiKQogICAgQ0xPVURTQ1JBUEVSX0FWQUlMQUJMRSA9IEZhbHNlCgp0cnk6CiAgICBpbXBvcnQgY3VybF9jZmZpCiAgICBmcm9tIGN1cmxfY2ZmaSBpbXBvcnQgcmVxdWVzdHMgYXMgY3VybF9yZXF1ZXN0cwogICAgQ1VSTF9DRkZJX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLndhcm5pbmcoIlRoxrAgdmnhu4duIGN1cmxfY2ZmaSBraMO0bmcga2jhuqMgZOG7pW5nLiBIw6N5IGPDoGkgxJHhurd0IGLhurFuZyBs4buHbmg6IHBpcCBpbnN0YWxsIGN1cmwtY2ZmaSIpCiAgICBDVVJMX0NGRklfQVZBSUxBQkxFID0gRmFsc2UKCmNsYXNzIEJyb3dzZXI6CiAgICAiIiIKICAgIEzhu5twIGdp4bqjIGzhuq1wIEJyb3dzZXIgY+G7p2EgcHljaHJvbWUgbuG6v3UgdGjGsCB2aeG7h24ga2jDtG5nIGto4bqjIGThu6VuZwogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgdXJsKToKICAgICAgICBzZWxmLnVybCA9IHVybAogICAgICAgIAogICAgZGVmIGxpc3RfdGFiKHNlbGYpOgogICAgICAgIHJldHVybiBbXQogICAgICAgIAogICAgZGVmIG5ld190YWIoc2VsZik6CiAgICAgICAgcmV0dXJuIE5vbmUKCmNsYXNzIEdvTGlrZVNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBHb0xpa2UgU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGRiX3NlcnZpY2U6IERhdGFiYXNlIHNlcnZpY2UgxJHhu4MgbMawdSB0aMO0bmcgdGluCiAgICAgICAgICAgIGhlbHBlcl9zZXJ2aWNlOiBIZWxwZXIgc2VydmljZSDEkeG7gyB0xrDGoW5nIHTDoWMgduG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5kYiA9IGRiX3NlcnZpY2UKICAgICAgICBzZWxmLmhlbHBlciA9IGhlbHBlcl9zZXJ2aWNlCiAgICAgICAgCiAgICAgICAgIyBD4bqldSBow6xuaCBjaG8gQVBJIHJlcXVlc3RzCiAgICAgICAgc2VsZi51c2VyX2FnZW50ID0gIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgSykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzExNC4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiIKICAgICAgICAKICAgICAgICAjIFF1eeG6v3QgxJHhu4tuaCBz4butIGThu6VuZyBjdXJsX2NmZmkgaGF5IGNsb3Vkc2NyYXBlcgogICAgICAgICMgVHLDqm4gVGVybXV4IHRoxrDhu51uZyBz4butIGThu6VuZyBjbG91ZHNjcmFwZXIgZG8gY3VybF9jZmZpIGPDsyB0aOG7gyBraMO0bmcgdMawxqFuZyB0aMOtY2gKICAgICAgICBpc190ZXJtdXggPSBzZWxmLl9jaGVja19pc190ZXJtdXgoKQogICAgICAgIHNlbGYudXNlX2N1cmxfY2ZmaSA9IG5vdCBpc190ZXJtdXggYW5kIENVUkxfQ0ZGSV9BVkFJTEFCTEUKICAgICAgICAKICAgICAgICAjIEto4bufaSB04bqhbyBjbGllbnQKICAgICAgICBpZiBub3Qgc2VsZi51c2VfY3VybF9jZmZpIGFuZCBDTE9VRFNDUkFQRVJfQVZBSUxBQkxFOgogICAgICAgICAgICBzZWxmLmNsaWVudCA9IGNsb3Vkc2NyYXBlci5jcmVhdGVfc2NyYXBlcigKICAgICAgICAgICAgICAgIGJyb3dzZXI9ewogICAgICAgICAgICAgICAgICAgICdicm93c2VyJzogJ2Nocm9tZScsCiAgICAgICAgICAgICAgICAgICAgJ3BsYXRmb3JtJzogJ2FuZHJvaWQnLAogICAgICAgICAgICAgICAgICAgICdkZXNrdG9wJzogRmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgRmFsbGJhY2sgdG8gcmVndWxhciByZXF1ZXN0cyBpZiBuZWl0aGVyIGlzIGF2YWlsYWJsZQogICAgICAgICAgICBzZWxmLmNsaWVudCA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIHTDuXkgY2jhu41uIGNobyBjdXJsX2NmZmkKICAgICAgICBzZWxmLmltcGVyc29uYXRlID0gImNocm9tZTExMCIKICAgICAgICAKICAgICAgICAjIEJp4bq/biB0aGVvIGTDtWkgdGhyZWFkIHJlcG9ydAogICAgICAgIHNlbGYucmVwb3J0X3RocmVhZCA9IE5vbmUKICAgICAgICAKICAgICAgICAjIEto4bufaSDEkeG7mW5nIHRocmVhZCByZXBvcnQKICAgICAgICBzZWxmLnN0YXJ0X3JlcG9ydF90aHJlYWQoKQoKICAgIGRlZiBfY2hlY2tfaXNfdGVybXV4KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIGPDsyDEkWFuZyBjaOG6oXkgdHLDqm4gVGVybXV4IGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJFhbmcgY2jhuqF5IHRyw6puIFRlcm11eAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGJp4bq/biBtw7RpIHRyxrDhu51uZyBURVJNVVhfVkVSU0lPTiBob+G6t2MgxJHGsOG7nW5nIGThuqtuIFRlcm11eCB0cm9uZyBQQVRICiAgICAgICAgICAgIGltcG9ydCBvcwogICAgICAgICAgICByZXR1cm4gJ1RFUk1VWF9WRVJTSU9OJyBpbiBvcy5lbnZpcm9uIG9yICcvZGF0YS9kYXRhL2NvbS50ZXJtdXgnIGluIG9zLmVudmlyb24uZ2V0KCdQQVRIJywgJycpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZmV0Y2hfZ29saWtlX2hlYWRlcnMoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBoZWFkZXJzIHThu6sgQ2hyb21lIHbDoCBsxrB1IHbDoG8gZGF0YWJhc2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IFBZQ0hST01FX0FWQUlMQUJMRToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgbOG6pXkgR29MaWtlIGhlYWRlcnM6IHRoxrAgdmnhu4duIHB5Y2hyb21lIGtow7RuZyBraOG6oyBk4bulbmciKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICBmcm9tIHB5Y2hyb21lIGltcG9ydCBCcm93c2VyCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgQ2hyb21lIMSRw6MgY8OgaSDEkeG6t3QgY2jGsGEKICAgICAgICAgICAgaWYgbm90IHNlbGYuaGVscGVyLmlzX2FwcF9pbnN0YWxsZWQoImNvbS5hbmRyb2lkLmNocm9tZSIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJDaHJvbWUgY2jGsGEgxJHGsOG7o2MgY8OgaSDEkeG6t3QgdHLDqm4gdGhp4bq/dCBi4buLIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTeG7nyBDaHJvbWUKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk3hu58g4bupbmcgZOG7pW5nIENocm9tZS4uLiIpCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuaGVscGVyLm9wZW5fYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiLCAiY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4iKQogICAgICAgICAgICBpZiByZXN1bHRbInN0YXR1cyJdICE9ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIG3hu58gQ2hyb21lIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMykKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTeG7nyBDaHJvbWUgZGVidWcgcG9ydCBi4bqxbmcgQURCCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgU+G7rSBk4bulbmcgQURCIMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICAgICAgICAgIGlmIHNlbGYuaGVscGVyLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLIHThu6sgaGVscGVyCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuaGVscGVyLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGzhu4duaCBmb3J3YXJkIHbhu5tpIHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsiZm9yd2FyZCIsICJ0Y3A6OTIyMiIsICJsb2NhbGFic3RyYWN0OmNocm9tZV9kZXZ0b29sc19yZW1vdGUiXQogICAgICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiQURCIGtow7RuZyDEkcaw4bujYyBr4bq/dCBu4buRaSwga2jDtG5nIHRo4buDIG3hu58gQ2hyb21lIGRlYnVnIHBvcnQiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBt4bufIENocm9tZSBkZWJ1ZyBwb3J0OiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBL4bq/dCBu4buRaSDEkeG6v24gQ2hyb21lIGLhurFuZyBweWNocm9tZQogICAgICAgICAgICBicm93c2VyID0gQnJvd3NlcigiaHR0cDovL2xvY2FsaG9zdDo5MjIyIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw6FjIHRhYiDEkWFuZyBt4bufCiAgICAgICAgICAgIGdvbGlrZV90YWIgPSBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBzZWFyY2ggYm94IGtow7RuZwogICAgICAgICAgICBzZWFyY2hfYm94ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uYW5kcm9pZC5jaHJvbWU6aWQvc2VhcmNoX2JveCIpCiAgICAgICAgICAgIGlmIHNlYXJjaF9ib3g6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiVOG6oW8gdGFiIG3hu5tpLi4uIikKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIFRo4butIHThuqFvIHRhYiBt4bubaSB24bubaSB44butIGzDvSBs4buXaSBKU09ORGVjb2RlRXJyb3IKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGdvbGlrZV90YWIgPSBicm93c2VyLm5ld190YWIoKQogICAgICAgICAgICAgICAgICAgICAgICBnb2xpa2VfdGFiLnN0YXJ0KCkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgKGpzb24uSlNPTkRlY29kZUVycm9yLCByZXF1ZXN0cy5leGNlcHRpb25zLkpTT05EZWNvZGVFcnJvcikgYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgSlNPTiBraGkgdOG6oW8gdGFiIG3hu5tpOiB7ZX0uIFRo4butIGto4bufaSDEkeG7mW5nIGzhuqFpIENocm9tZS4iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIsICJjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMykKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBs4bqhaSBs4buHbmggZm9yd2FyZAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5oZWxwZXIuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbImZvcndhcmQiLCAidGNwOjkyMjIiLCAibG9jYWxhYnN0cmFjdDpjaHJvbWVfZGV2dG9vbHNfcmVtb3RlIl0KICAgICAgICAgICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSBr4bq/dCBu4buRaSBs4bqhaQogICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyID0gQnJvd3NlcigiaHR0cDovL2xvY2FsaG9zdDo5MjIyIikKICAgICAgICAgICAgICAgICAgICAgICAgZ29saWtlX3RhYiA9IGJyb3dzZXIubmV3X3RhYigpCiAgICAgICAgICAgICAgICAgICAgICAgIGdvbGlrZV90YWIuc3RhcnQoKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGlmICJXZWJTb2NrZXRDb25uZWN0aW9uQ2xvc2VkRXhjZXB0aW9uIiBpbiBzdHIoZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS+G6v3QgbuG7kWkgV2ViU29ja2V0IMSRw6MgxJHDs25nIGtoaSB04bqhbyB0YWIgbeG7m2kuIFRo4butIMSRw7NuZyB2w6AgbeG7nyBs4bqhaSBDaHJvbWUuIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiLCAiY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4iKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSB04bqhbyB0YWIgbeG7m2kiKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw6FjIHRhYiDEkWFuZyBt4bufCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICB0YWJzID0gYnJvd3Nlci5saXN0X3RhYigpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IChqc29uLkpTT05EZWNvZGVFcnJvciwgcmVxdWVzdHMuZXhjZXB0aW9ucy5KU09ORGVjb2RlRXJyb3IpIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIEpTT04ga2hpIGxp4buHdCBrw6ogdGFiOiB7ZX0uIFRo4butIGto4bufaSDEkeG7mW5nIGzhuqFpIENocm9tZS4iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIsICJjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMykKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBs4bqhaSBs4buHbmggZm9yd2FyZAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5oZWxwZXIuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbImZvcndhcmQiLCAidGNwOjkyMjIiLCAibG9jYWxhYnN0cmFjdDpjaHJvbWVfZGV2dG9vbHNfcmVtb3RlIl0KICAgICAgICAgICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSBr4bq/dCBu4buRaSBs4bqhaQogICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyID0gQnJvd3NlcigiaHR0cDovL2xvY2FsaG9zdDo5MjIyIikKICAgICAgICAgICAgICAgICAgICAgICAgdGFicyA9IGJyb3dzZXIubGlzdF90YWIoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSB0YWIgZ29saWtlCiAgICAgICAgICAgICAgICAgICAgZm9yIHRhYiBpbiB0YWJzOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWIuc3RhcnQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiX2luZm8gPSB0YWIuY2FsbF9tZXRob2QoIlJ1bnRpbWUuZXZhbHVhdGUiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uPSJ3aW5kb3cubG9jYXRpb24uaHJlZiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dD0xMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhYl9pbmZvIGFuZCAicmVzdWx0IiBpbiB0YWJfaW5mbyBhbmQgInZhbHVlIiBpbiB0YWJfaW5mb1sicmVzdWx0Il06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF91cmwgPSB0YWJfaW5mb1sicmVzdWx0Il1bInZhbHVlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiYXBwLmdvbGlrZS5uZXQiIGluIGN1cnJlbnRfdXJsOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyB0w6xtIHRo4bqleSB0YWIgR29MaWtlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29saWtlX3RhYiA9IHRhYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiV2ViU29ja2V0Q29ubmVjdGlvbkNsb3NlZEV4Y2VwdGlvbiIgaW4gc3RyKGUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS+G6v3QgbuG7kWkgV2ViU29ja2V0IMSRw6MgxJHDs25nIGtoaSBraeG7g20gdHJhIHRhYjoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBraeG7g20gdHJhIHRhYjoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdvbGlrZV90YWI6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIEdvTGlrZSwgdOG6oW8gdGFiIG3hu5tpLi4uIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvbGlrZV90YWIgPSBicm93c2VyLm5ld190YWIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvbGlrZV90YWIuc3RhcnQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IChqc29uLkpTT05EZWNvZGVFcnJvciwgcmVxdWVzdHMuZXhjZXB0aW9ucy5KU09ORGVjb2RlRXJyb3IpIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgSlNPTiBraGkgdOG6oW8gdGFiIG3hu5tpOiB7ZX0uIFRo4butIGto4bufaSDEkeG7mW5nIGzhuqFpIENocm9tZS4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIsICJjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBs4bqhaSBs4buHbmggZm9yd2FyZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLmhlbHBlci5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJmb3J3YXJkIiwgInRjcDo5MjIyIiwgImxvY2FsYWJzdHJhY3Q6Y2hyb21lX2RldnRvb2xzX3JlbW90ZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJvd3NlciA9IEJyb3dzZXIoImh0dHA6Ly9sb2NhbGhvc3Q6OTIyMiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29saWtlX3RhYiA9IGJyb3dzZXIubmV3X3RhYigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29saWtlX3RhYi5zdGFydCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJXZWJTb2NrZXRDb25uZWN0aW9uQ2xvc2VkRXhjZXB0aW9uIiBpbiBzdHIoZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJL4bq/dCBu4buRaSBXZWJTb2NrZXQgxJHDoyDEkcOzbmcga2hpIHThuqFvIHRhYiBt4bubaS4gVGjhu60gxJHDs25nIHbDoCBt4bufIGzhuqFpIENocm9tZS4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIsICJjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgdOG6oW8gdGFiIG3hu5tpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBpZiAiV2ViU29ja2V0Q29ubmVjdGlvbkNsb3NlZEV4Y2VwdGlvbiIgaW4gc3RyKGUpOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkvhur90IG7hu5FpIFdlYlNvY2tldCDEkcOjIMSRw7NuZyBraGkgbGnhu4d0IGvDqiB0YWIuIFRo4butIMSRw7NuZyB2w6AgbeG7nyBs4bqhaSBDaHJvbWUuIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiLCAiY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4iKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraeG7g20gdHJhIGPDoWMgdGFiIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELhuq10IHRoZW8gZMO1aSBt4bqhbmcKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ29saWtlX3RhYi5OZXR3b3JrLmVuYWJsZSgpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGlmICJXZWJTb2NrZXRDb25uZWN0aW9uQ2xvc2VkRXhjZXB0aW9uIiBpbiBzdHIoZSk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJL4bq/dCBu4buRaSBXZWJTb2NrZXQgxJHDoyDEkcOzbmcga2hpIGLhuq10IHRoZW8gZMO1aSBt4bqhbmcuIFRo4butIMSRw7NuZyB2w6AgbeG7nyBs4bqhaSBDaHJvbWUuIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgYuG6rXQgdGhlbyBkw7VpIG3huqFuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEJp4bq/biDEkeG7gyBraeG7g20gdHJhIHhlbSByZXF1ZXN0IMSRw6MgxJHGsOG7o2MgZ2hpIG5o4bqtbiBjaMawYQogICAgICAgICAgICByZXF1ZXN0X2NhcHR1cmVkID0gRmFsc2UKICAgICAgICAgICAgaGVhZGVycyA9IE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDEg25nIGvDvSBz4buxIGtp4buHbiByZXF1ZXN0V2lsbEJlU2VudAogICAgICAgICAgICBkZWYgcmVxdWVzdF9jYWxsYmFjaygqKmt3YXJncyk6CiAgICAgICAgICAgICAgICBub25sb2NhbCByZXF1ZXN0X2NhcHR1cmVkLCBoZWFkZXJzCiAgICAgICAgICAgICAgICBpZiByZXF1ZXN0X2NhcHR1cmVkOgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXF1ZXN0ID0ga3dhcmdzLmdldCgicmVxdWVzdCIsIHt9KQogICAgICAgICAgICAgICAgdXJsID0gcmVxdWVzdC5nZXQoInVybCIsICIiKQogICAgICAgICAgICAgICAgbWV0aG9kID0gcmVxdWVzdC5nZXQoIm1ldGhvZCIsICIiKQogICAgICAgICAgICAgICAgaWYgImh0dHBzOi8vZ2F0ZXdheS5nb2xpa2UubmV0L2FwaS9zdGF0aXN0aWNzL3JlcG9ydCIgaW4gdXJsIGFuZCBtZXRob2QgPT0gIkdFVCI6CiAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IHJlcXVlc3QuZ2V0KCJoZWFkZXJzIiwge30pCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgZ2hpIG5o4bqtbiBoZWFkZXJzIEdvTGlrZSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RfY2FwdHVyZWQgPSBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICBnb2xpa2VfdGFiLk5ldHdvcmsucmVxdWVzdFdpbGxCZVNlbnQgPSByZXF1ZXN0X2NhbGxiYWNrCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqNpIGzhuqFpIHRyYW5nIMSR4buDIGdoaSBuaOG6rW4gcmVxdWVzdAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBnb2xpa2VfdGFiLmNhbGxfbWV0aG9kKCJQYWdlLm5hdmlnYXRlIiwgdXJsPSJodHRwczovL2FwcC5nb2xpa2UubmV0IikKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgaWYgIldlYlNvY2tldENvbm5lY3Rpb25DbG9zZWRFeGNlcHRpb24iIGluIHN0cihlKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkvhur90IG7hu5FpIFdlYlNvY2tldCDEkcOjIMSRw7NuZyBraGkgdOG6o2kgbOG6oWkgdHJhbmcuIFRo4butIMSRw7NuZyB2w6AgbeG7nyBs4bqhaSBDaHJvbWUuIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgdOG6o2kgbOG6oWkgdHJhbmciKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG7o2kgMTAgZ2nDonkgxJHhu4MgZ2hpIG5o4bqtbiByZXF1ZXN0CiAgICAgICAgICAgIHRpbWUuc2xlZXAoMTApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuq90IHRoZW8gZMO1aSBt4bqhbmcgdsOgIHjDs2EgbGlzdGVuZXIKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ29saWtlX3RhYi5OZXR3b3JrLmRpc2FibGUoKQogICAgICAgICAgICAgICAgZ29saWtlX3RhYi5OZXR3b3JrLnJlcXVlc3RXaWxsQmVTZW50ID0gTm9uZQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBpZiAiV2ViU29ja2V0Q29ubmVjdGlvbkNsb3NlZEV4Y2VwdGlvbiIgaW4gc3RyKGUpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJL4bq/dCBu4buRaSBXZWJTb2NrZXQgxJHDoyDEkcOzbmcga2hpIHThuq90IHRoZW8gZMO1aSBt4bqhbmcuIFRp4bq/cCB04bulYyB44butIGzDvS4iKQogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIHJldHVybiB2w6wgxJHDoyBjw7MgdGjhu4MgbOG6pXkgxJHGsOG7o2MgaGVhZGVycwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSB04bqvdCB0aGVvIGTDtWkgbeG6oW5nOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBoZWFkZXJzOgogICAgICAgICAgICAgICAgIyBMxrB1IGhlYWRlcnMgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICAgICAgc2VsZi5zYXZlX2dvbGlrZV9oZWFkZXJzKGhlYWRlcnMpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBsxrB1IGhlYWRlcnMgdsOgbyBkYXRhYmFzZSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBs4bqleSB0aMO0bmcgdGluIHjDoWMgdGjhu7FjIEdvTGlrZSwgdnVpIGzDsm5nIGtp4buDbSB0cmEgbOG6oWkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGlmICJXZWJTb2NrZXRDb25uZWN0aW9uQ2xvc2VkRXhjZXB0aW9uIiBpbiBzdHIoZSk6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkvhur90IG7hu5FpIFdlYlNvY2tldCDEkcOjIMSRw7NuZy4gVGjhu60gxJHDs25nIHbDoCBt4bufIGzhuqFpIENocm9tZS4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbeG7nyBDaHJvbWUgdsOgIGvhur90IG7hu5FpIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgc2F2ZV9nb2xpa2VfaGVhZGVycyhzZWxmLCBoZWFkZXJzOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBMxrB1IEdvTGlrZSBoZWFkZXJzIHbDoG8gZGF0YWJhc2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBoZWFkZXJzOiBIZWFkZXJzIHThu6sgcmVxdWVzdCBHb0xpa2UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaOG7iSBsxrB1IHbDoG8gY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLIMSR4buDIMSR4buTbmcgYuG7mSB24bubaSBzZXJ2ZXIKICAgICAgICAgICAgc2VsZi5kYi5zZXRfZGV2aWNlX2NvbmZpZygiZ29saWtlX2hlYWRlcnMiLCBoZWFkZXJzKQogICAgICAgICAgICBzZWxmLmRiLnNldF9kZXZpY2VfY29uZmlnKCJnb2xpa2VfaGVhZGVyc191cGRhdGVkIiwgaW50KHRpbWUudGltZSgpKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbMawdSBHb0xpa2UgaGVhZGVyczoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBnZXRfZ29saWtlX2hlYWRlcnMoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgR29MaWtlIGhlYWRlcnMgdOG7qyBkYXRhYmFzZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBIZWFkZXJzIGhv4bq3YyBkaWN0aW9uYXJ5IHLhu5duZyBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgIyBDaOG7iSBs4bqleSB04burIGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iwogICAgICAgIHJldHVybiBzZWxmLmRiLmdldF9kZXZpY2VfY29uZmlnKCJnb2xpa2VfaGVhZGVycyIsIHt9KQogICAgICAgIAogICAgZGVmIGlzX2dvbGlrZV9hdXRoZW50aWNhdGVkKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIifgogICAgICAgIEtp4buDbSB0cmEgeGVtIMSRw6MgY8OzIHRow7RuZyB0aW4geMOhYyB0aOG7sWMgR29MaWtlIGNoxrBhCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkcOjIHjDoWMgdGjhu7FjLCBGYWxzZSBu4bq/dSBjaMawYQogICAgICAgICIiIgogICAgICAgIGhlYWRlcnMgPSBzZWxmLmdldF9nb2xpa2VfaGVhZGVycygpCiAgICAgICAgIyBLaeG7g20gdHJhIGPDsyBhdXRob3JpemF0aW9uIHRyb25nIGhlYWRlcnMKICAgICAgICByZXR1cm4gYm9vbChoZWFkZXJzKQogICAgCiAgICBkZWYgZmV0Y2hfZ29saWtlX2hlYWRlcnNfd2l0aF9yZXRyeShzZWxmLCBmb3JjZV9yZWZyZXNoOiBib29sID0gRmFsc2UpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgR29MaWtlIGhlYWRlcnMgduG7m2kgY8ahIGNo4bq/IHRo4butIGzhuqFpLiBUaOG7rSBs4bqhaSB04buRaSDEkWEgNSBs4bqnbiBu4bq/dSB0aOG6pXQgYuG6oWkuCiAgICAgICAgQ2jhu4kgbOG6pXkgbOG6oWkgaGVhZGVycyAxIGzhuqduIG3hu5dpIG5nw6B5IGThu7FhIHbDoG8gdGjhu51pIGdpYW4gY+G6rXAgbmjhuq10IGN14buRaSBjw7luZy4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBmb3JjZV9yZWZyZXNoOiBO4bq/dSBUcnVlLCBz4bq9IGx1w7RuIGzhuqV5IGzhuqFpIGhlYWRlcnMgYuG6pXQga+G7gyB0aOG7nWkgZ2lhbiBj4bqtcCBuaOG6rXQgY3Xhu5FpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJHDoyBjw7MgaGVhZGVycyBo4bujcCBs4buHIGhv4bq3YyBs4bqleSDEkcaw4bujYyBoZWFkZXJzIG3hu5tpLCBGYWxzZSBu4bq/dSBraMO0bmcgbOG6pXkgxJHGsOG7o2MKICAgICAgICAiIiIKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6MgY8OzIHRow7RuZyB0aW4geMOhYyB0aOG7sWMgR29MaWtlIGNoxrBhCiAgICAgICAgaWYgc2VsZi5pc19nb2xpa2VfYXV0aGVudGljYXRlZCgpIGFuZCBub3QgZm9yY2VfcmVmcmVzaDoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHRo4budaSBnaWFuIGPhuq1wIG5o4bqtdCBjdeG7kWkKICAgICAgICAgICAgbGFzdF91cGRhdGUgPSBzZWxmLmRiLmdldCgiZ29saWtlX2hlYWRlcnNfdXBkYXRlZCIsIDApCiAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgxJHDoyBj4bqtcCBuaOG6rXQgdHJvbmcgdsOybmcgMjQgZ2nhu50gcXVhLCBraMO0bmcgY+G6p24gbOG6pXkgbOG6oWkKICAgICAgICAgICAgaWYgY3VycmVudF90aW1lIC0gbGFzdF91cGRhdGUgPCA4NjQwMDogICMgMjQgZ2nhu50gPSA4NjQwMCBnacOieQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgY8OzIHRow7RuZyB0aW4geMOhYyB0aOG7sWMgR29MaWtlIHbDoCBjaMawYSBxdcOhIDI0IGdp4budIHThu6sgbOG6p24gY+G6rXAgbmjhuq10IGN14buRaSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgcXXDoSAyNCBnaeG7nSB04burIGzhuqduIGPhuq1wIG5o4bqtdCBjdeG7kWksIHPhur0gbMOgbSBt4bubaSBoZWFkZXJzIEdvTGlrZSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgZm9yY2VfcmVmcmVzaDoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJC4bqvdCBideG7mWMgbMOgbSBt4bubaSBoZWFkZXJzIEdvTGlrZSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiQ2jGsGEgY8OzIHRow7RuZyB0aW4geMOhYyB0aOG7sWMgR29MaWtlLCBz4bq9IGzhuqV5IGhlYWRlcnMgbeG7m2kiKQogICAgICAgIAogICAgICAgICMgVGjhu7FjIGhp4buHbiBs4bqleSBoZWFkZXJzIHbhu5tpIGPGoSBjaOG6vyB0aOG7rSBs4bqhaQogICAgICAgIG1heF9hdHRlbXB0cyA9IDUgICMgVMSDbmcgc+G7kSBs4bqnbiB0aOG7rSB04burIDMgbMOqbiA1CiAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UoMSwgbWF4X2F0dGVtcHRzICsgMSk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJBhbmcgbOG6pXkgR29MaWtlIGhlYWRlcnMgKGzhuqduIHRo4butIHthdHRlbXB0fS97bWF4X2F0dGVtcHRzfSkuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBUaOG7rSBs4bqleSBoZWFkZXJzCiAgICAgICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5mZXRjaF9nb2xpa2VfaGVhZGVycygpCiAgICAgICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGzhuqV5IHbDoCBsxrB1IGhlYWRlcnMgR29MaWtlIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdGjhu4MgbOG6pXkgaGVhZGVycyBHb0xpa2UgbOG6p24ge2F0dGVtcHR9LCBz4bq9IHRo4butIGzhuqFpLi4uIikKICAgICAgICAgICAgICAgICAgICAjIMSQw7NuZyBDaHJvbWUgbuG6v3UgY8OybiBt4bufCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCBtYXhfYXR0ZW1wdHM6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gdGhlbyBz4buRIGzhuqduIHRo4butICgxMHMsIDIwcywgMzBzLCA0MHMpCiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRfdGltZSA9IGF0dGVtcHQgKiAxMAogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQ4bujaSB7d2FpdF90aW1lfSBnacOieSB0csaw4bubYyBraGkgdGjhu60gbOG6oWkuLi4iKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHdhaXRfdGltZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGzhuqV5IGhlYWRlcnMgR29MaWtlOiB7ZX0iKQogICAgICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gQ2hyb21lIMSRxrDhu6NjIMSRw7NuZwogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9hdHRlbXB0czoKICAgICAgICAgICAgICAgICAgICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIHRoZW8gc+G7kSBs4bqnbiB0aOG7rSAoMTBzLCAyMHMsIDMwcywgNDBzKQogICAgICAgICAgICAgICAgICAgIHdhaXRfdGltZSA9IGF0dGVtcHQgKiAxMAogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDhu6NpIHt3YWl0X3RpbWV9IGdpw6J5IHRyxrDhu5tjIGtoaSB0aOG7rSBs4bqhaS4uLiIpCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmVycm9yKGYixJDDoyB0aOG7rSBs4bqleSBHb0xpa2UgaGVhZGVycyB7bWF4X2F0dGVtcHRzfSBs4bqnbiBuaMawbmcga2jDtG5nIHRow6BuaCBjw7RuZyIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGFwaV9yZXF1ZXN0KHNlbGYsIHVybCwgbWV0aG9kPSJHRVQiLCBwYXlsb2FkPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIEfhu41pIEFQSSBj4bunYSBHb0xpa2UgduG7m2kgaGVhZGVycyDEkcOjIGzGsHUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB1cmw6IFVSTCBj4bunYSBBUEkKICAgICAgICAgICAgbWV0aG9kOiBQaMawxqFuZyB0aOG7qWMgSFRUUCAoR0VUIGhv4bq3YyBQT1NUKQogICAgICAgICAgICBwYXlsb2FkOiBE4buvIGxp4buHdSBn4butaSDEkWkgKGNobyBQT1NUIHJlcXVlc3QpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgaG/hurdjIE5vbmU6IEvhur90IHF14bqjIEFQSSBu4bq/dSB0aMOgbmggY8O0bmcsIE5vbmUgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGhlYWRlcnMgdOG7qyBkYXRhYmFzZQogICAgICAgICAgICBoZWFkZXJzID0gc2VsZi5nZXRfZ29saWtlX2hlYWRlcnMoKQogICAgICAgICAgICBpZiBub3QgaGVhZGVyczoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IEdvTGlrZSBoZWFkZXJzIikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBoZWFkZXJzIGPDsyB1c2VyLWFnZW50CiAgICAgICAgICAgIGlmICJ1c2VyLWFnZW50IiBub3QgaW4gaGVhZGVycyBhbmQgIlVzZXItQWdlbnQiIG5vdCBpbiBoZWFkZXJzOgogICAgICAgICAgICAgICAgaGVhZGVyc1sidXNlci1hZ2VudCJdID0gc2VsZi51c2VyX2FnZW50CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBBUEkgYmFzZSBVUkwgdOG7qyBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgaG/hurdjIHPhu60gZOG7pW5nIG3hurdjIMSR4buLbmggdOG7qyBjb25maWcKICAgICAgICAgICAgYXBpX2Jhc2UgPSBzZWxmLmRiLmdldF9kZXZpY2VfY29uZmlnKCJnb2xpa2VfYXBpX2Jhc2UiLCBjb25maWcuR09MSUtFX0FQSV9CQVNFKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBVUkwga2jDtG5nIGLhuq90IMSR4bqndSBi4bqxbmcgaHR0cCwgdGjDqm0gYXBpX2Jhc2UgdsOgbyB0csaw4bubYwogICAgICAgICAgICBpZiBub3QgdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICAgICAgICAgIHVybCA9IGYie2FwaV9iYXNlfS97dXJsLmxzdHJpcCgnLycpfSIKCiAgICAgICAgICAgICMgU+G7rSBk4bulbmcgY3VybF9jZmZpIGhv4bq3YyBjbG91ZHNjcmFwZXIgdMO5eSB0aGVvIG3DtGkgdHLGsOG7nW5nCiAgICAgICAgICAgIGlmIHNlbGYudXNlX2N1cmxfY2ZmaSBhbmQgQ1VSTF9DRkZJX0FWQUlMQUJMRToKICAgICAgICAgICAgICAgIGlmIG1ldGhvZCA9PSAiR0VUIjoKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IGN1cmxfcmVxdWVzdHMuZ2V0KAogICAgICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycywKICAgICAgICAgICAgICAgICAgICAgICAgaW1wZXJzb25hdGU9c2VsZi5pbXBlcnNvbmF0ZQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGVsaWYgbWV0aG9kID09ICJQT1NUIjoKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IGN1cmxfcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBqc29uPXBheWxvYWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycywKICAgICAgICAgICAgICAgICAgICAgICAgaW1wZXJzb25hdGU9c2VsZi5pbXBlcnNvbmF0ZQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTWV0aG9kIGtow7RuZyBo4bujcCBs4buHOiB7bWV0aG9kfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgU+G7rSBk4bulbmcgY2xvdWRzY3JhcGVyIGhv4bq3YyBmYWxsYmFjayB0byByZXF1ZXN0cwogICAgICAgICAgICAgICAgaWYgbWV0aG9kID09ICJHRVQiOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5jbGllbnQuZ2V0KAogICAgICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGVsaWYgbWV0aG9kID09ICJQT1NUIjoKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuY2xpZW50LnBvc3QoCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICAgICAganNvbj1wYXlsb2FkLAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIk1ldGhvZCBraMO0bmcgaOG7o3AgbOG7hzoge21ldGhvZH0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGhp4buDbiB0aOG7iyBs4buXaSBk4buFIMSR4buNYyBoxqFuCiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSByZXNwb25zZS50ZXh0CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyBQYXJzZSByZXNwb25zZSBsw6AgSlNPTgogICAgICAgICAgICAgICAgICAgIGVycm9yX2pzb24gPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgICAgICAgICAjIEZvcm1hdCBsb2cgdGjDoG5oIDEgZMOybmcKICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBlcnJvcl9qc29uLmdldCgnc3RhdHVzJywgcmVzcG9uc2Uuc3RhdHVzX2NvZGUpCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGVycm9yX2pzb24uZ2V0KCdzdWNjZXNzJywgRmFsc2UpCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IGVycm9yX2pzb24uZ2V0KCdtZXNzYWdlJywgJ0tow7RuZyBjw7MgdGjDtG5nIGLDoW8gbOG7l2knKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgR+G7mXAgdGjDoG5oIDEgZMOybmcKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJBUEkgdHLhuqMgduG7gSBs4buXaSBbe3N0YXR1c31dIFtzdWNjZXNzOiB7c3VjY2Vzc31dIHttZXNzYWdlfSIpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgcGjhuqNpIEpTT04sIGhp4buDbiB0aOG7iyB0ZXh0IHRow7QKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJBUEkgdHLhuqMgduG7gSBs4buXaSB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9OiB7ZXJyb3JfbXNnfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4buNaSBBUEk6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgX2N1cmxfY2ZmaV9yZXF1ZXN0KHNlbGYsIHVybDogc3RyLCBtZXRob2Q6IHN0ciA9ICJnZXQiLCBoZWFkZXJzOiBEaWN0W3N0ciwgc3RyXSA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IERpY3Rbc3RyLCBBbnldID0gTm9uZSwgdGltZW91dDogaW50ID0gMzApIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIHJlcXVlc3Qgc+G7rSBk4bulbmcgY3VybF9jZmZpIChoaeG7h3UgcXXhuqMgY2hvIENsb3VkZmxhcmUpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBtZXRob2QubG93ZXIoKSA9PSAiZ2V0IjoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3VybF9yZXF1ZXN0cy5nZXQoCiAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycywKICAgICAgICAgICAgICAgICAgICBkYXRhPWRhdGEsCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0LAogICAgICAgICAgICAgICAgICAgIGltcGVyc29uYXRlPSJjaHJvbWUxMTAiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsc2U6ICAjIFBPU1QKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3VybF9yZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgZGF0YT1kYXRhLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dCwKICAgICAgICAgICAgICAgICAgICBpbXBlcnNvbmF0ZT0iY2hyb21lMTEwIgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgc3RhdHVzIGNvZGU6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4buNaSBBUEk6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICBkZWYgZmV0Y2hfZ29saWtlX3JlcG9ydChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIHJlcG9ydCB04burIEdvTGlrZSB2w6AgdOG7lW5nIGjhu6NwIGzhuqFpCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IFRow7RuZyB0aW4gcmVwb3J0IMSRw6MgdOG7lW5nIGjhu6NwIGhv4bq3YyBkaWN0IHLhu5duZyBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgR+G7jWkgQVBJIHJlcG9ydAogICAgICAgICAgICByZXBvcnRfZGF0YSA9IHNlbGYuYXBpX3JlcXVlc3QoInN0YXRpc3RpY3MvcmVwb3J0IikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCByZXBvcnRfZGF0YSBvciAic3VjY2VzcyIgbm90IGluIHJlcG9ydF9kYXRhIG9yIG5vdCByZXBvcnRfZGF0YVsic3VjY2VzcyJdOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgbOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgdOG7qyBHb0xpa2UiKQogICAgICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBU4buVbmcgaOG7o3AgdGjDtG5nIHRpbgogICAgICAgICAgICBjdXJyZW50X2NvaW4gPSByZXBvcnRfZGF0YS5nZXQoImN1cnJlbnRfY29pbiIsIDApCiAgICAgICAgICAgIG1lc3NhZ2UgPSByZXBvcnRfZGF0YS5nZXQoIm1lc3NhZ2UiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOtbmggdOG7lW5nIHBlbmRpbmdfY29pbiB2w6AgaG9sZF9jb2luIHThu6sgY8OhYyBhcHAgcXVhbiB0w6JtCiAgICAgICAgICAgIGFwcHMgPSBbImluc3RhZ3JhbSIsICJ0aWt0b2siLCAic25hcGNoYXQiXQogICAgICAgICAgICB0b3RhbF9wZW5kaW5nX2NvaW4gPSAwCiAgICAgICAgICAgIHRvdGFsX2hvbGRfY29pbiA9IDAKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBhcHAgaW4gYXBwczoKICAgICAgICAgICAgICAgIGlmIGFwcCBpbiByZXBvcnRfZGF0YToKICAgICAgICAgICAgICAgICAgICBhcHBfZGF0YSA9IHJlcG9ydF9kYXRhW2FwcF0KICAgICAgICAgICAgICAgICAgICB0b3RhbF9wZW5kaW5nX2NvaW4gKz0gYXBwX2RhdGEuZ2V0KCJwZW5kaW5nX2NvaW4iLCAwKQogICAgICAgICAgICAgICAgICAgIHRvdGFsX2hvbGRfY29pbiArPSBhcHBfZGF0YS5nZXQoImhvbGRfY29pbiIsIDApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIGRpY3Qga+G6v3QgcXXhuqMgdOG7lW5nIGjhu6NwCiAgICAgICAgICAgIHN1bW1hcnkgPSB7CiAgICAgICAgICAgICAgICAiY3VycmVudF9jb2luIjogY3VycmVudF9jb2luLAogICAgICAgICAgICAgICAgInRvdGFsX3BlbmRpbmdfY29pbiI6IHRvdGFsX3BlbmRpbmdfY29pbiwKICAgICAgICAgICAgICAgICJ0b3RhbF9ob2xkX2NvaW4iOiB0b3RhbF9ob2xkX2NvaW4sCiAgICAgICAgICAgICAgICAiZ29saWtlX3JlcG9ydF9tZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgICAgICJnb2xpa2VfcmVwb3J0X3VwZGF0ZWRfYXQiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJnb2xpa2VfcmVwb3J0Iiwgc3VtbWFyeSkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIEdvTGlrZSByZXBvcnQ6IHh1IGhp4buHbiB04bqhaT17Y3VycmVudF9jb2lufSwgeHUgxJFhbmcgY2jhu509e3RvdGFsX3BlbmRpbmdfY29pbn0sIHh1IGdp4buvPXt0b3RhbF9ob2xkX2NvaW59IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzdW1tYXJ5CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgdOG7qyBHb0xpa2U6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7fQogICAgICAgICAgICAKICAgIGRlZiBzdGFydF9yZXBvcnRfdGhyZWFkKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSDEkeG7mW5nIHRocmVhZCDEkeG7i25oIGvhu7MgbOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgdOG7qyBHb0xpa2UKICAgICAgICAiIiIKICAgICAgICAjIEtp4buDbSB0cmEgdGhyZWFkIMSRw6MgY2jhuqF5IGNoxrBhCiAgICAgICAgaWYgc2VsZi5yZXBvcnRfdGhyZWFkIGlzIG5vdCBOb25lIGFuZCBzZWxmLnJlcG9ydF90aHJlYWQuaXNfYWxpdmUoKToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlRocmVhZCByZXBvcnQgR29MaWtlIMSRw6MgxJFhbmcgY2jhuqF5IikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgIGltcG9ydCB0aHJlYWRpbmcKICAgICAgICAKICAgICAgICBkZWYgcmVwb3J0X2xvb3AoKToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkLhuq90IMSR4bqndSB0aHJlYWQgbOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgR29MaWtlIMSR4buLbmgga+G7syIpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyBjw7MgaGVhZGVycyBjaMawYQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfZ29saWtlX2F1dGhlbnRpY2F0ZWQoKToKICAgICAgICAgICAgICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIHJlcG9ydAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZldGNoX2dvbGlrZV9yZXBvcnQoKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJDaMawYSBjw7MgaGVhZGVycyBHb0xpa2UsIGtow7RuZyB0aOG7gyBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHRyb25nIHRocmVhZCByZXBvcnQgR29MaWtlOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOZ+G7pyAxMCBwaMO6dAogICAgICAgICAgICAgICAgdGltZS5zbGVlcCg2MDApCiAgICAgICAgCiAgICAgICAgIyBU4bqhbyB2w6Aga2jhu59pIMSR4buZbmcgdGhyZWFkCiAgICAgICAgc2VsZi5yZXBvcnRfdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9cmVwb3J0X2xvb3AsIGRhZW1vbj1UcnVlKQogICAgICAgIHNlbGYucmVwb3J0X3RocmVhZC5zdGFydCgpCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga2jhu59pIMSR4buZbmcgdGhyZWFkIGzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IEdvTGlrZSDEkeG7i25oIGvhu7MiKQoKICAgIGRlZiBnZXRfZ29saWtlX3JlcG9ydChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIHJlcG9ydCBHb0xpa2UgxJHDoyBsxrB1IHRyb25nIGRhdGFiYXNlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IFRow7RuZyB0aW4gcmVwb3J0IGhv4bq3YyBkaWN0IHLhu5duZyBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuZGIuZ2V0KCJnb2xpa2VfcmVwb3J0Iiwge30pCg==').decode('utf-8'))
