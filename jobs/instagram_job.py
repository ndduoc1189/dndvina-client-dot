import base64
exec(base64.b64decode('aW1wb3J0IGRhdGV0aW1lCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IG9zCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIExpc3QsIE9wdGlvbmFsCmZyb20gam9icy5qb2JfYmFzZSBpbXBvcnQgQmFzZUpvYgoKY2xhc3MgSW5zdGFncmFtSm9iKEJhc2VKb2IpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZSkKICAgICAgICBzZWxmLmFwcF9wYWNrYWdlID0gImNvbS5pbnN0YWdyYW0uYW5kcm9pZCIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gImluc3RhZ3JhbSIKICAgICAgICAKICAgICAgICAjIE92ZXJyaWRlIGRlZmF1bHQgY29uZmlnIGNobyBJbnN0YWdyYW0KICAgICAgICBzZWxmLl9kZWZhdWx0X2NvbmZpZy51cGRhdGUoewogICAgICAgICAgICAiYWN0aW9uX3dlaWdodHMiOiB7CiAgICAgICAgICAgICAgICAibmV3c2ZlZWQiOiAxOCwgICAgICAjIDE4JSB2deG7kXQgZmVlZCAoY2FvIGjGoW4gdsOsIEluc3RhZ3JhbSBjw7Mgbmhp4buBdSBwb3N0cykKICAgICAgICAgICAgICAgICJyZWVscyI6IDIyLCAgICAgICAgICMgMjIlIHhlbSByZWVscwogICAgICAgICAgICAgICAgIm5vdGlmaWNhdGlvbiI6IDEwLCAgICMgMTAlIHhlbSB0aMO0bmcgYsOhbwogICAgICAgICAgICAgICAgInByb2ZpbGUiOiAxNSwgICAgICAgIyAxNSUgeGVtIHByb2ZpbGUgIAogICAgICAgICAgICAgICAgImpvYiI6IDIwLCAgICAgICAgICAgIyAyMCUgbMOgbSBqb2IgKGdp4buvIG5ndXnDqm4pCiAgICAgICAgICAgICAgICAiZXhwbG9yZSI6IDgsICAgICAgICAjIDglIGtow6FtIHBow6EgKHRo4bqlcCBoxqFuIFRpa1RvaykKICAgICAgICAgICAgICAgICJwb3N0IjogNSwgICAgICAgICAgICMgNSUgxJHEg25nIGLDoGkgKMOtdCBkw7luZyB0cm9uZyBJbnN0YWdyYW0pCiAgICAgICAgICAgICAgICAic3RvcnkiOiA1ICAgICAgICAgICAjIDUlIHhlbSBzdG9yaWVzIChhY3Rpb24gcmnDqm5nIGPhu6dhIEluc3RhZ3JhbSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm1heF9hY3Rpb25zX3Blcl9zZXNzaW9uIjogMjUsICAjIEluc3RhZ3JhbSDDrXQgYWN0aW9ucyBoxqFuIFRpa1RvayB2w6AgWW91VHViZSAoMjUpCiAgICAgICAgICAgICJkZWxheV9wb3N0X3ZpZGVvX21pbnV0ZSI6IDE0NDAsICAjIFRo4budaSBnaWFuIGNo4budIGdp4buvYSBjw6FjIGzhuqduIMSRxINuZyDhuqNuaCAocGjDunQpIC0gbeG6t2MgxJHhu4tuaCAyNCBnaeG7nQogICAgICAgIH0pCiAgICAKICAgIGRlZiBnZXRfc3VwcG9ydGVkX2FjdGlvbnMoc2VsZikgLT4gTGlzdFtzdHJdOgogICAgICAgICIiIgogICAgICAgIE92ZXJyaWRlIGRhbmggc8OhY2ggYWN0aW9ucyDEkcaw4bujYyBJbnN0YWdyYW0gaOG7lyB0cuG7owogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3Rbc3RyXTogRGFuaCBzw6FjaCBhY3Rpb25zIEluc3RhZ3JhbSBo4buXIHRy4bujCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGxpc3Qoc2VsZi5nZXRfYWN0aW9uX3dlaWdodHMoKS5rZXlzKCkpCiAgICAgICAgCiAgICBkZWYgZHVtcF9zY3JlZW5fd2l0aF9yZXRyeShzZWxmLCBtYXhfcmV0cmllcz0zLCB3YWl0X2JldHdlZW5fcmV0cmllcz0wLjUpOgogICAgICAgICIiIgogICAgICAgIER1bXAgbcOgbiBow6xuaCBYTUwgduG7m2kgY8ahIGNo4bq/IHRo4butIGzhuqFpIG7hur91IGfhurdwIGzhu5dpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbWF4X3JldHJpZXM6IFPhu5EgbOG6p24gdGjhu60gdOG7kWkgxJFhCiAgICAgICAgICAgIHdhaXRfYmV0d2Vlbl9yZXRyaWVzOiBUaOG7nWkgZ2lhbiBjaOG7nSBnaeG7r2EgY8OhYyBs4bqnbiB0aOG7rSAoZ2nDonkpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogWE1MIGPhu6dhIG3DoG4gaMOsbmggaG/hurdjIE5vbmUgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UobWF4X3JldHJpZXMpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIMSQ4bujaSBVSSDhu5VuIMSR4buLbmgKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YWl0X2JldHdlZW5fcmV0cmllcykKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgcmV0dXJuIHNjcmVlbl94bWwKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBkdW1wIFhNTCAobOG6p24ge2F0dGVtcHQrMX0ve21heF9yZXRyaWVzfSk6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gY2hvIGzhuqduIHRo4butIHRp4bq/cCB0aGVvCiAgICAgICAgICAgICAgICB3YWl0X2JldHdlZW5fcmV0cmllcyArPSAwLjUKICAgICAgICAgICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGR1bXAgWE1MIHNhdSB7bWF4X3JldHJpZXN9IGzhuqduIHRo4butIikKICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIAogICAgZGVmIGlzX2hvbWVfc2NyZWVuKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIMSRYW5nIOG7nyBtw6BuIGjDrG5oIHRyYW5nIGNo4bunIEluc3RhZ3JhbSBoYXkga2jDtG5nCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkWFuZyDhu58gdHJhbmcgY2jhu6csIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHBhY2thZ2UgaGnhu4duIHThuqFpIHRyxrDhu5tjIHRpw6puCiAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICBpZiBjdXJyZW50X3BhY2thZ2UgIT0gc2VsZi5hcHBfcGFja2FnZToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIDE6IEPDsyBuw7p0ICJUcmFuZyBjaOG7pyIgxJHGsOG7o2MgY2jhu41uIChzZWxlY3RlZD10cnVlKSB0cm9uZyB0aGFuaCB0YWIga2jDtG5nCiAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudChjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIiwgdGltZW91dD0yMCkKICAgICAgICAgICAgaWYgaG9tZV90YWI6CiAgICAgICAgICAgICAgICAjIEzhuqV5IFhNTCBtw6BuIGjDrG5oIGhp4buHbiB04bqhaSB24bubaSBjxqEgY2jhur8gdGjhu60gbOG6oWkKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICBpZiBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGhvbWVfdGFiKToKICAgICAgICAgICAgICAgICAgICBsb2dvX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3RpdGxlX2xvZ29fY2hldnJvbl9jb250YWluZXIiCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICBpZiBsb2dvX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG9nb19idXR0b24uZ2V0KCJ2aXNpYmxlLXRvLXVzZXIiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgdMOsbSB0aOG6pXkgdGFiICJUcmFuZyBjaOG7pyIgbmjGsG5nIGNoxrBhIMSRxrDhu6NjIGNo4buNbiwgY2xpY2sgdsOgbyDEkcOzCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfdGFiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMS41cwogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgdMOsbSB0aOG6pXkgdGFiICJUcmFuZyBjaOG7pyIgbmjGsG5nIGNoxrBhIMSRxrDhu6NjIGNo4buNbiwgY2xpY2sgdsOgbyDEkcOzCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfdGFiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMS41cwogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICMgS2jDtG5nIHTDrG0gdGjhuqV5IGPDoWMgeeG6v3UgdOG7kSBj4bunYSB0cmFuZyBjaOG7pwogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraeG7g20gdHJhIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgSW5zdGFncmFtIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIGVuc3VyZV9ob21lX3NjcmVlbihzZWxmLCBtYXhfcmV0cmllczogaW50ID0gMykgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28gxJFhbmcg4bufIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgSW5zdGFncmFtLCBu4bq/dSBraMO0bmcgdGjDrCBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtYXhfcmV0cmllczogU+G7kSBs4bqnbiB0aOG7rSB04buRaSDEkWEKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICIiIgoKCiAgICAgICAgcmV0cnlfY291bnQgPSAwCiAgICAgICAgCiAgICAgICAgd2hpbGUgcmV0cnlfY291bnQgPCBtYXhfcmV0cmllczoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcg4bufIHRyYW5nIGNo4bunIGtow7RuZwogICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIOG7nyB0cmFuZyBjaOG7pywgxJHDs25nIHbDoCBt4bufIGzhuqFpIGFwcAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgcGjhuqNpIHRyYW5nIGNo4bunIEluc3RhZ3JhbSwga2jhu59pIMSR4buZbmcgbOG6oWkgYXBwLi4uIikKICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKHNlbGYuYXBwX3BhY2thZ2UpCgogICAgICAgICAgICAjIEtp4buDbSB0cmEgc2FmZV9zbGVlcCByZXR1cm4gdmFsdWUgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbSBraGkgY+G6p24gcmVzdGFydCBzZXNzaW9uCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoMik6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJOaOG6rW4gxJHGsOG7o2MgecOqdSBj4bqndSBk4burbmcgdHJvbmcgcXXDoSB0csOsbmggZW5zdXJlX2hvbWVfc2NyZWVuIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgc2FmZV9zbGVlcCByZXR1cm4gdmFsdWUgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbSBraGkgY+G6p24gcmVzdGFydCBzZXNzaW9uICAKICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgxMCk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJOaOG6rW4gxJHGsOG7o2MgecOqdSBj4bqndSBk4burbmcgdHJvbmcgcXXDoSB0csOsbmggZW5zdXJlX2hvbWVfc2NyZWVuIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbGlmIG5vdCBzZWxmLnZhbGlkYXRlX2FwcF9ub3RfYmFubmVkKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgcmV0cnlfY291bnQgKz0gMQogICAgICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBt4bufIHRyYW5nIGNo4bunIEluc3RhZ3JhbSBzYXUge21heF9yZXRyaWVzfSBs4bqnbiB0aOG7rSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB2YWxpZGF0ZV9hcHBfbm90X2Jhbm5lZChzZWxmKToKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28ga2jDtG5nIGPDsyB0w6BpIGtob+G6o24gbsOgbyBi4buLIGJhbm5lZAogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIHRleHQgIlRyYW5nIG7DoHkgaGnhu4duIGtow7RuZyBoaeG7g24gdGjhu4siCiAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcGFnZV9ub3RfYXZhaWxhYmxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgdGV4dD0iVHJhbmcgbsOgeSBoaeG7h24ga2jDtG5nIGhp4buDbiB0aOG7iyIKICAgICAgICApCgogICAgICAgIGlmIHBhZ2Vfbm90X2F2YWlsYWJsZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiUGjDoXQgaGnhu4duIHRyYW5nIGtow7RuZyBoaeG7g24gdGjhu4ssIMSRYW5nIHJlc2V0IHByb3h5IHbDoCBsw6BtIG3hu5tpIikKICAgICAgICAgICAgIyBH4buNaSByZXNldF9jdXJyZW50X3Byb3h5IHRow7RuZyBxdWEgcHJveHlfc2VydmljZQogICAgICAgICAgICBpZiBzZWxmLnByb3h5X3NlcnZpY2U6CiAgICAgICAgICAgICAgICByZXNldF9zdWNjZXNzID0gc2VsZi5wcm94eV9zZXJ2aWNlLmZvcmNlX3Jlc2V0X2N1cnJlbnRfaXAoKQogICAgICAgICAgICAgICAgaWYgcmVzZXRfc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgc2FmZV9zbGVlcCByZXR1cm4gdmFsdWUgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoMik6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyB2YWxpZGF0ZV9hcHBfbm90X2Jhbm5lZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgYuG6pW0gdsOgbyBuw7p0ICJMw6BtIG3hu5tpIgogICAgICAgICAgICAgICAgICAgIHJlZnJlc2hfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dD0iTMOgbSBt4bubaSIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcmVmcmVzaF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihyZWZyZXNoX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHNhZmVfc2xlZXAgcmV0dXJuIHZhbHVlIMSR4buDIGPDsyB0aOG7gyB0aG/DoXQgc+G7m20KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgzKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyB2YWxpZGF0ZV9hcHBfbm90X2Jhbm5lZCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBi4bqlbSBuw7p0IGzDoG0gbeG7m2kgc2F1IGtoaSByZXNldCBwcm94eSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgJ0zDoG0gbeG7m2knIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIlJlc2V0IHByb3h5IHRo4bqldCBi4bqhaSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJQcm94eSBzZXJ2aWNlIGNoxrBhIMSRxrDhu6NjIHRoaeG6v3QgbOG6rXAiKQoKICAgICAgICAjIEtp4buDbSB0cmEgZGlhbG9nIGPhuqNuaCBiw6FvCiAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgYWxlcnRfY29udGFpbmVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9pZ2RzX2FsZXJ0X2RpYWxvZ190ZXh0X2NvbnRhaW5lciIKICAgICAgICApCiAgICAgICAgCiAgICAgICAgI0tp4buDbSB0cmEgY8OzIHRow7RuZyBiw6FvIHRo4bupIGzhuqFpIHNhdS4KICAgICAgICBpZiBhbGVydF9jb250YWluZXI6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0acOqdSDEkeG7gSBkaWFsb2cKICAgICAgICAgICAgaGVhZGxpbmUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvaWdkc19hbGVydF9kaWFsb2dfaGVhZGxpbmUiCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGhlYWRsaW5lIGFuZCBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KGhlYWRsaW5lKSA9PSAiVGjhu60gbOG6oWkgc2F1IjoKICAgICAgICAgICAgICAgICMgTOG6pXkgbuG7mWkgZHVuZyBj4bqjbmggYsOhbwogICAgICAgICAgICAgICAgc3VidGV4dCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2lnZHNfYWxlcnRfZGlhbG9nX3N1YnRleHQiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHN1YnRleHQ6CiAgICAgICAgICAgICAgICAgICAgd2FybmluZ19tZXNzYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dChzdWJ0ZXh0KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCBj4bqjbmggYsOhbyBoaeG7h24gdOG6oWkgdOG7qyBkYgogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfd2FybmluZ3MgPSBzZWxmLmRiLmdldCgibG9ncy13YXJuaW5nLW1lc3NhZ2UiLCBbXSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRow6ptIGPhuqNuaCBiw6FvIG3hu5tpCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF93YXJuaW5ncy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAidGltZSI6IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLmlzb2Zvcm1hdCgpLAogICAgICAgICAgICAgICAgICAgICAgICAibWVzcyI6IHdhcm5pbmdfbWVzc2FnZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBDaOG7iSBnaeG7ryBs4bqhaSB04buRaSDEkWEgMjAgbG9nIGfhuqduIG5o4bqldAogICAgICAgICAgICAgICAgICAgIGlmIGxlbihjdXJyZW50X3dhcm5pbmdzKSA+IDIwOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dhcm5pbmdzID0gY3VycmVudF93YXJuaW5nc1stMjA6XQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTMawdSBs4bqhaSB2w6BvIGRiCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImxvZ3Mtd2FybmluZy1tZXNzYWdlIiwgY3VycmVudF93YXJuaW5ncykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYixJDDoyBsxrB1IGPhuqNuaCBiw6FvOiB7d2FybmluZ19tZXNzYWdlfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBC4bqlbSBuw7p0IE9LIGxpw6puIHThu6VjIGNobyDEkeG6v24ga2hpIGtow7RuZyBjw7JuIGRpYWxvZwogICAgICAgICAgICAgICAgICAgIHNlbGYuX2Rpc21pc3NfYWxsX2RpYWxvZ3MoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgIAogICAgICAgICNLaeG7g20gdHJhIHhlbSBjw7MgdGjDtG5nIGLDoW8gcGjhuqNpIMSRxINuZyBuaOG6rXAga2jDtG5nCiAgICAgICAgIyBLaeG7g20gdHJhIGNvbnRhaW5lciBibG9rcwogICAgICAgIGJsb2tzX2NvbnRhaW5lciA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYmxva3NfY29udGFpbmVyIgogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiBibG9rc19jb250YWluZXI6CiAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIGPDoWMgdmlldyB0cm9uZyBjb250YWluZXIKICAgICAgICAgICAgdmlld3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXciCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdmlldyDEkeG6p3UgdGnDqm4gY8OzIHRleHQga2jDoWMgbnVsbAogICAgICAgICAgICB3YXJuaW5nX3RleHQgPSBOb25lCiAgICAgICAgICAgIGZvciB2aWV3IGluIHZpZXdzOgogICAgICAgICAgICAgICAgdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodmlldykKICAgICAgICAgICAgICAgIGlmIHRleHQgYW5kIHRleHQuc3RyaXAoKSBhbmQgdGV4dCAhPSAibnVsbCIgYW5kIHRleHQgIT0gIiAiIGFuZCBsZW4odGV4dC5zdHJpcCgpKSA+IDEwOgogICAgICAgICAgICAgICAgICAgIHdhcm5pbmdfdGV4dCA9IHRleHQKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgd2FybmluZ190ZXh0OiAKICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBsb2dvdXQgdsOgIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgQsaw4bubYyAxOiBC4bqlbSB2w6BvIG1lbnUKICAgICAgICAgICAgICAgICAgICBtZW51X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJNZW51IikKICAgICAgICAgICAgICAgICAgICBpZiBtZW51X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG1lbnVfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQsaw4bubYyAyOiDEkOG7jWMgbOG6oWkgWE1MIHbDoCB0w6xtIHRleHQgIsSQxINuZyB4deG6pXQga2jhu49pIgogICAgICAgICAgICAgICAgICAgICAgICBtZW51X3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1lbnVfeG1sOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwobWVudV94bWwsIGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nb3V0X3ZpZXcgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHZpZXcgaW4gdmlld3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld190ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh2aWV3KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHZpZXdfdGV4dCBhbmQgdmlld190ZXh0LnN0YXJ0c3dpdGgoIsSQxINuZyB4deG6pXQga2jhu49pIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ291dF92aWV3ID0gdmlldwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq90IGLhu48gIsSQxINuZyB4deG6pXQga2jhu49pIiB2w6AgdHJpbSDEkeG7gyBs4bqleSB1c2VybmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHZpZXdfdGV4dC5yZXBsYWNlKCLEkMSDbmcgeHXhuqV0IGto4buPaSIsICIiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxvZ291dF92aWV3IGFuZCB1c2VybmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIELGsOG7m2MgMzogQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgYWNjb3VudCB0cm9uZyBkYXRhYmFzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlZC8lbS8leSAlSDolTSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5hY3RpdmVfcmVhc29uID0gZiJQaMOhdCBoaeG7h24gecOqdSBj4bqndSB4w6FjIG1pbmggbMO6Yzoge2N1cnJlbnRfdGltZX0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHTDoGkga2hv4bqjbiB0aGVvIHVuaXF1ZV91c2VybmFtZSB2w6AgY+G6rXAgbmjhuq10CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9Imluc3RhZ3JhbSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gYWNjb3VudHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKSA9PSB1c2VybmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAibG9nb3V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogaW5hY3RpdmVfcmVhc29uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYixJDDoyBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfToge2luYWN0aXZlX3JlYXNvbn0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIELGsOG7m2MgNDogQuG6pW0gdsOgbyAixJDEg25nIHh14bqldCBraOG7j2kiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGxvZ291dF92aWV3KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQsaw4bubYyA1OiBYw6FjIG5o4bqtbiDEkcSDbmcgeHXhuqV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybV94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvbmZpcm1feG1sOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtX3htbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ9IsSQxINuZyB4deG6pXQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29uZmlybV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoY29uZmlybV9idXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDUpICAjIENo4budIDUgZ2nDonkgaG/DoG4gdOG6pXQgbG9nb3V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgxJHEg25nIHh14bqldCBraOG7j2kgdMOgaSBraG/huqNuIHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbWVudSDEkcSDbmcgeHXhuqV0IikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgxJHhu41jIFhNTCBtZW51IikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgTWVudSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gbG9nb3V0OiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAgICAgIyBGYWxsYmFjazogxJHDs25nIGFwcCBu4bq/dSBraMO0bmcgbG9nb3V0IMSRxrDhu6NjCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKHNlbGYuYXBwX3BhY2thZ2UpCgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgcmV0dXJuIFRydWUKICAgIAogICAgZGVmIF9oYW5kbGVfZGlhbG9nc19hbmRfbmF2aWdhdGVfaG9tZShzZWxmKToKICAgICAgICAiIiIKICAgICAgICBPdmVycmlkZSDEkeG7gyB44butIGzDvSBkaWFsb2cgc3BlY2lmaWMgY+G7p2EgSW5zdGFncmFtIHbDoCBuYXZpZ2F0ZSB24buBIGhvbWUKICAgICAgICAiIiIKICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygixJBhbmcgeOG7rSBsw70gSW5zdGFncmFtIGRpYWxvZ3MgdsOgIG5hdmlnYXRlIHbhu4EgaG9tZS4uLiIpCiAgICAgICAgCiAgICAgICAgIyBY4butIGzDvSBjw6FjIGRpYWxvZyBJbnN0YWdyYW0gc3BlY2lmaWMKICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgZGlhbG9nICJUaOG7rSBs4bqhaSBzYXUiCiAgICAgICAgYWxlcnRfY29udGFpbmVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9pZ2RzX2FsZXJ0X2RpYWxvZ190ZXh0X2NvbnRhaW5lciIKICAgICAgICApCiAgICAgICAgCiAgICAgICAgaWYgYWxlcnRfY29udGFpbmVyOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOzbmcgZGlhbG9nIEluc3RhZ3JhbSBhbGVydCIpCiAgICAgICAgICAgIHNlbGYuX2Rpc21pc3NfYWxsX2RpYWxvZ3MoKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgY29udGFpbmVyIGJsb2tzIChj4bqjbmggYsOhbyBraMOhYykKICAgICAgICBibG9rc19jb250YWluZXIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2Jsb2tzX2NvbnRhaW5lciIKICAgICAgICApCiAgICAgICAgCiAgICAgICAgaWYgYmxva3NfY29udGFpbmVyOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOzbmcgSW5zdGFncmFtIGJsb2tzIGRpYWxvZyIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAKICAgICAgICAjIFNhdSBraGkgeOG7rSBsw70gZGlhbG9nLCB0aOG7rSBuYXZpZ2F0ZSB24buBIGhvbWUKICAgICAgICBpZiBub3Qgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAjIFTDrG0gbsO6dCAiVHJhbmcgY2jhu6ciCiAgICAgICAgICAgIGhvbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaG9tZV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4bqlbSBuw7p0IFRyYW5nIGNo4bunIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihob21lX2J1dHRvbikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBGYWxsYmFjazogbmjhuqVuIGJhY2sgbeG7mXQgdsOgaSBs4bqnbgogICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UoMyk6CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgCiAgICBkZWYgZ2V0X2FjY291bnRzX2Zyb21fZGV2aWNlKHNlbGYpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIkzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIEluc3RhZ3JhbSB04burIHRoaeG6v3QgYuG7iyIiIgogICAgICAgIGFjY291bnRzID0gW10KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pyBJbnN0YWdyYW0KICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE5o4bqlbiB2w6BvIHRhYiAiVHJhbmcgY8OhIG5ow6JuIgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgcHJvZmlsZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBwcm9maWxlX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFRyYW5nIGPDoSBuaMOibiIpCiAgICAgICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE5o4bqlcCB2w6BvIHRhYiBUcmFuZyBjw6EgbmjDom4KICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2ZpbGVfdGFiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24gaGnhu4duIHThuqFpIHThu6sgdHJhbmcgY8OhIG5ow6JuCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHVzZXJuYW1lIHThu6sgdGnDqnUgxJHhu4EgbOG7m24gdHJvbmcgYWN0aW9uIGJhcgogICAgICAgICAgICB1c2VybmFtZV90aXRsZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9sYXJnZV90aXRsZV9hdXRvX3NpemUiCiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX3RpdGxlOgogICAgICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX3RpdGxlIgogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9sYXJnZV90aXRsZV9hdXRvX3NpemUiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIGN1cnJlbnRfdXNlcm5hbWUgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHVzZXJuYW1lX3RpdGxlKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHVzZXJuYW1lIGhp4buHbiB04bqhaSB04burIHRpw6p1IMSR4buBOiB7Y3VycmVudF91c2VybmFtZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5o4bqlcCB2w6BvIHRpw6p1IMSR4buBIHVzZXJuYW1lIMSR4buDIG3hu58gZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih1c2VybmFtZV90aXRsZSkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIC0gxJHhu41jIGzhuqduIDEKICAgICAgICAgICAgICAgIGFjY291bnRzX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIGPDoWMgcGjhuqduIHThu60gVmlld0dyb3VwIGPDsyBjb250ZW50LWRlc2MgKGzDoCB1c2VybmFtZSkKICAgICAgICAgICAgICAgIGFjY291bnRfaXRlbXMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudHNfeG1sLAogICAgICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3R3JvdXAiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gdMOgaSBraG/huqNuIGzhuqduIDEKICAgICAgICAgICAgICAgIHNlbGYuX3Byb2Nlc3NfYWNjb3VudF9pdGVtcyhhY2NvdW50X2l0ZW1zLCBhY2NvdW50c194bWwsIGFjY291bnRzKQoKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIG5oaeG7gXUgaMahbiA2IHTDoGkga2hv4bqjbiwgdnXhu5F0IGzDqm4gdsOgIMSR4buNYyB0aeG6v3AKICAgICAgICAgICAgICAgIGlmIGxlbihhY2NvdW50cykgPiA2OgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB7bGVuKGFjY291bnRzKX0gdMOgaSBraG/huqNuLCB2deG7kXQgbMOqbiDEkeG7gyB0w6xtIHRow6ptIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBs4bqnbiAyIHNhdSBraGkgdnXhu5F0CiAgICAgICAgICAgICAgICAgICAgYWNjb3VudHNfeG1sXzIgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgICAgIGFjY291bnRfaXRlbXNfMiA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudHNfeG1sXzIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3R3JvdXAiCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgWOG7rSBsw70gdMOgaSBraG/huqNuIGzhuqduIDIKICAgICAgICAgICAgICAgICAgICBhY2NvdW50c19iZWZvcmVfMm5kID0gbGVuKGFjY291bnRzKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3Byb2Nlc3NfYWNjb3VudF9pdGVtcyhhY2NvdW50X2l0ZW1zXzIsIGFjY291bnRzX3htbF8yLCBhY2NvdW50cykKICAgICAgICAgICAgICAgICAgICBhY2NvdW50c19hZGRlZCA9IGxlbihhY2NvdW50cykgLSBhY2NvdW50c19iZWZvcmVfMm5kCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkzhuqduIMSR4buNYyB0aOG7qSAyIHTDrG0gdGjDqm0ge2FjY291bnRzX2FkZGVkfSB0w6BpIGtob+G6o24iKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQ2jhu4kgY8OzIHtsZW4oYWNjb3VudHMpfSB0w6BpIGtob+G6o24sIGtow7RuZyBj4bqnbiB2deG7kXQgdGjDqm0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5o4bqlbiBiYWNrIMSR4buDIMSRw7NuZyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUXVheSBs4bqhaSB0cmFuZyBjaOG7pyBi4bqxbmcgcGjGsMahbmcgdGjhu6ljIGJhY2tfdG9faG9tZQogICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIEluc3RhZ3JhbSIpCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhY2NvdW50cwogICAgCiAgICBkZWYgX3Byb2Nlc3NfYWNjb3VudF9pdGVtcyhzZWxmLCBhY2NvdW50X2l0ZW1zOiBMaXN0LCBhY2NvdW50c194bWw6IHN0ciwgYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IGRhbmggc8OhY2ggYWNjb3VudCBpdGVtcyB2w6AgdGjDqm0gdsOgbyBhY2NvdW50cyBsaXN0CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudF9pdGVtczogRGFuaCBzw6FjaCBWaWV3R3JvdXAgZWxlbWVudHMKICAgICAgICAgICAgYWNjb3VudHNfeG1sOiBYTUwgY+G7p2EgbcOgbiBow6xuaCBjaOG7qWEgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAgICAgYWNjb3VudHM6IExpc3QgxJHhu4MgdGjDqm0gdMOgaSBraG/huqNuIHbDoG8KICAgICAgICAiIiIKICAgICAgICAjIFThuqFvIHNldCDEkeG7gyB0csOhbmggZHVwbGljYXRlIHVzZXJuYW1lCiAgICAgICAgZXhpc3RpbmdfdXNlcm5hbWVzID0ge2FjYy5nZXQoInVuaXF1ZV91c2VybmFtZSIsICIiKS5sb3dlcigpIGZvciBhY2MgaW4gYWNjb3VudHN9CiAgICAgICAgCiAgICAgICAgIyBM4buNYyB2w6AgeOG7rSBsw70gY8OhYyBt4bulYyB0w6BpIGtob+G6o24KICAgICAgICBmb3IgaXRlbSBpbiBhY2NvdW50X2l0ZW1zOgogICAgICAgICAgICAjIEzhuqV5IGNvbnRlbnQtZGVzYyBj4bunYSBpdGVtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYyA9IGl0ZW0uZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgICAgICAgICAgaWYgbm90IGNvbnRlbnRfZGVzYyBvciBjb250ZW50X2Rlc2MgPT0gIm51bGwiOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6J5IGPDsyBwaOG6o2kgbMOgIG7DunQgIsSQaSDEkeG6v24gVHJ1bmcgdMOibSB0w6BpIGtob+G6o24iIGtow7RuZwogICAgICAgICAgICBpZiAiVHJ1bmcgdMOibSB0w6BpIGtob+G6o24iIGluIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBC4buPIHF1YSBuw7p0ICJUaMOqbSB0w6BpIGtob+G6o24iIAogICAgICAgICAgICBpZiAiVGjDqm0gdMOgaSBraG/huqNuIiBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBY4butIGzDvSB0csaw4budbmcgaOG7o3AgY8OzIHRow7RuZyBiw6FvIHRyb25nIGNvbnRlbnQtZGVzYyAodmQ6ICJ1c2VybmFtZSwgMTAgdGjDtG5nIGLDoW8iKQogICAgICAgICAgICB1c2VybmFtZSA9IGNvbnRlbnRfZGVzYwogICAgICAgICAgICBpZiAiLCIgaW4gY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBjb250ZW50X2Rlc2Muc3BsaXQoIiwiKVswXS5zdHJpcCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFBoxrDGoW5nIHBow6FwIDI6IFTDrG0gdHLhu7FjIHRp4bq/cCB0cm9uZyBjw6FjIHZpZXcgY29uCiAgICAgICAgICAgIGNoaWxkX3ZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgYWNjb3VudHNfeG1sLAogICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXciCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgYm91bmRzIGPhu6dhIGl0ZW0gaGnhu4duIHThuqFpIMSR4buDIHTDrG0gdmlldyBjb24gdGh14buZYyB24buBIG7DswogICAgICAgICAgICBpdGVtX2JvdW5kcyA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X2JvdW5kcyhpdGVtKQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIHZpZXcgaW4gY2hpbGRfdmlld3M6CiAgICAgICAgICAgICAgICB2aWV3X2JvdW5kcyA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X2JvdW5kcyh2aWV3KQogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSB2aWV3IGPDsyBu4bqxbSB0cm9uZyBpdGVtIGtow7RuZwogICAgICAgICAgICAgICAgaWYgKHZpZXdfYm91bmRzWzBdID49IGl0ZW1fYm91bmRzWzBdIGFuZCAKICAgICAgICAgICAgICAgICAgICB2aWV3X2JvdW5kc1sxXSA+PSBpdGVtX2JvdW5kc1sxXSBhbmQgCiAgICAgICAgICAgICAgICAgICAgdmlld19ib3VuZHNbMl0gPD0gaXRlbV9ib3VuZHNbMl0gYW5kIAogICAgICAgICAgICAgICAgICAgIHZpZXdfYm91bmRzWzNdIDw9IGl0ZW1fYm91bmRzWzNdKToKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB2aWV3X3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHZpZXcpCiAgICAgICAgICAgICAgICAgICAgaWYgdmlld190ZXh0IGFuZCAidGjDtG5nIGLDoW8iIG5vdCBpbiB2aWV3X3RleHQubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHRo4bqleSB2aWV3IGNvbiBjaOG7qWEgdMOqbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgPSB2aWV3X3RleHQKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBkdXBsaWNhdGUgdXNlcm5hbWUKICAgICAgICAgICAgaWYgdXNlcm5hbWUubG93ZXIoKSBpbiBleGlzdGluZ191c2VybmFtZXM6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIG7DoHkgY8OzIMSRYW5nIMSRxrDhu6NjIGNo4buNbiBraMO0bmcKICAgICAgICAgICAgaXNfc2VsZWN0ZWQgPSBpdGVtLmdldCgic2VsZWN0ZWQiKSA9PSAidHJ1ZSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6oW8gdGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgYWNjb3VudCA9IHsKICAgICAgICAgICAgICAgICJuaWNrbmFtZSI6ICIiLAogICAgICAgICAgICAgICAgInVuaXF1ZV91c2VybmFtZSI6IHVzZXJuYW1lLAogICAgICAgICAgICAgICAgInVuaXF1ZV9pZCI6ICIiLAogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJhY3RpdmUiLAogICAgICAgICAgICAgICAgImlzX2xvZ2luIjogaXNfc2VsZWN0ZWQsCiAgICAgICAgICAgICAgICAiYXZhdGFyX3RodW1iIjogIiIsCiAgICAgICAgICAgICAgICAiam9iX2VuYWJsZSI6IFRydWUsCiAgICAgICAgICAgICAgICAibGV2ZWwiOiAzLAogICAgICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhY2NvdW50cy5hcHBlbmQoYWNjb3VudCkKICAgICAgICAgICAgZXhpc3RpbmdfdXNlcm5hbWVzLmFkZCh1c2VybmFtZS5sb3dlcigpKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gSW5zdGFncmFtOiB7dXNlcm5hbWV9IChzZWxlY3RlZDoge2lzX3NlbGVjdGVkfSkiKQogICAgCiAgICBkZWYgX2Rpc21pc3NfYWxsX2RpYWxvZ3Moc2VsZiwgbWF4X2F0dGVtcHRzOiBpbnQgPSA1KSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIELhuqVtIG7DunQgT0sgbGnDqm4gdOG7pWMgY2hvIMSR4bq/biBraGkga2jDtG5nIGPDsm4gZGlhbG9nIG7DoG8KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtYXhfYXR0ZW1wdHM6IFPhu5EgbOG6p24gdGjhu60gdOG7kWkgxJFhCiAgICAgICAgIiIiCiAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UobWF4X2F0dGVtcHRzKToKICAgICAgICAgICAgIyBM4bqleSBs4bqhaSBYTUwgxJHhu4MgdMOsbSBuw7p0IE9LCiAgICAgICAgICAgIGN1cnJlbnRfeG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgaWYgbm90IGN1cnJlbnRfeG1sOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBva19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgY3VycmVudF94bWwsCiAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2lnZHNfYWxlcnRfZGlhbG9nX3ByaW1hcnlfYnV0dG9uIgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBva19idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIob2tfYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBi4bqlbSBPSyBs4bqnbiB7YXR0ZW1wdCArIDF9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgS2jDtG5nIGPDsm4gbsO6dCBPSywgdGhvw6F0IHbDsm5nIGzhurdwCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIMSRw7NuZyBo4bq/dCBkaWFsb2ciKQogICAgICAgICAgICAgICAgYnJlYWsKICAgIAogICAgZGVmIGJhY2tfdG9faG9tZShzZWxmLCBtYXhfYmFja19jb3VudDogaW50ID0gNSwgbWF4X3JldHJpZXM6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUXVheSBs4bqhaSBtw6BuIGjDrG5oIHRyYW5nIGNo4bunIEluc3RhZ3JhbQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1heF9iYWNrX2NvdW50OiBT4buRIGzhuqduIG5o4bqlbiBCYWNrIHThu5FpIMSRYSB0csaw4bubYyBraGkgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgYXBwCiAgICAgICAgICAgIG1heF9yZXRyaWVzOiBT4buRIGzhuqduIHRo4butIGto4bufaSDEkeG7mW5nIGzhuqFpIGFwcCB04buRaSDEkWEKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyDhu58gdHJhbmcgY2jhu6cgY2jGsGEKICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQYW5nIHTDrG0gY8OhY2ggcXVheSB24buBIHRyYW5nIGNo4bunIEluc3RhZ3JhbS4uLiIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7rSBs4bqhaSB0b8OgbiBi4buZIHF1w6EgdHLDrG5oIHThu5FpIMSRYSBtYXhfcmV0cmllcyBs4bqnbgogICAgICAgIGZvciByZXRyeSBpbiByYW5nZShtYXhfcmV0cmllcyk6CiAgICAgICAgICAgICMgVGjhu60gYuG6pW0gbsO6dCBiYWNrIHThu5FpIMSRYSBtYXhfYmFja19jb3VudCBs4bqnbgogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShtYXhfYmFja19jb3VudCk6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHNhZmVfc2xlZXAgcmV0dXJuIHZhbHVlIMSR4buDIGPDsyB0aOG7gyB0aG/DoXQgc+G7m20KICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoMSk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTmjhuq1uIMSRxrDhu6NjIHnDqnUgY+G6p3UgZOG7q25nIHRyb25nIHF1w6EgdHLDrG5oIGJhY2tfdG9faG9tZSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyB24buBIHRyYW5nIGNo4bunIGNoxrBhCiAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgcXVheSB24buBIHRyYW5nIGNo4bunIHNhdSB7aSsxfSBs4bqnbiBi4bqlbSBiYWNrIChs4bqnbiB0aOG7rSB7cmV0cnkrMX0pIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSB24bqrbiBraMO0bmcgduG7gSDEkcaw4bujYyB0cmFuZyBjaOG7pywga2lsbCBhcHAgdsOgIG3hu58gbOG6oWkKICAgICAgICAgICAgaWYgcmV0cnkgPCBtYXhfcmV0cmllcyAtIDE6ICAjIENo4buJIGxvZyBj4bqjbmggYsOhbyBu4bq/dSBjw7JuIGzhuqduIHRo4butIHRp4bq/cCB0aGVvCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHRo4buDIHbhu4EgdHJhbmcgY2jhu6cgc2F1IHttYXhfYmFja19jb3VudH0gbOG6p24gYuG6pW0gYmFjaywgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgYXBwIChs4bqnbiB0aOG7rSB7cmV0cnkrMX0ve21heF9yZXRyaWVzfSkuLi4iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgduG7gSB0cmFuZyBjaOG7pyBzYXUge21heF9iYWNrX2NvdW50fSBs4bqnbiBi4bqlbSBiYWNrIChs4bqnbiB0aOG7rSBjdeG7kWkge3JldHJ5KzF9L3ttYXhfcmV0cmllc30pLi4uIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBzYWZlX3NsZWVwIHJldHVybiB2YWx1ZSDEkeG7gyBjw7MgdGjhu4MgdGhvw6F0IHPhu5ttCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoMik6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJOaOG6rW4gxJHGsOG7o2MgecOqdSBj4bqndSBk4burbmcgdHJvbmcgcXXDoSB0csOsbmggYmFja190b19ob21lIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgc2FmZV9zbGVlcCByZXR1cm4gdmFsdWUgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbSAgCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoNSk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJOaOG6rW4gxJHGsOG7o2MgecOqdSBj4bqndSBk4burbmcgdHJvbmcgcXXDoSB0csOsbmggYmFja190b19ob21lIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgaWYgbm90IHNlbGYudmFsaWRhdGVfYXBwX25vdF9iYW5uZWQoKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHhlbSBjw7Mg4bufIHRyYW5nIGNo4bunIGtow7RuZwogICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cgc2F1IGtoaSBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAgKGzhuqduIHRo4butIHtyZXRyeSsxfSkiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyB24buBIHRyYW5nIGNo4bunIG5nYXkgY+G6oyBzYXUge21heF9yZXRyaWVzfSBs4bqnbiB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAiKQogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICAKCiAgICAKICAgIGRlZiBtYXBfZ29saWtlX2FjY291bnRzKHNlbGYsIGdvbGlrZV9hY2NvdW50czogTGlzdFtEaWN0W3N0ciwgQW55XV0sIGRldmljZV9hY2NvdW50czogTGlzdFtEaWN0W3N0ciwgQW55XV0pIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIMOBbmggeOG6oSB0w6BpIGtob+G6o24gdOG7qyBHb0xpa2UgdsOgbyB0w6BpIGtob+G6o24gdHLDqm4gdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZ29saWtlX2FjY291bnRzOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiB04burIEdvTGlrZSBBUEkKICAgICAgICAgICAgZGV2aWNlX2FjY291bnRzOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiB0csOqbiB0aGnhur90IGLhu4sKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggdMOgaSBraG/huqNuIMSRw6Mgw6FuaCB44bqhCiAgICAgICAgIiIiCiAgICAgICAgbWFwcGVkX2FjY291bnRzID0gW10KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ2h14bqpbiBow7NhIGThu68gbGnhu4d1IHThu6sgR29MaWtlCiAgICAgICAgICAgIGdvbGlrZV9kYXRhID0ge30KICAgICAgICAgICAgZm9yIGFjYyBpbiBnb2xpa2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICAjIFRyw61jaCB4deG6pXQgdGjDtG5nIHRpbiB04burIHTDoGkga2hv4bqjbiBHb0xpa2UKICAgICAgICAgICAgICAgIGdvbGlrZV9hY2NvdW50ID0gewogICAgICAgICAgICAgICAgICAgICJnb2xpa2VfaWQiOiBhY2MuZ2V0KCJpZCIpLAogICAgICAgICAgICAgICAgICAgICJuaWNrbmFtZSI6IGFjYy5nZXQoImluc3RhZ3JhbV9mdWxsX25hbWUiKSBvciBhY2MuZ2V0KCJpbnN0YWdyYW1fdXNlcm5hbWUiKSwKICAgICAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogYWNjLmdldCgiaW5zdGFncmFtX2lkIiksCiAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV91c2VybmFtZSI6IGFjYy5nZXQoImluc3RhZ3JhbV91c2VybmFtZSIpLAogICAgICAgICAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiBhY2MuZ2V0KCJwcm9maWxlX3BpY191cmwiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIHVuaXF1ZV91c2VybmFtZSBsw6BtIGtow7NhIMSR4buDIGThu4Ugw6FuaCB44bqhCiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGdvbGlrZV9hY2NvdW50WyJ1bmlxdWVfdXNlcm5hbWUiXQogICAgICAgICAgICAgICAgaWYgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgZ29saWtlX2RhdGFbdXNlcm5hbWUubG93ZXIoKV0gPSBnb2xpa2VfYWNjb3VudAogICAgICAgICAgICAKICAgICAgICAgICAgIyDDgW5oIHjhuqEgduG7m2kgdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBmb3IgZGV2aWNlX2FjY291bnQgaW4gZGV2aWNlX2FjY291bnRzOgogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBkZXZpY2VfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lIGluIGdvbGlrZV9kYXRhOgogICAgICAgICAgICAgICAgICAgICMgxJDDoyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gdHJvbmcgZGFuaCBzw6FjaCBHb0xpa2UKICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHThu6sgR29MaWtlIHbDoG8gdMOgaSBraG/huqNuIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgICAgIGdvbGlrZV9pbmZvID0gZ29saWtlX2RhdGFbdXNlcm5hbWVdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAiZ29saWtlX2lkIjogZ29saWtlX2luZm9bImdvbGlrZV9pZCJdLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNfZ29saWtlX2xpbmtlZCI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiBnb2xpa2VfaW5mb1siYXZhdGFyX3RodW1iIl0gb3IgZGV2aWNlX2FjY291bnQuZ2V0KCJhdmF0YXJfdGh1bWIiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJ1bmlxdWVfaWQiOiBnb2xpa2VfaW5mb1sidW5pcXVlX2lkIl0gb3IgZGV2aWNlX2FjY291bnQuZ2V0KCJ1bmlxdWVfaWQiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJuaWNrbmFtZSI6IGdvbGlrZV9pbmZvWyJuaWNrbmFtZSJdIG9yIGRldmljZV9hY2NvdW50LmdldCgibmlja25hbWUiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIElEIHTDoGkga2hv4bqjbiB0cm9uZyBEQgogICAgICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBkZXZpY2VfYWNjb3VudC5nZXQoImlkIikKICAgICAgICAgICAgICAgICAgICBpZiBhY2NvdW50X2lkOgogICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB2w6BvIERCCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudF9pZCwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHbDoG8gZGV2aWNlX2FjY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2FjY291bnQudXBkYXRlKHVwZGF0ZV9kYXRhKQogICAgICAgICAgICAgICAgICAgICAgICBtYXBwZWRfYWNjb3VudHMuYXBwZW5kKGRldmljZV9hY2NvdW50KQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6Mgw6FuaCB44bqhIHTDoGkga2hv4bqjbiBJbnN0YWdyYW06IHt1c2VybmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIG1hcHBlZF9hY2NvdW50cwogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSDDoW5oIHjhuqEgdMOgaSBraG/huqNuIEluc3RhZ3JhbSIpCiAgICAgICAgICAgIHJldHVybiBbXQogICAgZGVmIGdldF9yZXBvcnRfcGF5bG9hZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVOG6oW8gcGF5bG9hZCBjaG8gdmnhu4djIGLDoW8gY8OhbyBob8OgbiB0aMOgbmggam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogUGF5bG9hZCBjaG8gQVBJIGLDoW8gY8OhbwogICAgICAgICIiIgogICAgICAgIGdvbGlrZV9pZCA9IGFjY291bnQuZ2V0KCJnb2xpa2VfaWQiKQogICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICAKICAgICAgICBpZiBub3QgZ29saWtlX2lkIG9yIG5vdCBqb2JfaWQ6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJUaGnhur91IHRow7RuZyB0aW4gdMOgaSBraG/huqNuIGhv4bq3YyBqb2IgxJHhu4MgdOG6oW8gcGF5bG9hZCBiw6FvIGPDoW8iKQogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiaW5zdGFncmFtX3VzZXJzX2FkdmVydGlzaW5nX2lkIjogam9iX2lkLAogICAgICAgICAgICAiaW5zdGFncmFtX2FjY291bnRfaWQiOiBnb2xpa2VfaWQsCiAgICAgICAgICAgICJhc3luYyI6IFRydWUsCiAgICAgICAgICAgICJkYXRhIjogTm9uZQogICAgICAgIH0gICAgCiAgICAgICAgICAKICAgIAogICAgCiAgICBkZWYgZXhlY3V0ZV9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgdGjhu7FjIGhp4buHbiBqb2IsIGJhbyBn4buTbToKICAgICAgICAgICAgICAgIC0gc3RhdHVzIChpbnQpOiBNw6MgdHLhuqFuZyB0aMOhaSBqb2IKICAgICAgICAgICAgICAgICAgICAwOiBDaMawYSB0aOG7sWMgaGnhu4duCiAgICAgICAgICAgICAgICAgICAgMTogVGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgMjogVGjhuqV0IGLhuqFpLCBraMO0bmcgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nCiAgICAgICAgICAgICAgICAgICAgMzogVGjhuqV0IGLhuqFpLCDEkcOjIGLhu4sgdW5mb2xsb3cvdW5saWtlCiAgICAgICAgICAgICAgICAgICAgNDogVGjhuqV0IGLhuqFpLCB5w6p1IGPhuqd1IMSRYW5nIGNo4budCiAgICAgICAgICAgICAgICAtIG1lc3NhZ2UgKHN0cik6IFRow7RuZyBiw6FvIGvhur90IHF14bqjCiAgICAgICAgICAgICAgICAtIHN1Y2Nlc3MgKGJvb2wpOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBqb2JfdHlwZSA9IGpvYi5nZXQoInR5cGUiLCAiIikubG93ZXIoKQogICAgICAgICAgICBqb2JfbGluayA9IGpvYi5nZXQoImxpbmsiLCAiIikKICAgICAgICAgICAgam9iX2lkID0gam9iLmdldCgiaWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQYW5nIHRo4buxYyBoaeG7h24gam9iIHtqb2JfaWR9IGxv4bqhaSB7am9iX3R5cGV9IHbhu5tpIGxpbmsge2pvYl9saW5rfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgbG/huqFpIGpvYiDEkcaw4bujYyBo4buXIHRy4bujCiAgICAgICAgICAgIGlmIGpvYl90eXBlIG5vdCBpbiBbImZvbGxvdyIsICJsaWtlIl06CiAgICAgICAgICAgICAgICBtZXNzYWdlID0gZiJMb+G6oWkgam9iIHtqb2JfdHlwZX0ga2jDtG5nIMSRxrDhu6NjIGjhu5cgdHLhu6MiCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAyLAogICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAjIFRo4buxYyBoaeG7h24gam9iIHRoZW8gbG/huqFpCiAgICAgICAgICAgIGpvYl9zdGF0dXMgPSAwICAjIE3hurdjIMSR4buLbmggbMOgIGNoxrBhIGzDoG0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGpvYl90eXBlID09ICJmb2xsb3ciOgogICAgICAgICAgICAgICAgam9iX3N0YXR1cyA9IHNlbGYuX3BlcmZvcm1fZm9sbG93X2pvYihqb2JfbGluaykKICAgICAgICAgICAgZWxpZiBqb2JfdHlwZSA9PSAibGlrZSI6CiAgICAgICAgICAgICAgICBqb2Jfc3RhdHVzID0gc2VsZi5fcGVyZm9ybV9saWtlX2pvYihqb2JfbGluaykKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6oW8ga+G6v3QgcXXhuqMgdHLhuqMgduG7gSBk4buxYSB0csOqbiBqb2Jfc3RhdHVzCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdF9mcm9tX3N0YXR1cyhqb2Jfc3RhdHVzLCBqb2JfdHlwZSkKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbWVzc2FnZSA9IGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gam9iOiB7c3RyKGUpfSIKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCgyLCBtZXNzYWdlLCBGYWxzZSkKICAgIAogICAgZGVmIF9jcmVhdGVfam9iX3Jlc3VsdF9mcm9tX3N0YXR1cyhzZWxmLCBqb2Jfc3RhdHVzOiBpbnQsIGpvYl90eXBlOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFThuqFvIGvhur90IHF14bqjIGpvYiB04burIHN0YXR1cyBjb2RlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgam9iX3N0YXR1czogTcOjIHRy4bqhbmcgdGjDoWkgam9iIHThu6sgX3BlcmZvcm1feHh4X2pvYgogICAgICAgICAgICBqb2JfdHlwZTogTG/huqFpIGpvYiAoZm9sbG93LCBsaWtlKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgam9iCiAgICAgICAgIiIiCiAgICAgICAgaWYgam9iX3N0YXR1cyA9PSAxOiAgIyBUaMOgbmggY8O0bmcKICAgICAgICAgICAgbWVzc2FnZSA9IGYixJDDoyBob8OgbiB0aMOgbmggam9iIHtqb2JfdHlwZX0gdGjDoG5oIGPDtG5nIgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCgxLCBtZXNzYWdlLCBUcnVlKQogICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSAyOiAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nCiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIktow7RuZyB0aOG7gyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcgxJHhu4MgdGjhu7FjIGhp4buHbiBqb2Ige2pvYl90eXBlfSIKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMiwgbWVzc2FnZSwgRmFsc2UpCiAgICAgICAgZWxpZiBqb2Jfc3RhdHVzID09IDM6ICAjIELhu4sgdW5mb2xsb3cvdW5saWtlCiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIsSQw6MgYuG7iyB1bmZvbGxvdy91bmxpa2UgdHJvbmcgam9iIHtqb2JfdHlwZX0iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdW5mb2xsb3cgxJHhu4MgSm9iU2VydmljZSB44butIGzDvQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMywgbWVzc2FnZSwgRmFsc2UsIHVuZm9sbG93PVRydWUpCiAgICAgICAgZWxpZiBqb2Jfc3RhdHVzID09IDQ6ICAjIFnDqnUgY+G6p3UgxJFhbmcgY2jhu50KICAgICAgICAgICAgbWVzc2FnZSA9IGYiWcOqdSBj4bqndSDEkWFuZyBjaOG7nSB0cm9uZyBqb2Ige2pvYl90eXBlfSIKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoNCwgbWVzc2FnZSwgRmFsc2UpCiAgICAgICAgZWxpZiBqb2Jfc3RhdHVzID09IDU6ICAjIEfhu61pIHnDqnUgY+G6p3UgY2jhu50gZHV54buHdAogICAgICAgICAgICBtZXNzYWdlID0gZiJH4butaSB5w6p1IGPhuqd1IGNo4budIGR1eeG7h3Qge2pvYl90eXBlfSIKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoNSwgbWVzc2FnZSwgRmFsc2UpCiAgICAgICAgZWxpZiBqb2Jfc3RhdHVzID09IDY6ICAjIMSQ4bqhdCBnaeG7m2kgaOG6oW4gaG/hurdjIGLhu4sga2jDs2EKICAgICAgICAgICAgbWVzc2FnZSA9IGYiSm9iIHtqb2JfdHlwZX0gYuG7iyBo4buneSBkbyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGhv4bq3YyB0w6BpIGtob+G6o24gYuG7iyBraMOzYSIKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoNiwgbWVzc2FnZSwgRmFsc2UpCiAgICAgICAgZWxzZTogICMgVHLhuqFuZyB0aMOhaSBraMO0bmcgeMOhYyDEkeG7i25oCiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIlRy4bqhbmcgdGjDoWkga2jDtG5nIHjDoWMgxJHhu4tuaCBraGkgdGjhu7FjIGhp4buHbiBqb2Ige2pvYl90eXBlfSAoc3RhdHVzOiB7am9iX3N0YXR1c30pIgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMCwgbWVzc2FnZSwgRmFsc2UpCiAgICAKICAgIGRlZiBfcGVyZm9ybV9mb2xsb3dfam9iKHNlbGYsIHByb2ZpbGVfbGluazogc3RyKSAtPiBpbnQ6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IgZm9sbG93IHRyw6puIEluc3RhZ3JhbQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb2ZpbGVfbGluazogTGluayDEkeG6v24gdHJhbmcgY8OhIG5ow6JuIGPhuqduIGZvbGxvdwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBpbnQ6IFRy4bqhbmcgdGjDoWkgam9iICgwOiBjaMawYSBsw6BtLCAxOiBob8OgbiB0aMOgbmgsIDI6IGzhu5dpLCAzOiBi4buLIHVuZm9sbG93KQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFRyw61jaCB4deG6pXQgdXNlcm5hbWUgdOG7qyBVUkwKICAgICAgICAgICAgaW1wb3J0IHJlCiAgICAgICAgICAgIGltcG9ydCByYW5kb20KICAgICAgICAgICAgdXNlcm5hbWVfbWF0Y2ggPSByZS5zZWFyY2gocidpbnN0YWdyYW1cLmNvbS8oW14vXSspJywgcHJvZmlsZV9saW5rKQogICAgICAgICAgICBpZiBub3QgdXNlcm5hbWVfbWF0Y2g6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyB0csOtY2ggeHXhuqV0IHVzZXJuYW1lIHThu6sgbGluazoge3Byb2ZpbGVfbGlua30iKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB1c2VybmFtZSA9IHVzZXJuYW1lX21hdGNoLmdyb3VwKDEpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJhbmRvbSBjaOG7jW4gMSB0cm9uZyAyIGPDoWNoOiB0w6xtIGtp4bq/bSBob+G6t2MgbeG7nyB0cuG7sWMgdGnhur9wIGxpbmsKICAgICAgICAgICAgaWYgcmFuZG9tLmNob2ljZShbVHJ1ZSwgRmFsc2VdKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJN4bufIHRyYW5nIGPDoSBuaMOibiBi4bqxbmcgY8OhY2ggdMOsbSBraeG6v206IHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgIyBDw6FjaCAxOiBUw6xtIGtp4bq/bSB1c2VybmFtZSAoY8OhY2ggY8WpKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgxJDDs25nIGPDoWMgZGlhbG9nIG7hur91IGPDswogICAgICAgICAgICAgICAgICAgIGRpYWxvZyA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IkRpYWxvZyIpCiAgICAgICAgICAgICAgICAgICAgaWYgZGlhbG9nOgogICAgICAgICAgICAgICAgICAgICAgICAjIFRhcCB2w6BvIGtodSB24buxYyB0cuG7kW5nIMSR4buDIMSRw7NuZyBkaWFsb2cKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGgsIGhlaWdodCA9IHNlbGYuaGVscGVyLmdldF9zY3JlZW5fc2l6ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcChpbnQod2lkdGgqMC4yKSwgaW50KGhlaWdodCowLjIpKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDEuNXMKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE3hu58gdHJhbmcgdMOsbSBraeG6v20gCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oLCB0aOG7rSBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDQpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gNHMKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9zZWFyY2hfdGFiIikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlYXJjaF90YWI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFTDrG0ga2nhur9tLCB0aOG7rSBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDQpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gNHMKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF90YWIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMnMKICAgICAgICAgICAgICAgICAgICBzZWFyY2hfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvc2VhcmNoX3RhYiIpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlYXJjaF90YWIgb3Igbm90IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQoc2VhcmNoX3RhYik6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWFyY2hfdGFiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKSAKCiAgICAgICAgICAgICAgICAgICAgIyBOaOG6pW4gdsOgbyB0aGFuaCB0w6xtIGtp4bq/bQogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGR1bXAgbcOgbiBow6xuaCBraGkgdMOsbSDDtCBuaOG6rXAsIHRo4butIG3hu58gYuG6sW5nIGxpbmsgdHLhu7FjIHRp4bq/cCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoX2lucHV0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfc2VhcmNoX2VkaXRfdGV4dCIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlYXJjaF9pbnB1dDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF90YWIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKSAKICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoX2lucHV0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9zZWFyY2hfZWRpdF90ZXh0IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VhcmNoX2lucHV0OgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IMO0IG5o4bqtcCB0w6xtIGtp4bq/bSwgdGjhu60gbeG7nyBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocHJvZmlsZV9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgWMOzYSBu4buZaSBkdW5nIHTDrG0ga2nhur9tIGhp4buHbiB04bqhaSBu4bq/dSBjw7MKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX2lucHV0KQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBOaOG6rXAgdXNlcm5hbWUgY+G6p24gdMOsbSB24bubaSBrw70gdOG7sSBAIHBow61hIHRyxrDhu5tjCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuaW5wdXRfdGV4dChmInt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg1KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDVzIMSR4buDIGvhur90IHF14bqjIHTDrG0ga2nhur9tIGhp4buHbiDEkeG6p3kgxJHhu6cKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga+G6v3QgcXXhuqMgdGhlbyByZXNvdXJjZS1pZCBj4bulIHRo4buDCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKSAgIyBUaG/DoXQgdMOsbSBraeG6v20KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIGvhur90IHF14bqjIHTDrG0ga2nhur9tLCB0aOG7rSBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDQpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHVzZXJfcmVzdWx0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Jvd19zZWFyY2hfdXNlcl91c2VybmFtZSIpCiAgICAgICAgICAgICAgICAgICAgaWYgdXNlcl9yZXN1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih1c2VyX3Jlc3VsdCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgdGhlbyByZXNvdXJjZS1pZCwgdGjhu60gdMOsbSB0aGVvIGvhur90IHF14bqjIHRow7RuZyB0aMaw4budbmcKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzY3JlZW5feG1sLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5MaW5lYXJMYXlvdXQiKQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRfZm91bmQgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHJlc3VsdCBpbiByZXN1bHRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0X3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHJlc3VsdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lLmxvd2VyKCkgaW4gcmVzdWx0X3RleHQubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocmVzdWx0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdF9mb3VuZCA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVzdWx0X2ZvdW5kOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHt1c2VybmFtZX0gdHJvbmcga+G6v3QgcXXhuqMgdMOsbSBraeG6v20iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB0w6xtIGtp4bq/bSB0w6BpIGtob+G6o246IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGPDsyBs4buXaSwgc+G7rSBk4bulbmcgcGjGsMahbmcgdGjhu6ljIG3hu58gbGluawogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDRzCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEPDoWNoIDI6IE3hu58gdHLhu7FjIHRp4bq/cCBVUkwgdGjDtG5nIHF1YSBoZWxwZXIub3Blbl91cmwoKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIk3hu58gdHJhbmcgY8OhIG5ow6JuIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3A6IHtwcm9maWxlX2xpbmt9IikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDQpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gNHMKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2jhu50gdGjDqm0gY2hvIHRyYW5nIGjhu5Mgc8ahIHThuqNpIHhvbmcKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBuw7p0IEZvbGxvdyB0aGVvIHJlc291cmNlLWlkIGNow61uaCB4w6FjCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIGtoaSB0w6xtIG7DunQgZm9sbG93IikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9wcm9maWxlX2hlYWRlcl9mb2xsb3dfYnV0dG9uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5IHRoZW8gcmVzb3VyY2UtaWQsIHRo4butIHTDrG0gdGhlbyB0ZXh0CiAgICAgICAgICAgIGlmIG5vdCBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgdGhlbyBkw7VpIHRoZW8gcmVzb3VyY2UtaWQsIHRo4butIHTDrG0gdGhlbyB0ZXh0IikKICAgICAgICAgICAgICAgICMgVMOsbSBuw7p0IHRoZW8gdGV4dAogICAgICAgICAgICAgICAgZm9sbG93X3RleHRzID0gWyJUaGVvIGTDtWkiLCAiRm9sbG93IiwgIsSQYW5nIHRoZW8gZMO1aSIsICJGb2xsb3dpbmciLCAixJDDoyB5w6p1IGPhuqd1IiwgIlJlcXVlc3RlZCJdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciB0ZXh0IGluIGZvbGxvd190ZXh0czoKICAgICAgICAgICAgICAgICAgICBmb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICAgICAgaWYgZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu60gbOG6oWkgbOG6p24gbuG7r2EgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgZm9sbG93CiAgICAgICAgICAgIGlmIG5vdCBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgdGhlbyBkw7VpIOG7nyBs4bqnbiDEkeG6p3UsIHRo4butIHZ14buRdCBtw6BuIGjDrG5oIHbDoCB0w6xtIGzhuqFpIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmgga2hpIHTDrG0gbOG6oWkgbsO6dCBmb2xsb3ciKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Byb2ZpbGVfaGVhZGVyX2ZvbGxvd19idXR0b24iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAjIFTDrG0gbsO6dCB0aGVvIHRleHQKICAgICAgICAgICAgICAgICAgICBmb2xsb3dfdGV4dHMgPSBbIlRoZW8gZMO1aSIsICJGb2xsb3ciLCAixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyIsICLEkMOjIHnDqnUgY+G6p3UiLCAiUmVxdWVzdGVkIl0KICAgICAgICAgICAgICAgICAgICBmb3IgdGV4dCBpbiBmb2xsb3dfdGV4dHM6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9dGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCB0aGVvIGTDtWkgc2F1IG5oaeG7gXUgbOG6p24gdGjhu60iKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdGV4dCBj4bunYSBuw7p0CiAgICAgICAgICAgIGJ1dHRvbl90ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dChmb2xsb3dfYnV0dG9uKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVGV4dCBj4bunYSBuw7p0IGZvbGxvdzoge2J1dHRvbl90ZXh0fSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGzDoCAixJBhbmcgdGhlbyBkw7VpIiBob+G6t2MgIkZvbGxvd2luZyIgdGjDrCDEkcOjIGZvbGxvdyBy4buTaQogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIsSQYW5nIHRoZW8gZMO1aSIsICJGb2xsb3dpbmciXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHRoZW8gZMO1aSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSB04burIHRyxrDhu5tjIikKICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGzDoCAixJDDoyB5w6p1IGPhuqd1IiBob+G6t2MgIlJlcXVlc3RlZCIgdGjDrCDEkcOjIHnDqnUgY+G6p3UgZm9sbG93IHLhu5NpCiAgICAgICAgICAgIGlmIGJ1dHRvbl90ZXh0IGluIFsixJDDoyB5w6p1IGPhuqd1IiwgIlJlcXVlc3RlZCJdOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgecOqdSBj4bqndSB0aGVvIGTDtWkgdMOgaSBraG/huqNuIHt1c2VybmFtZX0gdOG7qyB0csaw4bubYyIpCiAgICAgICAgICAgICAgICByZXR1cm4gNQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBsw6AgIlRoZW8gZMO1aSIgaG/hurdjICJGb2xsb3ciIHRow6wgY2xpY2sgdsOgbyBuw7p0CiAgICAgICAgICAgIGlmIGJ1dHRvbl90ZXh0IGluIFsiVGhlbyBkw7VpIiwgIkZvbGxvdyJdOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVGjhu7FjIGhp4buHbiBjbGljayB2w6BvIG7DunQgdGhlbyBkw7VpIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihmb2xsb3dfYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMnMKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgZGlhbG9nIGhp4buHbiBsw6puIGtow7RuZwogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyB0aOG7gyBraeG7g20gdHJhIGRpYWxvZywgbmjGsG5nIGPDsyB0aOG7gyDEkcOjIHRoZW8gZMO1aSB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgdHLhuqFuZyB0aMOhaSBuw7p0CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRpYWxvZ19jb250YWluZXIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvZGlhbG9nX2NvbnRhaW5lciIpCiAgICAgICAgICAgICAgICBpZiBkaWFsb2dfY29udGFpbmVyOgogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIHRow7RuZyBiw6FvICJUaOG7rSBs4bqhaSBzYXUiIGtow7RuZwogICAgICAgICAgICAgICAgICAgIHJldHJ5X3RleHQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IlRo4butIGzhuqFpIHNhdSIpCiAgICAgICAgICAgICAgICAgICAgaWYgcmV0cnlfdGV4dDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBC4bqlbSBuw7p0IE9LIGxpw6puIHThu6VjIGNobyDEkeG6v24ga2hpIGtow7RuZyBjw7JuIGRpYWxvZwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9kaXNtaXNzX2FsbF9kaWFsb2dzKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiSm9iIGtow7RuZyBob8OgbiB0aMOgbmgsIGLhu4sgZ2nhu5tpIGjhuqFuIHRoZW8gZMO1aSAodGjhu60gbOG6oWkgc2F1KSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAzCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIHRow7RuZyBiw6FvICJZw6p1IGPhuqd1IGPhu6dhIGLhuqFuIMSRYW5nIGNo4budIiBraMO0bmcKICAgICAgICAgICAgICAgICAgICB3YWl0aW5nX3RleHQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IlnDqnUgY+G6p3UgY+G7p2EgYuG6oW4gxJFhbmcgY2jhu50iKQogICAgICAgICAgICAgICAgICAgIGlmIHdhaXRpbmdfdGV4dDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBC4bqlbSBuw7p0IE9LIGxpw6puIHThu6VjIGNobyDEkeG6v24ga2hpIGtow7RuZyBjw7JuIGRpYWxvZwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9kaXNtaXNzX2FsbF9kaWFsb2dzKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiSG/DoG4gdGjDoG5oLCB5w6p1IGPhuqd1IHRoZW8gZMO1aSDEkWFuZyBjaOG7nSBkdXnhu4d0IikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDMKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGzDoCBkaWFsb2cga2jDoWMsIGLhuqVtIE9LIGxpw6puIHThu6VjCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZGlzbWlzc19hbGxfZGlhbG9ncygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIGPhuqduIHjDoWMgbmjhuq1uIHRoZW8gZMO1aSBraMO0bmcgKHTDoGkga2hv4bqjbiByacOqbmcgdMawKQogICAgICAgICAgICAgICAgY29uZmlybV9jb250YWluZXIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvbGF5b3V0X2NvbnRhaW5lcl9ib3R0b21fc2hlZXQiKQogICAgICAgICAgICAgICAgaWYgY29uZmlybV9jb250YWluZXI6CiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIG7DunQgIlRoZW8gZMO1aSIgdHJvbmcgY29udGFpbmVyCiAgICAgICAgICAgICAgICAgICAgY29uZmlybV9mb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJUaGVvIGTDtWkiLGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3IikKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY29uZmlybV9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtX2ZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IkZvbGxvdyIsY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXciKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBjb25maXJtX2ZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjb25maXJtX2ZvbGxvd19idXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgdGV4dCBzYXUga2hpIG5o4bqlbiB0aGVvIGTDtWkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyB0aOG7gyBraeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgbsO6dCwgbmjGsG5nIGPDsyB0aOG7gyDEkcOjIHRoZW8gZMO1aSB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB1cGRhdGVkX2ZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcHJvZmlsZV9oZWFkZXJfZm9sbG93X2J1dHRvbiIpCiAgICAgICAgICAgICAgICBpZiBub3QgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSBs4bqhaSB0aGVvIHRleHQKICAgICAgICAgICAgICAgICAgICBmb2xsb3dfdGV4dHMgPSBbIsSQYW5nIHRoZW8gZMO1aSIsICJGb2xsb3dpbmciLCAixJDDoyB5w6p1IGPhuqd1IiwgIlJlcXVlc3RlZCIsICJUaGVvIGTDtWkiLCAiRm9sbG93Il0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBmb3IgdGV4dCBpbiBmb2xsb3dfdGV4dHM6CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD10ZXh0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiB1cGRhdGVkX2ZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB1cGRhdGVkX2ZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF90ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh1cGRhdGVkX2ZvbGxvd19idXR0b24pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDoWMgdHLGsOG7nW5nIGjhu6NwIGtow6FjIG5oYXUKICAgICAgICAgICAgICAgICAgICBpZiB1cGRhdGVkX3RleHQgaW4gWyLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIl06CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkZvbGxvdyB0aMOgbmggY8O0bmchIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgICAgICBlbGlmIHVwZGF0ZWRfdGV4dCBpbiBbIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBn4butaSB5w6p1IGPhuqd1IHRoZW8gZMO1aSB0aMOgbmggY8O0bmchIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDUKICAgICAgICAgICAgICAgICAgICBlbGlmIHVwZGF0ZWRfdGV4dCBpbiBbIlRoZW8gZMO1aSIsICJGb2xsb3ciXToKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIHRow7RuZyBiw6FvICJZw6p1IGPhuqd1IGPhu6dhIGLhuqFuIMSRYW5nIGNo4budIiBraMO0bmcKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyB0aOG7gyBraeG7g20gdHJhIHRp4bq/cCwgZ2nhuqMgxJHhu4tuaCBsw6AgxJHDoyBn4butaSB5w6p1IGPhuqd1IHRoZW8gZMO1aQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB3YWl0aW5nX3RleHQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IlnDqnUgY+G6p3UgY+G7p2EgYuG6oW4gxJFhbmcgY2jhu50iKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB3YWl0aW5nX3RleHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIELhuqVtIG7DunQgT0sgbGnDqm4gdOG7pWMgY2hvIMSR4bq/biBraGkga2jDtG5nIGPDsm4gZGlhbG9nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9kaXNtaXNzX2FsbF9kaWFsb2dzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkhvw6BuIHRow6BuaCwgecOqdSBj4bqndSB0aGVvIGTDtWkgxJFhbmcgY2jhu50gZHV54buHdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgCgogCgogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiRm9sbG93IGtow7RuZyB0aMOgbmggY8O0bmcsIHRleHQgY+G7p2EgbsO6dCBsw6A6IHt1cGRhdGVkX3RleHR9IikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCwgY8OzIHRo4buDIMSRw6MgZm9sbG93IHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGZvbGxvdyBzYXUga2hpIG5o4bqlbiwgZ2nhuqMgxJHhu4tuaCDEkcOjIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiVGV4dCBj4bunYSBuw7p0IGtow7RuZyBraOG7m3AgduG7m2kgJ1RoZW8gZMO1aScgaG/hurdjICdGb2xsb3cnOiB7YnV0dG9uX3RleHR9IikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYiBmb2xsb3c6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIDIKICAgIAogICAgZGVmIF9wZXJmb3JtX2xpa2Vfam9iKHNlbGYsIHBvc3RfbGluazogc3RyKSAtPiBpbnQ6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IgbGlrZSBiw6BpIMSRxINuZyB0csOqbiBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwb3N0X2xpbms6IExpbmsgxJHhur9uIGLDoGkgxJHEg25nIGPhuqduIGxpa2UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgaW50OiBUcuG6oW5nIHRow6FpIGpvYiAoMDogY2jGsGEgbMOgbSwgMTogaG/DoG4gdGjDoG5oLCAyOiBs4buXaSwgMzogYuG7iyB1bmxpa2UpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJN4bufIGLDoGkgxJHEg25nIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3A6IHtwb3N0X2xpbmt9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTeG7nyB0cuG7sWMgdGnhur9wIFVSTCB0aMO0bmcgcXVhIGhlbHBlci5vcGVuX3VybCgpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHBvc3RfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaOG7nSB0cmFuZyBiw6BpIMSRxINuZyB04bqjaSB4b25nIHbhu5tpIHRo4budaSBnaWFuIG5n4bqrdSBuaGnDqm4KICAgICAgICAgICAgd2FpdF90aW1lID0gcmFuZG9tLnJhbmRpbnQoNCwgNikgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiA0LTZzCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkGFuZyBjaOG7nSB7d2FpdF90aW1lfXMgxJHhu4MgdHJhbmcgdOG6o2kgeG9uZy4uLiIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFZ14buRdCBuaOG6uSBsw6puIHRyw6puIGtob+G6o25nIDEgbuG7rWEgbcOgbiBow6xuaCDEkeG7gyBoaeG7g24gdGjhu4sgbsO6dCBsaWtlCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlZ14buRdCBuaOG6uSDEkeG7gyBoaeG7g24gdGjhu4sgbsO6dCBsaWtlIikKICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDEuNXMKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBuw7p0IGxpa2UgdGhlbyByZXNvdXJjZS1pZAogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGR1bXAgbcOgbiBow6xuaCBraGkgdMOsbSBuw7p0IGxpa2UiKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9yb3dfZmVlZF9idXR0b25fbGlrZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSwgdGjhu60gdnXhu5F0IGzhuqduIG7hu69hCiAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGxpa2UsIHRo4butIHZ14buRdCBs4bqnbiBu4buvYSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIGtoaSB0w6xtIGzhuqFpIG7DunQgbGlrZSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Jvd19mZWVkX2J1dHRvbl9saWtlIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IHbhuqtuIGtow7RuZyB0w6xtIHRo4bqleSB0aGVvIHJlc291cmNlLWlkLCB0aOG7rSB0w6xtIHRoZW8gY29udGVudC1kZXNjCiAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRo4butIHTDrG0gbsO6dCBsaWtlIHRoZW8gY29udGVudC1kZXNjIikKICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlRow61jaCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gduG7m2kgdGV4dCB0aeG6v25nIEFuaAogICAgICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9Ikxpa2UiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSB24bqrbiBraMO0bmcgdMOsbSB0aOG6pXksIGLDoW8gbOG7l2kKICAgICAgICAgICAgaWYgbm90IGxpa2VfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGxpa2Ugc2F1IG5oaeG7gXUgbOG6p24gdGjhu60iKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6MgbGlrZSBjaMawYSBi4bqxbmcgdGh14buZYyB0w61uaCBzZWxlY3RlZAogICAgICAgICAgICBpc19zZWxlY3RlZCA9IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b24pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IHNlbGVjdGVkIGtow7RuZyBjw7MgZ2nDoSB0cuG7iywgdGjhu60gdMOsbSBuw7p0ICJC4buPIHRow61jaCIgaG/hurdjICJVbmxpa2UiCiAgICAgICAgICAgIGlmIG5vdCBpc19zZWxlY3RlZDoKICAgICAgICAgICAgICAgIHVubGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iQuG7jyB0aMOtY2giKQogICAgICAgICAgICAgICAgaWYgbm90IHVubGlrZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgdW5saWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJVbmxpa2UiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpc19zZWxlY3RlZCA9IGJvb2wodW5saWtlX2J1dHRvbikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IMSRw6MgbGlrZSBy4buTaSB0aMOsIGhvw6BuIHRow6BuaAogICAgICAgICAgICBpZiBpc19zZWxlY3RlZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgbGlrZSBiw6BpIHZp4bq/dCBuw6B5IHThu6sgdHLGsOG7m2MiKQogICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIExpa2UgYsOgaSB2aeG6v3QKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTmjhuqVuIG7DunQgbGlrZSIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihsaWtlX2J1dHRvbikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMnMKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB4ZW0gxJHDoyBsaWtlIHRow6BuaCBjw7RuZyBjaMawYQogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAjIEtow7RuZyB0aOG7gyBraeG7g20gdHJhLCBnaeG6oyDEkeG7i25oIMSRw6MgbGlrZSB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0aOG7gyBraeG7g20gdHJhIGzhuqFpIHRy4bqhbmcgdGjDoWkgbGlrZSwgZ2nhuqMgxJHhu4tuaCB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBjaGVja191bmxpa2UgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iQuG7jyB0aMOtY2giKQogICAgICAgICAgICBpZiBub3QgY2hlY2tfdW5saWtlOgogICAgICAgICAgICAgICAgY2hlY2tfdW5saWtlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlVubGlrZSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIGLhurFuZyByZXNvdXJjZS1pZCB2w6Agc2VsZWN0ZWQKICAgICAgICAgICAgaWYgbm90IGNoZWNrX3VubGlrZToKICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uX2FmdGVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Jvd19mZWVkX2J1dHRvbl9saWtlIikKICAgICAgICAgICAgICAgIGlmIGxpa2VfYnV0dG9uX2FmdGVyIGFuZCBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGxpa2VfYnV0dG9uX2FmdGVyKToKICAgICAgICAgICAgICAgICAgICBjaGVja191bmxpa2UgPSBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgY2hlY2tfdW5saWtlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBsaWtlIGLDoGkgdmnhur90IHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB4w6FjIG5o4bqtbiDEkcOjIGxpa2UgYsOgaSB2aeG6v3QiKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gam9iIGxpa2U6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgCiAgICBkZWYgX2NhcmVfc3dpcGVfZmVlZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJWdeG7kXQgYuG6o25nIHRpbiBJbnN0YWdyYW0gduG7m2kgdGjhu51pIGdpYW4gMi01IHBow7p0LCBjw7MgdGjhu4MgbGlrZSBiw6BpIG7hur91IGThu6tuZyBsw6J1IiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgIyBSYW5kb20gdGjhu51pIGdpYW4gdnXhu5F0IHThu6sgMzAtMTIwIGdpw6J5CiAgICAgICAgICAgIHRvdGFsX3RpbWUgPSByYW5kb20ucmFuZGludCgzMCwgMTIwKSAgIyAzMC0xMjAgZ2nDonkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSB2deG7kXQgYuG6o25nIHRpbiB0cm9uZyB7dG90YWxfdGltZX0gZ2nDonkiKQogICAgICAgICAgICAKICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIHN3aXBlX2NvdW50ID0gMAogICAgICAgICAgICBsaWtlX2NvdW50ID0gMAogICAgICAgICAgICAKICAgICAgICAgICAgd2hpbGUgKHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSkgPCB0b3RhbF90aW1lOgogICAgICAgICAgICAgICAgc3dpcGVfY291bnQgKz0gMQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgIyBUaOG7nWkgZ2lhbiBk4burbmcgbmfhuqt1IG5oacOqbiB04burIDEtMTUgZ2nDonkKICAgICAgICAgICAgICAgIHBhdXNlX3RpbWUgPSByYW5kb20ucmFuZGludCgxLCAxNSkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYiVnXhu5F0IGzhuqduIHtzd2lwZV9jb3VudH0sIGThu6tuZyB7cGF1c2VfdGltZX1zIikKICAgICAgICAgICAgICAgICMgTuG6v3UgZOG7q25nIGzDonUgaMahbiA4cyB0aMOsIGPDsyAyJSBjaGFuY2UgbGlrZSBiw6BpCiAgICAgICAgICAgICAgICBpZiBwYXVzZV90aW1lID4gOCBhbmQgcmFuZG9tLnJhbmRpbnQoMSwgMTAwKSA8PSAyOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRo4butIGxpa2UgYsOgaSB2aeG6v3QgbsOgeS4uLiIpCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gbsO6dCBsaWtlIHRyb25nIGZlZWQKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9yb3dfZmVlZF9idXR0b25fbGlrZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsaWtlX2J1dHRvbiBhbmQgbm90IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b24pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihsaWtlX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBsaWtlIGLDoGkgdmnhur90ICh04buVbmc6IHtsaWtlX2NvdW50fSBsaWtlcykiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjDqm0gdGjhu51pIGdpYW4gY2jhu50gc2F1IGtoaSBsaWtlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDEsIDIpKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJLaMO0bmcgdGjhu4MgbGlrZSBiw6BpOiB7ZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEThu6tuZyB0aGVvIHRo4budaSBnaWFuIMSRw6MgcmFuZG9tCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKHBhdXNlX3RpbWUpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgZWxhcHNlZCA9IHRpbWUudGltZSgpIC0gc3RhcnRfdGltZQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiSG/DoG4gdGjDoG5oIHZ14buRdCBmZWVkOiB7c3dpcGVfY291bnR9IGzhuqduIHZ14buRdCwge2xpa2VfY291bnR9IGxpa2VzIHRyb25nIHtlbGFwc2VkOi4xZn1zIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUXVheSBs4bqhaSB0cmFuZyBjaOG7pwogICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHZ14buRdCBmZWVkOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2NhcmVfd2F0Y2hfcmVlbHMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiTMaw4bubdCByZWVsIHbhu5tpIHRo4budaSBnaWFuIGThu6tuZyByYW5kb20gdsOgIGPDsyB0aOG7gyBsaWtlIHZpZGVvIG7hur91IGThu6tuZyBsw6J1IiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4bqvdCDEkeG6p3UgbMaw4bubdCByZWVsLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIHbhu4EgdHJhbmcgY2jhu6cgdHLGsOG7m2MKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw7MgdGFiIHJlZWwga2jDtG5nCiAgICAgICAgICAgIHJlZWxfdGFiID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudCh0aW1lb3V0PTUsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvY2xpcHNfdGFiIikKICAgICAgICAgICAgaWYgbm90IHJlZWxfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiBSZWVsIChjbGlwc190YWIpIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihyZWVsX3RhYikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDUpCiAgICAgICAgICAgIAogICAgICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgdG90YWxfd2FpdCA9IHJhbmRvbS5yYW5kaW50KDMwLCAxMjApICAjIDMwLTEyMCBnacOieQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG7lW5nIHRo4budaSBnaWFuIGzGsOG7m3QgcmVlbCBz4bq9IGzDoCB7dG90YWxfd2FpdH0gZ2nDonkiKQogICAgICAgICAgICAKICAgICAgICAgICAgZWxhcHNlZCA9IDAKICAgICAgICAgICAgc3dpcGVfY291bnQgPSAwCiAgICAgICAgICAgIGxpa2VfY291bnQgPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSBlbGFwc2VkIDwgdG90YWxfd2FpdDoKICAgICAgICAgICAgICAgIHN3aXBlX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYixJBhbmcgdnXhu5F0IHJlZWwgbOG6p24gdGjhu6kge3N3aXBlX2NvdW50fSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu51pIGdpYW4geGVtIHZpZGVvIHJhbmRvbSB04burIDItMTBzCiAgICAgICAgICAgICAgICB2aWRlb190aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgMTUpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIlhlbSB2aWRlbyBuw6B5IHt2aWRlb190aW1lfSBnacOieS4uLiIpCiAgICAgICAgICAgICAgICAjIE7hur91IGThu6tuZyBsw6J1IGjGoW4gOHMgdGjDrCBjw7MgNSUgY2hhbmNlIGxpa2UgdmlkZW8KICAgICAgICAgICAgICAgIGlmIHZpZGVvX3RpbWUgPiA4IGFuZCByYW5kb20ucmFuZGludCgxLCAxMDApIDw9IDU6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjIENo4budIG3hu5l0IGNow7p0IMSR4buDIHZpZGVvIGxvYWQKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gbsO6dCBsaWtlIHRyb25nIHJlZWwKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gbsO6dCBsaWtlIHRoZW8gY8OhYyByZXNvdXJjZS1pZCBraMOhYyBuaGF1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9saWtlX2J1dHRvbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbGlrZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVGjDrWNoIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJMaWtlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGlrZV9idXR0b24gYW5kIG5vdCBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGxpa2VfYnV0dG9uKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUaOG7rSBsaWtlIHZpZGVvIHJlZWwgbsOgeS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGxpa2VfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpa2VfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGxpa2UgdmlkZW8gcmVlbCAodOG7lW5nOiB7bGlrZV9jb3VudH0gbGlrZXMpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFhlbSB0aMOqbSAyLTEwcyBzYXUga2hpIGxpa2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYV90aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgMTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJYZW0gdGjDqm0ge2V4dHJhX3RpbWV9cyBzYXUga2hpIGxpa2UiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoZXh0cmFfdGltZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgbGlrZSBob+G6t2MgxJHDoyBsaWtlIHLhu5NpIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCJLaMO0bmcgdGjhu4MgZHVtcCBzY3JlZW4gxJHhu4MgdMOsbSBuw7p0IGxpa2UiKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJLaMO0bmcgdGjhu4MgbGlrZSB2aWRlbyByZWVsOiB7ZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEThu6tuZyB0aGVvIHRo4budaSBnaWFuIMSRw6MgcmFuZG9tCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKHZpZGVvX3RpbWUpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGFwc2VkID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBmb3JjZSBzdG9wCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDAuMSk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG7lW5nIHPhu5EgbOG6p24gdnXhu5F0OiB7c3dpcGVfY291bnR9LCB7bGlrZV9jb3VudH0gbGlrZXMiKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIGzGsOG7m3QgeG9uZyBjw6FjIHJlZWwsIHF1YXkgbOG6oWkgdHJhbmcgY2jhu6cuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBRdWF5IGzhuqFpIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciLCB0aW1lb3V0PTUpOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJUcmFuZyBjaOG7pyIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIHF1YXkgbOG6oWkgdHJhbmcgY2jhu6cgc2F1IGtoaSBsxrDhu5t0IHJlZWwuIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIGzGsOG7m3QgcmVlbDoge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2NhcmVfdmlld19zdG9yaWVzKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIlhlbSBzdG9yeSAzLTUgc3RvcnkgduG7m2kgdOG7kWMgxJHhu5kgbmfhuqt1IG5oacOqbiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0aOG7nWkgZ2lhbiB4ZW0gc3RvcnkgY3Xhu5FpIGPDuW5nIHThu6sgYWNjb3VudAogICAgICAgICAgICBsYXN0X3ZpZXdfc3RvcmllcyA9IGFjY291bnQuZ2V0KCJsYXN0X3ZpZXdfc3RvcmllcyIsIDApCiAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgaWYgbGFzdF92aWV3X3N0b3JpZXMgPiAwIGFuZCAoY3VycmVudF90aW1lIC0gbGFzdF92aWV3X3N0b3JpZXMpIDwgMTA4MDA6ICAjIDMgdGnhur9uZyA9IDEwODAwIGdpw6J5CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJDaMawYSDEkeG7pyAzIHRp4bq/bmcga+G7gyB04burIGzhuqduIHhlbSBzdG9yeSBjdeG7kWksIGLhu48gcXVhIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgICAgICAgICAjIFTDrG0gdOG6pXQgY+G6oyBzdG9yeSB0aHVtYm5haWxzIHRoZW8gcmVzb3VyY2UtaWQKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgIHN0b3J5X3RodW1icyA9IFtdCiAgICAgICAgICAgIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICBzdG9yeV90aHVtYnMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hdmF0YXJfaW1hZ2VfdmlldyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgbuG6v3UgY8OzIMOtdCBuaOG6pXQgMiBzdG9yeSB0aMOsIG3hu5tpIGzDoG0KICAgICAgICAgICAgaWYgbGVuKHN0b3J5X3RodW1icykgPCAyOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIktow7RuZyDEkeG7pyBzdG9yeSDEkeG7gyB4ZW0gKGNo4buJIGPDsyB7bGVuKHN0b3J5X3RodW1icyl9IHN0b3J5KSwgYuG7jyBxdWEiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmFuZG9tIGNo4buNbiBzdG9yeSB04burIHRo4bupIDIgxJHhur9uIGN14buRaQogICAgICAgICAgICBzdGFydF9pbmRleCA9IHJhbmRvbS5yYW5kaW50KDEsIGxlbihzdG9yeV90aHVtYnMpIC0gMSkKICAgICAgICAgICAgc2VsZWN0ZWRfc3RvcnkgPSBzdG9yeV90aHVtYnNbc3RhcnRfaW5kZXhdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELhuqVtIHbDoG8gc3RvcnkgxJHGsOG7o2MgY2jhu41uCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWxlY3RlZF9zdG9yeSkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFhlbSAzLTggc3RvcnkgduG7m2kgdOG7kWMgxJHhu5kgbmfhuqt1IG5oacOqbgogICAgICAgICAgICBudW1fc3RvcmllcyA9IHJhbmRvbS5yYW5kaW50KDMsIDgpCiAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKG51bV9zdG9yaWVzKToKICAgICAgICAgICAgICAgICMgVGjhu51pIGdpYW4geGVtIHN0b3J5OiBuZ+G6r24gaG/hurdjIGTDoGkgbmfhuqt1IG5oacOqbgogICAgICAgICAgICAgICAgd2FpdCA9IHJhbmRvbS51bmlmb3JtKDEuMCwgMy4wKSBpZiByYW5kb20uY2hvaWNlKFtUcnVlLCBGYWxzZV0pIGVsc2UgcmFuZG9tLnVuaWZvcm0oMy4wLCA1LjApCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2FpdCkKICAgICAgICAgICAgICAgICMgQ2h1eeG7g24gc2FuZyBzdG9yeSB0aeG6v3AgdGhlbyBi4bqxbmcgY8OhY2ggYuG6pW0gdsOgbyB24buLIHRyw60gbmfhuqt1IG5oacOqbiDhu58gZ2nhu69hIG3DoG4gaMOsbmgKICAgICAgICAgICAgICAgIHdpZHRoLCBoZWlnaHQgPSBzZWxmLmhlbHBlci5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfcmlnaHQoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaG/DoXQgc3Rvcnkgdmlld2VyCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjhu51pIGdpYW4geGVtIHN0b3J5IGN14buRaSBjw7luZyB2w6BvIGFjY291bnQKICAgICAgICAgICAgaWYgYWNjb3VudCBhbmQgImlkIiBpbiBhY2NvdW50OgogICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7Imxhc3Rfdmlld19zdG9yaWVzIjogY3VycmVudF90aW1lLCAiaXNfc3luYyI6IEZhbHNlfSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHhlbSBzdG9yeToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9jYXJlX3ZpZXdfbm90aWZpY2F0aW9ucyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJN4bufIHRhYiB0aMO0bmcgYsOhbyB2w6AgY3Xhu5luIG5o4bq5IiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAxOiBLaeG7g20gdHJhIGPDsyBub3RpZmljYXRpb24gYmFkZ2Uga2jDtG5nCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIG5vdGlmaWNhdGlvbl9iYWRnZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9sZWRfYmFkZ2UiKQogICAgICAgICAgICBpZiBub3Qgbm90aWZpY2F0aW9uX2JhZGdlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIGPDsyBub3RpZmljYXRpb24gYmFkZ2UsIGLhu48gcXVhIHhlbSB0aMO0bmcgYsOhbyIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDI6IELhuqVtIHbDoG8gbm90aWZpY2F0aW9uIHRhYgogICAgICAgICAgICBub3RpZmljYXRpb25fdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL25vdGlmaWNhdGlvbiIpCiAgICAgICAgICAgIGlmIG5vdCBub3RpZmljYXRpb25fdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG5vdGlmaWNhdGlvbiB0YWIiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG5vdGlmaWNhdGlvbl90YWIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgyLCAzKSkgICMgxJDhu41jIDItM3MKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAzOiBSYW5kb20geOG7rSBsw70KICAgICAgICAgICAgaWYgcmFuZG9tLmNob2ljZShbVHJ1ZSwgRmFsc2VdKToKICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgYuG6pW0gdsOgbyBzdG9yeSByb3cKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgaWYgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICBzdG9yeV9yb3dzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJhY3Rpdml0eV9mZWVkX25ld3NmZWVkX3N0b3J5X3JvdyIpCiAgICAgICAgICAgICAgICAgICAgaWYgc3Rvcnlfcm93cyBhbmQgbGVuKHN0b3J5X3Jvd3MpID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBSYW5kb20gY2jhu41uIGluZGV4IHThu6sgMS0zIChob+G6t2Mgw610IGjGoW4gbuG6v3Uga2jDtG5nIMSR4bunKQogICAgICAgICAgICAgICAgICAgICAgICBtYXhfaW5kZXggPSBtaW4oMywgbGVuKHN0b3J5X3Jvd3MpIC0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWF4X2luZGV4ID49IDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9pbmRleCA9IHJhbmRvbS5yYW5kaW50KDEsIG1heF9pbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkX3N0b3J5ID0gc3Rvcnlfcm93c1tzZWxlY3RlZF9pbmRleF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWxlY3RlZF9zdG9yeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgzLCA0KSkgICMgQ2jhu50gMy00cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFZ14buRdCBsw6puIDEtMyBs4bqnbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UocmFuZG9tLnJhbmRpbnQoMSwgMykpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMikpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFJhbmRvbSB2deG7kXQgbMOqbiBob+G6t2Mga2jDtG5nCiAgICAgICAgICAgICAgICBpZiByYW5kb20uY2hvaWNlKFtUcnVlLCBGYWxzZV0pOgogICAgICAgICAgICAgICAgICAgICMgVnXhu5F0IGzDqm4gMS0zIGzhuqduCiAgICAgICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UocmFuZG9tLnJhbmRpbnQoMSwgMykpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgxLCAyKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyA0OiBRdWF5IGzhuqFpIGhvbWUKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgeGVtIHRow7RuZyBiw6FvOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgcGVyZm9ybV9jYXJlKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKToKICAgICAgICAiIiJMZWdhY3kgbWV0aG9kIC0gcmVkaXJlY3RzIHRvIFNtYXJ0IENhcmUgU3lzdGVtIGZvciBjb25zaXN0ZW5jeSIiIgogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJDaHV54buDbiBoxrDhu5tuZyBwZXJmb3JtX2NhcmUgSW5zdGFncmFtIHNhbmcgU21hcnQgQ2FyZSBTeXN0ZW0gY2hvIHTDoGkga2hv4bqjbjoge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSIpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFJhbmRvbSBjaOG7jW4gMSB0cm9uZyAzIFNtYXJ0IENhcmUgbWV0aG9kcyDEkeG7gyB0xrDGoW5nIHRow61jaCB24bubaSBsZWdhY3kKICAgICAgICAgICAgc21hcnRfY2FyZV9hY3Rpb25zID0gWwogICAgICAgICAgICAgICAgc2VsZi5fY2FyZV9zd2lwZV9mZWVkLAogICAgICAgICAgICAgICAgc2VsZi5fY2FyZV93YXRjaF9yZWVscywgCiAgICAgICAgICAgICAgICBzZWxmLl9jYXJlX3ZpZXdfbm90aWZpY2F0aW9ucwogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJhbmRvbSBjaOG7jW4gYWN0aW9uCiAgICAgICAgICAgIHNlbGVjdGVkX2FjdGlvbiA9IHJhbmRvbS5jaG9pY2Uoc21hcnRfY2FyZV9hY3Rpb25zKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIFNtYXJ0IENhcmUgYWN0aW9uCiAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZF9hY3Rpb24oYWNjb3VudCkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIFNtYXJ0IENhcmUgY2hvIEluc3RhZ3JhbToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgcGVyZm9ybV9wb3N0X2FjdGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkMSDbmcg4bqjbmggY2hvIEluc3RhZ3JhbSB24bubaSBraeG7g20gdHJhIHRo4budaSBnaWFuIGRlbGF5CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcgxJHEg25nIOG6o25oIGhv4bq3YyDEkcOjIMSRxINuZyBn4bqnbiDEkcOieQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgYWNjID0gYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICdVbmtub3duJykKICAgICAgICAgICAgYWNjb3VudF9pZCA9IGFjY291bnQuZ2V0KCdpZCcpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgdGjhu51pIGdpYW4gcG9zdCBn4bqnbiBuaOG6pXQKICAgICAgICAgICAgZGVsYXlfbWludXRlcyA9IHNlbGYuZ2V0X2NvbmZpZygiZGVsYXlfcG9zdF92aWRlb19taW51dGUiKQogICAgICAgICAgICBpZiBkZWxheV9taW51dGVzIGFuZCBhY2NvdW50X2lkOgogICAgICAgICAgICAgICAgbGFzdF9wb3N0X3RpbWUgPSBzZWxmLmRiLmdldF9hY2NvdW50X2xhc3RfcG9zdF90aW1lKGFjY291bnRfaWQsIHNlbGYuYXBwX25hbWUpCiAgICAgICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGxhc3RfcG9zdF90aW1lOgogICAgICAgICAgICAgICAgICAgIHRpbWVfZGlmZl9taW51dGVzID0gKGN1cnJlbnRfdGltZSAtIGxhc3RfcG9zdF90aW1lKSAvIDYwCiAgICAgICAgICAgICAgICAgICAgaWYgdGltZV9kaWZmX21pbnV0ZXMgPCBkZWxheV9taW51dGVzOgogICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdfbWludXRlcyA9IGRlbGF5X21pbnV0ZXMgLSB0aW1lX2RpZmZfbWludXRlcwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2N9IMSRw6MgxJHEg25nIOG6o25oIGfhuqduIMSRw6J5LCBj4bqnbiBjaOG7nSB0aMOqbSB7cmVtYWluaW5nX21pbnV0ZXM6LjFmfSBwaMO6dCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlICAjIFRy4bqjIHbhu4EgVHJ1ZSDEkeG7gyBraMO0bmcgY29pIGzDoCBs4buXaQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSDEkcSDbmcg4bqjbmggY2hvIHTDoGkga2hv4bqjbjoge2FjY30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDE6IMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cgSW5zdGFncmFtCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIHbDoG8gdHJhbmcgY2jhu6cgSW5zdGFncmFtIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDI6IFJhbmRvbSBz4buRIGzGsOG7o25nIOG6o25oIHbDoCB04bqjaSB24buBCiAgICAgICAgICAgIGltYWdlX2NvdW50ID0gcmFuZG9tLnJhbmRpbnQoMSwgNSkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlJhbmRvbSB7aW1hZ2VfY291bnR9IOG6o25oIMSR4buDIMSRxINuZyBiw6BpIikKICAgICAgICAgICAgaWYgbm90IHNlbGYuaGVscGVyLmRvd25sb2FkX2ltYWdlKGNvdW50PWltYWdlX2NvdW50KToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIlThuqNpIOG6o25oIHRo4bqldCBi4bqhaSwgYuG7jyBxdWEgxJHEg25nIGLDoGkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAzOiBOaOG6pW4gbsO6dCB04bqhbyBiw6BpIHZp4bq/dCAoY3JlYXRpb25fdGFiIGhv4bq3YyBuw7p0ICspCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuqVtIG7DunQgdOG6oW8gYsOgaSB2aeG6v3QuLi4iKQogICAgICAgICAgICBhZGRfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2NyZWF0aW9uX3RhYiIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgaWYgbm90IGFkZF9idXR0b246CiAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gbsO6dCArIOG7nyB24buLIHRyw60ga2jDoWMKICAgICAgICAgICAgICAgIGFkZF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9idXR0b25zX2NvbnRhaW5lcl9sZWZ0IiwgdGltZW91dD01KQogICAgICAgICAgICAgICAgaWYgbm90IGFkZF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSBjw6FjIGPDoWNoIHTDrG0ga2jDoWMKICAgICAgICAgICAgICAgICAgICBhZGRfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChjb250ZW50X2Rlc2M9Ik5ldyBwb3N0IiwgdGltZW91dD01KQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhZGRfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBhZGRfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChjb250ZW50X2Rlc2M9IkFkZCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFkZF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCB04bqhbyBiw6BpIHZp4bq/dCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICMgQ2jhu50gY2FtZXJhIGRlc3RpbmF0aW9uIGZlZWQKICAgICAgICAgICAgY2FtZXJhX2Rlc3QgPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KHRpbWVvdXQ9NSwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9jYW1fZGVzdF9mZWVkIikKICAgICAgICAgICAgaWYgbm90IGNhbWVyYV9kZXN0OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IGNhbV9kZXN0X2ZlZWQiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhuqV5IHRow6wgY2xpY2sKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjYW1lcmFfZGVzdCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaW1hZ2VfY291bnQgPiAxOgogICAgICAgICAgICAgICAgIyBCxrDhu5tjIDQ6IELhuqVtICJDSOG7jE4gTkhJ4buAVSIgbuG6v3UgY+G6p24gY2jhu41uIG5oaeG7gXUg4bqjbmgKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuqVtICdDSOG7jE4gTkhJ4buAVScuLi4iKQogICAgICAgICAgICAgICAgbXVsdGlfc2VsZWN0X2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQodGV4dD0iQ0jhu4xOIE5ISeG7gFUiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICBpZiBub3QgbXVsdGlfc2VsZWN0X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gdGhlbyBjb250ZW50LWRlc2MKICAgICAgICAgICAgICAgICAgICBtdWx0aV9zZWxlY3RfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChjb250ZW50X2Rlc2M9Ik7DunQgY2jhu41uIG5oaeG7gXUiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG11bHRpX3NlbGVjdF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSB0aGVvIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpX3NlbGVjdF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvbXVsdGlfc2VsZWN0X3NsaWRlX2J1dHRvbl9hbHQiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBtdWx0aV9zZWxlY3RfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgJ0NI4buMTiBOSEnhu4BVJyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIELGsOG7m2MgNTogQ2jhu41uIOG6o25oIHRoZW8gc+G7kSBsxrDhu6NuZyDEkcOjIHJhbmRvbQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkNo4buNbiB7aW1hZ2VfY291bnR9IOG6o25oIHThu6sgdGjGsCB2aeG7h24uLi4iKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIMSR4buDIHTDrG0g4bqjbmgiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2FsbGVyeV9pdGVtcyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2dhbGxlcnlfZ3JpZF9pdGVtX3RodW1ibmFpbCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBnYWxsZXJ5X2l0ZW1zOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSDhuqNuaCBuw6BvIHRyb25nIHRoxrAgdmnhu4duIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDaOG7jW4gc+G7kSBsxrDhu6NuZyDhuqNuaCB0aGVvIHnDqnUgY+G6p3UgKHThu5FpIMSRYSBsw6Agc+G7kSDhuqNuaCBjw7Mgc+G6tW4pCiAgICAgICAgICAgICAgICAjIELhu48gcXVhIOG6o25oIMSR4bqndSB0acOqbiB2w6wgSW5zdGFncmFtIMSRw6MgdOG7sSDEkeG7mW5nIGNo4buNbgogICAgICAgICAgICAgICAgaXRlbXNfdG9fc2VsZWN0ID0gbWluKGltYWdlX2NvdW50LCBsZW4oZ2FsbGVyeV9pdGVtcykpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkge2xlbihnYWxsZXJ5X2l0ZW1zKX0g4bqjbmgsIHPhur0gY2jhu41uIHtpdGVtc190b19zZWxlY3R9IOG6o25oIChi4buPIHF1YSDhuqNuaCDEkeG6p3UgdGnDqm4gxJHDoyDEkcaw4bujYyBjaOG7jW4gdOG7sSDEkeG7mW5nKSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQuG6r3QgxJHhuqd1IHThu6sg4bqjbmggdGjhu6kgMiAoaW5kZXggMSkgdsOsIOG6o25oIMSR4bqndSB0acOqbiDEkcOjIMSRxrDhu6NjIGNo4buNbiB04buxIMSR4buZbmcKICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEsIGl0ZW1zX3RvX3NlbGVjdCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGdhbGxlcnlfaXRlbXNbaV0pCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBjaOG7jW4g4bqjbmgge2krMX0ve2l0ZW1zX3RvX3NlbGVjdH0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG7lW5nIGPhu5luZyDEkcOjIGNo4buNbiB7aXRlbXNfdG9fc2VsZWN0fSDhuqNuaCAoMSDhuqNuaCB04buxIMSR4buZbmcgKyB7aXRlbXNfdG9fc2VsZWN0LTF9IOG6o25oIHRo4bunIGPDtG5nKSIpCgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyDEkOG7kWkgduG7m2kgMSDhuqNuaCwgY2jhu4kgY+G6p24gY2jhu41uIOG6o25oIMSR4bqndSB0acOqbgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiQ2jhu41uIOG6o25oIMSR4bqndSB0acOqbiB0cm9uZyB0aMawIHZp4buHbi4uLiIpCiAgICAgICAgICAgICAgICAjIEtow7RuZyBj4bqnbiB3YWl0X3RvX3RhcF9lbGVtZW50IGNobyB4cGF0aCBwaOG7qWMgdOG6oXAsIGTDuW5nIGZpbmRfZWxlbWVudCB0aMO0bmcgdGjGsOG7nW5nCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmggxJHhu4MgdMOsbSDhuqNuaCIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSDhuqNuaCDEkeG6p3UgdGnDqm4gdHJvbmcgZ2FsbGVyeQogICAgICAgICAgICAgICAgZmlyc3RfaW1hZ2UgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkltYWdlVmlldyIpCiAgICAgICAgICAgICAgICBpZiBub3QgZmlyc3RfaW1hZ2U6CiAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRoZW8gcmVzb3VyY2UtaWQKICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5X2l0ZW1zID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvZ2FsbGVyeV9ncmlkX2l0ZW1fdGh1bWJuYWlsIikKICAgICAgICAgICAgICAgICAgICBpZiBnYWxsZXJ5X2l0ZW1zOgogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdF9pbWFnZSA9IGdhbGxlcnlfaXRlbXNbMF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGZpcnN0X2ltYWdlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSDhuqNuaCB0cm9uZyB0aMawIHZp4buHbiIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGFwIHbDoG8g4bqjbmggxJHhuqd1IHRpw6puCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZmlyc3RfaW1hZ2UpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMikpCgogICAgICAgICAgICAjIELGsOG7m2MgNjogQuG6pW0gbsO6dCBOZXh0CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuqVtIG7DunQgTmV4dC4uLiIpCiAgICAgICAgICAgIG5leHRfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL25leHRfYnV0dG9uX3RleHR2aWV3IiwgdGltZW91dD0xMCkKICAgICAgICAgICAgaWYgbm90IG5leHRfYnV0dG9uOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIG7DunQgTmV4dCBi4bqxbmcgdGV4dAogICAgICAgICAgICAgICAgbmV4dF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHRleHQ9IlRp4bq/cCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgIGlmIG5vdCBuZXh0X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICBuZXh0X2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJUaeG6v3AiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG5leHRfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBUaeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAjIELGsOG7m2MgNzogTmjhuqVuIFRp4bq/cCBs4bqnbiBu4buvYSAoYuG7jyBxdWEgZWRpdCkKICAgICAgICAgICAgbmV4dF9idXR0b24yID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudCh0ZXh0PSJUaeG6v3AiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgIGlmIG5vdCBuZXh0X2J1dHRvbjI6CiAgICAgICAgICAgICAgICBuZXh0X2J1dHRvbjIgPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVGnhur9wIiwgdGltZW91dD01KQogICAgICAgICAgICBpZiBuZXh0X2J1dHRvbjI6CiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMiwgMykpCiAgICAgICAgICAgIAogICAgICAgICAgICB2YWxpZGF0ZV9uZXh0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IlRp4bq/cCIpCgogICAgICAgICAgICBpZiB2YWxpZGF0ZV9uZXh0OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIHVwIGLDoGkgdmnhur90LCBC4bqlbSBUaeG6v3Aga2jDtG5nIMSRxrDhu6NjIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJI4buneSIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDg6IFRow6ptIGNhcHRpb24gKHTDuXkgY2jhu41uKQogICAgICAgICAgICBjYXB0aW9uX2ZpZWxkID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IldyaXRlIGEgY2FwdGlvbi4uLiIpCiAgICAgICAgICAgIGlmIG5vdCBjYXB0aW9uX2ZpZWxkOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRoZW8gY8OhY2gga2jDoWMKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKSAKICAgICAgICAgICAgICAgIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgY2FwdGlvbl9maWVsZCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iV3JpdGUgYSBjYXB0aW9uLi4uIikKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2FwdGlvbl9maWVsZDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGZpZWxkIGNo4bupYSB04burICJjYXB0aW9uIgogICAgICAgICAgICAgICAgICAgICAgICBhbGxfZWxlbWVudHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuRWRpdFRleHQiKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgZWxlbWVudCBpbiBhbGxfZWxlbWVudHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gZWxlbWVudC5nZXQoInRleHQiLCAiIikubG93ZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGludCA9IGVsZW1lbnQuZ2V0KCJoaW50IiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJjYXB0aW9uIiBpbiB0ZXh0IG9yICJjYXB0aW9uIiBpbiBoaW50OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb25fZmllbGQgPSBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgaWYgY2FwdGlvbl9maWVsZDoKICAgICAgICAgICAgICAgICMgUmFuZG9tIHRow6ptIGNhcHRpb24gaG/hurdjIGtow7RuZyAoNzAlIGPGoSBo4buZaSBjw7MgY2FwdGlvbikKICAgICAgICAgICAgICAgIGlmIHJhbmRvbS5jaG9pY2UoW1RydWUsIFRydWUsIFRydWUsIFRydWUsIFRydWUsIFRydWUsIFRydWUsIEZhbHNlLCBGYWxzZSwgRmFsc2VdKToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgxJDhu41jIGNhcHRpb25zIHThu6sgZmlsZSB0ZW1wbGF0ZQogICAgICAgICAgICAgICAgICAgICAgICBjYXB0aW9uX2ZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5kaXJuYW1lKF9fZmlsZV9fKSksICJ0ZW1wbGF0ZSIsICJjYXB0aW9uc19pbnN0YWdyYW0udHh0IikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoY2FwdGlvbl9maWxlX3BhdGgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGNhcHRpb25fZmlsZV9wYXRoLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbnMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGYucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjYXB0aW9uczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9jYXB0aW9uID0gcmFuZG9tLmNob2ljZShjYXB0aW9ucykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoY2FwdGlvbl9maWVsZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50eXBlX3RleHQoc2VsZWN0ZWRfY2FwdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0aMOqbSBjYXB0aW9uOiB7c2VsZWN0ZWRfY2FwdGlvbn0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJGaWxlIGNhcHRpb25zIHRy4buRbmciKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBGYWxsYmFjayB24buBIGVtb2ppIG7hur91IGtow7RuZyB0w6xtIHRo4bqleSBmaWxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxsYmFja19jYXB0aW9ucyA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi8J+MnyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIuKcqCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfmYIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLwn5O4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi8J+SqyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfjLgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLwn46JIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi8J+SnSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjYXB0aW9uX2ZpZWxkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50eXBlX3RleHQocmFuZG9tLmNob2ljZShmYWxsYmFja19jYXB0aW9ucykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBmaWxlIGNhcHRpb25zLCBz4butIGThu6VuZyBlbW9qaSBmYWxsYmFjayIpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIMSR4buNYyBmaWxlIGNhcHRpb25zOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIHbhu4EgZW1vamkgbuG6v3UgY8OzIGzhu5dpCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbGxiYWNrX2NhcHRpb25zID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfjJ8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIuKcqCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfmYIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfk7giCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGNhcHRpb25fZmllbGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnR5cGVfdGV4dChyYW5kb20uY2hvaWNlKGZhbGxiYWNrX2NhcHRpb25zKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAjIELGsOG7m2MgOTogTmjhuqVuIENoaWEgc+G6uyDEkeG7gyDEkcSDbmcgYsOgaQogICAgICAgICAgICBzaGFyZV9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHRleHQ9IkNoaWEgc+G6uyIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgaWYgbm90IHNoYXJlX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNoYXJlX2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJDaGlhIHPhursiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2hhcmVfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IENoaWEgc+G6uyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDMsIDUpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDEwOiBLaeG7g20gdHJhIMSRxINuZyB0aMOgbmggY8O0bmcgdsOgIHF1YXkgduG7gSBob21lCiAgICAgICAgICAgICMgQ8OzIHRo4buDIGPDsyBwb3B1cCAiUG9zdCBzaGFyZWQiIGhv4bq3YyB04buxIMSR4buZbmcgduG7gSBmZWVkCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9rX2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQodGV4dD0iT0siLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICBpZiBub3Qgb2tfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQodGV4dD0iWG9uZyIsIHRpbWVvdXQ9MykKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgUXVheSB24buBIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSB0aOG7nWkgZ2lhbiDEkcSDbmcg4bqjbmggdGjDoG5oIGPDtG5nIHbDoG8gREIKICAgICAgICAgICAgaWYgYWNjb3VudF9pZDoKICAgICAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0X2FjY291bnRfbGFzdF9wb3N0X3RpbWUoYWNjb3VudF9pZCwgc2VsZi5hcHBfbmFtZSwgY3VycmVudF90aW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQxINuZyDhuqNuaCB0aMOgbmggY8O0bmcgY2hvIHTDoGkga2hv4bqjbjoge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSDEkcSDbmcg4bqjbmg6IHtlfSIpCiAgICAgICAgICAgICMgVGjhu60gcXVheSB24buBIHRyYW5nIGNo4bunIG7hur91IGPDsyBs4buXaQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2goc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGPDoWMgdGhhbyB0w6FjIFVJIMSR4buDIGNodXnhu4NuIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXJnZXRfYWNjb3VudDogVMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuIMSR4bq/bgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogewogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBib29sLAogICAgICAgICAgICAgICAgJ3JlYXNvbic6IHN0ciAobuG6v3UgdGjhuqV0IGLhuqFpKSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJzogc3RyCiAgICAgICAgICAgIH0KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgdGjDtG5nIHRpbiB0YXJnZXQgYWNjb3VudAogICAgICAgICAgICB0YXJnZXRfdXNlcm5hbWUgPSB0YXJnZXRfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRfdXNlcm5hbWU6CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdpbnZhbGlkX2FjY291bnQnLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogJ1RhcmdldCBhY2NvdW50IGtow7RuZyBjw7MgdW5pcXVlX3VzZXJuYW1lJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ25hdmlnYXRpb25fZXJyb3InLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogJ0tow7RuZyB0aOG7gyDEkeG6v24gdHJhbmcgY2jhu6cgSW5zdGFncmFtJwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgI2tp4buDbSB0cmEgxJHDum5nIHVzZXJuYW1lIHLhu5NpIHRow6wgcmV0dXJuIHRydWUKICAgICAgICAgICAgaWYgc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9ZiJAe3RhcmdldF91c2VybmFtZX0iKToKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZiLEkMOjIGNodXnhu4NuIHNhbmcgdMOgaSBraG/huqNuIEluc3RhZ3JhbToge3RhcmdldF91c2VybmFtZX0iCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAjIE5o4bqlbiB2w6BvIHRhYiAiVHJhbmcgY8OhIG5ow6JuIgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgcHJvZmlsZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBwcm9maWxlX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFRyYW5nIGPDoSBuaMOibiIpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAndWlfZXJyb3InLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogJ0tow7RuZyB0w6xtIHRo4bqleSB0YWIgVHJhbmcgY8OhIG5ow6JuJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVwIHbDoG8gdGFiIFRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocHJvZmlsZV90YWIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHVzZXJuYW1lIHThu6sgdGnDqnUgxJHhu4EgbOG7m24gdHJvbmcgYWN0aW9uIGJhcgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfbGFyZ2VfdGl0bGVfYXV0b19zaXplIgogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHVzZXJuYW1lX3RpdGxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl90aXRsZSIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX3RpdGxlOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICB1c2VybmFtZV90aXRsZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX2xhcmdlX3RpdGxlX2F1dG9fc2l6ZSIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGnDqnUgxJHhu4EgdXNlcm5hbWUiKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ3VpX2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICdLaMO0bmcgdMOsbSB0aOG6pXkgdGnDqnUgxJHhu4EgdXNlcm5hbWUnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6pXAgdsOgbyB0acOqdSDEkeG7gSB1c2VybmFtZSDEkeG7gyBt4bufIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih1c2VybmFtZV90aXRsZSkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHTDqm4gdMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuIMSR4bq/bgogICAgICAgICAgICB0YXJnZXRfdXNlcm5hbWUgPSB0YXJnZXRfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIsICIiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHRy4buxYyB0aeG6v3AgdMOgaSBraG/huqNuIHRoZW8gdGV4dCAoY8OhY2ggxJHGoW4gZ2nhuqNuIG5o4bqldCkKICAgICAgICAgICAgYWNjb3VudHNfeG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgdGFyZ2V0X2l0ZW0gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKGFjY291bnRzX3htbCwgdGV4dD10YXJnZXRfdXNlcm5hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSwgdnXhu5F0IGzDqm4gdsOgIHTDrG0gbOG6oWkKICAgICAgICAgICAgaWYgbm90IHRhcmdldF9pdGVtOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0g4bufIGzhuqduIMSR4bqndSwgdnXhu5F0IGzDqm4gdsOgIHTDrG0gbOG6oWkiKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgbOG6oWkgWE1MIHbDoCB0w6xtIGzhuqFpCiAgICAgICAgICAgICAgICBhY2NvdW50c194bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgdGFyZ2V0X2l0ZW0gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKGFjY291bnRzX3htbCwgdGV4dD10YXJnZXRfdXNlcm5hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgdGFyZ2V0X2l0ZW06CiAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gdGhlbyBjb250ZW50LWRlc2MgKGPDsyB0aOG7gyBjaOG7qWEgdGjDtG5nIGLDoW8pCiAgICAgICAgICAgICAgICB0YXJnZXRfaXRlbXMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoYWNjb3VudHNfeG1sLCBjbGFzc19uYW1lPSJhbmRyb2lkLnZpZXcuVmlld0dyb3VwIikKICAgICAgICAgICAgICAgIGZvciBpdGVtIGluIHRhcmdldF9pdGVtczoKICAgICAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBpdGVtLmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0X3VzZXJuYW1lIGluIGNvbnRlbnRfZGVzYyBhbmQgIlRow6ptIHTDoGkga2hv4bqjbiIgbm90IGluIGNvbnRlbnRfZGVzYyBhbmQgIlRydW5nIHTDom0gdMOgaSBraG/huqNuIiBub3QgaW4gY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfaXRlbSA9IGl0ZW0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRfaXRlbToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSB0cm9uZyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMSQw6FuaCBk4bqldSB0w6BpIGtob+G6o24gbMOgIGLhu4sgdsO0IGhp4buHdSBow7NhIHRyb25nIERCCiAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KHRhcmdldF9hY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJkaXNhYmxlZCIsCiAgICAgICAgICAgICAgICAgICAgImRpc2FibGVfcmVhc29uIjogIlTDoGkga2hv4bqjbiBraMO0bmcgY8OzIHRyw6puIHRoaeG6v3QgYuG7iyIsCiAgICAgICAgICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogaW50KHRpbWUudGltZSgpKSwKICAgICAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5o4bqlbiBCYWNrIMSR4buDIMSRw7NuZyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBRdWF5IHbhu4EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ2FjY291bnRfbm90X2ZvdW5kJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IGYnS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSB0cm9uZyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6pXAgdsOgbyB0w6BpIGtob+G6o24gbeG7pWMgdGnDqnUKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHRhcmdldF9pdGVtKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHNhZmVfc2xlZXAgcmV0dXJuIHZhbHVlIMSR4buDIGPDsyB0aOG7gyB0aG/DoXQgc+G7m20KICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCg1KTogICMgxJDhu6NpIGNodXnhu4NuIHTDoGkga2hv4bqjbiBob8OgbiB04bqldAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTmjhuq1uIMSRxrDhu6NjIHnDqnUgY+G6p3UgZOG7q25nIHRyb25nIHN3aXRjaF90b19hY2NvdW50IikKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdpbnRlcnJ1cHRlZCcsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnQuG7iyBk4burbmcgdHJvbmcgcXXDoSB0csOsbmggY2h1eeG7g24gdMOgaSBraG/huqNuJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIGNodXnhu4NuIHTDoGkga2hv4bqjbiB0aMOgbmggY8O0bmcgY2jGsGEKICAgICAgICAgICAgY3VycmVudF91c2VybmFtZSA9IHNlbGYuZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGN1cnJlbnRfdXNlcm5hbWUgPT0gdGFyZ2V0X3VzZXJuYW1lOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgY2h1eeG7g24gdMOgaSBraG/huqNuIHRow6BuaCBjw7RuZyBzYW5nIHt0YXJnZXRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLCAKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IGYnxJDDoyBjaHV54buDbiB0w6BpIGtob+G6o24gdGjDoG5oIGPDtG5nIHNhbmcge3RhcmdldF91c2VybmFtZX0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIsSQw6MgYuG6pW0gdsOgbyB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gbmjGsG5nIGtp4buDbSB0cmEgbOG6oWkgdGjhuqV5IMSRYW5nIMSRxINuZyBuaOG6rXAgbMOgIHtjdXJyZW50X3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAnc3dpdGNoX3ZlcmlmaWNhdGlvbl9mYWlsZWQnLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZifEkMOjIGLhuqVtIHbDoG8gdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IG5oxrBuZyBraeG7g20gdHJhIGzhuqFpIHRo4bqleSDEkWFuZyDEkcSDbmcgbmjhuq1wIGzDoCB7Y3VycmVudF91c2VybmFtZX0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgY2h1eeG7g24gdMOgaSBraG/huqNuIEluc3RhZ3JhbSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdleGNlcHRpb24nLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBmJ0zhu5dpIGtoaSBjaHV54buDbiB0w6BpIGtob+G6o24gSW5zdGFncmFtOiB7c3RyKGUpfScKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgIGRlZiBnZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoc2VsZikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB1c2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0ciBob+G6t2MgTm9uZTogVXNlcm5hbWUgY+G7p2EgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAsIGhv4bq3YyBOb25lIG7hur91IGtow7RuZyBjw7MKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICAjIEPDoWNoIDE6IMSQ4buNYyB04burIGF2YXRhcl9pbWFnZV92aWV3IOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgYXZhdGFyX3ZpZXcgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYXZhdGFyX2ltYWdlX3ZpZXciKQogICAgICAgICAgICBpZiBhdmF0YXJfdmlldzoKICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYyA9IGF2YXRhcl92aWV3LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgICAgICAjIGNvbnRlbnQtZGVzYyBk4bqhbmc6ICJUaW4gY+G7p2EgbmdvdGhpeWVuMjYwMTAwNTksIDAvMSwgQ2jGsGEgeGVtIgogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGFuZCAiVGluIGPhu6dhICIgaW4gY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBjb250ZW50X2Rlc2Muc3BsaXQoIlRpbiBj4bunYSAiLCAxKVsxXS5zcGxpdCgiLCIsIDEpWzBdLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBs4bqleSB1c2VybmFtZSB04burIHRyYW5nIGNo4bunOiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VybmFtZQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBj4bqvdCBjaHXhu5dpIGzhuqV5IHVzZXJuYW1lIHThu6sgY29udGVudC1kZXNjOiB7ZX0iKQoKICAgICAgICAgICAgIyBDw6FjaCAyOiBO4bq/dSBraMO0bmcgdGjDoG5oIGPDtG5nIOG7nyBjw6FjaCAxLCB0aOG7rSB2w6BvIHRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgbOG6pXkgxJHGsOG7o2MgdXNlcm5hbWUgdOG7qyB0cmFuZyBjaOG7pywgdGjhu60gdsOgbyB0cmFuZyBjw6EgbmjDom4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6pW4gdsOgbyB0YWIgIlRyYW5nIGPDoSBuaMOibiIKICAgICAgICAgICAgcHJvZmlsZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgaWYgbm90IHByb2ZpbGVfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSB0YWIgVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocHJvZmlsZV90YWIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQoKICAgICAgICAgICAgIyDEkOG7jWMgdXNlcm5hbWUgdOG7qyB0acOqdSDEkeG7gSBs4bubbiB0cm9uZyBhY3Rpb24gYmFyCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICB1c2VybmFtZV90aXRsZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9sYXJnZV90aXRsZV9hdXRvX3NpemUiCiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX3RpdGxlOgogICAgICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX3RpdGxlIgogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9sYXJnZV90aXRsZV9hdXRvX3NpemUiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh1c2VybmFtZV90aXRsZSkKICAgICAgICAgICAgICAgICMgUXVheSBs4bqhaSB0cmFuZyBjaOG7pwogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgbOG6pXkgdXNlcm5hbWUgdOG7qyB0cmFuZyBjw6EgbmjDom46IHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJuYW1lCgogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSB0acOqdSDEkeG7gSwgdGjhu60gdMOsbSBiaeG7g3UgdMaw4bujbmcgdHJhbmcgY8OhIG5ow6JuIGtow6FjCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSB0acOqdSDEkeG7gSB1c2VybmFtZSwgdGjhu60gdMOsbSB0aGVvIGPDoWNoIGtow6FjIikKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgdXNlcm5hbWUgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAiKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICBkZWYgZ2V0X2pvYl9wYXJhbXMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRoYW0gc+G7kSDEkeG7gyBn4buNaSBBUEkgbOG6pXkgam9iIGNobyBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogVGhhbSBz4buRCiAgICAgICAgIiIiCiAgICAgICAgZ29saWtlX2lkID0gYWNjb3VudC5nZXQoImdvbGlrZV9pZCIpCiAgICAgICAgaWYgbm90IGdvbGlrZV9pZDoKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJpbnN0YWdyYW1fYWNjb3VudF9pZCI6IGdvbGlrZV9pZCwKICAgICAgICAgICAgImRhdGEiOiAibnVsbCIKICAgICAgICB9CiAgICAKICAgICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICMgQ0FSRSBBQ1RJT05TIElNUExFTUVOVEFUSU9OIChBQlNUUkFDVCBNRVRIT0RTIEZST00gQkFTRSkKICAgICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIAogICAgZGVmIHBlcmZvcm1fbmV3c2ZlZWRfYWN0aW9uKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIlRo4buxYyBoaeG7h24gdnXhu5F0IG5ld3NmZWVkIEluc3RhZ3JhbSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBT4butIGThu6VuZyBtZXRob2QgY8OzIHPhurVuIF9jYXJlX3N3aXBlX2ZlZWQKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NhcmVfc3dpcGVfZmVlZChhY2NvdW50KQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kgcGVyZm9ybV9uZXdzZmVlZF9hY3Rpb246IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcGVyZm9ybV9yZWVsc19hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiVGjhu7FjIGhp4buHbiB4ZW0gcmVlbHMgSW5zdGFncmFtIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFPhu60gZOG7pW5nIG1ldGhvZCBjw7Mgc+G6tW4gX2NhcmVfd2F0Y2hfcmVlbHMKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NhcmVfd2F0Y2hfcmVlbHMoYWNjb3VudCkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIHBlcmZvcm1fcmVlbHNfYWN0aW9uOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHBlcmZvcm1fbm90aWZpY2F0aW9uX2FjdGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJUaOG7sWMgaGnhu4duIHhlbSB0aMO0bmcgYsOhbyBJbnN0YWdyYW0iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgU+G7rSBk4bulbmcgbWV0aG9kIGPDsyBz4bq1biBfY2FyZV92aWV3X25vdGlmaWNhdGlvbnMKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NhcmVfdmlld19ub3RpZmljYXRpb25zKGFjY291bnQpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBwZXJmb3JtX25vdGlmaWNhdGlvbl9hY3Rpb246IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcGVyZm9ybV9wcm9maWxlX2FjdGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJUaOG7sWMgaGnhu4duIHhlbSBwcm9maWxlIEluc3RhZ3JhbSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBOYXZpZ2F0ZSDEkeG6v24gcHJvZmlsZSB0YWIKICAgICAgICAgICAgcHJvZmlsZV90YWIgPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9wcm9maWxlX3RhYiIsIHRpbWVvdXQ9NQogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIHByb2ZpbGVfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2ZpbGVfdGFiKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDMsIDcpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFNjcm9sbCB0cm9uZyBwcm9maWxlCiAgICAgICAgICAgICAgICBzY3JvbGxfY291bnQgPSByYW5kb20ucmFuZGludCgyLCA1KQogICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2Uoc2Nyb2xsX2NvdW50KToKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMikpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBwZXJmb3JtX3Byb2ZpbGVfYWN0aW9uOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHBlcmZvcm1fZXhwbG9yZV9hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiVGjhu7FjIGhp4buHbiBraMOhbSBwaMOhIEluc3RhZ3JhbSAoRXhwbG9yZS9TZWFyY2ggdGFiKSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBOYXZpZ2F0ZSDEkeG6v24gc2VhcmNoL2V4cGxvcmUgdGFiCiAgICAgICAgICAgIHNlYXJjaF90YWIgPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9zZWFyY2hfdGFiIiwgdGltZW91dD01CiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgc2VhcmNoX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWFyY2hfdGFiKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU2Nyb2xsIHRyb25nIGV4cGxvcmUgZmVlZAogICAgICAgICAgICAgICAgc2Nyb2xsX2NvdW50ID0gcmFuZG9tLnJhbmRpbnQoNSwgMTUpCiAgICAgICAgICAgICAgICBmb3IgXyBpbiByYW5nZShzY3JvbGxfY291bnQpOgogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMykpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBwZXJmb3JtX2V4cGxvcmVfYWN0aW9uOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHBlcmZvcm1fc2VhcmNoX2FjdGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJUaOG7sWMgaGnhu4duIHTDrG0ga2nhur9tIEluc3RhZ3JhbSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBOYXZpZ2F0ZSDEkeG6v24gc2VhcmNoIHRhYgogICAgICAgICAgICBzZWFyY2hfdGFiID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudCgKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvc2VhcmNoX3RhYiIsIHRpbWVvdXQ9NQogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIHNlYXJjaF90YWI6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX3RhYikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gc2VhcmNoIGJveAogICAgICAgICAgICAgICAgc2VhcmNoX2JveCA9IHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX3NlYXJjaF9lZGl0X3RleHQiLCB0aW1lb3V0PTUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIHNlYXJjaF9ib3g6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF9ib3gpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBHaeG6oyBs4bqtcCBzZWFyY2gKICAgICAgICAgICAgICAgICAgICBzZWFyY2hfdGVybXMgPSBbInRyYXZlbCIsICJmb29kIiwgImZhc2hpb24iLCAicGhvdG9ncmFwaHkiLCAiYXJ0Il0KICAgICAgICAgICAgICAgICAgICBzZWFyY2hfdGVybSA9IHJhbmRvbS5jaG9pY2Uoc2VhcmNoX3Rlcm1zKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmlucHV0X3RleHQoc2VhcmNoX3Rlcm0pCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfZW50ZXIoKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgU2Nyb2xsIGvhur90IHF14bqjCiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsX2NvdW50ID0gcmFuZG9tLnJhbmRpbnQoMywgOCkKICAgICAgICAgICAgICAgICAgICBmb3IgXyBpbiByYW5nZShzY3JvbGxfY291bnQpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDEsIDIpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBwZXJmb3JtX3NlYXJjaF9hY3Rpb246IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAKICAgICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICMgQVBQIE1BTkFHRU1FTlQgSU1QTEVNRU5UQVRJT04gKEFCU1RSQUNUIE1FVEhPRFMgRlJPTSBCQVNFKQogICAgIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgCiAgICBkZWYgb3Blbl9hcHAoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiJN4bufIEluc3RhZ3JhbSBhcHAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBhcHAgxJHDoyBt4bufIGNoxrBhCiAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICByZXR1cm4gY3VycmVudF9wYWNrYWdlID09IHNlbGYuYXBwX3BhY2thZ2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIG9wZW5fYXBwIEluc3RhZ3JhbToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBlbnN1cmVfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiLEkOG6o20gYuG6o28gxJFhbmcg4bufIG3DoG4gaMOsbmggaG9tZSBJbnN0YWdyYW0iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQsaw4bubYyAxOiBLaeG7g20gdHJhIGFwcCBjw7MgxJFhbmcgbeG7nyBraMO0bmcKICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkFwcCBJbnN0YWdyYW0gY2jGsGEgbeG7nyAoaGnhu4duIHThuqFpOiB7Y3VycmVudF9wYWNrYWdlfSksIMSRYW5nIG3hu58gYXBwLi4uIikKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLm9wZW5fYXBwKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBt4bufIEluc3RhZ3JhbSBhcHAiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDI6IEtp4buDbSB0cmEgeGVtIMSRw6Mg4bufIGhvbWUgc2NyZWVuIGNoxrBhCiAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCLEkMOjIOG7nyBtw6BuIGjDrG5oIGhvbWUgSW5zdGFncmFtIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELGsOG7m2MgMzogTuG6v3UgY2jGsGEg4bufIGhvbWUgc2NyZWVuLCBz4butIGThu6VuZyBtZXRob2QgY8OzIHPhurVuIGJhY2tfdG9faG9tZQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJDaMawYSDhu58gbcOgbiBow6xuaCBob21lLCDEkWFuZyBuYXZpZ2F0ZSB24buBIGhvbWUuLi4iKQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdiYWNrX3RvX2hvbWUnKToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEZhbGxiYWNrOiB0w6xtIHbDoCB0YXAgaG9tZSB0YWIKICAgICAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudCgKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2ZlZWRfdGFiIiwgdGltZW91dD01CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiBob21lX3RhYjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaG9tZV90YWIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHhlbSDEkcOjIHbhu4EgaG9tZSBjaMawYQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmlzX2hvbWVfc2NyZWVuKCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IGhvbWUgdGFiIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGVuc3VyZV9ob21lX3NjcmVlbiBJbnN0YWdyYW06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcGVyZm9ybV9zdG9yeV9hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQWN0aW9uIHJpw6puZyBj4bunYSBJbnN0YWdyYW06IFhlbSBzdG9yaWVzCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVzZXJuYW1lID0gYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJYZW0gc3RvcmllcyBJbnN0YWdyYW0gY2hvIHt1c2VybmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28g4bufIGhvbWUgc2NyZWVuCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIMSR4bqjbSBi4bqjbyBob21lIHNjcmVlbiIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBraHUgduG7sWMgc3RvcmllcyDhu58gxJHhuqd1IGZlZWQKICAgICAgICAgICAgc3Rvcnlfc2VsZWN0b3JzID0gWwogICAgICAgICAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiWW91ciBzdG9yeSJ9LAogICAgICAgICAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiU3RvcnkifSwKICAgICAgICAgICAgICAgIHsidGV4dCI6ICJUaW4gY+G7p2EgYuG6oW4ifSwKICAgICAgICAgICAgICAgIHsidGV4dCI6ICJZb3VyIHN0b3J5In0sCiAgICAgICAgICAgICAgICB7InJlc291cmNlX2lkIjogImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9yZWVsX3JpbmdfdmlldyJ9CiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgIHN0b3J5X2ZvdW5kID0gRmFsc2UKICAgICAgICAgICAgZm9yIHNlbGVjdG9yIGluIHN0b3J5X3NlbGVjdG9yczoKICAgICAgICAgICAgICAgIGlmIHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoKipzZWxlY3RvciwgdGltZW91dD0zKToKICAgICAgICAgICAgICAgICAgICAjIFRhcCB2w6BvIHN0b3J5IMSR4bqndSB0acOqbgogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsaWNrX2VsZW1lbnQoKipzZWxlY3RvcikKICAgICAgICAgICAgICAgICAgICBzdG9yeV9mb3VuZCA9IFRydWUKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIGNsaWNrIHbDoG8gc3RvcnkiKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc3RvcnlfZm91bmQ6CiAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSBzdG9yeSBzZWxlY3RvciwgdGjhu60gdGFwIHbDoG8gdsO5bmcgc3RvcnkgdGjDtG5nIHRoxrDhu51uZwogICAgICAgICAgICAgICAgIyBTdG9yaWVzIHRoxrDhu51uZyDhu58gxJHhuqd1IGZlZWQsIHRyb25nIHbDuW5nIG5nYW5nCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgc3Rvcnkgc2VsZWN0b3IsIHRo4butIHRhcCB2w6BvIHbDuW5nIHN0b3J5IikKICAgICAgICAgICAgICAgICMgVGFwIHbDoG8gdsO5bmcgc3RvcnkgKHBo4bqnbiB0csOqbiBj4bunYSBtw6BuIGjDrG5oKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX3NjcmVlbigyMDAsIDIwMCkgICMgVsO5bmcgc3RvcnkgdGjGsOG7nW5nIOG7nyDEkcOieQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIG3hu58gc3Rvcnkga2jDtG5nCiAgICAgICAgICAgICAgICBzdG9yeV9pbmRpY2F0b3JzID0gWwogICAgICAgICAgICAgICAgICAgIHsiY29udGVudF9kZXNjIjogIlBhdXNlIn0sCiAgICAgICAgICAgICAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiTmV4dCBzdG9yeSJ9LAogICAgICAgICAgICAgICAgICAgIHsidGV4dCI6ICJZb3VyIHN0b3J5In0sCiAgICAgICAgICAgICAgICAgICAgeyJyZXNvdXJjZV9pZCI6ICJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcmVlbF92aWV3ZXJfbWVkaWFfbGF5b3V0In0KICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIGluZGljYXRvciBpbiBzdG9yeV9pbmRpY2F0b3JzOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoKippbmRpY2F0b3IsIHRpbWVvdXQ9Mik6CiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3J5X2ZvdW5kID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3RvcnlfZm91bmQ6CiAgICAgICAgICAgICAgICAjIFhlbSBzdG9yaWVzIHRyb25nIG3hu5l0IGtob+G6o25nIHRo4budaSBnaWFuCiAgICAgICAgICAgICAgICBzdG9yeV9jb3VudCA9IHJhbmRvbS5yYW5kaW50KDIsIDUpICAjIFhlbSAyLTUgc3RvcmllcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShzdG9yeV9jb3VudCk6CiAgICAgICAgICAgICAgICAgICAgIyBYZW0gc3RvcnkgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICAgICAgdmlld19kdXJhdGlvbiA9IHJhbmRvbS51bmlmb3JtKDMsIDgpICAjIDMtOCBnacOieSBt4buXaSBzdG9yeQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJYZW0gc3Rvcnkge2krMX0ve3N0b3J5X2NvdW50fSB0cm9uZyB7dmlld19kdXJhdGlvbjouMWZ9IGdpw6J5IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEPDsyB0aOG7gyB0xrDGoW5nIHTDoWMgbmjhurkgduG7m2kgc3RvcnkKICAgICAgICAgICAgICAgICAgICBpZiByYW5kb20ucmFuZG9tKCkgPCAwLjI6ICAjIDIwJSBjxqEgaOG7mWkgdMawxqFuZyB0w6FjCiAgICAgICAgICAgICAgICAgICAgICAgICMgVGFwIG5o4bq5IOG7nyBnaeG7r2EgbcOgbiBow6xuaCAoa2jDtG5nIHBo4bqjaSB2w7luZyBjaHV54buDbiBzdG9yeSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX3NjcmVlbihyYW5kb20ucmFuZGludCgzMDAsIDcwMCksIHJhbmRvbS5yYW5kaW50KDQwMCwgODAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAodmlld19kdXJhdGlvbikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENodXnhu4NuIHNhbmcgc3RvcnkgdGnhur9wIHRoZW8gKHRhcCBiw6puIHBo4bqjaSBtw6BuIGjDrG5oKQogICAgICAgICAgICAgICAgICAgIGlmIGkgPCBzdG9yeV9jb3VudCAtIDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9zY3JlZW4oODAwLCA0MDApICAjIFRhcCBiw6puIHBo4bqjaSDEkeG7gyBuZXh0IHN0b3J5CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFF1YXkgduG7gSBmZWVkIGLhurFuZyBjw6FjaCBuaOG6pW4gYmFjayBob+G6t2Mgc3dpcGUgZG93bgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuZ29fYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkhvw6BuIHRow6BuaCB4ZW0gc3RvcmllcyBJbnN0YWdyYW0gY2hvIHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBzdG9yaWVzIMSR4buDIHhlbSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB4ZW0gc3RvcmllcyBJbnN0YWdyYW06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICByZXR1cm4gRmFsc2U=').decode('utf-8'))
