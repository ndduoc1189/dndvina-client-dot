import base64
exec(base64.b64decode('aW1wb3J0IHNxbGl0ZTMKaW1wb3J0IGpzb24KaW1wb3J0IG9zCmltcG9ydCB0aW1lCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IHV1aWQKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgTGlzdCwgT3B0aW9uYWwsIFVuaW9uCmltcG9ydCBjb25maWcKCmNsYXNzIERhdGFiYXNlU2VydmljZToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9wYXRoOiBzdHIgPSAiZGF0YS5kYiIsIGRlZmF1bHRfY29uZmlnX3BhdGg6IHN0ciA9ICJkZWZhdWx0Q29uZmlnLmpzb24iKToKICAgICAgICBzZWxmLmRiX3BhdGggPSBkYl9wYXRoCiAgICAgICAgc2VsZi5kZWZhdWx0X2NvbmZpZ19wYXRoID0gZGVmYXVsdF9jb25maWdfcGF0aAogICAgICAgIHNlbGYubG9jYWwgPSB0aHJlYWRpbmcubG9jYWwoKSAgIyBMxrB1IHRy4buvIHJpw6puZyBjaG8gbeG7l2kgdGhyZWFkCiAgICAgICAgCiAgICAgICAgIyBU4bqhbyBi4bqjbmcgbuG6v3UgY2jGsGEgdOG7k24gdOG6oWkKICAgICAgICBzZWxmLl9pbml0X2RiKCkKICAgICAgICAKICAgIGRlZiBfZ2V0X2Nvbm5lY3Rpb24oc2VsZik6CiAgICAgICAgIiIiTOG6pXkga+G6v3QgbuG7kWkgU1FMaXRlIGNobyB0aHJlYWQgaGnhu4duIHThuqFpIiIiCiAgICAgICAgaWYgbm90IGhhc2F0dHIoc2VsZi5sb2NhbCwgJ2Nvbm4nKSBvciBzZWxmLmxvY2FsLmNvbm4gaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5sb2NhbC5jb25uID0gc3FsaXRlMy5jb25uZWN0KHNlbGYuZGJfcGF0aCkKICAgICAgICByZXR1cm4gc2VsZi5sb2NhbC5jb25uCiAgICAgICAgCiAgICBkZWYgX2luaXRfZGIoc2VsZik6CiAgICAgICAgIiIiS2jhu59pIHThuqFvIGPhuqV1IHRyw7pjIGRhdGFiYXNlIG7hur91IGNoxrBhIHThu5NuIHThuqFpIiIiCiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChzZWxmLmRiX3BhdGgpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgICMgVOG6oW8gYuG6o25nIGNvbmZpZwogICAgICAgIGN1cnNvci5leGVjdXRlKCcnJwogICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGNvbmZpZyAoCiAgICAgICAgICAgIGtleSBURVhUIFBSSU1BUlkgS0VZLAogICAgICAgICAgICB2YWx1ZSBURVhUCiAgICAgICAgKQogICAgICAgICcnJykKICAgICAgICAKICAgICAgICAjIFThuqFvIGLhuqNuZyBhY2NvdW50IHbhu5tpIHV1aWQKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgnJycKICAgICAgICBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBhY2NvdW50cyAoCiAgICAgICAgICAgIGlkIElOVEVHRVIgUFJJTUFSWSBLRVksCiAgICAgICAgICAgIGFjY291bnRfdXVpZCBURVhUIFVOSVFVRSwKICAgICAgICAgICAgYXBwIFRFWFQsCiAgICAgICAgICAgIG5pY2tuYW1lIFRFWFQsCiAgICAgICAgICAgIHVuaXF1ZV9pZCBURVhULAogICAgICAgICAgICB1bmlxdWVfdXNlcm5hbWUgVEVYVCwKICAgICAgICAgICAgc3RhdHVzIFRFWFQsCiAgICAgICAgICAgIGluYWN0aXZlX3JlYXNvbiBURVhULAogICAgICAgICAgICBpc19sb2dpbiBJTlRFR0VSLAogICAgICAgICAgICBhdmF0YXJfdGh1bWIgVEVYVCwKICAgICAgICAgICAgdG90YWxfam9icyBJTlRFR0VSLAogICAgICAgICAgICBqb2JfZW5hYmxlIElOVEVHRVIsCiAgICAgICAgICAgIGpvYl9kaXNhYmxlX3VudGlsIElOVEVHRVIsCiAgICAgICAgICAgIGpvYl90b2RheSBJTlRFR0VSLAogICAgICAgICAgICBqb2JfbWF4X2RheSBJTlRFR0VSLAogICAgICAgICAgICBqb2JzX2RvbmVfaW5fc2Vzc2lvbiBJTlRFR0VSLAogICAgICAgICAgICBtYXhfam9ic19wZXJfc2Vzc2lvbiBJTlRFR0VSLAogICAgICAgICAgICBsYXN0X2pvYl90aW1lIElOVEVHRVIsCiAgICAgICAgICAgIGxhc3RfdXBkYXRlIElOVEVHRVIsCiAgICAgICAgICAgIGNhcmVfdG9kYXkgSU5URUdFUiwKICAgICAgICAgICAgaXNfZ29saWtlX2xpbmtlZCBJTlRFR0VSIERFRkFVTFQgMCwKICAgICAgICAgICAgZ29saWtlX2lkIFRFWFQsCiAgICAgICAgICAgIGRldmljZV9pZCBURVhULAogICAgICAgICAgICBpc19zeW5jIElOVEVHRVIgREVGQVVMVCAwLAogICAgICAgICAgICBkaXNhYmxlX2ZvbGxvdyBJTlRFR0VSIERFRkFVTFQgMCwKICAgICAgICAgICAgZm9sbG93X2Rpc2FibGVfdW50aWwgSU5URUdFUiBERUZBVUxUIDAsCiAgICAgICAgICAgIGZvbGxvd190b2RheSBJTlRFR0VSIERFRkFVTFQgMCwKICAgICAgICAgICAgZm9sbG93X2luX3Nlc3Npb24gSU5URUdFUiBERUZBVUxUIDAsCiAgICAgICAgICAgIG1heF9mb2xsb3dfZGF5IElOVEVHRVIgREVGQVVMVCAyMCwKICAgICAgICAgICAgbWF4X2ZvbGxvd19zZXNzaW9uIElOVEVHRVIgREVGQVVMVCA1LAogICAgICAgICAgICBsYXN0X2ZvbGxvd190aW1lIElOVEVHRVIgREVGQVVMVCAwLAogICAgICAgICAgICBpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIFRFWFQsCiAgICAgICAgICAgIGRhdGEgVEVYVAogICAgICAgICkKICAgICAgICAnJycpCiAgICAgICAgCiAgICAgICAgIyBU4bqhbyBi4bqjbmcgam9ic19oaXN0b3J5IMSR4buDIGzGsHUgbOG7i2NoIHPhu60gam9iCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoJycnCiAgICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgam9ic19oaXN0b3J5ICgKICAgICAgICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSwKICAgICAgICAgICAgam9iX3V1aWQgVEVYVCBVTklRVUUsCiAgICAgICAgICAgIGFjY291bnRfdXVpZCBURVhULAogICAgICAgICAgICBkZXZpY2VfaWQgVEVYVCwKICAgICAgICAgICAgYXBwIFRFWFQsCiAgICAgICAgICAgIGpvYl9pZCBURVhULAogICAgICAgICAgICBqb2JfdHlwZSBURVhULAogICAgICAgICAgICBvYmplY3RfaWQgVEVYVCwKICAgICAgICAgICAgbGluayBURVhULAogICAgICAgICAgICBzdGF0dXMgSU5URUdFUiBERUZBVUxUIDAsCiAgICAgICAgICAgIHN1Y2Nlc3MgSU5URUdFUiBERUZBVUxUIDAsCiAgICAgICAgICAgIHByaWNlIFJFQUwgREVGQVVMVCAwLAogICAgICAgICAgICBlcnJvcl9tZXNzYWdlIFRFWFQsCiAgICAgICAgICAgIGNyZWF0ZWRfYXQgSU5URUdFUiwKICAgICAgICAgICAgbGFzdF91cGRhdGUgSU5URUdFUiwKICAgICAgICAgICAgaXNfc3luYyBJTlRFR0VSIERFRkFVTFQgMCwKICAgICAgICAgICAgZGF0YSBURVhUCiAgICAgICAgKQogICAgICAgICcnJykKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgdsOgIHRow6ptIGPhu5l0IGFjY291bnRfdXVpZCBu4bq/dSBjaMawYSB04buTbiB04bqhaQogICAgICAgIGN1cnNvci5leGVjdXRlKCJQUkFHTUEgdGFibGVfaW5mbyhhY2NvdW50cykiKQogICAgICAgIGNvbHVtbnMgPSBbcm93WzFdIGZvciByb3cgaW4gY3Vyc29yLmZldGNoYWxsKCldCiAgICAgICAgaWYgImFjY291bnRfdXVpZCIgbm90IGluIGNvbHVtbnM6CiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJBTFRFUiBUQUJMRSBhY2NvdW50cyBBREQgQ09MVU1OIGFjY291bnRfdXVpZCBURVhUIFVOSVFVRSIpCiAgICAgICAgICAgICMgVOG6oW8gVVVJRCBjaG8gY8OhYyB0w6BpIGtob+G6o24gxJHDoyB04buTbiB04bqhaQogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGlkIEZST00gYWNjb3VudHMiKQogICAgICAgICAgICBhY2NvdW50cyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGFjY291bnRzOgogICAgICAgICAgICAgICAgYWNjb3VudF9pZCA9IGFjY291bnRbMF0KICAgICAgICAgICAgICAgIGFjY291bnRfdXVpZCA9IHN0cih1dWlkLnV1aWQ0KCkpCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiVVBEQVRFIGFjY291bnRzIFNFVCBhY2NvdW50X3V1aWQgPSA/IFdIRVJFIGlkID0gPyIsIChhY2NvdW50X3V1aWQsIGFjY291bnRfaWQpKQogICAgICAgICAgICBwcmludCgixJDDoyB0aMOqbSBj4buZdCBhY2NvdW50X3V1aWQgdsOgbyBi4bqjbmcgYWNjb3VudHMgdsOgIHThuqFvIFVVSUQgY2hvIGPDoWMgdMOgaSBraG/huqNuIGhp4buHbiBjw7MiKQogICAgICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgdsOgIHRow6ptIGPhu5l0IGlzX3N5bmMgbuG6v3UgY2jGsGEgdOG7k24gdOG6oWkKICAgICAgICBpZiAiaXNfc3luYyIgbm90IGluIGNvbHVtbnM6CiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJBTFRFUiBUQUJMRSBhY2NvdW50cyBBREQgQ09MVU1OIGlzX3N5bmMgSU5URUdFUiBERUZBVUxUIDAiKQogICAgICAgICAgICBwcmludCgixJDDoyB0aMOqbSBj4buZdCBpc19zeW5jIHbDoG8gYuG6o25nIGFjY291bnRzIikKICAgICAgICAKICAgICAgICAjIFThuqFvIHVuaXF1ZSBpbmRleCBjaG8gKGFwcCwgdW5pcXVlX3VzZXJuYW1lKSDEkeG7gyB0csOhbmggZHVwbGljYXRlIGFjY291bnRzCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiQ1JFQVRFIFVOSVFVRSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9hY2NvdW50c19hcHBfdXNlcm5hbWUgT04gYWNjb3VudHMoYXBwLCB1bmlxdWVfdXNlcm5hbWUpIikKICAgICAgICAgICAgcHJpbnQoIsSQw6MgdOG6oW8gdW5pcXVlIGluZGV4IGNobyAoYXBwLCB1bmlxdWVfdXNlcm5hbWUpIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICMgTuG6v3UgY8OzIGR1cGxpY2F0ZSBkYXRhLCBj4bqnbiBjbGVhbnVwIHRyxrDhu5tjCiAgICAgICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW8ga2hpIHThuqFvIHVuaXF1ZSBpbmRleDoge2V9IikKICAgICAgICAgICAgc2VsZi5fY2xlYW51cF9kdXBsaWNhdGVfYWNjb3VudHMoY3Vyc29yKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiQ1JFQVRFIFVOSVFVRSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9hY2NvdW50c19hcHBfdXNlcm5hbWUgT04gYWNjb3VudHMoYXBwLCB1bmlxdWVfdXNlcm5hbWUpIikKICAgICAgICAgICAgICAgIHByaW50KCLEkMOjIHThuqFvIHVuaXF1ZSBpbmRleCBjaG8gKGFwcCwgdW5pcXVlX3VzZXJuYW1lKSBzYXUga2hpIGNsZWFudXAiKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGUyOgogICAgICAgICAgICAgICAgcHJpbnQoZiJLaMO0bmcgdGjhu4MgdOG6oW8gdW5pcXVlIGluZGV4OiB7ZTJ9IikKICAgICAgICAKICAgICAgICAjIFRow6ptIGPhu5l0IGRpc2FibGVfZm9sbG93IG7hur91IGNoxrBhIGPDswogICAgICAgIGlmICJkaXNhYmxlX2ZvbGxvdyIgbm90IGluIGNvbHVtbnM6CiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJBTFRFUiBUQUJMRSBhY2NvdW50cyBBREQgQ09MVU1OIGRpc2FibGVfZm9sbG93IElOVEVHRVIgREVGQVVMVCAwIikKICAgICAgICAgICAgcHJpbnQoIsSQw6MgdGjDqm0gY+G7mXQgZGlzYWJsZV9mb2xsb3cgdsOgbyBi4bqjbmcgYWNjb3VudHMiKQogICAgICAgIAogICAgICAgICMgVGjDqm0gY+G7mXQgZm9sbG93X2Rpc2FibGVfdW50aWwgbuG6v3UgY2jGsGEgY8OzCiAgICAgICAgaWYgImZvbGxvd19kaXNhYmxlX3VudGlsIiBub3QgaW4gY29sdW1uczoKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIkFMVEVSIFRBQkxFIGFjY291bnRzIEFERCBDT0xVTU4gZm9sbG93X2Rpc2FibGVfdW50aWwgSU5URUdFUiBERUZBVUxUIDAiKQogICAgICAgICAgICBwcmludCgixJDDoyB0aMOqbSBj4buZdCBmb2xsb3dfZGlzYWJsZV91bnRpbCB2w6BvIGLhuqNuZyBhY2NvdW50cyIpCiAgICAgICAgCiAgICAgICAgIyBUaMOqbSBjw6FjIGPhu5l0IGZvbGxvdyB0cmFja2luZyBu4bq/dSBjaMawYSBjw7MKICAgICAgICBmb2xsb3dfY29sdW1ucyA9IFsKICAgICAgICAgICAgKCJmb2xsb3dfdG9kYXkiLCAiSU5URUdFUiBERUZBVUxUIDAiKSwKICAgICAgICAgICAgKCJmb2xsb3dfaW5fc2Vzc2lvbiIsICJJTlRFR0VSIERFRkFVTFQgMCIpLAogICAgICAgICAgICAoIm1heF9mb2xsb3dfZGF5IiwgIklOVEVHRVIgREVGQVVMVCAyMCIpLAogICAgICAgICAgICAoIm1heF9mb2xsb3dfc2Vzc2lvbiIsICJJTlRFR0VSIERFRkFVTFQgNSIpLAogICAgICAgICAgICAoImxhc3RfZm9sbG93X3RpbWUiLCAiSU5URUdFUiBERUZBVUxUIDAiKSwKICAgICAgICAgICAgKCJpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIiwgIlRFWFQiKQogICAgICAgIF0KICAgICAgICAKICAgICAgICBmb3IgY29sX25hbWUsIGNvbF90eXBlIGluIGZvbGxvd19jb2x1bW5zOgogICAgICAgICAgICBpZiBjb2xfbmFtZSBub3QgaW4gY29sdW1uczoKICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKGYiQUxURVIgVEFCTEUgYWNjb3VudHMgQUREIENPTFVNTiB7Y29sX25hbWV9IHtjb2xfdHlwZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIHRow6ptIGPhu5l0IHtjb2xfbmFtZX0gdsOgbyBi4bqjbmcgYWNjb3VudHMiKQogICAgICAgIAogICAgICAgICMgVGjDqm0gY8OhYyBj4buZdCBjYXJlIHRyYWNraW5nIG7hur91IGNoxrBhIGPDswogICAgICAgIGNhcmVfY29sdW1ucyA9IFsKICAgICAgICAgICAgKCJsYXN0X2NhcmVfdGltZSIsICJJTlRFR0VSIERFRkFVTFQgMCIpLAogICAgICAgICAgICAoImxhc3Rfdmlld19zdG9yaWVzIiwgIklOVEVHRVIgREVGQVVMVCAwIikKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIGNvbF9uYW1lLCBjb2xfdHlwZSBpbiBjYXJlX2NvbHVtbnM6CiAgICAgICAgICAgIGlmIGNvbF9uYW1lIG5vdCBpbiBjb2x1bW5zOgogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoZiJBTFRFUiBUQUJMRSBhY2NvdW50cyBBREQgQ09MVU1OIHtjb2xfbmFtZX0ge2NvbF90eXBlfSIpCiAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgdGjDqm0gY+G7mXQge2NvbF9uYW1lfSB2w6BvIGLhuqNuZyBhY2NvdW50cyIpCiAgICAgICAgCiAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgIAogICAgZGVmIF9jbGVhbnVwX2R1cGxpY2F0ZV9hY2NvdW50cyhzZWxmLCBjdXJzb3IpOgogICAgICAgICIiIgogICAgICAgIEThu41uIGThurlwIGPDoWMgdMOgaSBraG/huqNuIGR1cGxpY2F0ZSBk4buxYSB0csOqbiAoYXBwLCB1bmlxdWVfdXNlcm5hbWUpCiAgICAgICAgR2nhu68gbOG6oWkgdMOgaSBraG/huqNuIGPDsyBpZCBs4bubbiBuaOG6pXQgKG3hu5tpIG5o4bqldCkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVMOsbSBjw6FjIG5ow7NtIGR1cGxpY2F0ZQogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiIiIKICAgICAgICAgICAgICAgIFNFTEVDVCBhcHAsIHVuaXF1ZV91c2VybmFtZSwgQ09VTlQoKikgYXMgY291bnQKICAgICAgICAgICAgICAgIEZST00gYWNjb3VudHMgCiAgICAgICAgICAgICAgICBXSEVSRSB1bmlxdWVfdXNlcm5hbWUgSVMgTk9UIE5VTEwgQU5EIHVuaXF1ZV91c2VybmFtZSAhPSAnJwogICAgICAgICAgICAgICAgR1JPVVAgQlkgYXBwLCB1bmlxdWVfdXNlcm5hbWUgCiAgICAgICAgICAgICAgICBIQVZJTkcgQ09VTlQoKikgPiAxCiAgICAgICAgICAgICIiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGR1cGxpY2F0ZXMgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgICAgICAgICBpZiBub3QgZHVwbGljYXRlczoKICAgICAgICAgICAgICAgIHByaW50KCJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIGR1cGxpY2F0ZSBuw6BvIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KGYiVMOsbSB0aOG6pXkge2xlbihkdXBsaWNhdGVzKX0gbmjDs20gdMOgaSBraG/huqNuIGR1cGxpY2F0ZSwgxJFhbmcgZOG7jW4gZOG6uXAuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgdG90YWxfZGVsZXRlZCA9IDAKICAgICAgICAgICAgZm9yIGFwcCwgdXNlcm5hbWUsIGNvdW50IGluIGR1cGxpY2F0ZXM6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHThuqV0IGPhuqMgdMOgaSBraG/huqNuIGR1cGxpY2F0ZSBj4bunYSBuaMOzbSBuw6B5CiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiIiIKICAgICAgICAgICAgICAgICAgICBTRUxFQ1QgaWQgRlJPTSBhY2NvdW50cyAKICAgICAgICAgICAgICAgICAgICBXSEVSRSBhcHAgPSA/IEFORCB1bmlxdWVfdXNlcm5hbWUgPSA/IAogICAgICAgICAgICAgICAgICAgIE9SREVSIEJZIGlkIERFU0MKICAgICAgICAgICAgICAgICIiIiwgKGFwcCwgdXNlcm5hbWUpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhY2NvdW50X2lkcyA9IFtyb3dbMF0gZm9yIHJvdyBpbiBjdXJzb3IuZmV0Y2hhbGwoKV0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBHaeG7ryBs4bqhaSB0w6BpIGtob+G6o24gxJHhuqd1IHRpw6puIChpZCBs4bubbiBuaOG6pXQpLCB4w7NhIGPDoWMgdMOgaSBraG/huqNuIGPDsm4gbOG6oWkKICAgICAgICAgICAgICAgIGlmIGxlbihhY2NvdW50X2lkcykgPiAxOgogICAgICAgICAgICAgICAgICAgIGtlZXBfaWQgPSBhY2NvdW50X2lkc1swXSAgIyBJRCBs4bubbiBuaOG6pXQgKG3hu5tpIG5o4bqldCkKICAgICAgICAgICAgICAgICAgICBkZWxldGVfaWRzID0gYWNjb3VudF9pZHNbMTpdICAjIEPDoWMgSUQgY8OybiBs4bqhaQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGZvciBkZWxldGVfaWQgaW4gZGVsZXRlX2lkczoKICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIkRFTEVURSBGUk9NIGFjY291bnRzIFdIRVJFIGlkID0gPyIsIChkZWxldGVfaWQsKSkKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfZGVsZXRlZCArPSAxCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIHjDs2Ege2xlbihkZWxldGVfaWRzKX0gdMOgaSBraG/huqNuIGR1cGxpY2F0ZSBjaG8ge2FwcH06e3VzZXJuYW1lfSwgZ2nhu68gbOG6oWkgSUQge2tlZXBfaWR9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KGYixJDDoyBob8OgbiB0aMOgbmggZOG7jW4gZOG6uXAsIHjDs2EgdOG7lW5nIGPhu5luZyB7dG90YWxfZGVsZXRlZH0gdMOgaSBraG/huqNuIGR1cGxpY2F0ZSIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgZOG7jW4gZOG6uXAgZHVwbGljYXRlIGFjY291bnRzOiB7ZX0iKQogICAgICAgIAogICAgICAgICMgS2jhu59pIHThuqFvIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmggdOG7qyBjb25maWcucHkKICAgICAgICBzZWxmLmluaXRfZGVmYXVsdF9jb25maWcoKQogICAgICAgIAogICAgZGVmIGxvYWRfZGVmYXVsdF9jb25maWcoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIixJDhu41jIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmggdOG7qyBmaWxlIiIiCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc2VsZi5kZWZhdWx0X2NvbmZpZ19wYXRoKToKICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuZGVmYXVsdF9jb25maWdfcGF0aCwgJ3InKSBhcyBmOgogICAgICAgICAgICAgICAgcmV0dXJuIGpzb24ubG9hZChmKQogICAgICAgIHJldHVybiB7fQogICAgICAgIAogICAgZGVmIGdldChzZWxmLCBrZXk6IHN0ciwgZGVmYXVsdD1Ob25lKSAtPiBBbnk6CiAgICAgICAgIiIiTOG6pXkgZ2nDoSB0cuG7iyBj4bqldSBow6xuaCB04burIERCLCBu4bq/dSBraMO0bmcgY8OzIHRow6wgbOG6pXkgdOG7qyBkZWZhdWx0IGNvbmZpZyIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgdmFsdWUgRlJPTSBjb25maWcgV0hFUkUga2V5ID0gPyIsIChrZXksKSkKICAgICAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgIAogICAgICAgIGlmIHJlc3VsdDoKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgduG7gSBraeG7g3UgZOG7ryBsaeG7h3UgcGjDuSBo4bujcAogICAgICAgICAgICB2YWx1ZSA9IHJlc3VsdFswXQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbi5sb2Fkcyh2YWx1ZSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBM4bqleSB04burIGRlZmF1bHQgY29uZmlnCiAgICAgICAgICAgIGRlZmF1bHRfY29uZmlnID0gc2VsZi5sb2FkX2RlZmF1bHRfY29uZmlnKCkKICAgICAgICAgICAgaWYga2V5IGluIGRlZmF1bHRfY29uZmlnOgogICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRfY29uZmlnW2tleV0KICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHQKICAgIAogICAgZGVmIHNldChzZWxmLCBrZXk6IHN0ciwgdmFsdWU6IEFueSkgLT4gYm9vbDoKICAgICAgICAiIiJMxrB1IGdpw6EgdHLhu4sgY+G6pXUgaMOsbmggdsOgbyBEQiIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGThu68gbGnhu4d1IHBo4bupYyB04bqhcCB0aMOgbmggSlNPTgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIChkaWN0LCBsaXN0KSk6CiAgICAgICAgICAgIHZhbHVlID0ganNvbi5kdW1wcyh2YWx1ZSkKICAgICAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgICJJTlNFUlQgT1IgUkVQTEFDRSBJTlRPIGNvbmZpZyAoa2V5LCB2YWx1ZSkgVkFMVUVTICg/LCA/KSIsCiAgICAgICAgICAgICAgICAoa2V5LCB2YWx1ZSkKICAgICAgICAgICAgKQogICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBsxrB1IGPhuqV1IGjDrG5oOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGRlbGV0ZShzZWxmLCBrZXk6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiJYw7NhIG3hu5l0IGPhuqV1IGjDrG5oIGto4buPaSBkYXRhYmFzZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGtleTogS2jDs2EgY+G6pXUgaMOsbmggY+G6p24geMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiREVMRVRFIEZST00gY29uZmlnIFdIRVJFIGtleSA9ID8iLCAoa2V5LCkpCiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHjDs2EgY+G6pXUgaMOsbmgge2tleX06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgc2F2ZV9kZXZpY2VfaW5mbyhzZWxmLCBkZXZpY2VfaW5mbzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiTMawdSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iyB2w6BvIGPhuqV1IGjDrG5oIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuc2V0KCJkZXZpY2VfaW5mbyIsIGRldmljZV9pbmZvKQogICAgCiAgICBkZWYgZ2V0X2RldmljZV9pbmZvKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIkzhuqV5IHRow7RuZyB0aW4gdGhp4bq/dCBi4buLIMSRw6MgbMawdSIiIgogICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXQoImRldmljZV9pbmZvIiwge30pCiAgICAgICAgcmV0dXJuIGRldmljZV9pbmZvCiAgICAKICAgIGRlZiBhZGRfYWNjb3VudChzZWxmLCBhY2NvdW50X2RhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIlRow6ptIHTDoGkga2hv4bqjbiBt4bubaSB2w6BvIGRhdGFiYXNlIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgIyBJbXBvcnQgY29uZmlnIG1vZHVsZQogICAgICAgIGltcG9ydCBjb25maWcgYXMgY29uZmlnX21vZHVsZQogICAgICAgIAogICAgICAgICMgTuG6v3Uga2jDtG5nIGPDsyBkZXZpY2VfaWQsIHPhu60gZOG7pW5nIGRldmljZV9pZCBoaeG7h24gdOG6oWkKICAgICAgICBkZXZpY2VfaWQgPSBhY2NvdW50X2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgIGlmIG5vdCBkZXZpY2VfaWQ6CiAgICAgICAgICAgIGRldmljZV9pZCA9IHNlbGYuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgIAogICAgICAgICMgVMOhY2ggZOG7ryBsaeG7h3UgY2jDrW5oIHbDoCBk4buvIGxp4buHdSBwaOG7pQogICAgICAgIG1haW5fZGF0YSA9IHsKICAgICAgICAgICAgImFwcCI6IGFjY291bnRfZGF0YS5nZXQoImFwcCIsICIiKSwKICAgICAgICAgICAgIm5pY2tuYW1lIjogYWNjb3VudF9kYXRhLmdldCgibmlja25hbWUiLCAiIiksCiAgICAgICAgICAgICJ1bmlxdWVfaWQiOiBhY2NvdW50X2RhdGEuZ2V0KCJ1bmlxdWVfaWQiLCAiIiksCiAgICAgICAgICAgICJ1bmlxdWVfdXNlcm5hbWUiOiBhY2NvdW50X2RhdGEuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiLCAiIiksCiAgICAgICAgICAgICJzdGF0dXMiOiBhY2NvdW50X2RhdGEuZ2V0KCJzdGF0dXMiLCAiaW5hY3RpdmUiKSwKICAgICAgICAgICAgImluYWN0aXZlX3JlYXNvbiI6IGFjY291bnRfZGF0YS5nZXQoImluYWN0aXZlX3JlYXNvbiIsICIiKSwKICAgICAgICAgICAgImlzX2xvZ2luIjogMSBpZiBhY2NvdW50X2RhdGEuZ2V0KCJpc19sb2dpbiIsIEZhbHNlKSBlbHNlIDAsCiAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiBhY2NvdW50X2RhdGEuZ2V0KCJhdmF0YXJfdGh1bWIiLCAiIiksCiAgICAgICAgICAgICJ0b3RhbF9qb2JzIjogYWNjb3VudF9kYXRhLmdldCgidG90YWxfam9icyIsIDApLAogICAgICAgICAgICAiam9iX2VuYWJsZSI6IDEgaWYgYWNjb3VudF9kYXRhLmdldCgiam9iX2VuYWJsZSIsIEZhbHNlKSBlbHNlIDAsCiAgICAgICAgICAgICJqb2JfZGlzYWJsZV91bnRpbCI6IGFjY291bnRfZGF0YS5nZXQoImpvYl9kaXNhYmxlX3VudGlsIiwgMCksCiAgICAgICAgICAgICJqb2JfdG9kYXkiOiBhY2NvdW50X2RhdGEuZ2V0KCJqb2JfdG9kYXkiLCAwKSwKICAgICAgICAgICAgImpvYl9tYXhfZGF5IjogYWNjb3VudF9kYXRhLmdldCgiam9iX21heF9kYXkiLCBjb25maWdfbW9kdWxlLk1BWF9KT0JTX1BFUl9EQVkpLAogICAgICAgICAgICAiam9ic19kb25lX2luX3Nlc3Npb24iOiBhY2NvdW50X2RhdGEuZ2V0KCJqb2JzX2RvbmVfaW5fc2Vzc2lvbiIsIDApLAogICAgICAgICAgICAibWF4X2pvYnNfcGVyX3Nlc3Npb24iOiBhY2NvdW50X2RhdGEuZ2V0KCJtYXhfam9ic19wZXJfc2Vzc2lvbiIsIGNvbmZpZ19tb2R1bGUuTUFYX0pPQlNfUEVSX1NFU1NJT04pLAogICAgICAgICAgICAibGFzdF9qb2JfdGltZSI6IGFjY291bnRfZGF0YS5nZXQoImxhc3Rfam9iX3RpbWUiLCAwKSwKICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogaW50KHRpbWUudGltZSgpKSwKICAgICAgICAgICAgImNhcmVfdG9kYXkiOiBhY2NvdW50X2RhdGEuZ2V0KCJjYXJlX3RvZGF5IiwgMCksCiAgICAgICAgICAgICJpc19nb2xpa2VfbGlua2VkIjogMSBpZiBhY2NvdW50X2RhdGEuZ2V0KCJpc19nb2xpa2VfbGlua2VkIiwgRmFsc2UpIGVsc2UgMCwKICAgICAgICAgICAgImdvbGlrZV9pZCI6IGFjY291bnRfZGF0YS5nZXQoImdvbGlrZV9pZCIsICIiKSwKICAgICAgICAgICAgImRldmljZV9pZCI6IGRldmljZV9pZCwKICAgICAgICAgICAgImlzX3N5bmMiOiAxIGlmIGFjY291bnRfZGF0YS5nZXQoImlzX3N5bmMiLCBGYWxzZSkgZWxzZSAwLAogICAgICAgICAgICAiZGlzYWJsZV9mb2xsb3ciOiAxIGlmIGFjY291bnRfZGF0YS5nZXQoImRpc2FibGVfZm9sbG93IiwgRmFsc2UpIGVsc2UgMCwKICAgICAgICAgICAgImZvbGxvd19kaXNhYmxlX3VudGlsIjogYWNjb3VudF9kYXRhLmdldCgiZm9sbG93X2Rpc2FibGVfdW50aWwiLCAwKSwKICAgICAgICAgICAgImZvbGxvd190b2RheSI6IGFjY291bnRfZGF0YS5nZXQoImZvbGxvd190b2RheSIsIDApLAogICAgICAgICAgICAiZm9sbG93X2luX3Nlc3Npb24iOiBhY2NvdW50X2RhdGEuZ2V0KCJmb2xsb3dfaW5fc2Vzc2lvbiIsIDApLAogICAgICAgICAgICAibWF4X2ZvbGxvd19kYXkiOiBhY2NvdW50X2RhdGEuZ2V0KCJtYXhfZm9sbG93X2RheSIsIDIwKSwKICAgICAgICAgICAgIm1heF9mb2xsb3dfc2Vzc2lvbiI6IGFjY291bnRfZGF0YS5nZXQoIm1heF9mb2xsb3dfc2Vzc2lvbiIsIDUpLAogICAgICAgICAgICAibGFzdF9mb2xsb3dfdGltZSI6IGFjY291bnRfZGF0YS5nZXQoImxhc3RfZm9sbG93X3RpbWUiLCAwKSwKICAgICAgICAgICAgImluYWN0aXZlX2ZvbGxvd19yZWFzb24iOiBhY2NvdW50X2RhdGEuZ2V0KCJpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIiwgIiIpLAogICAgICAgICAgICAibGFzdF9jYXJlX3RpbWUiOiBhY2NvdW50X2RhdGEuZ2V0KCJsYXN0X2NhcmVfdGltZSIsIDApLAogICAgICAgICAgICAibGFzdF92aWV3X3N0b3JpZXMiOiBhY2NvdW50X2RhdGEuZ2V0KCJsYXN0X3ZpZXdfc3RvcmllcyIsIDApLAogICAgICAgICAgICAiYWNjb3VudF91dWlkIjogYWNjb3VudF9kYXRhLmdldCgiYWNjb3VudF91dWlkIiwgc3RyKHV1aWQudXVpZDQoKSkpLCAgIyBU4bqhbyBVVUlEIG7hur91IGNoxrBhIGPDswogICAgICAgIH0KICAgICAgICAKICAgICAgICAjIEzGsHUgSUQgdOG7qyBk4buvIGxp4buHdSDEkeG6p3UgdsOgbyBu4bq/dSBjw7MKICAgICAgICBpZiAiaWQiIGluIGFjY291bnRfZGF0YToKICAgICAgICAgICAgbWFpbl9kYXRhWyJpZCJdID0gYWNjb3VudF9kYXRhWyJpZCJdCiAgICAgICAgCiAgICAgICAgIyBMxrB1IGThu68gbGnhu4d1IHBo4bulIGTGsOG7m2kgZOG6oW5nIEpTT04KICAgICAgICBleHRyYV9kYXRhID0ge2s6IHYgZm9yIGssIHYgaW4gYWNjb3VudF9kYXRhLml0ZW1zKCkgaWYgayBub3QgaW4gbWFpbl9kYXRhfQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgY29sdW1ucyA9ICIsICIuam9pbihtYWluX2RhdGEua2V5cygpKQogICAgICAgICAgICBwbGFjZWhvbGRlcnMgPSAiLCAiLmpvaW4oWyI/Il0gKiBsZW4obWFpbl9kYXRhKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHZhbHVlcyA9IGxpc3QobWFpbl9kYXRhLnZhbHVlcygpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBwaOG7pSB2w6BvIGN14buRaQogICAgICAgICAgICBjb2x1bW5zICs9ICIsIGRhdGEiCiAgICAgICAgICAgIHBsYWNlaG9sZGVycyArPSAiLCA/IgogICAgICAgICAgICB2YWx1ZXMuYXBwZW5kKGpzb24uZHVtcHMoZXh0cmFfZGF0YSkpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFPhu60gZOG7pW5nIElOU0VSVCBPUiBJR05PUkUgxJHhu4MgdHLDoW5oIGzhu5dpIGR1cGxpY2F0ZSwgc2F1IMSRw7MgVVBEQVRFIG7hur91IGPhuqduCiAgICAgICAgICAgIGlmICJpZCIgaW4gbWFpbl9kYXRhOgogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7MgSUQsIHPhu60gZOG7pW5nIElOU0VSVCBPUiBSRVBMQUNFICh1cGRhdGUgZXhpc3RpbmcgcmVjb3JkKQogICAgICAgICAgICAgICAgcXVlcnkgPSBmIklOU0VSVCBPUiBSRVBMQUNFIElOVE8gYWNjb3VudHMgKHtjb2x1bW5zfSkgVkFMVUVTICh7cGxhY2Vob2xkZXJzfSkiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyBjw7MgSUQsIGtp4buDbSB0cmEgZHVwbGljYXRlIGLhurFuZyB1bmlxdWUgY29uc3RyYWludAogICAgICAgICAgICAgICAgYXBwID0gbWFpbl9kYXRhLmdldCgiYXBwIikKICAgICAgICAgICAgICAgIHVuaXF1ZV91c2VybmFtZSA9IG1haW5fZGF0YS5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGFwcCBhbmQgdW5pcXVlX3VzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIMSRw6MgdOG7k24gdOG6oWkgY2jGsGEKICAgICAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGlkIEZST00gYWNjb3VudHMgV0hFUkUgYXBwID0gPyBBTkQgdW5pcXVlX3VzZXJuYW1lID0gPyIsIChhcHAsIHVuaXF1ZV91c2VybmFtZSkpCiAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmcgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGV4aXN0aW5nOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDoGkga2hv4bqjbiDEkcOjIHThu5NuIHThuqFpLCBj4bqtcCBuaOG6rXQgdGjDtG5nIHRpbgogICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ19pZCA9IGV4aXN0aW5nWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICMgTG/huqFpIGLhu48gaWQga2jhu49pIG1haW5fZGF0YSDEkeG7gyB1cGRhdGUKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7azogdiBmb3IgaywgdiBpbiBtYWluX2RhdGEuaXRlbXMoKSBpZiBrICE9ICJpZCJ9CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhWyJkYXRhIl0gPSBqc29uLmR1bXBzKGV4dHJhX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBzZXRfY2xhdXNlID0gIiwgIi5qb2luKFtmIntrfSA9ID8iIGZvciBrIGluIHVwZGF0ZV9kYXRhLmtleXMoKV0pCiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9xdWVyeSA9IGYiVVBEQVRFIGFjY291bnRzIFNFVCB7c2V0X2NsYXVzZX0gV0hFUkUgaWQgPSA/IgogICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSh1cGRhdGVfcXVlcnksIGxpc3QodXBkYXRlX2RhdGEudmFsdWVzKCkpICsgW2V4aXN0aW5nX2lkXSkKICAgICAgICAgICAgICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOgaSBraG/huqNuIGNoxrBhIHThu5NuIHThuqFpLCB0aMOqbSBt4bubaQogICAgICAgICAgICAgICAgICAgICAgICAjIExv4bqhaSBi4buPIGlkIGto4buPaSBtYWluX2RhdGEgxJHhu4MgSU5TRVJUCiAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydF9kYXRhID0ge2s6IHYgZm9yIGssIHYgaW4gbWFpbl9kYXRhLml0ZW1zKCkgaWYgayAhPSAiaWQifQogICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRfY29sdW1ucyA9ICIsICIuam9pbihpbnNlcnRfZGF0YS5rZXlzKCkpICsgIiwgZGF0YSIKICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0X3BsYWNlaG9sZGVycyA9ICIsICIuam9pbihbIj8iXSAqIGxlbihpbnNlcnRfZGF0YSkpICsgIiwgPyIKICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0X3ZhbHVlcyA9IGxpc3QoaW5zZXJ0X2RhdGEudmFsdWVzKCkpICsgW2pzb24uZHVtcHMoZXh0cmFfZGF0YSldCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeSA9IGYiSU5TRVJUIElOVE8gYWNjb3VudHMgKHtpbnNlcnRfY29sdW1uc30pIFZBTFVFUyAoe2luc2VydF9wbGFjZWhvbGRlcnN9KSIKICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUocXVlcnksIGluc2VydF92YWx1ZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgY8OzIGFwcCBob+G6t2MgdW5pcXVlX3VzZXJuYW1lLCBz4butIGThu6VuZyBJTlNFUlQgYsOsbmggdGjGsOG7nW5nCiAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSBmIklOU0VSVCBJTlRPIGFjY291bnRzICh7Y29sdW1uc30pIFZBTFVFUyAoe3BsYWNlaG9sZGVyc30pIgogICAgICAgICAgICAKICAgICAgICAgICAgaWYgImlkIiBpbiBtYWluX2RhdGE6CiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZShxdWVyeSwgdmFsdWVzKQogICAgICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRow6ptIHTDoGkga2hv4bqjbjoge2V9IikKICAgICAgICAgICAgY29ubi5yb2xsYmFjaygpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdXBkYXRlX2FjY291bnQoc2VsZiwgYWNjb3VudF9pZDogaW50LCBkYXRhOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24iIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgdMOgaSBraG/huqNuIGhp4buHbiB04bqhaQogICAgICAgICAgICBhY2NvdW50ID0gc2VsZi5nZXRfYWNjb3VudChhY2NvdW50X2lkKQogICAgICAgICAgICBpZiBub3QgYWNjb3VudDoKICAgICAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB24bubaSBJRCB7YWNjb3VudF9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBk4buvIGxp4buHdQogICAgICAgICAgICBhY2NvdW50LnVwZGF0ZShkYXRhKQogICAgICAgICAgICBhY2NvdW50WyJsYXN0X3VwZGF0ZSJdID0gaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJHDoW5oIGThuqV1IGPhuqduIHN5bmMgdHLhu6sga2hpIGRhdGEgxJHDoyBjw7MgaXNfc3luYyDEkcaw4bujYyBzZXQgcsO1IHLDoG5nCiAgICAgICAgICAgIGlmICJpc19zeW5jIiBub3QgaW4gZGF0YToKICAgICAgICAgICAgICAgIGFjY291bnRbImlzX3N5bmMiXSA9IEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDoWNoIG1haW5fZGF0YSB2w6AgZXh0cmFfZGF0YQogICAgICAgICAgICBtYWluX2RhdGEgPSB7fQogICAgICAgICAgICBleHRyYV9kYXRhID0ge30KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGFjY291bnQuaXRlbXMoKToKICAgICAgICAgICAgICAgIGlmIGtleSBpbiBbImlkIiwgImFwcCIsICJ1c2VybmFtZSIsICJwYXNzd29yZCIsICJ1bmlxdWVfdXNlcm5hbWUiLCAiaXNfbG9naW4iLCAiaXNfc3luYyIsICJwcm94eSIsICJkZXZpY2VfaWQiLCAibGFzdF91cGRhdGUiXToKICAgICAgICAgICAgICAgICAgICBtYWluX2RhdGFba2V5XSA9IHZhbHVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGV4dHJhX2RhdGFba2V5XSA9IHZhbHVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFPhu60gZOG7pW5nIGjDoG0gdXBkYXRlIGNodXnDqm4gYmnhu4d0CiAgICAgICAgICAgIHJldHVybiBzZWxmLnVwZGF0ZV9hY2NvdW50X2J5X2lkKGFjY291bnRfaWQsIG1haW5fZGF0YSwgZXh0cmFfZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGdldF9hY2NvdW50KHNlbGYsIGFjY291bnRfaWQ6IGludCkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIkzhuqV5IHRow7RuZyB0aW4gY+G7p2EgbeG7mXQgdMOgaSBraG/huqNuIHRoZW8gSUQiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUICogRlJPTSBhY2NvdW50cyBXSEVSRSBpZCA9ID8iLCAoYWNjb3VudF9pZCwpKQogICAgICAgIGNvbHVtbl9uYW1lcyA9IFtkZXNjcmlwdGlvblswXSBmb3IgZGVzY3JpcHRpb24gaW4gY3Vyc29yLmRlc2NyaXB0aW9uXQogICAgICAgIHJlc3VsdCA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHJlc3VsdDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkga+G6v3QgcXXhuqMgdGjDoG5oIGRpY3QKICAgICAgICBhY2NvdW50ID0ge2NvbHVtbl9uYW1lc1tpXTogcmVzdWx0W2ldIGZvciBpIGluIHJhbmdlKGxlbihjb2x1bW5fbmFtZXMpKX0KICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBib29sZWFuCiAgICAgICAgYWNjb3VudFsiaXNfbG9naW4iXSA9IGJvb2woYWNjb3VudFsiaXNfbG9naW4iXSkKICAgICAgICBhY2NvdW50WyJqb2JfZW5hYmxlIl0gPSBib29sKGFjY291bnRbImpvYl9lbmFibGUiXSkKICAgICAgICBhY2NvdW50WyJpc19nb2xpa2VfbGlua2VkIl0gPSBib29sKGFjY291bnRbImlzX2dvbGlrZV9saW5rZWQiXSkKICAgICAgICBhY2NvdW50WyJpc19zeW5jIl0gPSBib29sKGFjY291bnRbImlzX3N5bmMiXSkKICAgICAgICBpZiAiZGlzYWJsZV9mb2xsb3ciIGluIGFjY291bnQ6CiAgICAgICAgICAgIGFjY291bnRbImRpc2FibGVfZm9sbG93Il0gPSBib29sKGFjY291bnRbImRpc2FibGVfZm9sbG93Il0pCiAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgZm9sbG93IHRow6BuaCBraeG7g3UgZOG7ryBsaeG7h3UgcGjDuSBo4bujcAogICAgICAgIGlmICJmb2xsb3dfdG9kYXkiIGluIGFjY291bnQ6CiAgICAgICAgICAgIGFjY291bnRbImZvbGxvd190b2RheSJdID0gaW50KGFjY291bnRbImZvbGxvd190b2RheSJdKSBpZiBhY2NvdW50WyJmb2xsb3dfdG9kYXkiXSBlbHNlIDAKICAgICAgICBpZiAiZm9sbG93X2luX3Nlc3Npb24iIGluIGFjY291bnQ6CiAgICAgICAgICAgIGFjY291bnRbImZvbGxvd19pbl9zZXNzaW9uIl0gPSBpbnQoYWNjb3VudFsiZm9sbG93X2luX3Nlc3Npb24iXSkgaWYgYWNjb3VudFsiZm9sbG93X2luX3Nlc3Npb24iXSBlbHNlIDAKICAgICAgICBpZiAibWF4X2ZvbGxvd19kYXkiIGluIGFjY291bnQ6CiAgICAgICAgICAgIGFjY291bnRbIm1heF9mb2xsb3dfZGF5Il0gPSBpbnQoYWNjb3VudFsibWF4X2ZvbGxvd19kYXkiXSkgaWYgYWNjb3VudFsibWF4X2ZvbGxvd19kYXkiXSBlbHNlIDIwCiAgICAgICAgaWYgIm1heF9mb2xsb3dfc2Vzc2lvbiIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibWF4X2ZvbGxvd19zZXNzaW9uIl0gPSBpbnQoYWNjb3VudFsibWF4X2ZvbGxvd19zZXNzaW9uIl0pIGlmIGFjY291bnRbIm1heF9mb2xsb3dfc2Vzc2lvbiJdIGVsc2UgNQogICAgICAgIGlmICJsYXN0X2ZvbGxvd190aW1lIiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJsYXN0X2ZvbGxvd190aW1lIl0gPSBpbnQoYWNjb3VudFsibGFzdF9mb2xsb3dfdGltZSJdKSBpZiBhY2NvdW50WyJsYXN0X2ZvbGxvd190aW1lIl0gZWxzZSAwCiAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgY2FyZSB0aMOgbmgga2nhu4N1IGThu68gbGnhu4d1IHBow7kgaOG7o3AKICAgICAgICBpZiAibGFzdF9jYXJlX3RpbWUiIGluIGFjY291bnQ6CiAgICAgICAgICAgIGFjY291bnRbImxhc3RfY2FyZV90aW1lIl0gPSBpbnQoYWNjb3VudFsibGFzdF9jYXJlX3RpbWUiXSkgaWYgYWNjb3VudFsibGFzdF9jYXJlX3RpbWUiXSBlbHNlIDAKICAgICAgICBpZiAibGFzdF92aWV3X3N0b3JpZXMiIGluIGFjY291bnQ6CiAgICAgICAgICAgIGFjY291bnRbImxhc3Rfdmlld19zdG9yaWVzIl0gPSBpbnQoYWNjb3VudFsibGFzdF92aWV3X3N0b3JpZXMiXSkgaWYgYWNjb3VudFsibGFzdF92aWV3X3N0b3JpZXMiXSBlbHNlIDAKICAgICAgICAKICAgICAgICAjIFRow6ptIGThu68gbGnhu4d1IHBo4bulIHThu6sgdHLGsOG7nW5nIGRhdGEKICAgICAgICBpZiAiZGF0YSIgaW4gYWNjb3VudCBhbmQgYWNjb3VudFsiZGF0YSJdOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBleHRyYV9kYXRhID0ganNvbi5sb2FkcyhhY2NvdW50WyJkYXRhIl0pCiAgICAgICAgICAgICAgICBhY2NvdW50LnVwZGF0ZShleHRyYV9kYXRhKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgICMgWMOzYSB0csaw4budbmcgZGF0YSDEkeG7gyB0csOhbmggdHLDuW5nIGzhurdwCiAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQ6CiAgICAgICAgICAgIGRlbCBhY2NvdW50WyJkYXRhIl0KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGFjY291bnQKCiAgICBkZWYgdXBkYXRlX2FjY291bnRfYnlfaWQoc2VsZiwgYWNjb3VudF9pZCwgbWFpbl9kYXRhLCBleHRyYV9kYXRhPU5vbmUpOgogICAgICAgICIiIkPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24gdGhlbyBJRCIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBMdcO0biBzZXQgaXNfc3luYyA9IEZhbHNlIGtoaSB1cGRhdGUKICAgICAgICAgICAgbWFpbl9kYXRhWyJpc19zeW5jIl0gPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBjw6J1IGzhu4duaCBVUERBVEUKICAgICAgICAgICAgdXBkYXRlX2ZpZWxkcyA9IFtdCiAgICAgICAgICAgIHZhbHVlcyA9IFtdCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBtYWluX2RhdGEuaXRlbXMoKToKICAgICAgICAgICAgICAgIGlmIGtleSAhPSAiaWQiOiAgIyBLaMO0bmcgdXBkYXRlIElECiAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2ZpZWxkcy5hcHBlbmQoZiJ7a2V5fSA9ID8iKQogICAgICAgICAgICAgICAgICAgIHZhbHVlcy5hcHBlbmQodmFsdWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBleHRyYV9kYXRhOgogICAgICAgICAgICAgICAgdXBkYXRlX2ZpZWxkcy5hcHBlbmQoImRhdGEgPSA/IikKICAgICAgICAgICAgICAgIHZhbHVlcy5hcHBlbmQoanNvbi5kdW1wcyhleHRyYV9kYXRhKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHZhbHVlcy5hcHBlbmQoYWNjb3VudF9pZCkgICMgV0hFUkUgaWQgPSA/CiAgICAgICAgICAgIAogICAgICAgICAgICBxdWVyeSA9IGYiVVBEQVRFIGFjY291bnRzIFNFVCB7JywgJy5qb2luKHVwZGF0ZV9maWVsZHMpfSBXSEVSRSBpZCA9ID8iCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKHF1ZXJ5LCB2YWx1ZXMpCiAgICAgICAgICAgIAogICAgICAgICAgICByb3dzX2FmZmVjdGVkID0gY3Vyc29yLnJvd2NvdW50CiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJvd3NfYWZmZWN0ZWQgPiAwOgogICAgICAgICAgICAgICAgcHJpbnQoZiJD4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIElEIHthY2NvdW50X2lkfSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB24bubaSBJRCB7YWNjb3VudF9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o246IHtlfSIpCiAgICAgICAgICAgIGNvbm4ucm9sbGJhY2soKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZ2V0X2FjY291bnRfYnlfdW5pcXVlX3VzZXJuYW1lKHNlbGYsIGFwcDogc3RyLCB1bmlxdWVfdXNlcm5hbWU6IHN0cikgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRow7RuZyB0aW4gdMOgaSBraG/huqNuIHRoZW8gYXBwIHbDoCB1bmlxdWVfdXNlcm5hbWUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhcHA6IFTDqm4g4bupbmcgZOG7pW5nCiAgICAgICAgICAgIHVuaXF1ZV91c2VybmFtZTogVXNlcm5hbWUgZHV5IG5o4bqldCBj4bunYSB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdCBjaOG7qWEgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24gaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHVuaXF1ZV91c2VybmFtZToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCAqIEZST00gYWNjb3VudHMgV0hFUkUgYXBwID0gPyBBTkQgdW5pcXVlX3VzZXJuYW1lID0gPyIsIChhcHAsIHVuaXF1ZV91c2VybmFtZSkpCiAgICAgICAgY29sdW1uX25hbWVzID0gW2Rlc2NyaXB0aW9uWzBdIGZvciBkZXNjcmlwdGlvbiBpbiBjdXJzb3IuZGVzY3JpcHRpb25dCiAgICAgICAgcmVzdWx0ID0gY3Vyc29yLmZldGNob25lKCkKICAgICAgICAKICAgICAgICBpZiBub3QgcmVzdWx0OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBr4bq/dCBxdeG6oyB0aMOgbmggZGljdAogICAgICAgIGFjY291bnQgPSB7Y29sdW1uX25hbWVzW2ldOiByZXN1bHRbaV0gZm9yIGkgaW4gcmFuZ2UobGVuKGNvbHVtbl9uYW1lcykpfQogICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGPDoWMgdHLGsOG7nW5nIGJvb2xlYW4KICAgICAgICBhY2NvdW50WyJpc19sb2dpbiJdID0gYm9vbChhY2NvdW50WyJpc19sb2dpbiJdKQogICAgICAgIGFjY291bnRbImpvYl9lbmFibGUiXSA9IGJvb2woYWNjb3VudFsiam9iX2VuYWJsZSJdKQogICAgICAgIGFjY291bnRbImlzX2dvbGlrZV9saW5rZWQiXSA9IGJvb2woYWNjb3VudFsiaXNfZ29saWtlX2xpbmtlZCJdKQogICAgICAgIGFjY291bnRbImlzX3N5bmMiXSA9IGJvb2woYWNjb3VudFsiaXNfc3luYyJdKQogICAgICAgIGlmICJkaXNhYmxlX2ZvbGxvdyIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXSA9IGJvb2woYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXSkKICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBmb2xsb3cgdGjDoG5oIGtp4buDdSBk4buvIGxp4buHdSBwaMO5IGjhu6NwCiAgICAgICAgaWYgImZvbGxvd190b2RheSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsiZm9sbG93X3RvZGF5Il0gPSBpbnQoYWNjb3VudFsiZm9sbG93X3RvZGF5Il0pIGlmIGFjY291bnRbImZvbGxvd190b2RheSJdIGVsc2UgMAogICAgICAgIGlmICJmb2xsb3dfaW5fc2Vzc2lvbiIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsiZm9sbG93X2luX3Nlc3Npb24iXSA9IGludChhY2NvdW50WyJmb2xsb3dfaW5fc2Vzc2lvbiJdKSBpZiBhY2NvdW50WyJmb2xsb3dfaW5fc2Vzc2lvbiJdIGVsc2UgMAogICAgICAgIGlmICJtYXhfZm9sbG93X2RheSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibWF4X2ZvbGxvd19kYXkiXSA9IGludChhY2NvdW50WyJtYXhfZm9sbG93X2RheSJdKSBpZiBhY2NvdW50WyJtYXhfZm9sbG93X2RheSJdIGVsc2UgMjAKICAgICAgICBpZiAibWF4X2ZvbGxvd19zZXNzaW9uIiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJtYXhfZm9sbG93X3Nlc3Npb24iXSA9IGludChhY2NvdW50WyJtYXhfZm9sbG93X3Nlc3Npb24iXSkgaWYgYWNjb3VudFsibWF4X2ZvbGxvd19zZXNzaW9uIl0gZWxzZSA1CiAgICAgICAgaWYgImxhc3RfZm9sbG93X3RpbWUiIGluIGFjY291bnQ6CiAgICAgICAgICAgIGFjY291bnRbImxhc3RfZm9sbG93X3RpbWUiXSA9IGludChhY2NvdW50WyJsYXN0X2ZvbGxvd190aW1lIl0pIGlmIGFjY291bnRbImxhc3RfZm9sbG93X3RpbWUiXSBlbHNlIDAKICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBjYXJlIHRow6BuaCBraeG7g3UgZOG7ryBsaeG7h3UgcGjDuSBo4bujcAogICAgICAgIGlmICJsYXN0X2NhcmVfdGltZSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibGFzdF9jYXJlX3RpbWUiXSA9IGludChhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdKSBpZiBhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdIGVsc2UgMAogICAgICAgIGlmICJsYXN0X3ZpZXdfc3RvcmllcyIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibGFzdF92aWV3X3N0b3JpZXMiXSA9IGludChhY2NvdW50WyJsYXN0X3ZpZXdfc3RvcmllcyJdKSBpZiBhY2NvdW50WyJsYXN0X3ZpZXdfc3RvcmllcyJdIGVsc2UgMAogICAgICAgIAogICAgICAgICMgVGjDqm0gZOG7ryBsaeG7h3UgcGjhu6UgdOG7qyB0csaw4budbmcgZGF0YQogICAgICAgIGlmICJkYXRhIiBpbiBhY2NvdW50IGFuZCBhY2NvdW50WyJkYXRhIl06CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGV4dHJhX2RhdGEgPSBqc29uLmxvYWRzKGFjY291bnRbImRhdGEiXSkKICAgICAgICAgICAgICAgIGFjY291bnQudXBkYXRlKGV4dHJhX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgIyBYw7NhIHRyxrDhu51uZyBkYXRhIMSR4buDIHRyw6FuaCB0csO5bmcgbOG6t3AKICAgICAgICBpZiAiZGF0YSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgZGVsIGFjY291bnRbImRhdGEiXQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gYWNjb3VudAogICAgCiAgICBkZWYgZ2V0X2FjY291bnRfYnlfdXVpZChzZWxmLCBhY2NvdW50X3V1aWQ6IHN0cikgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIkzhuqV5IHRow7RuZyB0aW4gY+G7p2EgbeG7mXQgdMOgaSBraG/huqNuIHRoZW8gVVVJRCIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgKiBGUk9NIGFjY291bnRzIFdIRVJFIGFjY291bnRfdXVpZCA9ID8iLCAoYWNjb3VudF91dWlkLCkpCiAgICAgICAgY29sdW1uX25hbWVzID0gW2Rlc2NyaXB0aW9uWzBdIGZvciBkZXNjcmlwdGlvbiBpbiBjdXJzb3IuZGVzY3JpcHRpb25dCiAgICAgICAgcmVzdWx0ID0gY3Vyc29yLmZldGNob25lKCkKICAgICAgICAKICAgICAgICBpZiBub3QgcmVzdWx0OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBr4bq/dCBxdeG6oyB0aMOgbmggZGljdAogICAgICAgIGFjY291bnQgPSB7Y29sdW1uX25hbWVzW2ldOiByZXN1bHRbaV0gZm9yIGkgaW4gcmFuZ2UobGVuKGNvbHVtbl9uYW1lcykpfQogICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGPDoWMgdHLGsOG7nW5nIGJvb2xlYW4KICAgICAgICBhY2NvdW50WyJpc19sb2dpbiJdID0gYm9vbChhY2NvdW50WyJpc19sb2dpbiJdKQogICAgICAgIGFjY291bnRbImpvYl9lbmFibGUiXSA9IGJvb2woYWNjb3VudFsiam9iX2VuYWJsZSJdKQogICAgICAgIGFjY291bnRbImlzX2dvbGlrZV9saW5rZWQiXSA9IGJvb2woYWNjb3VudFsiaXNfZ29saWtlX2xpbmtlZCJdKQogICAgICAgIGFjY291bnRbImlzX3N5bmMiXSA9IGJvb2woYWNjb3VudFsiaXNfc3luYyJdKQogICAgICAgIGlmICJkaXNhYmxlX2ZvbGxvdyIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXSA9IGJvb2woYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXSkKICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBmb2xsb3cgdGjDoG5oIGtp4buDdSBk4buvIGxp4buHdSBwaMO5IGjhu6NwCiAgICAgICAgaWYgImZvbGxvd190b2RheSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsiZm9sbG93X3RvZGF5Il0gPSBpbnQoYWNjb3VudFsiZm9sbG93X3RvZGF5Il0pIGlmIGFjY291bnRbImZvbGxvd190b2RheSJdIGVsc2UgMAogICAgICAgIGlmICJmb2xsb3dfaW5fc2Vzc2lvbiIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsiZm9sbG93X2luX3Nlc3Npb24iXSA9IGludChhY2NvdW50WyJmb2xsb3dfaW5fc2Vzc2lvbiJdKSBpZiBhY2NvdW50WyJmb2xsb3dfaW5fc2Vzc2lvbiJdIGVsc2UgMAogICAgICAgIGlmICJtYXhfZm9sbG93X2RheSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibWF4X2ZvbGxvd19kYXkiXSA9IGludChhY2NvdW50WyJtYXhfZm9sbG93X2RheSJdKSBpZiBhY2NvdW50WyJtYXhfZm9sbG93X2RheSJdIGVsc2UgMjAKICAgICAgICBpZiAibWF4X2ZvbGxvd19zZXNzaW9uIiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJtYXhfZm9sbG93X3Nlc3Npb24iXSA9IGludChhY2NvdW50WyJtYXhfZm9sbG93X3Nlc3Npb24iXSkgaWYgYWNjb3VudFsibWF4X2ZvbGxvd19zZXNzaW9uIl0gZWxzZSA1CiAgICAgICAgaWYgImxhc3RfZm9sbG93X3RpbWUiIGluIGFjY291bnQ6CiAgICAgICAgICAgIGFjY291bnRbImxhc3RfZm9sbG93X3RpbWUiXSA9IGludChhY2NvdW50WyJsYXN0X2ZvbGxvd190aW1lIl0pIGlmIGFjY291bnRbImxhc3RfZm9sbG93X3RpbWUiXSBlbHNlIDAKICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBjYXJlIHRow6BuaCBraeG7g3UgZOG7ryBsaeG7h3UgcGjDuSBo4bujcAogICAgICAgIGlmICJsYXN0X2NhcmVfdGltZSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibGFzdF9jYXJlX3RpbWUiXSA9IGludChhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdKSBpZiBhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdIGVsc2UgMAogICAgICAgIGlmICJsYXN0X3ZpZXdfc3RvcmllcyIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibGFzdF92aWV3X3N0b3JpZXMiXSA9IGludChhY2NvdW50WyJsYXN0X3ZpZXdfc3RvcmllcyJdKSBpZiBhY2NvdW50WyJsYXN0X3ZpZXdfc3RvcmllcyJdIGVsc2UgMAogICAgICAgIAogICAgICAgICMgVGjDqm0gZOG7ryBsaeG7h3UgcGjhu6UgdOG7qyB0csaw4budbmcgZGF0YQogICAgICAgIGlmICJkYXRhIiBpbiBhY2NvdW50IGFuZCBhY2NvdW50WyJkYXRhIl06CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGV4dHJhX2RhdGEgPSBqc29uLmxvYWRzKGFjY291bnRbImRhdGEiXSkKICAgICAgICAgICAgICAgIGFjY291bnQudXBkYXRlKGV4dHJhX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgIyBYw7NhIHRyxrDhu51uZyBkYXRhIMSR4buDIHRyw6FuaCB0csO5bmcgbOG6t3AKICAgICAgICBpZiAiZGF0YSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgZGVsIGFjY291bnRbImRhdGEiXQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gYWNjb3VudAogICAgCiAgICBkZWYgZ2V0X2FjY291bnRzKHNlbGYsIGFwcDogc3RyID0gTm9uZSwgc3RhdHVzOiBzdHIgPSBOb25lLCBqb2JfZW5hYmxlOiBib29sID0gTm9uZSwgZGV2aWNlX2lkOiBBbnkgPSBUcnVlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiJM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiB0aGVvIMSRaeG7gXUga2nhu4duIGzhu41jCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYXBwOiBUw6puIOG7qW5nIGThu6VuZyDEkeG7gyBs4buNYwogICAgICAgICAgICBzdGF0dXM6IFRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuIMSR4buDIGzhu41jCiAgICAgICAgICAgIGpvYl9lbmFibGU6IEzhu41jIHRoZW8gdHLhuqFuZyB0aMOhaSBi4bqtdC904bqvdCBqb2IKICAgICAgICAgICAgZGV2aWNlX2lkOiBM4buNYyB0aGVvIGRldmljZV9pZCwgY8OzIHRo4buDIGzDoDoKICAgICAgICAgICAgICAgIC0gVHJ1ZTogTOG7jWMgdGhlbyBkZXZpY2VfaWQgY+G7p2EgdGhp4bq/dCBi4buLIGhp4buHbiB04bqhaSAobeG6t2MgxJHhu4tuaCkKICAgICAgICAgICAgICAgIC0gRmFsc2UvTm9uZTogS2jDtG5nIGzhu41jIHRoZW8gZGV2aWNlX2lkCiAgICAgICAgICAgICAgICAtIENodeG7l2k6IEzhu41jIHRoZW8gZGV2aWNlX2lkIGPhu6UgdGjhu4MgxJHGsOG7o2MgdHJ1eeG7gW4gdsOgbwogICAgICAgICIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgIHF1ZXJ5ID0gIlNFTEVDVCAqIEZST00gYWNjb3VudHMiCiAgICAgICAgcGFyYW1zID0gW10KICAgICAgICAKICAgICAgICAjIFRow6ptIMSRaeG7gXUga2nhu4duIGzhu41jCiAgICAgICAgY29uZGl0aW9ucyA9IFtdCiAgICAgICAgaWYgYXBwOgogICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZCgiYXBwID0gPyIpCiAgICAgICAgICAgIHBhcmFtcy5hcHBlbmQoYXBwKQogICAgICAgIGlmIHN0YXR1czoKICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoInN0YXR1cyA9ID8iKQogICAgICAgICAgICBwYXJhbXMuYXBwZW5kKHN0YXR1cykKICAgICAgICBpZiBqb2JfZW5hYmxlIGlzIG5vdCBOb25lOgogICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZCgiam9iX2VuYWJsZSA9ID8iKQogICAgICAgICAgICBwYXJhbXMuYXBwZW5kKDEgaWYgam9iX2VuYWJsZSBlbHNlIDApCiAgICAgICAgICAgIAogICAgICAgIGlmIGNvbmRpdGlvbnM6CiAgICAgICAgICAgIHF1ZXJ5ICs9ICIgV0hFUkUgIiArICIgQU5EICIuam9pbihjb25kaXRpb25zKQogICAgICAgICAgICAKICAgICAgICBjdXJzb3IuZXhlY3V0ZShxdWVyeSwgcGFyYW1zKQogICAgICAgIGNvbHVtbl9uYW1lcyA9IFtkZXNjcmlwdGlvblswXSBmb3IgZGVzY3JpcHRpb24gaW4gY3Vyc29yLmRlc2NyaXB0aW9uXQogICAgICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgICAgIAogICAgICAgIGFjY291bnRzID0gW10KICAgICAgICBmb3IgcmVzdWx0IGluIHJlc3VsdHM6CiAgICAgICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGvhur90IHF14bqjIHRow6BuaCBkaWN0CiAgICAgICAgICAgIGFjY291bnQgPSB7Y29sdW1uX25hbWVzW2ldOiByZXN1bHRbaV0gZm9yIGkgaW4gcmFuZ2UobGVuKGNvbHVtbl9uYW1lcykpfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgYm9vbGVhbgogICAgICAgICAgICBhY2NvdW50WyJpc19sb2dpbiJdID0gYm9vbChhY2NvdW50WyJpc19sb2dpbiJdKQogICAgICAgICAgICBhY2NvdW50WyJqb2JfZW5hYmxlIl0gPSBib29sKGFjY291bnRbImpvYl9lbmFibGUiXSkKICAgICAgICAgICAgYWNjb3VudFsiaXNfZ29saWtlX2xpbmtlZCJdID0gYm9vbChhY2NvdW50WyJpc19nb2xpa2VfbGlua2VkIl0pCiAgICAgICAgICAgIGFjY291bnRbImlzX3N5bmMiXSA9IGJvb2woYWNjb3VudFsiaXNfc3luYyJdKQogICAgICAgICAgICBpZiAiZGlzYWJsZV9mb2xsb3ciIGluIGFjY291bnQ6CiAgICAgICAgICAgICAgICBhY2NvdW50WyJkaXNhYmxlX2ZvbGxvdyJdID0gYm9vbChhY2NvdW50WyJkaXNhYmxlX2ZvbGxvdyJdKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgZm9sbG93IHRow6BuaCBraeG7g3UgZOG7ryBsaeG7h3UgcGjDuSBo4bujcAogICAgICAgICAgICBpZiAiZm9sbG93X3RvZGF5IiBpbiBhY2NvdW50OgogICAgICAgICAgICAgICAgYWNjb3VudFsiZm9sbG93X3RvZGF5Il0gPSBpbnQoYWNjb3VudFsiZm9sbG93X3RvZGF5Il0pIGlmIGFjY291bnRbImZvbGxvd190b2RheSJdIGVsc2UgMAogICAgICAgICAgICBpZiAiZm9sbG93X2luX3Nlc3Npb24iIGluIGFjY291bnQ6CiAgICAgICAgICAgICAgICBhY2NvdW50WyJmb2xsb3dfaW5fc2Vzc2lvbiJdID0gaW50KGFjY291bnRbImZvbGxvd19pbl9zZXNzaW9uIl0pIGlmIGFjY291bnRbImZvbGxvd19pbl9zZXNzaW9uIl0gZWxzZSAwCiAgICAgICAgICAgIGlmICJtYXhfZm9sbG93X2RheSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgICAgIGFjY291bnRbIm1heF9mb2xsb3dfZGF5Il0gPSBpbnQoYWNjb3VudFsibWF4X2ZvbGxvd19kYXkiXSkgaWYgYWNjb3VudFsibWF4X2ZvbGxvd19kYXkiXSBlbHNlIDIwCiAgICAgICAgICAgIGlmICJtYXhfZm9sbG93X3Nlc3Npb24iIGluIGFjY291bnQ6CiAgICAgICAgICAgICAgICBhY2NvdW50WyJtYXhfZm9sbG93X3Nlc3Npb24iXSA9IGludChhY2NvdW50WyJtYXhfZm9sbG93X3Nlc3Npb24iXSkgaWYgYWNjb3VudFsibWF4X2ZvbGxvd19zZXNzaW9uIl0gZWxzZSA1CiAgICAgICAgICAgIGlmICJsYXN0X2ZvbGxvd190aW1lIiBpbiBhY2NvdW50OgogICAgICAgICAgICAgICAgYWNjb3VudFsibGFzdF9mb2xsb3dfdGltZSJdID0gaW50KGFjY291bnRbImxhc3RfZm9sbG93X3RpbWUiXSkgaWYgYWNjb3VudFsibGFzdF9mb2xsb3dfdGltZSJdIGVsc2UgMAogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgY2FyZSB0aMOgbmgga2nhu4N1IGThu68gbGnhu4d1IHBow7kgaOG7o3AKICAgICAgICAgICAgaWYgImxhc3RfY2FyZV90aW1lIiBpbiBhY2NvdW50OgogICAgICAgICAgICAgICAgYWNjb3VudFsibGFzdF9jYXJlX3RpbWUiXSA9IGludChhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdKSBpZiBhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdIGVsc2UgMAogICAgICAgICAgICBpZiAibGFzdF92aWV3X3N0b3JpZXMiIGluIGFjY291bnQ6CiAgICAgICAgICAgICAgICBhY2NvdW50WyJsYXN0X3ZpZXdfc3RvcmllcyJdID0gaW50KGFjY291bnRbImxhc3Rfdmlld19zdG9yaWVzIl0pIGlmIGFjY291bnRbImxhc3Rfdmlld19zdG9yaWVzIl0gZWxzZSAwCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGThu68gbGnhu4d1IHBo4bulIHThu6sgdHLGsOG7nW5nIGRhdGEKICAgICAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQgYW5kIGFjY291bnRbImRhdGEiXToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBleHRyYV9kYXRhID0ganNvbi5sb2FkcyhhY2NvdW50WyJkYXRhIl0pCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudC51cGRhdGUoZXh0cmFfZGF0YSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBYw7NhIHRyxrDhu51uZyBkYXRhIMSR4buDIHRyw6FuaCB0csO5bmcgbOG6t3AKICAgICAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQ6CiAgICAgICAgICAgICAgICBkZWwgYWNjb3VudFsiZGF0YSJdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKGFjY291bnQpCiAgICAgICAgCiAgICAgICAgIyBM4buNYyB0aGVvIGRldmljZV9pZCBu4bq/dSBj4bqnbgogICAgICAgIGlmIGRldmljZV9pZCBpcyBUcnVlOgogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZCBj4bunYSB0aGnhur90IGLhu4sgaGnhu4duIHThuqFpCiAgICAgICAgICAgIGN1cnJlbnRfZGV2aWNlX2lkID0gc2VsZi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgY3VycmVudF9kZXZpY2VfaWQ6CiAgICAgICAgICAgICAgICAjIEzhu41jIHTDoGkga2hv4bqjbiB0aGVvIGRldmljZV9pZCBj4bunYSB0aGnhur90IGLhu4sgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICBhY2NvdW50cyA9IFthY2MgZm9yIGFjYyBpbiBhY2NvdW50cyBpZiBhY2MuZ2V0KCJkZXZpY2VfaWQiKSA9PSBjdXJyZW50X2RldmljZV9pZF0KICAgICAgICBlbGlmIGlzaW5zdGFuY2UoZGV2aWNlX2lkLCBzdHIpIGFuZCBkZXZpY2VfaWQ6CiAgICAgICAgICAgICMgTOG7jWMgdGhlbyBkZXZpY2VfaWQgY+G7pSB0aOG7gyDEkcaw4bujYyB0cnV54buBbiB2w6BvCiAgICAgICAgICAgIGFjY291bnRzID0gW2FjYyBmb3IgYWNjIGluIGFjY291bnRzIGlmIGFjYy5nZXQoImRldmljZV9pZCIpID09IGRldmljZV9pZF0KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGFjY291bnRzCiAgICAKICAgIGRlZiBkZWxldGVfYWNjb3VudChzZWxmLCBhY2NvdW50X2lkOiBpbnQpIC0+IGJvb2w6CiAgICAgICAgIiIiWMOzYSB0w6BpIGtob+G6o24ga2jhu49pIGRhdGFiYXNlIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiREVMRVRFIEZST00gYWNjb3VudHMgV0hFUkUgaWQgPSA/IiwgKGFjY291bnRfaWQsKSkKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICByZXR1cm4gY3Vyc29yLnJvd2NvdW50ID4gMAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgeMOzYSB0w6BpIGtob+G6o246IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgIiIixJDDs25nIGvhur90IG7hu5FpIGRhdGFiYXNlIGPhu6dhIHRocmVhZCBoaeG7h24gdOG6oWkiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZi5sb2NhbCwgJ2Nvbm4nKSBhbmQgc2VsZi5sb2NhbC5jb25uOgogICAgICAgICAgICAgICAgc2VsZi5sb2NhbC5jb25uLmNsb3NlKCkKICAgICAgICAgICAgICAgIHNlbGYubG9jYWwuY29ubiA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDs2EgY8OhYyB0aGFtIGNoaeG6v3UgdGhyZWFkIMSR4buDIHRyw6FuaCBs4buXaQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdsb2NhbCcpOgogICAgICAgICAgICAgICAgaWYgaGFzYXR0cihzZWxmLmxvY2FsLCAnX2xvY2FsX19pbXBsJyk6CiAgICAgICAgICAgICAgICAgICAgIyBYw7NhIHRoYW0gY2hp4bq/dSB0cm9uZyBUaHJlYWRMb2NhbAogICAgICAgICAgICAgICAgICAgIGRlbGF0dHIoc2VsZi5sb2NhbCwgJ19sb2NhbF9faW1wbCcpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSDEkcOzbmcga+G6v3QgbuG7kWkgZGF0YWJhc2U6IHtlfSIpCiAgICAgICAgICAgIAogICAgZGVmIF9fZGVsX18oc2VsZik6CiAgICAgICAgIiIiSOG7p3kgxJHhu5FpIHTGsOG7o25nIiIiCiAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAKICAgIGRlZiB1cGRhdGVfb3JfaW5zZXJ0X2FjY291bnQoc2VsZiwgYXBwX25hbWU6IHN0ciwgdW5pcXVlX2lkOiBzdHIsIGRhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEPhuq1wIG5o4bqtdCBob+G6t2MgdGjDqm0gbeG7m2kgbeG7mXQgdMOgaSBraG/huqNuIHbDoG8gZGF0YWJhc2UKICAgICAgICAiIiIKICAgICAgICAjIMSQ4bqjbSBi4bqjbyBjb25uZWN0aW9uIGzDoCBj4bunYSB0aHJlYWQgaGnhu4duIHThuqFpCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIMSRw6MgdOG7k24gdOG6oWkgY2jGsGEKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAiIiJTRUxFQ1QgaWQgRlJPTSBhY2NvdW50cyBXSEVSRSBhcHBfbmFtZSA9ID8gQU5EIHVuaXF1ZV9pZCA9ID8iIiIsIAogICAgICAgICAgICAgICAgKGFwcF9uYW1lLCB1bmlxdWVfaWQpCiAgICAgICAgICAgICkKICAgICAgICAgICAgYWNjb3VudCA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBhY2NvdW50OgogICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIGhp4buHbiBjw7MKICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBhY2NvdW50WzBdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgZOG7ryBsaeG7h3UgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgICAgICAiIiJTRUxFQ1QgZGF0YSBGUk9NIGFjY291bnRzIFdIRVJFIGlkID0gPyIiIiwKICAgICAgICAgICAgICAgICAgICAoYWNjb3VudF9pZCwpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBjdXJyZW50X2RhdGFfcm93ID0gY3Vyc29yLmZldGNob25lKCkKICAgICAgICAgICAgICAgIGN1cnJlbnRfZGF0YSA9IGpzb24ubG9hZHMoY3VycmVudF9kYXRhX3Jvd1swXSkgaWYgY3VycmVudF9kYXRhX3JvdyBlbHNlIHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgSOG7o3AgbmjhuqV0IGThu68gbGnhu4d1IGPFqSB2w6AgbeG7m2kKICAgICAgICAgICAgICAgIG1lcmdlZF9kYXRhID0geyoqY3VycmVudF9kYXRhLCAqKmRhdGF9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10CiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgICAgICAiIiJVUERBVEUgYWNjb3VudHMgU0VUIAogICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSA/LAogICAgICAgICAgICAgICAgICAgICAgIG5pY2tuYW1lID0gPywKICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSA/LAogICAgICAgICAgICAgICAgICAgICAgIGlzX2xvZ2luID0gPywKICAgICAgICAgICAgICAgICAgICAgICBqb2JfZW5hYmxlID0gPywKICAgICAgICAgICAgICAgICAgICAgICBqb2JfbWF4X2RheSA9ID8sCiAgICAgICAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGUgPSA/CiAgICAgICAgICAgICAgICAgICAgICAgV0hFUkUgaWQgPSA/IiIiLAogICAgICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICAgICAganNvbi5kdW1wcyhtZXJnZWRfZGF0YSksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZ2V0KCJuaWNrbmFtZSIsICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5nZXQoInN0YXR1cyIsICJhY3RpdmUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgMSBpZiBkYXRhLmdldCgiaXNfbG9naW4iLCBGYWxzZSkgZWxzZSAwLAogICAgICAgICAgICAgICAgICAgICAgICAxIGlmIGRhdGEuZ2V0KCJqb2JfZW5hYmxlIiwgVHJ1ZSkgZWxzZSAwLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmdldCgiam9iX21heF9kYXkiLCBjb25maWcuTUFYX0pPQlNfUEVSX0RBWSksCiAgICAgICAgICAgICAgICAgICAgICAgIGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRfaWQKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRow6ptIHTDoGkga2hv4bqjbiBt4bubaQogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAgICAgIiIiSU5TRVJUIElOVE8gYWNjb3VudHMgKAogICAgICAgICAgICAgICAgICAgICAgIGFwcF9uYW1lLCB1bmlxdWVfaWQsIG5pY2tuYW1lLCBkYXRhLCBzdGF0dXMsIGlzX2xvZ2luLCBqb2JfZW5hYmxlLCBqb2JfbWF4X2RheSwgaXNfZ29saWtlX2xpbmtlZCwgZ29saWtlX2lkLCBsYXN0X3VwZGF0ZQogICAgICAgICAgICAgICAgICAgICkgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/KSIiIiwKICAgICAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAgICAgIGFwcF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZ2V0KCJuaWNrbmFtZSIsICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAganNvbi5kdW1wcyhkYXRhKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5nZXQoInN0YXR1cyIsICJhY3RpdmUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgMSBpZiBkYXRhLmdldCgiaXNfbG9naW4iLCBGYWxzZSkgZWxzZSAwLAogICAgICAgICAgICAgICAgICAgICAgICAxIGlmIGRhdGEuZ2V0KCJqb2JfZW5hYmxlIiwgVHJ1ZSkgZWxzZSAwLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmdldCgiam9iX21heF9kYXkiLCBjb25maWcuTUFYX0pPQlNfUEVSX0RBWSksCiAgICAgICAgICAgICAgICAgICAgICAgIDAsICAjIGlzX2dvbGlrZV9saW5rZWQKICAgICAgICAgICAgICAgICAgICAgICAgIiIsICMgZ29saWtlX2lkCiAgICAgICAgICAgICAgICAgICAgICAgIGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgY+G6rXAgbmjhuq10L3Row6ptIHTDoGkga2hv4bqjbjoge2V9IikKICAgICAgICAgICAgY29ubi5yb2xsYmFjaygpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcmVzZXRfbG9naW5fc3RhdHVzX2J5X2FwcChzZWxmLCBhcHBfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQ4bq3dCBs4bqhaSB0cuG6oW5nIHRow6FpIGxvZ2luIGNobyB04bqldCBj4bqjIHTDoGkga2hv4bqjbiBj4bunYSBt4buZdCDhu6luZyBk4bulbmcKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhcHBfbmFtZTogVMOqbiDhu6luZyBk4bulbmcgKGFwcCwga2jDtG5nIHBo4bqjaSBhcHBfbmFtZSkKICAgICAgICAiIiIKICAgICAgICAjIMSQ4bqjbSBi4bqjbyBjb25uZWN0aW9uIGzDoCBj4bunYSB0aHJlYWQgaGnhu4duIHThuqFpCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhurd0IGzhuqFpIHRy4bqhbmcgdGjDoWkgbG9naW4gY2hvIHThuqV0IGPhuqMgdMOgaSBraG/huqNuIHbDoCDEkcOhbmggZOG6pXUgY+G6p24gxJHhu5NuZyBi4buZCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICAgICAgICAgIiIiVVBEQVRFIGFjY291bnRzIFNFVCBpc19sb2dpbiA9IDAsIGlzX3N5bmMgPSAwIFdIRVJFIGFwcCA9ID8iIiIsCiAgICAgICAgICAgICAgICAoYXBwX25hbWUsKQogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPFqW5nIGPhuq1wIG5o4bqtdCB0csaw4budbmcgaXNfbG9naW4gdHJvbmcgZGF0YSBKU09OCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICAgICAgICAgIiIiU0VMRUNUIGlkLCBkYXRhIEZST00gYWNjb3VudHMgV0hFUkUgYXBwID0gPyIiIiwKICAgICAgICAgICAgICAgIChhcHBfbmFtZSwpCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGFjY291bnRzID0gY3Vyc29yLmZldGNoYWxsKCkKICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gYWNjb3VudHM6CiAgICAgICAgICAgICAgICBhY2NvdW50X2lkID0gYWNjb3VudFswXQogICAgICAgICAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMoYWNjb3VudFsxXSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSBsb2dpbiB0cm9uZyBkYXRhCiAgICAgICAgICAgICAgICBkYXRhWyJpc19sb2dpbiJdID0gRmFsc2UKICAgICAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICAgICAgICAgZGF0YVsiaXNfc3luYyJdID0gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMxrB1IGzhuqFpIGRhdGEKICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICAgICAgICAgICAgICIiIlVQREFURSBhY2NvdW50cyBTRVQgZGF0YSA9ID8gV0hFUkUgaWQgPSA/IiIiLAogICAgICAgICAgICAgICAgICAgIChqc29uLmR1bXBzKGRhdGEpLCBhY2NvdW50X2lkKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIMSR4bq3dCBs4bqhaSB0cuG6oW5nIHRow6FpIGxvZ2luOiB7ZX0iKQogICAgICAgICAgICBjb25uLnJvbGxiYWNrKCkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlIAoKICAgIGRlZiBhZGRfam9iX2hpc3Rvcnkoc2VsZiwgam9iX2RhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgVGjDqm0gbeG7mXQgYuG6o24gZ2hpIGzhu4tjaCBz4butIGpvYiBt4bubaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl9kYXRhOiBE4buvIGxp4buHdSBqb2IgY+G6p24gbMawdQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVVSUQgY+G7p2Egam9iIMSRw6MgdGjDqm0KICAgICAgICAiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgam9iX3V1aWQgPSBqb2JfZGF0YS5nZXQoImpvYl91dWlkIiwgc3RyKHV1aWQudXVpZDQoKSkpCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBraMO0bmcgY8OzIGRldmljZV9pZCwgc+G7rSBk4bulbmcgZGV2aWNlX2lkIGhp4buHbiB04bqhaQogICAgICAgIGRldmljZV9pZCA9IGpvYl9kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICBpZiBub3QgZGV2aWNlX2lkOgogICAgICAgICAgICBkZXZpY2VfaWQgPSBzZWxmLmdldF9vcl9jcmVhdGVfZGV2aWNlX2lkKCkKICAgICAgICAKICAgICAgICAjIFTDoWNoIGThu68gbGnhu4d1IGNow61uaCB2w6AgZOG7ryBsaeG7h3UgcGjhu6UKICAgICAgICBtYWluX2RhdGEgPSB7CiAgICAgICAgICAgICJqb2JfdXVpZCI6IGpvYl91dWlkLAogICAgICAgICAgICAiYWNjb3VudF91dWlkIjogam9iX2RhdGEuZ2V0KCJhY2NvdW50X3V1aWQiLCAiIiksCiAgICAgICAgICAgICJkZXZpY2VfaWQiOiBkZXZpY2VfaWQsCiAgICAgICAgICAgICJhcHAiOiBqb2JfZGF0YS5nZXQoImFwcCIsICIiKSwKICAgICAgICAgICAgImpvYl9pZCI6IGpvYl9kYXRhLmdldCgiam9iX2lkIiwgIiIpLAogICAgICAgICAgICAiam9iX3R5cGUiOiBqb2JfZGF0YS5nZXQoImpvYl90eXBlIiwgIiIpLAogICAgICAgICAgICAib2JqZWN0X2lkIjogam9iX2RhdGEuZ2V0KCJvYmplY3RfaWQiLCAiIiksCiAgICAgICAgICAgICJsaW5rIjogam9iX2RhdGEuZ2V0KCJsaW5rIiwgIiIpLAogICAgICAgICAgICAic3RhdHVzIjogam9iX2RhdGEuZ2V0KCJzdGF0dXMiLCAwKSwKICAgICAgICAgICAgInN1Y2Nlc3MiOiAxIGlmIGpvYl9kYXRhLmdldCgic3VjY2VzcyIsIEZhbHNlKSBlbHNlIDAsCiAgICAgICAgICAgICJwcmljZSI6IGpvYl9kYXRhLmdldCgicHJpY2UiLCAwLjApLAogICAgICAgICAgICAiZXJyb3JfbWVzc2FnZSI6IGpvYl9kYXRhLmdldCgiZXJyb3JfbWVzc2FnZSIsICIiKSwKICAgICAgICAgICAgImNyZWF0ZWRfYXQiOiBqb2JfZGF0YS5nZXQoImNyZWF0ZWRfYXQiLCBjdXJyZW50X3RpbWUpLAogICAgICAgICAgICAibGFzdF91cGRhdGUiOiBjdXJyZW50X3RpbWUsCiAgICAgICAgICAgICJpc19zeW5jIjogMCAgIyBN4bq3YyDEkeG7i25oIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgIH0KICAgICAgICAKICAgICAgICAjIEzGsHUgSUQgdOG7qyBk4buvIGxp4buHdSDEkeG6p3UgdsOgbyBu4bq/dSBjw7MKICAgICAgICBpZiAiaWQiIGluIGpvYl9kYXRhOgogICAgICAgICAgICBtYWluX2RhdGFbImlkIl0gPSBqb2JfZGF0YVsiaWQiXQogICAgICAgIAogICAgICAgICMgTMawdSBk4buvIGxp4buHdSBwaOG7pSBkxrDhu5tpIGThuqFuZyBKU09OCiAgICAgICAgZXh0cmFfZGF0YSA9IHtrOiB2IGZvciBrLCB2IGluIGpvYl9kYXRhLml0ZW1zKCkgaWYgayBub3QgaW4gbWFpbl9kYXRhIGFuZCBrICE9ICJkYXRhIn0KICAgICAgICBpZiAiZGF0YSIgaW4gam9iX2RhdGEgYW5kIGlzaW5zdGFuY2Uoam9iX2RhdGFbImRhdGEiXSwgZGljdCk6CiAgICAgICAgICAgIGV4dHJhX2RhdGEudXBkYXRlKGpvYl9kYXRhWyJkYXRhIl0pCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb2x1bW5zID0gIiwgIi5qb2luKG1haW5fZGF0YS5rZXlzKCkpCiAgICAgICAgICAgIHBsYWNlaG9sZGVycyA9ICIsICIuam9pbihbIj8iXSAqIGxlbihtYWluX2RhdGEpKQogICAgICAgICAgICAKICAgICAgICAgICAgdmFsdWVzID0gbGlzdChtYWluX2RhdGEudmFsdWVzKCkpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGThu68gbGnhu4d1IHBo4bulIHbDoG8gY3Xhu5FpCiAgICAgICAgICAgIGNvbHVtbnMgKz0gIiwgZGF0YSIKICAgICAgICAgICAgcGxhY2Vob2xkZXJzICs9ICIsID8iCiAgICAgICAgICAgIHZhbHVlcy5hcHBlbmQoanNvbi5kdW1wcyhleHRyYV9kYXRhKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHF1ZXJ5ID0gZiJJTlNFUlQgT1IgUkVQTEFDRSBJTlRPIGpvYnNfaGlzdG9yeSAoe2NvbHVtbnN9KSBWQUxVRVMgKHtwbGFjZWhvbGRlcnN9KSIKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUocXVlcnksIHZhbHVlcykKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICByZXR1cm4gam9iX3V1aWQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRow6ptIGzhu4tjaCBz4butIGpvYjoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAKICAgIGRlZiB1cGRhdGVfam9iX2hpc3Rvcnkoc2VsZiwgam9iX3V1aWQ6IHN0ciwgZGF0YTogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gbOG7i2NoIHPhu60gam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgam9iX3V1aWQ6IFVVSUQgY+G7p2Egam9iIGPhuqduIGPhuq1wIG5o4bqtdAogICAgICAgICAgICBkYXRhOiBE4buvIGxp4buHdSBj4bqtcCBuaOG6rXQKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBj4bqtcCBuaOG6rXQgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICAjIEzhuqV5IGpvYiBoaeG7h24gdOG6oWkKICAgICAgICBqb2IgPSBzZWxmLmdldF9qb2JfaGlzdG9yeShqb2JfdXVpZCkKICAgICAgICBpZiBub3Qgam9iOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICAjIEPhuq1wIG5o4bqtdCBk4buvIGxp4buHdQogICAgICAgIGpvYi51cGRhdGUoZGF0YSkKICAgICAgICBqb2JbImxhc3RfdXBkYXRlIl0gPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgCiAgICAgICAgIyBMxrB1IGzhuqFpCiAgICAgICAgcmV0dXJuIGJvb2woc2VsZi5hZGRfam9iX2hpc3Rvcnkoam9iKSkKICAgIAogICAgZGVmIGdldF9qb2JfaGlzdG9yeShzZWxmLCBqb2JfdXVpZDogc3RyKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGjDtG5nIHRpbiBs4buLY2ggc+G7rSBqb2IgdGhlbyBVVUlECiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgam9iX3V1aWQ6IFVVSUQgY+G7p2Egam9iIGPhuqduIGzhuqV5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgaG/hurdjIE5vbmU6IFRow7RuZyB0aW4gam9iIG7hur91IHTDrG0gdGjhuqV5LCBOb25lIG7hur91IGtow7RuZwogICAgICAgICIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgKiBGUk9NIGpvYnNfaGlzdG9yeSBXSEVSRSBqb2JfdXVpZCA9ID8iLCAoam9iX3V1aWQsKSkKICAgICAgICBjb2x1bW5fbmFtZXMgPSBbZGVzY3JpcHRpb25bMF0gZm9yIGRlc2NyaXB0aW9uIGluIGN1cnNvci5kZXNjcmlwdGlvbl0KICAgICAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgIAogICAgICAgIGlmIG5vdCByZXN1bHQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGvhur90IHF14bqjIHRow6BuaCBkaWN0CiAgICAgICAgam9iID0ge2NvbHVtbl9uYW1lc1tpXTogcmVzdWx0W2ldIGZvciBpIGluIHJhbmdlKGxlbihjb2x1bW5fbmFtZXMpKX0KICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBib29sZWFuCiAgICAgICAgam9iWyJzdWNjZXNzIl0gPSBib29sKGpvYlsic3VjY2VzcyJdKQogICAgICAgIGpvYlsiaXNfc3luYyJdID0gYm9vbChqb2JbImlzX3N5bmMiXSkKICAgICAgICAKICAgICAgICAjIFRow6ptIGThu68gbGnhu4d1IHBo4bulIHThu6sgdHLGsOG7nW5nIGRhdGEKICAgICAgICBpZiAiZGF0YSIgaW4gam9iIGFuZCBqb2JbImRhdGEiXToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZXh0cmFfZGF0YSA9IGpzb24ubG9hZHMoam9iWyJkYXRhIl0pCiAgICAgICAgICAgICAgICBqb2IudXBkYXRlKGV4dHJhX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgIyBYw7NhIHRyxrDhu51uZyBkYXRhIMSR4buDIHRyw6FuaCB0csO5bmcgbOG6t3AKICAgICAgICBpZiAiZGF0YSIgaW4gam9iOgogICAgICAgICAgICBkZWwgam9iWyJkYXRhIl0KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGpvYgogICAgCiAgICBkZWYgZ2V0X2pvYl9oaXN0b3J5X2J5X2FjY291bnQoc2VsZiwgYWNjb3VudF91dWlkOiBzdHIsIGxpbWl0OiBpbnQgPSA1MCkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgbOG7i2NoIHPhu60gam9iIGPhu6dhIG3hu5l0IHTDoGkga2hv4bqjbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnRfdXVpZDogVVVJRCBj4bunYSB0w6BpIGtob+G6o24KICAgICAgICAgICAgbGltaXQ6IFPhu5EgbMaw4bujbmcgYuG6o24gZ2hpIHThu5FpIMSRYSB0cuG6oyB24buBCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGzhu4tjaCBz4butIGpvYgogICAgICAgICIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICAgICAiU0VMRUNUICogRlJPTSBqb2JzX2hpc3RvcnkgV0hFUkUgYWNjb3VudF91dWlkID0gPyBPUkRFUiBCWSBjcmVhdGVkX2F0IERFU0MgTElNSVQgPyIsIAogICAgICAgICAgICAoYWNjb3VudF91dWlkLCBsaW1pdCkKICAgICAgICApCiAgICAgICAgY29sdW1uX25hbWVzID0gW2Rlc2NyaXB0aW9uWzBdIGZvciBkZXNjcmlwdGlvbiBpbiBjdXJzb3IuZGVzY3JpcHRpb25dCiAgICAgICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgCiAgICAgICAgam9icyA9IFtdCiAgICAgICAgZm9yIHJlc3VsdCBpbiByZXN1bHRzOgogICAgICAgICAgICAjIENodXnhu4NuIMSR4buVaSBr4bq/dCBxdeG6oyB0aMOgbmggZGljdAogICAgICAgICAgICBqb2IgPSB7Y29sdW1uX25hbWVzW2ldOiByZXN1bHRbaV0gZm9yIGkgaW4gcmFuZ2UobGVuKGNvbHVtbl9uYW1lcykpfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgYm9vbGVhbgogICAgICAgICAgICBqb2JbInN1Y2Nlc3MiXSA9IGJvb2woam9iWyJzdWNjZXNzIl0pCiAgICAgICAgICAgIGpvYlsiaXNfc3luYyJdID0gYm9vbChqb2JbImlzX3N5bmMiXSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gZOG7ryBsaeG7h3UgcGjhu6UgdOG7qyB0csaw4budbmcgZGF0YQogICAgICAgICAgICBpZiAiZGF0YSIgaW4gam9iIGFuZCBqb2JbImRhdGEiXToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBleHRyYV9kYXRhID0ganNvbi5sb2Fkcyhqb2JbImRhdGEiXSkKICAgICAgICAgICAgICAgICAgICBqb2IudXBkYXRlKGV4dHJhX2RhdGEpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgWMOzYSB0csaw4budbmcgZGF0YSDEkeG7gyB0csOhbmggdHLDuW5nIGzhurdwCiAgICAgICAgICAgIGlmICJkYXRhIiBpbiBqb2I6CiAgICAgICAgICAgICAgICBkZWwgam9iWyJkYXRhIl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBqb2JzLmFwcGVuZChqb2IpCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBqb2JzCiAgICAKICAgIGRlZiBnZXRfcGVuZGluZ19zeW5jX2l0ZW1zKHNlbGYsIHRhYmxlOiBzdHIsIGxpbWl0OiBpbnQgPSAxMDAsIGRldmljZV9pZDogQW55ID0gVHJ1ZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgZGFuaCBzw6FjaCBjw6FjIGLhuqNuIGdoaSBjaMawYSDEkcaw4bujYyDEkeG7k25nIGLhu5kKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YWJsZTogVMOqbiBi4bqjbmcgKCdhY2NvdW50cycgaG/hurdjICdqb2JzX2hpc3RvcnknKQogICAgICAgICAgICBsaW1pdDogU+G7kSBsxrDhu6NuZyBi4bqjbiBnaGkgdOG7kWkgxJFhIHRy4bqjIHbhu4EKICAgICAgICAgICAgZGV2aWNlX2lkOiBUaGnhur90IGLhu4sgSUQgxJHhu4MgbOG7jWM6CiAgICAgICAgICAgICAgICAtIFRydWU6IEzhu41jIHRoZW8gZGV2aWNlX2lkIGhp4buHbiB04bqhaSAobeG6t2MgxJHhu4tuaCkKICAgICAgICAgICAgICAgIC0gRmFsc2UvTm9uZTogS2jDtG5nIGzhu41jIHRoZW8gZGV2aWNlX2lkCiAgICAgICAgICAgICAgICAtIENodeG7l2k6IEzhu41jIHRoZW8gZGV2aWNlX2lkIGPhu6UgdGjhu4MgxJHGsOG7o2MgdHJ1eeG7gW4gdsOgbwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCBi4bqjbiBnaGkgY2jGsGEgxJHhu5NuZyBi4buZCiAgICAgICAgIiIiCiAgICAgICAgaWYgdGFibGUgbm90IGluIFsnYWNjb3VudHMnLCAnam9ic19oaXN0b3J5J106CiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICB1dWlkX2ZpZWxkID0gImFjY291bnRfdXVpZCIgaWYgdGFibGUgPT0gImFjY291bnRzIiBlbHNlICJqb2JfdXVpZCIKICAgICAgICAKICAgICAgICAjIFRow6ptIMSRaeG7gXUga2nhu4duIGzhu41jIHRoZW8gZGV2aWNlX2lkCiAgICAgICAgaWYgZGV2aWNlX2lkIGlzIFRydWU6CiAgICAgICAgICAgICMgTOG6pXkgZGV2aWNlX2lkIGhp4buHbiB04bqhaQogICAgICAgICAgICBjdXJyZW50X2RldmljZV9pZCA9IHNlbGYuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgICAgICBxdWVyeSA9IGYiU0VMRUNUICogRlJPTSB7dGFibGV9IFdIRVJFIGlzX3N5bmMgPSAwIEFORCBkZXZpY2VfaWQgPSA/IExJTUlUID8iCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKHF1ZXJ5LCAoY3VycmVudF9kZXZpY2VfaWQsIGxpbWl0KSkKICAgICAgICBlbGlmIGRldmljZV9pZDoKICAgICAgICAgICAgIyBT4butIGThu6VuZyBkZXZpY2VfaWQgxJHGsOG7o2MgdHJ1eeG7gW4gdsOgbwogICAgICAgICAgICBxdWVyeSA9IGYiU0VMRUNUICogRlJPTSB7dGFibGV9IFdIRVJFIGlzX3N5bmMgPSAwIEFORCBkZXZpY2VfaWQgPSA/IExJTUlUID8iCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKHF1ZXJ5LCAoZGV2aWNlX2lkLCBsaW1pdCkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBLaMO0bmcgbOG7jWMgdGhlbyBkZXZpY2VfaWQKICAgICAgICAgICAgcXVlcnkgPSBmIlNFTEVDVCAqIEZST00ge3RhYmxlfSBXSEVSRSBpc19zeW5jID0gMCBMSU1JVCA/IgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZShxdWVyeSwgKGxpbWl0LCkpCiAgICAgICAgICAgIAogICAgICAgIGNvbHVtbl9uYW1lcyA9IFtkZXNjcmlwdGlvblswXSBmb3IgZGVzY3JpcHRpb24gaW4gY3Vyc29yLmRlc2NyaXB0aW9uXQogICAgICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgICAgIAogICAgICAgIGl0ZW1zID0gW10KICAgICAgICBmb3IgcmVzdWx0IGluIHJlc3VsdHM6CiAgICAgICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGvhur90IHF14bqjIHRow6BuaCBkaWN0CiAgICAgICAgICAgIGl0ZW0gPSB7Y29sdW1uX25hbWVzW2ldOiByZXN1bHRbaV0gZm9yIGkgaW4gcmFuZ2UobGVuKGNvbHVtbl9uYW1lcykpfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBwaOG7pSB04burIHRyxrDhu51uZyBkYXRhCiAgICAgICAgICAgIGlmICJkYXRhIiBpbiBpdGVtIGFuZCBpdGVtWyJkYXRhIl06CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZXh0cmFfZGF0YSA9IGpzb24ubG9hZHMoaXRlbVsiZGF0YSJdKQogICAgICAgICAgICAgICAgICAgIGl0ZW0udXBkYXRlKGV4dHJhX2RhdGEpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgWMOzYSB0csaw4budbmcgZGF0YSDEkeG7gyB0csOhbmggdHLDuW5nIGzhurdwCiAgICAgICAgICAgIGlmICJkYXRhIiBpbiBpdGVtOgogICAgICAgICAgICAgICAgZGVsIGl0ZW1bImRhdGEiXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGl0ZW1zLmFwcGVuZChpdGVtKQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gaXRlbXMKICAgIAogICAgZGVmIG1hcmtfYXNfc3luY2VkKHNlbGYsIHRhYmxlOiBzdHIsIHV1aWRfdmFsdWU6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkMOhbmggZOG6pXUgYuG6o24gZ2hpIMSRw6MgxJHGsOG7o2MgxJHhu5NuZyBi4buZCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFibGU6IFTDqm4gYuG6o25nICgnYWNjb3VudHMnIGhv4bq3YyAnam9ic19oaXN0b3J5JykKICAgICAgICAgICAgdXVpZF92YWx1ZTogR2nDoSB0cuG7iyBVVUlEIGPhu6dhIGLhuqNuIGdoaQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGPhuq1wIG5o4bqtdCB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIGlmIHRhYmxlIG5vdCBpbiBbJ2FjY291bnRzJywgJ2pvYnNfaGlzdG9yeSddOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgdXVpZF9maWVsZCA9ICJhY2NvdW50X3V1aWQiIGlmIHRhYmxlID09ICJhY2NvdW50cyIgZWxzZSAiam9iX3V1aWQiCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgIGYiVVBEQVRFIHt0YWJsZX0gU0VUIGlzX3N5bmMgPSAxIFdIRVJFIHt1dWlkX2ZpZWxkfSA9ID8iLAogICAgICAgICAgICAgICAgKHV1aWRfdmFsdWUsKQogICAgICAgICAgICApCiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgcmV0dXJuIGN1cnNvci5yb3djb3VudCA+IDAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIMSRw6FuaCBk4bqldSDEkcOjIMSR4buTbmcgYuG7mToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlIAoKICAgIGRlZiBtYXJrX2FsbF9hY2NvdW50c19ub3Rfc3luY2VkKHNlbGYpIC0+IGludDoKICAgICAgICAiIiIKICAgICAgICDEkMOhbmggZOG6pXUgdOG6pXQgY+G6oyB0w6BpIGtob+G6o24gbMOgIGNoxrBhIHN5bmMKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBpbnQ6IFPhu5EgdMOgaSBraG/huqNuIMSRw6MgxJHGsOG7o2MgY+G6rXAgbmjhuq10CiAgICAgICAgIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiVVBEQVRFIGFjY291bnRzIFNFVCBpc19zeW5jID0gMCIpCiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgdXBkYXRlZF9jb3VudCA9IGN1cnNvci5yb3djb3VudAogICAgICAgICAgICByZXR1cm4gdXBkYXRlZF9jb3VudAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHDoW5oIGThuqV1IHThuqV0IGPhuqMgdMOgaSBraG/huqNuIGNoxrBhIHN5bmM6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAwCgogICAgZGVmIGdldF9kZXZpY2VfY29uZmlnKHNlbGYsIGtleTogc3RyLCBkZWZhdWx0PU5vbmUpIC0+IEFueToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBrZXk6IEtow7NhIGPhuqV1IGjDrG5oCiAgICAgICAgICAgIGRlZmF1bHQ6IEdpw6EgdHLhu4sgbeG6t2MgxJHhu4tuaCBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgQW55OiBHacOhIHRy4buLIGPhuqV1IGjDrG5oIGhv4bq3YyBnacOhIHRy4buLIG3hurdjIMSR4buLbmgKICAgICAgICAiIiIKICAgICAgICAjIEzhuqV5IGPhuqV1IGjDrG5oIHThu6sgZGF0YWJhc2UKICAgICAgICByZXR1cm4gc2VsZi5nZXQoa2V5LCBkZWZhdWx0KQoKICAgIGRlZiBzZXRfZGV2aWNlX2NvbmZpZyhzZWxmLCBrZXk6IHN0ciwgdmFsdWU6IEFueSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBTZXQgYSBkZXZpY2UgY29uZmlndXJhdGlvbiB2YWx1ZSBpbiB0aGUgY29uZmlnIHRhYmxlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAga2V5OiBUaGUgY29uZmlndXJhdGlvbiBrZXkKICAgICAgICAgICAgdmFsdWU6IFRoZSB2YWx1ZSB0byBzZXQKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBpZiBzdWNjZXNzZnVsLCBGYWxzZSBvdGhlcndpc2UKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5zZXQoa2V5LCB2YWx1ZSkKCiAgICBkZWYgZ2V0X2FsbF9kZXZpY2VfY29uZmlnKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEdldCBhbGwgZGV2aWNlIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3MKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogRGljdGlvbmFyeSBvZiBhbGwgZGV2aWNlIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3MKICAgICAgICAiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICAjIEdldCBhbGwga2V5cyBzdGFydGluZyB3aXRoICJkZXZpY2VfIiBidXQgZXhjbHVkZSBkZXZpY2VfaW5mbwogICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1Qga2V5LCB2YWx1ZSBGUk9NIGNvbmZpZyBXSEVSRSBrZXkgIT0gJ2RldmljZV9pbmZvJyBBTkQga2V5ICE9ICdkZXZpY2VfaWQnIikKICAgICAgICByZXN1bHRzID0gY3Vyc29yLmZldGNoYWxsKCkKICAgICAgICAKICAgICAgICAjIEJ1aWxkIGNvbmZpZyBkaWN0aW9uYXJ5LCByZW1vdmluZyAiZGV2aWNlXyIgcHJlZml4IGZyb20ga2V5cwogICAgICAgIGRldmljZV9jb25maWcgPSB7fQogICAgICAgIGZvciBrZXksIHZhbHVlIGluIHJlc3VsdHM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRldmljZV9jb25maWdba2V5XSA9IGpzb24ubG9hZHModmFsdWUpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRldmljZV9jb25maWdba2V5XSA9IHZhbHVlCiAgICAgICAgCiAgICAgICAgIyBJbXBvcnQgY29uZmlnIG1vZHVsZQogICAgICAgIGltcG9ydCBjb25maWcgYXMgY29uZmlnX21vZHVsZQogICAgICAgIAogICAgICAgICMgQWRkIGRlZmF1bHQgdmFsdWVzIGZvciBtaXNzaW5nIGNvbmZpZyBpdGVtcwogICAgICAgIGRlZmF1bHRfY29uZmlncyA9IHsKICAgICAgICAgICAgIm1heF9qb2JzX3Blcl9kYXkiOiBjb25maWdfbW9kdWxlLk1BWF9KT0JTX1BFUl9EQVksCiAgICAgICAgICAgICJtYXhfam9ic19wZXJfc2Vzc2lvbiI6IGNvbmZpZ19tb2R1bGUuTUFYX0pPQlNfUEVSX1NFU1NJT04sCiAgICAgICAgICAgICJqb2JfaW50ZXJ2YWxfc2Vjb25kcyI6IGNvbmZpZ19tb2R1bGUuSk9CX0NIRUNLX0lOVEVSVkFMLAogICAgICAgICAgICAicmVwb3J0X2ludGVydmFsIjogY29uZmlnX21vZHVsZS5NUVRUX1JFUE9SVF9JTlRFUlZBTAogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3Iga2V5LCBkZWZhdWx0X3ZhbHVlIGluIGRlZmF1bHRfY29uZmlncy5pdGVtcygpOgogICAgICAgICAgICBpZiBrZXkgbm90IGluIGRldmljZV9jb25maWc6CiAgICAgICAgICAgICAgICBkZXZpY2VfY29uZmlnW2tleV0gPSBkZWZhdWx0X3ZhbHVlCiAgICAgICAgCiAgICAgICAgIyBMb+G6oWkgYuG7jyBjw6FjIHRyxrDhu51uZyBraMO0bmcgY+G6p24gdGhp4bq/dAogICAgICAgIGtleXNfdG9fcmVtb3ZlID0gWyJpZCIsICJnb2xpa2VfYXBpX2Jhc2UiXQogICAgICAgIGZvciBrZXkgaW4ga2V5c190b19yZW1vdmU6CiAgICAgICAgICAgIGlmIGtleSBpbiBkZXZpY2VfY29uZmlnOgogICAgICAgICAgICAgICAgZGVsIGRldmljZV9jb25maWdba2V5XQogICAgICAgIAogICAgICAgIHJldHVybiBkZXZpY2VfY29uZmlnCgogICAgZGVmIHNhdmVfZGV2aWNlX2NvbmZpZyhzZWxmLCBjb25maWdfZGljdDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgTMawdSBuaGnhu4F1IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyBjw7luZyBsw7pjCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY29uZmlnX2RpY3Q6IERpY3Rpb25hcnkgY2jhu6lhIGPDoWMgY+G6t3Aga2V5LXZhbHVlIGPhuqV1IGjDrG5oCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGNvbmZpZ19kaWN0Lml0ZW1zKCk6CiAgICAgICAgICAgICAgICBzZWxmLnNldF9kZXZpY2VfY29uZmlnKGtleSwgdmFsdWUpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBsxrB1IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7izoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBpbml0X2RlZmF1bHRfY29uZmlnKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBj4bqldSBow6xuaCBt4bq3YyDEkeG7i25oIGNobyB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogQ+G6pXUgaMOsbmggxJHDoyBraOG7n2kgdOG6oW8KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVOG6oW8gY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaAogICAgICAgICAgICBkZWZhdWx0X2NvbmZpZyA9IHsKICAgICAgICAgICAgICAgICMgQ+G6pXUgaMOsbmggY2h1bmcKICAgICAgICAgICAgICAgICJzeW5jX2ludGVydmFsIjogY29uZmlnLlNZTkNfSU5URVJWQUwsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ+G6pXUgaMOsbmggY2hvIGpvYgogICAgICAgICAgICAgICAgImpvYl9jaGVja19pbnRlcnZhbCI6IGNvbmZpZy5KT0JfQ0hFQ0tfSU5URVJWQUwsCiAgICAgICAgICAgICAgICAiam9iX2hvdXIiOiBjb25maWcuSk9CX0hPVVIsCiAgICAgICAgICAgICAgICAiam9iX2Nvb2xkb3duX21pbnV0ZXMiOiBjb25maWcuREVGQVVMVF9DT09MRE9XTl9NSU5VVEVTLAogICAgICAgICAgICAgICAgIm1heF9qb2JzX3Blcl9kYXkiOiBjb25maWcuTUFYX0pPQlNfUEVSX0RBWSwKICAgICAgICAgICAgICAgICJtYXhfam9ic19wZXJfc2Vzc2lvbiI6IGNvbmZpZy5NQVhfSk9CU19QRVJfU0VTU0lPTiwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBEYW5oIHPDoWNoIGPDoWMgYXBwIMSRxrDhu6NjIGvDrWNoIGhv4bqhdAogICAgICAgICAgICAgICAgImVuYWJsZWRfYXBwcyI6IGNvbmZpZy5FTkFCTEVEX0FQUFMsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSBj4bqldSBow6xuaCBt4bq3YyDEkeG7i25oIHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZGVmYXVsdF9jb25maWcuaXRlbXMoKToKICAgICAgICAgICAgICAgICMgQ2jhu4kgbMawdSBu4bq/dSBjaMawYSBjw7MgdHJvbmcgZGF0YWJhc2UKICAgICAgICAgICAgICAgIGlmIHNlbGYuZ2V0X2RldmljZV9jb25maWcoa2V5KSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0X2RldmljZV9jb25maWcoa2V5LCB2YWx1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KCLEkMOjIGto4bufaSB04bqhbyBj4bqldSBow6xuaCBt4bq3YyDEkeG7i25oIGNobyB0aGnhur90IGLhu4siKQogICAgICAgICAgICByZXR1cm4gZGVmYXVsdF9jb25maWcKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGto4bufaSB04bqhbyBj4bqldSBow6xuaCBt4bq3YyDEkeG7i25oOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgCiAgICBkZWYgZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGhv4bq3YyB04bqhbyBkZXZpY2VfaWQKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IGRldmljZV9pZAogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIGRldmljZV9pZCB0cm9uZyBkYXRhYmFzZSBraMO0bmcKICAgICAgICBkZXZpY2VfaWQgPSBzZWxmLmdldF9kZXZpY2VfY29uZmlnKCJkZXZpY2VfaWQiLCAiIikKICAgICAgICBpZiBkZXZpY2VfaWQ6CiAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaWQKICAgICAgICAgICAgCiAgICAgICAgIyBUaOG7rSBs4bqleSBkZXZpY2VfaWQgdOG7qyBo4buHIHRo4buRbmcKICAgICAgICBkZXZpY2VfaWQgPSBzZWxmLl9nZXRfZGV2aWNlX2lkX2Zyb21fc3lzdGVtKCkKICAgICAgICBpZiBkZXZpY2VfaWQ6CiAgICAgICAgICAgICMgTMawdSB2w6BvIGPhuqV1IGjDrG5oIHbDoCB0cuG6oyB24buBCiAgICAgICAgICAgIHByaW50KGYixJDDoyBs4bqleSDEkcaw4bujYyBkZXZpY2VfaWQgdOG7qyBo4buHIHRo4buRbmc6IHtkZXZpY2VfaWR9IikKICAgICAgICAgICAgc2VsZi5zZXRfZGV2aWNlX2NvbmZpZygiZGV2aWNlX2lkIiwgZGV2aWNlX2lkKQogICAgICAgICAgICByZXR1cm4gZGV2aWNlX2lkCiAgICAgICAgICAgIAogICAgICAgICMgVGjhu60gbOG6pXkgZGV2aWNlX2lkIHThu6sgaGVscGVyIHNlcnZpY2UKICAgICAgICBkZXZpY2VfaWQgPSBzZWxmLl9nZXRfZGV2aWNlX2lkX2Zyb21faGVscGVyKCkKICAgICAgICBpZiBkZXZpY2VfaWQ6CiAgICAgICAgICAgICMgTMawdSB2w6BvIGPhuqV1IGjDrG5oIHbDoCB0cuG6oyB24buBCiAgICAgICAgICAgIHByaW50KGYixJDDoyBs4bqleSDEkcaw4bujYyBkZXZpY2VfaWQgdOG7qyBoZWxwZXIgc2VydmljZToge2RldmljZV9pZH0iKQogICAgICAgICAgICBzZWxmLnNldF9kZXZpY2VfY29uZmlnKCJkZXZpY2VfaWQiLCBkZXZpY2VfaWQpCiAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaWQKICAgICAgICAgICAgCiAgICAgICAgIyBO4bq/dSBraMO0bmcgbOG6pXkgxJHGsOG7o2MsIHThuqFvIG3hu5tpCiAgICAgICAgaW1wb3J0IHJhbmRvbQogICAgICAgIGltcG9ydCBzdHJpbmcKICAgICAgICByYW5kb21faWQgPSAnJy5qb2luKHJhbmRvbS5jaG9pY2VzKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzLCBrPTEwKSkKICAgICAgICBkZXZpY2VfaWQgPSBmInJhbmRvbV97cmFuZG9tX2lkfSIKICAgICAgICBwcmludChmIktow7RuZyBs4bqleSDEkcaw4bujYyBkZXZpY2VfaWQgYuG6sW5nIGPDoWMgY8OhY2ggdHLDqm4sIHThuqFvIG3hu5tpOiB7ZGV2aWNlX2lkfSIpCiAgICAgICAgCiAgICAgICAgIyBMxrB1IHbDoG8gY+G6pXUgaMOsbmgKICAgICAgICBzZWxmLnNldF9kZXZpY2VfY29uZmlnKCJkZXZpY2VfaWQiLCBkZXZpY2VfaWQpCiAgICAgICAgcmV0dXJuIGRldmljZV9pZAogICAgICAgIAogICAgZGVmIF9nZXRfZGV2aWNlX2lkX2Zyb21fc3lzdGVtKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBkZXZpY2VfaWQgdOG7qyBo4buHIHRo4buRbmcgKHPhu60gZOG7pW5nIGzhu4duaCBnZXRwcm9wKQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogZGV2aWNlX2lkIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSBraMO0bmcgbOG6pXkgxJHGsOG7o2MKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGltcG9ydCBzdWJwcm9jZXNzCiAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKFsiZ2V0cHJvcCIsICJyby5zZXJpYWxubyJdLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCiAgICAgICAgICAgIGRldmljZV9pZCA9IHJlc3VsdC5zdGRvdXQuc3RyaXAoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZGV2aWNlX2lkIGFuZCBkZXZpY2VfaWQgIT0gInVua25vd24iOgogICAgICAgICAgICAgICAgcmV0dXJuIGRldmljZV9pZAogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGzhuqV5IGRldmljZV9pZCB04burIGjhu4cgdGjhu5FuZzoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgICAgIAogICAgZGVmIF9nZXRfZGV2aWNlX2lkX2Zyb21faGVscGVyKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBkZXZpY2VfaWQgdOG7qyBoZWxwZXIgc2VydmljZSAoYW5kcm9pZF9pZCkKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IGRldmljZV9pZCBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3Uga2jDtG5nIGzhuqV5IMSRxrDhu6NjCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEPhuqduIGltcG9ydCBIZWxwZXJTZXJ2aWNlIHThuqFpIMSRw6J5IMSR4buDIHRyw6FuaCBpbXBvcnQgdsOybmcKICAgICAgICAgICAgZnJvbSBzZXJ2aWNlcy5oZWxwZXJfc2VydmljZSBpbXBvcnQgSGVscGVyU2VydmljZQogICAgICAgICAgICBpbXBvcnQgY29uZmlnCiAgICAgICAgICAgIAogICAgICAgICAgICBoZWxwZXIgPSBIZWxwZXJTZXJ2aWNlKGJhc2VfdXJsPWNvbmZpZy5IRUxQRVJfU0VSVklDRV9VUkwpCiAgICAgICAgICAgIGRldmljZV9pbmZvID0gaGVscGVyLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBkZXZpY2VfaW5mbyBhbmQgInN0YXR1cyIgaW4gZGV2aWNlX2luZm8gYW5kIGRldmljZV9pbmZvWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICBkYXRhID0gZGV2aWNlX2luZm8uZ2V0KCJkYXRhIiwge30pCiAgICAgICAgICAgICAgICBhbmRyb2lkX2lkID0gZGF0YS5nZXQoImFuZHJvaWRfaWQiLCAiIikKICAgICAgICAgICAgICAgIGlmIGFuZHJvaWRfaWQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFuZHJvaWRfaWQKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBs4bqleSBkZXZpY2VfaWQgdOG7qyBoZWxwZXI6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAKICAgIGRlZiBtaWdyYXRlX2dvbGlrZV9jb25maWcoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBYw7NhIGPDoWMgY+G6pXUgaMOsbmggR29MaWtlIHRyw7luZyBs4bq3cCBraMO0bmcgY8OybiBj4bqnbiB0aGnhur90CiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoIsSQYW5nIHjDs2EgY+G6pXUgaMOsbmggR29MaWtlIHRyw7luZyBs4bq3cC4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE3hu58ga+G6v3QgbuG7kWkgREIKICAgICAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBEYW5oIHPDoWNoIGPDoWMga2V5IGPhuqduIHjDs2EKICAgICAgICAgICAga2V5c190b19kZWxldGUgPSBbCiAgICAgICAgICAgICAgICAiZ29saWtlX2hlYWRlcnMiLCAKICAgICAgICAgICAgICAgICJnb2xpa2VfaGVhZGVyc191cGRhdGVkIiwKICAgICAgICAgICAgICAgICJnb2xpa2VfYXBpX2Jhc2UiCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgWMOzYSBjw6FjIGtleSB0csO5bmcgbOG6t3AgY8WpCiAgICAgICAgICAgIGRlbGV0ZWRfY291bnQgPSAwCiAgICAgICAgICAgIGZvciBrZXkgaW4ga2V5c190b19kZWxldGU6CiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiREVMRVRFIEZST00gY29uZmlnIFdIRVJFIGtleSA9ID8iLCAoa2V5LCkpCiAgICAgICAgICAgICAgICBkZWxldGVkX2NvdW50ICs9IGN1cnNvci5yb3djb3VudAogICAgICAgICAgICAKICAgICAgICAgICAgIyBDb21taXQgdGhheSDEkeG7lWkKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoZiLEkMOjIHjDs2Ege2RlbGV0ZWRfY291bnR9IGPhuqV1IGjDrG5oIEdvTGlrZSB0csO5bmcgbOG6t3AiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHjDs2EgY+G6pXUgaMOsbmggR29MaWtlIHRyw7luZyBs4bq3cDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlIAoKICAgIGRlZiBzZXRfYWNjb3VudF9pbmFjdGl2ZV91bnRpbF9uZXh0X3Jlc2V0KHNlbGYsIGFjY291bnRfaWQ6IGludCwgaW5hY3RpdmVfcmVhc29uOiBzdHIgPSAixJDDoyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGpvYiBow6BuZyBuZ8OgeSIpIC0+IGJvb2w6CiAgICAgICAgIiIixJDhurd0IHTDoGkga2hv4bqjbiB2w6BvIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUgxJHhur9uIGdp4budIHJlc2V0IHRp4bq/cCB0aGVvIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbXBvcnQgZGF0ZXRpbWUsIGNvbmZpZywgdGltZQogICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmdldF9hY2NvdW50KGFjY291bnRfaWQpCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgcHJpbnQoZiJbREJdIEtow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gY8OzIElEIHthY2NvdW50X2lkfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgIyBHaeG7nSByZXNldAogICAgICAgICAgICBqb2JfaG91ciA9IHNlbGYuZ2V0KCJqb2JfaG91ciIsIGNvbmZpZy5KT0JfSE9VUikKICAgICAgICAgICAgbm93ID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkKICAgICAgICAgICAgbmV4dF9yZXNldCA9IG5vdy5yZXBsYWNlKGhvdXI9am9iX2hvdXIsIG1pbnV0ZT0wLCBzZWNvbmQ9MCwgbWljcm9zZWNvbmQ9MCkKICAgICAgICAgICAgaWYgbm93ID49IG5leHRfcmVzZXQ6CiAgICAgICAgICAgICAgICBuZXh0X3Jlc2V0ID0gbmV4dF9yZXNldCArIGRhdGV0aW1lLnRpbWVkZWx0YShkYXlzPTEpCiAgICAgICAgICAgIGpvYl9kaXNhYmxlX3VudGlsID0gaW50KG5leHRfcmVzZXQudGltZXN0YW1wKCkpCiAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJpbmFjdGl2ZSIsCiAgICAgICAgICAgICAgICAiam9iX2Rpc2FibGVfdW50aWwiOiBqb2JfZGlzYWJsZV91bnRpbCwKICAgICAgICAgICAgICAgICJqb2JzX2RvbmVfaW5fc2Vzc2lvbiI6IDAsCiAgICAgICAgICAgICAgICAiZm9sbG93X2luX3Nlc3Npb24iOiAwLAogICAgICAgICAgICAgICAgImluYWN0aXZlX3JlYXNvbiI6IGluYWN0aXZlX3JlYXNvbiwKICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnVwZGF0ZV9hY2NvdW50KGFjY291bnRfaWQsIHVwZGF0ZV9kYXRhKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJbREJdIEzhu5dpIHNldF9hY2NvdW50X2luYWN0aXZlX3VudGlsX25leHRfcmVzZXQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBzZXRfYWNjb3VudF9pbmFjdGl2ZShzZWxmLCBhY2NvdW50X2lkOiBpbnQsIGNvb2xkb3duX21pbnV0ZXM6IGludCA9IE5vbmUsIGluYWN0aXZlX3JlYXNvbjogc3RyID0gIsSQw6MgaG/DoG4gdGjDoG5oIHPhu5Egam9iIHRyb25nIHBoacOqbiIpIC0+IGJvb2w6CiAgICAgICAgIiIixJDhurd0IHTDoGkga2hv4bqjbiB2w6BvIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUgdHJvbmcga2hv4bqjbmcgdGjhu51pIGdpYW4gKHBow7p0KSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0IHRpbWUsIGNvbmZpZwogICAgICAgICAgICBhY2NvdW50ID0gc2VsZi5nZXRfYWNjb3VudChhY2NvdW50X2lkKQogICAgICAgICAgICBpZiBub3QgYWNjb3VudDoKICAgICAgICAgICAgICAgIHByaW50KGYiW0RCXSBLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIGPDsyBJRCB7YWNjb3VudF9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGlmIGNvb2xkb3duX21pbnV0ZXMgaXMgTm9uZToKICAgICAgICAgICAgICAgIGNvb2xkb3duX21pbnV0ZXMgPSBzZWxmLmdldCgiam9iX2Nvb2xkb3duX21pbnV0ZXMiLCBjb25maWcuREVGQVVMVF9DT09MRE9XTl9NSU5VVEVTKQogICAgICAgICAgICBqb2JfZGlzYWJsZV91bnRpbCA9IGludCh0aW1lLnRpbWUoKSArIGNvb2xkb3duX21pbnV0ZXMgKiA2MCkKICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAic3RhdHVzIjogImluYWN0aXZlIiwKICAgICAgICAgICAgICAgICJqb2JfZGlzYWJsZV91bnRpbCI6IGpvYl9kaXNhYmxlX3VudGlsLAogICAgICAgICAgICAgICAgImpvYnNfZG9uZV9pbl9zZXNzaW9uIjogMCwKICAgICAgICAgICAgICAgICJmb2xsb3dfaW5fc2Vzc2lvbiI6IDAsCiAgICAgICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogaW5hY3RpdmVfcmVhc29uLAogICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYudXBkYXRlX2FjY291bnQoYWNjb3VudF9pZCwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIltEQl0gTOG7l2kgc2V0X2FjY291bnRfaW5hY3RpdmU6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZSAKCiAgICBkZWYgc2V0X2FjY291bnRfaW5hY3RpdmVfZm9sbG93X3VudGlsX25leHRfcmVzZXQoc2VsZiwgYWNjb3VudF9pZDogaW50LCByZWFzb246IHN0ciA9ICJGb2xsb3cgcGVuZGluZy9saW1pdCIpIC0+IGJvb2w6CiAgICAgICAgIiIiQ2jhu4kga2jDs2EgY2jhu6ljIG7Eg25nIEZPTExPVyBj4bunYSB0w6BpIGtob+G6o24gdOG7m2kgZ2nhu50gcmVzZXQgdGnhur9wIHRoZW8iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGltcG9ydCBkYXRldGltZSwgY29uZmlnLCB0aW1lCiAgICAgICAgICAgIGFjYyA9IHNlbGYuZ2V0X2FjY291bnQoYWNjb3VudF9pZCkKICAgICAgICAgICAgaWYgbm90IGFjYzoKICAgICAgICAgICAgICAgIHByaW50KGYiW0RCXSBLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHthY2NvdW50X2lkfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgam9iX2hvdXIgPSBzZWxmLmdldCgiam9iX2hvdXIiLCBjb25maWcuSk9CX0hPVVIpCiAgICAgICAgICAgIG5vdyA9IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpCiAgICAgICAgICAgIG5leHRfcmVzZXQgPSBub3cucmVwbGFjZShob3VyPWpvYl9ob3VyLCBtaW51dGU9MCwgc2Vjb25kPTAsIG1pY3Jvc2Vjb25kPTApCiAgICAgICAgICAgIGlmIG5vdyA+PSBuZXh0X3Jlc2V0OgogICAgICAgICAgICAgICAgbmV4dF9yZXNldCArPSBkYXRldGltZS50aW1lZGVsdGEoZGF5cz0xKQogICAgICAgICAgICBzZWxmLnVwZGF0ZV9hY2NvdW50KGFjY291bnRfaWQsIHsKICAgICAgICAgICAgICAgICJkaXNhYmxlX2ZvbGxvdyI6IFRydWUsCiAgICAgICAgICAgICAgICAiZm9sbG93X2Rpc2FibGVfdW50aWwiOiBpbnQobmV4dF9yZXNldC50aW1lc3RhbXAoKSksCiAgICAgICAgICAgICAgICAiaW5hY3RpdmVfZm9sbG93X3JlYXNvbiI6IHJlYXNvbiwKICAgICAgICAgICAgICAgICJmb2xsb3dfaW5fc2Vzc2lvbiI6IDAsCiAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIltEQl0gTOG7l2kgc2V0X2FjY291bnRfaW5hY3RpdmVfZm9sbG93X3VudGlsX25leHRfcmVzZXQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBzZXRfYWNjb3VudF9pbmFjdGl2ZV9mb2xsb3coc2VsZiwgYWNjb3VudF9pZDogaW50LCBjb29sZG93bl9taW51dGVzOiBpbnQgPSBOb25lLCByZWFzb246IHN0ciA9ICJGb2xsb3cgcGVuZGluZy9saW1pdCIpIC0+IGJvb2w6CiAgICAgICAgIiIiS2jDs2EgRk9MTE9XIHRyb25nIG3hu5l0IGtob+G6o25nIHRo4budaSBnaWFuIChwaMO6dCkiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGltcG9ydCB0aW1lLCBjb25maWcKICAgICAgICAgICAgYWNjID0gc2VsZi5nZXRfYWNjb3VudChhY2NvdW50X2lkKQogICAgICAgICAgICBpZiBub3QgYWNjOgogICAgICAgICAgICAgICAgcHJpbnQoZiJbREJdIEtow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24ge2FjY291bnRfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBpZiBjb29sZG93bl9taW51dGVzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBjb29sZG93bl9taW51dGVzID0gc2VsZi5nZXQoImpvYl9jb29sZG93bl9taW51dGVzIiwgY29uZmlnLkRFRkFVTFRfQ09PTERPV05fTUlOVVRFUykKICAgICAgICAgICAgc2VsZi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB7CiAgICAgICAgICAgICAgICAiZGlzYWJsZV9mb2xsb3ciOiBUcnVlLAogICAgICAgICAgICAgICAgImZvbGxvd19kaXNhYmxlX3VudGlsIjogaW50KHRpbWUudGltZSgpICsgY29vbGRvd25fbWludXRlcyAqIDYwKSwKICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIjogcmVhc29uLAogICAgICAgICAgICAgICAgImZvbGxvd19pbl9zZXNzaW9uIjogMCwKICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiW0RCXSBM4buXaSBzZXRfYWNjb3VudF9pbmFjdGl2ZV9mb2xsb3c6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgZ2V0X2FjY291bnRzX2J5X2FwcF9hbmRfZ29saWtlX3N0YXR1cyhzZWxmLCBhcHA6IHN0ciwgaXNfbGlua2VkOiBib29sID0gRmFsc2UpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIHRoZW8gYXBwIHbDoCB0cuG6oW5nIHRow6FpIGdvbGlrZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFwcDogVMOqbiDhu6luZyBk4bulbmcgKGluc3RhZ3JhbSwgdGlrdG9rLCAuLi4pCiAgICAgICAgICAgIGlzX2xpbmtlZDogVHJ1ZSBu4bq/dSBs4bqleSB0w6BpIGtob+G6o24gxJHDoyBsacOqbiBr4bq/dCwgRmFsc2UgbuG6v3UgbOG6pXkgdMOgaSBraG/huqNuIGNoxrBhIGxpw6puIGvhur90CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgIHF1ZXJ5ID0gIlNFTEVDVCAqIEZST00gYWNjb3VudHMgV0hFUkUgYXBwID0gPyBBTkQgaXNfZ29saWtlX2xpbmtlZCA9ID8iCiAgICAgICAgcGFyYW1zID0gW2FwcCwgMSBpZiBpc19saW5rZWQgZWxzZSAwXQogICAgICAgIAogICAgICAgICMgTOG7jWMgdGhlbyBkZXZpY2VfaWQgY+G7p2EgdGhp4bq/dCBi4buLIGhp4buHbiB04bqhaQogICAgICAgIGN1cnJlbnRfZGV2aWNlX2lkID0gc2VsZi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgaWYgY3VycmVudF9kZXZpY2VfaWQ6CiAgICAgICAgICAgIHF1ZXJ5ICs9ICIgQU5EIGRldmljZV9pZCA9ID8iCiAgICAgICAgICAgIHBhcmFtcy5hcHBlbmQoY3VycmVudF9kZXZpY2VfaWQpCiAgICAgICAgCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUocXVlcnksIHBhcmFtcykKICAgICAgICBjb2x1bW5fbmFtZXMgPSBbZGVzY3JpcHRpb25bMF0gZm9yIGRlc2NyaXB0aW9uIGluIGN1cnNvci5kZXNjcmlwdGlvbl0KICAgICAgICByZXN1bHRzID0gY3Vyc29yLmZldGNoYWxsKCkKICAgICAgICAKICAgICAgICBhY2NvdW50cyA9IFtdCiAgICAgICAgZm9yIHJlc3VsdCBpbiByZXN1bHRzOgogICAgICAgICAgICAjIENodXnhu4NuIMSR4buVaSBr4bq/dCBxdeG6oyB0aMOgbmggZGljdAogICAgICAgICAgICBhY2NvdW50ID0ge2NvbHVtbl9uYW1lc1tpXTogcmVzdWx0W2ldIGZvciBpIGluIHJhbmdlKGxlbihjb2x1bW5fbmFtZXMpKX0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGPDoWMgdHLGsOG7nW5nIGJvb2xlYW4KICAgICAgICAgICAgYWNjb3VudFsiaXNfbG9naW4iXSA9IGJvb2woYWNjb3VudFsiaXNfbG9naW4iXSkKICAgICAgICAgICAgYWNjb3VudFsiam9iX2VuYWJsZSJdID0gYm9vbChhY2NvdW50WyJqb2JfZW5hYmxlIl0pCiAgICAgICAgICAgIGFjY291bnRbImlzX2dvbGlrZV9saW5rZWQiXSA9IGJvb2woYWNjb3VudFsiaXNfZ29saWtlX2xpbmtlZCJdKQogICAgICAgICAgICBhY2NvdW50WyJpc19zeW5jIl0gPSBib29sKGFjY291bnRbImlzX3N5bmMiXSkKICAgICAgICAgICAgaWYgImRpc2FibGVfZm9sbG93IiBpbiBhY2NvdW50OgogICAgICAgICAgICAgICAgYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXSA9IGJvb2woYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gZOG7ryBsaeG7h3UgcGjhu6UgdOG7qyB0csaw4budbmcgZGF0YQogICAgICAgICAgICBpZiAiZGF0YSIgaW4gYWNjb3VudCBhbmQgYWNjb3VudFsiZGF0YSJdOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGV4dHJhX2RhdGEgPSBqc29uLmxvYWRzKGFjY291bnRbImRhdGEiXSkKICAgICAgICAgICAgICAgICAgICBhY2NvdW50LnVwZGF0ZShleHRyYV9kYXRhKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDs2EgdHLGsOG7nW5nIGRhdGEgxJHhu4MgdHLDoW5oIHRyw7luZyBs4bq3cAogICAgICAgICAgICBpZiAiZGF0YSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgICAgIGRlbCBhY2NvdW50WyJkYXRhIl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBhY2NvdW50cy5hcHBlbmQoYWNjb3VudCkKICAgICAgICAKICAgICAgICByZXR1cm4gYWNjb3VudHM=').decode('utf-8'))
