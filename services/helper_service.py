import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHJlCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBvcwppbXBvcnQgY29uZmlnCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCBxdW90ZSwgdW5xdW90ZQpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBPcHRpb25hbCwgVHVwbGUsIExpc3QsIFVuaW9uCnRyeToKICAgIGZyb20gbHhtbCBpbXBvcnQgZXRyZWUKICAgIExYTUxfQVZBSUxBQkxFID0gVHJ1ZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBMWE1MX0FWQUlMQUJMRSA9IEZhbHNlCgpjbGFzcyBIZWxwZXJTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGJhc2VfdXJsOiBzdHIgPSAiaHR0cDovL2xvY2FsaG9zdDo4MDgwIiwgZGJfc2VydmljZT1Ob25lKToKICAgICAgICBzZWxmLmJhc2VfdXJsID0gYmFzZV91cmwKICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHNlbGYuZGV2aWNlX2lwID0gTm9uZQogICAgICAgIHNlbGYuZGJfc2VydmljZSA9IGRiX3NlcnZpY2UKICAgICAgICAKICAgICAgICAjIE7hur91IGJhc2VfdXJsIGNo4bupYSDEkeG7i2EgY2jhu4kgSVAsIHRo4butIGvhur90IG7hu5FpIEFEQgogICAgICAgIGlwX21hdGNoID0gcmUuc2VhcmNoKHIiaHR0cDovLyhbMC05XStcLlswLTldK1wuWzAtOV0rXC5bMC05XSspIiwgYmFzZV91cmwpCiAgICAgICAgaWYgaXBfbWF0Y2g6CiAgICAgICAgICAgIHNlbGYuZGV2aWNlX2lwID0gaXBfbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgc2VsZi5jaGVja19hbmRfY29ubmVjdF9hZGIoKQoKICAgIGRlZiBjaGVja19hbmRfY29ubmVjdF9hZGIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHbDoCBr4bq/dCBu4buRaSBBREIgdOG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgQURCIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBraMO0bmcKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJhZGIiLCAiLS12ZXJzaW9uIl0sIGNoZWNrPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEvhur90IG7hu5FpIEFEQiDEkeG6v24gdGhp4bq/dCBi4buLIHPhu60gZOG7pW5nIMSR4buLYSBjaOG7iSB04burIGNvbmZpZwogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIMSR4bq/biB0aGnhur90IGLhu4sKICAgICAgICAgICAgY29ubmVjdF9wcm9jZXNzID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbImFkYiIsICJjb25uZWN0IiwgYWRiX2FkZHJlc3NdLAogICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyBr4bq/dCBu4buRaQogICAgICAgICAgICBpZiAiY29ubmVjdGVkIiBpbiBjb25uZWN0X3Byb2Nlc3Muc3Rkb3V0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBUcnVlCiAgICAgICAgICAgICAgICBwcmludChmIsSQw6Mga+G6v3QgbuG7kWkgQURCIHRow6BuaCBjw7RuZyDEkeG6v24ge2FkYl9hZGRyZXNzfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IChzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciwgRmlsZU5vdEZvdW5kRXJyb3IpIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIEFEQjoge2V9IikKICAgICAgICAKICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfZ2V0X2FkYl9kZXZpY2VfcGFyYW0oc2VsZikgLT4gTGlzdFtzdHJdOgogICAgICAgICIiIgogICAgICAgIFRy4bqjIHbhu4EgdGhhbSBz4buRIHRoaeG6v3QgYuG7iyBjaG8gbOG7h25oIEFEQgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3Rbc3RyXTogRGFuaCBzw6FjaCBbLXMsIGRldmljZV9pZF0gaG/hurdjIGxpc3QgcuG7l25nIG7hur91IGtow7RuZyBjw7MgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIHJldHVybiBbIi1zIiwgYWRiX2FkZHJlc3NdCiAgICAgICAgcmV0dXJuIFtdCgogICAgZGVmIF9tYWtlX3JlcXVlc3Qoc2VsZiwgZW5kcG9pbnQ6IHN0ciwgcGFyYW1zOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gcmVxdWVzdCBBUEkgdsOgIHRy4bqjIHbhu4Ega+G6v3QgcXXhuqMgZOG6oW5nIEpTT04gaG/hurdjIFhNTAogICAgICAgICIiIgogICAgICAgIHVybCA9IGYie3NlbGYuYmFzZV91cmx9L3tlbmRwb2ludH0iCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRoaeG6v3QgbOG6rXAgdGltZW91dCBjaG8gcmVxdWVzdAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIENvbnRlbnQtVHlwZQogICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICMgVHLhuqMgduG7gSBYTUwgZMaw4bubaSBk4bqhbmcgdGV4dAogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLnRleHR9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgSlNPTgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlRpbWVvdXQ6CiAgICAgICAgICAgIHByaW50KGYiUmVxdWVzdCB0aW1lb3V0IGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCIpCiAgICAgICAgICAgIHNlbGYuX3Jlc3RhcnRfaGVscGVyX2FwcCgpCiAgICAgICAgICAgICMgVGjhu60gbOG6oWkgcmVxdWVzdCBzYXUga2hpIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKSAgIyBDaOG7nSAxIGdpw6J5IMSR4buDIOG7qW5nIGThu6VuZyBraOG7n2kgxJHhu5luZwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJkYXRhIjogcmVzcG9uc2UudGV4dH0KICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIlbhuqtuIGzhu5dpIHNhdSBraGkgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvciBhcyBlOgogICAgICAgICAgICAjIELhuq90IGzhu5dpIGvhur90IG7hu5FpIGLhu4sgdOG7qyBjaOG7kWkgaG/hurdjIGtow7RuZyB0aOG7gyBr4bq/dCBu4buRaQogICAgICAgICAgICBwcmludChmIkzhu5dpIGvhur90IG7hu5FpIGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgc2VsZi5fcmVzdGFydF9oZWxwZXJfYXBwKCkKICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSByZXF1ZXN0IHNhdSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpICAjIENo4budIDIgZ2nDonkgxJHhu4Mg4bupbmcgZOG7pW5nIGto4bufaSDEkeG7mW5nCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29udGVudF90eXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICAgICAgaWYgJ2FwcGxpY2F0aW9uL3htbCcgaW4gY29udGVudF90eXBlIG9yIGVuZHBvaW50ID09ICdkdW1wLXNjcmVlbi14bWwnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgImRhdGEiOiByZXNwb25zZS50ZXh0fQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIHJlcXVlc3Q6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQoKICAgIGRlZiBfcmVzdGFydF9oZWxwZXJfYXBwKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBz4butIGThu6VuZyBBREIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgaGVscGVyIGFwcCBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCAiYW0iLCAic3RhcnQiLCAiLW4iLCAiY29tLmRuZHZpbmEuaGVscGVyLy5NYWluQWN0aXZpdHkiXQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcHJpbnQoIsSQw6Mga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIktow7RuZyB0aOG7gyBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHbDrCBBREIgY2jGsGEgxJHGsOG7o2Mga+G6v3QgbuG7kWkiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgdGFwKHNlbGYsIHg6IGludCwgeTogaW50KSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaOG6oW0gdsOgbyB24buLIHRyw60geCx5IHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJ0YXAiLCBwYXJhbXM9eyJ4IjogeCwgInkiOiB5fSkKCiAgICBkZWYgdGFwX2VsZW1lbnQoc2VsZiwgYm91bmRzOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIG3hu5l0IHBo4bqnbiB04butIGThu7FhIHRyw6puIGJvdW5kcyBj4bunYSBuw7MKICAgICAgICBGb3JtYXQgYm91bmRzOiAiW3gxLHkxXVt4Mix5Ml0iIGhv4bq3YyBlbGVtZW50IGRpY3QKICAgICAgICAiIiIKICAgICAgICAjIE7hur91IGJvdW5kcyBsw6AgbeG7mXQgZGljdCAoZWxlbWVudCksIGzhuqV5IGJvdW5kcyBzdHJpbmcgdOG7qyDEkcOzCiAgICAgICAgaWYgaXNpbnN0YW5jZShib3VuZHMsIGRpY3QpOgogICAgICAgICAgICBib3VuZHMgPSBib3VuZHMuZ2V0KCJib3VuZHMiLCAiWzAsMF1bMCwwXSIpCiAgICAgICAgICAgIAogICAgICAgICMgVGjhu60gY8OhYyBwYXR0ZXJuIGtow6FjIG5oYXUgxJHhu4MgcGFyc2UgYm91bmRzLCBjaG8gcGjDqXAgc+G7kSDDom0KICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgciJcWygtP1xkKyksKC0/XGQrKVxdXFsoLT9cZCspLCgtP1xkKylcXSIsICAjIFt4MSx5MV1beDIseTJdIHbhu5tpIHPhu5Egw6JtCiAgICAgICAgICAgIHIiKC0/XGQrKSwoLT9cZCspLCgtP1xkKyksKC0/XGQrKSIsICAgICAgICAgIyB4MSx5MSx4Mix5MgogICAgICAgICAgICByIlxbKC0/XGQrKTsoLT9cZCspXF1cWygtP1xkKyk7KC0/XGQrKVxdIiAgICMgW3gxO3kxXVt4Mjt5Ml0KICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUubWF0Y2gocGF0dGVybiwgYm91bmRzKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIHgxLCB5MSwgeDIsIHkyID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHByaW50KGYiT3JpZ2luYWwgYm91bmRzOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFPhu61hIGNo4buvYSBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4cKICAgICAgICAgICAgICAgIGlmIHkxIDwgMCBvciB5MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJGaXhpbmcgbmVnYXRpdmUgWSBjb29yZGluYXRlcy4uLiIpCiAgICAgICAgICAgICAgICAgICAgaWYgeTIgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBhYnMoeTIgLSB5MSkKICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSBtYXgoMCwgeTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHkyID0geTEgKyBoZWlnaHQKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJBZGp1c3RlZCBZOiB5MT17eTF9LCB5Mj17eTJ9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgeDEgPCAwIG9yIHgyIDwgMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkZpeGluZyBuZWdhdGl2ZSBYIGNvb3JkaW5hdGVzLi4uIikKICAgICAgICAgICAgICAgICAgICBpZiB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gYWJzKHgyIC0geDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gbWF4KDAsIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHgxICsgd2lkdGgKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJBZGp1c3RlZCBYOiB4MT17eDF9LCB4Mj17eDJ9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGJvdW5kcyBo4bujcCBs4buHIHNhdSBraGkgxJFp4buBdSBjaOG7iW5oCiAgICAgICAgICAgICAgICBpZiB4MSA+PSB4MiBvciB5MSA+PSB5MjoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkludmFsaWQgYm91bmRzIGFmdGVyIGFkanVzdG1lbnQ6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ2jhu41uIG3hu5l0IMSRaeG7g20gdHJvbmcgYm91bmRzIHbhu5tpIG1hcmdpbiBhbiB0b8OgbgogICAgICAgICAgICAgICAgbWFyZ2luID0gbWluKDMsICh4MiAtIHgxKSAvLyA0LCAoeTIgLSB5MSkgLy8gNCkgICMgRHluYW1pYyBtYXJnaW4KICAgICAgICAgICAgICAgIG1hcmdpbiA9IG1heCgxLCBtYXJnaW4pICAjIMONdCBuaOG6pXQgMXB4IG1hcmdpbgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB4ID0gcmFuZG9tLnJhbmRpbnQoeDEgKyBtYXJnaW4sIG1heCh4MSArIG1hcmdpbiArIDEsIHgyIC0gbWFyZ2luKSkKICAgICAgICAgICAgICAgIHkgPSByYW5kb20ucmFuZGludCh5MSArIG1hcmdpbiwgbWF4KHkxICsgbWFyZ2luICsgMSwgeTIgLSBtYXJnaW4pKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwcmludChmIkZpbmFsIHRhcCBjb29yZGluYXRlczogKHt4fSwge3l9KSB3aXRoIG1hcmdpbiB7bWFyZ2lufSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcCh4LCB5KQogICAgICAgIAogICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogZiLEkOG7i25oIGThuqFuZyBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4c6IHtib3VuZHN9In0KCiAgICBkZWYgc3dpcGVfdXAoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IGzDqm4gdOG7qyB24buLIHRyw60gbmfhuqt1IG5oacOqbiBwaMO5IGjhu6NwCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGVfdXAiKQoKICAgIGRlZiBzd2lwZV9kb3duKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCB4deG7kW5nIHThu6sgduG7iyB0csOtIG5n4bqrdSBuaGnDqm4gcGjDuSBo4bujcAogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX2Rvd24iKQoKICAgIGRlZiBpbnB1dF90ZXh0KHNlbGYsIHRleHQ6IHN0ciwgc3BlZWQ6IGZsb2F0ID0gMS4wLCAKICAgICAgICAgICAgICAgICAgZGlyZWN0X21vZGU6IGJvb2wgPSBGYWxzZSwgcGVyZmVjdF9tb2RlOiBib29sID0gVHJ1ZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTcO0IHBo4buPbmcgZ8O1IHBow61tIHbhu5tpIHThu5FjIMSR4buZIG5n4bqrdSBuaGnDqm4gZ2nhu5FuZyBuZ8aw4budaSB0aOG6rXQKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICJ0ZXh0IjogdGV4dCwKICAgICAgICAgICAgInNwZWVkIjogc3BlZWQsCiAgICAgICAgICAgICJkaXJlY3RfbW9kZSI6IHN0cihkaXJlY3RfbW9kZSkubG93ZXIoKSwKICAgICAgICAgICAgInBlcmZlY3RfbW9kZSI6IHN0cihwZXJmZWN0X21vZGUpLmxvd2VyKCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgiaW5wdXRfdGV4dCIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIHNob3dfdG9hc3Qoc2VsZiwgbWVzc2FnZTogc3RyLCB0eXBlXzogc3RyID0gImluZm8iLCAKICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHN0ciA9ICJib3R0b20iKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBIaeG7g24gdGjhu4sgdGjDtG5nIGLDoW8gdG9hc3QKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgInR5cGUiOiB0eXBlXywKICAgICAgICAgICAgInBvc2l0aW9uIjogcG9zaXRpb24KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgidG9hc3QtbWVzc2FnZSIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIGdldF9kZXZpY2VfaW5mbyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIGNoaSB0aeG6v3QgduG7gSB0aGnhur90IGLhu4sKICAgICAgICAiIiIKICAgICAgICByZXN1bHQgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImRldmljZS1pbmZvIikKICAgICAgICAKICAgICAgICAjIE7hur91IGvhur90IHF14bqjIHRow6BuaCBjw7RuZywgdGjDqm0gdGjDtG5nIHRpbiBpbnRlcm5ldCBJUAogICAgICAgIGlmIHJlc3VsdC5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIHJlc3VsdDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSBpbnRlcm5ldCBJUCBi4bqxbmcgcmVxdWVzdHMKICAgICAgICAgICAgICAgIGludGVybmV0X2lwID0gc2VsZi5fZ2V0X2ludGVybmV0X2lwKCkKICAgICAgICAgICAgICAgIGlmIGludGVybmV0X2lwOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJpbnRlcm5ldF9pcCJdID0gaW50ZXJuZXRfaXAKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bImludGVybmV0X2lwIl0gPSAidW5rbm93biIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgaW50ZXJuZXQgSVA6IHtlfSIpCiAgICAgICAgICAgICAgICByZXN1bHRbImRhdGEiXVsiaW50ZXJuZXRfaXAiXSA9ICJlcnJvciIKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAKICAgIGRlZiBfZ2V0X2ludGVybmV0X2lwKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSDEkeG7i2EgY2jhu4kgSVAgY8O0bmcgY+G7mW5nIGLhurFuZyByZXF1ZXN0cwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogxJDhu4thIGNo4buJIElQIGPDtG5nIGPhu5luZyBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIiwgdGltZW91dD0zKQogICAgICAgICAgICBpcCA9IHJlc3BvbnNlLnRleHQuc3RyaXAoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIMSR4buLbmggZOG6oW5nIElQIMSRxqFuIGdp4bqjbgogICAgICAgICAgICBpZiByZS5tYXRjaChyJ15cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9JCcsIGlwKToKICAgICAgICAgICAgICAgIHJldHVybiBpcAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJL4bq/dCBxdeG6oyBraMO0bmcgcGjhuqNpIGzDoCBJUCBo4bujcCBs4buHOiB7aXB9IikKICAgICAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuVGltZW91dDoKICAgICAgICAgICAgcHJpbnQoIlRpbWVvdXQga2hpIGzhuqV5IGludGVybmV0IElQICgzIGdpw6J5KSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgaW50ZXJuZXQgSVA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraMO0bmcgeMOhYyDEkeG7i25oIGtoaSBs4bqleSBpbnRlcm5ldCBJUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIGNoZWNrX2ludGVybmV0KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSBr4bq/dCBu4buRaSBpbnRlcm5ldAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIGvhur90IG7hu5FpIGludGVybmV0LCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVGjhu60ga+G6v3QgbuG7kWkgxJHhur9uIEdvb2dsZSBETlMgduG7m2kgdGltZW91dCBuZ+G6r24KICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vOC44LjguOCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFRo4butIHbhu5tpIG3hu5l0IGRvbWFpbiBraMOhYwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vd3d3Lmdvb2dsZS5jb20iLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGdldF9sb2NhbF9pcChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgxJHhu4thIGNo4buJIElQIGxvY2FsIGPhu6dhIHRoaeG6v3QgYuG7iyB04burIGRldmljZSBpbmZvCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiDEkOG7i2EgY2jhu4kgSVAgbG9jYWwgaG/hurdjIGNodeG7l2kgcuG7l25nIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgIGlmIGRldmljZV9pbmZvLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gZGV2aWNlX2luZm86CiAgICAgICAgICAgICAgICByZXR1cm4gZGV2aWNlX2luZm9bImRhdGEiXS5nZXQoImxvY2FsX2lwIiwgIiIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgbG9jYWwgSVA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBkdW1wX3NjcmVlbl94bWwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIER1bXAgdG/DoG4gYuG7mSBj4bqldSB0csO6YyBYTUwgY+G7p2EgbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBUcuG6oyB24buBIG7hu5lpIGR1bmcgWE1MIGTGsOG7m2kgZOG6oW5nIGNodeG7l2kKICAgICAgICAiIiIKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiZHVtcC1zY3JlZW4teG1sIikKICAgICAgICBpZiByZXNwb25zZVsic3RhdHVzIl0gPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXQogICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBvcGVuX2FwcChzZWxmLCBwYWNrYWdlOiBzdHIsIGFjdGl2aXR5OiBzdHIgPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBN4bufIG3hu5l0IOG7qW5nIGThu6VuZyB24bubaSBwYWNrYWdlIG5hbWUgdsOgIGFjdGl2aXR5IGPhu6UgdGjhu4MKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7InBhY2thZ2UiOiBwYWNrYWdlfQogICAgICAgIGlmIGFjdGl2aXR5OgogICAgICAgICAgICBwYXJhbXNbImFjdGl2aXR5Il0gPSBhY3Rpdml0eQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoIm9wZW5fYXBwIiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgY2xvc2VfYXBwKHNlbGYsIHBhY2thZ2U6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgxJDDs25nIG3hu5l0IOG7qW5nIGThu6VuZyDEkWFuZyBjaOG6oXkKICAgICAgICDGr3UgdGnDqm4gc+G7rSBk4bulbmcgQURCIG7hur91IMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICAiIiIKICAgICAgICBpZiBzZWxmLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkMOzbmcg4bupbmcgZOG7pW5nIGLhurFuZyBBREIKICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJzaGVsbCIsIGYiYW0gZm9yY2Utc3RvcCB7cGFja2FnZX0iXQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJtZXNzYWdlIjogZiLEkMOjIMSRw7NuZyB7cGFja2FnZX0gYuG6sW5nIEFEQiJ9CiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHDs25nIOG7qW5nIGThu6VuZyBi4bqxbmcgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgIyBO4bq/dSBs4buXaSwgdGjhu60gcGjGsMahbmcgdGjhu6ljIEhUVFAKICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIEhUVFAgQVBJIG7hur91IGtow7RuZyBjw7MgQURCIGhv4bq3YyBBREIgYuG7iyBs4buXaQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2hvbWUiKQoKICAgIGRlZiBfc2FuaXRpemVfeG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MIMSR4buDIHRyw6FuaCBs4buXaSBraGkgcGjDom4gdMOtY2gKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogQ2h14buXaSBYTUwgY+G6p24geOG7rSBsw70KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBDaHXhu5dpIFhNTCDEkcOjIMSRxrDhu6NjIHjhu60gbMO9CiAgICAgICAgIiIiCiAgICAgICAgIyBUaGF5IHRo4bq/IGPDoWMga8O9IHThu7EgJiBraMO0bmcgaOG7o3AgbOG7hyBi4bqxbmcgJmFtcDsKICAgICAgICAjIE5oxrBuZyBnaeG7ryBuZ3V5w6puIGPDoWMgZW50aXR5IGjhu6NwIGzhu4cgbmjGsCAmYW1wOywgJmx0OywgJmd0OywgJnF1b3Q7LCAmYXBvczsKICAgICAgICB4bWxfY29udGVudCA9IHJlLnN1YihyJyYoPyEoYW1wfGx0fGd0fHF1b3R8YXBvcyk7KScsICcmYW1wOycsIHhtbF9jb250ZW50KQogICAgICAgIAogICAgICAgICMgTG/huqFpIGLhu48gY8OhYyBrw70gdOG7sSDEkWnhu4F1IGtoaeG7g24ga2jDtG5nIGjhu6NwIGzhu4cgdHJvbmcgWE1MCiAgICAgICAgeG1sX2NvbnRlbnQgPSByZS5zdWIocidbXHgwMC1ceDA4XHgwQlx4MENceDBFLVx4MUZdJywgJycsIHhtbF9jb250ZW50KQogICAgICAgIAogICAgICAgIHJldHVybiB4bWxfY29udGVudAoKICAgIGRlZiBmaW5kX2VsZW1lbnRfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIAogICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gcGjhuqduIHThu60gdHJvbmcgWE1MIGThu7FhIHRyw6puIHRleHQsIGNvbnRlbnQtZGVzYywgcmVzb3VyY2UtaWQsIGNsYXNzIGhv4bq3YyB2aXNpYmxlLXRvLXVzZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IFBo4bqnbiB04butIMSR4bqndSB0acOqbiB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjDonkgZOG7sW5nIFhQYXRoIHF1ZXJ5IGThu7FhIHRyw6puIGPDoWMgxJFp4buBdSBraeG7h24KICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0B0ZXh0PSJ7dGV4dH0iJykKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0BjbGFzcz0ie2NsYXNzX25hbWV9IicpCiAgICAgICAgICAgICAgICBpZiB2aXNpYmxlX3RvX3VzZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV92YWx1ZSA9ICJ0cnVlIiBpZiB2aXNpYmxlX3RvX3VzZXIgZWxzZSAiZmFsc2UiCiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdmlzaWJsZS10by11c2VyPSJ7dmlzaWJsZV92YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgPSAiLy9ub2RlIgogICAgICAgICAgICAgICAgaWYgY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSArPSAiWyIgKyAiIGFuZCAiLmpvaW4oY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHBo4bqnbiB04butIMSR4bqndSB0acOqbiBwaMO5IGjhu6NwCiAgICAgICAgICAgICAgICBlbGVtZW50ID0gcm9vdC54cGF0aCh4cGF0aF9xdWVyeSkKICAgICAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VsZW1lbnRfdG9fZGljdChlbGVtZW50WzBdKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIHBo4bqnbiB04butIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4CiAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgcGF0dGVybiA9IGYndGV4dD0ie3RleHR9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIHRleHQKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KQogICAgICAgIAogICAgICAgIGlmIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgcGF0dGVybiA9IGYnY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInCiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNo4bupYSBjb250ZW50LWRlc2MKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KQogICAgICAgIAogICAgICAgIGlmIHJlc291cmNlX2lkOgogICAgICAgICAgICBwYXR0ZXJuID0gZidyZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInCiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNo4bupYSByZXNvdXJjZS1pZAogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgaWYgY2xhc3NfbmFtZToKICAgICAgICAgICAgcGF0dGVybiA9IGYnY2xhc3M9IntjbGFzc19uYW1lfSInCiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNo4bupYSBjbGFzcwogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIGZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHBo4bqnbiB04butIHRyb25nIFhNTCBwaMO5IGjhu6NwIHbhu5tpIMSRaeG7gXUga2nhu4duCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IE7hu5lpIGR1bmcgWE1MCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggY8OhYyBwaOG6p24gdOG7rSB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIHJlc3VsdHMgPSBbXQogICAgICAgIAogICAgICAgIGlmIG5vdCB4bWxfY29udGVudDoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHMKICAgICAgICAgICAgCiAgICAgICAgaWYgTFhNTF9BVkFJTEFCTEU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTCDEkeG7gyB0csOhbmggbOG7l2kgRW50aXR5UmVmCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyBYUGF0aCBxdWVyeSBk4buxYSB0csOqbiBjw6FjIMSRaeG7gXUga2nhu4duCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdGV4dD0ie3RleHR9IicpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2MgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAcmVzb3VyY2UtaWQ9IntyZXNvdXJjZV9pZH0iJykKICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY2xhc3M9IntjbGFzc19uYW1lfSInKQogICAgICAgICAgICAgICAgaWYgdmlzaWJsZV90b191c2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdmFsdWUgPSAidHJ1ZSIgaWYgdmlzaWJsZV90b191c2VyIGVsc2UgImZhbHNlIgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHZpc2libGUtdG8tdXNlcj0ie3Zpc2libGVfdmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ID0gIi8vbm9kZSIKICAgICAgICAgICAgICAgIGlmIGNvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgKz0gIlsiICsgIiBhbmQgIi5qb2luKGNvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIHBo4bqnbiB04butIHBow7kgaOG7o3AKICAgICAgICAgICAgICAgIGVsZW1lbnRzID0gcm9vdC54cGF0aCh4cGF0aF9xdWVyeSkKICAgICAgICAgICAgICAgIGZvciBlbGVtZW50IGluIGVsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2VsZW1lbnRfdG9fZGljdChlbGVtZW50KSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBwaOG6p24gdOG7rSB24bubaSBseG1sOiB7ZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiJUaOG7rSB0w6xtIHBo4bqnbiB04butIGLhurFuZyBwaMawxqFuZyB0aOG7qWMgdGhheSB0aOG6vy4uLiIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4IChjaOG7iSB0cuG6oyB24buBIGvhur90IHF14bqjIMSRxqFuIGdp4bqjbikKICAgICAgICBpZiBub3QgcmVzdWx0cyBhbmQgdGV4dDoKICAgICAgICAgICAgcGF0dGVybiA9IGYndGV4dD0ie3RleHR9IicKICAgICAgICAgICAgZm9yIG1hdGNoIGluIHJlLmZpbmRpdGVyKHBhdHRlcm4sIHhtbF9jb250ZW50KToKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzCiAgICAKICAgIGRlZiBfZXh0cmFjdF9hdHRyaWJ1dGVzKHNlbGYsIG5vZGVfY29udGVudDogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUcsOtY2ggeHXhuqV0IGPDoWMgdGh14buZYyB0w61uaCB04burIG7hu5lpIGR1bmcgY+G7p2EgbeG7mXQgdGjhursgbm9kZQogICAgICAgICIiIgogICAgICAgIGF0dHJpYnV0ZXMgPSB7fQogICAgICAgIAogICAgICAgICMgQ8OhYyB0aHXhu5ljIHTDrW5oIGPhuqduIHRyw61jaCB4deG6pXQKICAgICAgICBhdHRyX3BhdHRlcm5zID0gewogICAgICAgICAgICAiY2xhc3MiOiByJ2NsYXNzPSIoW14iXSopIicsCiAgICAgICAgICAgICJwYWNrYWdlIjogcidwYWNrYWdlPSIoW14iXSopIicsCiAgICAgICAgICAgICJyZXNvdXJjZS1pZCI6IHIncmVzb3VyY2UtaWQ9IihbXiJdKikiJywKICAgICAgICAgICAgInRleHQiOiByJ3RleHQ9IihbXiJdKikiJywKICAgICAgICAgICAgImNvbnRlbnQtZGVzYyI6IHInY29udGVudC1kZXNjPSIoW14iXSopIicsCiAgICAgICAgICAgICJib3VuZHMiOiByJ2JvdW5kcz0iKFteIl0qKSInLAogICAgICAgICAgICAiY2hlY2thYmxlIjogcidjaGVja2FibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImNoZWNrZWQiOiByJ2NoZWNrZWQ9IihbXiJdKikiJywKICAgICAgICAgICAgImNsaWNrYWJsZSI6IHInY2xpY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJlbmFibGVkIjogcidlbmFibGVkPSIoW14iXSopIicsCiAgICAgICAgICAgICJmb2N1c2FibGUiOiByJ2ZvY3VzYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAiZm9jdXNlZCI6IHInZm9jdXNlZD0iKFteIl0qKSInLAogICAgICAgICAgICAic2Nyb2xsYWJsZSI6IHInc2Nyb2xsYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAibG9uZy1jbGlja2FibGUiOiByJ2xvbmctY2xpY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJwYXNzd29yZCI6IHIncGFzc3dvcmQ9IihbXiJdKikiJywKICAgICAgICAgICAgInNlbGVjdGVkIjogcidzZWxlY3RlZD0iKFteIl0qKSInCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciBhdHRyX25hbWUsIHBhdHRlcm4gaW4gYXR0cl9wYXR0ZXJucy5pdGVtcygpOgogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCBub2RlX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgYXR0cmlidXRlc1thdHRyX25hbWVdID0gbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhdHRyaWJ1dGVzCgogICAgZGVmIF9lbGVtZW50X3RvX2RpY3Qoc2VsZiwgZWxlbWVudCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2h1eeG7g24gxJHhu5VpIG3hu5l0IHBo4bqnbiB04butIFhNTCB04burIGx4bWwgdGjDoG5oIGRpY3QKICAgICAgICAiIiIKICAgICAgICByZXN1bHQgPSB7fQogICAgICAgIAogICAgICAgICMgTOG6pXkgdOG6pXQgY+G6oyB0aHXhu5ljIHTDrW5oCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZWxlbWVudC5hdHRyaWIuaXRlbXMoKToKICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0CgogICAgZGVmIGZpbmRfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHBo4bqnbiB04butIHRyw6puIG3DoG4gaMOsbmggZOG7sWEgdHLDqm4gdGV4dCwgY29udGVudC1kZXNjLCByZXNvdXJjZS1pZCwgY2xhc3MgaG/hurdjIHZpc2libGUtdG8tdXNlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBQaOG6p24gdOG7rSDEkeG6p3UgdGnDqm4gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyKQoKICAgIGRlZiBmaW5kX2FsbF9lbGVtZW50cyhzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgcGjhuqduIHThu60gdHLDqm4gbcOgbiBow6xuaCBwaMO5IGjhu6NwIHbhu5tpIMSRaeG7gXUga2nhu4duCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCBjw6FjIHBo4bqnbiB04butIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHhtbF9jb250ZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIpCgogICAgZGVmIGlzX2VsZW1lbnRfc2VsZWN0ZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGNo4buNbiBoYXkga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJzZWxlY3RlZCIpID09ICJ0cnVlIgoKICAgIGRlZiB3YWl0X2Zvcl9lbGVtZW50KHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCB0aW1lb3V0OiBpbnQgPSAzMCwgCiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG3hu5l0IHBo4bqnbiB04butIHh14bqldCBoaeG7h24gdHLDqm4gbcOgbiBow6xuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgdGltZW91dDogVGjhu51pIGdpYW4gY2jhu50gdOG7kWkgxJFhIChnacOieSkKICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IEtob+G6o25nIHRo4budaSBnaWFuIGdp4buvYSBjw6FjIGzhuqduIGtp4buDbSB0cmEgKGdpw6J5KQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IFBo4bqnbiB04butIHTDrG0gdGjhuqV5IGhv4bq3YyBOb25lIG7hur91IHRpbWVvdXQKICAgICAgICAiIiIKICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5maW5kX2VsZW1lbnQodGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyKQogICAgICAgICAgICBpZiBlbGVtZW50OgogICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0aW1lLnNsZWVwKGNoZWNrX2ludGVydmFsKQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIHdhaXRfdG9fdGFwX2VsZW1lbnQoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIHRpbWVvdXQ6IGludCA9IDMwLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEsIGRlbGF5X2JlZm9yZV90YXA6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGVsZW1lbnQgeHXhuqV0IGhp4buHbiwgZGVsYXkgbeG7mXQga2hv4bqjbmcgdGjhu51pIGdpYW4sIHLhu5NpIHRhcCB2w6BvIGVsZW1lbnQKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIHRpbWVvdXQ6IFRo4budaSBnaWFuIGNo4budIHThu5FpIMSRYSDEkeG7gyB0w6xtIGVsZW1lbnQgKGdpw6J5KQogICAgICAgICAgICBjaGVja19pbnRlcnZhbDogS2hv4bqjbmcgdGjhu51pIGdpYW4gZ2nhu69hIGPDoWMgbOG6p24ga2nhu4NtIHRyYSAoZ2nDonkpCiAgICAgICAgICAgIGRlbGF5X2JlZm9yZV90YXA6IFRo4budaSBnaWFuIGRlbGF5IHRyxrDhu5tjIGtoaSB0YXAgKGdpw6J5LCBt4bq3YyDEkeG7i25oIDEgZ2nDonkpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ2jhu50gZWxlbWVudCB4deG6pXQgaGnhu4duCiAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLndhaXRfZm9yX2VsZW1lbnQoCiAgICAgICAgICAgICAgICB0ZXh0PXRleHQsIAogICAgICAgICAgICAgICAgY29udGVudF9kZXNjPWNvbnRlbnRfZGVzYywgCiAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD1yZXNvdXJjZV9pZCwgCiAgICAgICAgICAgICAgICBjbGFzc19uYW1lPWNsYXNzX25hbWUsCiAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI9dmlzaWJsZV90b191c2VyLCAKICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dCwgCiAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbD1jaGVja19pbnRlcnZhbAogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgICAgICMgVOG6oW8gdGjDtG5nIGLDoW8gbOG7l2kgY2hpIHRp4bq/dAogICAgICAgICAgICAgICAgY3JpdGVyaWEgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJ0ZXh0PSd7dGV4dH0nIikKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJjb250ZW50X2Rlc2M9J3tjb250ZW50X2Rlc2N9JyIpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZDoKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJyZXNvdXJjZV9pZD0ne3Jlc291cmNlX2lkfSciKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZToKICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoZiJjbGFzc19uYW1lPSd7Y2xhc3NfbmFtZX0nIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3JpdGVyaWFfc3RyID0gIiwgIi5qb2luKGNyaXRlcmlhKSBpZiBjcml0ZXJpYSBlbHNlICJraMO0bmcgeMOhYyDEkeG7i25oIgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdMOsbSB0aOG6pXkgZWxlbWVudCBzYXUge3RpbWVvdXR9cyB24bubaSB0acOqdSBjaMOtOiB7Y3JpdGVyaWFfc3RyfSIKICAgICAgICAgICAgICAgIHByaW50KGVycm9yX21zZykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIERlbGF5IHRyxrDhu5tjIGtoaSB0YXAKICAgICAgICAgICAgaWYgZGVsYXlfYmVmb3JlX3RhcCA+IDA6CiAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgdMOsbSB0aOG6pXkgZWxlbWVudCwgZGVsYXkge2RlbGF5X2JlZm9yZV90YXB9cyB0csaw4bubYyBraGkgdGFwLi4uIikKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoZGVsYXlfYmVmb3JlX3RhcCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGFwIHbDoG8gZWxlbWVudAogICAgICAgICAgICByZXN1bHQgPSBzZWxmLnRhcF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IHF14bqjIHRhcAogICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8gPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8uYXBwZW5kKGYidGV4dD0ne3RleHR9JyIpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9pbmZvLmFwcGVuZChmImNvbnRlbnRfZGVzYz0ne2NvbnRlbnRfZGVzY30nIikKICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkOgogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mby5hcHBlbmQoZiJyZXNvdXJjZV9pZD0ne3Jlc291cmNlX2lkfSciKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZToKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8uYXBwZW5kKGYiY2xhc3NfbmFtZT0ne2NsYXNzX25hbWV9JyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsZW1lbnRfc3RyID0gIiwgIi5qb2luKGVsZW1lbnRfaW5mbykgaWYgZWxlbWVudF9pbmZvIGVsc2UgImVsZW1lbnQiCiAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgdGFwIHRow6BuaCBjw7RuZyB2w6BvIHtlbGVtZW50X3N0cn0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7cmVzdWx0LmdldCgnbWVzc2FnZScsICdLaMO0bmcgeMOhYyDEkeG7i25oJyl9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kgdHJvbmcgd2FpdF90b190YXBfZWxlbWVudDoge3N0cihlKX0iCiAgICAgICAgICAgIHByaW50KGVycm9yX21zZykKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIGdldF9lbGVtZW50X3RleHQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0ZXh0IGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJ0ZXh0IiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jb250ZW50X2Rlc2Moc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBjb250ZW50LWRlc2MgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfcmVzb3VyY2VfaWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSByZXNvdXJjZS1pZCBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgicmVzb3VyY2UtaWQiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NsYXNzKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgY2xhc3MgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImNsYXNzIiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9lbmFibGVkKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyDEkcaw4bujYyBrw61jaCBob+G6oXQga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJlbmFibGVkIikgPT0gInRydWUiCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jbGlja2FibGUoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIHRo4buDIG5o4bqlcCB2w6BvIGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2xpY2thYmxlIikgPT0gInRydWUiCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9mb2N1c2VkKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyDEkcaw4bujYyBmb2N1cyBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImZvY3VzZWQiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NoZWNrZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGNo4buNbiBraMO0bmcgKGNobyBjaGVja2JveCkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImNoZWNrZWQiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2JvdW5kcyhzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gVHVwbGVbaW50LCBpbnQsIGludCwgaW50XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB04buNYSDEkeG7mSBib3VuZHMgY+G7p2EgcGjhuqduIHThu60gZMaw4bubaSBk4bqhbmcgdHVwbGUgKHgxLCB5MSwgeDIsIHkyKQogICAgICAgIFjhu60gbMO9IGPDoWMgdHLGsOG7nW5nIGjhu6NwIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hyAow6JtLCAwLCBob+G6t2MgZm9ybWF0IHNhaSkKICAgICAgICAiIiIKICAgICAgICBib3VuZHMgPSBlbGVtZW50LmdldCgiYm91bmRzIiwgIlswLDBdWzAsMF0iKQogICAgICAgIAogICAgICAgICMgVGjhu60gY8OhYyBwYXR0ZXJuIGtow6FjIG5oYXUgxJHhu4MgcGFyc2UgYm91bmRzCiAgICAgICAgcGF0dGVybnMgPSBbCiAgICAgICAgICAgIHIiXFsoLT9cZCspLCgtP1xkKylcXVxbKC0/XGQrKSwoLT9cZCspXF0iLCAgIyBQYXR0ZXJuIGhp4buHbiB04bqhaSwgY2hvIHBow6lwIHPhu5Egw6JtCiAgICAgICAgICAgIHIiKC0/XGQrKSwoLT9cZCspLCgtP1xkKyksKC0/XGQrKSIsICAgICAgICAgIyBQYXR0ZXJuOiB4MSx5MSx4Mix5MgogICAgICAgICAgICByIlxbKC0/XGQrKTsoLT9cZCspXF1cWygtP1xkKyk7KC0/XGQrKVxdIiAgICMgUGF0dGVybiB24bubaSBk4bqldSA7CiAgICAgICAgXQogICAgICAgIAogICAgICAgIGZvciBwYXR0ZXJuIGluIHBhdHRlcm5zOgogICAgICAgICAgICBtYXRjaCA9IHJlLm1hdGNoKHBhdHRlcm4sIGJvdW5kcykKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IG1hcChpbnQsIG1hdGNoLmdyb3VwcygpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFPhu61hIGNo4buvYSBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4cKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIHThu41hIMSR4buZIMOibSwgxJFp4buBdSBjaOG7iW5oCiAgICAgICAgICAgICAgICBpZiB5MSA8IDAgb3IgeTIgPCAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW86IEJvdW5kcyBjw7MgdOG7jWEgxJHhu5kgeSDDom06ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB5MiDDom0sIGPDsyB0aOG7gyBlbGVtZW50IG7hurFtIHRyw6puIHRoYW5oIHN0YXR1cyBiYXIKICAgICAgICAgICAgICAgICAgICBpZiB5MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICMgxJBp4buBdSBjaOG7iW5oIMSR4buDIGVsZW1lbnQgY8OzIHRo4buDIHRhcCDEkcaw4bujYwogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBhYnMoeTIgLSB5MSkgICMgQ2hp4buBdSBjYW8gZWxlbWVudAogICAgICAgICAgICAgICAgICAgICAgICB5MSA9IG1heCgwLCB5MSkgICMgxJDhuqNtIGLhuqNvIHkxID49IDAKICAgICAgICAgICAgICAgICAgICAgICAgeTIgPSB5MSArIGhlaWdodCAgIyDEkOG6t3QgeTIgZMawxqFuZwogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgxJFp4buBdSBjaOG7iW5oIGJvdW5kcyB0aMOgbmg6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHgxIDwgMCBvciB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogQm91bmRzIGPDsyB04buNYSDEkeG7mSB4IMOibTogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgICAgICAjIFTGsMahbmcgdOG7sSB24bubaSB4CiAgICAgICAgICAgICAgICAgICAgaWYgeDIgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGFicyh4MiAtIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MSA9IG1heCgwLCB4MSkKICAgICAgICAgICAgICAgICAgICAgICAgeDIgPSB4MSArIHdpZHRoCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyDEkWnhu4F1IGNo4buJbmggYm91bmRzIHRow6BuaDogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGJvdW5kcyBo4bujcCBs4buHIHNhdSBraGkgxJFp4buBdSBjaOG7iW5oCiAgICAgICAgICAgICAgICBpZiB4MSA8IHgyIGFuZCB5MSA8IHkyIGFuZCBub3QgKHgxID09IDAgYW5kIHkxID09IDAgYW5kIHgyID09IDAgYW5kIHkyID09IDApOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAoeDEsIHkxLCB4MiwgeTIpCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBraMO0bmcgcGFyc2UgxJHGsOG7o2MgaG/hurdjIHThuqV0IGPhuqMgbMOgIDAsIHRo4butIGzhuqV5IHThu6sgdGh14buZYyB0w61uaCBraMOhYwogICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW86IEtow7RuZyB0aOG7gyBwYXJzZSBib3VuZHMgJ3tib3VuZHN9JyBj4bunYSBlbGVtZW50LCB0aOG7rSBwaMawxqFuZyBwaMOhcCBraMOhYy4uLiIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7rSBs4bqleSB04burIGPDoWMgdGh14buZYyB0w61uaCBraMOhYyBu4bq/dSBjw7MKICAgICAgICB4ID0gZWxlbWVudC5nZXQoIngiLCAwKQogICAgICAgIHkgPSBlbGVtZW50LmdldCgieSIsIDApCiAgICAgICAgd2lkdGggPSBlbGVtZW50LmdldCgid2lkdGgiLCAxMDApICAjIERlZmF1bHQgd2lkdGgKICAgICAgICBoZWlnaHQgPSBlbGVtZW50LmdldCgiaGVpZ2h0IiwgNTApICAjIERlZmF1bHQgaGVpZ2h0CiAgICAgICAgCiAgICAgICAgaWYgeCBvciB5IG9yIHdpZHRoICE9IDEwMCBvciBoZWlnaHQgIT0gNTA6ICAjIEPDsyDDrXQgbmjhuqV0IG3hu5l0IHRodeG7mWMgdMOtbmgga2jDoWMgMC9kZWZhdWx0CiAgICAgICAgICAgIHJldHVybiAoeCwgeSwgeCArIHdpZHRoLCB5ICsgaGVpZ2h0KQogICAgICAgIAogICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW86IEVsZW1lbnQgYm91bmRzIGtow7RuZyBo4bujcCBs4buHLCBz4butIGThu6VuZyB04buNYSDEkeG7mSBt4bq3YyDEkeG7i25oIikKICAgICAgICByZXR1cm4gKDAsIDAsIDEwMCwgNTApICAjIEZhbGxiYWNrIGJvdW5kcyBuaOG7jwogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2VudGVyKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBUdXBsZVtpbnQsIGludF06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdOG7jWEgxJHhu5kgdHJ1bmcgdMOibSBj4bunYSBwaOG6p24gdOG7rSB24bubaSB44butIGzDvSBs4buXaSBuw6JuZyBjYW8KICAgICAgICAiIiIKICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgcHJpbnQoIkPhuqNuaCBiw6FvOiBFbGVtZW50IGzDoCBOb25lIGhv4bq3YyBy4buXbmciKQogICAgICAgICAgICByZXR1cm4gKDAsIDApCiAgICAgICAgICAgIAogICAgICAgIHgxLCB5MSwgeDIsIHkyID0gc2VsZi5nZXRfZWxlbWVudF9ib3VuZHMoZWxlbWVudCkKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgYm91bmRzIGjhu6NwIGzhu4cKICAgICAgICBpZiB4MSA+PSB4MiBvciB5MSA+PSB5MjoKICAgICAgICAgICAgYm91bmRzX3N0ciA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiIikKICAgICAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogQm91bmRzIGtow7RuZyBo4bujcCBs4buHICd7Ym91bmRzX3N0cn0nOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4csIHRy4bqjIHbhu4EgdOG7jWEgxJHhu5kgYW4gdG/DoG4g4bufIGdp4buvYSBtw6BuIGjDrG5oCiAgICAgICAgICAgIHNjcmVlbl93aWR0aCwgc2NyZWVuX2hlaWdodCA9IHNlbGYuZ2V0X3NjcmVlbl9zaXplKCkKICAgICAgICAgICAgaWYgc2NyZWVuX3dpZHRoID4gMCBhbmQgc2NyZWVuX2hlaWdodCA+IDA6CiAgICAgICAgICAgICAgICBjZW50ZXJfeCA9IHNjcmVlbl93aWR0aCAvLyAyCiAgICAgICAgICAgICAgICBjZW50ZXJfeSA9IHNjcmVlbl9oZWlnaHQgLy8gMgogICAgICAgICAgICAgICAgcmV0dXJuIChjZW50ZXJfeCwgY2VudGVyX3kpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gKDU0MCwgOTYwKSAgIyBU4buNYSDEkeG7mSBt4bq3YyDEkeG7i25oIGNobyBtw6BuIGjDrG5oIDEwODB4MTkyMAogICAgICAgIAogICAgICAgIGNlbnRlcl94ID0gKHgxICsgeDIpIC8vIDIKICAgICAgICBjZW50ZXJfeSA9ICh5MSArIHkyKSAvLyAyCiAgICAgICAgCiAgICAgICAgIyBUaMOqbSBt4buZdCBjaMO6dCByYW5kb20gxJHhu4MgdHLDoW5oIGRldGVjdGlvbiAowrEzIHBpeGVscykKICAgICAgICBjZW50ZXJfeCArPSByYW5kb20ucmFuZGludCgtMywgMykKICAgICAgICBjZW50ZXJfeSArPSByYW5kb20ucmFuZGludCgtMywgMykKICAgICAgICAKICAgICAgICAjIMSQ4bqjbSBi4bqjbyB04buNYSDEkeG7mSB0cm9uZyBwaOG6oW0gdmkgbcOgbiBow6xuaAogICAgICAgIHNjcmVlbl93aWR0aCwgc2NyZWVuX2hlaWdodCA9IHNlbGYuZ2V0X3NjcmVlbl9zaXplKCkKICAgICAgICBpZiBzY3JlZW5fd2lkdGggPiAwIGFuZCBzY3JlZW5faGVpZ2h0ID4gMDoKICAgICAgICAgICAgY2VudGVyX3ggPSBtYXgoMTAsIG1pbihjZW50ZXJfeCwgc2NyZWVuX3dpZHRoIC0gMTApKSAgIyBNYXJnaW4gMTBweCB04burIGJpw6puCiAgICAgICAgICAgIGNlbnRlcl95ID0gbWF4KDEwLCBtaW4oY2VudGVyX3ksIHNjcmVlbl9oZWlnaHQgLSAxMCkpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIChjZW50ZXJfeCwgY2VudGVyX3kpCiAgICAKICAgIGRlZiB0YXBfZWxlbWVudF9jZW50ZXIoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIHRydW5nIHTDom0gY+G7p2EgcGjhuqduIHThu60gduG7m2kgeOG7rSBsw70gbOG7l2kgbsOibmcgY2FvCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIkVsZW1lbnQgbMOgIE5vbmUgaG/hurdjIHLhu5duZyJ9CiAgICAgICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHZpc2libGUtdG8tdXNlciB0csaw4bubYwogICAgICAgICAgICB2aXNpYmxlID0gZWxlbWVudC5nZXQoInZpc2libGUtdG8tdXNlciIsICJ0cnVlIikKICAgICAgICAgICAgaWYgdmlzaWJsZSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgcHJpbnQoIkPhuqNuaCBiw6FvOiBFbGVtZW50IGPDsyB2aXNpYmxlLXRvLXVzZXI9J2ZhbHNlJywgduG6q24gdGjhu60gdGFwLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHgsIHkgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHThu41hIMSR4buZIGjhu6NwIGzhu4cKICAgICAgICAgICAgaWYgeCA8PSAwIGFuZCB5IDw9IDA6CiAgICAgICAgICAgICAgICAjIFRo4butIHBoxrDGoW5nIHBow6FwIGFsdGVybmF0aXZlIG7hur91IGdldF9lbGVtZW50X2NlbnRlciB0cuG6oyB24buBIHThu41hIMSR4buZIGtow7RuZyBo4bujcCBs4buHCiAgICAgICAgICAgICAgICBib3VuZHNfc3RyID0gZWxlbWVudC5nZXQoImJvdW5kcyIsICIiKQogICAgICAgICAgICAgICAgdGV4dCA9IGVsZW1lbnQuZ2V0KCJ0ZXh0IiwgIiIpCiAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBlbGVtZW50LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW86IGdldF9lbGVtZW50X2NlbnRlciB0cuG6oyB24buBIHThu41hIMSR4buZIGtow7RuZyBo4bujcCBs4buHICh7eH0sIHt5fSkgY2hvIGVsZW1lbnQ6IikKICAgICAgICAgICAgICAgIHByaW50KGYiICAtIGJvdW5kczoge2JvdW5kc19zdHJ9IikKICAgICAgICAgICAgICAgIHByaW50KGYiICAtIHRleHQ6ICd7dGV4dH0nIikKICAgICAgICAgICAgICAgIHByaW50KGYiICAtIGNvbnRlbnQtZGVzYzogJ3tjb250ZW50X2Rlc2N9JyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu60gdGFwIGLhurFuZyBib3VuZHMgc3RyaW5nIHRy4buxYyB0aeG6v3AKICAgICAgICAgICAgICAgIGlmIGJvdW5kc19zdHIgYW5kIGJvdW5kc19zdHIgIT0gIlswLDBdWzAsMF0iOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcF9lbGVtZW50KGJvdW5kc19zdHIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIktow7RuZyB0aOG7gyB4w6FjIMSR4buLbmggdOG7jWEgxJHhu5kgxJHhu4MgdGFwIn0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcCh4LCB5KQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6IGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7c3RyKGUpfSJ9CiAgICAKICAgIGRlZiBsb25nX3ByZXNzKHNlbGYsIHg6IGludCwgeTogaW50LCBkdXJhdGlvbjogaW50ID0gMTAwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIGdp4buvIHThuqFpIHbhu4sgdHLDrSB4LHkgdHJvbmcgbeG7mXQga2hv4bqjbmcgdGjhu51pIGdpYW4KICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICJ4IjogeCwKICAgICAgICAgICAgInkiOiB5LAogICAgICAgICAgICAiZHVyYXRpb24iOiBkdXJhdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJsb25nX3ByZXNzIiwgcGFyYW1zPXBhcmFtcykKICAgIAogICAgZGVmIGxvbmdfcHJlc3NfZWxlbWVudChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSwgZHVyYXRpb246IGludCA9IDEwMDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBnaeG7ryB04bqhaSB0cnVuZyB0w6JtIGPhu6dhIHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgeCwgeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgcmV0dXJuIHNlbGYubG9uZ19wcmVzcyh4LCB5LCBkdXJhdGlvbikKICAgIAogICAgZGVmIHN3aXBlKHNlbGYsIHN0YXJ0X3g6IGludCwgc3RhcnRfeTogaW50LCBlbmRfeDogaW50LCBlbmRfeTogaW50LCAKICAgICAgICAgICAgIGR1cmF0aW9uOiBpbnQgPSA1MDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCB04burIMSRaeG7g20gKHN0YXJ0X3gsIHN0YXJ0X3kpIMSR4bq/biDEkWnhu4NtIChlbmRfeCwgZW5kX3kpCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAic3RhcnRfeCI6IHN0YXJ0X3gsCiAgICAgICAgICAgICJzdGFydF95Ijogc3RhcnRfeSwKICAgICAgICAgICAgImVuZF94IjogZW5kX3gsCiAgICAgICAgICAgICJlbmRfeSI6IGVuZF95LAogICAgICAgICAgICAiZHVyYXRpb24iOiBkdXJhdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZSIsIHBhcmFtcz1wYXJhbXMpCiAgICAKICAgIGRlZiBzd2lwZV9iZXR3ZWVuX2VsZW1lbnRzKHNlbGYsIHN0YXJ0X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kX2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IGludCA9IDUwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHThu6sgcGjhuqduIHThu60gc3RhcnRfZWxlbWVudCDEkeG6v24gcGjhuqduIHThu60gZW5kX2VsZW1lbnQKICAgICAgICAiIiIKICAgICAgICBzdGFydF94LCBzdGFydF95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoc3RhcnRfZWxlbWVudCkKICAgICAgICBlbmRfeCwgZW5kX3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihlbmRfZWxlbWVudCkKICAgICAgICByZXR1cm4gc2VsZi5zd2lwZShzdGFydF94LCBzdGFydF95LCBlbmRfeCwgZW5kX3ksIGR1cmF0aW9uKQogICAgCiAgICBkZWYgd2FpdF9mb3JfZWxlbWVudF90b19kaXNhcHBlYXIoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIHRpbWVvdXQ6IGludCA9IDMwLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG3hu5l0IHBo4bqnbiB04butIGJp4bq/biBt4bqldCBraOG7j2kgbcOgbiBow6xuaAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6CiAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmZpbmRfZWxlbWVudCh0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkKQogICAgICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdGltZS5zbGVlcChjaGVja19pbnRlcnZhbCkKICAgICAgICAKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHdhaXRfZm9yX2FueV9lbGVtZW50KHNlbGYsIGVsZW1lbnRzX3RvX2ZpbmQ6IExpc3RbRGljdFtzdHIsIHN0cl1dLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogaW50ID0gMzAsIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIGLhuqV0IGvhu7MgcGjhuqduIHThu60gbsOgbyB0cm9uZyBkYW5oIHPDoWNoIHh14bqldCBoaeG7h24KICAgICAgICAKICAgICAgICBlbGVtZW50c190b19maW5kIGzDoCBkYW5oIHPDoWNoIGPDoWMgZGljdCB24bubaSBjw6FjIGtow7NhOiB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkCiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgdGltZW91dDoKICAgICAgICAgICAgZm9yIGVsZW1lbnRfY3JpdGVyaWEgaW4gZWxlbWVudHNfdG9fZmluZDoKICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmZpbmRfZWxlbWVudCgKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2NyaXRlcmlhLmdldCgidGV4dCIpLCAKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2NyaXRlcmlhLmdldCgiY29udGVudF9kZXNjIiksIAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfY3JpdGVyaWEuZ2V0KCJyZXNvdXJjZV9pZCIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiBlbGVtZW50OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdGltZS5zbGVlcChjaGVja19pbnRlcnZhbCkKICAgICAgICAKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZ2V0X3NjcmVlbl9zaXplKHNlbGYpIC0+IFR1cGxlW2ludCwgaW50XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBrw61jaCB0aMaw4bubYyBtw6BuIGjDrG5oICh3aWR0aCwgaGVpZ2h0KQogICAgICAgICIiIgogICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgIGlmIGRldmljZV9pbmZvWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgIHJldHVybiAoZGV2aWNlX2luZm9bImRhdGEiXVsic2NyZWVuX3dpZHRoIl0sIGRldmljZV9pbmZvWyJkYXRhIl1bInNjcmVlbl9oZWlnaHQiXSkKICAgICAgICByZXR1cm4gKDAsIDApCiAgICAKICAgIGRlZiB0YWtlX3NjcmVlbnNob3Qoc2VsZiwgZmlsZV9wYXRoOiBzdHIgPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaOG7pXAg4bqjbmggbcOgbiBow6xuaCB2w6AgbMawdSB2w6BvIGZpbGVfcGF0aCAobuG6v3UgxJHGsOG7o2MgY3VuZyBj4bqlcCkKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7fQogICAgICAgIGlmIGZpbGVfcGF0aDoKICAgICAgICAgICAgcGFyYW1zWyJmaWxlX3BhdGgiXSA9IGZpbGVfcGF0aAogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInNjcmVlbnNob3QiLCBwYXJhbXM9cGFyYW1zKQogICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfYWN0aXZpdHkoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHTDqm4gYWN0aXZpdHkgaGnhu4duIHThuqFpCiAgICAgICAgIiIiCiAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgaWYgZGV2aWNlX2luZm9bInN0YXR1cyJdID09ICJzdWNjZXNzIiBhbmQgImN1cnJlbnRfYWN0aXZpdHkiIGluIGRldmljZV9pbmZvWyJkYXRhIl06CiAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaW5mb1siZGF0YSJdWyJjdXJyZW50X2FjdGl2aXR5Il0KICAgICAgICByZXR1cm4gIiIKICAgIAogICAgZGVmIGdldF9jdXJyZW50X3BhY2thZ2Uoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHTDqm4gcGFja2FnZSBoaeG7h24gdOG6oWkKICAgICAgICAiIiIKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiY3VycmVudC1wYWNrYWdlIikKICAgICAgICBpZiByZXNwb25zZS5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIHJlc3BvbnNlOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXS5nZXQoInBhY2thZ2UiLCAiIikKICAgICAgICByZXR1cm4gIiIKICAgIAogICAgZGVmIHByZXNzX2VudGVyKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IEVudGVyCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfZW50ZXIiKQogICAgCiAgICBkZWYgcHJlc3NfYmFjayhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gbsO6dCBCYWNrCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfYmFjayIpCiAgICAKICAgIGRlZiBwcmVzc19ob21lKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IEhvbWUKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19ob21lIikKICAgIAogICAgZGVmIHByZXNzX3JlY2VudF9hcHBzKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IFJlY2VudCBBcHBzCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfcmVjZW50X2FwcHMiKQoKICAgIGRlZiBpc19hcHBfaW5zdGFsbGVkKHNlbGYsIHBhY2thZ2VfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIOG7qW5nIGThu6VuZyDEkcOjIMSRxrDhu6NjIGPDoGkgxJHhurd0IHRyw6puIHRoaeG6v3QgYuG7iyBjaMawYQogICAgICAgIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBhY2thZ2VfbmFtZTogVMOqbiBwYWNrYWdlIGPhu6dhIOG7qW5nIGThu6VuZyBj4bqnbiBraeG7g20gdHJhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Ug4bupbmcgZOG7pW5nIMSRw6MgY8OgaSDEkeG6t3QsIEZhbHNlIG7hur91IGNoxrBhCiAgICAgICAgIiIiCiAgICAgICAgIyDGr3UgdGnDqm4gc+G7rSBk4bulbmcgQURCIG7hur91IMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICBpZiBzZWxmLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIOG7qW5nIGThu6VuZyBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCBmInBtIGxpc3QgcGFja2FnZXMgfCBncmVwIC14IHBhY2thZ2U6e3BhY2thZ2VfbmFtZX0iXQogICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGPDsyBr4bq/dCBxdeG6oywg4bupbmcgZOG7pW5nIMSRw6MgxJHGsOG7o2MgY8OgaSDEkeG6t3QKICAgICAgICAgICAgICAgIHJldHVybiBwYWNrYWdlX25hbWUgaW4gcmVzdWx0LnN0ZG91dAogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3I6CiAgICAgICAgICAgICAgICAjIE7hur91IGzhu5dpIEFEQiwgc+G7rSBk4bulbmcgQVBJIEhUVFAKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIEhUVFAgQVBJCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImFwcC1pbnN0YWxsZWQiLCB7InBhY2thZ2UiOiBwYWNrYWdlX25hbWV9KQogICAgICAgIGlmIHJlc3BvbnNlWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdLmdldCgiaW5zdGFsbGVkIiwgRmFsc2UpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgZmluZF9lbGVtZW50cyhzZWxmLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLCB0ZXh0OiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSB0aGVvIGNsYXNzX25hbWUsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQgaG/hurdjIHZpc2libGUtdG8tdXNlcgogICAgICAgIMSQw6J5IGzDoCBt4buZdCBwaMawxqFuZyB0aOG7qWMgdGnhu4duIGzhu6NpIGvhur90IGjhu6NwIGR1bXBfc2NyZWVuX3htbCB2w6AgZmluZF9hbGxfZWxlbWVudHNfaW5feG1sCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCBjw6FjIHBo4bqnbiB04butIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgIyBM4bqleSBYTUwgbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgCiAgICAgICAgIyBT4butIGThu6VuZyBmaW5kX2FsbF9lbGVtZW50c19pbl94bWwgxJHhu4MgdMOsbSBjw6FjIHBo4bqnbiB04butCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgdGV4dD10ZXh0LCAKICAgICAgICAgICAgY29udGVudF9kZXNjPWNvbnRlbnRfZGVzYywgCiAgICAgICAgICAgIHJlc291cmNlX2lkPXJlc291cmNlX2lkLAogICAgICAgICAgICBjbGFzc19uYW1lPWNsYXNzX25hbWUsCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcj12aXNpYmxlX3RvX3VzZXIKICAgICAgICApCgogICAgZGVmIG9wZW5fdXJsKHNlbGYsIHVybDogc3RyLCBwYWNrYWdlOiBzdHIgPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBN4bufIG3hu5l0IFVSTCB0csOqbiB0aGnhur90IGLhu4suIEjhu691IMOtY2ggxJHhu4MgbeG7nyBjw6FjIGxpbmsgbeG6oW5nIHjDoyBo4buZaSB0cuG7sWMgdGnhur9wLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHVybDogVVJMIGPhuqduIG3hu58gKHbDrSBk4bulOiBodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL3VzZXJuYW1lLykKICAgICAgICAgICAgcGFja2FnZTogUGFja2FnZSBuYW1lIGPhu6dhIOG7qW5nIGThu6VuZyDEkeG7gyBt4bufIFVSTCAodMO5eSBjaOG7jW4pCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyB04burIHNlcnZlcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBVUkwgZW5jb2RlIMSR4buDIHRyw6FuaCBs4buXaSB24bubaSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QKICAgICAgICAgICAgIyBDaOG7iSBlbmNvZGUgcGjhuqduIHNhdSBkb21haW4gxJHhu4MgZ2nhu68gbmd1ecOqbiBwcm90b2NvbCB2w6AgZG9tYWluCiAgICAgICAgICAgIGlmICc6Ly8nIGluIHVybDoKICAgICAgICAgICAgICAgIHBhcnRzID0gdXJsLnNwbGl0KCc6Ly8nLCAxKQogICAgICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA9PSAyOgogICAgICAgICAgICAgICAgICAgIHByb3RvY29sID0gcGFydHNbMF0KICAgICAgICAgICAgICAgICAgICByZW1haW5pbmcgPSBwYXJ0c1sxXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICcvJyBpbiByZW1haW5pbmc6CiAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbl9wYXJ0cyA9IHJlbWFpbmluZy5zcGxpdCgnLycsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbiA9IGRvbWFpbl9wYXJ0c1swXQogICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gZG9tYWluX3BhcnRzWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICMgRW5jb2RlIHBhdGggcGFydCwgbmjGsG5nIGdp4buvIG5ndXnDqm4gY8OhYyBrw70gdOG7sSBhbiB0b8OgbgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3BhdGggPSBxdW90ZShwYXRoLCBzYWZlPScvQDo/I1tdISQmXCcoKSorLDs9JykKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlZF91cmwgPSBmIntwcm90b2NvbH06Ly97ZG9tYWlufS97ZW5jb2RlZF9wYXRofSIKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3VybCA9IHVybCAgIyBDaOG7iSBjw7MgZG9tYWluLCBraMO0bmcgY+G6p24gZW5jb2RlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGVuY29kZWRfdXJsID0gdXJsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEtow7RuZyBjw7MgcHJvdG9jb2wsIGVuY29kZSB0b8OgbiBi4buZCiAgICAgICAgICAgICAgICBlbmNvZGVkX3VybCA9IHF1b3RlKHVybCwgc2FmZT0nL0A6PyNbXSEkJlwnKCkqKyw7PScpCiAgICAgICAgICAgIAogICAgICAgICAgICBwYXJhbXMgPSB7InVybCI6IGVuY29kZWRfdXJsfQogICAgICAgICAgICBpZiBwYWNrYWdlOgogICAgICAgICAgICAgICAgcGFyYW1zWyJwYWNrYWdlIl0gPSBwYWNrYWdlCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoIm9wZW5fdXJsIiwgcGFyYW1zPXBhcmFtcykKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBlbmNvZGUgVVJMOiB7ZX0iKQogICAgICAgICAgICAjIEZhbGxiYWNrOiBn4butaSBVUkwgZ+G7kWMgbuG6v3UgY8OzIGzhu5dpIGVuY29kZQogICAgICAgICAgICBwYXJhbXMgPSB7InVybCI6IHVybH0KICAgICAgICAgICAgaWYgcGFja2FnZToKICAgICAgICAgICAgICAgIHBhcmFtc1sicGFja2FnZSJdID0gcGFja2FnZQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJvcGVuX3VybCIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIGdldF9jbGlwYm9hcmQoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IG7hu5lpIGR1bmcgY2xpcGJvYXJkIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBO4buZaSBkdW5nIGNsaXBib2FyZCBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3Uga2jDtG5nIGPDsyBu4buZaSBkdW5nCiAgICAgICAgIiIiCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImNsaXBib2FyZCIpCiAgICAgICAgaWYgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kIHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoImhhc19jb250ZW50Iik6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdWyJjbGlwYm9hcmRfdGV4dCJdCiAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIHN3aXBlX2xlZnQoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHNhbmcgdHLDoWkgKHThu5FpIMawdSBjaG8gbmfDs24gY8OhaSB0YXkgcGjhuqNpKQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX2xlZnQiKQoKICAgIGRlZiBzd2lwZV9yaWdodChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgc2FuZyBwaOG6o2kgKHThu5FpIMawdSBjaG8gbmfDs24gY8OhaSB0YXkgcGjhuqNpKQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX3JpZ2h0IikKCiAgICBkZWYgaXNfaW5zdGFsbGVkKHNlbGYsIHBhY2thZ2U6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBoYXkga2jDtG5nIChkw7luZyBBUEkgbeG7m2kpCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGFja2FnZTogVMOqbiBwYWNrYWdlIGPhu6dhIOG7qW5nIGThu6VuZwogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGRpY3Q6IEvhur90IHF14bqjIGtp4buDbSB0cmEKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpc19pbnN0YWxsZWQiLCBwYXJhbXM9eyJwYWNrYWdlIjogcGFja2FnZX0pCgogICAgZGVmIHNldHVwX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBjaG8gcGhpw6puIGzDoG0gdmnhu4djCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSB24bubaSBjw6FjIHRyxrDhu51uZzoKICAgICAgICAgICAgICAgIC0gaWQ6IElEIGPhu6dhIHByb3h5CiAgICAgICAgICAgICAgICAtIHR5cGU6IExv4bqhaSBwcm94eSAocHBvZSwgaHR0cCwgc29ja3M1LCBldGMuKQogICAgICAgICAgICAgICAgLSBob3N0OiDEkOG7i2EgY2jhu4kgc2VydmVyIHByb3h5CiAgICAgICAgICAgICAgICAtIHBvcnQ6IFBvcnQgY+G7p2EgcHJveHkKICAgICAgICAgICAgICAgIC0gdXNlcm5hbWU6IFVzZXJuYW1lIChu4bq/dSBjw7MpCiAgICAgICAgICAgICAgICAtIHBhc3N3b3JkOiBQYXNzd29yZCAobuG6v3UgY8OzKQogICAgICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aGnhur90IGzhuq1wIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcm94eV90eXBlID0gcHJveHlfY29uZmlnLmdldCgidHlwZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcHJveHlfdHlwZSA9PSAicHBvZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fc2V0dXBfcHBvZV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSBpbiBbImh0dHAiLCAiaHR0cHMiXToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZXR1cF9odHRwX3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxpZiBwcm94eV90eXBlID09ICJzb2NrczUiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NldHVwX3NvY2tzNV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIkxv4bqhaSBwcm94eSBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7ozoge3Byb3h5X3R5cGV9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aGnhur90IGzhuq1wIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3NldHVwX3Bwb2VfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaGnhur90IGzhuq1wIHByb3h5IFBQUG9FCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBQUFBvRQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBob3N0ID0gcHJveHlfY29uZmlnLmdldCgic2VydmVyX2lwIikKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJwcm94eV9pZCIpCiAgICAgICAgICAgIHByb3h5X25hbWUgPSBwcm94eV9jb25maWcuZ2V0KCJuYW1lIikKICAgICAgICAgICAgaWYgbm90IGhvc3Q6CiAgICAgICAgICAgICAgICBwcmludCgiVGhp4bq/dSB0aMO0bmcgdGluIGhvc3QgY2hvIHByb3h5IFBQUG9FIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJIHJlZ2lzdGVyIHRyxrDhu5tjCiAgICAgICAgICAgIHJlZ2lzdGVyX3VybCA9IGYiaHR0cDovL3tob3N0fS9yZWdpc3RlciIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBkZXZpY2UgaW5mbwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgbG9jYWxfaXAgPSAiIgogICAgICAgICAgICBpZiBkZXZpY2VfaW5mby5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9jYWxfaXAgPSBkZXZpY2VfaW5mb1siZGF0YSJdLmdldCgibG9jYWxfaXAiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlZ2lzdGVyX2RhdGEgPSB7Im5hbWUiOiBwcm94eV9uYW1lfQogICAgICAgICAgICAgICAgaWYgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJfZGF0YVsibG9jYWxfaXAiXSA9IGxvY2FsX2lwCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZWdpc3Rlcl9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJfdXJsLCAKICAgICAgICAgICAgICAgICAgICBqc29uPXJlZ2lzdGVyX2RhdGEsIAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9LCAKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiByZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIMSRxINuZyBrw70gdGjDoG5oIGPDtG5nIHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge2hvc3R9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHEg25nIGvDvSB24bubaSBwcm94eSBQUFBvRSBzZXJ2ZXI6IHtyZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJLaMO0bmcgdGjhu4Mga+G6v3QgbuG7kWkgxJHhur9uIHByb3h5IFBQUG9FIHNlcnZlciB7aG9zdH06IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IElQIHByb3h5CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNldF9wcm94eV9pcChwcm94eV9jb25maWcpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eSBQUFBvRToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9zZXR1cF9odHRwX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBIVFRQL0hUVFBTCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBIVFRQCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhu5FpIHbhu5tpIEhUVFAgcHJveHksIGNo4buJIGPhuqduIHJlc2V0IElQCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNldF9wcm94eV9pcChwcm94eV9jb25maWcpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eSBIVFRQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3NldHVwX3NvY2tzNV9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgU09DS1M1CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBTT0NLUzUKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG7kWkgduG7m2kgU09DS1M1IHByb3h5LCBjaOG7iSBj4bqnbiByZXNldCBJUAogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRoaeG6v3QgbOG6rXAgcHJveHkgU09DS1M1OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3Jlc2V0X3Byb3h5X2lwKHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUmVzZXQgSVAgcHJveHkgKGxvZ2ljIGPFqSDEkcaw4bujYyBjaHV54buDbiB2w6BvIMSRw6J5KQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBMb2dpYyByZXNldCBJUCBwcm94eSBz4bq9IMSRxrDhu6NjIGltcGxlbWVudCB0w7l5IHRoZW8gbG/huqFpIHByb3h5CiAgICAgICAgICAgICMgSGnhu4duIHThuqFpIHJldHVybiBUcnVlIMSR4buDIGtow7RuZyBibG9jayB3b3JrZmxvdwogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgcHJveHlfdHlwZSA9IHByb3h5X2NvbmZpZy5nZXQoInR5cGUiLCAidW5rbm93biIpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChmIlJlc2V0IElQIGNobyBwcm94eSB7cHJveHlfaWR9ICh0eXBlOiB7cHJveHlfdHlwZX0pIikKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyB0aMO0bmcgdGluIHJlc2V0IElQCiAgICAgICAgICAgIHJlc2V0X2lwX2xpbmsgPSBwcm94eV9jb25maWcuZ2V0KCJsaW5rX3Jlc2V0X2lwIikKICAgICAgICAgICAgcHBvZV9uYW1lID0gcHJveHlfY29uZmlnLmdldCgicHBvZV9uYW1lIikKCiAgICAgICAgICAgIGlmIHJlc2V0X2lwX2xpbmsgYW5kIHBwb2VfbmFtZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIEfhu61pIFBPU1QgcmVxdWVzdCDEkeG7gyByZXNldCBJUAogICAgICAgICAgICAgICAgICAgIHJlc2V0X2RhdGEgPSB7InBwb2VfbmFtZSI6IHBwb2VfbmFtZX0KICAgICAgICAgICAgICAgICAgICByZXNldF9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0X2lwX2xpbmssIAogICAgICAgICAgICAgICAgICAgICAgICBqc29uPXJlc2V0X2RhdGEsIAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzZXRfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgcmVzZXQgSVAgdGjDoG5oIGPDtG5nIGNobyBwcm94eSB7cHBvZV9uYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgcmVzZXQgSVA6IEhUVFAge3Jlc2V0X3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgZ+G7rWkgcmVxdWVzdCByZXNldCBJUDoge2V9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJUaGnhur91IHRow7RuZyB0aW4gbGlua19yZXNldF9pcCBob+G6t2MgcHJveHlfbmFtZSIpCiAgICAgICAgICAgICMgVE9ETzogSW1wbGVtZW50IGxvZ2ljIHJlc2V0IElQIGPhu6UgdGjhu4MgY2hvIHThu6tuZyBsb+G6oWkgcHJveHkKICAgICAgICAgICAgIyBWw60gZOG7pTogZ+G7jWkgQVBJIHJlc2V0IElQLCBob+G6t2MgdGjhu7FjIGhp4buHbiBjw6FjIGzhu4duaCBj4bqnbiB0aGnhur90CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHJlc2V0IElQIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgcmVzZXRfcHJveHlfaXAoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBQaMawxqFuZyB0aOG7qWMgcHVibGljIMSR4buDIHJlc2V0IElQIHByb3h5ICjEkeG7gyB0xrDGoW5nIHRow61jaCB24bubaSBjb2RlIGPFqSkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQoKICAgIGRlZiB1bnJlZ2lzdGVyX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0gPSBOb25lKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEjhu6d5IMSRxINuZyBrw70gcHJveHkgc2F1IGtoaSBz4butIGThu6VuZyB4b25nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSAodMO5eSBjaOG7jW4sIGPDsyB0aOG7gyBs4bqleSB04burIGRhdGFiYXNlIG7hur91IGtow7RuZyB0cnV54buBbikKICAgICAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgaOG7p3kgxJHEg25nIGvDvSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdHJ1eeG7gW4gcHJveHlfY29uZmlnLCBjw7MgdGjhu4MgbOG6pXkgdOG7qyBkYXRhYmFzZSBob+G6t2MgY29udGV4dCBoaeG7h24gdOG6oWkKICAgICAgICAgICAgaWYgbm90IHByb3h5X2NvbmZpZzoKICAgICAgICAgICAgICAgIHByaW50KCJLaMO0bmcgY8OzIHByb3h5IGNvbmZpZyDEkeG7gyB1bnJlZ2lzdGVyIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlICAjIENvaSBuaMawIHRow6BuaCBjw7RuZyBu4bq/dSBraMO0bmcgY8OzIGfDrCDEkeG7gyB1bnJlZ2lzdGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcHJveHlfdHlwZSA9IHByb3h5X2NvbmZpZy5nZXQoInR5cGUiLCAiIikubG93ZXIoKQogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHByb3h5X3R5cGUgPT0gInBwb2UiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3VucmVnaXN0ZXJfcHBvZV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSBpbiBbImh0dHAiLCAiaHR0cHMiXToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl91bnJlZ2lzdGVyX2h0dHBfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbGlmIHByb3h5X3R5cGUgPT0gInNvY2tzNSI6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdW5yZWdpc3Rlcl9zb2NrczVfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJMb+G6oWkgcHJveHkga2jDtG5nIGPhuqduIHVucmVnaXN0ZXIgaG/hurdjIGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujOiB7cHJveHlfdHlwZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF91bnJlZ2lzdGVyX3Bwb2VfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IFBQUG9FCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBQUFBvRQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBob3N0ID0gcHJveHlfY29uZmlnLmdldCgic2VydmVyX2lwIikKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJwcm94eV9pZCIpCiAgICAgICAgICAgIHByb3h5X25hbWUgPSBwcm94eV9jb25maWcuZ2V0KCJuYW1lIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBob3N0OgogICAgICAgICAgICAgICAgcHJpbnQoIlRoaeG6v3UgdGjDtG5nIHRpbiBob3N0IGNobyBwcm94eSBQUFBvRSwgYuG7jyBxdWEgdW5yZWdpc3RlciIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJIHVucmVnaXN0ZXIKICAgICAgICAgICAgdW5yZWdpc3Rlcl91cmwgPSBmImh0dHA6Ly97aG9zdH0vdW5yZWdpc3RlciIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBkZXZpY2UgaW5mbwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgbG9jYWxfaXAgPSAiIgogICAgICAgICAgICBpZiBkZXZpY2VfaW5mby5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9jYWxfaXAgPSBkZXZpY2VfaW5mb1siZGF0YSJdLmdldCgibG9jYWxfaXAiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJfZGF0YSA9IHsibmFtZSI6IHByb3h5X25hbWV9CiAgICAgICAgICAgICAgICBpZiBsb2NhbF9pcDoKICAgICAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyX2RhdGFbImxvY2FsX2lwIl0gPSBsb2NhbF9pcAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl91cmwsIAogICAgICAgICAgICAgICAgICAgIGpzb249dW5yZWdpc3Rlcl9kYXRhLCAKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwgCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgdW5yZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIGjhu6d5IMSRxINuZyBrw70gdGjDoG5oIGPDtG5nIHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge2hvc3R9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge3VucmVnaXN0ZXJfcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIMSR4bq/biBwcm94eSBQUFBvRSBzZXJ2ZXIge2hvc3R9IMSR4buDIHVucmVnaXN0ZXI6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eSBQUFBvRToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF91bnJlZ2lzdGVyX2h0dHBfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IEhUVFAvSFRUUFMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IEhUVFAKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBIVFRQIHByb3h5IHRoxrDhu51uZyBraMO0bmcgY+G6p24gdW5yZWdpc3RlciDEkeG6t2MgYmnhu4d0CiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICBwcmludChmIkjhu6d5IMSRxINuZyBrw70gcHJveHkgSFRUUCB7cHJveHlfaWR9IChraMO0bmcgY+G6p24gdGhhbyB0w6FjIMSR4bq3YyBiaeG7h3QpIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHByb3h5IEhUVFA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfdW5yZWdpc3Rlcl9zb2NrczVfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IFNPQ0tTNQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgU09DS1M1CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgU09DS1M1IHByb3h5IHRoxrDhu51uZyBraMO0bmcgY+G6p24gdW5yZWdpc3RlciDEkeG6t2MgYmnhu4d0CiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICBwcmludChmIkjhu6d5IMSRxINuZyBrw70gcHJveHkgU09DS1M1IHtwcm94eV9pZH0gKGtow7RuZyBj4bqnbiB0aGFvIHTDoWMgxJHhurdjIGJp4buHdCkiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGjhu6d5IMSRxINuZyBrw70gcHJveHkgU09DS1M1OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZGVidWdfZWxlbWVudF9ib3VuZHMoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgRGVidWcgdGjDtG5nIHRpbiBib3VuZHMgY+G7p2EgZWxlbWVudCDEkeG7gyBraeG7g20gdHJhIHhlbSBjw7MgdGFwIMSRxrDhu6NjIGtow7RuZwogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICBwcmludCgiREVCVUc6IEVsZW1lbnQgaXMgTm9uZSBvciBlbXB0eSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBwcmludCgiPT09IERFQlVHIEVMRU1FTlQgQk9VTkRTID09PSIpCiAgICAgICAgYm91bmRzX3N0ciA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiIikKICAgICAgICBwcmludChmIk9yaWdpbmFsIGJvdW5kcyBzdHJpbmc6ICd7Ym91bmRzX3N0cn0nIikKICAgICAgICAKICAgICAgICAjIFRlc3QgZ2V0X2VsZW1lbnRfYm91bmRzCiAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyhlbGVtZW50KQogICAgICAgIHByaW50KGYiUGFyc2VkIGJvdW5kczogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAKICAgICAgICAjIFRlc3QgZ2V0X2VsZW1lbnRfY2VudGVyCiAgICAgICAgY2VudGVyX3gsIGNlbnRlcl95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICBwcmludChmIkNhbGN1bGF0ZWQgY2VudGVyOiAoe2NlbnRlcl94fSwge2NlbnRlcl95fSkiKQogICAgICAgIAogICAgICAgICMgVGVzdCB24bubaSB2w60gZOG7pSBj4bulIHRo4buDCiAgICAgICAgcHJpbnQoIlxuLS0tIFRlc3Rpbmcgd2l0aCBleGFtcGxlIGJvdW5kcyBbMzYsMF1bODQsLTMwXSAtLS0iKQogICAgICAgIHRlc3RfZWxlbWVudCA9IHsiYm91bmRzIjogIlszNiwwXVs4NCwtMzBdIiwgImNvbnRlbnQtZGVzYyI6ICJUw6xtIGtp4bq/bSJ9CiAgICAgICAgCiAgICAgICAgdGVzdF94MSwgdGVzdF95MSwgdGVzdF94MiwgdGVzdF95MiA9IHNlbGYuZ2V0X2VsZW1lbnRfYm91bmRzKHRlc3RfZWxlbWVudCkKICAgICAgICBwcmludChmIlRlc3QgcGFyc2VkIGJvdW5kczogKHt0ZXN0X3gxfSwge3Rlc3RfeTF9LCB7dGVzdF94Mn0sIHt0ZXN0X3kyfSkiKQogICAgICAgIAogICAgICAgIHRlc3RfY2VudGVyX3gsIHRlc3RfY2VudGVyX3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcih0ZXN0X2VsZW1lbnQpCiAgICAgICAgcHJpbnQoZiJUZXN0IGNhbGN1bGF0ZWQgY2VudGVyOiAoe3Rlc3RfY2VudGVyX3h9LCB7dGVzdF9jZW50ZXJfeX0pIikKICAgICAgICAKICAgICAgICAjIFRlc3QgdGFwX2VsZW1lbnQKICAgICAgICBwcmludCgiXG4tLS0gVGVzdGluZyB0YXBfZWxlbWVudCAtLS0iKQogICAgICAgIHJlc3VsdCA9IHNlbGYudGFwX2VsZW1lbnQodGVzdF9lbGVtZW50KQogICAgICAgIHByaW50KGYiVGFwIHJlc3VsdDoge3Jlc3VsdH0iKQogICAgICAgIAogICAgICAgIHByaW50KCI9PT0gRU5EIERFQlVHID09PSIpCgogICAgZGVmIGRvd25sb2FkX2ltYWdlKHNlbGYsIHNlcnZlcjogc3RyID0gImh0dHA6Ly8xMC4wLjAuNTo1MDAwIiwgY291bnQ6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVOG6o2kg4bqjbmggdOG7qyBzZXJ2ZXIgduG7gSB0aGnhur90IGLhu4sgdGjDtG5nIHF1YSBoZWxwZXIgc2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHNlcnZlcjogU2VydmVyIMSR4buLYSBjaOG7iSAobuG6v3UgTm9uZSB0aMOsIMSR4buNYyB04burIGNvbmZpZyBkYiwgbeG6t2MgxJHhu4tuaCAiaHR0cDovLzEwLjAuMC41OjUwMDAiKQogICAgICAgICAgICBjb3VudDogU+G7kSBsxrDhu6NuZyDhuqNuaCBj4bqnbiB04bqjaSAobeG6t2MgxJHhu4tuaCAxKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHThuqNpIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IHNlcnZlciB04burIGRhdGFiYXNlIG7hur91IGtow7RuZyB0cnV54buBbiB2w6BvCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBzZXJ2ZXIgY8OzIHByb3RvY29sCiAgICAgICAgICAgIGlmIG5vdCBzZXJ2ZXIuc3RhcnRzd2l0aCgoImh0dHA6Ly8iLCAiaHR0cHM6Ly8iKSk6CiAgICAgICAgICAgICAgICBzZXJ2ZXIgPSBmImh0dHA6Ly97c2VydmVyfSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgWMOieSBk4buxbmcgVVJMIGThu7FhIHRyw6puIHPhu5EgbMaw4bujbmcg4bqjbmgKICAgICAgICAgICAgaWYgY291bnQgPT0gMToKICAgICAgICAgICAgICAgICMgVHLGsOG7nW5nIGjhu6NwIHThuqNpIDEg4bqjbmggLSBz4butIGThu6VuZyBlbmRwb2ludCByYW5kb20tYXZhdGFyCiAgICAgICAgICAgICAgICBpbWFnZV91cmwgPSBmIntzZXJ2ZXJ9L3JhbmRvbS1hdmF0YXIiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRyxrDhu51uZyBo4bujcCB04bqjaSBuaGnhu4F1IOG6o25oIC0gc+G7rSBk4bulbmcgZW5kcG9pbnQgZ2V0LXNpbWlsYXItaW1hZ2VzCiAgICAgICAgICAgICAgICBpbWFnZV91cmwgPSBmIntzZXJ2ZXJ9L2dldC1zaW1pbGFyLWltYWdlcz9jb3VudD17Y291bnR9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyBT4butIGThu6VuZyBfbWFrZV9yZXF1ZXN0IMSR4buDIHThuq1uIGThu6VuZyBjxqEgY2jhur8gcmV0cnkgdsOgIGVycm9yIGhhbmRsaW5nIGPDsyBz4bq1bgogICAgICAgICAgICByZXN1bHQgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImRvd25sb2FkLWltYWdlIiwgcGFyYW1zPXsidXJsIjogaW1hZ2VfdXJsfSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgWOG7rSBsw70gcmVzcG9uc2UgZm9ybWF0IHRo4buxYyB04bq/CiAgICAgICAgICAgICMgUmVzcG9uc2U6IHsiZGF0YSI6IHsic3VjY2VzcyI6IHRydWUsICJtZXNzYWdlIjogIi4uLiIsICJkYXRhIjogey4uLn19LCAibWVzc2FnZSI6ICIuLi4iLCAic3RhdHVzIjogInN1Y2Nlc3MifQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJlc3VsdCwgZGljdCkgYW5kIHJlc3VsdC5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBkYXRhLnN1Y2Nlc3MgdsOgIGRhdGEubWVzc2FnZQogICAgICAgICAgICAgICAgZGF0YV9zZWN0aW9uID0gcmVzdWx0LmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IGRhdGFfc2VjdGlvbi5nZXQoInN1Y2Nlc3MiLCBGYWxzZSkKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBkYXRhX3NlY3Rpb24uZ2V0KCJtZXNzYWdlIiwgIiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzIGFuZCAidGjDoG5oIGPDtG5nIiBpbiBtZXNzYWdlCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB04bqjaSDhuqNuaDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgojIFRlc3QgZnVuY3Rpb24gZm9yIHRoZSBwcm9ibGVtYXRpYyBlbGVtZW50CmRlZiB0ZXN0X3Byb2JsZW1hdGljX2VsZW1lbnQoKToKICAgICIiIgogICAgVGVzdCBmdW5jdGlvbiDEkeG7gyBraeG7g20gdHJhIGVsZW1lbnQgY8OzIGJvdW5kcyDDom0KICAgICIiIgogICAgaGVscGVyID0gSGVscGVyU2VydmljZSgpCiAgICAKICAgICMgRWxlbWVudCB04burIHbDrSBk4bulIGPhu6dhIHVzZXIKICAgIHByb2JsZW1hdGljX2VsZW1lbnQgPSB7CiAgICAgICAgImNsYXNzIjogImFuZHJvaWQud2lkZ2V0LkltYWdlVmlldyIsCiAgICAgICAgInBhY2thZ2UiOiAiY29tLnNzLmFuZHJvaWQudWdjLnRyaWxsIiwgCiAgICAgICAgInJlc291cmNlLWlkIjogImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbDppZC9kZWwiLAogICAgICAgICJ0ZXh0IjogIm51bGwiLAogICAgICAgICJjb250ZW50LWRlc2MiOiAiVMOsbSBraeG6v20iLAogICAgICAgICJib3VuZHMiOiAiWzM2LDBdWzg0LC0zMF0iLAogICAgICAgICJjbGlja2FibGUiOiAiZmFsc2UiLAogICAgICAgICJlbmFibGVkIjogInRydWUiLAogICAgICAgICJ2aXNpYmxlLXRvLXVzZXIiOiAiZmFsc2UiCiAgICB9CiAgICAKICAgIHByaW50KCJUZXN0aW5nIHByb2JsZW1hdGljIGVsZW1lbnQgd2l0aCBib3VuZHMgWzM2LDBdWzg0LC0zMF0iKQogICAgaGVscGVyLmRlYnVnX2VsZW1lbnRfYm91bmRzKHByb2JsZW1hdGljX2VsZW1lbnQpCiAgICAKICAgIHByaW50KCJcblRyeWluZyB0byB0YXAgdGhlIGVsZW1lbnQuLi4iKQogICAgcmVzdWx0ID0gaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihwcm9ibGVtYXRpY19lbGVtZW50KQogICAgcHJpbnQoZiJGaW5hbCB0YXAgcmVzdWx0OiB7cmVzdWx0fSIpCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgdGVzdF9wcm9ibGVtYXRpY19lbGVtZW50KCkKICAgIAogICAgIyBWw60gZOG7pSBz4butIGThu6VuZwogICAgaGVscGVyID0gSGVscGVyU2VydmljZSgpCiAgICAKICAgICMgTOG6pXkga8OtY2ggdGjGsOG7m2MgbcOgbiBow6xuaAogICAgd2lkdGgsIGhlaWdodCA9IGhlbHBlci5nZXRfc2NyZWVuX3NpemUoKQogICAgcHJpbnQoZiJLw61jaCB0aMaw4bubYyBtw6BuIGjDrG5oOiB7d2lkdGh9eHtoZWlnaHR9IikKICAgIAogICAgIyBN4bufIFRpa1RvawogICAgaGVscGVyLm9wZW5fYXBwKCJjb20uc3MuYW5kcm9pZC51Z2MudHJpbGwiKQogICAgCiAgICAjIENo4budIMSR4bujaSBjaG8gxJHhur9uIGtoaSBuw7p0ICJUcmFuZyBjaOG7pyIgaG/hurdjIG7DunQgIktow6FtIHBow6EiIHh14bqldCBoaeG7h24KICAgIGVsZW1lbnRzX3RvX2ZpbmQgPSBbCiAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiVHJhbmcgY2jhu6cifSwKICAgICAgICB7ImNvbnRlbnRfZGVzYyI6ICJLaMOhbSBwaMOhIn0KICAgIF0KICAgIAogICAgZWxlbWVudCA9IGhlbHBlci53YWl0X2Zvcl9hbnlfZWxlbWVudChlbGVtZW50c190b19maW5kKQogICAgCiAgICBpZiBlbGVtZW50OgogICAgICAgIHByaW50KGYixJDDoyB0w6xtIHRo4bqleSBwaOG6p24gdOG7rToge2hlbHBlci5nZXRfZWxlbWVudF9jb250ZW50X2Rlc2MoZWxlbWVudCl9IikKICAgICAgICBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICBlbHNlOgogICAgICAgIHByaW50KCJLaMO0bmcgdMOsbSB0aOG6pXkgcGjhuqduIHThu60gbsOgbyBzYXUgdGjhu51pIGdpYW4gY2jhu50iKQ==').decode('utf-8'))
