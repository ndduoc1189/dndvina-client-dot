import base64
exec(base64.b64decode('aW1wb3J0IGRhdGV0aW1lCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IHJlCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIExpc3QsIE9wdGlvbmFsCmZyb20gam9icy5qb2JfYmFzZSBpbXBvcnQgQmFzZUpvYgoKY2xhc3MgVGlrdG9rSm9iKEJhc2VKb2IpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZSkKICAgICAgICBzZWxmLmFwcF9wYWNrYWdlID0gImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbCIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gInRpa3RvayIKICAgICAgICAKICAgIGRlZiBnZXRfYWNjb3VudHNfZnJvbV9kZXZpY2Uoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gVGlrdG9rIHThu6sgdGhp4bq/dCBi4buLIiIiCiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBN4bufIOG7qW5nIGThu6VuZyBUaWtUb2sKICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2jhu50gbcOgbiBow6xuaCBjaMOtbmggdOG6o2kgLSBraeG7g20gdHJhIGNobyDEkeG6v24ga2hpIGPDsyAiVHJhbmcgY2jhu6ciIGhv4bq3YyB04buRaSDEkWEgMjBzCiAgICAgICAgICAgIGhvbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudChjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIiwgdGltZW91dD0yMCkKICAgICAgICAgICAgaWYgbm90IGhvbWVfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB04bqjaSBtw6BuIGjDrG5oIGNow61uaCBUaWtUb2sgc2F1IDIwIGdpw6J5IikKICAgICAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBuw7p0ICJI4buTIHPGoSIgdsOgIG5o4bqlcCB2w6BvCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9uYXZpZ2F0ZV90b19wcm9maWxlX3RhYigpOgogICAgICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIG1lbnUgaOG7kyBzxqEgxJHhu4MgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAgICAgaWYgbm90IHNlbGYuX29wZW5fcHJvZmlsZV9tZW51KCk6CiAgICAgICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgWE1MIG3DoG4gaMOsbmggc2F1IGtoaSBt4bufIG1lbnUKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gbsO6dCAiVGjDqm0gdMOgaSBraG/huqNuIgogICAgICAgICAgICBhZGRfYWNjb3VudF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVGjDqm0gdMOgaSBraG/huqNuIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGFkZF9hY2NvdW50X2J1dHRvbjoKICAgICAgICAgICAgICAgICMgVMOsbSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiAoUmVjeWNsZXJWaWV3KSAtIGzDoCBjaGEgY+G7p2EgbsO6dCAiVGjDqm0gdMOgaSBraG/huqNuIgogICAgICAgICAgICAgICAgcmVjeWNsZXJfdmlldyA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgUmVjeWNsZXJWaWV3CiAgICAgICAgICAgICAgICBhbGxfcmVjeWNsZXJfdmlld3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZHgucmVjeWNsZXJ2aWV3LndpZGdldC5SZWN5Y2xlclZpZXciCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBSZWN5Y2xlclZpZXcgY2jhu6lhIGPDoWMgdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBmb3IgcnYgaW4gYWxsX3JlY3ljbGVyX3ZpZXdzOgogICAgICAgICAgICAgICAgICAgIHJ2X2JvdW5kcyA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X2JvdW5kcyhydikKICAgICAgICAgICAgICAgICAgICBhZGRfYWNjb3VudF9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoYWRkX2FjY291bnRfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gYWRkX2FjY291bnRfYnV0dG9uIGPDsyBu4bqxbSB0cm9uZyByZWN5Y2xlcl92aWV3IGtow7RuZwogICAgICAgICAgICAgICAgICAgIGlmIChydl9ib3VuZHNbMF0gPD0gYWRkX2FjY291bnRfYm91bmRzWzBdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICBydl9ib3VuZHNbMV0gPD0gYWRkX2FjY291bnRfYm91bmRzWzFdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICBydl9ib3VuZHNbMl0gPj0gYWRkX2FjY291bnRfYm91bmRzWzJdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICBydl9ib3VuZHNbM10gPj0gYWRkX2FjY291bnRfYm91bmRzWzNdKToKICAgICAgICAgICAgICAgICAgICAgICAgcmVjeWNsZXJfdmlldyA9IHJ2CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHJlY3ljbGVyX3ZpZXc6CiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgbsO6dCAoQnV0dG9uKSB0cm9uZyBSZWN5Y2xlclZpZXcgYuG6sW5nIGNsYXNzIHRoYXkgdsOsIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9idXR0b25zID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGZvciBidXR0b24gaW4gYWNjb3VudF9idXR0b25zOgogICAgICAgICAgICAgICAgICAgICAgICAjIELhu48gcXVhIG7DunQgIlRow6ptIHTDoGkga2hv4bqjbiIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnV0dG9uLmdldCgiY29udGVudC1kZXNjIikgPT0gIlRow6ptIHTDoGkga2hv4bqjbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBM4bqleSB0w6puIHTDoGkga2hv4bqjbiB04burIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGJ1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gVGV4dFZpZXcgdHJvbmcgYnV0dG9uIGLhurFuZyBjbGFzcyB0aGF5IHbDrCByZXNvdXJjZS1pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dHZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuVGV4dFZpZXciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTOG7jWMgdGV4dHZpZXcgdGhlbyBib3VuZHMgxJHhu4MgdMOsbSDEkcO6bmcgY8OhaSB0aHXhu5ljIHbhu4EgYnV0dG9uIG7DoHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbl9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHR2IGluIHRleHR2aWV3czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dl9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHModHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR2X2JvdW5kc1swXSA+PSBidXR0b25fYm91bmRzWzBdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dl9ib3VuZHNbMV0gPj0gYnV0dG9uX2JvdW5kc1sxXSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHZfYm91bmRzWzJdIDw9IGJ1dHRvbl9ib3VuZHNbMl0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR2X2JvdW5kc1szXSA8PSBidXR0b25fYm91bmRzWzNdKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSDEkeG7gyBraMO0bmcgbOG6pXkgcGjhuqNpIHRleHQgcuG7l25nIGhv4bq3YyAibnVsbCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGV4dCBhbmQgdGV4dCAhPSAibnVsbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIELhu48gcXVhIG7DunQgIsSQw7NuZyIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUgPT0gIsSQw7NuZyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSB0w6BpIGtob+G6o24gY8OzIMSRYW5nIMSRxINuZyBuaOG6rXAga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlzX2N1cnJlbnQgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGThuqV1IGtp4buDbSB0cm9uZyBidXR0b24gYuG6sW5nIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgICAgICAgICBjaGVja21hcmtzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYz0iROG6pXUga2nhu4NtIgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGThuqV1IGtp4buDbSBjw7MgdGh14buZYyB24buBIGJ1dHRvbiBuw6B5IGtow7RuZwogICAgICAgICAgICAgICAgICAgICAgICBidXR0b25fYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGNoZWNrIGluIGNoZWNrbWFya3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoY2hlY2spCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tfYm91bmRzWzBdID49IGJ1dHRvbl9ib3VuZHNbMF0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfYm91bmRzWzFdID49IGJ1dHRvbl9ib3VuZHNbMV0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfYm91bmRzWzJdIDw9IGJ1dHRvbl9ib3VuZHNbMl0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfYm91bmRzWzNdIDw9IGJ1dHRvbl9ib3VuZHNbM10pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2N1cnJlbnQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ8WpbmcgY8OzIHRo4buDIGtp4buDbSB0cmEgdGh14buZYyB0w61uaCBzZWxlY3RlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBidXR0b24uZ2V0KCJzZWxlY3RlZCIpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2N1cnJlbnQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdXNlcm5hbWUgaOG7o3AgbOG7hyB0csaw4bubYyBraGkgdGjDqm0gdsOgbyBkYW5oIHPDoWNoCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lIGFuZCB1c2VybmFtZSAhPSAibnVsbCIgYW5kIHVzZXJuYW1lLnN0cmlwKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEzhu41jIHRow6ptIGPDoWMgdMOqbiBraMO0bmcgcGjhuqNpIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUgbm90IGluIFsiQ8OgaSDEkeG6t3QiLCAiQ8OgaSDEkeG6t3QgdMOgaSBraG/huqNuIiwgIlTDuXkgY2jhu41uIiwgIk1lbnUiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmlja25hbWUiOiB1c2VybmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV91c2VybmFtZSI6IHVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogdXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiYWN0aXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzX2xvZ2luIjogaXNfY3VycmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2VuYWJsZSI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsZXZlbCI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKGFjY291bnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUXVheSBs4bqhaSBtw6BuIGjDrG5oIGNow61uaAogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gVGlrVG9rIikKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGFjY291bnRzCiAgICAKICAgIGRlZiBwZXJmb3JtX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSk6CiAgICAgICAgIiIiVGjhu7FjIGhp4buHbiBjw7RuZyB2aeG7h2MgduG7m2kgdMOgaSBraG/huqNuIFRpa1RvayIiIgogICAgICAgICMgU+G7rSBk4bulbmcgcGjGsMahbmcgdGjhu6ljIGPhu6dhIGzhu5twIGNoYQogICAgICAgIHN1cGVyKCkucGVyZm9ybV9qb2IoYWNjb3VudCkKICAgICAgICAKICAgIGRlZiBwZXJmb3JtX2NhcmUoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIgogICAgICAgIE51w7RpIHTDoGkga2hv4bqjbiBUaWtUb2sgLSBMZWdhY3kgbWV0aG9kLCBz4butIGThu6VuZyBTbWFydCBDYXJlIG3hu5tpCiAgICAgICAgQmFja3dhcmQgY29tcGF0aWJpbGl0eTogY2h1eeG7g24gaMaw4bubbmcgc2FuZyBTbWFydCBDYXJlIG1ldGhvZHMKICAgICAgICAiIiIKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgbnXDtGkgdMOgaSBraG/huqNuIFRpa1Rvazoge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSAobGVnYWN5IG1ldGhvZCkiKQogICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgU21hcnQgQ2FyZSBtZXRob2QgdGhheSB2w6wgbWluaSBjYXJlIGPFqQogICAgICAgIGltcG9ydCByYW5kb20KICAgICAgICBjYXJlX21ldGhvZHMgPSBbIl9jYXJlX3N3aXBlX2ZlZWQiLCAiX2NhcmVfd2F0Y2hfdmlkZW9zIl0KICAgICAgICBzZWxlY3RlZF9tZXRob2QgPSByYW5kb20uY2hvaWNlKGNhcmVfbWV0aG9kcykKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIG1ldGhvZCA9IGdldGF0dHIoc2VsZiwgc2VsZWN0ZWRfbWV0aG9kKQogICAgICAgICAgICBzdWNjZXNzID0gbWV0aG9kKGFjY291bnQpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJMZWdhY3kgY2FyZSB1c2luZyB7c2VsZWN0ZWRfbWV0aG9kfTogeydzdWNjZXNzJyBpZiBzdWNjZXNzIGVsc2UgJ2ZhaWxlZCd9IikKICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTGVnYWN5IGNhcmUgZXJyb3I6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIHBlcmZvcm1fbWluaV9jYXJlKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gbWluaSBjYXJlIGNobyB0w6BpIGtob+G6o24gVGlrVG9rOgogICAgICAgIDEuIFbhu4EgdHJhbmcgY2jhu6csIHjDoWMgbmjhuq1uIHRhYiDEkeG7gSB4deG6pXQKICAgICAgICAyLiBMxrDhu5t0IMSR4buBIHh14bqldCB0cm9uZyAyLTMgcGjDunQKICAgICAgICAzLiBOZ+G6q3Ugbmhpw6puIGLhuqVtIHbDoG8gSOG7mXAgdGjGsCwgZOG7q25nIDItNXMsIHZ14buRdCBsw6puLCBxdWF5IGzhuqFpIHRyYW5nIGNo4bunCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSBtaW5pIGNhcmUgY2hvIHTDoGkga2hv4bqjbiBUaWtUb2s6IHthY2NvdW50Wyd1bmlxdWVfdXNlcm5hbWUnXX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAxLiDEkOG6o20gYuG6o28gduG7gSB0cmFuZyBjaOG7pyB2w6AgeMOhYyBuaOG6rW4gdGFiIMSR4buBIHh14bqldAogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgduG7gSB0cmFuZyBjaOG7pyBUaWtUb2siKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHbDoCBjbGljayB2w6BvIHRhYiAiRMOgbmggY2hvIGLhuqFuIiAodGFiIMSR4buBIHh14bqldCkKICAgICAgICAgICAgZm9yX3lvdV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iRMOgbmggY2hvIGLhuqFuIikKICAgICAgICAgICAgaWYgbm90IGZvcl95b3VfdGFiOgogICAgICAgICAgICAgICAgZm9yX3lvdV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJEw6BuaCBjaG8gYuG6oW4iKQogICAgICAgICAgICBpZiBub3QgZm9yX3lvdV90YWI6CiAgICAgICAgICAgICAgICBmb3JfeW91X3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJGb3IgWW91IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiBmb3JfeW91X3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlTDrG0gdGjhuqV5IHRhYiDEkeG7gSB4deG6pXQsIMSRYW5nIGNsaWNrIHbDoG8uLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGZvcl95b3VfdGFiKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIMSR4buBIHh14bqldCwgZ2nhuqMgxJHhu4tuaCDEkWFuZyDhu58gdGFiIMSRw7puZyIpCgogICAgICAgICAgICAjIDIuIEzGsOG7m3QgxJHhu4EgeHXhuqV0IHRyb25nIDEtMyBwaMO6dAogICAgICAgICAgICBzY3JvbGxfZHVyYXRpb24gPSByYW5kb20ucmFuZGludCg2MCwgMTgwKSAgIyAxLTMgcGjDunQKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSBsxrDhu5t0IMSR4buBIHh14bqldCB0cm9uZyB7c2Nyb2xsX2R1cmF0aW9ufSBnacOieS4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgdmlkZW9fY291bnQgPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSAodGltZS50aW1lKCkgLSBzdGFydF90aW1lKSA8IHNjcm9sbF9kdXJhdGlvbjoKICAgICAgICAgICAgICAgICMgTMaw4bubdCBsw6puIMSR4buDIGNodXnhu4NuIHZpZGVvIHRp4bq/cCB0aGVvCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICB2aWRlb19jb3VudCArPSAxCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmdo4buJIG5n4bqrdSBuaGnDqm4gMy04IGdpw6J5IGdp4buvYSBjw6FjIHZpZGVvIChuaMawIG5nxrDhu51pIGTDuW5nIHRo4bqtdCkKICAgICAgICAgICAgICAgIHdhdGNoX3RpbWUgPSByYW5kb20ucmFuZGludCgzLCA4KQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhdGNoX3RpbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUmFuZG9tIGPDsyAxMCUga2jhuqMgbsSDbmcgYuG6pW0gbGlrZSB2aWRlbwogICAgICAgICAgICAgICAgaWYgcmFuZG9tLnJhbmRvbSgpIDwgMC4xOiAgIyAxMCUgY2hhbmNlCiAgICAgICAgICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLl9maW5kX2xpa2VfYnV0dG9uKCkKICAgICAgICAgICAgICAgICAgICBpZiBsaWtlX2J1dHRvbiBhbmQgbm90IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b24pOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJSYW5kb20gbGlrZSB2aWRlbyB0cm9uZyBraGkgbWluaSBjYXJlIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGxpa2VfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBSYW5kb20gY8OzIDUlIGto4bqjIG7Eg25nIGLhuqVtIHNoYXJlCiAgICAgICAgICAgICAgICBpZiByYW5kb20ucmFuZG9tKCkgPCAwLjA1OiAgIyA1JSBjaGFuY2UKICAgICAgICAgICAgICAgICAgICBzaGFyZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJDaGlhIHPhursiKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzaGFyZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlNoYXJlIikKICAgICAgICAgICAgICAgICAgICBpZiBzaGFyZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlJhbmRvbSBjbGljayBzaGFyZSB0cm9uZyBraGkgbWluaSBjYXJlIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNoYXJlX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICMgTmjhuqVuIGJhY2sgxJHhu4MgxJHDs25nIGRpYWxvZyBzaGFyZQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBsxrDhu5t0IHt2aWRlb19jb3VudH0gdmlkZW8gdHJvbmcge3Njcm9sbF9kdXJhdGlvbn0gZ2nDonkiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAzLiBOZ+G6q3Ugbmhpw6puIGLhuqVtIHbDoG8gSOG7mXAgdGjGsCAoNTAlIGto4bqjIG7Eg25nKQogICAgICAgICAgICBpZiByYW5kb20ucmFuZG9tKCkgPCAwLjU6ICAjIDUwJSBjaGFuY2UKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlJhbmRvbSB0cnV5IGPhuq1wIEjhu5lwIHRoxrAuLi4iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gdsOgIGNsaWNrIHbDoG8gSOG7mXAgdGjGsAogICAgICAgICAgICAgICAgaW5ib3hfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iSOG7mXAgdGjGsCIpCiAgICAgICAgICAgICAgICBpZiBpbmJveF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgSOG7mXAgdGjGsCwgxJFhbmcgY2xpY2sgdsOgby4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGluYm94X2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEThu6tuZyBs4bqhaSAyLTUgZ2nDonkKICAgICAgICAgICAgICAgICAgICB3YWl0X3RpbWUgPSByYW5kb20ucmFuZGludCgyLCA1KQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJE4burbmcgbOG6oWkge3dhaXRfdGltZX0gZ2nDonkgdHJvbmcgSOG7mXAgdGjGsC4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhaXRfdGltZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFZ14buRdCBsw6puIHRyb25nIEjhu5lwIHRoxrAKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJWdeG7kXQgbMOqbiB0cm9uZyBI4buZcCB0aMawLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBRdWF5IGzhuqFpIHRyYW5nIGNo4bunCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiUXVheSBs4bqhaSB0cmFuZyBjaOG7pyB04burIEjhu5lwIHRoxrAuLi4iKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmJhY2tfdG9faG9tZSgpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgcXVheSB24buBIHRyYW5nIGNo4bunIHThu6sgSOG7mXAgdGjGsCIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IEjhu5lwIHRoxrAiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiU2tpcCB0cnV5IGPhuq1wIEjhu5lwIHRoxrAgbOG6p24gbsOgeSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyB24buBIHRyYW5nIGNo4bunIGN14buRaSBjw7luZwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyDEkeG6o20gYuG6o28gduG7gSB0cmFuZyBjaOG7pyBzYXUgbWluaSBjYXJlIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiSG/DoG4gdGjDoG5oIG1pbmkgY2FyZSBjaG8gdMOgaSBraG/huqNuIFRpa1Rvazoge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gbWluaSBjYXJlIGNobyB0w6BpIGtob+G6o24gVGlrVG9rOiB7YWNjb3VudFsndW5pcXVlX3VzZXJuYW1lJ119IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G7kSBn4bqvbmcgduG7gSB0cmFuZyBjaOG7pyBu4bq/dSBjw7MgbOG7l2kKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfZW5zdXJlX2Zvcl95b3VfdGFiKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0YWIgxJHhu4EgeHXhuqV0IChGb3IgWW91KQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVMOsbSB0YWIgIkTDoG5oIGNobyBi4bqhbiIgaG/hurdjICJGb3IgWW91IgogICAgICAgICAgICBmb3JfeW91X3RleHRzID0gWyJEw6BuaCBjaG8gYuG6oW4iLCAiRm9yIFlvdSIsICLEkOG7gSB4deG6pXQiXQogICAgICAgICAgICBmb3JfeW91X3RhYiA9IE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciB0ZXh0IGluIGZvcl95b3VfdGV4dHM6CiAgICAgICAgICAgICAgICBmb3JfeW91X3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICBpZiBmb3JfeW91X3RhYjoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGZvcl95b3VfdGFiOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRoZW8gY29udGVudC1kZXNjCiAgICAgICAgICAgICAgICBmb3IgZGVzYyBpbiBmb3JfeW91X3RleHRzOgogICAgICAgICAgICAgICAgICAgIGZvcl95b3VfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz1kZXNjKQogICAgICAgICAgICAgICAgICAgIGlmIGZvcl95b3VfdGFiOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZm9yX3lvdV90YWI6CiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHRhYiBjw7MgxJHGsOG7o2MgY2jhu41uIGtow7RuZwogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQoZm9yX3lvdV90YWIpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRhYiDEkeG7gSB4deG6pXQgY2jGsGEgxJHGsOG7o2MgY2jhu41uLCDEkWFuZyBjbGljayB2w6BvLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZm9yX3lvdV90YWIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgeMOhYyBuaOG6rW4gdGFiIMSR4buBIHh14bqldCIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiDEkeG7gSB4deG6pXQiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIHjDoWMgbmjhuq1uIHRhYiDEkeG7gSB4deG6pXQiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9zY3JvbGxfZm9yX3lvdV9mZWVkKHNlbGYsIGR1cmF0aW9uX3NlY29uZHM6IGludCkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBMxrDhu5t0IGZlZWQgxJHhu4EgeHXhuqV0IHRyb25nIGtob+G6o25nIHRo4budaSBnaWFuIG5o4bqldCDEkeG7i25oCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZHVyYXRpb25fc2Vjb25kczogVGjhu51pIGdpYW4gbMaw4bubdCAoZ2nDonkpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICBzY3JvbGxfY291bnQgPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCBkdXJhdGlvbl9zZWNvbmRzOgogICAgICAgICAgICAgICAgIyBWdeG7kXQgbMOqbiDEkeG7gyBjaHV54buDbiB2aWRlbyB0aeG6v3AgdGhlbwogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2Nyb2xsX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOZ2jhu4kgbmfhuqt1IG5oacOqbiAyLTYgZ2nDonkgbmjGsCBuZ8aw4budaSBkw7luZyB0aOG6rXQgeGVtIHZpZGVvCiAgICAgICAgICAgICAgICB3YXRjaF90aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgNikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YXRjaF90aW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFJhbmRvbSB0aOG7iW5oIHRob+G6o25nIGThu6tuZyBsw6J1IGjGoW4gKG5oxrAgxJFhbmcgeGVtIHZpZGVvIHRow7ogduG7iykKICAgICAgICAgICAgICAgIGlmIHJhbmRvbS5yYW5kaW50KDEsIDEwKSA9PSAxOiAgIyAxMCUgeMOhYyBzdeG6pXQKICAgICAgICAgICAgICAgICAgICBsb25nX3dhdGNoX3RpbWUgPSByYW5kb20ucmFuZGludCg4LCAxNSkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiROG7q25nIHhlbSB2aWRlbyBsw6J1IGjGoW46IHtsb25nX3dhdGNoX3RpbWV9cyIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKGxvbmdfd2F0Y2hfdGltZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMb2cgdGnhur9uIHRyw6xuaCBt4buXaSAzMCBnacOieQogICAgICAgICAgICAgICAgZWxhcHNlZCA9IHRpbWUudGltZSgpIC0gc3RhcnRfdGltZQogICAgICAgICAgICAgICAgaWYgZWxhcHNlZCA+IDAgYW5kIGludChlbGFwc2VkKSAlIDMwID09IDAgYW5kIHNjcm9sbF9jb3VudCA+IDA6CiAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nID0gZHVyYXRpb25fc2Vjb25kcyAtIGVsYXBzZWQKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBsxrDhu5t0IHtzY3JvbGxfY291bnR9IHZpZGVvLCBjw7JuIGzhuqFpIHtpbnQocmVtYWluaW5nKX1zIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJIb8OgbiB0aMOgbmggbMaw4bubdCDEkeG7gSB4deG6pXQ6IHtzY3JvbGxfY291bnR9IHZpZGVvIHRyb25nIHtkdXJhdGlvbl9zZWNvbmRzfXMiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGzGsOG7m3QgZmVlZCDEkeG7gSB4deG6pXQiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9pbnRlcmFjdF93aXRoX2luYm94KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVMawxqFuZyB0w6FjIHbhu5tpIEjhu5lwIHRoxrA6IGLhuqVtIHbDoG8sIGThu6tuZyAyLTVzLCB2deG7kXQgbMOqbgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVMOsbSBuw7p0IEjhu5lwIHRoxrAKICAgICAgICAgICAgaW5ib3hfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iSOG7mXAgdGjGsCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgaW5ib3hfYnV0dG9uOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRoZW8gdGV4dAogICAgICAgICAgICAgICAgaW5ib3hfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9Ikjhu5lwIHRoxrAiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGluYm94X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IEjhu5lwIHRoxrAiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENsaWNrIHbDoG8gSOG7mXAgdGjGsAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkGFuZyBjbGljayB2w6BvIEjhu5lwIHRoxrAiKQogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaW5ib3hfYnV0dG9uKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBE4burbmcgbOG6oWkgMi01IGdpw6J5CiAgICAgICAgICAgIHdhaXRfdGltZSA9IHJhbmRvbS5yYW5kaW50KDIsIDUpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJE4burbmcgdHJvbmcgSOG7mXAgdGjGsCB7d2FpdF90aW1lfXMiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBWdeG7kXQgbMOqbiB0cm9uZyBI4buZcCB0aMawCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlZ14buRdCBsw6puIHRyb25nIEjhu5lwIHRoxrAiKQogICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSB0aGFvIHTDoWMgdnXhu5F0IGzDqm4gdGjDqm0gMS0yIGzhuqduIG7hu69hCiAgICAgICAgICAgIGFkZGl0aW9uYWxfc3dpcGVzID0gcmFuZG9tLnJhbmRpbnQoMSwgMikKICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoYWRkaXRpb25hbF9zd2lwZXMpOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDAuNSwgMS41KSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkhvw6BuIHRow6BuaCB0xrDGoW5nIHTDoWMgduG7m2kgSOG7mXAgdGjGsCIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgdMawxqFuZyB0w6FjIHbhu5tpIEjhu5lwIHRoxrAiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZ2V0X2F2YWlsYWJsZV9qb2JzKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBkYW5oIHPDoWNoIGPDoWMgam9iIGto4bqjIGThu6VuZyB04burIEdvTGlrZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGpvYiBob+G6t2MgbGlzdCBy4buXbmcgbuG6v3Uga2jDtG5nIGPDswogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBzZWxmLmdvbGlrZV9zZXJ2aWNlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGzhuqV5IGpvYjogR29MaWtlU2VydmljZSBjaMawYSDEkcaw4bujYyBjdW5nIGPhuqVwIikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBH4buNaSBBUEkgbOG6pXkgam9iCiAgICAgICAgICAgIGpvYl91cmwgPSBzZWxmLmdldF9qb2JzX3VybCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHRoYW0gc+G7kQogICAgICAgICAgICBwYXJhbXMgPSBzZWxmLmdldF9qb2JfcGFyYW1zKGFjY291bnQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSQogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuYXBpX3JlcXVlc3Qoam9iX3VybCwgIkdFVCIsIHBhcmFtcykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN1Y2Nlc3MiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBqb2JfZGF0YSA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIE5vbmUpCiAgICAgICAgICAgICAgICBpZiBqb2JfZGF0YToKICAgICAgICAgICAgICAgICAgICAjIENodeG6qW4gaMOzYSBk4buvIGxp4buHdSBqb2IKICAgICAgICAgICAgICAgICAgICBqb2IgPSBzZWxmLm1hcF9qb2JfZGF0YShqb2JfZGF0YSkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0w6xtIHRo4bqleSBqb2Ige2pvYlsnaWQnXX0gbG/huqFpIHtqb2JbJ3R5cGUnXX0gY2hvIHTDoGkga2hv4bqjbiB7YWNjb3VudFsndW5pcXVlX3VzZXJuYW1lJ119IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2pvYl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gW10KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGzhuqV5IGRhbmggc8OhY2ggam9iIikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBleGVjdXRlX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIGpvYiwgYmFvIGfhu5NtOgogICAgICAgICAgICAgICAgLSBzdGF0dXMgKGludCk6IE3DoyB0cuG6oW5nIHRow6FpIGpvYgogICAgICAgICAgICAgICAgICAgIDA6IENoxrBhIHRo4buxYyBoaeG7h24KICAgICAgICAgICAgICAgICAgICAxOiBUaMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICAyOiBUaOG6pXQgYuG6oWksIGtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcKICAgICAgICAgICAgICAgICAgICAzOiBUaOG6pXQgYuG6oWksIMSRw6MgYuG7iyB1bmZvbGxvdy91bmxpa2UKICAgICAgICAgICAgICAgICAgICA0OiBUaOG6pXQgYuG6oWksIHnDqnUgY+G6p3UgxJFhbmcgY2jhu50KICAgICAgICAgICAgICAgIC0gbWVzc2FnZSAoc3RyKTogVGjDtG5nIGLDoW8ga+G6v3QgcXXhuqMKICAgICAgICAgICAgICAgIC0gc3VjY2VzcyAoYm9vbCk6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGpvYl90eXBlID0gam9iLmdldCgidHlwZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIGpvYl9saW5rID0gam9iLmdldCgibGluayIsICIiKQogICAgICAgICAgICBqb2JfaWQgPSBqb2IuZ2V0KCJpZCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgdGjhu7FjIGhp4buHbiBqb2Ige2pvYl9pZH0gbG/huqFpIHtqb2JfdHlwZX0gduG7m2kgbGluayB7am9iX2xpbmt9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBsb+G6oWkgam9iIMSRxrDhu6NjIGjhu5cgdHLhu6MKICAgICAgICAgICAgaWYgam9iX3R5cGUgbm90IGluIFsiZm9sbG93IiwgImxpa2UiXToKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBmIkxv4bqhaSBqb2Ige2pvYl90eXBlfSBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7oyIKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IDIsCiAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBqb2IgdGhlbyBsb+G6oWkKICAgICAgICAgICAgam9iX3N0YXR1cyA9IDAgICMgTeG6t2MgxJHhu4tuaCBsw6AgY2jGsGEgbMOgbQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgam9iX3R5cGUgPT0gImZvbGxvdyI6CiAgICAgICAgICAgICAgICBqb2Jfc3RhdHVzID0gc2VsZi5fcGVyZm9ybV9mb2xsb3dfam9iKGpvYl9saW5rKQogICAgICAgICAgICBlbGlmIGpvYl90eXBlID09ICJsaWtlIjoKICAgICAgICAgICAgICAgIGpvYl9zdGF0dXMgPSBzZWxmLl9wZXJmb3JtX2xpa2Vfam9iKGpvYl9saW5rKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBW4buBIHRyYW5nIGNo4bunIHbDoCB2deG7kXQgYuG6o25nIHRpbiBu4bq/dSBqb2IgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgIGlmIHNlbGYuYmFja190b19ob21lKCk6CiAgICAgICAgICAgICAgICBpZiBqb2Jfc3RhdHVzID09IDE6ICAjIENo4buJIHZ14buRdCBraGkgam9iIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIHNlbGYuX3Njcm9sbF9mZWVkX2FmdGVyX2pvYigpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIGvhur90IHF14bqjIHRy4bqjIHbhu4EgZOG7sWEgdHLDqm4gam9iX3N0YXR1cwogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHRfZnJvbV9zdGF0dXMoam9iX3N0YXR1cywgam9iX3R5cGUpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYjoge3N0cihlKX0iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMiwgbWVzc2FnZSwgRmFsc2UpCiAgICAKICAgIGRlZiBfY3JlYXRlX2pvYl9yZXN1bHRfZnJvbV9zdGF0dXMoc2VsZiwgam9iX3N0YXR1czogaW50LCBqb2JfdHlwZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBU4bqhbyBr4bq/dCBxdeG6oyBqb2IgdOG7qyBzdGF0dXMgY29kZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl9zdGF0dXM6IE3DoyB0cuG6oW5nIHRow6FpIGpvYiB04burIF9wZXJmb3JtX3h4eF9qb2IKICAgICAgICAgICAgam9iX3R5cGU6IExv4bqhaSBqb2IgKGZvbGxvdywgbGlrZSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIGpvYgogICAgICAgICIiIgogICAgICAgIGlmIGpvYl9zdGF0dXMgPT0gMTogICMgVGjDoG5oIGPDtG5nCiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIsSQw6MgaG/DoG4gdGjDoG5oIGpvYiB7am9iX3R5cGV9IHRow6BuaCBjw7RuZyIKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMSwgbWVzc2FnZSwgVHJ1ZSkKICAgICAgICBlbGlmIGpvYl9zdGF0dXMgPT0gMjogICMgS2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZwogICAgICAgICAgICBtZXNzYWdlID0gZiJLaMO0bmcgdGjhu4MgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nIMSR4buDIHRo4buxYyBoaeG7h24gam9iIHtqb2JfdHlwZX0iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDIsIG1lc3NhZ2UsIEZhbHNlKQogICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSAzOiAgIyBC4buLIHVuZm9sbG93L3VubGlrZQogICAgICAgICAgICBtZXNzYWdlID0gZiLEkOG7kWkgdMaw4bujbmcgxJHDoyBi4buLIHVuZm9sbG93L3VubGlrZSIKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhtZXNzYWdlKQogICAgICAgICAgICAjIMSQw6FuaCBk4bqldSB1bmZvbGxvdyDEkeG7gyBKb2JTZXJ2aWNlIHjhu60gbMO9CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCgzLCBtZXNzYWdlLCBGYWxzZSwgdW5mb2xsb3c9VHJ1ZSkKICAgICAgICBlbGlmIGpvYl9zdGF0dXMgPT0gNDogICMgWcOqdSBj4bqndSDEkWFuZyBjaOG7nQogICAgICAgICAgICBtZXNzYWdlID0gZiJZw6p1IGPhuqd1IMSRYW5nIGNo4budIHRyb25nIGpvYiB7am9iX3R5cGV9IgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCg0LCBtZXNzYWdlLCBGYWxzZSkKICAgICAgICBlbHNlOiAgIyBUaOG6pXQgYuG6oWkgaG/hurdjIHRy4bqhbmcgdGjDoWkga2jDoWMKICAgICAgICAgICAgbWVzc2FnZSA9IGYiVGjhu7FjIGhp4buHbiBqb2Ige2pvYl90eXBlfSB0aOG6pXQgYuG6oWkgduG7m2kgdHLhuqFuZyB0aMOhaSB7am9iX3N0YXR1c30iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdChqb2Jfc3RhdHVzIGlmIGpvYl9zdGF0dXMgPiAwIGVsc2UgMCwgbWVzc2FnZSwgRmFsc2UpCiAgICAgICAgICAgIAogICAgZGVmIF9jaGVja19hY2NvdW50X3N0YXR1c19kaWFsb2coc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIGRpYWxvZyAiVHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24iIHbDoCB44butIGzDvSBu4bq/dSBjw7MKICAgICAgICBTYXUga2hpIGLhuqVtIE9LLCBraeG7g20gdHJhIHhlbSBjw7MgduG7gSB0cmFuZyBjaOG7pyBraMO0bmcgdsOgIHN5bmMgYWNjb3VudHMKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGPDsyBkaWFsb2cgdsOgIGPhuqduIG5n4burbmcgaG/huqF0IMSR4buZbmcgdMOgaSBraG/huqNuLCBGYWxzZSBu4bq/dSBraMO0bmcgY8OzIGRpYWxvZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaOG7nSBt4buZdCBjaMO6dCDEkeG7gyBkaWFsb2cgY8OzIHRo4buDIHh14bqldCBoaeG7h24KICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gZGlhbG9nIGPDsyB0ZXh0ICJUcuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbiIKICAgICAgICAgICAgc3RhdHVzX2RpYWxvZyA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJUcuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdGF0dXNfZGlhbG9nOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiUGjDoXQgaGnhu4duIGRpYWxvZyAnVHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24nIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgY8OzIHJlc291cmNlLWlkPSJhbmRyb2lkOmlkL21lc3NhZ2UiCiAgICAgICAgICAgICAgICBtZXNzYWdlX2VsZW1lbnQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImFuZHJvaWQ6aWQvbWVzc2FnZSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG1lc3NhZ2VfZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlX3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KG1lc3NhZ2VfZWxlbWVudCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlRow7RuZyBiw6FvIHRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuOiB7bWVzc2FnZV90ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBMxrB1IHRow7RuZyBiw6FvIHbDoG8gZGF0YWJhc2UgaG/hurdjIGxvZwogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiQ1JJVElDQUw6IFTDoGkga2hv4bqjbiBi4buLIGjhuqFuIGNo4bq/IC0ge21lc3NhZ2VfdGV4dH0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgY2xpY2sgbsO6dCBPSy/EkMOzbmcgxJHhu4MgxJHDs25nIGRpYWxvZwogICAgICAgICAgICAgICAgICAgIG9rX2NsaWNrZWQgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgIG9rX2J1dHRvbnMgPSBbIk9LIiwgIsSQw7NuZyIsICJUw7RpIGhp4buDdSIsICLEkOG7k25nIMO9Il0KICAgICAgICAgICAgICAgICAgICBmb3IgYnRuX3RleHQgaW4gb2tfYnV0dG9uczoKICAgICAgICAgICAgICAgICAgICAgICAgb2tfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9YnRuX3RleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9rX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihva19idXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBi4bqlbSBuw7p0ICd7YnRuX3RleHR9JyDEkeG7gyDEkcOzbmcgZGlhbG9nIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rX2NsaWNrZWQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG9rX2NsaWNrZWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQ2jhu50gNSBnacOieSB2w6Aga2nhu4NtIHRyYSB0cmFuZyBjaOG7pyB0cm9uZyA1IGzhuqduCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkNo4budIDVzIHbDoCBraeG7g20gdHJhIHRyYW5nIGNo4bunIHRyb25nIDUgbOG6p24uLi4iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGhvbWVfc2NyZWVuX2RldGVjdGVkID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UoNSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiS2nhu4NtIHRyYSB0cmFuZyBjaOG7pyBs4bqnbiB7YXR0ZW1wdCArIDF9LzUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiDEkcOjIHbhu4EgdHJhbmcgY2jhu6cgLSBjw7Mga2jhuqMgbsSDbmcgdMOgaSBraG/huqNuIGLhu4sgbG9nb3V0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob21lX3NjcmVlbl9kZXRlY3RlZCA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBob21lX3NjcmVlbl9kZXRlY3RlZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBzeW5jIGFjY291bnRzIMSR4buDIGtp4buDbSB0cmEgYWNjb3VudCBjw7MgY8OybiB0cm9uZyBkYW5oIHPDoWNoIGtow7RuZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVGjhu7FjIGhp4buHbiBzeW5jIGFjY291bnRzIMSR4buDIGtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24uLi4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gaGnhu4duIHThuqFpIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9kZXZpY2VfYWNjb3VudHMgPSBzZWxmLmdldF9hY2NvdW50c19mcm9tX2RldmljZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF91c2VybmFtZXMgPSB7YWNjLmdldCgidW5pcXVlX3VzZXJuYW1lIiwgIiIpLmxvd2VyKCkgZm9yIGFjYyBpbiBjdXJyZW50X2RldmljZV9hY2NvdW50c30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIFRpa1RvayB04burIERCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJfYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9c2VsZi5hcHBfbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OhYyB0w6BpIGtob+G6o24gdHJvbmcgREIgY8OzIGPDsm4gdOG7k24gdOG6oWkgdHLDqm4gdGhp4bq/dCBi4buLIGtow7RuZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBkYl9hY2NvdW50IGluIGRiX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYl91c2VybmFtZSA9IGRiX2FjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiLCAiIikubG93ZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkYl91c2VybmFtZSBhbmQgZGJfdXNlcm5hbWUgbm90IGluIGN1cnJlbnRfdXNlcm5hbWVzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6BpIGtob+G6o24ga2jDtG5nIGPDsm4gdOG7k24gdOG6oWkgdHLDqm4gdGhp4bq/dCBi4buLIC0gxJHDoW5oIGThuqV1IG5n4burbmcgaG/huqF0IMSR4buZbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJUw6BpIGtob+G6o24ge2RiX2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0ga2jDtG5nIGPDsm4gdHJvbmcgZGFuaCBzw6FjaCB0aGnhur90IGLhu4sgLSDEkcOhbmggZOG6pXUgbmfhu6tuZyBob+G6oXQgxJHhu5luZyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiaW5hY3RpdmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfZW5hYmxlIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJlYXNvbiI6ICJUw6BpIGtob+G6o24gYuG7iyBsb2cgb3V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoZGJfYWNjb3VudFsiaWQiXSwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyDEkcOhbmggZOG6pXUgdMOgaSBraG/huqNuIHtkYl9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IG5n4burbmcgaG/huqF0IMSR4buZbmcgduG7m2kgbMO9IGRvOiBUw6BpIGtob+G6o24gYuG7iyBsb2cgb3V0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFN5bmMgbOG6oWkgYWNjb3VudHMgbeG7m2kKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN5bmNfYWNjb3VudHNfdG9fZGIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBzeW5jX2Vycm9yOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihzeW5jX2Vycm9yLCAiTOG7l2kga2hpIHN5bmMgYWNjb3VudHMgc2F1IGtoaSBwaMOhdCBoaeG7h24gZGlhbG9nIHRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJUw6xtIHRo4bqleSBkaWFsb2cgJ1Ry4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuJyBuaMawbmcga2jDtG5nIHTDrG0gdGjhuqV5IG1lc3NhZ2UiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraeG7g20gdHJhIGRpYWxvZyB0cuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfcGVyZm9ybV9mb2xsb3dfam9iKHNlbGYsIHByb2ZpbGVfbGluazogc3RyKSAtPiBpbnQ6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IgZm9sbG93IHRyw6puIFRpa1RvawogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb2ZpbGVfbGluazogTGluayDEkeG6v24gdHJhbmcgY8OhIG5ow6JuIGPhuqduIGZvbGxvdyAoZOG6oW5nOiBodHRwczovL3d3dy50aWt0b2suY29tL0B1c2VybmFtZSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgaW50OiBUcuG6oW5nIHRow6FpIGpvYiAoMDogY2jGsGEgbMOgbSwgMTogaG/DoG4gdGjDoG5oLCAyOiBs4buXaSwgMzogYuG7iyB1bmZvbGxvdywgNDogecOqdSBj4bqndSBjaOG7nSwgNTogZ+G7rWkgecOqdSBj4bqndSkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IHVzZXJuYW1lIHThu6sgVVJMIFRpa1RvayDEkeG7gyBz4butIGThu6VuZyBjaG8gbG9nZ2luZwogICAgICAgICAgICB1c2VybmFtZV9tYXRjaCA9IHJlLnNlYXJjaChyJ3Rpa3Rva1wuY29tL0AoW14vP10rKScsIHByb2ZpbGVfbGluaykKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX21hdGNoOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgdHLDrWNoIHh14bqldCB1c2VybmFtZSB04burIGxpbms6IHtwcm9maWxlX2xpbmt9IikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdXNlcm5hbWUgPSB1c2VybmFtZV9tYXRjaC5ncm91cCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIHRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICBpZiBub3Qgc2VsZi5fb3Blbl9wcm9maWxlX3BhZ2UocHJvZmlsZV9saW5rKToKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4budIHRow6ptIGNobyB0cmFuZyBo4buTIHPGoSB04bqjaSB4b25nCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIG7DunQgRm9sbG93IHRoZW8gY8OhYyBjw6FjaCBraMOhYyBuaGF1CiAgICAgICAgICAgIGZvbGxvd19idXR0b24gPSBOb25lCiAgICAgICAgICAgICMgTOG6pXkgWE1MIG3hu5l0IGzhuqduIMSR4buDIHNvIHPDoW5oCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQoKICAgICAgICAgICAgIyBDw6FjaCAxOiBUw6xtIHRoZW8gdGV4dCB0aeG6v25nIFZp4buHdCB2w6AgdGnhur9uZyBBbmgKICAgICAgICAgICAgZm9sbG93X3RleHRzID0gWyJUaGVvIGTDtWkiLCAiRm9sbG93IiwgIsSQYW5nIHRoZW8gZMO1aSIsICJGb2xsb3dpbmciLCAixJDDoyB5w6p1IGPhuqd1IiwgIlJlcXVlc3RlZCIsIkfhu61pIPCfkYsiXQogICAgICAgICAgICBmb3IgdGV4dCBpbiBmb2xsb3dfdGV4dHM6CiAgICAgICAgICAgICAgICBmb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICBpZiBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICAjIEPDoWNoIDI6IFTDrG0gdGhlbyBjb250ZW50LWRlc2MgbuG6v3UgY2jGsGEgdMOsbSB0aOG6pXkKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBmb2xsb3dfZGVzY3MgPSBbIlRoZW8gZMO1aSIsICJGb2xsb3ciLCAixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyJdCiAgICAgICAgICAgICAgICBmb3IgZGVzYyBpbiBmb2xsb3dfZGVzY3M6CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPWRlc2MpCiAgICAgICAgICAgICAgICAgICAgaWYgZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu60gbOG6oWkgbOG6p24gbuG7r2EgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgZm9sbG93CiAgICAgICAgICAgIGlmIG5vdCBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgdGhlbyBkw7VpIOG7nyBs4bqnbiDEkeG6p3UsIHRo4butIHZ14buRdCBtw6BuIGjDrG5oIHbDoCB0w6xtIGzhuqFpIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSB04bqldCBj4bqjIGPDoWMgY8OhY2gKICAgICAgICAgICAgICAgIGZvciB0ZXh0IGluIGZvbGxvd190ZXh0czoKICAgICAgICAgICAgICAgICAgICBmb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICAgICAgaWYgZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IHRoZW8gZMO1aSBzYXUgbmhp4buBdSBs4bqnbiB0aOG7rSIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0ZXh0IGPhu6dhIG7DunQKICAgICAgICAgICAgYnV0dG9uX3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KGZvbGxvd19idXR0b24pCiAgICAgICAgICAgIGJ1dHRvbl9yZXNvdXJjZV9pZCA9IGZvbGxvd19idXR0b24uZ2V0KCJyZXNvdXJjZS1pZCIsICIiKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVGV4dCBj4bunYSBuw7p0IGZvbGxvdzogJ3tidXR0b25fdGV4dH0nLCByZXNvdXJjZS1pZDogJ3tidXR0b25fcmVzb3VyY2VfaWR9JyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBoaeG7h24gdOG6oWkKICAgICAgICAgICAgaWYgYnV0dG9uX3RleHQgaW4gWyLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIiwiR+G7rWkg8J+RiyJdOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgdGhlbyBkw7VpIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IHThu6sgdHLGsOG7m2MiKQogICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGJ1dHRvbl90ZXh0IGluIFsixJDDoyB5w6p1IGPhuqd1IiwgIlJlcXVlc3RlZCJdOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgecOqdSBj4bqndSB0aGVvIGTDtWkgdMOgaSBraG/huqNuIHt1c2VybmFtZX0gdOG7qyB0csaw4bubYyIpCiAgICAgICAgICAgICAgICByZXR1cm4gNQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBsw6AgIlRoZW8gZMO1aSIgaG/hurdjICJGb2xsb3ciIHRow6wgY2xpY2sgdsOgbyBuw7p0CiAgICAgICAgICAgIGlmIGJ1dHRvbl90ZXh0IGluIFsiVGhlbyBkw7VpIiwgIkZvbGxvdyJdOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVGjhu7FjIGhp4buHbiBjbGljayB2w6BvIG7DunQgdGhlbyBkw7VpIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGZvbGxvd19idXR0b24pCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGRpYWxvZyAiVHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24iCiAgICAgICAgICAgICAgICBpZiBzZWxmLl9jaGVja19hY2NvdW50X3N0YXR1c19kaWFsb2coKToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiVMOgaSBraG/huqNuIGLhu4sgaOG6oW4gY2jhur8sIG5n4burbmcgaG/huqF0IMSR4buZbmcgdsOgIGjhu6d5IGpvYiIpCiAgICAgICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIG5n4burbmcgaG/huqF0IMSR4buZbmcKICAgICAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4Egc3RhdHVzIDIgxJHhu4MgYsOhbyBs4buXaSB2w6AgaOG7p3kgam9iCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBWdeG7kXQgeHXhu5FuZyAxIGzhuqduIMSR4buDIHJlZnJlc2ggdHLhuqFuZyB0aMOhaQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIGRpYWxvZyBoaeG7h24gbMOqbiBraMO0bmcKICAgICAgICAgICAgICAgICMgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAjIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAjICAgICAjIEtp4buDbSB0cmEgZGlhbG9nIGPhuqNuaCBiw6FvIGhv4bq3YyBnaeG7m2kgaOG6oW4KICAgICAgICAgICAgICAgICMgICAgIGRpYWxvZ3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC5hcHAuRGlhbG9nIikKICAgICAgICAgICAgICAgICMgICAgIGZvciBkaWFsb2cgaW4gZGlhbG9nczoKICAgICAgICAgICAgICAgICMgICAgICAgICBkaWFsb2dfdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoZGlhbG9nKQogICAgICAgICAgICAgICAgIyAgICAgICAgIGlmIGFueShrZXl3b3JkIGluIGRpYWxvZ190ZXh0Lmxvd2VyKCkgZm9yIGtleXdvcmQgaW4gWyJ0aOG7rSBs4bqhaSBzYXUiLCAiZ2nhu5tpIGjhuqFuIiwgImxpbWl0IiwgInRyeSBhZ2FpbiJdKToKICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgIyBUw6xtIHbDoCBuaOG6pW4gbsO6dCBPSy/EkMOzbmcKICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgb2tfYnV0dG9ucyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzY3JlZW5feG1sLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iKQogICAgICAgICAgICAgICAgIyAgICAgICAgICAgICBmb3IgYnRuIGluIG9rX2J1dHRvbnM6CiAgICAgICAgICAgICAgICAjICAgICAgICAgICAgICAgICBidG5fdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoYnRuKQogICAgICAgICAgICAgICAgIyAgICAgICAgICAgICAgICAgaWYgYnRuX3RleHQgYW5kIGJ0bl90ZXh0Lmxvd2VyKCkgaW4gWyJvayIsICLEkcOzbmciLCAidMO0aSBoaeG7g3UiLCAixJHhu5NuZyDDvSJdOgogICAgICAgICAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihidG4pCiAgICAgICAgICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiSm9iIGtow7RuZyBob8OgbiB0aMOgbmgsIGLhu4sgZ2nhu5tpIGjhuqFuIHRoZW8gZMO1aSIpCiAgICAgICAgICAgICAgICAjICAgICAgICAgICAgIHJldHVybiAzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB0ZXh0IHNhdSBraGkgbmjhuqVuIHRoZW8gZMO1aQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBs4bqhaSBuw7p0IGZvbGxvdyDEkeG7gyBraeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgLSDGsHUgdGnDqm4gdGhlbyByZXNvdXJjZS1pZCBu4bq/dSBjw7MKICAgICAgICAgICAgICAgIHVwZGF0ZWRfZm9sbG93X2J1dHRvbiA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7MgcmVzb3VyY2VfaWQsIHTDrG0gdGhlbyByZXNvdXJjZV9pZCB0csaw4bubYwogICAgICAgICAgICAgICAgaWYgYnV0dG9uX3Jlc291cmNlX2lkOgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD1idXR0b25fcmVzb3VyY2VfaWQpCiAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0w6xtIGzhuqFpIG7DunQgZm9sbG93IHRoZW8gcmVzb3VyY2UtaWQ6IHtidXR0b25fcmVzb3VyY2VfaWR9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgdGhlbyByZXNvdXJjZV9pZCBob+G6t2Mga2jDtG5nIGPDsyByZXNvdXJjZV9pZCwgdMOsbSB0aGVvIHRleHQKICAgICAgICAgICAgICAgIGlmIG5vdCB1cGRhdGVkX2ZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X3RleHRzID0gWyLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIiwgIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiLCAiVGhlbyBkw7VpIiwgIkZvbGxvdyJdCiAgICAgICAgICAgICAgICAgICAgZm9yIHRleHQgaW4gZm9sbG93X3RleHRzOgogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2ZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD10ZXh0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiB1cGRhdGVkX2ZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEZhbGxiYWNrOiB0w6xtIHRoZW8gY29udGVudC1kZXNjCiAgICAgICAgICAgICAgICBpZiBub3QgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIGZvbGxvd19kZXNjcyA9IFsiVGhlbyBkw7VpIiwgIkZvbGxvdyIsICLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIl0KICAgICAgICAgICAgICAgICAgICBmb3IgZGVzYyBpbiBmb2xsb3dfZGVzY3M6CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9ZGVzYykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodXBkYXRlZF9mb2xsb3dfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfcmVzb3VyY2VfaWQgPSB1cGRhdGVkX2ZvbGxvd19idXR0b24uZ2V0KCJyZXNvdXJjZS1pZCIsICIiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJTYXUga2hpIGNsaWNrIGZvbGxvdzogdGV4dD0ne3VwZGF0ZWRfdGV4dH0nLCByZXNvdXJjZS1pZD0ne3VwZGF0ZWRfcmVzb3VyY2VfaWR9JyIpCiAgICAgICAgICAgICAgICAgICAgIyBUcmltIHdoaXRlc3BhY2UgdOG7qyB1cGRhdGVkX3RleHQKICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX3RleHQgPSB1cGRhdGVkX3RleHQuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw6FjIHRyxrDhu51uZyBo4bujcCBraMOhYyBuaGF1CiAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF90ZXh0IGluIFsixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyIsICJOaOG6r24gdGluIiwgIk1lc3NhZ2UiLCJH4butaSDwn5GLIl06CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkZvbGxvdyB0aMOgbmggY8O0bmchIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgICAgICBlbGlmIHVwZGF0ZWRfdGV4dCBpbiBbIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBn4butaSB5w6p1IGPhuqd1IHRoZW8gZMO1aSB0aMOgbmggY8O0bmchIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDUKICAgICAgICAgICAgICAgICAgICBlbGlmIHVwZGF0ZWRfdGV4dCBpbiBbIlRoZW8gZMO1aSIsICJGb2xsb3ciXToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJGb2xsb3cga2jDtG5nIHRow6BuaCBjw7RuZywgdGV4dCBj4bunYSBuw7p0IHbhuqtuIGzDoDoge3VwZGF0ZWRfdGV4dH0iKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMwogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiRm9sbG93IGtow7RuZyB0aMOgbmggY8O0bmcsIHRleHQgY+G7p2EgbsO6dCBsw6A6IHt1cGRhdGVkX3RleHR9IikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCwgY8OzIHRo4buDIMSRw6MgZm9sbG93IHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGZvbGxvdyBzYXUga2hpIG5o4bqlbiwgZ2nhuqMgxJHhu4tuaCDEkcOjIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiVGV4dCBj4bunYSBuw7p0IGtow7RuZyBraOG7m3AgduG7m2kgJ1RoZW8gZMO1aScgaG/hurdjICdGb2xsb3cnOiB7YnV0dG9uX3RleHR9IikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYiBmb2xsb3c6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIDIKICAgIAogICAgZGVmIF9zY3JvbGxfZmVlZF9hZnRlcl9qb2Ioc2VsZik6CiAgICAgICAgIiIiVnXhu5F0IGLhuqNuZyB0aW4gMS01IGzhuqduIHNhdSBraGkgam9iIHRow6BuaCBjw7RuZyIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBSYW5kb20gc+G7kSBs4bqnbiB2deG7kXQgdOG7qyAxLTUKICAgICAgICAgICAgc2Nyb2xsX2NvdW50ID0gcmFuZG9tLnJhbmRpbnQoMSwgNSkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlZ14buRdCBi4bqjbmcgdGluIHtzY3JvbGxfY291bnR9IGzhuqduIHNhdSBraGkgam9iIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShzY3JvbGxfY291bnQpOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgIyBOZ2jhu4kgcmFuZG9tIDItNCBnacOieSBnaeG7r2EgY8OhYyBs4bqnbiB2deG7kXQKICAgICAgICAgICAgICAgIHdhaXRfdGltZSA9IHJhbmRvbS5yYW5kaW50KDIsIDUpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiSG/DoG4gdGjDoG5oIHZ14buRdCBi4bqjbmcgdGluIHNhdSBqb2IiKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHZ14buRdCBi4bqjbmcgdGluIHNhdSBqb2I6IHtzdHIoZSl9IikKICAgIAogICAgZGVmIF9vcGVuX3Byb2ZpbGVfcGFnZShzZWxmLCBwcm9maWxlX2xpbms6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBN4bufIHRyYW5nIHByb2ZpbGUgVGlrVG9rIGLhurFuZyB0w6xtIGtp4bq/bSBob+G6t2MgbGluayB0cuG7sWMgdGnhur9wCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJvZmlsZV9saW5rOiBMaW5rIMSR4bq/biB0cmFuZyBjw6EgbmjDom4KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IHVzZXJuYW1lIHThu6sgVVJMIFRpa1RvawogICAgICAgICAgICB1c2VybmFtZV9tYXRjaCA9IHJlLnNlYXJjaChyJ3Rpa3Rva1wuY29tL0AoW14vP10rKScsIHByb2ZpbGVfbGluaykKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX21hdGNoOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgdHLDrWNoIHh14bqldCB1c2VybmFtZSB04burIGxpbms6IHtwcm9maWxlX2xpbmt9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHVzZXJuYW1lID0gdXNlcm5hbWVfbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmFuZG9tIGNo4buNbiAxIHRyb25nIDIgY8OhY2g6IHTDrG0ga2nhur9tIGhv4bq3YyBt4bufIHRy4buxYyB0aeG6v3AgbGluawogICAgICAgICAgICBpZiByYW5kb20uY2hvaWNlKFtUcnVlLCBGYWxzZV0pOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIk3hu58gdHJhbmcgY8OhIG5ow6JuIGLhurFuZyBjw6FjaCB0w6xtIGtp4bq/bToge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAjIFRo4butIG3hu58gYuG6sW5nIHTDrG0ga2nhur9tCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5fb3Blbl9wcm9maWxlX2J5X3NlYXJjaCh1c2VybmFtZSk6CiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB0w6xtIGtp4bq/bSB0aOG6pXQgYuG6oWksIGZhbGxiYWNrIHNhbmcgbeG7nyBsaW5rCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSBraeG6v20gdGjhuqV0IGLhuqFpLCBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBDw6FjaCAyOiBN4bufIHRy4buxYyB0aeG6v3AgVVJMIHRow7RuZyBxdWEgaGVscGVyLm9wZW5fdXJsKCkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJN4bufIHRyYW5nIGPDoSBuaMOibiBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wOiB7cHJvZmlsZV9saW5rfSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaOG7nSB0aMOqbSBjaG8gdHJhbmcgaOG7kyBzxqEgdOG6o2kgeG9uZwogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyB2w6BvIMSRw7puZyBwcm9maWxlIGtow7RuZyBi4bqxbmcgY8OhY2ggdMOsbSBidXR0b24gY8OzIHRleHQgPSBAdXNlcm5hbWUKICAgICAgICAgICAgIyBUw6xtIGJ1dHRvbiBjw7MgdGV4dCBjaMOtbmggeMOhYyBi4bqxbmcgQHVzZXJuYW1lIChUaWtUb2sgbHXDtG4gY8OzIEAgdHLGsOG7m2MgdXNlcm5hbWUpCiAgICAgICAgICAgIGF0X3VzZXJuYW1lX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iLCB0ZXh0PWYiQHt1c2VybmFtZX0iKQogICAgICAgICAgICBpZiBhdF91c2VybmFtZV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB4w6FjIG5o4bqtbiB2w6BvIMSRw7puZyBwcm9maWxlIGPhu6dhIHt1c2VybmFtZX0gKHTDrG0gdGjhuqV5IGJ1dHRvbiBjw7MgdGV4dDogJ0B7dXNlcm5hbWV9JykiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHTDrG0gdGjhuqV5IGJ1dHRvbiBjw7MgdGV4dCA9ICdAe3VzZXJuYW1lfScgdHLDqm4gbcOgbiBow6xuaCwgY8OzIHRo4buDIGtow7RuZyB2w6BvIMSRw7puZyBwcm9maWxlIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSBt4bufIHRyYW5nIHByb2ZpbGU6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfb3Blbl9wcm9maWxlX2J5X3NlYXJjaChzZWxmLCB1c2VybmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIE3hu58gdHJhbmcgcHJvZmlsZSBUaWtUb2sgYuG6sW5nIGPDoWNoIHTDrG0ga2nhur9tIHVzZXJuYW1lCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdXNlcm5hbWU6IFVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVMOsbSB0YWIgdMOsbSBraeG6v20gLSB0aOG7rSBwaMawxqFuZyBwaMOhcCB0cuG7sWMgdGnhur9wIHRyxrDhu5tjCiAgICAgICAgICAgIHNlYXJjaF90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJUw6xtIGtp4bq/bSIpCiAgICAgICAgICAgIGlmIHNlYXJjaF90YWI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIHRo4bqleSB0YWIgdMOsbSBraeG6v20gdHLhu7FjIHRp4bq/cCIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX3RhYikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXksIGTDuW5nIHBoxrDGoW5nIHBow6FwIGFsdGVybmF0aXZlCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFTDrG0ga2nhur9tIHRy4buxYyB0aeG6v3AsIHRo4butIHBoxrDGoW5nIHBow6FwIGFsdGVybmF0aXZlIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBEdW1wIFhNTCBt4buZdCBs4bqnbiDEkeG7gyB44butIGzDvQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGR1bXAgWE1MIG3DoG4gaMOsbmgiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gY8OhYyB0ZXh0IHRoYXkgdGjhur8gdHJvbmcgWE1MCiAgICAgICAgICAgICAgICBhbHRlcm5hdGl2ZV90ZXh0cyA9IFsiQuG6oW4gYsOoIiwgIsSQYW5nIGZvbGxvdyIsICJEw6BuaCBjaG8gYuG6oW4iXQogICAgICAgICAgICAgICAgZm91bmRfZWxlbWVudCA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIHRleHQgaW4gYWx0ZXJuYXRpdmVfdGV4dHM6CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPXRleHQpCiAgICAgICAgICAgICAgICAgICAgaWYgZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHRleHQgdGhhbSBjaGnhur91ICd7dGV4dH0nIHRyb25nIFhNTCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kX2VsZW1lbnQgPSBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBmb3VuZF9lbGVtZW50OgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGV4dCB0aGFtIGNoaeG6v3UgbsOgbyB0cm9uZyBYTUwiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gZWxlbWVudCBjaGEKICAgICAgICAgICAgICAgIHBhcmVudF9lbGVtZW50ID0gc2VsZi5oZWxwZXIuZmluZF9wYXJlbnRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgZm91bmRfZWxlbWVudCkKICAgICAgICAgICAgICAgIGlmIG5vdCBwYXJlbnRfZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIHTDrG0gdGjhuqV5IGVsZW1lbnQgY2hhIHRyb25nIFhNTCIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGdyYW5kX2VsZW1lbnQgPSBzZWxmLmhlbHBlci5maW5kX3BhcmVudF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBwYXJlbnRfZWxlbWVudCkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ3JhbmRfZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB0w6xtIHRo4bqleSBncmFuZF9lbGVtZW50IHRyb25nIFhNTCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrW5oIHRvw6FuIHThu41hIMSR4buZIHbDoCBjbGljawogICAgICAgICAgICAgICAgYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKGdyYW5kX2VsZW1lbnQpCiAgICAgICAgICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IGJvdW5kcwogICAgICAgICAgICAgICAgeCA9IHgyICsgMzAKICAgICAgICAgICAgICAgIHkgPSAoeTEgKyB5MikgLy8gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOtbmggdG/DoW4gdOG7jWEgxJHhu5kgdGFiIHTDrG0ga2nhur9tOiB4PXt4fSwgeT17eX0gKHThu6sgYm91bmRzIGNoYToge2JvdW5kc30pIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBC4bqlbSB2w6BvIHThu41hIMSR4buZIMSRw6MgdMOtbmgKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcCh4LCB5KQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCgogICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyB2w6BvIMSRxrDhu6NjIHRyYW5nIHTDrG0ga2nhur9tIGtow7RuZwogICAgICAgICAgICBzZWFyY2hfaW5wdXQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuRWRpdFRleHQiKQogICAgICAgICAgICBpZiBub3Qgc2VhcmNoX2lucHV0OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB2w6BvIHRyYW5nIHTDrG0ga2nhur9tIC0ga2jDtG5nIHTDrG0gdGjhuqV5IMO0IG5o4bqtcCIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuq1wIHVzZXJuYW1lIGPhuqduIHTDrG0KICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF9pbnB1dCkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgaMOgbSBpbnB1dF90ZXh0IG3hu5l0IGzhuqduIGR1eSBuaOG6pXQKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQYW5nIG5o4bqtcCB0ZXh0OiAne3VzZXJuYW1lfSciKQogICAgICAgICAgICBzZWxmLmhlbHBlci5pbnB1dF90ZXh0KGYie3VzZXJuYW1lfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNikKCiAgICAgICAgICAgICMgVMOsbSBuw7p0IFTDrG0ga2nhur9tIHbDoCBjbGljawogICAgICAgICAgICBzZWFyY2hfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIsIHRleHQ9IlTDrG0ga2nhur9tIikKICAgICAgICAgICAgaWYgc2VhcmNoX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlTDrG0gdGjhuqV5IG7DunQgJ1TDrG0ga2nhur9tJywgxJFhbmcgY2xpY2suLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF9idXR0b24pCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0ICdUw6xtIGtp4bq/bSciKQogICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIHNlYXJjaCB24bubaSBlbnRlciBrZXkKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2VudGVyKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKSAKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB0YWIgIk5nxrDhu51pIGTDuW5nIiB2w6AgY2xpY2sgdsOgbyBuw7MgLSDEkeG7o2kgdOG7kWkgxJFhIDEwcwogICAgICAgICAgICB1c2VyX3RhYiA9IHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQodGV4dD0iTmfGsOG7nWkgZMO5bmciLCB0aW1lb3V0PTEwKQogICAgICAgICAgICBpZiBub3QgdXNlcl90YWI6CiAgICAgICAgICAgICAgICB1c2VyX3RhYiA9IHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoY29udGVudF9kZXNjPSJOZ8aw4budaSBkw7luZyIsIHRpbWVvdXQ9NikKCiAgICAgICAgICAgIGlmIHVzZXJfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgdGFiIE5nxrDhu51pIGTDuW5nLCDEkWFuZyBjbGljayB2w6BvLi4uIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih1c2VyX3RhYikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiBOZ8aw4budaSBkw7luZyBzYXUgMTBzIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gVGV4dFZpZXcgY8OzIHRleHQgY2jDrW5oIHjDoWMgYuG6sW5nIHVzZXJuYW1lIChraMO0bmcgY8OzIEApIC0gxJHhu6NpIHThu5FpIMSRYSA2cwogICAgICAgICAgICB1c2VybmFtZV9lbGVtZW50ID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudCh0ZXh0PXVzZXJuYW1lLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5UZXh0VmlldyIsIHRpbWVvdXQ9NikKCiAgICAgICAgICAgIGlmIHVzZXJuYW1lX2VsZW1lbnQ6CiAgICAgICAgICAgICAgICAjIENsaWNrIHbDoG8gZWxlbWVudCDEkeG6p3UgdGnDqm4gdMOsbSDEkcaw4bujYwogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9LCDEkWFuZyBjbGljayB2w6BvLi4uIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih1c2VybmFtZV9lbGVtZW50KQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHt1c2VybmFtZX0gdHJvbmcga+G6v3QgcXXhuqMgdMOsbSBraeG6v20gc2F1IDEwcyIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHTDrG0ga2nhur9tIHTDoGkga2hv4bqjbjoge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9wZXJmb3JtX2xpa2Vfam9iKHNlbGYsIHBvc3RfbGluazogc3RyKSAtPiBpbnQ6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IgbGlrZSB2aWRlbyB0csOqbiBUaWtUb2sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwb3N0X2xpbms6IExpbmsgxJHhur9uIHZpZGVvIGPhuqduIGxpa2UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgaW50OiBUcuG6oW5nIHRow6FpIGpvYiAoMDogY2jGsGEgbMOgbSwgMTogaG/DoG4gdGjDoG5oLCAyOiBs4buXaSwgMzogxJHDoyBsaWtlIHRyxrDhu5tjIMSRw7MpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTeG7nyB2aWRlbyBUaWtUb2sgYuG6sW5nIGxpbmsgdHLhu7FjIHRp4bq/cDoge3Bvc3RfbGlua30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIHRy4buxYyB0aeG6v3AgVVJMIHRow7RuZyBxdWEgaGVscGVyLm9wZW5fdXJsKCkKICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocG9zdF9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCgogICAgICAgICAgICAjIFJhbmRvbSBuZ2jhu4kgMy0xMCBnacOieSBuaMawIG5nxrDhu51pIGTDuW5nIHRow7RuZyB0aMaw4budbmcKICAgICAgICAgICAgd2FpdF90aW1lID0gcmFuZG9tLnJhbmRpbnQoMywgMTApCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkGFuZyBuZ2jhu4kge3dhaXRfdGltZX1zIG5oxrAgbmfGsOG7nWkgZMO5bmcgdGjDtG5nIHRoxrDhu51uZy4uLiIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gbsO6dCBsaWtlIGLhurFuZyBjb250ZW50LWRlc2MgIlRow61jaCB2aWRlby4iCiAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5fZmluZF9saWtlX2J1dHRvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgbGlrZV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBsaWtlIHRyw6puIG3DoG4gaMOsbmgiKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdGjDtG5nIHRpbiBuw7p0IGxpa2UgYmFuIMSR4bqndQogICAgICAgICAgICBpbml0aWFsX2NvbnRlbnRfZGVzYyA9IGxpa2VfYnV0dG9uLmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgIGluaXRpYWxfcmVzb3VyY2VfaWQgPSBsaWtlX2J1dHRvbi5nZXQoInJlc291cmNlLWlkIiwgIiIpCiAgICAgICAgICAgIGluaXRpYWxfc2VsZWN0ZWQgPSBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGxpa2VfYnV0dG9uKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlRy4bqhbmcgdGjDoWkgbsO6dCBsaWtlIGJhbiDEkeG6p3U6IHNlbGVjdGVkPXtpbml0aWFsX3NlbGVjdGVkfSwgY29udGVudC1kZXNjPSd7aW5pdGlhbF9jb250ZW50X2Rlc2N9JywgcmVzb3VyY2UtaWQ9J3tpbml0aWFsX3Jlc291cmNlX2lkfSciKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IMSRw6MgbGlrZSB04burIHRyxrDhu5tjCiAgICAgICAgICAgIGlmIGluaXRpYWxfc2VsZWN0ZWQgb3IgIkLhu48gdGjDrWNoIiBpbiBpbml0aWFsX2NvbnRlbnRfZGVzYyBvciAiVW5saWtlIiBpbiBpbml0aWFsX2NvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlZpZGVvIMSRw6MgxJHGsOG7o2MgbGlrZSB04burIHRyxrDhu5tjIikKICAgICAgICAgICAgICAgIHJlc3VsdCA9IDMgICMgxJDDoyBsaWtlIHRyxrDhu5tjIMSRw7MKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBsaWtlIHZpZGVvCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzZWxmLl9hdHRlbXB0X2xpa2VfdmlkZW8obGlrZV9idXR0b24pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFNhdSBraGkgbGlrZSB4b25nLCB2deG7kXQgcmFuZG9tIDItNSB2aWRlbyBy4buTaSB24buBIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIHJlc3VsdCA9PSAxOiAgIyBUaMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIHNlbGYuX3Njcm9sbF92aWRlb3NfYW5kX3JldHVybl9ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gam9iIGxpa2U6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIDIKCiAgICBkZWYgX2ZpbmRfbGlrZV9idXR0b24oc2VsZik6CiAgICAgICAgIiIiVMOsbSBuw7p0IGxpa2UgdHLDqm4gdmlkZW8gVGlrVG9rIiIiCiAgICAgICAgIyBUaOG7rSBjw6FjIGPDoWNoIHTDrG0ga2jDoWMgbmhhdSBjaG8gbsO6dCBsaWtlCiAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJUaMOtY2giKQogICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJMaWtlIikKICAgICAgICBpZiBub3QgbGlrZV9idXR0b246CiAgICAgICAgICAgICMgVMOsbSB0aGVvIHJlc291cmNlLWlkIGhv4bq3YyB4cGF0aAogICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLnNzLmFuZHJvaWQudWdjLnRyaWxsOmlkL2xpa2VfYnV0dG9uIikKICAgICAgICByZXR1cm4gbGlrZV9idXR0b24KCiAgICBkZWYgX2F0dGVtcHRfbGlrZV92aWRlbyhzZWxmLCBsaWtlX2J1dHRvbik6CiAgICAgICAgIiIiVGjhu7FjIGhp4buHbiBsaWtlIHZpZGVvLCDGsHUgdGnDqm4gYuG6pW0gcmFuZG9tIHThu41hIMSR4buZLCBmYWxsYmFjayBzYW5nIGLhuqVtIG7DunQgbGlrZSIiIgogICAgICAgICMgTOG6pXkga8OtY2ggdGjGsOG7m2MgbcOgbiBow6xuaCDEkeG7gyB0w61uaCB04buNYSDEkeG7mSByYW5kb20KICAgICAgICB3aWR0aCwgaGVpZ2h0ID0gc2VsZi5oZWxwZXIuZ2V0X3NjcmVlbl9zaXplKCkKICAgICAgICAKICAgICAgICAjIFRo4butIGLhuqVtIHJhbmRvbSB04buNYSDEkeG7mSB0csaw4bubYyAoZG91YmxlIGNsaWNrKQogICAgICAgIHggPSBpbnQod2lkdGggKiByYW5kb20udW5pZm9ybSgwLjUsIDAuNikpCiAgICAgICAgeSA9IGludChoZWlnaHQgKiByYW5kb20udW5pZm9ybSgwLjUsIDAuNikpCiAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlRo4butIGRvdWJsZSBjbGljayB04bqhaSB04buNYSDEkeG7mSAoe3h9LCB7eX0pIMSR4buDIGxpa2UgdmlkZW8iKQogICAgICAgIAogICAgICAgICMgVGjhu7FjIGhp4buHbiBkb3VibGUgY2xpY2sKICAgICAgICBzZWxmLmhlbHBlci50YXAoeCwgeSkKICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC4xKQogICAgICAgIHNlbGYuaGVscGVyLnRhcCh4LCB5KQogICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKSAgIyBDaOG7nSBhbmltYXRpb24KICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEga+G6v3QgcXXhuqMgc2F1IGRvdWJsZSBjbGljawogICAgICAgIGlmIHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IsSQw6MgdGjDrWNoIHZpZGVvIik6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgbGlrZSB2aWRlbyB0aMOgbmggY8O0bmcgYuG6sW5nIGRvdWJsZSBjbGljayIpCiAgICAgICAgICAgIHJldHVybiAxCgogICAgICAgIAogICAgICAgICMgTuG6v3UgZG91YmxlIGNsaWNrIGtow7RuZyB0aMOgbmggY8O0bmcsIGLhuqVtIHRy4buxYyB0aeG6v3AgdsOgbyBuw7p0IGxpa2UKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJEb3VibGUgY2xpY2sgY2jGsGEgbGlrZSDEkcaw4bujYywgYuG6pW0gdHLhu7FjIHRp4bq/cCB2w6BvIG7DunQgbGlrZSIpCiAgICAgICAgCiAgICAgICAgIyBM4bqleSBs4bqhaSB0aMO0bmcgdGluIG7DunQgbGlrZSBt4bubaSBuaOG6pXQKICAgICAgICBjdXJyZW50X2xpa2VfYnV0dG9uID0gc2VsZi5fZmluZF9saWtlX2J1dHRvbigpCiAgICAgICAgaWYgbm90IGN1cnJlbnRfbGlrZV9idXR0b246CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGxpa2UgxJHhu4MgYuG6pW0gdHLhu7FjIHRp4bq/cCIpCiAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgCiAgICAgICAgIyBC4bqlbSB2w6BvIG7DunQgbGlrZQogICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50KGN1cnJlbnRfbGlrZV9idXR0b24pCiAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IHF14bqjIHNhdSBraGkgYuG6pW0gbsO6dAogICAgICAgIGxpa2VfYnV0dG9uX2ZpbmFsID0gc2VsZi5fZmluZF9saWtlX2J1dHRvbigpCiAgICAgICAgaWYgbGlrZV9idXR0b25fZmluYWw6CiAgICAgICAgICAgIGlzX3NlbGVjdGVkX2ZpbmFsID0gc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChsaWtlX2J1dHRvbl9maW5hbCkKICAgICAgICAgICAgY29udGVudF9kZXNjX2ZpbmFsID0gbGlrZV9idXR0b25fZmluYWwuZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgICAgICAgICAgcmVzb3VyY2VfaWRfZmluYWwgPSBsaWtlX2J1dHRvbl9maW5hbC5nZXQoInJlc291cmNlLWlkIiwgIiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiU2F1IGtoaSBi4bqlbSBuw7p0IGxpa2U6IHNlbGVjdGVkPXtpc19zZWxlY3RlZF9maW5hbH0sIGNvbnRlbnQtZGVzYz0ne2NvbnRlbnRfZGVzY19maW5hbH0nLCByZXNvdXJjZS1pZD0ne3Jlc291cmNlX2lkX2ZpbmFsfSciKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaXNfc2VsZWN0ZWRfZmluYWwgb3IgIkLhu48gdGjDrWNoIiBpbiBjb250ZW50X2Rlc2NfZmluYWwgb3IgIlVubGlrZSIgaW4gY29udGVudF9kZXNjX2ZpbmFsOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBsaWtlIHZpZGVvIHRow6BuaCBjw7RuZyBi4bqxbmcgY2xpY2sgbsO6dCIpCiAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIGxpa2UgdmlkZW8gc2F1IGtoaSB0aOG7rSBj4bqjIDIgY8OhY2giKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIEtow7RuZyB0w6xtIHRo4bqleSBuw7p0IMSR4buDIGtp4buDbSB0cmEsIGdp4bqjIMSR4buLbmggdGjDoG5oIGPDtG5nCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGxpa2UgxJHhu4Mga2nhu4NtIHRyYSwgZ2nhuqMgxJHhu4tuaCB0aMOgbmggY8O0bmciKQogICAgICAgICAgICByZXR1cm4gMQoKICAgIGRlZiBfc2Nyb2xsX3ZpZGVvc19hbmRfcmV0dXJuX2hvbWUoc2VsZik6CiAgICAgICAgIiIiVnXhu5F0IHJhbmRvbSAyLTUgdmlkZW8gcuG7k2kgduG7gSB0cmFuZyBjaOG7pyIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBSYW5kb20gc+G7kSBsxrDhu6NuZyB2aWRlbyBz4bq9IHZ14buRdCAoMi01KQogICAgICAgICAgICBudW1fdmlkZW9zID0gcmFuZG9tLnJhbmRpbnQoMiwgNSkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlPhur0gdnXhu5F0IHF1YSB7bnVtX3ZpZGVvc30gdmlkZW8gdHLGsOG7m2Mga2hpIHbhu4EgdHJhbmcgY2jhu6ciKQogICAgICAgICAgICAKICAgICAgICAgICAgd2lkdGgsIGhlaWdodCA9IHNlbGYuaGVscGVyLmdldF9zY3JlZW5fc2l6ZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShudW1fdmlkZW9zKToKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlZ14buRdCB2aWRlbyB0aOG7qSB7aSsxfS97bnVtX3ZpZGVvc30iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5naOG7iSByYW5kb20gMi00IGdpw6J5IG5oxrAgbmfGsOG7nWkgZMO5bmcgdGjhuq10CiAgICAgICAgICAgICAgICB3YWl0X3RpbWUgPSByYW5kb20ucmFuZGludCgyLCA0KQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhaXRfdGltZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVuG7gSB0cmFuZyBjaOG7pwogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJIb8OgbiB0aMOgbmggdnXhu5F0IHZpZGVvLCDEkWFuZyBxdWF5IHbhu4EgdHJhbmcgY2jhu6ciKQogICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgdnXhu5F0IHZpZGVvOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICMgVuG6q24gY+G7kSBn4bqvbmcgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIAogICAgZGVmIGdldF9qb2JfcGFyYW1zKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aGFtIHPhu5EgxJHhu4MgZ+G7jWkgQVBJIGzhuqV5IGpvYiBjaG8gVGlrVG9rCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IFRoYW0gc+G7kQogICAgICAgICIiIgogICAgICAgIGdvbGlrZV9pZCA9IGFjY291bnQuZ2V0KCJnb2xpa2VfaWQiKQogICAgICAgIGlmIG5vdCBnb2xpa2VfaWQ6CiAgICAgICAgICAgIHJldHVybiB7fQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiYWNjb3VudF9pZCI6IGdvbGlrZV9pZCwKICAgICAgICAgICAgImRhdGEiOiAibnVsbCIKICAgICAgICB9CiAgICAgICAgCiAgICBkZWYgc3luY19hY2NvdW50c190b19kYihzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICDEkOG7k25nIGLhu5kgdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLIHbDoG8gZGF0YWJhc2UKICAgICAgICBHaGkgxJHDqCBwaMawxqFuZyB0aOG7qWMgY+G7p2EgbOG7m3AgY2hhIMSR4buDIMSR4bqjbSBi4bqjbyBjaOG7iSBjw7MgbeG7mXQgdMOgaSBraG/huqNuIMSRxrDhu6NjIMSRw6FuaCBk4bqldSBsw6AgxJFhbmcgbG9naW4KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhurd0IGzhuqFpIHRy4bqhbmcgdGjDoWkgbG9naW4gY2hvIHThuqV0IGPhuqMgdMOgaSBraG/huqNuIFRpa1RvayB0cm9uZyBEQgogICAgICAgICAgICBzZWxmLmRiLnJlc2V0X2xvZ2luX3N0YXR1c19ieV9hcHAoc2VsZi5hcHBfbmFtZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdOG7qyB0aGnhur90IGLhu4sKICAgICAgICAgICAgZGV2aWNlX2FjY291bnRzID0gc2VsZi5nZXRfYWNjb3VudHNfZnJvbV9kZXZpY2UoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBkZXZpY2VfaWQgdOG7qyBkYXRhYmFzZQogICAgICAgICAgICBhbmRyb2lkX2lkID0gc2VsZi5kYi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIGhp4buHbiBjw7MgdHJvbmcgREIgY2hvIGFwcCBuw6B5CiAgICAgICAgICAgIGV4aXN0aW5nX2FjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPXNlbGYuYXBwX25hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHNldCBjw6FjIHVuaXF1ZV91c2VybmFtZSB04burIHRoaeG6v3QgYuG7iyDEkeG7gyBk4buFIHNvIHPDoW5oCiAgICAgICAgICAgIGRldmljZV91c2VybmFtZXMgPSBzZXQoKQogICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBkZXZpY2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGFjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKQogICAgICAgICAgICAgICAgaWYgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX3VzZXJuYW1lcy5hZGQodXNlcm5hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgdMOgaSBraG/huqNuIHRyb25nIERCIG3DoCBraMO0bmcgY8OybiB0csOqbiB0aGnhur90IGLhu4sgLT4gxJHDoW5oIGThuqV1IGxvZ291dAogICAgICAgICAgICBmb3IgZXhpc3RpbmdfYWNjb3VudCBpbiBleGlzdGluZ19hY2NvdW50czoKICAgICAgICAgICAgICAgIGV4aXN0aW5nX3VzZXJuYW1lID0gZXhpc3RpbmdfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgICAgICBpZiBleGlzdGluZ191c2VybmFtZSBhbmQgZXhpc3RpbmdfdXNlcm5hbWUgbm90IGluIGRldmljZV91c2VybmFtZXM6CiAgICAgICAgICAgICAgICAgICAgIyBUw6BpIGtob+G6o24gY8OzIHRyb25nIERCIG5oxrBuZyBraMO0bmcgY8OzIHRyw6puIHRoaeG6v3QgYuG7iyAtPiBsb2dvdXQKICAgICAgICAgICAgICAgICAgICBpZiBleGlzdGluZ19hY2NvdW50LmdldCgic3RhdHVzIikgIT0gImxvZ291dCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge2V4aXN0aW5nX3VzZXJuYW1lfSBraMO0bmcgY8OybiB0csOqbiB0aGnhur90IGLhu4ssIMSRw6FuaCBk4bqldSBsb2dvdXQiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGV4aXN0aW5nX2FjY291bnRbImlkIl0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAibG9nb3V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9yZWFzb24iOiAiVMOgaSBraG/huqNuIGtow7RuZyBjw7JuIHRyw6puIHRoaeG6v3QgYuG7iyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXNfbG9naW4iOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGhv4bq3YyB0aMOqbSBt4bubaSB2w6BvIERCCiAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGRldmljZV9hY2NvdW50czoKICAgICAgICAgICAgICAgICMgVGjDqm0gdGjDtG5nIHRpbiBhcHAgdsOgIGRldmljZV9pZAogICAgICAgICAgICAgICAgYWNjb3VudFsiYXBwIl0gPSBzZWxmLmFwcF9uYW1lCiAgICAgICAgICAgICAgICBhY2NvdW50WyJkZXZpY2VfaWQiXSA9IGFuZHJvaWRfaWQKICAgICAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IGzDoCBjaMawYSDEkeG7k25nIGLhu5kgxJHhu4MgZ+G7rWkgbMOqbiBzZXJ2ZXIKICAgICAgICAgICAgICAgIGFjY291bnRbImlzX3N5bmMiXSA9IEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0w6BpIGtob+G6o24gxJHDoyB04buTbiB04bqhaSBjaMawYSBk4buxYSB2w6BvIHVuaXF1ZV91c2VybmFtZSArIGFwcAogICAgICAgICAgICAgICAgZXhpc3RpbmdfYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnRfYnlfdW5pcXVlX3VzZXJuYW1lKHNlbGYuYXBwX25hbWUsIGFjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgZXhpc3RpbmdfYWNjb3VudDoKICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24gaGnhu4duIGPDsyAtIGNo4buJIMSR4buTbmcgYuG7mSB0cuG6oW5nIHRow6FpIGxvZ2luL2xvZ291dAogICAgICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBleGlzdGluZ19hY2NvdW50WyJpZCJdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBDaHXhuqluIGLhu4sgZOG7ryBsaeG7h3UgY+G6rXAgbmjhuq10IHThu5FpIHRoaeG7g3UKICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImlzX2xvZ2luIjogYWNjb3VudC5nZXQoImlzX2xvZ2luIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBhY2NvdW50LmdldCgibGFzdF91cGRhdGUiLCBpbnQodGltZS50aW1lKCkpKSwKICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbuG6v3UgdMOgaSBraG/huqNuIHRyb25nIERCIMSRYW5nIOG7nyB0cuG6oW5nIHRow6FpIGxvZ291dCBuaMawbmcgeHXhuqV0IGhp4buHbiBs4bqhaSB0csOqbiB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgICAgICBpZiBleGlzdGluZ19hY2NvdW50LmdldCgic3RhdHVzIikgPT0gImxvZ291dCI6CiAgICAgICAgICAgICAgICAgICAgICAgICMgUmVzZXQgdOG7qyBsb2dvdXQgduG7gSBhY3RpdmUgdsOgIHjDs2EgaW5hY3RpdmVfcmVhc29uCiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhWyJzdGF0dXMiXSA9ICJhY3RpdmUiCiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhWyJpbmFjdGl2ZV9yZWFzb24iXSA9ICIiCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gxJHDoyB4deG6pXQgaGnhu4duIGzhuqFpIHRyw6puIHRoaeG6v3QgYuG7iywgcmVzZXQgdOG7qyBsb2dvdXQgduG7gSBhY3RpdmUiKQogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgxJHDoyBhY3RpdmUgdGjDrCBnaeG7ryBuZ3V5w6puIHN0YXR1cywga2jDtG5nIHRoYXkgxJHhu5VpIGfDrCBraMOhYwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudF9pZCwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHEg25nIG5o4bqtcCBjaG8gdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IHRyb25nIHtzZWxmLmFwcF9uYW1lfSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgVGjDqm0gdMOgaSBraG/huqNuIG3hu5tpIHbhu5tpIHRy4bqhbmcgdGjDoWkgYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudFsic3RhdHVzIl0gPSAiYWN0aXZlIgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuYWRkX2FjY291bnQoYWNjb3VudCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0aMOqbSB0w6BpIGtob+G6o24gbeG7m2kge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gY2hvIHtzZWxmLmFwcF9uYW1lfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGRldmljZV9hY2NvdW50cwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIMSR4buTbmcgYuG7mSB0w6BpIGtob+G6o24ge3NlbGYuYXBwX25hbWV9IikKICAgICAgICAgICAgcmV0dXJuIFtdCgogICAgZGVmIG1hcF9nb2xpa2VfYWNjb3VudHMoc2VsZiwgZ29saWtlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSwgZGV2aWNlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgw4FuaCB44bqhIHTDoGkga2hv4bqjbiB04burIEdvTGlrZSB2w6BvIHTDoGkga2hv4bqjbiB0csOqbiB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBnb2xpa2VfYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuIHThu6sgR29MaWtlIEFQSQogICAgICAgICAgICBkZXZpY2VfYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHDoyDDoW5oIHjhuqEKICAgICAgICAiIiIKICAgICAgICBtYXBwZWRfYWNjb3VudHMgPSBbXQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaHXhuqluIGjDs2EgZOG7ryBsaeG7h3UgdOG7qyBHb0xpa2UKICAgICAgICAgICAgZ29saWtlX2RhdGEgPSB7fQogICAgICAgICAgICBmb3IgYWNjIGluIGdvbGlrZV9hY2NvdW50czoKICAgICAgICAgICAgICAgICMgVHLDrWNoIHh14bqldCB0aMO0bmcgdGluIHThu6sgdMOgaSBraG/huqNuIEdvTGlrZQogICAgICAgICAgICAgICAgZ29saWtlX2FjY291bnQgPSB7CiAgICAgICAgICAgICAgICAgICAgImdvbGlrZV9pZCI6IGFjYy5nZXQoImlkIiksCiAgICAgICAgICAgICAgICAgICAgIm5pY2tuYW1lIjogYWNjLmdldCgibmlja25hbWUiKSwKICAgICAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogYWNjLmdldCgidW5pcXVlX2lkIiksCiAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV91c2VybmFtZSI6IGFjYy5nZXQoInVuaXF1ZV91c2VybmFtZSIpLAogICAgICAgICAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiBhY2MuZ2V0KCJhdmF0YXJfdGh1bWIiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIHVuaXF1ZV91c2VybmFtZSBsw6BtIGtow7NhIMSR4buDIGThu4Ugw6FuaCB44bqhCiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGdvbGlrZV9hY2NvdW50WyJ1bmlxdWVfdXNlcm5hbWUiXQogICAgICAgICAgICAgICAgaWYgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgZ29saWtlX2RhdGFbdXNlcm5hbWUubG93ZXIoKV0gPSBnb2xpa2VfYWNjb3VudAogICAgICAgICAgICAKICAgICAgICAgICAgIyDDgW5oIHjhuqEgduG7m2kgdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBmb3IgZGV2aWNlX2FjY291bnQgaW4gZGV2aWNlX2FjY291bnRzOgogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBkZXZpY2VfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lIGluIGdvbGlrZV9kYXRhOgogICAgICAgICAgICAgICAgICAgICMgxJDDoyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gdHJvbmcgZGFuaCBzw6FjaCBHb0xpa2UKICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHThu6sgR29MaWtlIHbDoG8gdMOgaSBraG/huqNuIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgICAgIGdvbGlrZV9pbmZvID0gZ29saWtlX2RhdGFbdXNlcm5hbWVdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAiZ29saWtlX2lkIjogZ29saWtlX2luZm9bImdvbGlrZV9pZCJdLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNfZ29saWtlX2xpbmtlZCI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiBnb2xpa2VfaW5mb1siYXZhdGFyX3RodW1iIl0gb3IgZGV2aWNlX2FjY291bnQuZ2V0KCJhdmF0YXJfdGh1bWIiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJ1bmlxdWVfaWQiOiBnb2xpa2VfaW5mb1sidW5pcXVlX2lkIl0gb3IgZGV2aWNlX2FjY291bnQuZ2V0KCJ1bmlxdWVfaWQiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIElEIHTDoGkga2hv4bqjbiB0cm9uZyBEQgogICAgICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBkZXZpY2VfYWNjb3VudC5nZXQoImlkIikKICAgICAgICAgICAgICAgICAgICBpZiBhY2NvdW50X2lkOgogICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB2w6BvIERCCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudF9pZCwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHbDoG8gZGV2aWNlX2FjY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2FjY291bnQudXBkYXRlKHVwZGF0ZV9kYXRhKQogICAgICAgICAgICAgICAgICAgICAgICBtYXBwZWRfYWNjb3VudHMuYXBwZW5kKGRldmljZV9hY2NvdW50KQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6Mgw6FuaCB44bqhIHTDoGkga2hv4bqjbiBUaWtUb2s6IHt1c2VybmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIG1hcHBlZF9hY2NvdW50cwogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSDDoW5oIHjhuqEgdMOgaSBraG/huqNuIFRpa1RvayIpCiAgICAgICAgICAgIHJldHVybiBbXQogICAgCiAgICBkZWYgX25hdmlnYXRlX3RvX3Byb2ZpbGVfdGFiKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgxJBp4buBdSBoxrDhu5tuZyDEkeG6v24gdGFiIGjhu5Mgc8ahIFRpa1RvawogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHbDoCBi4bqlbSB2w6BvIG7DunQgIkjhu5Mgc8ahIgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgcHJvZmlsZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iSOG7kyBzxqEiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHByb2ZpbGVfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IEjhu5Mgc8ahIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihwcm9maWxlX2J1dHRvbikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgdsOgIHjhu60gbMO9IGRpYWxvZyAiS2jDtG5nIGNobyBwaMOpcCIgbuG6v3UgY8OzCiAgICAgICAgICAgIG5vdF9hbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iS2jDtG5nIGNobyBwaMOpcCIpCiAgICAgICAgICAgIGlmIG5vdF9hbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJQaMOhdCBoaeG7h24gZGlhbG9nICdLaMO0bmcgY2hvIHBow6lwJywgxJFhbmcgY2xpY2sgxJHhu4MgxJHDs25nLi4uIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihub3RfYWxsb3dfYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCgogICAgICAgICAgICAjIEtp4buDbSB0cmEgdsOgIHjhu60gbMO9IGRpYWxvZyAiTMawdSBs4bqhaSDEkcSDbmcgbmjhuq1wIGzhuqduIHNhdSIgbuG6v3UgY8OzCiAgICAgICAgICAgIHNhdmVfbG9naW5fYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IkzGsHUgdGjDtG5nIHRpbiDEkcSDbmcgbmjhuq1wIikKICAgICAgICAgICAgaWYgc2F2ZV9sb2dpbl9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJQaMOhdCBoaeG7h24gZGlhbG9nICdMxrB1IGzhuqFpIMSRxINuZyBuaOG6rXAgbOG6p24gc2F1JywgxJFhbmcgY2xpY2sgxJHhu4MgxJHDs25nLi4uIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzYXZlX2xvZ2luX2J1dHRvbikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQoKCiAgICAgICAgICAgICMgVnXhu5F0IGzDqm4gMSBs4bqnbiDEkeG7gyB04bqjaSDEkeG6p3kgxJHhu6cgbuG7mWkgZHVuZwogICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSDEkWnhu4F1IGjGsOG7m25nIMSR4bq/biB0YWIgaOG7kyBzxqEiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9vcGVuX3Byb2ZpbGVfbWVudShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIE3hu58gbWVudSBo4buTIHPGoSAoZGFuaCBzw6FjaCB0w6BpIGtob+G6o24pCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKCiAgICAgICAgICAgICMgVMOsbSBuw7p0IG1lbnUgaOG7kyBzxqEKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIG1lbnVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9Ik1lbnUgaOG7kyBzxqEiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IG1lbnVfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IE1lbnUgaOG7kyBzxqEiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB04buNYSDEkeG7mSBj4bunYSBuw7p0IG1lbnUgdsOgIGNsaWNrIHbhu5tpIMSR4buZIGzhu4djaCBuZ+G6q3Ugbmhpw6puCiAgICAgICAgICAgIGJvdW5kcyA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X2JvdW5kcyhtZW51X2J1dHRvbikKICAgICAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBib3VuZHMKICAgICAgICAgICAgeSA9ICgoeTIgLSB5MSkgLy8gMikgKyB5MQogICAgICAgICAgICB4ID0geDIgLy8gMgogICAgICAgICAgICB4ICs9IHJhbmRvbS5yYW5kaW50KC0xMCwgMTApCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmhlbHBlci50YXAoeCwgeSkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCgogICAgICAgICAgICAjIGtp4buDbSB0cmEgZGlhbG9nIHRleHQ9IkZvbGxvdyBi4bqhbiBiw6ggY+G7p2EgYuG6oW4iCgogICAgICAgICAgICBmb2xsb3dfZnJpZW5kc19kaWFsb2cgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iRm9sbG93IGLhuqFuIGLDqCBj4bunYSBi4bqhbiIpCiAgICAgICAgICAgIGlmIGZvbGxvd19mcmllbmRzX2RpYWxvZzoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiBkaWFsb2cgJ0ZvbGxvdyBi4bqhbiBiw6ggY+G7p2EgYuG6oW4nLCDEkWFuZyBjbGljayDEkeG7gyDEkcOzbmcuLi4iKQogICAgICAgICAgICAgICAgY2xvc2VfZGlhbG9nID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0ixJDDs25nIikKICAgICAgICAgICAgICAgIGlmIGNsb3NlX2RpYWxvZzoKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoY2xvc2VfZGlhbG9nKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQoKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBt4bufIG1lbnUgaOG7kyBzxqEiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgaXNfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcg4bufIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgVGlrVG9rIGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJFhbmcg4bufIHRyYW5nIGNo4bunLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBwYWNrYWdlIGhp4buHbiB04bqhaSB0csaw4bubYyB0acOqbgogICAgICAgICAgICBjdXJyZW50X3BhY2thZ2UgPSBzZWxmLmhlbHBlci5nZXRfY3VycmVudF9wYWNrYWdlKCkKICAgICAgICAgICAgaWYgY3VycmVudF9wYWNrYWdlICE9IHNlbGYuYXBwX3BhY2thZ2U6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw7MgbsO6dCAiVHJhbmcgY2jhu6ciIMSRxrDhu6NjIGNo4buNbiAoc2VsZWN0ZWQ9dHJ1ZSkgdHJvbmcgdGhhbmggdGFiIGtow7RuZwogICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIikKICAgICAgICAgICAgaWYgaG9tZV90YWI6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGhvbWVfdGFiKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIE7hur91IHTDrG0gdGjhuqV5IHRhYiAiVHJhbmcgY2jhu6ciIG5oxrBuZyBjaMawYSDEkcaw4bujYyBjaOG7jW4sIGNsaWNrIHbDoG8gxJHDswogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihob21lX3RhYikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2jDtG5nIHTDrG0gdGjhuqV5IGPDoWMgeeG6v3UgdOG7kSBj4bunYSB0cmFuZyBjaOG7pwogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraeG7g20gdHJhIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgVGlrVG9rIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBlbnN1cmVfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28gxJFhbmcg4bufIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgVGlrVG9rCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHBhY2thZ2UgaGnhu4duIHThuqFpIHRyxrDhu5tjIHRpw6puCiAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICBpZiBjdXJyZW50X3BhY2thZ2UgIT0gc2VsZi5hcHBfcGFja2FnZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJBcHAgaGnhu4duIHThuqFpICh7Y3VycmVudF9wYWNrYWdlfSkga2jDtG5nIHBo4bqjaSBUaWtUb2ssIG3hu58gYXBwIFRpa1Rvay4uLiIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcChzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEwKSAgIyBUxINuZyBsw6puIDEwIGdpw6J5IMSR4buDIGFwcCBraOG7n2kgxJHhu5luZyBob8OgbiB0b8OgbgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgcG9wdXAgUElOIHRyb25nIDVzIHNhdSBraGkgbeG7nyBhcHAKICAgICAgICAgICAgICAgIHNlbGYuX2NoZWNrX3Bpbl9wb3B1cCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVmFsaWRhdGUgYXBwIGtow7RuZyBi4buLIGJhbm5lZCBzYXUga2hpIG3hu58KICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnZhbGlkYXRlX2FwcF9ub3RfYmFubmVkKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIkFwcCBUaWtUb2sgY8OzIHbhuqVuIMSR4buBIChiYW5uZWQvY+G6o25oIGLDoW8pIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyDhu58gdHJhbmcgY2jhu6cgY2jGsGEKICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyDhu58gdHJhbmcgY2jhu6cgVGlrVG9rIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBjaMawYSwgY+G7kSBn4bqvbmcgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICAgICByZXR1cm4gc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMSR4bqjbSBi4bqjbyB24buBIHRyYW5nIGNo4bunIFRpa1RvayIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdmFsaWRhdGVfYXBwX25vdF9iYW5uZWQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgxJDhuqNtIGLhuqNvIGtow7RuZyBjw7MgdMOgaSBraG/huqNuIG7DoG8gYuG7iyBiYW5uZWQKICAgICAgICAiIiIKICAgICAgICAjIEtp4buDbSB0cmEgZGlhbG9nIGPhuqNuaCBiw6FvIGNodW5nCiAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgIyBLaeG7g20gdHJhIGRpYWxvZyAiQ+G6rXAgbmjhuq10IENow61uaCBzw6FjaCBxdXnhu4FuIHJpw6puZyB0xrAiCiAgICAgICAgcHJpdmFjeV91cGRhdGVfZWxlbWVudHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgIHRleHQ9IkPhuq1wIG5o4bqtdCBDaMOtbmggc8OhY2ggcXV54buBbiByacOqbmcgdMawIgogICAgICAgICkKCiAgICAgICAgaWYgcHJpdmFjeV91cGRhdGVfZWxlbWVudHM6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiBkaWFsb2cgJ0Phuq1wIG5o4bqtdCBDaMOtbmggc8OhY2ggcXV54buBbiByacOqbmcgdMawJywgxJFhbmcgeOG7rSBsw70uLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIG7DunQgIsSQw6MgaGnhu4N1IiB2w6AgYuG6pW0gdHLhu7FjIHRp4bq/cAogICAgICAgICAgICB1bmRlcnN0YW5kX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSLEkMOjIGhp4buDdSIpCiAgICAgICAgICAgIGlmIHVuZGVyc3RhbmRfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHVuZGVyc3RhbmRfYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSB24bubaSBjw6FjIHRleHQga2jDoWMKICAgICAgICAgICAgICAgIGZvciB0ZXh0IGluIFsiVGnhur9wIHThu6VjIiwgIsSQ4buTbmcgw70iLCAiQ29udGludWUiLCAiQWdyZWUiLCAiQ2jhuqVwIG5o4bqtbiIsICJBY2NlcHQiXToKICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD10ZXh0KQogICAgICAgICAgICAgICAgICAgIGlmIGJ1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICMgS2nhu4NtIHRyYSBkaWFsb2cgIlRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuIgogICAgICAgIGFjY291bnRfc3RhdHVzX2VsZW1lbnRzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICB0ZXh0PSJUcuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbiIKICAgICAgICApCgogICAgICAgIGlmIGFjY291bnRfc3RhdHVzX2VsZW1lbnRzOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJQaMOhdCBoaeG7h24gZGlhbG9nIMSRxINuZyB4deG6pXQgdMOgaSBraG/huqNuLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBuw7p0IGPDsyBpZCBsw6AgYnV0dG9uMSB2w6AgYuG6pW0KICAgICAgICAgICAgYnV0dG9uMSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0iYW5kcm9pZDppZC9idXR0b24xIikKICAgICAgICAgICAgaWYgYnV0dG9uMToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihidXR0b24xKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEwKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCgogICAgICAgICMgVMOsbSBkaWFsb2cgY+G6o25oIGLDoW8gYuG6sW5nIElEIGhv4bq3YyBjb250ZW50LWRlc2MgY8OzIGNo4bupYSAiY+G6o25oIGLDoW8iLCAibOG7l2kiLCAidGjDtG5nIGLDoW8iCiAgICAgICAgYWxlcnRfZGlhbG9ncyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC5hcHAuRGlhbG9nIgogICAgICAgICkKICAgICAgICAKICAgICAgICBmb3IgZGlhbG9nIGluIGFsZXJ0X2RpYWxvZ3M6CiAgICAgICAgICAgICMgVMOsbSB0ZXh0IHRyb25nIGRpYWxvZwogICAgICAgICAgICB0ZXh0X3ZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LlRleHRWaWV3IgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgdGV4dF92aWV3IGluIHRleHRfdmlld3M6CiAgICAgICAgICAgICAgICB0ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh0ZXh0X3ZpZXcpCiAgICAgICAgICAgICAgICBpZiB0ZXh0IGFuZCBhbnkoa2V5d29yZCBpbiB0ZXh0Lmxvd2VyKCkgZm9yIGtleXdvcmQgaW4gWyJj4bqjbmggYsOhbyIsICJs4buXaSIsICJ0aMO0bmcgYsOhbyIsICJi4buLIGtow7NhIiwgInZpIHBo4bqhbSJdKToKICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggY+G6o25oIGLDoW8gaGnhu4duIHThuqFpIHThu6sgZGIKICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dhcm5pbmdzID0gc2VsZi5kYi5nZXQoImxvZ3Mtd2FybmluZy1tZXNzYWdlIiwgW10pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUaMOqbSBj4bqjbmggYsOhbyBt4bubaQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfd2FybmluZ3MuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgInRpbWUiOiBkYXRldGltZS5kYXRldGltZS5ub3coKS5pc29mb3JtYXQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgIm1lc3MiOiB0ZXh0CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENo4buJIGdp4buvIGzhuqFpIHThu5FpIMSRYSAyMCBsb2cgZ+G6p24gbmjhuqV0CiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGN1cnJlbnRfd2FybmluZ3MpID4gMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfd2FybmluZ3MgPSBjdXJyZW50X3dhcm5pbmdzWy0yMDpdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBMxrB1IGzhuqFpIHbDoG8gZGIKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgibG9ncy13YXJuaW5nLW1lc3NhZ2UiLCBjdXJyZW50X3dhcm5pbmdzKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLEkMOjIGzGsHUgY+G6o25oIGLDoW8gVGlrVG9rOiB7dGV4dH0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSBuw7p0IE9LIGhv4bq3YyDEkMOzbmcgxJHhu4MgxJHDs25nIGRpYWxvZwogICAgICAgICAgICAgICAgICAgIGJ1dHRvbnMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yIGJ1dHRvbiBpbiBidXR0b25zOgogICAgICAgICAgICAgICAgICAgICAgICBidXR0b25fdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBidXR0b25fdGV4dCBhbmQgYnV0dG9uX3RleHQubG93ZXIoKSBpbiBbIm9rIiwgIsSRw7NuZyIsICJ0w7RpIGhp4buDdSIsICLEkeG7k25nIMO9Il06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZSAgIyBDw7MgY+G6o25oIGLDoW8gdGjDrCByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gVHJ1ZSAgIyBLaMO0bmcgY8OzIGPhuqNuaCBiw6FvCiAgICAgICAgCiAgICBkZWYgYmFja190b19ob21lKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUXVheSB24buBIHRyYW5nIGNo4bunIFRpa1RvayB04burIGLhuqV0IGvhu7MgbcOgbiBow6xuaCBuw6BvCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICIiIgogICAgICAgIG1heF9hdHRlbXB0cyA9IDUKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJRdWF5IHbhu4EgdHJhbmcgY2jhu6cgVGlrVG9rIikKICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfYXR0ZW1wdHMpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6Mg4bufIHRyYW5nIGNo4bunIGNoxrBhCiAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyDhu58gdHJhbmcgY2jhu6cgVGlrVG9rIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgcGFja2FnZSBoaeG7h24gdOG6oWkgdHLGsOG7m2Mga2hpIHRo4buxYyBoaeG7h24gdGhhbyB0w6FjCiAgICAgICAgICAgICAgICBjdXJyZW50X3BhY2thZ2UgPSBzZWxmLmhlbHBlci5nZXRfY3VycmVudF9wYWNrYWdlKCkKICAgICAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJBcHAgaGnhu4duIHThuqFpICh7Y3VycmVudF9wYWNrYWdlfSkga2jDtG5nIHBo4bqjaSBUaWtUb2ssIG3hu58gbOG6oWkgYXBwIFRpa1Rvay4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMTApICAjIFTEg25nIGzDqm4gMTAgZ2nDonkgxJHhu4MgYXBwIGto4bufaSDEkeG7mW5nIGhvw6BuIHRvw6BuCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHNhdSBraGkgbeG7nyBhcHAKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIG7DunQgIlRyYW5nIGNo4bunIiDhu58gYm90dG9tIG5hdmlnYXRpbwogICAgICAgICAgICAgICAgaG9tZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iVHJhbmcgY2jhu6ciKQogICAgICAgICAgICAgICAgaWYgbm90IGhvbWVfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIGhvbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciKQogICAgICAgICAgICAgICAgaWYgbm90IGhvbWVfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIGhvbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IkhvbWUiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgaG9tZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBob21lLCB0aOG7rSBuaOG6pW4gYmFjawogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIGPhu5EgZ+G6r25nIHbhu4EgdHJhbmcgY2jhu6cgKGzhuqduIHthdHRlbXB0ICsgMX0pOiB7ZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cgVGlrVG9rIHNhdSBuaGnhu4F1IGzhuqduIHRo4butIikKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHN3aXRjaF9hY2NvdW50KHNlbGYsIHRhcmdldF9hY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2h1eeG7g24gc2FuZyB0w6BpIGtob+G6o24gVGlrVG9rIGtow6FjCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFyZ2V0X2FjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiB7CiAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IGJvb2wsCiAgICAgICAgICAgICAgICAncmVhc29uJzogc3RyIChu4bq/dSB0aOG6pXQgYuG6oWkpLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBzdHIKICAgICAgICAgICAgfQogICAgICAgICIiIgogICAgICAgIHRhcmdldF91c2VybmFtZSA9IHRhcmdldF9hY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIiwgIiIpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgY2h1eeG7g24gc2FuZyB0w6BpIGtob+G6o24gVGlrVG9rOiB7dGFyZ2V0X3VzZXJuYW1lfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAnbmF2aWdhdGlvbl9lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnS2jDtG5nIHRo4buDIMSR4bq/biB0cmFuZyBjaOG7pyBUaWtUb2snCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFbDoG8gdHJhbmcgaOG7kyBzxqEKICAgICAgICAgICAgaWYgbm90IHNlbGYuX25hdmlnYXRlX3RvX3Byb2ZpbGVfdGFiKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAnbmF2aWdhdGlvbl9lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnS2jDtG5nIHRo4buDIHbDoG8gdHJhbmcgaOG7kyBzxqEgVGlrVG9rJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVnXhu5F0IGzDqm4gMSBs4bqnbgogICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE3hu58gbWVudSBo4buTIHPGoQogICAgICAgICAgICBpZiBub3Qgc2VsZi5fb3Blbl9wcm9maWxlX21lbnUoKToKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICd1aV9lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnS2jDtG5nIHRo4buDIG3hu58gbWVudSBo4buTIHPGoSBUaWtUb2snCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICBhZGRfYWNjb3VudF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVGjDqm0gdMOgaSBraG/huqNuIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBhZGRfYWNjb3VudF9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG1lbnUgdMOgaSBraG/huqNuIikKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICd1aV9lcnJvcicsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnS2jDtG5nIHTDrG0gdGjhuqV5IG1lbnUgdMOgaSBraG/huqNuIFRpa1RvaycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gdMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuCiAgICAgICAgICAgIGFjY291bnRfYnV0dG9ucyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIHRhcmdldF9pdGVtID0gTm9uZQogICAgICAgICAgICBmb3IgYnV0dG9uIGluIGFjY291bnRfYnV0dG9uczoKICAgICAgICAgICAgICAgIGlmIGJ1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIpID09ICJUaMOqbSB0w6BpIGtob+G6o24iIG9yIGJ1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIpID09ICLEkMOzbmciOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGJ1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgIHRleHR2aWV3cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuVGV4dFZpZXciCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGJ1dHRvbl9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIGZvciB0diBpbiB0ZXh0dmlld3M6CiAgICAgICAgICAgICAgICAgICAgICAgIHR2X2JvdW5kcyA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X2JvdW5kcyh0dikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR2X2JvdW5kc1swXSA+PSBidXR0b25fYm91bmRzWzBdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHZfYm91bmRzWzFdID49IGJ1dHRvbl9ib3VuZHNbMV0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dl9ib3VuZHNbMl0gPD0gYnV0dG9uX2JvdW5kc1syXSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR2X2JvdW5kc1szXSA8PSBidXR0b25fYm91bmRzWzNdKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHR2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGV4dCBhbmQgdGV4dCAhPSAibnVsbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgPSB0ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUgPT0gdGFyZ2V0X3VzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgIHRhcmdldF9pdGVtID0gYnV0dG9uCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHRhcmdldF9pdGVtOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IHRyb25nIGRhbmggc8OhY2giKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMSQw6FuaCBk4bqldSB0w6BpIGtob+G6o24gbMOgIGLhu4sgdsO0IGhp4buHdSBow7NhIHRyb25nIERCCiAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KHRhcmdldF9hY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJkaXNhYmxlZCIsCiAgICAgICAgICAgICAgICAgICAgImRpc2FibGVfcmVhc29uIjogIlTDoGkga2hv4bqjbiBraMO0bmcgY8OzIHRyw6puIHRoaeG6v3QgYuG7iyIsCiAgICAgICAgICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogaW50KHRpbWUudGltZSgpKSwKICAgICAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5o4bqlbiBCYWNrIMSR4buDIMSRw7NuZyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBRdWF5IHbhu4EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ2FjY291bnRfbm90X2ZvdW5kJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IGYnS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSB0cm9uZyBkYW5oIHPDoWNoIFRpa1RvaycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE5o4bqlcCB2w6BvIHTDoGkga2hv4bqjbiBt4bulYyB0acOqdQogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIodGFyZ2V0X2l0ZW0pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgc2FmZV9zbGVlcCByZXR1cm4gdmFsdWUgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbQogICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDYpOiAgIyDEkOG7o2kgY2h1eeG7g24gdMOgaSBraG/huqNuIGhvw6BuIHThuqV0CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJOaOG6rW4gxJHGsOG7o2MgecOqdSBj4bqndSBk4burbmcgdHJvbmcgc3dpdGNoX3RvX2FjY291bnQiKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ2ludGVycnVwdGVkJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICdC4buLIGThu6tuZyB0cm9uZyBxdcOhIHRyw6xuaCBjaHV54buDbiB0w6BpIGtob+G6o24gVGlrVG9rJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIGNodXnhu4NuIHTDoGkga2hv4bqjbiB0aMOgbmggY8O0bmcgY2jGsGEKICAgICAgICAgICAgY3VycmVudF91c2VybmFtZSA9IHNlbGYuZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGN1cnJlbnRfdXNlcm5hbWUgPT0gdGFyZ2V0X3VzZXJuYW1lOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgY2h1eeG7g24gdMOgaSBraG/huqNuIHRow6BuaCBjw7RuZyBzYW5nIHt0YXJnZXRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLCAKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IGYnxJDDoyBjaHV54buDbiB0w6BpIGtob+G6o24gdGjDoG5oIGPDtG5nIHNhbmcge3RhcmdldF91c2VybmFtZX0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIsSQw6MgYuG6pW0gdsOgbyB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gbmjGsG5nIGtp4buDbSB0cmEgbOG6oWkgdGjhuqV5IMSRYW5nIMSRxINuZyBuaOG6rXAgbMOgIHtjdXJyZW50X3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAnc3dpdGNoX3ZlcmlmaWNhdGlvbl9mYWlsZWQnLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZifEkMOjIGLhuqVtIHbDoG8gdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IG5oxrBuZyBraeG7g20gdHJhIGzhuqFpIHRo4bqleSDEkWFuZyDEkcSDbmcgbmjhuq1wIGzDoCB7Y3VycmVudF91c2VybmFtZX0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGNodXnhu4NuIHTDoGkga2hv4bqjbiBUaWtUb2siKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gcXVheSB24buBIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICdyZWFzb24nOiAnZXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZidM4buXaSBraGkgY2h1eeG7g24gdMOgaSBraG/huqNuIFRpa1Rvazoge3N0cihlKX0nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICBkZWYgX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2goc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGPDoWMgdGhhbyB0w6FjIFVJIMSR4buDIGNodXnhu4NuIHTDoGkga2hv4bqjbiBUaWtUb2sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXJnZXRfYWNjb3VudDogVMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuIMSR4bq/bgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogewogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBib29sLAogICAgICAgICAgICAgICAgJ3JlYXNvbic6IHN0ciAobuG6v3UgdGjhuqV0IGLhuqFpKSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJzogc3RyCiAgICAgICAgICAgIH0KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN3aXRjaF9yZXN1bHQgPSBzZWxmLnN3aXRjaF9hY2NvdW50KHRhcmdldF9hY2NvdW50KQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHN3aXRjaF9yZXN1bHQsIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0dXJuIHN3aXRjaF9yZXN1bHQKICAgICAgICAgICAgZWxpZiBzd2l0Y2hfcmVzdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIHsnc3VjY2Vzcyc6IFRydWUsICdtZXNzYWdlJzogJ0NodXnhu4NuIHTDoGkga2hv4bqjbiBUaWtUb2sgdGjDoG5oIGPDtG5nJ30KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdzd2l0Y2hfZmFpbGVkJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICdLaMO0bmcgdGjhu4MgY2h1eeG7g24gdMOgaSBraG/huqNuIFRpa1RvaycKICAgICAgICAgICAgICAgIH0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gY2h1eeG7g24gdMOgaSBraG/huqNuIFRpa1RvayIpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICdyZWFzb24nOiAnZXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZidM4buXaSBraGkgdGjhu7FjIGhp4buHbiBjaHV54buDbiB0w6BpIGtob+G6o24gVGlrVG9rOiB7c3RyKGUpfScKICAgICAgICAgICAgfQogICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKHNlbGYpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdXNlcm5hbWUgY+G7p2EgdMOgaSBraG/huqNuIFRpa1RvayDEkWFuZyDEkcSDbmcgbmjhuq1wCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyIGhv4bq3YyBOb25lOiBVc2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcCwgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIGPDswogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgICAgICMgVsOgbyB0cmFuZyBo4buTIHPGoSDEkeG7gyBs4bqleSB1c2VybmFtZQogICAgICAgICAgICBpZiBub3Qgc2VsZi5fbmF2aWdhdGVfdG9fcHJvZmlsZV90YWIoKToKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFZ14buRdCB4deG7kW5nIHbDoCBjaOG7nSAyIGdpw6J5CiAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX2Rvd24oKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKCiAgICAgICAgICAgICMgVMOsbSB1c2VybmFtZSB0cm9uZyB0cmFuZyBo4buTIHPGoQogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB0cm9uZyBjw6FjIFRleHRWaWV3IGPDsyB0aOG7gyBjaOG7qWEgdXNlcm5hbWUKICAgICAgICAgICAgdGV4dF92aWV3cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIHVzZXJuYW1lID0gTm9uZQogICAgICAgICAgICBmb3IgdGV4dF92aWV3IGluIHRleHRfdmlld3M6CiAgICAgICAgICAgICAgICB0ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh0ZXh0X3ZpZXcpCiAgICAgICAgICAgICAgICBpZiB0ZXh0IGFuZCB0ZXh0LnN0YXJ0c3dpdGgoIkAiKSBhbmQgbGVuKHRleHQpID4gMToKICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHRleHRbMTpdICAjIELhu48ga8O9IHThu7EgQAogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgUXVheSBs4bqhaSB0cmFuZyBjaOG7pwogICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB1c2VybmFtZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGzhuqV5IHVzZXJuYW1lIHThu6sgdHJhbmcgaOG7kyBzxqE6IHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJuYW1lCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgbOG6pXkgdXNlcm5hbWUgdOG7qyB0cmFuZyBo4buTIHPGoSIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBs4bqleSB1c2VybmFtZSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcCIpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICAjID09PT09PT09PT09PT09PT09PT09PT09PT0gU01BUlQgQ0FSRSBNRVRIT0RTICjEkOG7k25nIG5o4bqldCB24bubaSBJbnN0YWdyYW0pID09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIAogICAgZGVmIF9jYXJlX3N3aXBlX2ZlZWQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiTMaw4bubdCBmZWVkIFRpa1RvayBuaOG6uSBuaMOgbmcgLSB0xrDGoW5nIMSRxrDGoW5nIEluc3RhZ3JhbSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiQuG6r3QgxJHhuqd1IGzGsOG7m3QgZmVlZCBUaWtUb2suLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMaw4bubdCA1LTEwIHZpZGVvIG5n4bqrdSBuaGnDqm4KICAgICAgICAgICAgbnVtX3N3aXBlcyA9IHJhbmRvbS5yYW5kaW50KDUsIDEwKQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShudW1fc3dpcGVzKToKICAgICAgICAgICAgICAgICMgVGjhu51pIGdpYW4geGVtIG5n4bqrdSBuaGnDqm4gMi01IGdpw6J5CiAgICAgICAgICAgICAgICB3YXRjaF90aW1lID0gcmFuZG9tLnVuaWZvcm0oMiwgNSkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYiTMaw4bubdCB2aWRlbyB7aSsxfS97bnVtX3N3aXBlc30sIHhlbSB7d2F0Y2hfdGltZTouMWZ9cyIpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2F0Y2hfdGltZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDw7MgMTAlIGto4bqjIG7Eg25nIGxpa2UgdmlkZW8ga2hpIHhlbSA+PSAzIGdpw6J5IChnaeG6o20gdOG7qyAxNSUpCiAgICAgICAgICAgICAgICBpZiB3YXRjaF90aW1lID49IDMgYW5kIHJhbmRvbS5yYW5kb20oKSA8IDAuMTA6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuX2ZpbmRfbGlrZV9idXR0b24oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsaWtlX2J1dHRvbiBhbmQgbm90IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b24pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSBkb3VibGUgdGFwIMSR4buDIGxpa2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoLCBoZWlnaHQgPSBzZWxmLmhlbHBlci5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeCA9IGludCh3aWR0aCAqIHJhbmRvbS51bmlmb3JtKDAuNSwgMC42KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBpbnQoaGVpZ2h0ICogcmFuZG9tLnVuaWZvcm0oMC41LCAwLjYpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwKHgsIHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwKHgsIHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiLEkMOjIGxpa2UgdmlkZW8ge2krMX0gdHJvbmcgY2FyZSBmZWVkIikKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MgICMgQuG7jyBxdWEgbOG7l2kgbGlrZSwgdGnhur9wIHThu6VjIHhlbQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBmb3JjZSBzdG9wCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDAuMSk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBsxrDhu5t0IHtudW1fc3dpcGVzfSB2aWRlbyBUaWtUb2siKQogICAgICAgICAgICAjIFbhu4EgdHJhbmcgY2jhu6cgc2F1IGtoaSBjYXJlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgbMaw4bubdCBmZWVkIFRpa1Rvazoge2V9IikKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2NhcmVfd2F0Y2hfdmlkZW9zKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIlhlbSB2aWRlbyBUaWtUb2sgdHJvbmcgdGjhu51pIGdpYW4gZMOgaSAtIHTGsMahbmcgxJHGsMahbmcgd2F0Y2hfcmVlbHMgSW5zdGFncmFtIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4bqvdCDEkeG6p3UgeGVtIHZpZGVvIFRpa1Rvay4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIHRvdGFsX3dhdGNoX3RpbWUgPSByYW5kb20ucmFuZGludCgxMjAsIDE4MCkgICMgMi0zIHBow7p0CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJT4bq9IHhlbSB2aWRlbyBUaWtUb2sgdHJvbmcge3RvdGFsX3dhdGNoX3RpbWV9IGdpw6J5IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHZpZGVvX2NvdW50ID0gMAogICAgICAgICAgICB3aGlsZSAodGltZS50aW1lKCkgLSBzdGFydF90aW1lKSA8IHRvdGFsX3dhdGNoX3RpbWU6CiAgICAgICAgICAgICAgICB2aWRlb19jb3VudCArPSAxCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgWGVtIHZpZGVvIGhp4buHbiB04bqhaQogICAgICAgICAgICAgICAgd2F0Y2hfZHVyYXRpb24gPSByYW5kb20ucmFuZGludCgzLCAxMikgICMgMy0xMiBnacOieSBt4buXaSB2aWRlbwogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJYZW0gdmlkZW8ge3ZpZGVvX2NvdW50fSB0cm9uZyB7d2F0Y2hfZHVyYXRpb259cyIpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2F0Y2hfZHVyYXRpb24pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ8OzIDI1JSBraOG6oyBuxINuZyBsaWtlIHZpZGVvIGtoaSB4ZW0gPj0gNSBnacOieSAoZ2nhuqNtIHThu6sgMjAlKQogICAgICAgICAgICAgICAgaWYgd2F0Y2hfZHVyYXRpb24gPj0gNSBhbmQgcmFuZG9tLnJhbmRvbSgpIDwgMC4yNToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5fZmluZF9saWtlX2J1dHRvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxpa2VfYnV0dG9uIGFuZCBub3Qgc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChsaWtlX2J1dHRvbik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRo4butIGRvdWJsZSB0YXAgxJHhu4MgbGlrZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGgsIGhlaWdodCA9IHNlbGYuaGVscGVyLmdldF9zY3JlZW5fc2l6ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gaW50KHdpZHRoICogcmFuZG9tLnVuaWZvcm0oMC41LCAwLjYpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGludChoZWlnaHQgKiByYW5kb20udW5pZm9ybSgwLjUsIDAuNikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXAoeCwgeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXAoeCwgeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIsSQw6MgbGlrZSB2aWRlbyB7dmlkZW9fY291bnR9IHRyb25nIGNhcmUgd2F0Y2giKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcyAgIyBC4buPIHF1YSBs4buXaSBsaWtlLCB0aeG6v3AgdOG7pWMgeGVtCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVnXhu5F0IHNhbmcgdmlkZW8gdGnhur9wIHRoZW8KICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBmb3JjZSBzdG9wCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDAuMSk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB4ZW0ge3ZpZGVvX2NvdW50fSB2aWRlbyBUaWtUb2sgdHJvbmcge2ludCh0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUpfXMiKQogICAgICAgICAgICAjIFbhu4EgdHJhbmcgY2jhu6cgc2F1IGtoaSBjYXJlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgeGVtIHZpZGVvIFRpa1Rvazoge2V9IikKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2NhcmVfdmlld19ub3RpZmljYXRpb25zKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIlhlbSB0aMO0bmcgYsOhbyBUaWtUb2sgLSB0xrDGoW5nIMSRxrDGoW5nIEluc3RhZ3JhbSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiQuG6r3QgxJHhuqd1IHhlbSB0aMO0bmcgYsOhbyBUaWtUb2suLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB2w6AgYuG6pW0gdsOgbyBI4buZcCB0aMawIChpbmJveCkKICAgICAgICAgICAgaW5ib3hfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudCgKICAgICAgICAgICAgICAgIHRpbWVvdXQ9NSwKICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYz0iSOG7mXAgdGjGsCIKICAgICAgICAgICAgKSBvciBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KAogICAgICAgICAgICAgICAgdGltZW91dD01LAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbDppZC9jdTkiICAjIFRpa1RvayBpbmJveCBidXR0b24KICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGluYm94X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IEjhu5lwIHRoxrAgVGlrVG9rIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGluYm94X2J1dHRvbikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFhlbSB0aMO0bmcgYsOhbyB0cm9uZyAxMC0yMCBnacOieQogICAgICAgICAgICB2aWV3X3RpbWUgPSByYW5kb20ucmFuZGludCgxMCwgMjApCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYiWGVtIHRow7RuZyBiw6FvIHRyb25nIHt2aWV3X3RpbWV9cyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFZ14buRdCBsw6puIHh14buRbmcgxJHhu4MgeGVtIHRow7RuZyBiw6FvCiAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKHJhbmRvbS5yYW5kaW50KDIsIDQpKToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgxLCAzKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh2aWV3X3RpbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFF1YXkgbOG6oWkgdHJhbmcgY2jhu6cKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyB4ZW0gdGjDtG5nIGLDoW8gVGlrVG9rIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHhlbSB0aMO0bmcgYsOhbyBUaWtUb2s6IHtlfSIpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgIyA9PT09PT09PT09PT09PT09PT09PT09PT09IEVORCBTTUFSVCBDQVJFIE1FVEhPRFMgPT09PT09PT09PT09PT09PT09PT09PT09PQogICAgCiAgICBkZWYgX2NoZWNrX3Bpbl9wb3B1cChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHBvcHVwIFBJTiB2w6Agbmjhuq1wIG3DoyBQSU4gbuG6v3UgY8OzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygiS2nhu4NtIHRyYSBwb3B1cCBQSU4gVGlrVG9rIHRyb25nIDUgZ2nDonkuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBT4butIGThu6VuZyB3YWl0X2Zvcl9lbGVtZW50IMSR4buDIGtp4buDbSB0cmEgcG9wdXAgdHJvbmcgNSBnacOieQogICAgICAgICAgICBwaW5fcG9wdXAgPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KAogICAgICAgICAgICAgICAgY29udGVudF9kZXNjPSJC4bqhbiDEkcOjIHPhurVuIHPDoG5nIMSRw7NuZyBUaWtUb2s/IiwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9NQogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwaW5fcG9wdXA6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJQaMOhdCBoaeG7h24gcG9wdXAgUElOIFRpa1RvaywgxJFhbmcgbmjhuq1wIG3Doy4uLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgYuG6pW0gdsOgbyBz4buRICIxIiAKICAgICAgICAgICAgICAgIGRpZ2l0XzEgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iMSIpCiAgICAgICAgICAgICAgICBpZiBkaWdpdF8xOgogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihkaWdpdF8xKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBOaOG6rXAgbcOjIFBJTiAxMjM0CiAgICAgICAgICAgICAgICAgICAgZm9yIGRpZ2l0IGluIFsiMiIsICIzIiwgIjQiXToKICAgICAgICAgICAgICAgICAgICAgICAgZGlnaXRfZWxlbWVudCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PWRpZ2l0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkaWdpdF9lbGVtZW50OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGRpZ2l0X2VsZW1lbnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSBz4buRIHtkaWdpdH0gdHJvbmcgcG9wdXAgUElOIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBuaOG6rXAgbcOjIFBJTiAxMjM0IikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikgICMgQ2jhu50gcG9wdXAgxJHDs25nCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIlTDrG0gdGjhuqV5IHBvcHVwIFBJTiBuaMawbmcga2jDtG5nIHTDrG0gdGjhuqV5IHPhu5EgMSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygiS2jDtG5nIGPDsyBwb3B1cCBQSU4iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBraeG7g20gdHJhIHBvcHVwIFBJTjoge2V9IikKICAgIAogICAgZGVmIHBvc3RfbmV3ZmVlZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkMSDbmcgdmlkZW8gY2hvIFRpa1RvayAtIHBsYWNlaG9sZGVyIG1ldGhvZCDEkeG7gyDEkeG7k25nIG5o4bqldCB24bubaSBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIChwbGFjZWhvbGRlciBpbXBsZW1lbnRhdGlvbikKICAgICAgICAiIiIKICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgIyBCxrDhu5tjIDE6IELhuqVtIHF1YXkKICAgICAgICBuZXh0X2J1dHRvbjIgPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iUXVheSIsIHRpbWVvdXQ9NSkKICAgICAgICBpZiBub3QgbmV4dF9idXR0b24yOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgUXVheSDEkeG7gyDEkcSDbmcgdmlkZW8iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICAjIELGsOG7m2MgMiBi4bqlbSBjaG8gcGjDqXAKICAgICAgICB3aGlsZSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uYW5kcm9pZC5wYWNrYWdlaW5zdGFsbGVyOmlkL3Blcm1pc3Npb25fYWxsb3dfYnV0dG9uIiwgdGltZW91dD01KToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiQuG6pW0gbsO6dCBjaG8gcGjDqXAuLi4iKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKCiAgICAgICAgI0LGsOG7m2MgMyBi4bqlbSB2w6BvIGLhu5kgc8awdSB04bqtcAogICAgICAgIHJlY29yZF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KGNvbnRlbnRfZGVzYz0iUXVheSB2aWRlbyIsIHRpbWVvdXQ9MTApCiAgICAgICAgaWYgbm90IHJlY29yZF9idXR0b246CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCAnUXVheSB2aWRlbyciKQogICAgICAgICAgICBjbG9zZV9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KGNvbnRlbnRfZGVzYz0ixJDDs25nIiwgdGltZW91dD0yKQogICAgICAgICAgICBpZiBjbG9zZV9idXR0b246CiAgICAgICAgICAgICAgICBjbG9zZV9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KGNvbnRlbnRfZGVzYz0ixJDDs25nIiwgdGltZW91dD0yKQogICAgICAgICAgICBpZiBjbG9zZV9idXR0b246CiAgICAgICAgICAgICAgICBjbG9zZV9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KGNvbnRlbnRfZGVzYz0ixJDDs25nIiwgdGltZW91dD0yKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICAjIELGsOG7m2MgMjogUmFuZG9tIHPhu5EgbMaw4bujbmcg4bqjbmggdsOgIHThuqNpIHbhu4EKICAgICAgICBpbWFnZV9jb3VudCA9IHJhbmRvbS5yYW5kaW50KDMsIDUpCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlJhbmRvbSB7aW1hZ2VfY291bnR9IOG6o25oIMSR4buDIMSRxINuZyBiw6BpIikKICAgICAgICBpZiBub3Qgc2VsZi5oZWxwZXIuZG93bmxvYWRfaW1hZ2UoY291bnQ9aW1hZ2VfY291bnQpOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJU4bqjaSDhuqNuaCB0aOG6pXQgYuG6oWksIGLhu48gcXVhIMSRxINuZyBiw6BpIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCgogICAgICAgICMgTOG6pXkgYm91bmRzIGPhu6dhIHJlY29yZF9idXR0b24gdsOgIHTDrW5oIHRvw6FuIHThu41hIMSR4buZCiAgICAgICAgYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKHJlY29yZF9idXR0b24pCiAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBib3VuZHMKICAgICAgICB5ID0gKHkxICsgeTIpIC8vIDIgICMgeSDhu58gZ2nhu69hIGPhu6dhIGVsZW1lbnQKICAgICAgICB4ID0geDIgICMgeCDhu58gY+G6oW5oIHBo4bqjaQogICAgICAgIHRhcF94ID0geCArIDYwICAjIHggKyA2MAogICAgICAgIHRhcF95ID0geQoKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVGFwIHbDoG8gdOG7jWEgxJHhu5kgKHt0YXBfeH0sIHt0YXBfeX0pIC0gY+G6oW5oIHBo4bqjaSBj4bunYSBuw7p0IFF1YXkgdmlkZW8gKyA2MHB4IikKICAgICAgICBzZWxmLmhlbHBlci50YXAodGFwX3gsIHRhcF95KQogICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgIAogICAgICAgICMgQsaw4bubYyA0IGLhuqVtIGNobyBwaMOpcAogICAgICAgIHdoaWxlIHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5hbmRyb2lkLnBhY2thZ2VpbnN0YWxsZXI6aWQvcGVybWlzc2lvbl9hbGxvd19idXR0b24iLCB0aW1lb3V0PTUpOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4bqlbSBuw7p0IGNobyBwaMOpcC4uLiIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgIAogICAgICAgICMgQsaw4bubYyA1IGNo4buNbiDhuqNuaAogICAgICAgICMgVMOsbSBHcmlkVmlldyDEkeG7gyBjaOG7jW4g4bqjbmgKICAgICAgICBncmlkX3ZpZXcgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuR3JpZFZpZXciKQogICAgICAgIGlmIG5vdCBncmlkX3ZpZXc6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgR3JpZFZpZXcgxJHhu4MgY2jhu41uIOG6o25oIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgIyBM4bqleSB04bqldCBj4bqjIGPDoWMgYnV0dG9uIGzDoCBjb24gY+G7p2EgR3JpZFZpZXcKICAgICAgICBidXR0b25zX2luX2dyaWQgPSBzZWxmLmhlbHBlci5maW5kX2NoaWxkX2VsZW1lbnRzKGdyaWRfdmlldywgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuQnV0dG9uIikKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkge2xlbihidXR0b25zX2luX2dyaWQpfSBidXR0b24gdHJvbmcgR3JpZFZpZXciKQogICAgICAgIGlmIG5vdCBidXR0b25zX2luX2dyaWQgb3IgbGVuKGJ1dHRvbnNfaW5fZ3JpZCkgPT0gMDoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyBjw7Mg4bqjbmggbsOgbyB0cm9uZyBHcmlkVmlldyDEkeG7gyBjaOG7jW4iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICAjIENo4buNbiB04burIGl0ZW0gdOG7qyAwIMSR4bq/biBpbWFnZV9jb3VudC0xCiAgICAgICAgaXRlbXNfdG9fc2VsZWN0ID0gbWluKGltYWdlX2NvdW50LCBsZW4oYnV0dG9uc19pbl9ncmlkKSkKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQ2jhu41uIHtpdGVtc190b19zZWxlY3R9IOG6o25oIHThu6sgR3JpZFZpZXciKQogICAgICAgIGZvciBpIGluIHJhbmdlKGl0ZW1zX3RvX3NlbGVjdCk6CiAgICAgICAgICAgIGJ1dHRvbiA9IGJ1dHRvbnNfaW5fZ3JpZFtpXQogICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIkNo4buNbiDhuqNuaCB0aOG7qSB7aSsxfSIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihidXR0b24pCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCgogICAgICAgICMgVMOsbSB2w6AgYuG6pW0gbsO6dCBBdXRvQ3V0CiAgICAgICAgbmV4dF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHRleHQ9IkF1dG9DdXQiLCB0aW1lb3V0PTUpCiAgICAgICAgaWYgbm90IG5leHRfYnV0dG9uOgogICAgICAgICAgICBuZXh0X2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJBdXRvQ3V0IiwgdGltZW91dD01KQogICAgICAgIGlmIG5vdCBuZXh0X2J1dHRvbjoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0ICdBdXRvQ3V0JyBzYXUga2hpIGNo4buNbiDhuqNuaCIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKCiAgICAgICAgIyBDaOG7nSBoaeG7h3Ug4bupbmcgIsSQYW5nIHjhu60gbMO9Li4uIiBob8OgbiB04bqldAogICAgICAgIHdhaXRfY291bnQ9MAogICAgICAgIHdoaWxlIHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQodGV4dD0ixJBhbmcgeOG7rSBsw70uLi4iLCB0aW1lb3V0PTIpIDoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJBhbmcgeOG7rSBsw70uLi4iKQogICAgICAgICAgICB3YWl0X2NvdW50ICs9IDEKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIGlmIHdhaXRfY291bnQgPj0gMjAwOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIkNo4budIHF1w6EgbMOidSBjaG8gaGnhu4d1IOG7qW5nICfEkGFuZyB44butIGzDvS4uLicsIGLhu48gcXVhIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKSAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHBhY2thZ2UgaGnhu4duIHThuqFpCiAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgaWYgY3VycmVudF9wYWNrYWdlICE9IHNlbGYuYXBwX3BhY2thZ2U6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJQYWNrYWdlIGhp4buHbiB04bqhaSAoe2N1cnJlbnRfcGFja2FnZX0pIGtow7RuZyDEkcO6bmcsIG3hu58gbOG6oWkgYXBwIFRpa1Rvay4uLiIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHBhY2thZ2Ugc2F1IGtoaSBt4bufIGFwcAogICAgICAgICAgICBjdXJyZW50X3BhY2thZ2UgPSBzZWxmLmhlbHBlci5nZXRfY3VycmVudF9wYWNrYWdlKCkKICAgICAgICAgICAgaWYgY3VycmVudF9wYWNrYWdlICE9IHNlbGYuYXBwX3BhY2thZ2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlbhuqtuIGtow7RuZyBt4bufIMSRxrDhu6NjIGFwcCBUaWtUb2sgxJHDum5nIGPDoWNoLCBwYWNrYWdlIGhp4buHbiB04bqhaToge2N1cnJlbnRfcGFja2FnZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIG3hu58gbOG6oWkgYXBwIFRpa1RvayB0aMOgbmggY8O0bmciKQoKICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGPDsyB0ZXh0ICJOaOG6rXQga8O9IGPhu6dhIGLhuqFuIiB2w6AgInRp4bq/cCIgxJHhu4MgdGnhur9wIHThu6VjCiAgICAgICAgZGlhcnlfdGV4dCA9IHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQodGV4dD0iTmjhuq10IGvDvSBj4bunYSBi4bqhbiIsIHRpbWVvdXQ9NSkKICAgICAgICBjb250aW51ZV9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KHRleHQ9IlRp4bq/cCIsIHRpbWVvdXQ9MikKCiAgICAgICAgaWYgbm90IGRpYXJ5X3RleHQgb3Igbm90IGNvbnRpbnVlX2J1dHRvbjoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSAnTmjhuq10IGvDvSBj4bunYSBi4bqhbicgaG/hurdjIG7DunQgJ3Rp4bq/cCcsIGtow7RuZyB0aOG7gyB0aeG6v3AgdOG7pWMiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgIyBDaOG7nSBSZWN5Y2xlclZpZXcgeHXhuqV0IGhp4buHbiB2w6AgdGFwIHbDoG8gbsOzCiAgICAgICAgcmVjeWNsZXJfdmlldyA9IHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoY2xhc3NfbmFtZT0iYW5kcm9pZHgucmVjeWNsZXJ2aWV3LndpZGdldC5SZWN5Y2xlclZpZXciLCB0aW1lb3V0PTUpCiAgICAgICAgaWYgcmVjeWNsZXJfdmlldzoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgUmVjeWNsZXJWaWV3LCDEkWFuZyB0YXAgdsOgby4uLiIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihyZWN5Y2xlcl92aWV3KQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMTApCgogICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjb250aW51ZV9idXR0b24pCiAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCgoKICAgICAgICAjIEtp4buDbSB0cmEgY8OzIHRleHQgIlRow6ptIG3DtCB04bqjLi4uIiB2w6AgYuG6pW0gdsOgbyDEkcOzIMSR4buDIHRow6ptIGhhc2h0YWcKICAgICAgICBhZGRfZGVzY3JpcHRpb24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iVGjDqm0gbcO0IHThuqMuLi4iKQogICAgICAgIGlmIGFkZF9kZXNjcmlwdGlvbjoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgJ3Row6ptIG3DtCB04bqjLi4uJywgxJFhbmcgYuG6pW0gdsOgbyDEkeG7gyB0aMOqbSBoYXNodGFnIikKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGFkZF9kZXNjcmlwdGlvbikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJhbmRvbSBjaOG7jW4gMSBoYXNodGFnIHThu6sgZGFuaCBzw6FjaAogICAgICAgICAgICBoYXNodGFncyA9IFsKICAgICAgICAgICAgICAgICIjeHVodW9uZyIsICIjdGlrdG9rdm4iLCAiI3RyZW5kaW5nIiwgIiNsaWZldm4iLCAiI2N1b2Nzb25nIiwgCiAgICAgICAgICAgICAgICAiI2FtbmhhYyIsICIjdGluaHlldSIsICIjbmhvIiwgIiN0aGFuaHh1YW4iLCAiI2J1b24iLCAiI3Z1aSIsIAogICAgICAgICAgICAgICAgIiNoYW5ocGh1YyIsICIjY2FteHVjIiwgIiNuZ2F5bW9pIiwgIiNtdWFoZSIsICIjdGh1Z2lhbiIsIAogICAgICAgICAgICAgICAgIiNjaGlsbCIsICIjbW90bmdheWN1YXRvaSIKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZWN0ZWRfaGFzaHRhZyA9IHJhbmRvbS5jaG9pY2UoaGFzaHRhZ3MpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJOaOG6rXAgaGFzaHRhZzoge3NlbGVjdGVkX2hhc2h0YWd9IikKICAgICAgICAgICAgc2VsZi5oZWxwZXIuaW5wdXRfdGV4dChzZWxlY3RlZF9oYXNodGFnKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfZW50ZXIoKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgJ3Row6ptIG3DtCB04bqjLi4uJywgYuG7jyBxdWEgYsaw4bubYyB0aMOqbSBoYXNodGFnIikKCiAgICAgICAgIyBUw6xtIHbDoCBi4bqlbSBuw7p0IMSQxINuZwogICAgICAgIHBvc3RfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChjb250ZW50X2Rlc2M9IsSQxINuZyIsIHRpbWVvdXQ9MTApCiAgICAgICAgaWYgbm90IHBvc3RfYnV0dG9uOgogICAgICAgICAgICBwb3N0X2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQodGV4dD0ixJDEg25nIiwgdGltZW91dD01KQogICAgICAgICAgICBpZiBub3QgcG9zdF9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgJ8SQxINuZycgxJHhu4MgaG/DoG4gdGjDoG5oIMSRxINuZyB2aWRlbyIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEwKQogICAgICAgIHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCkKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiSG/DoG4gdGjDoG5oIMSRxINuZyB2aWRlbyBjaG8gVGlrVG9rIHTDoGkga2hv4bqjbjoge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnVW5rbm93bicpfSIpCiAgICAgICAgcmV0dXJuIFRydWU=').decode('utf-8'))
