import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHJlCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBvcwppbXBvcnQgY29uZmlnCmltcG9ydCB1dGlscwpmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgcXVvdGUsIHVucXVvdGUKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgT3B0aW9uYWwsIFR1cGxlLCBMaXN0LCBVbmlvbgp0cnk6CiAgICBmcm9tIGx4bWwgaW1wb3J0IGV0cmVlCiAgICBMWE1MX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgTFhNTF9BVkFJTEFCTEUgPSBGYWxzZQoKIyBU4bqhbyBsb2dnZXIgY2hvIEhlbHBlclNlcnZpY2UKbG9nZ2VyID0gdXRpbHMuZ2V0X2xvZ2dlcigiSGVscGVyU2VydmljZSIpCgpjbGFzcyBIZWxwZXJTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGJhc2VfdXJsOiBzdHIgPSBOb25lLCBkYl9zZXJ2aWNlPU5vbmUpOgogICAgICAgICMgU+G7rSBk4bulbmcgY29uZmlnIG7hur91IGJhc2VfdXJsIGtow7RuZyDEkcaw4bujYyBjdW5nIGPhuqVwCiAgICAgICAgaWYgYmFzZV91cmwgaXMgTm9uZToKICAgICAgICAgICAgYmFzZV91cmwgPSBjb25maWcuSEVMUEVSX1NFUlZJQ0VfVVJMCiAgICAgICAgCiAgICAgICAgc2VsZi5iYXNlX3VybCA9IGJhc2VfdXJsCiAgICAgICAgc2VsZi5pc19hZGJfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICBzZWxmLmRldmljZV9pcCA9IGNvbmZpZy5ERVZJQ0VfSVAgICMgU+G7rSBk4bulbmcgREVWSUNFX0lQIHThu6sgY29uZmlnCiAgICAgICAgc2VsZi5kYl9zZXJ2aWNlID0gZGJfc2VydmljZQogICAgICAgIAogICAgICAgICMgTHXDtG4gdGjhu60ga+G6v3QgbuG7kWkgQURCIHbhu5tpIElQIHThu6sgY29uZmlnCiAgICAgICAgc2VsZi5jaGVja19hbmRfY29ubmVjdF9hZGIoKQoKICAgIGRlZiBjaGVja19hbmRfY29ubmVjdF9hZGIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHbDoCBr4bq/dCBu4buRaSBBREIgdOG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgQURCIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBraMO0bmcKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJhZGIiLCAiLS12ZXJzaW9uIl0sIGNoZWNrPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEvhur90IG7hu5FpIEFEQiDEkeG6v24gdGhp4bq/dCBi4buLIHPhu60gZOG7pW5nIMSR4buLYSBjaOG7iSB04burIGNvbmZpZwogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIMSR4bq/biB0aGnhur90IGLhu4sKICAgICAgICAgICAgY29ubmVjdF9wcm9jZXNzID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbImFkYiIsICJjb25uZWN0IiwgYWRiX2FkZHJlc3NdLAogICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyBr4bq/dCBu4buRaQogICAgICAgICAgICBpZiAiY29ubmVjdGVkIiBpbiBjb25uZWN0X3Byb2Nlc3Muc3Rkb3V0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBUcnVlCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6Mga+G6v3QgbuG7kWkgQURCIHRow6BuaCBjw7RuZyDEkeG6v24ge2FkYl9hZGRyZXNzfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IChzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciwgRmlsZU5vdEZvdW5kRXJyb3IpIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBr4bq/dCBu4buRaSBBREI6IHtlfSIpCiAgICAgICAgCiAgICAgICAgc2VsZi5pc19hZGJfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2dldF9hZGJfZGV2aWNlX3BhcmFtKHNlbGYpIC0+IExpc3Rbc3RyXToKICAgICAgICAiIiIKICAgICAgICBUcuG6oyB24buBIHRoYW0gc+G7kSB0aGnhur90IGLhu4sgY2hvIGzhu4duaCBBREIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W3N0cl06IERhbmggc8OhY2ggWy1zLCBkZXZpY2VfaWRdIGhv4bq3YyBsaXN0IHLhu5duZyBu4bq/dSBraMO0bmcgY8OzIHRoaeG6v3QgYuG7iwogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgYWRiX2FkZHJlc3MgPSBmIntjb25maWcuQURCX0hPU1R9Ontjb25maWcuQURCX1BPUlR9IgogICAgICAgICAgICByZXR1cm4gWyItcyIsIGFkYl9hZGRyZXNzXQogICAgICAgIHJldHVybiBbXQoKICAgIGRlZiBfbWFrZV9yZXF1ZXN0KHNlbGYsIGVuZHBvaW50OiBzdHIsIHBhcmFtczogRGljdFtzdHIsIEFueV0gPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIHJlcXVlc3QgQVBJIHbDoCB0cuG6oyB24buBIGvhur90IHF14bqjIGThuqFuZyBKU09OIGhv4bq3YyBYTUwKICAgICAgICAiIiIKICAgICAgICB1cmwgPSBmIntzZWxmLmJhc2VfdXJsfS97ZW5kcG9pbnR9IgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUaGnhur90IGzhuq1wIHRpbWVvdXQgY2hvIHJlcXVlc3QKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PTEwKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBDb250ZW50LVR5cGUKICAgICAgICAgICAgY29udGVudF90eXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICBpZiAnYXBwbGljYXRpb24veG1sJyBpbiBjb250ZW50X3R5cGUgb3IgZW5kcG9pbnQgPT0gJ2R1bXAtc2NyZWVuLXhtbCc6CiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgWE1MIGTGsOG7m2kgZOG6oW5nIHRleHQKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgImRhdGEiOiByZXNwb25zZS50ZXh0fQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUcuG6oyB24buBIEpTT04KICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5UaW1lb3V0OgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlJlcXVlc3QgdGltZW91dCBraGkgZ+G7jWkge3VybH0sIHRo4butIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAiKQogICAgICAgICAgICBzZWxmLl9yZXN0YXJ0X2hlbHBlcl9hcHAoKQogICAgICAgICAgICAjIFRo4butIGzhuqFpIHJlcXVlc3Qgc2F1IGtoaSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkgICMgQ2jhu50gMSBnacOieSDEkeG7gyDhu6luZyBk4bulbmcga2jhu59pIMSR4buZbmcKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgcGFyYW1zPXBhcmFtcywgdGltZW91dD0xMCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgICAgICBpZiAnYXBwbGljYXRpb24veG1sJyBpbiBjb250ZW50X3R5cGUgb3IgZW5kcG9pbnQgPT0gJ2R1bXAtc2NyZWVuLXhtbCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLnRleHR9CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yIGFzIGU6CiAgICAgICAgICAgICMgQuG6r3QgbOG7l2kga+G6v3QgbuG7kWkgYuG7iyB04burIGNo4buRaSBob+G6t2Mga2jDtG5nIHRo4buDIGvhur90IG7hu5FpCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga+G6v3QgbuG7kWkga2hpIGfhu41pIHt1cmx9LCB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICBzZWxmLl9yZXN0YXJ0X2hlbHBlcl9hcHAoKQogICAgICAgICAgICAjIFRo4butIGzhuqFpIHJlcXVlc3Qgc2F1IGtoaSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikgICMgQ2jhu50gMiBnacOieSDEkeG7gyDhu6luZyBk4bulbmcga2jhu59pIMSR4buZbmcKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgcGFyYW1zPXBhcmFtcywgdGltZW91dD0xMCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgICAgICBpZiAnYXBwbGljYXRpb24veG1sJyBpbiBjb250ZW50X3R5cGUgb3IgZW5kcG9pbnQgPT0gJ2R1bXAtc2NyZWVuLXhtbCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLnRleHR9CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiByZXF1ZXN0OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6IHN0cihlKX0KCiAgICBkZWYgX3Jlc3RhcnRfaGVscGVyX2FwcChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAgc+G7rSBk4bulbmcgQURCCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEto4bufaSDEkeG7mW5nIGhlbHBlciBhcHAgYuG6sW5nIEFEQgogICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbInNoZWxsIiwgImFtIiwgInN0YXJ0IiwgIi1uIiwgImNvbS5kbmR2aW5hLmhlbHBlci8uTWFpbkFjdGl2aXR5Il0KICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICB0ZXh0PVRydWUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAgcXVhIEFEQiIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHF1YSBBREI6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAgdsOsIEFEQiBjaMawYSDEkcaw4bujYyBr4bq/dCBu4buRaSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiB0YXAoc2VsZiwgeDogaW50LCB5OiBpbnQpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIHbhu4sgdHLDrSB4LHkgdHLDqm4gbcOgbiBow6xuaAogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInRhcCIsIHBhcmFtcz17IngiOiB4LCAieSI6IHl9KQoKICAgIGRlZiB0YXBfZWxlbWVudChzZWxmLCBib3VuZHM6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhuqFtIHbDoG8gbeG7mXQgcGjhuqduIHThu60gZOG7sWEgdHLDqm4gYm91bmRzIGPhu6dhIG7DswogICAgICAgIEZvcm1hdCBib3VuZHM6ICJbeDEseTFdW3gyLHkyXSIgaG/hurdjIGVsZW1lbnQgZGljdAogICAgICAgICIiIgogICAgICAgICMgTuG6v3UgYm91bmRzIGzDoCBt4buZdCBkaWN0IChlbGVtZW50KSwgbOG6pXkgYm91bmRzIHN0cmluZyB04burIMSRw7MKICAgICAgICBpZiBpc2luc3RhbmNlKGJvdW5kcywgZGljdCk6CiAgICAgICAgICAgIGJvdW5kcyA9IGJvdW5kcy5nZXQoImJvdW5kcyIsICJbMCwwXVswLDBdIikKICAgICAgICAgICAgCiAgICAgICAgIyBUaOG7rSBjw6FjIHBhdHRlcm4ga2jDoWMgbmhhdSDEkeG7gyBwYXJzZSBib3VuZHMsIGNobyBwaMOpcCBz4buRIMOibQogICAgICAgIHBhdHRlcm5zID0gWwogICAgICAgICAgICByIlxbKC0/XGQrKSwoLT9cZCspXF1cWygtP1xkKyksKC0/XGQrKVxdIiwgICMgW3gxLHkxXVt4Mix5Ml0gduG7m2kgc+G7kSDDom0KICAgICAgICAgICAgciIoLT9cZCspLCgtP1xkKyksKC0/XGQrKSwoLT9cZCspIiwgICAgICAgICAjIHgxLHkxLHgyLHkyCiAgICAgICAgICAgIHIiXFsoLT9cZCspOygtP1xkKylcXVxbKC0/XGQrKTsoLT9cZCspXF0iICAgIyBbeDE7eTFdW3gyO3kyXQogICAgICAgIF0KICAgICAgICAKICAgICAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICAgICAgbWF0Y2ggPSByZS5tYXRjaChwYXR0ZXJuLCBib3VuZHMpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBtYXAoaW50LCBtYXRjaC5ncm91cHMoKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBwcmludChmIk9yaWdpbmFsIGJvdW5kczogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikgICMgQuG7jyBsb2cgbsOgeQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFPhu61hIGNo4buvYSBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4cKICAgICAgICAgICAgICAgIGlmIHkxIDwgMCBvciB5MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJGaXhpbmcgbmVnYXRpdmUgWSBjb29yZGluYXRlcy4uLiIpCiAgICAgICAgICAgICAgICAgICAgaWYgeTIgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBhYnMoeTIgLSB5MSkKICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSBtYXgoMCwgeTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHkyID0geTEgKyBoZWlnaHQKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJBZGp1c3RlZCBZOiB5MT17eTF9LCB5Mj17eTJ9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgeDEgPCAwIG9yIHgyIDwgMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkZpeGluZyBuZWdhdGl2ZSBYIGNvb3JkaW5hdGVzLi4uIikKICAgICAgICAgICAgICAgICAgICBpZiB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gYWJzKHgyIC0geDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gbWF4KDAsIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHgxICsgd2lkdGgKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJBZGp1c3RlZCBYOiB4MT17eDF9LCB4Mj17eDJ9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGJvdW5kcyBo4bujcCBs4buHIHNhdSBraGkgxJFp4buBdSBjaOG7iW5oCiAgICAgICAgICAgICAgICBpZiB4MSA+PSB4MiBvciB5MSA+PSB5MjoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkludmFsaWQgYm91bmRzIGFmdGVyIGFkanVzdG1lbnQ6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ2jhu41uIG3hu5l0IMSRaeG7g20gdHJvbmcgYm91bmRzIHbhu5tpIG1hcmdpbiBhbiB0b8OgbgogICAgICAgICAgICAgICAgbWFyZ2luID0gbWluKDMsICh4MiAtIHgxKSAvLyA0LCAoeTIgLSB5MSkgLy8gNCkgICMgRHluYW1pYyBtYXJnaW4KICAgICAgICAgICAgICAgIG1hcmdpbiA9IG1heCgxLCBtYXJnaW4pICAjIMONdCBuaOG6pXQgMXB4IG1hcmdpbgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB4ID0gcmFuZG9tLnJhbmRpbnQoeDEgKyBtYXJnaW4sIG1heCh4MSArIG1hcmdpbiArIDEsIHgyIC0gbWFyZ2luKSkKICAgICAgICAgICAgICAgIHkgPSByYW5kb20ucmFuZGludCh5MSArIG1hcmdpbiwgbWF4KHkxICsgbWFyZ2luICsgMSwgeTIgLSBtYXJnaW4pKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIHByaW50KGYiRmluYWwgdGFwIGNvb3JkaW5hdGVzOiAoe3h9LCB7eX0pIHdpdGggbWFyZ2luIHttYXJnaW59IikgICMgQuG7jyBsb2cgbsOgeQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi50YXAoeCwgeSkKICAgICAgICAKICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6IGYixJDhu4tuaCBk4bqhbmcgYm91bmRzIGtow7RuZyBo4bujcCBs4buHOiB7Ym91bmRzfSJ9CgogICAgZGVmIHN3aXBlKHNlbGYsIHN0YXJ0WDogaW50LCBzdGFydFk6IGludCwgZW5kWDogaW50LCBlbmRZOiBpbnQsIGR1cmF0aW9uOiBpbnQgPSA4MDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gdGhhbyB0w6FjIHZ14buRdCB0w7l5IGNo4buJbmggduG7m2kgY8OhYyB0aGFtIHPhu5EgY+G7pSB0aOG7gwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHN0YXJ0WDogVOG7jWEgxJHhu5kgWCDEkWnhu4NtIGLhuq90IMSR4bqndQogICAgICAgICAgICBzdGFydFk6IFThu41hIMSR4buZIFkgxJFp4buDbSBi4bqvdCDEkeG6p3UgIAogICAgICAgICAgICBlbmRYOiBU4buNYSDEkeG7mSBYIMSRaeG7g20ga+G6v3QgdGjDumMKICAgICAgICAgICAgZW5kWTogVOG7jWEgxJHhu5kgWSDEkWnhu4NtIGvhur90IHRow7pjCiAgICAgICAgICAgIGR1cmF0aW9uOiBUaOG7nWkgZ2lhbiB0aOG7sWMgaGnhu4duIHRoYW8gdMOhYyB2deG7kXQgKG1pbGxpc2Vjb25kcykKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIHRo4buxYyBoaeG7h24gdGhhbyB0w6FjCiAgICAgICAgICAgIAogICAgICAgIEV4YW1wbGU6CiAgICAgICAgICAgICMgVnXhu5F0IHThu6sgdHLDqm4geHXhu5FuZyBkxrDhu5tpCiAgICAgICAgICAgIGhlbHBlci5zd2lwZSgxMDAsIDIwMCwgMTAwLCA2MDAsIDEwMDApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFZ14buRdCB04burIHRyw6FpIHF1YSBwaOG6o2kKICAgICAgICAgICAgaGVscGVyLnN3aXBlKDUwLCA0MDAsIDM1MCwgNDAwLCA1MDApCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAic3RhcnRYIjogc3RhcnRYLAogICAgICAgICAgICAic3RhcnRZIjogc3RhcnRZLCAKICAgICAgICAgICAgImVuZFgiOiBlbmRYLAogICAgICAgICAgICAiZW5kWSI6IGVuZFksCiAgICAgICAgICAgICJkdXJhdGlvbiI6IGR1cmF0aW9uCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlN3aXBlOiAoe3N0YXJ0WH0se3N0YXJ0WX0pIOKGkiAoe2VuZFh9LHtlbmRZfSkgdHJvbmcge2R1cmF0aW9ufW1zIikKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZSIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIHN3aXBlX3VwKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCBsw6puIHThu6sgduG7iyB0csOtIG5n4bqrdSBuaGnDqm4gcGjDuSBo4bujcAogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX3VwIikKCiAgICBkZWYgc3dpcGVfZG93bihzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgeHXhu5FuZyB04burIHbhu4sgdHLDrSBuZ+G6q3Ugbmhpw6puIHBow7kgaOG7o3AKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV9kb3duIikKCiAgICBkZWYgaW5wdXRfdGV4dChzZWxmLCB0ZXh0OiBzdHIsIHNwZWVkOiBmbG9hdCA9IDEuMCwgCiAgICAgICAgICAgICAgICAgIGRpcmVjdF9tb2RlOiBib29sID0gRmFsc2UsIHBlcmZlY3RfbW9kZTogYm9vbCA9IFRydWUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3DtCBwaOG7j25nIGfDtSBwaMOtbSB24bubaSB04buRYyDEkeG7mSBuZ+G6q3Ugbmhpw6puIGdp4buRbmcgbmfGsOG7nWkgdGjhuq10IGLhurFuZyBBREIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgICMgRXNjYXBlIHRleHQgxJHhu4MgdHLDoW5oIGzhu5dpIHbhu5tpIGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdAogICAgICAgICAgICAgICAgZXNjYXBlZF90ZXh0ID0gdGV4dC5yZXBsYWNlKCcgJywgJ1xcICcpLnJlcGxhY2UoJyYnLCAnXFwmJykucmVwbGFjZSgnKCcsICdcXCgnKS5yZXBsYWNlKCcpJywgJ1xcKScpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaOG7sWMgdGhpIEFEQiBpbnB1dCB0ZXh0CiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCAiaW5wdXQiLCAidGV4dCIsIGYiJ3tlc2NhcGVkX3RleHR9JyJdCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAibWVzc2FnZSI6IGYixJDDoyBuaOG6rXAgdGV4dCAne3RleHR9JyBi4bqxbmcgQURCIn0KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRmFsbGJhY2sgduG7gSBBUEkgbuG6v3Uga2jDtG5nIGPDsyBBREIKICAgICAgICAgICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgICAidGV4dCI6IHRleHQsCiAgICAgICAgICAgICAgICAgICAgInNwZWVkIjogc3BlZWQsCiAgICAgICAgICAgICAgICAgICAgImRpcmVjdF9tb2RlIjogc3RyKGRpcmVjdF9tb2RlKS5sb3dlcigpLAogICAgICAgICAgICAgICAgICAgICJwZXJmZWN0X21vZGUiOiBzdHIocGVyZmVjdF9tb2RlKS5sb3dlcigpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpbnB1dF90ZXh0IiwgcGFyYW1zPXBhcmFtcykKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlRpbWVvdXRFeHBpcmVkOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlRpbWVvdXQga2hpIGfhu61pIEFEQiBpbnB1dCB0ZXh0OiB7dGV4dH0iKQogICAgICAgICAgICAjIEZhbGxiYWNrIHbhu4EgQVBJCiAgICAgICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICJ0ZXh0IjogdGV4dCwKICAgICAgICAgICAgICAgICJzcGVlZCI6IHNwZWVkLAogICAgICAgICAgICAgICAgImRpcmVjdF9tb2RlIjogc3RyKGRpcmVjdF9tb2RlKS5sb3dlcigpLAogICAgICAgICAgICAgICAgInBlcmZlY3RfbW9kZSI6IHN0cihwZXJmZWN0X21vZGUpLmxvd2VyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpbnB1dF90ZXh0IiwgcGFyYW1zPXBhcmFtcykKICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgQURCIGlucHV0IHRleHQgJ3t0ZXh0fSc6IHtlfSIpCiAgICAgICAgICAgICMgRmFsbGJhY2sgduG7gSBBUEkKICAgICAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAgICAgInRleHQiOiB0ZXh0LAogICAgICAgICAgICAgICAgInNwZWVkIjogc3BlZWQsCiAgICAgICAgICAgICAgICAiZGlyZWN0X21vZGUiOiBzdHIoZGlyZWN0X21vZGUpLmxvd2VyKCksCiAgICAgICAgICAgICAgICAicGVyZmVjdF9tb2RlIjogc3RyKHBlcmZlY3RfbW9kZSkubG93ZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImlucHV0X3RleHQiLCBwYXJhbXM9cGFyYW1zKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2jDtG5nIHjDoWMgxJHhu4tuaCBraGkgZ+G7rWkgQURCIGlucHV0IHRleHQgJ3t0ZXh0fSc6IHtlfSIpCiAgICAgICAgICAgICMgRmFsbGJhY2sgduG7gSBBUEkKICAgICAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAgICAgInRleHQiOiB0ZXh0LAogICAgICAgICAgICAgICAgInNwZWVkIjogc3BlZWQsCiAgICAgICAgICAgICAgICAiZGlyZWN0X21vZGUiOiBzdHIoZGlyZWN0X21vZGUpLmxvd2VyKCksCiAgICAgICAgICAgICAgICAicGVyZmVjdF9tb2RlIjogc3RyKHBlcmZlY3RfbW9kZSkubG93ZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImlucHV0X3RleHQiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBzaG93X3RvYXN0KHNlbGYsIG1lc3NhZ2U6IHN0ciwgdHlwZV86IHN0ciA9ICJpbmZvIiwgCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBzdHIgPSAiYm90dG9tIikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIHRvYXN0CiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICJ0eXBlIjogdHlwZV8sCiAgICAgICAgICAgICJwb3NpdGlvbiI6IHBvc2l0aW9uCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInRvYXN0LW1lc3NhZ2UiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBnZXRfZGV2aWNlX2luZm8oc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGjDtG5nIHRpbiBjaGkgdGnhur90IHbhu4EgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0ID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJkZXZpY2UtaW5mbyIpCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBr4bq/dCBxdeG6oyB0aMOgbmggY8O0bmcsIHRow6ptIHRow7RuZyB0aW4gaW50ZXJuZXQgSVAKICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiByZXN1bHQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgaW50ZXJuZXQgSVAgYuG6sW5nIHJlcXVlc3RzCiAgICAgICAgICAgICAgICBpbnRlcm5ldF9pcCA9IHNlbGYuX2dldF9pbnRlcm5ldF9pcCgpCiAgICAgICAgICAgICAgICBpZiBpbnRlcm5ldF9pcDoKICAgICAgICAgICAgICAgICAgICByZXN1bHRbImRhdGEiXVsiaW50ZXJuZXRfaXAiXSA9IGludGVybmV0X2lwCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJpbnRlcm5ldF9pcCJdID0gInVua25vd24iCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGzhuqV5IGludGVybmV0IElQOiB7ZX0iKQogICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bImludGVybmV0X2lwIl0gPSAiZXJyb3IiCiAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgCiAgICBkZWYgX2dldF9pbnRlcm5ldF9pcChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgxJHhu4thIGNo4buJIElQIGPDtG5nIGPhu5luZyBi4bqxbmcgcmVxdWVzdHMKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IMSQ4buLYSBjaOG7iSBJUCBjw7RuZyBj4buZbmcgaG/hurdjIGNodeG7l2kgcuG7l25nIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmlwaWZ5Lm9yZyIsIHRpbWVvdXQ9MykKICAgICAgICAgICAgaXAgPSByZXNwb25zZS50ZXh0LnN0cmlwKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSDEkeG7i25oIGThuqFuZyBJUCDEkcahbiBnaeG6o24KICAgICAgICAgICAgaWYgcmUubWF0Y2gocideXGR7MSwzfVwuXGR7MSwzfVwuXGR7MSwzfVwuXGR7MSwzfSQnLCBpcCk6CiAgICAgICAgICAgICAgICByZXR1cm4gaXAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiS+G6v3QgcXXhuqMga2jDtG5nIHBo4bqjaSBsw6AgSVAgaOG7o3AgbOG7hzoge2lwfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlRpbWVvdXQ6CiAgICAgICAgICAgIHByaW50KCJUaW1lb3V0IGtoaSBs4bqleSBpbnRlcm5ldCBJUCAoMyBnacOieSkiKQogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGzhuqV5IGludGVybmV0IElQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2jDtG5nIHjDoWMgxJHhu4tuaCBraGkgbOG6pXkgaW50ZXJuZXQgSVA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBjaGVja19pbnRlcm5ldChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEga+G6v3QgbuG7kWkgaW50ZXJuZXQKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGPDsyBr4bq/dCBu4buRaSBpbnRlcm5ldCwgRmFsc2UgbuG6v3Uga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIMSR4bq/biBHb29nbGUgRE5TIHbhu5tpIHRpbWVvdXQgbmfhuq9uCiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovLzguOC44LjgiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBUaOG7rSB24bubaSBt4buZdCBkb21haW4ga2jDoWMKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL3d3dy5nb29nbGUuY29tIiwgdGltZW91dD01KQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBnZXRfbG9jYWxfaXAoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IMSR4buLYSBjaOG7iSBJUCBsb2NhbCBj4bunYSB0aGnhur90IGLhu4sgdOG7qyBkZXZpY2UgaW5mbwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogxJDhu4thIGNo4buJIElQIGxvY2FsIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgICAgICBpZiBkZXZpY2VfaW5mby5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgcmV0dXJuIGRldmljZV9pbmZvWyJkYXRhIl0uZ2V0KCJsb2NhbF9pcCIsICIiKQogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGzhuqV5IGxvY2FsIElQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgZHVtcF9zY3JlZW5feG1sKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBEdW1wIHRvw6BuIGLhu5kgY+G6pXUgdHLDumMgWE1MIGPhu6dhIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgCiAgICAgICAgVHLhuqMgduG7gSBu4buZaSBkdW5nIFhNTCBkxrDhu5tpIGThuqFuZyBjaHXhu5dpCiAgICAgICAgIiIiCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImR1bXAtc2NyZWVuLXhtbCIpCiAgICAgICAgaWYgcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJkYXRhIl0KICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgb3Blbl9hcHAoc2VsZiwgcGFja2FnZTogc3RyLCBhY3Rpdml0eTogc3RyID0gTm9uZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTeG7nyBt4buZdCDhu6luZyBk4bulbmcgduG7m2kgcGFja2FnZSBuYW1lIHbDoCBhY3Rpdml0eSBj4bulIHRo4buDCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0geyJwYWNrYWdlIjogcGFja2FnZX0KICAgICAgICBpZiBhY3Rpdml0eToKICAgICAgICAgICAgcGFyYW1zWyJhY3Rpdml0eSJdID0gYWN0aXZpdHkKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJvcGVuX2FwcCIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIGNsb3NlX2FwcChzZWxmLCBwYWNrYWdlOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIMSQw7NuZyBt4buZdCDhu6luZyBk4bulbmcgxJFhbmcgY2jhuqF5CiAgICAgICAgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgxJDDs25nIOG7qW5nIGThu6VuZyBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCBmImFtIGZvcmNlLXN0b3Age3BhY2thZ2V9Il0KICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAibWVzc2FnZSI6IGYixJDDoyDEkcOzbmcge3BhY2thZ2V9IGLhurFuZyBBREIifQogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIMSRw7NuZyDhu6luZyBk4bulbmcgYuG6sW5nIEFEQjoge2V9IikKICAgICAgICAgICAgICAgICMgTuG6v3UgbOG7l2ksIHRo4butIHBoxrDGoW5nIHRo4bupYyBIVFRQCiAgICAgICAgCiAgICAgICAgIyBT4butIGThu6VuZyBIVFRQIEFQSSBu4bq/dSBraMO0bmcgY8OzIEFEQiBob+G6t2MgQURCIGLhu4sgbOG7l2kKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19ob21lIikKCiAgICBkZWYgX3Nhbml0aXplX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTCDEkeG7gyB0csOhbmggbOG7l2kga2hpIHBow6JuIHTDrWNoCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IENodeG7l2kgWE1MIGPhuqduIHjhu60gbMO9CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogQ2h14buXaSBYTUwgxJHDoyDEkcaw4bujYyB44butIGzDvQogICAgICAgICIiIgogICAgICAgICMgVGhheSB0aOG6vyBjw6FjIGvDvSB04buxICYga2jDtG5nIGjhu6NwIGzhu4cgYuG6sW5nICZhbXA7CiAgICAgICAgIyBOaMawbmcgZ2nhu68gbmd1ecOqbiBjw6FjIGVudGl0eSBo4bujcCBs4buHIG5oxrAgJmFtcDssICZsdDssICZndDssICZxdW90OywgJmFwb3M7CiAgICAgICAgeG1sX2NvbnRlbnQgPSByZS5zdWIocicmKD8hKGFtcHxsdHxndHxxdW90fGFwb3MpOyknLCAnJmFtcDsnLCB4bWxfY29udGVudCkKICAgICAgICAKICAgICAgICAjIExv4bqhaSBi4buPIGPDoWMga8O9IHThu7EgxJFp4buBdSBraGnhu4NuIGtow7RuZyBo4bujcCBs4buHIHRyb25nIFhNTAogICAgICAgIHhtbF9jb250ZW50ID0gcmUuc3ViKHInW1x4MDAtXHgwOFx4MEJceDBDXHgwRS1ceDFGXScsICcnLCB4bWxfY29udGVudCkKICAgICAgICAKICAgICAgICByZXR1cm4geG1sX2NvbnRlbnQKCiAgICBkZWYgZmluZF9lbGVtZW50X2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCAKICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHBo4bqnbiB04butIHRyb25nIFhNTCBk4buxYSB0csOqbiB0ZXh0LCBjb250ZW50LWRlc2MsIHJlc291cmNlLWlkLCBjbGFzcyBob+G6t2MgdmlzaWJsZS10by11c2VyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IE7hu5lpIGR1bmcgWE1MCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBQaOG6p24gdOG7rSDEkeG6p3UgdGnDqm4gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyBYUGF0aCBxdWVyeSBk4buxYSB0csOqbiBjw6FjIMSRaeG7gXUga2nhu4duCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EgdHJvbmcgdGV4dAogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ2NvbnRhaW5zKEB0ZXh0LCAie3RleHR9IiknKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRhaW5zOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRyb25nIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ2NvbnRhaW5zKEBjb250ZW50LWRlc2MsICJ7Y29udGVudF9kZXNjfSIpJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0BjbGFzcz0ie2NsYXNzX25hbWV9IicpCiAgICAgICAgICAgICAgICBpZiB2aXNpYmxlX3RvX3VzZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV92YWx1ZSA9ICJ0cnVlIiBpZiB2aXNpYmxlX3RvX3VzZXIgZWxzZSAiZmFsc2UiCiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdmlzaWJsZS10by11c2VyPSJ7dmlzaWJsZV92YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgPSAiLy9ub2RlIgogICAgICAgICAgICAgICAgaWYgY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSArPSAiWyIgKyAiIGFuZCAiLmpvaW4oY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHBo4bqnbiB04butIMSR4bqndSB0acOqbiBwaMO5IGjhu6NwCiAgICAgICAgICAgICAgICBlbGVtZW50ID0gcm9vdC54cGF0aCh4cGF0aF9xdWVyeSkKICAgICAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VsZW1lbnRfdG9fZGljdChlbGVtZW50WzBdKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIHBo4bqnbiB04butIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4CiAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRoYXkgdsOsIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgcGF0dGVybiA9IGYndGV4dD0iW14iXSp7cmUuZXNjYXBlKHRleHQpfVteIl0qIicKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZid0ZXh0PSJ7dGV4dH0iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgdGV4dAogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgaWYgY29udGVudF9kZXNjOgogICAgICAgICAgICBpZiBjb250YWluczoKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EgdGhheSB2w6wga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZidjb250ZW50LWRlc2M9IlteIl0qe3JlLmVzY2FwZShjb250ZW50X2Rlc2MpfVteIl0qIicKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZidjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgaWYgcmVzb3VyY2VfaWQ6CiAgICAgICAgICAgIHBhdHRlcm4gPSBmJ3Jlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBpZiBjbGFzc19uYW1lOgogICAgICAgICAgICBwYXR0ZXJuID0gZidjbGFzcz0ie2NsYXNzX25hbWV9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIGNsYXNzCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZmluZF9wYXJlbnRfZWxlbWVudF9pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgY2hpbGRfZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgY2hhIGPhu6dhIG3hu5l0IGVsZW1lbnQgY29uIHRyb25nIFhNTAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICBjaGlsZF9lbGVtZW50OiBFbGVtZW50IGNvbiAoZGljdCB24bubaSBjw6FjIHRodeG7mWMgdMOtbmggbmjGsCBib3VuZHMsIHRleHQsIGV0Yy4pCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogRWxlbWVudCBjaGEgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50IG9yIG5vdCBjaGlsZF9lbGVtZW50OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyDEkWnhu4F1IGtp4buHbiDEkeG7gyB0w6xtIGVsZW1lbnQgY29uIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGNoaWxkX2VsZW1lbnQuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBpZiBrZXkgaW4gWyd0ZXh0JywgJ2NvbnRlbnQtZGVzYycsICdyZXNvdXJjZS1pZCcsICdjbGFzcycsICdib3VuZHMnLCAndmlzaWJsZS10by11c2VyJ106CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHtrZXl9PSJ7dmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBjb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ID0gIi8vbm9kZVsiICsgIiBhbmQgIi5qb2luKGNvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBlbGVtZW50IGNvbgogICAgICAgICAgICAgICAgY2hpbGRfbm9kZXMgPSByb290LnhwYXRoKHhwYXRoX3F1ZXJ5KQogICAgICAgICAgICAgICAgaWYgY2hpbGRfbm9kZXM6CiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBlbGVtZW50IGNoYSBj4bunYSBlbGVtZW50IGNvbiDEkeG6p3UgdGnDqm4gdMOsbSDEkcaw4bujYwogICAgICAgICAgICAgICAgICAgIHBhcmVudF9ub2RlID0gY2hpbGRfbm9kZXNbMF0uZ2V0cGFyZW50KCkKICAgICAgICAgICAgICAgICAgICBpZiBwYXJlbnRfbm9kZSBpcyBub3QgTm9uZSBhbmQgcGFyZW50X25vZGUudGFnID09ICdub2RlJzoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VsZW1lbnRfdG9fZGljdChwYXJlbnRfbm9kZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IGNoYSB24bubaSBseG1sOiB7ZX0iKQogICAgICAgIAogICAgICAgICMgRmFsbGJhY2s6IFTDrG0ga2nhur9tIGLhurFuZyByZWdleCAocGjhu6ljIHThuqFwIGjGoW4gbmjGsG5nIGPhuqduIHRoaeG6v3QpCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFTDrG0gYm91bmRzIGPhu6dhIGVsZW1lbnQgY29uIMSR4buDIHjDoWMgxJHhu4tuaCB24buLIHRyw60KICAgICAgICAgICAgY2hpbGRfYm91bmRzID0gY2hpbGRfZWxlbWVudC5nZXQoJ2JvdW5kcycsICcnKQogICAgICAgICAgICBpZiBub3QgY2hpbGRfYm91bmRzOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBwYXR0ZXJuIGPhu6dhIGVsZW1lbnQgY29uIHRyb25nIFhNTAogICAgICAgICAgICBjaGlsZF9wYXR0ZXJuID0gTm9uZQogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBjaGlsZF9lbGVtZW50Lml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiBrZXkgaW4gWyd0ZXh0JywgJ2NvbnRlbnQtZGVzYycsICdyZXNvdXJjZS1pZCcsICdjbGFzcyddIGFuZCB2YWx1ZToKICAgICAgICAgICAgICAgICAgICBlc2NhcGVkX3ZhbHVlID0gcmUuZXNjYXBlKHN0cih2YWx1ZSkpCiAgICAgICAgICAgICAgICAgICAgcGF0dGVybiA9IGYne2tleX09Intlc2NhcGVkX3ZhbHVlfSInCiAgICAgICAgICAgICAgICAgICAgaWYgcGF0dGVybiBpbiB4bWxfY29udGVudDoKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfcGF0dGVybiA9IHBhdHRlcm4KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBjaGlsZF9wYXR0ZXJuOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB24buLIHRyw60gY+G7p2EgZWxlbWVudCBjb24gdHJvbmcgWE1MCiAgICAgICAgICAgIGNoaWxkX21hdGNoID0gcmUuc2VhcmNoKGNoaWxkX3BhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBub3QgY2hpbGRfbWF0Y2g6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIHBhdHRlcm4gbsOgeQogICAgICAgICAgICBjaGlsZF9zdGFydCA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIGNoaWxkX21hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgIGlmIGNoaWxkX3N0YXJ0ID09IC0xOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNoYSBi4bqxbmcgY8OhY2ggxJHhur9tIGxldmVsCiAgICAgICAgICAgICMgVMOsbSBuZ8aw4bujYyBs4bqhaSDEkeG7gyB0w6xtIHRo4bq7IG5vZGUgY2hhIGfhuqduIG5o4bqldAogICAgICAgICAgICBwYXJlbnRfc3RhcnQgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBjaGlsZF9zdGFydCkKICAgICAgICAgICAgaWYgcGFyZW50X3N0YXJ0ID09IC0xOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIHBhcmVudF9lbmQgPSB4bWxfY29udGVudC5maW5kKCc+JywgcGFyZW50X3N0YXJ0KSArIDEKICAgICAgICAgICAgcGFyZW50X2NvbnRlbnQgPSB4bWxfY29udGVudFtwYXJlbnRfc3RhcnQ6cGFyZW50X2VuZF0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMocGFyZW50X2NvbnRlbnQpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IGNoYSB24bubaSByZWdleDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIGZpbmRfY2hpbGRfZWxlbWVudHNfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIHBhcmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIGVsZW1lbnQgY29uIGPhu6dhIG3hu5l0IGVsZW1lbnQgY2hhIHRyb25nIFhNTAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICBwYXJlbnRfZWxlbWVudDogRWxlbWVudCBjaGEgKGRpY3QgduG7m2kgY8OhYyB0aHXhu5ljIHTDrW5oIG5oxrAgYm91bmRzLCB0ZXh0LCBldGMuKQogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgZWxlbWVudCBjb24gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICByZXN1bHRzID0gW10KICAgICAgICAKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQgb3Igbm90IHBhcmVudF9lbGVtZW50OgogICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgY2hhIHRyxrDhu5tjCiAgICAgICAgICAgICAgICBwYXJlbnRfY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBwYXJlbnRfZWxlbWVudC5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgIGlmIGtleSBpbiBbJ3RleHQnLCAnY29udGVudC1kZXNjJywgJ3Jlc291cmNlLWlkJywgJ2NsYXNzJywgJ2JvdW5kcycsICd2aXNpYmxlLXRvLXVzZXInXToKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHtrZXl9PSJ7dmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBwYXJlbnRfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwYXJlbnRfeHBhdGggPSAiLy9ub2RlWyIgKyAiIGFuZCAiLmpvaW4ocGFyZW50X2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICBwYXJlbnRfbm9kZXMgPSByb290LnhwYXRoKHBhcmVudF94cGF0aCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHBhcmVudF9ub2RlczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gdOG6pXQgY+G6oyBlbGVtZW50IGNvbiBj4bunYSBlbGVtZW50IGNoYQogICAgICAgICAgICAgICAgZm9yIHBhcmVudF9ub2RlIGluIHBhcmVudF9ub2RlczoKICAgICAgICAgICAgICAgICAgICAjIFjDonkgZOG7sW5nIMSRaeG7gXUga2nhu4duIHTDrG0ga2nhur9tIGNobyBlbGVtZW50IGNvbgogICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZF9jb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMuYXBwZW5kKGYnQGNsYXNzPSJ7Y2xhc3NfbmFtZX0iJykKICAgICAgICAgICAgICAgICAgICBpZiB2aXNpYmxlX3RvX3VzZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdmFsdWUgPSAidHJ1ZSIgaWYgdmlzaWJsZV90b191c2VyIGVsc2UgImZhbHNlIgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZF9jb25kaXRpb25zLmFwcGVuZChmJ0B2aXNpYmxlLXRvLXVzZXI9Int2aXNpYmxlX3ZhbHVlfSInKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSBlbGVtZW50IGNvbiB0cm9uZyBwYXJlbnQgbm9kZQogICAgICAgICAgICAgICAgICAgIGNoaWxkX3hwYXRoID0gIi4vL25vZGUiCiAgICAgICAgICAgICAgICAgICAgaWYgY2hpbGRfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfeHBhdGggKz0gIlsiICsgIiBhbmQgIi5qb2luKGNoaWxkX2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY2hpbGRfbm9kZXMgPSBwYXJlbnRfbm9kZS54cGF0aChjaGlsZF94cGF0aCkKICAgICAgICAgICAgICAgICAgICBmb3IgY2hpbGRfbm9kZSBpbiBjaGlsZF9ub2RlczoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoc2VsZi5fZWxlbWVudF90b19kaWN0KGNoaWxkX25vZGUpKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IGNvbiB24bubaSBseG1sOiB7ZX0iKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzCiAgICAKICAgIGRlZiBmaW5kX2NoaWxkX2VsZW1lbnRfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIHBhcmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgY29uIMSR4bqndSB0acOqbiBj4bunYSBt4buZdCBlbGVtZW50IGNoYSB0cm9uZyBYTUwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgcGFyZW50X2VsZW1lbnQ6IEVsZW1lbnQgY2hhIChkaWN0IHbhu5tpIGPDoWMgdGh14buZYyB0w61uaCBuaMawIGJvdW5kcywgdGV4dCwgZXRjLikKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IEVsZW1lbnQgY29uIMSR4bqndSB0acOqbiB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICBjaGlsZF9lbGVtZW50cyA9IHNlbGYuZmluZF9jaGlsZF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgIHhtbF9jb250ZW50LCBwYXJlbnRfZWxlbWVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyLCBjb250YWlucwogICAgICAgICkKICAgICAgICByZXR1cm4gY2hpbGRfZWxlbWVudHNbMF0gaWYgY2hpbGRfZWxlbWVudHMgZWxzZSBOb25lCiAgICAKICAgIGRlZiBmaW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSB0cm9uZyBYTUwgcGjDuSBo4bujcCB24bubaSDEkWnhu4F1IGtp4buHbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgcGjhuqduIHThu60gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICByZXN1bHRzID0gW10KICAgICAgICAKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQ6CiAgICAgICAgICAgIHJldHVybiByZXN1bHRzCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwgxJHhu4MgdHLDoW5oIGzhu5dpIEVudGl0eVJlZgogICAgICAgICAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLl9zYW5pdGl6ZV94bWwoeG1sX2NvbnRlbnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUGFyc2UgWE1MIHbhu5tpIHTDuXkgY2jhu41uIHJlY292ZXIgxJHhu4MgeOG7rSBsw70gbOG7l2kKICAgICAgICAgICAgICAgIHBhcnNlciA9IGV0cmVlLlhNTFBhcnNlcihyZWNvdmVyPVRydWUpCiAgICAgICAgICAgICAgICByb290ID0gZXRyZWUuZnJvbXN0cmluZyh4bWxfY29udGVudC5lbmNvZGUoJ3V0Zi04JyksIHBhcnNlcj1wYXJzZXIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgWMOieSBk4buxbmcgWFBhdGggcXVlcnkgZOG7sWEgdHLDqm4gY8OhYyDEkWnhu4F1IGtp4buHbgogICAgICAgICAgICAgICAgY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICBpZiB0ZXh0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRhaW5zOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRyb25nIHRleHQKICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidjb250YWlucyhAdGV4dCwgInt0ZXh0fSIpJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0B0ZXh0PSJ7dGV4dH0iJykKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBpZiBjb250YWluczoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYSB0cm9uZyBjb250ZW50LWRlc2MKICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidjb250YWlucyhAY29udGVudC1kZXNjLCAie2NvbnRlbnRfZGVzY30iKScpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMKICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAcmVzb3VyY2UtaWQ9IntyZXNvdXJjZV9pZH0iJykKICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY2xhc3M9IntjbGFzc19uYW1lfSInKQogICAgICAgICAgICAgICAgaWYgdmlzaWJsZV90b191c2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdmFsdWUgPSAidHJ1ZSIgaWYgdmlzaWJsZV90b191c2VyIGVsc2UgImZhbHNlIgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHZpc2libGUtdG8tdXNlcj0ie3Zpc2libGVfdmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ID0gIi8vbm9kZSIKICAgICAgICAgICAgICAgIGlmIGNvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgKz0gIlsiICsgIiBhbmQgIi5qb2luKGNvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIHBo4bqnbiB04butIHBow7kgaOG7o3AKICAgICAgICAgICAgICAgIGVsZW1lbnRzID0gcm9vdC54cGF0aCh4cGF0aF9xdWVyeSkKICAgICAgICAgICAgICAgIGZvciBlbGVtZW50IGluIGVsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2VsZW1lbnRfdG9fZGljdChlbGVtZW50KSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBwaOG6p24gdOG7rSB24bubaSBseG1sOiB7ZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiJUaOG7rSB0w6xtIHBo4bqnbiB04butIGLhurFuZyBwaMawxqFuZyB0aOG7qWMgdGhheSB0aOG6vy4uLiIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4IChjaOG7iSB0cuG6oyB24buBIGvhur90IHF14bqjIMSRxqFuIGdp4bqjbikKICAgICAgICBpZiBub3QgcmVzdWx0cyBhbmQgdGV4dDoKICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRoYXkgdsOsIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgcGF0dGVybiA9IGYndGV4dD0iW14iXSp7cmUuZXNjYXBlKHRleHQpfVteIl0qIicKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZid0ZXh0PSJ7dGV4dH0iJwogICAgICAgICAgICBmb3IgbWF0Y2ggaW4gcmUuZmluZGl0ZXIocGF0dGVybiwgeG1sX2NvbnRlbnQpOgogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHJlc3VsdHMgYW5kIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRoYXkgdsOsIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgcGF0dGVybiA9IGYnY29udGVudC1kZXNjPSJbXiJdKntyZS5lc2NhcGUoY29udGVudF9kZXNjKX1bXiJdKiInCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgcGF0dGVybiA9IGYnY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInCiAgICAgICAgICAgIGZvciBtYXRjaCBpbiByZS5maW5kaXRlcihwYXR0ZXJuLCB4bWxfY29udGVudCk6CiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KSkKICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgCiAgICBkZWYgX2V4dHJhY3RfYXR0cmlidXRlcyhzZWxmLCBub2RlX2NvbnRlbnQ6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVHLDrWNoIHh14bqldCBjw6FjIHRodeG7mWMgdMOtbmggdOG7qyBu4buZaSBkdW5nIGPhu6dhIG3hu5l0IHRo4bq7IG5vZGUKICAgICAgICAiIiIKICAgICAgICBhdHRyaWJ1dGVzID0ge30KICAgICAgICAKICAgICAgICAjIEPDoWMgdGh14buZYyB0w61uaCBj4bqnbiB0csOtY2ggeHXhuqV0CiAgICAgICAgYXR0cl9wYXR0ZXJucyA9IHsKICAgICAgICAgICAgImNsYXNzIjogcidjbGFzcz0iKFteIl0qKSInLAogICAgICAgICAgICAicGFja2FnZSI6IHIncGFja2FnZT0iKFteIl0qKSInLAogICAgICAgICAgICAicmVzb3VyY2UtaWQiOiByJ3Jlc291cmNlLWlkPSIoW14iXSopIicsCiAgICAgICAgICAgICJ0ZXh0Ijogcid0ZXh0PSIoW14iXSopIicsCiAgICAgICAgICAgICJjb250ZW50LWRlc2MiOiByJ2NvbnRlbnQtZGVzYz0iKFteIl0qKSInLAogICAgICAgICAgICAiYm91bmRzIjogcidib3VuZHM9IihbXiJdKikiJywKICAgICAgICAgICAgImNoZWNrYWJsZSI6IHInY2hlY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJjaGVja2VkIjogcidjaGVja2VkPSIoW14iXSopIicsCiAgICAgICAgICAgICJjbGlja2FibGUiOiByJ2NsaWNrYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAiZW5hYmxlZCI6IHInZW5hYmxlZD0iKFteIl0qKSInLAogICAgICAgICAgICAiZm9jdXNhYmxlIjogcidmb2N1c2FibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImZvY3VzZWQiOiByJ2ZvY3VzZWQ9IihbXiJdKikiJywKICAgICAgICAgICAgInNjcm9sbGFibGUiOiByJ3Njcm9sbGFibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImxvbmctY2xpY2thYmxlIjogcidsb25nLWNsaWNrYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAicGFzc3dvcmQiOiByJ3Bhc3N3b3JkPSIoW14iXSopIicsCiAgICAgICAgICAgICJzZWxlY3RlZCI6IHInc2VsZWN0ZWQ9IihbXiJdKikiJwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgYXR0cl9uYW1lLCBwYXR0ZXJuIGluIGF0dHJfcGF0dGVybnMuaXRlbXMoKToKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgbm9kZV9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXNbYXR0cl9uYW1lXSA9IG1hdGNoLmdyb3VwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gYXR0cmlidXRlcwoKICAgIGRlZiBfZWxlbWVudF90b19kaWN0KHNlbGYsIGVsZW1lbnQpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENodXnhu4NuIMSR4buVaSBt4buZdCBwaOG6p24gdOG7rSBYTUwgdOG7qyBseG1sIHRow6BuaCBkaWN0CiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0ID0ge30KICAgICAgICAKICAgICAgICAjIEzhuqV5IHThuqV0IGPhuqMgdGh14buZYyB0w61uaAogICAgICAgIGZvciBrZXksIHZhbHVlIGluIGVsZW1lbnQuYXR0cmliLml0ZW1zKCk6CiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWUKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdAoKICAgIGRlZiBmaW5kX2VsZW1lbnQoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSBwaOG6p24gdOG7rSB0csOqbiBtw6BuIGjDrG5oIGThu7FhIHRyw6puIHRleHQsIGNvbnRlbnQtZGVzYywgcmVzb3VyY2UtaWQsIGNsYXNzIGhv4bq3YyB2aXNpYmxlLXRvLXVzZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogUGjhuqduIHThu60gxJHhuqd1IHRpw6puIHTDrG0gdGjhuqV5IGhv4bq3YyBOb25lIG7hur91IGtow7RuZyB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUsIHZpc2libGVfdG9fdXNlciwgY29udGFpbnMpCgogICAgZGVmIGZpbmRfYWxsX2VsZW1lbnRzKHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSB0csOqbiBtw6BuIGjDrG5oIHBow7kgaOG7o3AgduG7m2kgxJFp4buBdSBraeG7h24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgcGjhuqduIHThu60gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICByZXR1cm4gc2VsZi5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoeG1sX2NvbnRlbnQsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUsIHZpc2libGVfdG9fdXNlciwgY29udGFpbnMpCgogICAgZGVmIGZpbmRfY2hpbGRfZWxlbWVudHMoc2VsZiwgcGFyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgZWxlbWVudCBjb24gY+G7p2EgbeG7mXQgZWxlbWVudCBjaGEgdHLDqm4gbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwYXJlbnRfZWxlbWVudDogRWxlbWVudCBjaGEgKGRpY3QgduG7m2kgY8OhYyB0aHXhu5ljIHTDrW5oIG5oxrAgYm91bmRzLCB0ZXh0LCBldGMuKQogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgZWxlbWVudCBjb24gdMOsbSB0aOG6pXkKICAgICAgICAgICAgCiAgICAgICAgRXhhbXBsZToKICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgR3JpZFZpZXcgdHJvbmcgbeG7mXQgVmlld0dyb3VwCiAgICAgICAgICAgIHBhcmVudCA9IGhlbHBlci5maW5kX2VsZW1lbnQoY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuVmlld0dyb3VwIikKICAgICAgICAgICAgZ3JpZF92aWV3cyA9IGhlbHBlci5maW5kX2NoaWxkX2VsZW1lbnRzKHBhcmVudCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuR3JpZFZpZXciKQogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfY2hpbGRfZWxlbWVudHNfaW5feG1sKHhtbF9jb250ZW50LCBwYXJlbnRfZWxlbWVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyLCBjb250YWlucykKCiAgICBkZWYgZmluZF9jaGlsZF9lbGVtZW50KHNlbGYsIHBhcmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgY29uIMSR4bqndSB0acOqbiBj4bunYSBt4buZdCBlbGVtZW50IGNoYSB0csOqbiBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBhcmVudF9lbGVtZW50OiBFbGVtZW50IGNoYSAoZGljdCB24bubaSBjw6FjIHRodeG7mWMgdMOtbmggbmjGsCBib3VuZHMsIHRleHQsIGV0Yy4pCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBFbGVtZW50IGNvbiDEkeG6p3UgdGnDqm4gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgICAgIAogICAgICAgIEV4YW1wbGU6CiAgICAgICAgICAgICMgVMOsbSBt4buZdCBUZXh0VmlldyB0cm9uZyBt4buZdCBMaW5lYXJMYXlvdXQgY+G7pSB0aOG7gwogICAgICAgICAgICBwYXJlbnQgPSBoZWxwZXIuZmluZF9lbGVtZW50KGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkxpbmVhckxheW91dCIsIHJlc291cmNlX2lkPSJjb20uZXhhbXBsZTppZC9jb250YWluZXIiKQogICAgICAgICAgICB0ZXh0X3ZpZXcgPSBoZWxwZXIuZmluZF9jaGlsZF9lbGVtZW50KHBhcmVudCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuVGV4dFZpZXciKQogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfY2hpbGRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIHBhcmVudF9lbGVtZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIsIGNvbnRhaW5zKQoKICAgIGRlZiBnZXRfbmV4dF9lbGVtZW50X2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCBjdXJyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gZWxlbWVudCB0aeG6v3AgdGhlbyAoYW5oIGVtKSBj4bunYSBlbGVtZW50IGhp4buHbiB04bqhaSB0cm9uZyBYTUwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgY3VycmVudF9lbGVtZW50OiBFbGVtZW50IGhp4buHbiB04bqhaSDEkeG7gyBsw6BtIG3hu5FjCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgZWxlbWVudCB0aeG6v3AgdGhlbyBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBlbGVtZW50IHRp4bq/cCB0aGVvIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgdGnhur9wIHRoZW8gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIGVsZW1lbnQgdGnhur9wIHRoZW8gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IEVsZW1lbnQgdGnhur9wIHRoZW8gaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50IG9yIG5vdCBjdXJyZW50X2VsZW1lbnQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gZWxlbWVudCBoaeG7h24gdOG6oWkgdHLGsOG7m2MKICAgICAgICAgICAgICAgIGN1cnJlbnRfY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBjdXJyZW50X2VsZW1lbnQuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBpZiBrZXkgaW4gWyd0ZXh0JywgJ2NvbnRlbnQtZGVzYycsICdyZXNvdXJjZS1pZCcsICdjbGFzcycsICdib3VuZHMnLCAndmlzaWJsZS10by11c2VyJ106CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfY29uZGl0aW9ucy5hcHBlbmQoZidAe2tleX09Int2YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGN1cnJlbnRfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdXJyZW50X3hwYXRoID0gIi8vbm9kZVsiICsgIiBhbmQgIi5qb2luKGN1cnJlbnRfY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIGN1cnJlbnRfbm9kZXMgPSByb290LnhwYXRoKGN1cnJlbnRfeHBhdGgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBjdXJyZW50X25vZGVzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN1cnJlbnRfbm9kZSA9IGN1cnJlbnRfbm9kZXNbMF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgdGnhur9wIHRoZW8gKGZvbGxvd2luZy1zaWJsaW5nKQogICAgICAgICAgICAgICAgbmV4dF9jb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfY29uZGl0aW9ucy5hcHBlbmQoZidjb250YWlucyhAdGV4dCwgInt0ZXh0fSIpJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBuZXh0X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRhaW5zOgogICAgICAgICAgICAgICAgICAgICAgICBuZXh0X2NvbmRpdGlvbnMuYXBwZW5kKGYnY29udGFpbnMoQGNvbnRlbnQtZGVzYywgIntjb250ZW50X2Rlc2N9IiknKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgbmV4dF9jb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBuZXh0X2NvbmRpdGlvbnMuYXBwZW5kKGYnQGNsYXNzPSJ7Y2xhc3NfbmFtZX0iJykKICAgICAgICAgICAgICAgIGlmIHZpc2libGVfdG9fdXNlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3ZhbHVlID0gInRydWUiIGlmIHZpc2libGVfdG9fdXNlciBlbHNlICJmYWxzZSIKICAgICAgICAgICAgICAgICAgICBuZXh0X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHZpc2libGUtdG8tdXNlcj0ie3Zpc2libGVfdmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBhbmggZW0gdGnhur9wIHRoZW8KICAgICAgICAgICAgICAgIG5leHRfeHBhdGggPSAiZm9sbG93aW5nLXNpYmxpbmc6Om5vZGUiCiAgICAgICAgICAgICAgICBpZiBuZXh0X2NvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgbmV4dF94cGF0aCArPSAiWyIgKyAiIGFuZCAiLmpvaW4obmV4dF9jb25kaXRpb25zKSArICJdIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBuZXh0X25vZGVzID0gY3VycmVudF9ub2RlLnhwYXRoKG5leHRfeHBhdGgpCiAgICAgICAgICAgICAgICBpZiBuZXh0X25vZGVzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbGVtZW50X3RvX2RpY3QobmV4dF9ub2Rlc1swXSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IHRp4bq/cCB0aGVvIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgZ2V0X3ByZXZfZWxlbWVudF9pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgY3VycmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyAoYW5oIGVtKSBj4bunYSBlbGVtZW50IGhp4buHbiB04bqhaSB0cm9uZyBYTUwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgY3VycmVudF9lbGVtZW50OiBFbGVtZW50IGhp4buHbiB04bqhaSDEkeG7gyBsw6BtIG3hu5FjCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgZWxlbWVudCB0csaw4bubYyDEkcOzIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBlbGVtZW50IHRyxrDhu5tjIMSRw7MgY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogRWxlbWVudCB0csaw4bubYyDEkcOzIGhv4bq3YyBOb25lIG7hur91IGtow7RuZyB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIGlmIG5vdCB4bWxfY29udGVudCBvciBub3QgY3VycmVudF9lbGVtZW50OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgaGnhu4duIHThuqFpIHRyxrDhu5tjCiAgICAgICAgICAgICAgICBjdXJyZW50X2NvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gY3VycmVudF9lbGVtZW50Lml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgaWYga2V5IGluIFsndGV4dCcsICdjb250ZW50LWRlc2MnLCAncmVzb3VyY2UtaWQnLCAnY2xhc3MnLCAnYm91bmRzJywgJ3Zpc2libGUtdG8tdXNlciddOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHtrZXl9PSJ7dmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBjdXJyZW50X2NvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3VycmVudF94cGF0aCA9ICIvL25vZGVbIiArICIgYW5kICIuam9pbihjdXJyZW50X2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICBjdXJyZW50X25vZGVzID0gcm9vdC54cGF0aChjdXJyZW50X3hwYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgY3VycmVudF9ub2RlczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdXJyZW50X25vZGUgPSBjdXJyZW50X25vZGVzWzBdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBlbGVtZW50IHRyxrDhu5tjIMSRw7MgKHByZWNlZGluZy1zaWJsaW5nKQogICAgICAgICAgICAgICAgcHJldl9jb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZfY29uZGl0aW9ucy5hcHBlbmQoZidjb250YWlucyhAdGV4dCwgInt0ZXh0fSIpJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmV2X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRhaW5zOgogICAgICAgICAgICAgICAgICAgICAgICBwcmV2X2NvbmRpdGlvbnMuYXBwZW5kKGYnY29udGFpbnMoQGNvbnRlbnQtZGVzYywgIntjb250ZW50X2Rlc2N9IiknKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZfY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcHJldl9jb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBwcmV2X2NvbmRpdGlvbnMuYXBwZW5kKGYnQGNsYXNzPSJ7Y2xhc3NfbmFtZX0iJykKICAgICAgICAgICAgICAgIGlmIHZpc2libGVfdG9fdXNlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3ZhbHVlID0gInRydWUiIGlmIHZpc2libGVfdG9fdXNlciBlbHNlICJmYWxzZSIKICAgICAgICAgICAgICAgICAgICBwcmV2X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHZpc2libGUtdG8tdXNlcj0ie3Zpc2libGVfdmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBhbmggZW0gdHLGsOG7m2MgxJHDsyAobOG6pXkgY8OhaSBjdeG7kWkgY8O5bmcgdsOsIHByZWNlZGluZy1zaWJsaW5nIHRy4bqjIHbhu4EgdGhlbyB0aOG7qSB04buxIG5nxrDhu6NjKQogICAgICAgICAgICAgICAgcHJldl94cGF0aCA9ICJwcmVjZWRpbmctc2libGluZzo6bm9kZSIKICAgICAgICAgICAgICAgIGlmIHByZXZfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICBwcmV2X3hwYXRoICs9ICJbIiArICIgYW5kICIuam9pbihwcmV2X2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHByZXZfbm9kZXMgPSBjdXJyZW50X25vZGUueHBhdGgocHJldl94cGF0aCkKICAgICAgICAgICAgICAgIGlmIHByZXZfbm9kZXM6CiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBlbGVtZW50IGN14buRaSBjw7luZyB2w6wgcHJlY2VkaW5nLXNpYmxpbmcgdHLhuqMgduG7gSB0aGVvIHRo4bupIHThu7EgbmfGsOG7o2MKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZWxlbWVudF90b19kaWN0KHByZXZfbm9kZXNbLTFdKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyB24bubaSBseG1sOiB7ZX0iKQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIGdldF9uZXh0X2VsZW1lbnQoc2VsZiwgY3VycmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgdGnhur9wIHRoZW8gKGFuaCBlbSkgY+G7p2EgZWxlbWVudCBoaeG7h24gdOG6oWkgdHLDqm4gbcOgbiBow6xuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGN1cnJlbnRfZWxlbWVudDogRWxlbWVudCBoaeG7h24gdOG6oWkgxJHhu4MgbMOgbSBt4buRYwogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIGVsZW1lbnQgdGnhur9wIHRoZW8gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgZWxlbWVudCB0aeG6v3AgdGhlbyBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBlbGVtZW50IHRp4bq/cCB0aGVvIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBlbGVtZW50IHRp4bq/cCB0aGVvIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBFbGVtZW50IHRp4bq/cCB0aGVvIGhv4bq3YyBOb25lIG7hur91IGtow7RuZyB0w6xtIHRo4bqleQogICAgICAgICAgICAKICAgICAgICBFeGFtcGxlOgogICAgICAgICAgICAjIFTDrG0gYnV0dG9uIHRp4bq/cCB0aGVvIHNhdSBidXR0b24gaGnhu4duIHThuqFpCiAgICAgICAgICAgIGN1cnJlbnRfYnRuID0gaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJQcmV2aW91cyIpCiAgICAgICAgICAgIG5leHRfYnRuID0gaGVscGVyLmdldF9uZXh0X2VsZW1lbnQoY3VycmVudF9idG4sIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIpCiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0X25leHRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIGN1cnJlbnRfZWxlbWVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyLCBjb250YWlucykKCiAgICBkZWYgZ2V0X3ByZXZfZWxlbWVudChzZWxmLCBjdXJyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gZWxlbWVudCB0csaw4bubYyDEkcOzIChhbmggZW0pIGPhu6dhIGVsZW1lbnQgaGnhu4duIHThuqFpIHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBjdXJyZW50X2VsZW1lbnQ6IEVsZW1lbnQgaGnhu4duIHThuqFpIMSR4buDIGzDoG0gbeG7kWMKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBlbGVtZW50IHRyxrDhu5tjIMSRw7MgY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgZWxlbWVudCB0csaw4bubYyDEkcOzIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgZWxlbWVudCB0csaw4bubYyDEkcOzIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBFbGVtZW50IHRyxrDhu5tjIMSRw7MgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgICAgIAogICAgICAgIEV4YW1wbGU6CiAgICAgICAgICAgICMgVMOsbSBidXR0b24gdHLGsOG7m2MgxJHDsyB0csaw4bubYyBidXR0b24gaGnhu4duIHThuqFpCiAgICAgICAgICAgIGN1cnJlbnRfYnRuID0gaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJOZXh0IikKICAgICAgICAgICAgcHJldl9idG4gPSBoZWxwZXIuZ2V0X3ByZXZfZWxlbWVudChjdXJyZW50X2J0biwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuQnV0dG9uIikKICAgICAgICAiIiIKICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICByZXR1cm4gc2VsZi5nZXRfcHJldl9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgY3VycmVudF9lbGVtZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIsIGNvbnRhaW5zKQoKICAgIGRlZiBpc19lbGVtZW50X3NlbGVjdGVkKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyDEkcaw4bujYyBjaOG7jW4gaGF5IGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgic2VsZWN0ZWQiKSA9PSAidHJ1ZSIKCiAgICBkZWYgd2FpdF9mb3JfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgdGltZW91dDogaW50ID0gMzAsIAogICAgICAgICAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbDogaW50ID0gMSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIENo4budIMSR4bujaSBjaG8gxJHhur9uIGtoaSBt4buZdCBwaOG6p24gdOG7rSB4deG6pXQgaGnhu4duIHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIHRpbWVvdXQ6IFRo4budaSBnaWFuIGNo4budIHThu5FpIMSRYSAoZ2nDonkpCiAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBLaG/huqNuZyB0aOG7nWkgZ2lhbiBnaeG7r2EgY8OhYyBs4bqnbiBraeG7g20gdHJhIChnacOieSkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBQaOG6p24gdOG7rSB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSB0aW1lb3V0CiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgdGltZW91dDoKICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuZmluZF9lbGVtZW50KHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUsIHZpc2libGVfdG9fdXNlciwgY29udGFpbnMpCiAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgd2FpdF90b190YXBfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgdGltZW91dDogaW50ID0gMzAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbDogaW50ID0gMSwgZGVsYXlfYmVmb3JlX3RhcDogaW50ID0gMSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgZWxlbWVudCB4deG6pXQgaGnhu4duLCBkZWxheSBt4buZdCBraG/huqNuZyB0aOG7nWkgZ2lhbiwgcuG7k2kgdGFwIHbDoG8gZWxlbWVudAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgdGltZW91dDogVGjhu51pIGdpYW4gY2jhu50gdOG7kWkgxJFhIMSR4buDIHTDrG0gZWxlbWVudCAoZ2nDonkpCiAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBLaG/huqNuZyB0aOG7nWkgZ2lhbiBnaeG7r2EgY8OhYyBs4bqnbiBraeG7g20gdHJhIChnacOieSkKICAgICAgICAgICAgZGVsYXlfYmVmb3JlX3RhcDogVGjhu51pIGdpYW4gZGVsYXkgdHLGsOG7m2Mga2hpIHRhcCAoZ2nDonksIG3hurdjIMSR4buLbmggMSBnacOieSkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaOG7nSBlbGVtZW50IHh14bqldCBoaeG7h24KICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYud2FpdF9mb3JfZWxlbWVudCgKICAgICAgICAgICAgICAgIHRleHQ9dGV4dCwgCiAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2M9Y29udGVudF9kZXNjLCAKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPXJlc291cmNlX2lkLCAKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9Y2xhc3NfbmFtZSwKICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcj12aXNpYmxlX3RvX3VzZXIsIAogICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0LCAKICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsPWNoZWNrX2ludGVydmFsLAogICAgICAgICAgICAgICAgY29udGFpbnM9Y29udGFpbnMKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAjIFThuqFvIHRow7RuZyBiw6FvIGzhu5dpIGNoaSB0aeG6v3QKICAgICAgICAgICAgICAgIGNyaXRlcmlhID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQ6CiAgICAgICAgICAgICAgICAgICAgY3JpdGVyaWEuYXBwZW5kKGYidGV4dD0ne3RleHR9JyIpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgY3JpdGVyaWEuYXBwZW5kKGYiY29udGVudF9kZXNjPSd7Y29udGVudF9kZXNjfSciKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQ6CiAgICAgICAgICAgICAgICAgICAgY3JpdGVyaWEuYXBwZW5kKGYicmVzb3VyY2VfaWQ9J3tyZXNvdXJjZV9pZH0nIikKICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWU6CiAgICAgICAgICAgICAgICAgICAgY3JpdGVyaWEuYXBwZW5kKGYiY2xhc3NfbmFtZT0ne2NsYXNzX25hbWV9JyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNyaXRlcmlhX3N0ciA9ICIsICIuam9pbihjcml0ZXJpYSkgaWYgY3JpdGVyaWEgZWxzZSAia2jDtG5nIHjDoWMgxJHhu4tuaCIKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYiS2jDtG5nIHTDrG0gdGjhuqV5IGVsZW1lbnQgc2F1IHt0aW1lb3V0fXMgduG7m2kgdGnDqnUgY2jDrToge2NyaXRlcmlhX3N0cn0iCiAgICAgICAgICAgICAgICBwcmludChlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBEZWxheSB0csaw4bubYyBraGkgdGFwCiAgICAgICAgICAgIGlmIGRlbGF5X2JlZm9yZV90YXAgPiAwOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcChkZWxheV9iZWZvcmVfdGFwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUYXAgdsOgbyBlbGVtZW50CiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYudGFwX2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEga+G6v3QgcXXhuqMgdGFwCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mbyA9IFtdCiAgICAgICAgICAgICAgICBpZiB0ZXh0OgogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mby5hcHBlbmQoZiJ0ZXh0PSd7dGV4dH0nIikKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8uYXBwZW5kKGYiY29udGVudF9kZXNjPSd7Y29udGVudF9kZXNjfSciKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQ6CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9pbmZvLmFwcGVuZChmInJlc291cmNlX2lkPSd7cmVzb3VyY2VfaWR9JyIpCiAgICAgICAgICAgICAgICBpZiBjbGFzc19uYW1lOgogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mby5hcHBlbmQoZiJjbGFzc19uYW1lPSd7Y2xhc3NfbmFtZX0nIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxlbWVudF9zdHIgPSAiLCAiLmpvaW4oZWxlbWVudF9pbmZvKSBpZiBlbGVtZW50X2luZm8gZWxzZSAiZWxlbWVudCIKICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyB0YXAgdGjDoG5oIGPDtG5nIHbDoG8ge2VsZW1lbnRfc3RyfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGFwIGVsZW1lbnQ6IHtyZXN1bHQuZ2V0KCdtZXNzYWdlJywgJ0tow7RuZyB4w6FjIMSR4buLbmgnKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSB0cm9uZyB3YWl0X3RvX3RhcF9lbGVtZW50OiB7c3RyKGUpfSIKICAgICAgICAgICAgcHJpbnQoZXJyb3JfbXNnKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfdGV4dChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRleHQgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NvbnRlbnRfZGVzYyhzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGNvbnRlbnQtZGVzYyBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9yZXNvdXJjZV9pZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHJlc291cmNlLWlkIGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJyZXNvdXJjZS1pZCIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2xhc3Moc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBjbGFzcyBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2xhc3MiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2VuYWJsZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGvDrWNoIGhv4bqhdCBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImVuYWJsZWQiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NsaWNrYWJsZShzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgdGjhu4MgbmjhuqVwIHbDoG8ga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjbGlja2FibGUiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2ZvY3VzZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGZvY3VzIGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiZm9jdXNlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2hlY2tlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2MgY2jhu41uIGtow7RuZyAoY2hvIGNoZWNrYm94KQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2hlY2tlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfYm91bmRzKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBUdXBsZVtpbnQsIGludCwgaW50LCBpbnRdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHThu41hIMSR4buZIGJvdW5kcyBj4bunYSBwaOG6p24gdOG7rSBkxrDhu5tpIGThuqFuZyB0dXBsZSAoeDEsIHkxLCB4MiwgeTIpCiAgICAgICAgWOG7rSBsw70gY8OhYyB0csaw4budbmcgaOG7o3AgYm91bmRzIGtow7RuZyBo4bujcCBs4buHICjDom0sIDAsIGhv4bq3YyBmb3JtYXQgc2FpKQogICAgICAgICIiIgogICAgICAgIGJvdW5kcyA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiWzAsMF1bMCwwXSIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7rSBjw6FjIHBhdHRlcm4ga2jDoWMgbmhhdSDEkeG7gyBwYXJzZSBib3VuZHMKICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgciJcWygtP1xkKyksKC0/XGQrKVxdXFsoLT9cZCspLCgtP1xkKylcXSIsICAjIFBhdHRlcm4gaGnhu4duIHThuqFpLCBjaG8gcGjDqXAgc+G7kSDDom0KICAgICAgICAgICAgciIoLT9cZCspLCgtP1xkKyksKC0/XGQrKSwoLT9cZCspIiwgICAgICAgICAjIFBhdHRlcm46IHgxLHkxLHgyLHkyCiAgICAgICAgICAgIHIiXFsoLT9cZCspOygtP1xkKylcXVxbKC0/XGQrKTsoLT9cZCspXF0iICAgIyBQYXR0ZXJuIHbhu5tpIGThuqV1IDsKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUubWF0Y2gocGF0dGVybiwgYm91bmRzKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIHgxLCB5MSwgeDIsIHkyID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU+G7rWEgY2jhu69hIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hwogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7MgdOG7jWEgxJHhu5kgw6JtLCDEkWnhu4F1IGNo4buJbmgKICAgICAgICAgICAgICAgIGlmIHkxIDwgMCBvciB5MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogQm91bmRzIGPDsyB04buNYSDEkeG7mSB5IMOibTogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgICAgICAjIE7hur91IHkyIMOibSwgY8OzIHRo4buDIGVsZW1lbnQgbuG6sW0gdHLDqm4gdGhhbmggc3RhdHVzIGJhcgogICAgICAgICAgICAgICAgICAgIGlmIHkyIDwgMDoKICAgICAgICAgICAgICAgICAgICAgICAgIyDEkGnhu4F1IGNo4buJbmggxJHhu4MgZWxlbWVudCBjw7MgdGjhu4MgdGFwIMSRxrDhu6NjCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGFicyh5MiAtIHkxKSAgIyBDaGnhu4F1IGNhbyBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gbWF4KDAsIHkxKSAgIyDEkOG6o20gYuG6o28geTEgPj0gMAogICAgICAgICAgICAgICAgICAgICAgICB5MiA9IHkxICsgaGVpZ2h0ICAjIMSQ4bq3dCB5MiBkxrDGoW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyDEkWnhu4F1IGNo4buJbmggYm91bmRzIHRow6BuaDogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgeDEgPCAwIG9yIHgyIDwgMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBCb3VuZHMgY8OzIHThu41hIMSR4buZIHggw6JtOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgICAgICMgVMawxqFuZyB04buxIHbhu5tpIHgKICAgICAgICAgICAgICAgICAgICBpZiB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gYWJzKHgyIC0geDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gbWF4KDAsIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHgxICsgd2lkdGgKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIMSRaeG7gXUgY2jhu4luaCBib3VuZHMgdGjDoG5oOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgYm91bmRzIGjhu6NwIGzhu4cgc2F1IGtoaSDEkWnhu4F1IGNo4buJbmgKICAgICAgICAgICAgICAgIGlmIHgxIDwgeDIgYW5kIHkxIDwgeTIgYW5kIG5vdCAoeDEgPT0gMCBhbmQgeTEgPT0gMCBhbmQgeDIgPT0gMCBhbmQgeTIgPT0gMCk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh4MSwgeTEsIHgyLCB5MikKICAgICAgICAKICAgICAgICAjIE7hur91IGtow7RuZyBwYXJzZSDEkcaw4bujYyBob+G6t2MgdOG6pXQgY+G6oyBsw6AgMCwgdGjhu60gbOG6pXkgdOG7qyB0aHXhu5ljIHTDrW5oIGtow6FjCiAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogS2jDtG5nIHRo4buDIHBhcnNlIGJvdW5kcyAne2JvdW5kc30nIGPhu6dhIGVsZW1lbnQsIHRo4butIHBoxrDGoW5nIHBow6FwIGtow6FjLi4uIikKICAgICAgICAKICAgICAgICAjIFRo4butIGzhuqV5IHThu6sgY8OhYyB0aHXhu5ljIHTDrW5oIGtow6FjIG7hur91IGPDswogICAgICAgIHggPSBlbGVtZW50LmdldCgieCIsIDApCiAgICAgICAgeSA9IGVsZW1lbnQuZ2V0KCJ5IiwgMCkKICAgICAgICB3aWR0aCA9IGVsZW1lbnQuZ2V0KCJ3aWR0aCIsIDEwMCkgICMgRGVmYXVsdCB3aWR0aAogICAgICAgIGhlaWdodCA9IGVsZW1lbnQuZ2V0KCJoZWlnaHQiLCA1MCkgICMgRGVmYXVsdCBoZWlnaHQKICAgICAgICAKICAgICAgICBpZiB4IG9yIHkgb3Igd2lkdGggIT0gMTAwIG9yIGhlaWdodCAhPSA1MDogICMgQ8OzIMOtdCBuaOG6pXQgbeG7mXQgdGh14buZYyB0w61uaCBraMOhYyAwL2RlZmF1bHQKICAgICAgICAgICAgcmV0dXJuICh4LCB5LCB4ICsgd2lkdGgsIHkgKyBoZWlnaHQpCiAgICAgICAgCiAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogRWxlbWVudCBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4csIHPhu60gZOG7pW5nIHThu41hIMSR4buZIG3hurdjIMSR4buLbmgiKQogICAgICAgIHJldHVybiAoMCwgMCwgMTAwLCA1MCkgICMgRmFsbGJhY2sgYm91bmRzIG5o4buPCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jZW50ZXIoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IFR1cGxlW2ludCwgaW50XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB04buNYSDEkeG7mSB0cnVuZyB0w6JtIGPhu6dhIHBo4bqnbiB04butIHbhu5tpIHjhu60gbMO9IGzhu5dpIG7Dom5nIGNhbwogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICBwcmludCgiQ+G6o25oIGLDoW86IEVsZW1lbnQgbMOgIE5vbmUgaG/hurdjIHLhu5duZyIpCiAgICAgICAgICAgIHJldHVybiAoMCwgMCkKICAgICAgICAgICAgCiAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyhlbGVtZW50KQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBib3VuZHMgaOG7o3AgbOG7hwogICAgICAgIGlmIHgxID49IHgyIG9yIHkxID49IHkyOgogICAgICAgICAgICBib3VuZHNfc3RyID0gZWxlbWVudC5nZXQoImJvdW5kcyIsICIiKQogICAgICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBCb3VuZHMga2jDtG5nIGjhu6NwIGzhu4cgJ3tib3VuZHNfc3RyfSc6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hywgdHLhuqMgduG7gSB04buNYSDEkeG7mSBhbiB0b8OgbiDhu58gZ2nhu69hIG3DoG4gaMOsbmgKICAgICAgICAgICAgc2NyZWVuX3dpZHRoLCBzY3JlZW5faGVpZ2h0ID0gc2VsZi5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgICAgICBpZiBzY3JlZW5fd2lkdGggPiAwIGFuZCBzY3JlZW5faGVpZ2h0ID4gMDoKICAgICAgICAgICAgICAgIGNlbnRlcl94ID0gc2NyZWVuX3dpZHRoIC8vIDIKICAgICAgICAgICAgICAgIGNlbnRlcl95ID0gc2NyZWVuX2hlaWdodCAvLyAyCiAgICAgICAgICAgICAgICByZXR1cm4gKGNlbnRlcl94LCBjZW50ZXJfeSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiAoNTQwLCA5NjApICAjIFThu41hIMSR4buZIG3hurdjIMSR4buLbmggY2hvIG3DoG4gaMOsbmggMTA4MHgxOTIwCiAgICAgICAgCiAgICAgICAgY2VudGVyX3ggPSAoeDEgKyB4MikgLy8gMgogICAgICAgIGNlbnRlcl95ID0gKHkxICsgeTIpIC8vIDIKICAgICAgICAKICAgICAgICAjIFRow6ptIG3hu5l0IGNow7p0IHJhbmRvbSDEkeG7gyB0csOhbmggZGV0ZWN0aW9uICjCsTMgcGl4ZWxzKQogICAgICAgIGNlbnRlcl94ICs9IHJhbmRvbS5yYW5kaW50KC0zLCAzKQogICAgICAgIGNlbnRlcl95ICs9IHJhbmRvbS5yYW5kaW50KC0zLCAzKQogICAgICAgIAogICAgICAgICMgxJDhuqNtIGLhuqNvIHThu41hIMSR4buZIHRyb25nIHBo4bqhbSB2aSBtw6BuIGjDrG5oCiAgICAgICAgc2NyZWVuX3dpZHRoLCBzY3JlZW5faGVpZ2h0ID0gc2VsZi5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgIGlmIHNjcmVlbl93aWR0aCA+IDAgYW5kIHNjcmVlbl9oZWlnaHQgPiAwOgogICAgICAgICAgICBjZW50ZXJfeCA9IG1heCgxMCwgbWluKGNlbnRlcl94LCBzY3JlZW5fd2lkdGggLSAxMCkpICAjIE1hcmdpbiAxMHB4IHThu6sgYmnDqm4KICAgICAgICAgICAgY2VudGVyX3kgPSBtYXgoMTAsIG1pbihjZW50ZXJfeSwgc2NyZWVuX2hlaWdodCAtIDEwKSkKICAgICAgICAKICAgICAgICByZXR1cm4gKGNlbnRlcl94LCBjZW50ZXJfeSkKICAgIAogICAgZGVmIHRhcF9lbGVtZW50X2NlbnRlcihzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhuqFtIHbDoG8gcGjhuqduIHThu60gduG7m2kgdMOtbmggcmFuZG9tIChz4butIGThu6VuZyB0YXBfZWxlbWVudCBiw6puIHRyb25nKQogICAgICAgIE7hur91IGVsZW1lbnQgcXXDoSBuaOG7jyB0aMOsIG3hu5tpIGTDuW5nIGNlbnRlciwgbmfGsOG7o2MgbOG6oWkgc+G6vSB0YXAgcmFuZG9tCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIkVsZW1lbnQgbMOgIE5vbmUgaG/hurdjIHLhu5duZyJ9CiAgICAgICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHZpc2libGUtdG8tdXNlciB0csaw4bubYwogICAgICAgICAgICB2aXNpYmxlID0gZWxlbWVudC5nZXQoInZpc2libGUtdG8tdXNlciIsICJ0cnVlIikKICAgICAgICAgICAgaWYgdmlzaWJsZSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgcHJpbnQoIkPhuqNuaCBiw6FvOiBFbGVtZW50IGPDsyB2aXNpYmxlLXRvLXVzZXI9J2ZhbHNlJywgduG6q24gdGjhu60gdGFwLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgYm91bmRzIGPhu6dhIGVsZW1lbnQgxJHhu4Mga2nhu4NtIHRyYSBrw61jaCB0aMaw4bubYwogICAgICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IHNlbGYuZ2V0X2VsZW1lbnRfYm91bmRzKGVsZW1lbnQpCiAgICAgICAgICAgIHdpZHRoID0geDIgLSB4MQogICAgICAgICAgICBoZWlnaHQgPSB5MiAtIHkxCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGVsZW1lbnQgcXXDoSBuaOG7jyAoPCAyMHB4IHdpZHRoIGhv4bq3YyBoZWlnaHQpLCBkw7luZyBjZW50ZXIKICAgICAgICAgICAgaWYgd2lkdGggPCAyMCBvciBoZWlnaHQgPCAyMDoKICAgICAgICAgICAgICAgIHByaW50KGYiRWxlbWVudCBuaOG7jyAoe3dpZHRofXh7aGVpZ2h0fXB4KSwgc+G7rSBk4bulbmcgdGFwIGNlbnRlciIpCiAgICAgICAgICAgICAgICB4LCB5ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHThu41hIMSR4buZIGjhu6NwIGzhu4cKICAgICAgICAgICAgICAgIGlmIHggPD0gMCBhbmQgeSA8PSAwOgogICAgICAgICAgICAgICAgICAgIGJvdW5kc19zdHIgPSBlbGVtZW50LmdldCgiYm91bmRzIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgaWYgYm91bmRzX3N0ciBhbmQgYm91bmRzX3N0ciAhPSAiWzAsMF1bMCwwXSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcF9lbGVtZW50KGJvdW5kc19zdHIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiAiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCB04buNYSDEkeG7mSDEkeG7gyB0YXAifQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi50YXAoeCwgeSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRWxlbWVudCDEkeG7pyBs4bubbiwgc+G7rSBk4bulbmcgdGFwX2VsZW1lbnQgxJHhu4MgdGFwIHJhbmRvbQogICAgICAgICAgICAgICAgIyBwcmludChmIkVsZW1lbnQgxJHhu6cgbOG7m24gKHt3aWR0aH14e2hlaWdodH1weCksIHPhu60gZOG7pW5nIHRhcCByYW5kb20iKSAgIyBC4buPIGxvZyBuw6B5CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi50YXBfZWxlbWVudChlbGVtZW50KQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6IGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7c3RyKGUpfSJ9CiAgICAKICAgIGRlZiBsb25nX3ByZXNzKHNlbGYsIHg6IGludCwgeTogaW50LCBkdXJhdGlvbjogaW50ID0gMTAwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIGdp4buvIHThuqFpIHbhu4sgdHLDrSB4LHkgdHJvbmcgbeG7mXQga2hv4bqjbmcgdGjhu51pIGdpYW4KICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICJ4IjogeCwKICAgICAgICAgICAgInkiOiB5LAogICAgICAgICAgICAiZHVyYXRpb24iOiBkdXJhdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJsb25nX3ByZXNzIiwgcGFyYW1zPXBhcmFtcykKICAgIAogICAgZGVmIGxvbmdfcHJlc3NfZWxlbWVudChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSwgZHVyYXRpb246IGludCA9IDEwMDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBnaeG7ryB04bqhaSB0cnVuZyB0w6JtIGPhu6dhIHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgeCwgeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgcmV0dXJuIHNlbGYubG9uZ19wcmVzcyh4LCB5LCBkdXJhdGlvbikKICAgIAogICAgZGVmIHN3aXBlKHNlbGYsIHN0YXJ0X3g6IGludCwgc3RhcnRfeTogaW50LCBlbmRfeDogaW50LCBlbmRfeTogaW50LCAKICAgICAgICAgICAgIGR1cmF0aW9uOiBpbnQgPSA1MDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCB04burIMSRaeG7g20gKHN0YXJ0X3gsIHN0YXJ0X3kpIMSR4bq/biDEkWnhu4NtIChlbmRfeCwgZW5kX3kpCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAic3RhcnRfeCI6IHN0YXJ0X3gsCiAgICAgICAgICAgICJzdGFydF95Ijogc3RhcnRfeSwKICAgICAgICAgICAgImVuZF94IjogZW5kX3gsCiAgICAgICAgICAgICJlbmRfeSI6IGVuZF95LAogICAgICAgICAgICAiZHVyYXRpb24iOiBkdXJhdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZSIsIHBhcmFtcz1wYXJhbXMpCiAgICAKICAgIGRlZiBzd2lwZV9iZXR3ZWVuX2VsZW1lbnRzKHNlbGYsIHN0YXJ0X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kX2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IGludCA9IDUwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHThu6sgcGjhuqduIHThu60gc3RhcnRfZWxlbWVudCDEkeG6v24gcGjhuqduIHThu60gZW5kX2VsZW1lbnQKICAgICAgICAiIiIKICAgICAgICBzdGFydF94LCBzdGFydF95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoc3RhcnRfZWxlbWVudCkKICAgICAgICBlbmRfeCwgZW5kX3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihlbmRfZWxlbWVudCkKICAgICAgICByZXR1cm4gc2VsZi5zd2lwZShzdGFydF94LCBzdGFydF95LCBlbmRfeCwgZW5kX3ksIGR1cmF0aW9uKQogICAgCiAgICBkZWYgd2FpdF9mb3JfZWxlbWVudF90b19kaXNhcHBlYXIoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIHRpbWVvdXQ6IGludCA9IDMwLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG3hu5l0IHBo4bqnbiB04butIGJp4bq/biBt4bqldCBraOG7j2kgbcOgbiBow6xuaAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6CiAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmZpbmRfZWxlbWVudCh0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjb250YWlucz1jb250YWlucykKICAgICAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB3YWl0X2Zvcl9hbnlfZWxlbWVudChzZWxmLCBlbGVtZW50c190b19maW5kOiBMaXN0W0RpY3Rbc3RyLCBzdHJdXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IGludCA9IDMwLCBjaGVja19pbnRlcnZhbDogaW50ID0gMSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIENo4budIMSR4bujaSBjaG8gxJHhur9uIGtoaSBi4bqldCBr4buzIHBo4bqnbiB04butIG7DoG8gdHJvbmcgZGFuaCBzw6FjaCB4deG6pXQgaGnhu4duCiAgICAgICAgCiAgICAgICAgZWxlbWVudHNfdG9fZmluZCBsw6AgZGFuaCBzw6FjaCBjw6FjIGRpY3QgduG7m2kgY8OhYyBraMOzYTogdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6CiAgICAgICAgICAgIGZvciBlbGVtZW50X2NyaXRlcmlhIGluIGVsZW1lbnRzX3RvX2ZpbmQ6CiAgICAgICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5maW5kX2VsZW1lbnQoCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9jcml0ZXJpYS5nZXQoInRleHQiKSwgCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9jcml0ZXJpYS5nZXQoImNvbnRlbnRfZGVzYyIpLCAKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2NyaXRlcmlhLmdldCgicmVzb3VyY2VfaWQiKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIGdldF9zY3JlZW5fc2l6ZShzZWxmKSAtPiBUdXBsZVtpbnQsIGludF06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkga8OtY2ggdGjGsOG7m2MgbcOgbiBow6xuaCAod2lkdGgsIGhlaWdodCkKICAgICAgICAiIiIKICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICBpZiBkZXZpY2VfaW5mb1sic3RhdHVzIl0gPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICByZXR1cm4gKGRldmljZV9pbmZvWyJkYXRhIl1bInNjcmVlbl93aWR0aCJdLCBkZXZpY2VfaW5mb1siZGF0YSJdWyJzY3JlZW5faGVpZ2h0Il0pCiAgICAgICAgcmV0dXJuICgwLCAwKQogICAgCiAgICBkZWYgdGFrZV9zY3JlZW5zaG90KHNlbGYsIGZpbGVfcGF0aDogc3RyID0gTm9uZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu6VwIOG6o25oIG3DoG4gaMOsbmggdsOgIGzGsHUgdsOgbyBmaWxlX3BhdGggKG7hur91IMSRxrDhu6NjIGN1bmcgY+G6pXApCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0ge30KICAgICAgICBpZiBmaWxlX3BhdGg6CiAgICAgICAgICAgIHBhcmFtc1siZmlsZV9wYXRoIl0gPSBmaWxlX3BhdGgKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzY3JlZW5zaG90IiwgcGFyYW1zPXBhcmFtcykKICAgIAogICAgZGVmIGdldF9jdXJyZW50X2FjdGl2aXR5KHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0w6puIGFjdGl2aXR5IGhp4buHbiB04bqhaQogICAgICAgICIiIgogICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgIGlmIGRldmljZV9pbmZvWyJzdGF0dXMiXSA9PSAic3VjY2VzcyIgYW5kICJjdXJyZW50X2FjdGl2aXR5IiBpbiBkZXZpY2VfaW5mb1siZGF0YSJdOgogICAgICAgICAgICByZXR1cm4gZGV2aWNlX2luZm9bImRhdGEiXVsiY3VycmVudF9hY3Rpdml0eSJdCiAgICAgICAgcmV0dXJuICIiCiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9wYWNrYWdlKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0w6puIHBhY2thZ2UgaGnhu4duIHThuqFpCiAgICAgICAgIiIiCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImN1cnJlbnQtcGFja2FnZSIpCiAgICAgICAgaWYgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiByZXNwb25zZToKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJkYXRhIl0uZ2V0KCJwYWNrYWdlIiwgIiIpCiAgICAgICAgcmV0dXJuICIiCiAgICAKICAgIGRlZiBwcmVzc19lbnRlcihzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gbsO6dCBFbnRlciBi4bqxbmcgQURCIGtleWV2ZW50CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgICAgICBpZiBzZWxmLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu7FjIHRoaSBBREIga2V5ZXZlbnQgRU5URVIgKDY2KQogICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbInNoZWxsIiwgImlucHV0IiwgImtleWV2ZW50IiwgIjY2Il0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICB0ZXh0PVRydWUsCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJtZXNzYWdlIjogIsSQw6MgbmjhuqVuIEVudGVyIGLhurFuZyBBREIifQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBGYWxsYmFjayB24buBIEFQSSBu4bq/dSBraMO0bmcgY8OzIEFEQgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfZW50ZXIiKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuVGltZW91dEV4cGlyZWQ6CiAgICAgICAgICAgIHByaW50KCJUaW1lb3V0IGtoaSBn4butaSBBREIga2V5ZXZlbnQgRW50ZXIiKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19lbnRlciIpCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kgQURCIGtleWV2ZW50IEVudGVyOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19lbnRlciIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtow7RuZyB4w6FjIMSR4buLbmgga2hpIGfhu61pIEFEQiBrZXlldmVudCBFbnRlcjoge2V9IikKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfZW50ZXIiKQogICAgCiAgICBkZWYgcHJlc3NfYmFjayhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gbsO6dCBCYWNrCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfYmFjayIpCiAgICAKICAgIGRlZiBwcmVzc19ob21lKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IEhvbWUKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19ob21lIikKICAgIAogICAgZGVmIHByZXNzX3JlY2VudF9hcHBzKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IFJlY2VudCBBcHBzCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfcmVjZW50X2FwcHMiKQoKICAgIGRlZiBpc19hcHBfaW5zdGFsbGVkKHNlbGYsIHBhY2thZ2VfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIOG7qW5nIGThu6VuZyDEkcOjIMSRxrDhu6NjIGPDoGkgxJHhurd0IHRyw6puIHRoaeG6v3QgYuG7iyBjaMawYQogICAgICAgIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBhY2thZ2VfbmFtZTogVMOqbiBwYWNrYWdlIGPhu6dhIOG7qW5nIGThu6VuZyBj4bqnbiBraeG7g20gdHJhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Ug4bupbmcgZOG7pW5nIMSRw6MgY8OgaSDEkeG6t3QsIEZhbHNlIG7hur91IGNoxrBhCiAgICAgICAgIiIiCiAgICAgICAgIyDGr3UgdGnDqm4gc+G7rSBk4bulbmcgQURCIG7hur91IMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICBpZiBzZWxmLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIOG7qW5nIGThu6VuZyBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCBmInBtIGxpc3QgcGFja2FnZXMgfCBncmVwIC14IHBhY2thZ2U6e3BhY2thZ2VfbmFtZX0iXQogICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGPDsyBr4bq/dCBxdeG6oywg4bupbmcgZOG7pW5nIMSRw6MgxJHGsOG7o2MgY8OgaSDEkeG6t3QKICAgICAgICAgICAgICAgIHJldHVybiBwYWNrYWdlX25hbWUgaW4gcmVzdWx0LnN0ZG91dAogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3I6CiAgICAgICAgICAgICAgICAjIE7hur91IGzhu5dpIEFEQiwgc+G7rSBk4bulbmcgQVBJIEhUVFAKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIEhUVFAgQVBJCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImlzX2luc3RhbGxlZCIsIHsicGFja2FnZSI6IHBhY2thZ2VfbmFtZX0pCiAgICAgICAgaWYgcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJkYXRhIl0uZ2V0KCJpbnN0YWxsZWQiLCBGYWxzZSkKICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgIGRlZiBmaW5kX2VsZW1lbnRzKHNlbGYsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsIHRleHQ6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHBo4bqnbiB04butIHRoZW8gY2xhc3NfbmFtZSwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCBob+G6t2MgdmlzaWJsZS10by11c2VyCiAgICAgICAgxJDDonkgbMOgIG3hu5l0IHBoxrDGoW5nIHRo4bupYyB0aeG7h24gbOG7o2kga+G6v3QgaOG7o3AgZHVtcF9zY3JlZW5feG1sIHbDoCBmaW5kX2FsbF9lbGVtZW50c19pbl94bWwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgcGjhuqduIHThu60gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICAjIEzhuqV5IFhNTCBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIGZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCDEkeG7gyB0w6xtIGPDoWMgcGjhuqduIHThu60KICAgICAgICByZXR1cm4gc2VsZi5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICB0ZXh0PXRleHQsIAogICAgICAgICAgICBjb250ZW50X2Rlc2M9Y29udGVudF9kZXNjLCAKICAgICAgICAgICAgcmVzb3VyY2VfaWQ9cmVzb3VyY2VfaWQsCiAgICAgICAgICAgIGNsYXNzX25hbWU9Y2xhc3NfbmFtZSwKICAgICAgICAgICAgdmlzaWJsZV90b191c2VyPXZpc2libGVfdG9fdXNlciwKICAgICAgICAgICAgY29udGFpbnM9Y29udGFpbnMKICAgICAgICApCgogICAgZGVmIG9wZW5fdXJsKHNlbGYsIHVybDogc3RyLCBwYWNrYWdlOiBzdHIgPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBN4bufIG3hu5l0IFVSTCB0csOqbiB0aGnhur90IGLhu4suIEjhu691IMOtY2ggxJHhu4MgbeG7nyBjw6FjIGxpbmsgbeG6oW5nIHjDoyBo4buZaSB0cuG7sWMgdGnhur9wLgogICAgICAgIFRyxrDhu5tjIGtoaSBt4bufIGxpbmsgc+G6vSBi4bqlbSBIb21lIHbDoCBjaOG7nSAyLTUgZ2nDonkuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdXJsOiBVUkwgY+G6p24gbeG7nyAodsOtIGThu6U6IGh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vdXNlcm5hbWUvKQogICAgICAgICAgICBwYWNrYWdlOiBQYWNrYWdlIG5hbWUgY+G7p2Eg4bupbmcgZOG7pW5nIMSR4buDIG3hu58gVVJMICh0w7l5IGNo4buNbikKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIHThu6sgc2VydmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIELGsOG7m2MgMTogQuG6pW0gbsO6dCBIb21lIHRyxrDhu5tjCiAgICAgICAgICAgIHByaW50KCJC4bqlbSBuw7p0IEhvbWUgdHLGsOG7m2Mga2hpIG3hu58gVVJMLi4uIikKICAgICAgICAgICAgc2VsZi5wcmVzc19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAyOiBDaOG7nSBuZ+G6q3Ugbmhpw6puIDItNSBnacOieQogICAgICAgICAgICBpbXBvcnQgcmFuZG9tCiAgICAgICAgICAgIGltcG9ydCB0aW1lCiAgICAgICAgICAgIHdhaXRfdGltZSA9IHJhbmRvbS51bmlmb3JtKDIsIDUpCiAgICAgICAgICAgIHByaW50KGYiQ2jhu50ge3dhaXRfdGltZTouMWZ9cyB0csaw4bubYyBraGkgbeG7nyBVUkwuLi4iKQogICAgICAgICAgICB0aW1lLnNsZWVwKHdhaXRfdGltZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAzOiBUaeG6v24gaMOgbmggbeG7nyBVUkwKICAgICAgICAgICAgcHJpbnQoZiJN4bufIFVSTDoge3VybH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBVUkwgZW5jb2RlIMSR4buDIHRyw6FuaCBs4buXaSB24bubaSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QKICAgICAgICAgICAgIyBDaOG7iSBlbmNvZGUgcGjhuqduIHNhdSBkb21haW4gxJHhu4MgZ2nhu68gbmd1ecOqbiBwcm90b2NvbCB2w6AgZG9tYWluCiAgICAgICAgICAgIGlmICc6Ly8nIGluIHVybDoKICAgICAgICAgICAgICAgIHBhcnRzID0gdXJsLnNwbGl0KCc6Ly8nLCAxKQogICAgICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA9PSAyOgogICAgICAgICAgICAgICAgICAgIHByb3RvY29sID0gcGFydHNbMF0KICAgICAgICAgICAgICAgICAgICByZW1haW5pbmcgPSBwYXJ0c1sxXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICcvJyBpbiByZW1haW5pbmc6CiAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbl9wYXJ0cyA9IHJlbWFpbmluZy5zcGxpdCgnLycsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbiA9IGRvbWFpbl9wYXJ0c1swXQogICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gZG9tYWluX3BhcnRzWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICMgRW5jb2RlIHBhdGggcGFydCwgbmjGsG5nIGdp4buvIG5ndXnDqm4gY8OhYyBrw70gdOG7sSBhbiB0b8OgbgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3BhdGggPSBxdW90ZShwYXRoLCBzYWZlPScvQDo/I1tdISQmXCcoKSorLDs9JykKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlZF91cmwgPSBmIntwcm90b2NvbH06Ly97ZG9tYWlufS97ZW5jb2RlZF9wYXRofSIKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3VybCA9IHVybCAgIyBDaOG7iSBjw7MgZG9tYWluLCBraMO0bmcgY+G6p24gZW5jb2RlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGVuY29kZWRfdXJsID0gdXJsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEtow7RuZyBjw7MgcHJvdG9jb2wsIGVuY29kZSB0b8OgbiBi4buZCiAgICAgICAgICAgICAgICBlbmNvZGVkX3VybCA9IHF1b3RlKHVybCwgc2FmZT0nL0A6PyNbXSEkJlwnKCkqKyw7PScpCiAgICAgICAgICAgIAogICAgICAgICAgICBwYXJhbXMgPSB7InVybCI6IGVuY29kZWRfdXJsfQogICAgICAgICAgICBpZiBwYWNrYWdlOgogICAgICAgICAgICAgICAgcGFyYW1zWyJwYWNrYWdlIl0gPSBwYWNrYWdlCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoIm9wZW5fdXJsIiwgcGFyYW1zPXBhcmFtcykKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBlbmNvZGUgVVJMOiB7ZX0iKQogICAgICAgICAgICAjIEZhbGxiYWNrOiBn4butaSBVUkwgZ+G7kWMgbuG6v3UgY8OzIGzhu5dpIGVuY29kZQogICAgICAgICAgICBwYXJhbXMgPSB7InVybCI6IHVybH0KICAgICAgICAgICAgaWYgcGFja2FnZToKICAgICAgICAgICAgICAgIHBhcmFtc1sicGFja2FnZSJdID0gcGFja2FnZQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJvcGVuX3VybCIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIGdldF9jbGlwYm9hcmQoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IG7hu5lpIGR1bmcgY2xpcGJvYXJkIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBO4buZaSBkdW5nIGNsaXBib2FyZCBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3Uga2jDtG5nIGPDsyBu4buZaSBkdW5nCiAgICAgICAgIiIiCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImNsaXBib2FyZCIpCiAgICAgICAgaWYgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kIHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoImhhc19jb250ZW50Iik6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdWyJjbGlwYm9hcmRfdGV4dCJdCiAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIHN3aXBlX2xlZnQoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHNhbmcgdHLDoWkgKHThu5FpIMawdSBjaG8gbmfDs24gY8OhaSB0YXkgcGjhuqNpKQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX2xlZnQiKQoKICAgIGRlZiBzd2lwZV9yaWdodChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgc2FuZyBwaOG6o2kgKHThu5FpIMawdSBjaG8gbmfDs24gY8OhaSB0YXkgcGjhuqNpKQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX3JpZ2h0IikKCiAgICBkZWYgaXNfaW5zdGFsbGVkKHNlbGYsIHBhY2thZ2U6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBoYXkga2jDtG5nIChkw7luZyBBUEkgbeG7m2kpCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGFja2FnZTogVMOqbiBwYWNrYWdlIGPhu6dhIOG7qW5nIGThu6VuZwogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGRpY3Q6IEvhur90IHF14bqjIGtp4buDbSB0cmEKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpc19pbnN0YWxsZWQiLCBwYXJhbXM9eyJwYWNrYWdlIjogcGFja2FnZX0pCgogICAgZGVmIHNldHVwX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBjaG8gcGhpw6puIGzDoG0gdmnhu4djCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSB24bubaSBjw6FjIHRyxrDhu51uZzoKICAgICAgICAgICAgICAgIC0gaWQ6IElEIGPhu6dhIHByb3h5CiAgICAgICAgICAgICAgICAtIHR5cGU6IExv4bqhaSBwcm94eSAocHBvZSwgaHR0cCwgc29ja3M1LCBldGMuKQogICAgICAgICAgICAgICAgLSBob3N0OiDEkOG7i2EgY2jhu4kgc2VydmVyIHByb3h5CiAgICAgICAgICAgICAgICAtIHBvcnQ6IFBvcnQgY+G7p2EgcHJveHkKICAgICAgICAgICAgICAgIC0gdXNlcm5hbWU6IFVzZXJuYW1lIChu4bq/dSBjw7MpCiAgICAgICAgICAgICAgICAtIHBhc3N3b3JkOiBQYXNzd29yZCAobuG6v3UgY8OzKQogICAgICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aGnhur90IGzhuq1wIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcm94eV90eXBlID0gcHJveHlfY29uZmlnLmdldCgidHlwZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcHJveHlfdHlwZSA9PSAicHBvZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fc2V0dXBfcHBvZV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSBpbiBbImh0dHAiLCAiaHR0cHMiXToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZXR1cF9odHRwX3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxpZiBwcm94eV90eXBlID09ICJzb2NrczUiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NldHVwX3NvY2tzNV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIkxv4bqhaSBwcm94eSBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7ozoge3Byb3h5X3R5cGV9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aGnhur90IGzhuq1wIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3NldHVwX3Bwb2VfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaGnhur90IGzhuq1wIHByb3h5IFBQUG9FCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBQUFBvRQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBob3N0ID0gcHJveHlfY29uZmlnLmdldCgic2VydmVyX2lwIikKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJwcm94eV9pZCIpCiAgICAgICAgICAgIHByb3h5X25hbWUgPSBwcm94eV9jb25maWcuZ2V0KCJuYW1lIikKICAgICAgICAgICAgaWYgbm90IGhvc3Q6CiAgICAgICAgICAgICAgICBwcmludCgiVGhp4bq/dSB0aMO0bmcgdGluIGhvc3QgY2hvIHByb3h5IFBQUG9FIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJIHJlZ2lzdGVyIHRyxrDhu5tjCiAgICAgICAgICAgIHJlZ2lzdGVyX3VybCA9IGYiaHR0cDovL3tob3N0fS9yZWdpc3RlciIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBkZXZpY2UgaW5mbwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgbG9jYWxfaXAgPSAiIgogICAgICAgICAgICBpZiBkZXZpY2VfaW5mby5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9jYWxfaXAgPSBkZXZpY2VfaW5mb1siZGF0YSJdLmdldCgibG9jYWxfaXAiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlZ2lzdGVyX2RhdGEgPSB7Im5hbWUiOiBwcm94eV9uYW1lfQogICAgICAgICAgICAgICAgaWYgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJfZGF0YVsibG9jYWxfaXAiXSA9IGxvY2FsX2lwCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZWdpc3Rlcl9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJfdXJsLCAKICAgICAgICAgICAgICAgICAgICBqc29uPXJlZ2lzdGVyX2RhdGEsIAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9LCAKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiByZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIMSRxINuZyBrw70gdGjDoG5oIGPDtG5nIHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge2hvc3R9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHEg25nIGvDvSB24bubaSBwcm94eSBQUFBvRSBzZXJ2ZXI6IHtyZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJLaMO0bmcgdGjhu4Mga+G6v3QgbuG7kWkgxJHhur9uIHByb3h5IFBQUG9FIHNlcnZlciB7aG9zdH06IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IElQIHByb3h5CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNldF9wcm94eV9pcChwcm94eV9jb25maWcpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eSBQUFBvRToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9zZXR1cF9odHRwX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBIVFRQL0hUVFBTCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBIVFRQCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhu5FpIHbhu5tpIEhUVFAgcHJveHksIGNo4buJIGPhuqduIHJlc2V0IElQCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNldF9wcm94eV9pcChwcm94eV9jb25maWcpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eSBIVFRQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3NldHVwX3NvY2tzNV9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgU09DS1M1CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBTT0NLUzUKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG7kWkgduG7m2kgU09DS1M1IHByb3h5LCBjaOG7iSBj4bqnbiByZXNldCBJUAogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRoaeG6v3QgbOG6rXAgcHJveHkgU09DS1M1OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3Jlc2V0X3Byb3h5X2lwKHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUmVzZXQgSVAgcHJveHkgKGxvZ2ljIGPFqSDEkcaw4bujYyBjaHV54buDbiB2w6BvIMSRw6J5KQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBMb2dpYyByZXNldCBJUCBwcm94eSBz4bq9IMSRxrDhu6NjIGltcGxlbWVudCB0w7l5IHRoZW8gbG/huqFpIHByb3h5CiAgICAgICAgICAgICMgSGnhu4duIHThuqFpIHJldHVybiBUcnVlIMSR4buDIGtow7RuZyBibG9jayB3b3JrZmxvdwogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgcHJveHlfdHlwZSA9IHByb3h5X2NvbmZpZy5nZXQoInR5cGUiLCAidW5rbm93biIpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChmIlJlc2V0IElQIGNobyBwcm94eSB7cHJveHlfaWR9ICh0eXBlOiB7cHJveHlfdHlwZX0pIikKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyB0aMO0bmcgdGluIHJlc2V0IElQCiAgICAgICAgICAgIHJlc2V0X2lwX2xpbmsgPSBwcm94eV9jb25maWcuZ2V0KCJsaW5rX3Jlc2V0X2lwIikKICAgICAgICAgICAgcHBvZV9uYW1lID0gcHJveHlfY29uZmlnLmdldCgicHBvZV9uYW1lIikKCiAgICAgICAgICAgIGlmIHJlc2V0X2lwX2xpbmsgYW5kIHBwb2VfbmFtZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIEfhu61pIFBPU1QgcmVxdWVzdCDEkeG7gyByZXNldCBJUAogICAgICAgICAgICAgICAgICAgIHJlc2V0X2RhdGEgPSB7InBwb2VfbmFtZSI6IHBwb2VfbmFtZX0KICAgICAgICAgICAgICAgICAgICByZXNldF9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0X2lwX2xpbmssIAogICAgICAgICAgICAgICAgICAgICAgICBqc29uPXJlc2V0X2RhdGEsIAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzZXRfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgcmVzZXQgSVAgdGjDoG5oIGPDtG5nIGNobyBwcm94eSB7cHBvZV9uYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgcmVzZXQgSVA6IEhUVFAge3Jlc2V0X3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgZ+G7rWkgcmVxdWVzdCByZXNldCBJUDoge2V9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJUaGnhur91IHRow7RuZyB0aW4gbGlua19yZXNldF9pcCBob+G6t2MgcHJveHlfbmFtZSIpCiAgICAgICAgICAgICMgVE9ETzogSW1wbGVtZW50IGxvZ2ljIHJlc2V0IElQIGPhu6UgdGjhu4MgY2hvIHThu6tuZyBsb+G6oWkgcHJveHkKICAgICAgICAgICAgIyBWw60gZOG7pTogZ+G7jWkgQVBJIHJlc2V0IElQLCBob+G6t2MgdGjhu7FjIGhp4buHbiBjw6FjIGzhu4duaCBj4bqnbiB0aGnhur90CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHJlc2V0IElQIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgcmVzZXRfcHJveHlfaXAoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBQaMawxqFuZyB0aOG7qWMgcHVibGljIMSR4buDIHJlc2V0IElQIHByb3h5ICjEkeG7gyB0xrDGoW5nIHRow61jaCB24bubaSBjb2RlIGPFqSkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQoKICAgIGRlZiB1bnJlZ2lzdGVyX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0gPSBOb25lKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEjhu6d5IMSRxINuZyBrw70gcHJveHkgc2F1IGtoaSBz4butIGThu6VuZyB4b25nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSAodMO5eSBjaOG7jW4sIGPDsyB0aOG7gyBs4bqleSB04burIGRhdGFiYXNlIG7hur91IGtow7RuZyB0cnV54buBbikKICAgICAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgaOG7p3kgxJHEg25nIGvDvSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdHJ1eeG7gW4gcHJveHlfY29uZmlnLCBjw7MgdGjhu4MgbOG6pXkgdOG7qyBkYXRhYmFzZSBob+G6t2MgY29udGV4dCBoaeG7h24gdOG6oWkKICAgICAgICAgICAgaWYgbm90IHByb3h5X2NvbmZpZzoKICAgICAgICAgICAgICAgIHByaW50KCJLaMO0bmcgY8OzIHByb3h5IGNvbmZpZyDEkeG7gyB1bnJlZ2lzdGVyIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlICAjIENvaSBuaMawIHRow6BuaCBjw7RuZyBu4bq/dSBraMO0bmcgY8OzIGfDrCDEkeG7gyB1bnJlZ2lzdGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcHJveHlfdHlwZSA9IHByb3h5X2NvbmZpZy5nZXQoInR5cGUiLCAiIikubG93ZXIoKQogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHByb3h5X3R5cGUgPT0gInBwb2UiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3VucmVnaXN0ZXJfcHBvZV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSBpbiBbImh0dHAiLCAiaHR0cHMiXToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl91bnJlZ2lzdGVyX2h0dHBfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbGlmIHByb3h5X3R5cGUgPT0gInNvY2tzNSI6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdW5yZWdpc3Rlcl9zb2NrczVfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJMb+G6oWkgcHJveHkga2jDtG5nIGPhuqduIHVucmVnaXN0ZXIgaG/hurdjIGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujOiB7cHJveHlfdHlwZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF91bnJlZ2lzdGVyX3Bwb2VfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IFBQUG9FCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBQUFBvRQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBob3N0ID0gcHJveHlfY29uZmlnLmdldCgic2VydmVyX2lwIikKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJwcm94eV9pZCIpCiAgICAgICAgICAgIHByb3h5X25hbWUgPSBwcm94eV9jb25maWcuZ2V0KCJuYW1lIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBob3N0OgogICAgICAgICAgICAgICAgcHJpbnQoIlRoaeG6v3UgdGjDtG5nIHRpbiBob3N0IGNobyBwcm94eSBQUFBvRSwgYuG7jyBxdWEgdW5yZWdpc3RlciIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJIHVucmVnaXN0ZXIKICAgICAgICAgICAgdW5yZWdpc3Rlcl91cmwgPSBmImh0dHA6Ly97aG9zdH0vdW5yZWdpc3RlciIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBkZXZpY2UgaW5mbwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgbG9jYWxfaXAgPSAiIgogICAgICAgICAgICBpZiBkZXZpY2VfaW5mby5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9jYWxfaXAgPSBkZXZpY2VfaW5mb1siZGF0YSJdLmdldCgibG9jYWxfaXAiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJfZGF0YSA9IHsibmFtZSI6IHByb3h5X25hbWV9CiAgICAgICAgICAgICAgICBpZiBsb2NhbF9pcDoKICAgICAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyX2RhdGFbImxvY2FsX2lwIl0gPSBsb2NhbF9pcAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl91cmwsIAogICAgICAgICAgICAgICAgICAgIGpzb249dW5yZWdpc3Rlcl9kYXRhLCAKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwgCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgdW5yZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIGjhu6d5IMSRxINuZyBrw70gdGjDoG5oIGPDtG5nIHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge2hvc3R9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge3VucmVnaXN0ZXJfcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIMSR4bq/biBwcm94eSBQUFBvRSBzZXJ2ZXIge2hvc3R9IMSR4buDIHVucmVnaXN0ZXI6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eSBQUFBvRToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF91bnJlZ2lzdGVyX2h0dHBfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IEhUVFAvSFRUUFMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IEhUVFAKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBIVFRQIHByb3h5IHRoxrDhu51uZyBraMO0bmcgY+G6p24gdW5yZWdpc3RlciDEkeG6t2MgYmnhu4d0CiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICBwcmludChmIkjhu6d5IMSRxINuZyBrw70gcHJveHkgSFRUUCB7cHJveHlfaWR9IChraMO0bmcgY+G6p24gdGhhbyB0w6FjIMSR4bq3YyBiaeG7h3QpIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHByb3h5IEhUVFA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfdW5yZWdpc3Rlcl9zb2NrczVfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IFNPQ0tTNQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgU09DS1M1CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgU09DS1M1IHByb3h5IHRoxrDhu51uZyBraMO0bmcgY+G6p24gdW5yZWdpc3RlciDEkeG6t2MgYmnhu4d0CiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICBwcmludChmIkjhu6d5IMSRxINuZyBrw70gcHJveHkgU09DS1M1IHtwcm94eV9pZH0gKGtow7RuZyBj4bqnbiB0aGFvIHTDoWMgxJHhurdjIGJp4buHdCkiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGjhu6d5IMSRxINuZyBrw70gcHJveHkgU09DS1M1OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZGVidWdfZWxlbWVudF9ib3VuZHMoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgRGVidWcgdGjDtG5nIHRpbiBib3VuZHMgY+G7p2EgZWxlbWVudCDEkeG7gyBraeG7g20gdHJhIHhlbSBjw7MgdGFwIMSRxrDhu6NjIGtow7RuZwogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICBwcmludCgiREVCVUc6IEVsZW1lbnQgaXMgTm9uZSBvciBlbXB0eSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBwcmludCgiPT09IERFQlVHIEVMRU1FTlQgQk9VTkRTID09PSIpCiAgICAgICAgYm91bmRzX3N0ciA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiIikKICAgICAgICBwcmludChmIk9yaWdpbmFsIGJvdW5kcyBzdHJpbmc6ICd7Ym91bmRzX3N0cn0nIikKICAgICAgICAKICAgICAgICAjIFRlc3QgZ2V0X2VsZW1lbnRfYm91bmRzCiAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyhlbGVtZW50KQogICAgICAgIHByaW50KGYiUGFyc2VkIGJvdW5kczogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAKICAgICAgICAjIFRlc3QgZ2V0X2VsZW1lbnRfY2VudGVyCiAgICAgICAgY2VudGVyX3gsIGNlbnRlcl95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICBwcmludChmIkNhbGN1bGF0ZWQgY2VudGVyOiAoe2NlbnRlcl94fSwge2NlbnRlcl95fSkiKQogICAgICAgIAogICAgICAgICMgVGVzdCB24bubaSB2w60gZOG7pSBj4bulIHRo4buDCiAgICAgICAgcHJpbnQoIlxuLS0tIFRlc3Rpbmcgd2l0aCBleGFtcGxlIGJvdW5kcyBbMzYsMF1bODQsLTMwXSAtLS0iKQogICAgICAgIHRlc3RfZWxlbWVudCA9IHsiYm91bmRzIjogIlszNiwwXVs4NCwtMzBdIiwgImNvbnRlbnQtZGVzYyI6ICJUw6xtIGtp4bq/bSJ9CiAgICAgICAgCiAgICAgICAgdGVzdF94MSwgdGVzdF95MSwgdGVzdF94MiwgdGVzdF95MiA9IHNlbGYuZ2V0X2VsZW1lbnRfYm91bmRzKHRlc3RfZWxlbWVudCkKICAgICAgICBwcmludChmIlRlc3QgcGFyc2VkIGJvdW5kczogKHt0ZXN0X3gxfSwge3Rlc3RfeTF9LCB7dGVzdF94Mn0sIHt0ZXN0X3kyfSkiKQogICAgICAgIAogICAgICAgIHRlc3RfY2VudGVyX3gsIHRlc3RfY2VudGVyX3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcih0ZXN0X2VsZW1lbnQpCiAgICAgICAgcHJpbnQoZiJUZXN0IGNhbGN1bGF0ZWQgY2VudGVyOiAoe3Rlc3RfY2VudGVyX3h9LCB7dGVzdF9jZW50ZXJfeX0pIikKICAgICAgICAKICAgICAgICAjIFRlc3QgdGFwX2VsZW1lbnQKICAgICAgICBwcmludCgiXG4tLS0gVGVzdGluZyB0YXBfZWxlbWVudCAtLS0iKQogICAgICAgIHJlc3VsdCA9IHNlbGYudGFwX2VsZW1lbnQodGVzdF9lbGVtZW50KQogICAgICAgIHByaW50KGYiVGFwIHJlc3VsdDoge3Jlc3VsdH0iKQogICAgICAgIAogICAgICAgIHByaW50KCI9PT0gRU5EIERFQlVHID09PSIpCgogICAgZGVmIGRvd25sb2FkX2ltYWdlKHNlbGYsIHNlcnZlcjogc3RyID0gImh0dHA6Ly9pbWcuZG5kdmluYS5jb20iLCBjb3VudDogaW50ID0gMSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBU4bqjaSDhuqNuaCB04burIHNlcnZlciB24buBIHRoaeG6v3QgYuG7iyB0aMO0bmcgcXVhIGhlbHBlciBzZXJ2aWNlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2VydmVyOiBTZXJ2ZXIgxJHhu4thIGNo4buJIChu4bq/dSBOb25lIHRow6wgxJHhu41jIHThu6sgY29uZmlnIGRiLCBt4bq3YyDEkeG7i25oICJodHRwOi8vaW1nLmRuZHZpbmEuY29tIikKICAgICAgICAgICAgY291bnQ6IFPhu5EgbMaw4bujbmcg4bqjbmggY+G6p24gdOG6o2kgKG3hurdjIMSR4buLbmggMSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB04bqjaSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBzZXJ2ZXIgdOG7qyBkYXRhYmFzZSBu4bq/dSBraMO0bmcgdHJ1eeG7gW4gdsOgbwogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gc2VydmVyIGPDsyBwcm90b2NvbAogICAgICAgICAgICBpZiBub3Qgc2VydmVyLnN0YXJ0c3dpdGgoKCJodHRwOi8vIiwgImh0dHBzOi8vIikpOgogICAgICAgICAgICAgICAgc2VydmVyID0gZiJodHRwOi8ve3NlcnZlcn0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDonkgZOG7sW5nIFVSTCBk4buxYSB0csOqbiBz4buRIGzGsOG7o25nIOG6o25oCiAgICAgICAgICAgIGlmIGNvdW50ID09IDE6CiAgICAgICAgICAgICAgICAjIFRyxrDhu51uZyBo4bujcCB04bqjaSAxIOG6o25oIC0gc+G7rSBk4bulbmcgZW5kcG9pbnQgcmFuZG9tLWF2YXRhcgogICAgICAgICAgICAgICAgaW1hZ2VfdXJsID0gZiJ7c2VydmVyfS9yYW5kb20tYXZhdGFyIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUcsaw4budbmcgaOG7o3AgdOG6o2kgbmhp4buBdSDhuqNuaCAtIHPhu60gZOG7pW5nIGVuZHBvaW50IGdldC1zaW1pbGFyLWltYWdlcwogICAgICAgICAgICAgICAgaW1hZ2VfdXJsID0gZiJ7c2VydmVyfS9nZXQtc2ltaWxhci1pbWFnZXM/Y291bnQ9e2NvdW50fSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU+G7rSBk4bulbmcgX21ha2VfcmVxdWVzdCDEkeG7gyB04bqtbiBk4bulbmcgY8ahIGNo4bq/IHJldHJ5IHbDoCBlcnJvciBoYW5kbGluZyBjw7Mgc+G6tW4KICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJkb3dubG9hZC1pbWFnZSIsIHBhcmFtcz17InVybCI6IGltYWdlX3VybH0pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFjhu60gbMO9IHJlc3BvbnNlIGZvcm1hdCB0aOG7sWMgdOG6vwogICAgICAgICAgICAjIFJlc3BvbnNlOiB7ImRhdGEiOiB7InN1Y2Nlc3MiOiB0cnVlLCAibWVzc2FnZSI6ICIuLi4iLCAiZGF0YSI6IHsuLi59fSwgIm1lc3NhZ2UiOiAiLi4uIiwgInN0YXR1cyI6ICJzdWNjZXNzIn0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXN1bHQsIGRpY3QpIGFuZCByZXN1bHQuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgZGF0YS5zdWNjZXNzIHbDoCBkYXRhLm1lc3NhZ2UKICAgICAgICAgICAgICAgIGRhdGFfc2VjdGlvbiA9IHJlc3VsdC5nZXQoImRhdGEiLCB7fSkKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBkYXRhX3NlY3Rpb24uZ2V0KCJzdWNjZXNzIiwgRmFsc2UpCiAgICAgICAgICAgICAgICBtZXNzYWdlID0gZGF0YV9zZWN0aW9uLmdldCgibWVzc2FnZSIsICIiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyBhbmQgInRow6BuaCBjw7RuZyIgaW4gbWVzc2FnZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdOG6o2kg4bqjbmg6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKIyBUZXN0IGZ1bmN0aW9uIGZvciB0aGUgcHJvYmxlbWF0aWMgZWxlbWVudApkZWYgdGVzdF9wcm9ibGVtYXRpY19lbGVtZW50KCk6CiAgICAiIiIKICAgIFRlc3QgZnVuY3Rpb24gxJHhu4Mga2nhu4NtIHRyYSBlbGVtZW50IGPDsyBib3VuZHMgw6JtCiAgICAiIiIKICAgIGhlbHBlciA9IEhlbHBlclNlcnZpY2UoKQogICAgCiAgICAjIEVsZW1lbnQgdOG7qyB2w60gZOG7pSBj4bunYSB1c2VyCiAgICBwcm9ibGVtYXRpY19lbGVtZW50ID0gewogICAgICAgICJjbGFzcyI6ICJhbmRyb2lkLndpZGdldC5JbWFnZVZpZXciLAogICAgICAgICJwYWNrYWdlIjogImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbCIsIAogICAgICAgICJyZXNvdXJjZS1pZCI6ICJjb20uc3MuYW5kcm9pZC51Z2MudHJpbGw6aWQvZGVsIiwKICAgICAgICAidGV4dCI6ICJudWxsIiwKICAgICAgICAiY29udGVudC1kZXNjIjogIlTDrG0ga2nhur9tIiwKICAgICAgICAiYm91bmRzIjogIlszNiwwXVs4NCwtMzBdIiwKICAgICAgICAiY2xpY2thYmxlIjogImZhbHNlIiwKICAgICAgICAiZW5hYmxlZCI6ICJ0cnVlIiwKICAgICAgICAidmlzaWJsZS10by11c2VyIjogImZhbHNlIgogICAgfQogICAgCiAgICBwcmludCgiVGVzdGluZyBwcm9ibGVtYXRpYyBlbGVtZW50IHdpdGggYm91bmRzIFszNiwwXVs4NCwtMzBdIikKICAgIGhlbHBlci5kZWJ1Z19lbGVtZW50X2JvdW5kcyhwcm9ibGVtYXRpY19lbGVtZW50KQogICAgCiAgICBwcmludCgiXG5UcnlpbmcgdG8gdGFwIHRoZSBlbGVtZW50Li4uIikKICAgIHJlc3VsdCA9IGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocHJvYmxlbWF0aWNfZWxlbWVudCkKICAgIHByaW50KGYiRmluYWwgdGFwIHJlc3VsdDoge3Jlc3VsdH0iKQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHRlc3RfcHJvYmxlbWF0aWNfZWxlbWVudCgpCiAgICAKICAgICMgVsOtIGThu6Ugc+G7rSBk4bulbmcKICAgIGhlbHBlciA9IEhlbHBlclNlcnZpY2UoKQogICAgCiAgICAjIEzhuqV5IGvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmgKICAgIHdpZHRoLCBoZWlnaHQgPSBoZWxwZXIuZ2V0X3NjcmVlbl9zaXplKCkKICAgIHByaW50KGYiS8OtY2ggdGjGsOG7m2MgbcOgbiBow6xuaDoge3dpZHRofXh7aGVpZ2h0fSIpCiAgICAKICAgICMgTeG7nyBUaWtUb2sKICAgIGhlbHBlci5vcGVuX2FwcCgiY29tLnNzLmFuZHJvaWQudWdjLnRyaWxsIikKICAgIAogICAgIyBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgbsO6dCAiVHJhbmcgY2jhu6ciIGhv4bq3YyBuw7p0ICJLaMOhbSBwaMOhIiB4deG6pXQgaGnhu4duCiAgICBlbGVtZW50c190b19maW5kID0gWwogICAgICAgIHsiY29udGVudF9kZXNjIjogIlRyYW5nIGNo4bunIn0sCiAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiS2jDoW0gcGjDoSJ9CiAgICBdCiAgICAKICAgIGVsZW1lbnQgPSBoZWxwZXIud2FpdF9mb3JfYW55X2VsZW1lbnQoZWxlbWVudHNfdG9fZmluZCkKICAgIAogICAgaWYgZWxlbWVudDoKICAgICAgICBwcmludChmIsSQw6MgdMOsbSB0aOG6pXkgcGjhuqduIHThu606IHtoZWxwZXIuZ2V0X2VsZW1lbnRfY29udGVudF9kZXNjKGVsZW1lbnQpfSIpCiAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgZWxzZToKICAgICAgICBwcmludCgiS2jDtG5nIHTDrG0gdGjhuqV5IHBo4bqnbiB04butIG7DoG8gc2F1IHRo4budaSBnaWFuIGNo4budIik=').decode('utf-8'))
