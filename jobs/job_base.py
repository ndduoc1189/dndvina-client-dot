import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgTGlzdCwgT3B0aW9uYWwsIENhbGxhYmxlCmZyb20gYWJjIGltcG9ydCBBQkMsIGFic3RyYWN0bWV0aG9kCmltcG9ydCB1dGlscwpmcm9tIHV0aWxzIGltcG9ydCBMb2dMZXZlbCwgTG9nZ2VyCmltcG9ydCB1cmxsaWIucGFyc2UKaW1wb3J0IHJhbmRvbQppbXBvcnQgY29uZmlnCiMgVOG6oW8gbG9nZ2VyIGNobyBCYXNlSm9iCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIkJhc2VKb2IiKQoKY2xhc3MgQmFzZUpvYihBQkMpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZT1Ob25lKToKICAgICAgICBzZWxmLmRiID0gZGJfc2VydmljZQogICAgICAgIHNlbGYuaGVscGVyID0gaGVscGVyX3NlcnZpY2UKICAgICAgICBzZWxmLmdvbGlrZV9zZXJ2aWNlID0gZ29saWtlX3NlcnZpY2UKICAgICAgICBzZWxmLmFwcF9wYWNrYWdlID0gIiIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gIiIKICAgICAgICAjIEjDoG0gc2xlZXAgbeG6t2MgxJHhu4tuaCBsw6AgdGltZS5zbGVlcAogICAgICAgIHNlbGYuX3NsZWVwX2Z1bmMgPSB0aW1lLnNsZWVwCiAgICAgICAgIyBU4bqhbyBsb2dnZXIgY2hvIGluc3RhbmNlIGPhu6UgdGjhu4MKICAgICAgICBzZWxmLmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoZiJKb2Iue3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpCiAgICAgICAgCiAgICAgICAgIyBQcm94eSBzZXJ2aWNlIHPhur0gxJHGsOG7o2Mgc2V0IHNhdSBraGkga2jhu59pIHThuqFvCiAgICAgICAgc2VsZi5wcm94eV9zZXJ2aWNlID0gTm9uZQogICAgICAgIAogICAgICAgICMgQXBwLXNwZWNpZmljIGNvbmZpZ3VyYXRpb24gY2FjaGUKICAgICAgICBzZWxmLl9hcHBfY29uZmlnX2NhY2hlID0gTm9uZQogICAgICAgIHNlbGYuX2NvbmZpZ19jYWNoZV90aW1lID0gMAogICAgICAgIHNlbGYuX2NvbmZpZ19jYWNoZV90dGwgPSAzMDAgICMgQ2FjaGUgNSBwaMO6dAogICAgICAgIAogICAgICAgICMgRGVmYXVsdCBjb25maWcgY2hvIGFwcCAoY8OzIHRo4buDIG92ZXJyaWRlIHRyb25nIHN1YmNsYXNzKQogICAgICAgIHNlbGYuX2RlZmF1bHRfY29uZmlnID0gewogICAgICAgICAgICAiYWN0aW9uX3dlaWdodHMiOiB7CiAgICAgICAgICAgICAgICAibmV3c2ZlZWQiOiAxNSwgICAgICAjIDE1JSB2deG7kXQgbmV3c2ZlZWQvYuG6o25nIHRpbgogICAgICAgICAgICAgICAgInJlZWxzIjogMjAsICAgICAgICAgIyAyMCUgeGVtIHJlZWxzL3ZpZGVvCiAgICAgICAgICAgICAgICAibm90aWZpY2F0aW9uIjogMTAsICAgIyAxMCUgeGVtIHRow7RuZyBiw6FvCiAgICAgICAgICAgICAgICAicHJvZmlsZSI6IDE1LCAgICAgICAjIDE1JSB4ZW0gcHJvZmlsZQogICAgICAgICAgICAgICAgImpvYiI6IDIwLCAgICAgICAgICAgIyAyMCUgbMOgbSBqb2IKICAgICAgICAgICAgICAgICJleHBsb3JlIjogNSwgICAgICAgICMgNSUga2jDoW0gcGjDoQogICAgICAgICAgICAgICAgInNlYXJjaCI6IDE1ICAgICAgICAgIyAxNSUgdMOsbSBraeG6v20KICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm1pbl9hY3Rpb25zX3Blcl9zZXNzaW9uIjogMjAsICAgICAgICAjIFThu5FpIHRoaeG7g3UgYWN0aW9ucyBt4buXaSBzZXNzaW9uCiAgICAgICAgICAgICJtYXhfYWN0aW9uc19wZXJfc2Vzc2lvbiI6IDUwLCAgICAgICAgIyBU4buRaSDEkWEgYWN0aW9ucyBt4buXaSBzZXNzaW9uCiAgICAgICAgICAgICJtYXhfam9ic19wZXJfc2Vzc2lvbiI6IDEwLCAgICAgICAgICAgIyBU4buRaSDEkWEgam9icyBt4buXaSBzZXNzaW9uCiAgICAgICAgICAgICJtYXhfY2FyZV9hY3Rpb25zX3Blcl9zZXNzaW9uIjogNSwgICAgIyBU4buRaSDEkWEgY2FyZSBhY3Rpb25zIHRyxrDhu5tjIGtoaSBsw6BtIGpvYgogICAgICAgICAgICAibWluX3Nlc3Npb25fZHVyYXRpb25fbWludXRlcyI6IDMwLCAgICMgVGjhu51pIGdpYW4gdOG7kWkgdGhp4buDdSBt4buXaSBzZXNzaW9uIChwaMO6dCkKICAgICAgICAgICAgIm1heF9zZXNzaW9uX2R1cmF0aW9uX21pbnV0ZXMiOiA2MCwgICAjIFRo4budaSBnaWFuIHThu5FpIMSRYSBt4buXaSBzZXNzaW9uIChwaMO6dCkKICAgICAgICB9CiAgICAgICAgCiAgICBkZWYgc2V0X3Byb3h5X3NlcnZpY2Uoc2VsZiwgcHJveHlfc2VydmljZSk6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBzZXJ2aWNlIGNobyBqb2IgaGFuZGxlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X3NlcnZpY2U6IFByb3h5U2VydmljZSBpbnN0YW5jZQogICAgICAgICIiIgogICAgICAgIHNlbGYucHJveHlfc2VydmljZSA9IHByb3h5X3NlcnZpY2UKICAgICAgICAKICAgIGRlZiBnZXRfY29uZmlnKHNlbGYsIGtleTogc3RyLCBkZWZhdWx0PU5vbmUpOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGPhuqV1IGjDrG5oIGNobyBqb2IgdGhlbyBwcmlvcml0eTogYXBwX2NvbmZpZyDihpIgZ2xvYmFsX2NvbmZpZyDihpIgX2RlZmF1bHRfY29uZmlnIOKGkiBkZWZhdWx0CiAgICAgICAgQ2FjaGUga+G6v3QgcXXhuqMgxJHhu4MgdOG7kWkgxrB1IHBlcmZvcm1hbmNlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAga2V5OiBLaMOzYSBj4bqldSBow6xuaCBj4bqnbiBs4bqleQogICAgICAgICAgICBkZWZhdWx0OiBHacOhIHRy4buLIG3hurdjIMSR4buLbmggbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIEdpw6EgdHLhu4sgY+G6pXUgaMOsbmggaG/hurdjIGRlZmF1bHQKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgY2FjaGUKICAgICAgICAgICAgaWYgKHNlbGYuX2FwcF9jb25maWdfY2FjaGUgaXMgbm90IE5vbmUgYW5kIAogICAgICAgICAgICAgICAgY3VycmVudF90aW1lIC0gc2VsZi5fY29uZmlnX2NhY2hlX3RpbWUgPCBzZWxmLl9jb25maWdfY2FjaGVfdHRsKToKICAgICAgICAgICAgICAgIGlmIGtleSBpbiBzZWxmLl9hcHBfY29uZmlnX2NhY2hlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9hcHBfY29uZmlnX2NhY2hlW2tleV0KICAgICAgICAgICAgICAgIGVsaWYga2V5IGluIHNlbGYuX2RlZmF1bHRfY29uZmlnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9kZWZhdWx0X2NvbmZpZ1trZXldCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0CiAgICAgICAgICAgIAogICAgICAgICAgICAjIENhY2hlIGjhur90IGjhuqFuIGhv4bq3YyBjaMawYSBjw7MsIHThuqNpIGzhuqFpIGNvbmZpZwogICAgICAgICAgICBhcHBfY29uZmlnID0gc2VsZi5kYi5nZXRfYXBwX2NvbmZpZyhzZWxmLmFwcF9uYW1lLCBzZWxmLl9kZWZhdWx0X2NvbmZpZykKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGNhY2hlCiAgICAgICAgICAgIHNlbGYuX2FwcF9jb25maWdfY2FjaGUgPSBhcHBfY29uZmlnCiAgICAgICAgICAgIHNlbGYuX2NvbmZpZ19jYWNoZV90aW1lID0gY3VycmVudF90aW1lCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRy4bqjIHbhu4EgZ2nDoSB0cuG7iwogICAgICAgICAgICBpZiBrZXkgaW4gYXBwX2NvbmZpZzoKICAgICAgICAgICAgICAgIHJldHVybiBhcHBfY29uZmlnW2tleV0KICAgICAgICAgICAgZWxpZiBrZXkgaW4gc2VsZi5fZGVmYXVsdF9jb25maWc6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZGVmYXVsdF9jb25maWdba2V5XQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHQKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbOG6pXkgY29uZmlnICd7a2V5fSc6IHtlfSIpCiAgICAgICAgICAgICMgRmFsbGJhY2sgdG8gX2RlZmF1bHRfY29uZmlnCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kZWZhdWx0X2NvbmZpZy5nZXQoa2V5LCBkZWZhdWx0KQogICAgICAgIAogICAgQGFic3RyYWN0bWV0aG9kCiAgICBkZWYgZ2V0X2FjY291bnRzX2Zyb21fZGV2aWNlKHNlbGYpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIkzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLIiIiCiAgICAgICAgcGFzcwoKICAgICAgICAKICAgIGRlZiBzeW5jX2FjY291bnRzX3RvX2RiKHNlbGYpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIMSQ4buTbmcgYuG7mSB0w6BpIGtob+G6o24gdOG7qyB0aGnhur90IGLhu4sgdsOgbyBkYXRhYmFzZSB2w6AgbWFwIHbhu5tpIHTDoGkga2hv4bqjbiBHb0xpa2UKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdOG7qyB0aGnhur90IGLhu4sKICAgICAgICAgICAgZGV2aWNlX2FjY291bnRzID0gc2VsZi5nZXRfYWNjb3VudHNfZnJvbV9kZXZpY2UoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBkZXZpY2VfaWQgdOG7qyBkYXRhYmFzZQogICAgICAgICAgICBhbmRyb2lkX2lkID0gc2VsZi5kYi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIGhp4buHbiBjw7MgdHJvbmcgREIgY2hvIGFwcCBuw6B5CiAgICAgICAgICAgIGV4aXN0aW5nX2FjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPXNlbGYuYXBwX25hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHNldCBjw6FjIHVuaXF1ZV91c2VybmFtZSB04burIHRoaeG6v3QgYuG7iyDEkeG7gyBk4buFIHNvIHPDoW5oCiAgICAgICAgICAgIGRldmljZV91c2VybmFtZXMgPSBzZXQoKQogICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBkZXZpY2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGFjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKQogICAgICAgICAgICAgICAgaWYgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX3VzZXJuYW1lcy5hZGQodXNlcm5hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgdMOgaSBraG/huqNuIHRyb25nIERCIG3DoCBraMO0bmcgY8OybiB0csOqbiB0aGnhur90IGLhu4sgLT4gxJHDoW5oIGThuqV1IGxvZ291dAogICAgICAgICAgICBmb3IgZXhpc3RpbmdfYWNjb3VudCBpbiBleGlzdGluZ19hY2NvdW50czoKICAgICAgICAgICAgICAgIGV4aXN0aW5nX3VzZXJuYW1lID0gZXhpc3RpbmdfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgICAgICBpZiBleGlzdGluZ191c2VybmFtZSBhbmQgZXhpc3RpbmdfdXNlcm5hbWUgbm90IGluIGRldmljZV91c2VybmFtZXM6CiAgICAgICAgICAgICAgICAgICAgIyBUw6BpIGtob+G6o24gY8OzIHRyb25nIERCIG5oxrBuZyBraMO0bmcgY8OzIHRyw6puIHRoaeG6v3QgYuG7iyAtPiBsb2dvdXQKICAgICAgICAgICAgICAgICAgICBpZiBleGlzdGluZ19hY2NvdW50LmdldCgic3RhdHVzIikgIT0gImxvZ291dCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge2V4aXN0aW5nX3VzZXJuYW1lfSBraMO0bmcgY8OybiB0csOqbiB0aGnhur90IGLhu4ssIMSRw6FuaCBk4bqldSBsb2dvdXQiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGV4aXN0aW5nX2FjY291bnRbImlkIl0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAibG9nb3V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9yZWFzb24iOiAiVMOgaSBraG/huqNuIGtow7RuZyBjw7JuIHRyw6puIHRoaeG6v3QgYuG7iyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBob+G6t2MgdGjDqm0gbeG7m2kgdsOgbyBEQgogICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBkZXZpY2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICAjIFRow6ptIHRow7RuZyB0aW4gYXBwIHbDoCBkZXZpY2VfaWQKICAgICAgICAgICAgICAgIGFjY291bnRbImFwcCJdID0gc2VsZi5hcHBfbmFtZQogICAgICAgICAgICAgICAgYWNjb3VudFsiZGV2aWNlX2lkIl0gPSBhbmRyb2lkX2lkCiAgICAgICAgICAgICAgICAjIMSQw6FuaCBk4bqldSBsw6AgY2jGsGEgxJHhu5NuZyBi4buZIMSR4buDIGfhu61pIGzDqm4gc2VydmVyCiAgICAgICAgICAgICAgICBhY2NvdW50WyJpc19zeW5jIl0gPSBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdMOgaSBraG/huqNuIMSRw6MgdOG7k24gdOG6oWkgY2jGsGEgZOG7sWEgdsOgbyB1bmlxdWVfdXNlcm5hbWUgKyBhcHAKICAgICAgICAgICAgICAgIGV4aXN0aW5nX2FjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50X2J5X3VuaXF1ZV91c2VybmFtZShzZWxmLmFwcF9uYW1lLCBhY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIikpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGV4aXN0aW5nX2FjY291bnQ6CiAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIGhp4buHbiBjw7MgLSBjaOG7iSDEkeG7k25nIGLhu5kgdHLhuqFuZyB0aMOhaSBsb2dpbi9sb2dvdXQKICAgICAgICAgICAgICAgICAgICBhY2NvdW50X2lkID0gZXhpc3RpbmdfYWNjb3VudFsiaWQiXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQ2h14bqpbiBi4buLIGThu68gbGnhu4d1IGPhuq1wIG5o4bqtdCB04buRaSB0aGnhu4N1CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJpc19sb2dpbiI6IGFjY291bnQuZ2V0KCJpc19sb2dpbiIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogYWNjb3VudC5nZXQoImxhc3RfdXBkYXRlIiwgaW50KHRpbWUudGltZSgpKSksCiAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IHTDoGkga2hv4bqjbiB0cm9uZyBEQiDEkWFuZyDhu58gdHLhuqFuZyB0aMOhaSBsb2dvdXQgbmjGsG5nIHh14bqldCBoaeG7h24gbOG6oWkgdHLDqm4gdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICAgICAgaWYgZXhpc3RpbmdfYWNjb3VudC5nZXQoInN0YXR1cyIpID09ICJsb2dvdXQiOgogICAgICAgICAgICAgICAgICAgICAgICAjIFJlc2V0IHThu6sgbG9nb3V0IHbhu4EgYWN0aXZlIHbDoCB4w7NhIGluYWN0aXZlX3JlYXNvbgogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YVsic3RhdHVzIl0gPSAiYWN0aXZlIgogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YVsiaW5hY3RpdmVfcmVhc29uIl0gPSAiIgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IMSRw6MgeHXhuqV0IGhp4buHbiBs4bqhaSB0csOqbiB0aGnhur90IGLhu4ssIHJlc2V0IHThu6sgbG9nb3V0IHbhu4EgYWN0aXZlIikKICAgICAgICAgICAgICAgICAgICAjIE7hur91IMSRw6MgYWN0aXZlIHRow6wgZ2nhu68gbmd1ecOqbiBzdGF0dXMsIGtow7RuZyB0aGF5IMSR4buVaSBnw6wga2jDoWMKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRfaWQsIHVwZGF0ZV9kYXRhKQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSRxINuZyBuaOG6rXAgY2hvIHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSB0cm9uZyB7c2VsZi5hcHBfbmFtZX0iKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIFRow6ptIHTDoGkga2hv4bqjbiBt4bubaSB24bubaSB0cuG6oW5nIHRow6FpIGFjdGl2ZQogICAgICAgICAgICAgICAgICAgIGFjY291bnRbInN0YXR1cyJdID0gImFjdGl2ZSIKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLmFkZF9hY2NvdW50KGFjY291bnQpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgdGjDqm0gdMOgaSBraG/huqNuIG3hu5tpIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IGNobyB7c2VsZi5hcHBfbmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBTYXUga2hpIMSR4buTbmcgYuG7mSB0w6BpIGtob+G6o24gdOG7qyB0aGnhur90IGLhu4ssIHRo4buxYyBoaeG7h24gbWFwcGluZyB24bubaSBHb0xpa2UKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSBtYXBwaW5nIHTDoGkga2hv4bqjbiB7c2VsZi5hcHBfbmFtZX0gduG7m2kgR29MaWtlLi4uIikKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBHb0xpa2UKICAgICAgICAgICAgICAgIGdvbGlrZV9hY2NvdW50cyA9IHNlbGYuZ2V0X2dvbGlrZV9hY2NvdW50cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGdvbGlrZV9hY2NvdW50czoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkge2xlbihnb2xpa2VfYWNjb3VudHMpfSB0w6BpIGtob+G6o24gR29MaWtlIGNobyB7c2VsZi5hcHBfbmFtZX0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHDoyBj4bqtcCBuaOG6rXQgdOG7qyBEQgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfZGV2aWNlX2FjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPXNlbGYuYXBwX25hbWUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIG1hcHBpbmcKICAgICAgICAgICAgICAgICAgICBtYXBwZWRfY291bnQgPSBzZWxmLm1hcF9nb2xpa2VfYWNjb3VudHMoZ29saWtlX2FjY291bnRzLCB1cGRhdGVkX2RldmljZV9hY2NvdW50cykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKG1hcHBlZF9jb3VudCwgaW50KToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgbWFwcGluZyB7bWFwcGVkX2NvdW50fSB0w6BpIGtob+G6o24ge3NlbGYuYXBwX25hbWV9IHbhu5tpIEdvTGlrZSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkhvw6BuIHRow6BuaCBtYXBwaW5nIHTDoGkga2hv4bqjbiB7c2VsZi5hcHBfbmFtZX0gduG7m2kgR29MaWtlIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gR29MaWtlIG7DoG8gY2hvIHtzZWxmLmFwcF9uYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgbWFwcGluZyB24bubaSBHb0xpa2U6IHtlfSIpCiAgICAgICAgICAgICAgICAjIEtow7RuZyB0aHJvdyBleGNlcHRpb24gdsOsIHN5bmMgdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLIMSRw6MgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGRldmljZV9hY2NvdW50cwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIMSR4buTbmcgYuG7mSB0w6BpIGtob+G6o24ge3NlbGYuYXBwX25hbWV9IikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgIAogICAgZGVmIGlzX2dvbGlrZV9hdXRoZW50aWNhdGVkKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gxJHDoyBjw7MgdGjDtG5nIHRpbiB4w6FjIHRo4buxYyBHb0xpa2UgaOG7o3AgbOG7hyBjaMawYQogICAgICAgIFPhu60gZOG7pW5nIEdvTGlrZVNlcnZpY2UgxJHhu4MgdmFsaWRhdGUgY2jhurd0IGNo4bq9IGjGoW4KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRw6MgeMOhYyB0aOG7sWMgxJHhuqd5IMSR4bunLCBGYWxzZSBu4bq/dSB0aGnhur91IHRow7RuZyB0aW4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5nb2xpa2Vfc2VydmljZS5pc19nb2xpa2VfYXV0aGVudGljYXRlZCgpCiAgICAKICAgIGRlZiBhcGlfcmVxdWVzdChzZWxmLCB1cmw6IHN0ciwgbWV0aG9kOiBzdHIgPSAiR0VUIiwgcGF5bG9hZDogRGljdFtzdHIsIEFueV0gPSBOb25lKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgR+G7jWkgQVBJIEdvTGlrZSB0aMO0bmcgcXVhIEdvTGlrZVNlcnZpY2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB1cmw6IFVSTCBj4bunYSBBUEkKICAgICAgICAgICAgbWV0aG9kOiBQaMawxqFuZyB0aOG7qWMgSFRUUCAoR0VUIGhv4bq3YyBQT1NUKQogICAgICAgICAgICBwYXlsb2FkOiBE4buvIGxp4buHdSBn4butaSDEkWkgKGNobyBQT1NUIHJlcXVlc3QpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgaG/hurdjIE5vbmU6IEvhur90IHF14bqjIEFQSSBu4bq/dSB0aMOgbmggY8O0bmcsIE5vbmUgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuZ29saWtlX3NlcnZpY2U6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGfhu41pIEFQSTogR29MaWtlU2VydmljZSBjaMawYSDEkcaw4bujYyBjdW5nIGPhuqVwIGNobyB7c2VsZi5hcHBfbmFtZX0gam9iIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgIyBY4butIGzDvSBwYXlsb2FkIGNobyBHRVQgcmVxdWVzdCAtIHRow6ptIHbDoG8gVVJMCiAgICAgICAgaWYgbWV0aG9kLnVwcGVyKCkgPT0gIkdFVCIgYW5kIHBheWxvYWQ6CiAgICAgICAgICAgICMgVOG6oW8gcXVlcnkgc3RyaW5nIHThu6sgcGF5bG9hZAogICAgICAgICAgICBxdWVyeV9wYXJhbXMgPSBbXQogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBwYXlsb2FkLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiB2YWx1ZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBxdWVyeV9wYXJhbXMuYXBwZW5kKGYie3VybGxpYi5wYXJzZS5xdW90ZShrZXkpfT17dXJsbGliLnBhcnNlLnF1b3RlKHN0cih2YWx1ZSkpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIHF1ZXJ5IHN0cmluZyB2w6BvIFVSTAogICAgICAgICAgICBpZiBxdWVyeV9wYXJhbXM6CiAgICAgICAgICAgICAgICBzZXBhcmF0b3IgPSAiJiIgaWYgIj8iIGluIHVybCBlbHNlICI/IgogICAgICAgICAgICAgICAgdXJsID0gZiJ7dXJsfXtzZXBhcmF0b3J9eycmJy5qb2luKHF1ZXJ5X3BhcmFtcyl9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6t3QgcGF5bG9hZCB24buBIE5vbmUgdsOsIMSRw6MgxJHGsGEgdsOgbyBVUkwKICAgICAgICAgICAgcGF5bG9hZCA9IE5vbmUKICAgICAgICAKICAgICAgICByZXR1cm4gc2VsZi5nb2xpa2Vfc2VydmljZS5hcGlfcmVxdWVzdCh1cmwsIG1ldGhvZCwgcGF5bG9hZCkKICAgIAogICAgZGVmIGdldF9nb2xpa2VfYWNjb3VudHMoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHDoyDEkcSDbmcga8O9IHbhu5tpIEdvTGlrZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBHb0xpa2UKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDGsOG7nW5nIGThuqtuIEFQSSBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICB1cmwgPSBmIntzZWxmLmdldF9hY2NvdW50X3VybCgpfSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJCiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5hcGlfcmVxdWVzdCh1cmwpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgYWNjb3VudHMgPSByZXNwb25zZS5nZXQoImRhdGEiLCBbXSkKICAgICAgICAgICAgICAgIHJldHVybiBhY2NvdW50cwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBHb0xpa2UiKQogICAgICAgICAgICByZXR1cm4gW10KICAgIAogICAgZGVmIG1hcF9nb2xpa2VfYWNjb3VudHMoc2VsZiwgZ29saWtlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSwgZGV2aWNlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgw4FuaCB44bqhIHTDoGkga2hv4bqjbiB04burIEdvTGlrZSB2w6BvIHTDoGkga2hv4bqjbiB0csOqbiB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBnb2xpa2VfYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuIHThu6sgR29MaWtlIEFQSQogICAgICAgICAgICBkZXZpY2VfYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHDoyDDoW5oIHjhuqEKICAgICAgICAiIiIKICAgICAgICAjIFBoxrDGoW5nIHRo4bupYyBt4bq3YyDEkeG7i25oLCBj4bqnbiBvdmVycmlkZSDhu58gbOG7m3AgY29uCiAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBmZXRjaF9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIGpvYiB04burIEdvTGlrZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgaG/hurdjIE5vbmU6IFRow7RuZyB0aW4gam9iIG7hur91IGPDsywgTm9uZSBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQxrDhu51uZyBk4bqrbiBBUEkgbOG6pXkgam9iCiAgICAgICAgICAgIHVybCA9IGYie3NlbGYuZ2V0X2pvYnNfdXJsKCl9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaGFtIHPhu5EgdMO5eSB0aGVvIGxv4bqhaSBhcHAKICAgICAgICAgICAgcGFyYW1zID0gc2VsZi5nZXRfam9iX3BhcmFtcyhhY2NvdW50KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBBUEkKICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmFwaV9yZXF1ZXN0KHVybCwgIkdFVCIsIHBhcmFtcykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN1Y2Nlc3MiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBqb2IgPSByZXNwb25zZS5nZXQoImRhdGEiLCBOb25lKQogICAgICAgICAgICAgICAgaWYgam9iOgogICAgICAgICAgICAgICAgICAgICMgQ2h14bqpbiBow7NhIGThu68gbGnhu4d1IGpvYgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLm1hcF9qb2JfZGF0YShqb2IpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgam9iIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIG1hcF9qb2JfZGF0YShzZWxmLCBqb2JfZGF0YTogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENodeG6qW4gaMOzYSBk4buvIGxp4buHdSBqb2IgdOG7qyBBUEkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2JfZGF0YTogROG7ryBsaeG7h3Ugam9iIHThu6sgQVBJCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBE4buvIGxp4buHdSBqb2IgxJHDoyBjaHXhuqluIGjDs2EKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiYXBwIjogc2VsZi5hcHBfbmFtZSwKICAgICAgICAgICAgImlkIjogam9iX2RhdGEuZ2V0KCJpZCIpLAogICAgICAgICAgICAibGluayI6IGpvYl9kYXRhLmdldCgibGluayIpLAogICAgICAgICAgICAidHlwZSI6IGpvYl9kYXRhLmdldCgidHlwZSIpLAogICAgICAgICAgICAib2JqZWN0X2lkIjogam9iX2RhdGEuZ2V0KCJvYmplY3RfaWQiKSwKICAgICAgICAgICAgInByaWNlX2FmdGVyX2Nvc3QiOiBqb2JfZGF0YS5nZXQoInByaWNlX2FmdGVyX2Nvc3QiKSwKICAgICAgICAgICAgInN0YXR1cyI6ICJpZGxlIiwgICMgU3RhdHVzIG3hurdjIMSR4buLbmggbMOgIGlkbGUKICAgICAgICAgICAgInJhd19kYXRhIjogam9iX2RhdGEgICMgTMawdSBs4bqhaSBk4buvIGxp4buHdSBn4buRYyDEkeG7gyB0aGFtIGto4bqjbyBraGkgY+G6p24KICAgICAgICB9CiAgICAKICAgIGRlZiB2YWxpZGF0ZV9qb2JfYmVmb3JlX2V4ZWN1dGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6AgdmFsaWRhdGUgam9iIHRyxrDhu5tjIGtoaSB0aOG7sWMgaGnhu4duCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgdmFsaWRhdGlvbjoKICAgICAgICAgICAgICAgIC0gdmFsaWQgKGJvb2wpOiBUcnVlIG7hur91IGpvYiBo4bujcCBs4buHLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAgICAgICAgIC0gc2hvdWxkX3NraXAgKGJvb2wpOiBUcnVlIG7hur91IG7Dqm4gc2tpcCBqb2IsIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICAgICAgICAgLSByZWFzb24gKHN0cik6IEzDvSBkbyBraMO0bmcgaOG7o3AgbOG7hyBob+G6t2Mgc2tpcAogICAgICAgICAgICAgICAgLSBtZXNzYWdlIChzdHIpOiBUaMO0bmcgYsOhbyBjaGkgdGnhur90CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBqb2JfdHlwZSA9IGpvYi5nZXQoInR5cGUiLCAiIikubG93ZXIoKQogICAgICAgICAgICBqb2JfcHJpY2UgPSBqb2IuZ2V0KCJwcmljZV9hZnRlcl9jb3N0IiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBqb2IgZm9sbG93CiAgICAgICAgICAgIGlmIGpvYl90eXBlID09ICJmb2xsb3ciOgogICAgICAgICAgICAgICAgIyAxLiBLaeG7g20gdHJhIGdpw6EgdGnhu4FuIGPhu6dhIGpvYiBmb2xsb3cKICAgICAgICAgICAgICAgIG1pbl9mb2xsb3dfcHJpY2UgPSBzZWxmLmdldF9jb25maWcoIm1pbl9mb2xsb3dfcHJpY2UiLCAzMCkgICMgTeG6t2MgxJHhu4tuaCAzMAogICAgICAgICAgICAgICAgaWYgam9iX3ByaWNlIDwgbWluX2ZvbGxvd19wcmljZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAidmFsaWQiOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgInNob3VsZF9za2lwIjogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiBmIkpvYiBmb2xsb3cgY8OzIGdpw6Ege2pvYl9wcmljZX0gPCB7bWluX2ZvbGxvd19wcmljZX0sIHNraXAgam9iLiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgxJDDoyBi4buPIGtp4buDbSB0cmEga2jDs2EgZm9sbG93IHbDrCBraMO0bmcgY8OybiBnaeG7m2kgaOG6oW4gZm9sbG93CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEpvYiBo4bujcCBs4buHCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAidmFsaWQiOiBUcnVlLAogICAgICAgICAgICAgICAgInNob3VsZF9za2lwIjogRmFsc2UsCiAgICAgICAgICAgICAgICAibWVzc2FnZSI6ICJKb2IgaOG7o3AgbOG7hyIKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSB2YWxpZGF0ZSBqb2I6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ2YWxpZCI6IEZhbHNlLAogICAgICAgICAgICAgICAgInNob3VsZF9za2lwIjogRmFsc2UsCiAgICAgICAgICAgICAgICAicmVhc29uIjogInZhbGlkYXRpb25fZXJyb3IiLAogICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiBmIkzhu5dpIGtoaSB2YWxpZGF0ZSBqb2I6IHtzdHIoZSl9IgogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBleGVjdXRlX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIGpvYiwgYmFvIGfhu5NtOgogICAgICAgICAgICAgICAgLSBzdGF0dXMgKGludCk6IE3DoyB0cuG6oW5nIHRow6FpIGpvYgogICAgICAgICAgICAgICAgICAgIDA6IENoxrBhIHRo4buxYyBoaeG7h24KICAgICAgICAgICAgICAgICAgICAxOiBUaMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICAyOiBUaOG6pXQgYuG6oWksIGtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcKICAgICAgICAgICAgICAgICAgICAzOiBUaOG6pXQgYuG6oWksIMSRw6MgYuG7iyB1bmZvbGxvdy91bmxpa2UKICAgICAgICAgICAgICAgIC0gbWVzc2FnZSAoc3RyKTogVGjDtG5nIGLDoW8ga+G6v3QgcXXhuqMKICAgICAgICAgICAgICAgIC0gc3VjY2VzcyAoYm9vbCk6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICAjIE3hurdjIMSR4buLbmgga2jDtG5nIGzDoG0gZ8OsLCBj4bqnbiBvdmVycmlkZSDhu58gbOG7m3AgY29uCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlRo4buxYyBoaeG7h24gam9iIGNobyB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0iKQogICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCgwLCAiQ2jGsGEgdGjhu7FjIGhp4buHbiBqb2IiLCBGYWxzZSkKICAgIAogICAgZGVmIF9jcmVhdGVfam9iX3Jlc3VsdChzZWxmLCBzdGF0dXM6IGludCwgbWVzc2FnZTogc3RyLCBzdWNjZXNzOiBib29sLCAqKmt3YXJncykgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVOG6oW8ga+G6v3QgcXXhuqMgam9iIGNodeG6qW4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBzdGF0dXMgKGludCk6IE3DoyB0cuG6oW5nIHRow6FpIGpvYgogICAgICAgICAgICAgICAgMDogQ2jGsGEgdGjhu7FjIGhp4buHbgogICAgICAgICAgICAgICAgMTogVGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAyOiBUaOG6pXQgYuG6oWksIGtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcKICAgICAgICAgICAgICAgIDM6IFRo4bqldCBi4bqhaSwgxJHDoyBi4buLIHVuZm9sbG93L3VubGlrZQogICAgICAgICAgICAgICAgNDogVGjhuqV0IGLhuqFpLCB5w6p1IGPhuqd1IMSRYW5nIGNo4budCiAgICAgICAgICAgICAgICA1OiBH4butaSB5w6p1IGPhuqd1IGNo4budIGR1eeG7h3QgKEluc3RhZ3JhbSkKICAgICAgICAgICAgbWVzc2FnZSAoc3RyKTogVGjDtG5nIGLDoW8ga+G6v3QgcXXhuqMKICAgICAgICAgICAgc3VjY2VzcyAoYm9vbCk6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAgICAgKiprd2FyZ3M6IEPDoWMgdGjDtG5nIHRpbiBi4buVIHN1bmcKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIGpvYiDEkcOjIGNodeG6qW4gaMOzYQogICAgICAgICIiIgogICAgICAgIHJlc3VsdCA9IHsKICAgICAgICAgICAgInN0YXR1cyI6IHN0YXR1cywKICAgICAgICAgICAgIm1lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAic3VjY2VzcyI6IHN1Y2Nlc3MKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgIyBUaMOqbSB0aMO0bmcgdGluIGLhu5Ugc3VuZyBu4bq/dSBjw7MKICAgICAgICByZXN1bHQudXBkYXRlKGt3YXJncykKICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAKICAgIGRlZiByZXBvcnRfam9iKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldLCByZXN1bHQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIELDoW8gY8OhbyBr4bq/dCBxdeG6oyBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIHJlc3VsdDogS+G6v3QgcXXhuqMgdGjhu7FjIGhp4buHbiBqb2IgYmFvIGfhu5NtOgogICAgICAgICAgICAgICAgLSBzdGF0dXMgKGludCk6IE3DoyB0cuG6oW5nIHRow6FpIGpvYgogICAgICAgICAgICAgICAgICAgIDE6IFRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIDI6IFRo4bqldCBi4bqhaSwga2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZwogICAgICAgICAgICAgICAgICAgIDM6IFRo4bqldCBi4bqhaSwgxJHDoyBi4buLIHVuZm9sbG93L3VubGlrZQogICAgICAgICAgICAgICAgLSBtZXNzYWdlIChzdHIpOiBUaMO0bmcgYsOhbyBr4bq/dCBxdeG6owogICAgICAgICAgICAgICAgLSBzdWNjZXNzIChib29sKTogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGLDoW8gY8OhbyB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgam9iX2lkID0gam9iLmdldCgiaWQiKQogICAgICAgICAgICBqb2JfdHlwZSA9IGpvYi5nZXQoInR5cGUiLCAiIikKICAgICAgICAgICAgam9iX3N0YXR1cyA9IHJlc3VsdC5nZXQoInN0YXR1cyIsIDApCiAgICAgICAgICAgIGpvYl9zdWNjZXNzID0gcmVzdWx0LmdldCgic3VjY2VzcyIsIEZhbHNlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBHaGkgbOG6oWkgbOG7i2NoIHPhu60gam9iCiAgICAgICAgICAgIHNlbGYucmVjb3JkX2pvYl9oaXN0b3J5KGFjY291bnQsIGpvYiwgcmVzdWx0KQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGpvYl9pZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgY8OzIElEIGpvYiDEkeG7gyBiw6FvIGPDoW8iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgam9iIHbDoCB44butIGzDvSB0xrDGoW5nIOG7qW5nCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IHN0YXR1cyBsw6AgMiAobOG7l2kga2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZyksIGjhu6d5IGpvYiB2w6AgYsOhbyBjw6FvIHRo4bqldCBi4bqhaQogICAgICAgICAgICBpZiBqb2Jfc3RhdHVzID09IDI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gam9iIHtqb2JfaWR9LCBraMO0bmcgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nLCBo4buneSBqb2IiKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuc2tpcF9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBzdGF0dXMgbMOgIDYgKMSR4bqhdCBnaeG7m2kgaOG6oW4gaG/hurdjIGLhu4sga2jDs2EpLCBo4buneSBqb2IKICAgICAgICAgICAgaWYgam9iX3N0YXR1cyA9PSA2OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkpvYiB7am9iX2lkfSBi4buLIGjhu6d5IGRvIMSR4bqhdCBnaeG7m2kgaOG6oW4gaG/hurdjIHTDoGkga2hv4bqjbiBi4buLIGtow7NhIikKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnNraXBfam9iKGFjY291bnQsIGpvYikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Ugc3RhdHVzIGzDoCAzICjEkcOjIGLhu4sgdW5mb2xsb3cvdW5saWtlKSwgxJHDoW5oIGThuqV1IHRyb25nIHJlc3VsdCDEkeG7gyBKb2JTZXJ2aWNlIHjhu60gbMO9CiAgICAgICAgICAgIGlmIGpvYl9zdGF0dXMgPT0gMzoKICAgICAgICAgICAgICAgIGFjY291bnRfdXNlcm5hbWUgPSBhY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJykKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJQaMOhdCBoaeG7h24gYuG7iyB1bmZvbGxvdy91bmxpa2UsIHTDoGkga2hv4bqjbiB7YWNjb3VudF91c2VybmFtZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEjhu6d5IGpvYiBoaeG7h24gdOG6oWkKICAgICAgICAgICAgICAgIHNlbGYuc2tpcF9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMSQw6FuaCBk4bqldSB1bmZvbGxvdyB0cm9uZyByZXN1bHQgxJHhu4MgSm9iU2VydmljZSB44butIGzDvSB04bqtcCB0cnVuZwogICAgICAgICAgICAgICAgcmVzdWx0WyJ1bmZvbGxvdyJdID0gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGpvYl9zdGF0dXMgPT0gNDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJZw6p1IGPhuqd1IMSRYW5nIGNo4budIHRyb25nIGpvYiB7am9iX3R5cGV9LCBo4buneSBqb2IiKQogICAgICAgICAgICAgICAgc2VsZi5za2lwX2pvYihhY2NvdW50LCBqb2IpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Ugam9iIHRow6BuaCBjw7RuZywgYsOhbyBjw6FvIGvhur90IHF14bqjCiAgICAgICAgICAgIGlmIGpvYl9zdWNjZXNzOgogICAgICAgICAgICAgICAgIyBVUkwgQVBJIGLDoW8gY8OhbyBqb2IKICAgICAgICAgICAgICAgIHVybCA9IHNlbGYuZ2V0X2NvbXBsZXRlX2pvYnNfdXJsKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBU4bqhbyBwYXlsb2FkIGNobyBiw6FvIGPDoW8gam9iCiAgICAgICAgICAgICAgICBwYXlsb2FkID0gc2VsZi5nZXRfcmVwb3J0X3BheWxvYWQoYWNjb3VudCwgam9iKQogICAgICAgICAgICAgICAgaWYgbm90IHBheWxvYWQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB04bqhbyBwYXlsb2FkIGNobyBiw6FvIGPDoW8gam9iIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaOG7rSBn4buNaSBBUEkgdOG7kWkgxJFhIDMgbOG6p24KICAgICAgICAgICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKDMpOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5hcGlfcmVxdWVzdCh1cmwsICJQT1NUIiwgcGF5bG9hZCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBiw6FvIGPDoW8gam9iIHtqb2JfaWR9IHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgZWxpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSA0MDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IHJlc3BvbnNlLmdldCgnbWVzc2FnZScsICcnKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlt7YXR0ZW1wdCArIDF9XSBCw6FvIGPDoW8gam9iIGzhu5dpOiB7ZXJyb3JfbXNnfSwgdGjhu60gbOG6oWkgc2F1IDVzLi4uIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlBo4bqjbiBo4buTaSBraMO0bmcgbW9uZyDEkeG7o2kga2hpIGLDoW8gY8OhbyBqb2I6IHtyZXNwb25zZX0iKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg1KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyB0aMOgbmggY8O0bmcgc2F1IDMgbOG6p24gdGjhu60sIGjhu6d5IGpvYgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgYsOhbyBjw6FvIGpvYiB7am9iX2lkfSBzYXUgMyBs4bqnbiB0aOG7rSIpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5za2lwX2pvYihhY2NvdW50LCBqb2IpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEpvYiBraMO0bmcgdGjDoG5oIGPDtG5nLCBo4buneSBqb2IKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJKb2Ige2pvYl9pZH0ga2jDtG5nIHRow6BuaCBjw7RuZywgaOG7p3kgam9iIikKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnNraXBfam9iKGFjY291bnQsIGpvYikKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgYsOhbyBjw6FvIGpvYiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgZ2V0X3JlcG9ydF9wYXlsb2FkKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBU4bqhbyBwYXlsb2FkIGNobyB2aeG7h2MgYsOhbyBjw6FvIGhvw6BuIHRow6BuaCBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBQYXlsb2FkIGNobyBBUEkgYsOhbyBjw6FvCiAgICAgICAgIiIiCiAgICAgICAgZ29saWtlX2lkID0gYWNjb3VudC5nZXQoImdvbGlrZV9pZCIpCiAgICAgICAgam9iX2lkID0gam9iLmdldCgiaWQiKQogICAgICAgIAogICAgICAgIGlmIG5vdCBnb2xpa2VfaWQgb3Igbm90IGpvYl9pZDoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIlRoaeG6v3UgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24gaG/hurdjIGpvYiDEkeG7gyB04bqhbyBwYXlsb2FkIGLDoW8gY8OhbyIpCiAgICAgICAgICAgIHJldHVybiB7fQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiYWRzX2lkIjogam9iX2lkLAogICAgICAgICAgICAiYWNjb3VudF9pZCI6IGdvbGlrZV9pZCwKICAgICAgICAgICAgImFzeW5jIjogVHJ1ZSwKICAgICAgICAgICAgImRhdGEiOiBOb25lCiAgICAgICAgfQogICAgCiAgICBkZWYgZ2V0X3NraXBfcGF5bG9hZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVOG6oW8gcGF5bG9hZCBjaG8gdmnhu4djIGLhu48gcXVhL2jhu6d5IGpvYgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IFBheWxvYWQgY2hvIEFQSSBza2lwIGpvYgogICAgICAgICIiIgogICAgICAgIGdvbGlrZV9pZCA9IGFjY291bnQuZ2V0KCJnb2xpa2VfaWQiKQogICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICBqb2JfdHlwZSA9IGpvYi5nZXQoInR5cGUiKQogICAgICAgIG9iamVjdF9pZCA9IGpvYi5nZXQoIm9iamVjdF9pZCIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IGdvbGlrZV9pZCBvciBub3Qgam9iX2lkOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiVGhp4bq/dSB0aMO0bmcgdGluIHTDoGkga2hv4bqjbiBob+G6t2Mgam9iIMSR4buDIHThuqFvIHBheWxvYWQgaOG7p3kiKQogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImFkc19pZCI6IGpvYl9pZCwKICAgICAgICAgICAgImFjY291bnRfaWQiOiBnb2xpa2VfaWQsCiAgICAgICAgICAgICJvYmplY3RfaWQiOiBvYmplY3RfaWQsCiAgICAgICAgICAgICJ0eXBlIjogam9iX3R5cGUKICAgICAgICB9CiAgICAgICAgCiAgICBkZWYgc2tpcF9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQuG7jyBxdWEvaOG7p3kgam9iIGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBo4buneSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVVJMIEFQSSDEkeG7gyBza2lwIGpvYgogICAgICAgICAgICB1cmwgPSBzZWxmLmdldF9za2lwX2pvYnNfdXJsKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6oW8gcGF5bG9hZCBjaG8gdmnhu4djIHNraXAgam9iCiAgICAgICAgICAgIHBheWxvYWQgPSBzZWxmLmdldF9za2lwX3BheWxvYWQoYWNjb3VudCwgam9iKQogICAgICAgICAgICBpZiBub3QgcGF5bG9hZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgdOG6oW8gcGF5bG9hZCBjaG8gc2tpcCBqb2IiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSQogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuYXBpX3JlcXVlc3QodXJsLCAiUE9TVCIsIHBheWxvYWQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgaOG7p3kgam9iIHtqb2IuZ2V0KCdpZCcpfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJI4buneSBqb2Ige2pvYi5nZXQoJ2lkJyl9IHRo4bqldCBi4bqhaToge3Jlc3BvbnNlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgaOG7p3kgam9iIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBkZWYgY2xvc2VfYXBwKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIMSQw7NuZyBhcHAKICAgICAgICAiIiIKICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgIGRlZiBnZXRfYXBpX2Jhc2VfdXJsKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBVUkwgZ+G7kWMgY+G7p2EgQVBJIEdvTGlrZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIGfhu5FjCiAgICAgICAgIiIiCiAgICAgICAgaW1wb3J0IGNvbmZpZwogICAgICAgIHJldHVybiBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS97c2VsZi5hcHBfbmFtZX0iCiAgICAKICAgIGRlZiBnZXRfYWNjb3VudF91cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgdMOgaSBraG/huqNuIGPhu6dhIEdvTGlrZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIEFQSSB0w6BpIGtob+G6o24KICAgICAgICAiIiIKICAgICAgICBpbXBvcnQgY29uZmlnCiAgICAgICAgcmV0dXJuIGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L3tzZWxmLmFwcF9uYW1lfS1hY2NvdW50IgogICAgCiAgICBkZWYgZ2V0X2pvYnNfdXJsKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBVUkwgQVBJIGpvYnMgY+G7p2EgR29MaWtlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVUkwgQVBJIGpvYnMKICAgICAgICAiIiIKICAgICAgICBpbXBvcnQgY29uZmlnCiAgICAgICAgcmV0dXJuIGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L2FkdmVydGlzaW5nL3B1Ymxpc2hlcnMve3NlbGYuYXBwX25hbWV9L2pvYnMiCiAgICAKICAgIGRlZiBnZXRfY29tcGxldGVfam9ic191cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgYsOhbyBjw6FvIGpvYiBob8OgbiB0aMOgbmggY+G7p2EgR29MaWtlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVUkwgQVBJIGLDoW8gY8OhbyBqb2IgaG/DoG4gdGjDoG5oCiAgICAgICAgIiIiCiAgICAgICAgaW1wb3J0IGNvbmZpZwogICAgICAgIHJldHVybiBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS9hZHZlcnRpc2luZy9wdWJsaXNoZXJzL3tzZWxmLmFwcF9uYW1lfS9jb21wbGV0ZS1qb2JzIgogICAgCiAgICBkZWYgZ2V0X3NraXBfam9ic191cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgc2tpcCBqb2JzIGPhu6dhIEdvTGlrZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIEFQSSBza2lwIGpvYnMKICAgICAgICAiIiIKICAgICAgICBpbXBvcnQgY29uZmlnCiAgICAgICAgcmV0dXJuIGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L2FkdmVydGlzaW5nL3B1Ymxpc2hlcnMve3NlbGYuYXBwX25hbWV9L3NraXAtam9icyIKICAgIAogICAgZGVmIGdldF9qb2JfcmVwb3J0X3VybChzZWxmLCBqb2JfaWQ6IHN0cikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgYsOhbyBjw6FvIGpvYiBj4bunYSBHb0xpa2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2JfaWQ6IElEIGPhu6dhIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgYsOhbyBjw6FvIGpvYgogICAgICAgICIiIgogICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9L2pvYnMve2pvYl9pZH0vcmVwb3J0IgogICAgCiAgICBkZWYgZ2V0X2pvYl9wYXJhbXMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRoYW0gc+G7kSDEkeG7gyBn4buNaSBBUEkgbOG6pXkgam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IFRoYW0gc+G7kQogICAgICAgICIiIgogICAgICAgICMgTeG6t2MgxJHhu4tuaCBraMO0bmcgY8OzIHRoYW0gc+G7kSwgY+G6p24gb3ZlcnJpZGUg4bufIGzhu5twIGNvbgogICAgICAgIHJldHVybiB7fQogICAgCiAgICBkZWYgZ2V0X2FjY291bnRzX2Zyb21fZGV2aWNlKHNlbGYpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIlBoxrDGoW5nIHRo4bupYyBjxqEgc+G7nyDEkeG7gyBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiwgY+G6p24gb3ZlcnJpZGUg4bufIGNsYXNzIGNvbiIiIgogICAgICAgIHJldHVybiBbXQogICAgCiAgICBkZWYgc2V0X3NsZWVwX2Z1bmN0aW9uKHNlbGYsIHNsZWVwX2Z1bmM6IENhbGxhYmxlW1tmbG9hdF0sIGJvb2xdKToKICAgICAgICAiIiIKICAgICAgICDEkOG6t3QgaMOgbSBzbGVlcCB0w7l5IGNo4buJbmgKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBzbGVlcF9mdW5jOiBIw6BtIHNsZWVwIG5o4bqtbiBt4buZdCB0aGFtIHPhu5EgbMOgIHPhu5EgZ2nDonkgdsOgIHRy4bqjIHbhu4EgVHJ1ZSBu4bq/dSBzbGVlcCDEkeG7pyB0aOG7nWkgZ2lhbiwKICAgICAgICAgICAgICAgICAgICAgICAgRmFsc2UgbuG6v3UgYuG7iyBk4burbmcgbOG6oWkKICAgICAgICAiIiIKICAgICAgICBzZWxmLl9zbGVlcF9mdW5jID0gc2xlZXBfZnVuYwogICAgICAgIAogICAgZGVmIHNhZmVfc2xlZXAoc2VsZiwgc2Vjb25kczogZmxvYXQpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgTmfhu6cgYW4gdG/DoG4sIGPDsyB0aOG7gyBk4burbmcgbOG6oWkgbmdheSBs4bqtcCB04bupYwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHNlY29uZHM6IFPhu5EgZ2nDonkgY+G6p24gbmfhu6cKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBuZ+G7pyDEkeG7pyB0aOG7nWkgZ2lhbiwgRmFsc2UgbuG6v3UgYuG7iyBk4burbmcgbOG6oWkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fc2xlZXBfZnVuYyhzZWNvbmRzKQogICAgCiAgICBkZWYgc3dpdGNoX3RvX2FjY291bnQoc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaHV54buDbiDEkeG7lWkgc2FuZyB0w6BpIGtob+G6o24gbeG7pWMgdGnDqnUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXJnZXRfYWNjb3VudDogVMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuIMSR4bq/bgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogewogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBib29sLAogICAgICAgICAgICAgICAgJ3JlYXNvbic6IHN0ciAobuG6v3UgdGjhuqV0IGLhuqFpKSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJzogc3RyCiAgICAgICAgICAgIH0KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkGFuZyBjaHV54buDbiDEkeG7lWkgc2FuZyB0w6BpIGtob+G6o24ge3RhcmdldF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJ3Vua25vd24nKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6t3QgdGjhu51pIGdpYW4gY2jhu50gdOG7kWkgxJFhIChnacOieSkKICAgICAgICAgICAgdGltZW91dCA9IDYwCiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB1c2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcAogICAgICAgICAgICBjdXJyZW50X3VzZXJuYW1lID0gc2VsZi5nZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoKQogICAgICAgICAgICB0YXJnZXRfdXNlcm5hbWUgPSB0YXJnZXRfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IMSRw6MgxJHEg25nIG5o4bqtcCDEkcO6bmcgdMOgaSBraG/huqNuIHLhu5NpLCBraMO0bmcgY+G6p24gY2h1eeG7g24gxJHhu5VpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfdXNlcm5hbWUgYW5kIGN1cnJlbnRfdXNlcm5hbWUgPT0gdGFyZ2V0X3VzZXJuYW1lOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgxJHEg25nIG5o4bqtcCB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gcuG7k2kiKQogICAgICAgICAgICAgICAgcmV0dXJuIHsnc3VjY2Vzcyc6IFRydWUsICdtZXNzYWdlJzogZifEkMOjIMSRxINuZyBuaOG6rXAgdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9J30KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgY2jGsGEgxJHEg25nIG5o4bqtcCDEkcO6bmcgdMOgaSBraG/huqNuLCB0aOG7sWMgaGnhu4duIGNodXnhu4NuIMSR4buVaQogICAgICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgUGjGsMahbmcgdGjhu6ljIG7DoHkgc+G6vSDEkcaw4bujYyBnaGkgxJHDqCBi4bufaSBs4bubcCBjb24gdMO5eSB0aGVvIOG7qW5nIGThu6VuZwogICAgICAgICAgICAgICAgICAgIHN3aXRjaF9yZXN1bHQgPSBzZWxmLl9wZXJmb3JtX2FjY291bnRfc3dpdGNoKHRhcmdldF9hY2NvdW50KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyB0cuG6oyB24buBIHThu6sgX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2gKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHN3aXRjaF9yZXN1bHQsIGRpY3QpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc3dpdGNoX3Jlc3VsdC5nZXQoJ3N1Y2Nlc3MnLCBGYWxzZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3dpdGNoX3Jlc3VsdCAgIyBUcuG6oyB24buBIG5nYXkgbOG7l2kgdOG7qyBfcGVyZm9ybV9hY2NvdW50X3N3aXRjaAogICAgICAgICAgICAgICAgICAgIGVsaWYgbm90IHN3aXRjaF9yZXN1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMawxqFuZyB0aMOtY2ggduG7m2kgaW1wbGVtZW50YXRpb24gY8WpIHRy4bqjIHbhu4EgYm9vbGVhbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ3N3aXRjaF9mYWlsZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnS2jDtG5nIHRo4buDIGNodXnhu4NuIHTDoGkga2hv4bqjbicKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgxJDhu6NpIG3hu5l0IGNow7p0IMSR4buDIOG7qW5nIGThu6VuZyBsb2FkIHhvbmcKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgeGVtIMSRw6MgY2h1eeG7g24gxJHDum5nIHTDoGkga2hv4bqjbiBjaMawYQogICAgICAgICAgICAgICAgICAgIG5ld191c2VybmFtZSA9IHNlbGYuZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBuZXdfdXNlcm5hbWUgYW5kIG5ld191c2VybmFtZSA9PSB0YXJnZXRfdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGNodXnhu4NuIHNhbmcgdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSRxINuZyBuaOG6rXAgdHJvbmcgREIKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5yZXNldF9sb2dpbl9zdGF0dXNfYnlfYXBwKHNlbGYuYXBwX25hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQodGFyZ2V0X2FjY291bnRbImlkIl0sIHsiaXNfbG9naW4iOiBUcnVlLCAiaXNfc3luYyI6IEZhbHNlfSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7J3N1Y2Nlc3MnOiBUcnVlLCAnbWVzc2FnZSc6IGYnQ2h1eeG7g24gc2FuZyB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gdGjDoG5oIGPDtG5nJ30KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGNoxrBhIHRow6BuaCBjw7RuZywgxJHhu6NpIG3hu5l0IGNow7p0IHLhu5NpIHRo4butIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgY2h1eeG7g24gdMOgaSBraG/huqNuOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBjaHV54buDbiBzYW5nIHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSBzYXUge3RpbWVvdXR9IGdpw6J5IikKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgJ3JlYXNvbic6ICd0aW1lb3V0JywKICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZidLaMO0bmcgdGjhu4MgY2h1eeG7g24gc2FuZyB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gc2F1IHt0aW1lb3V0fSBnacOieScKICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIGNodXnhu4NuIHTDoGkga2hv4bqjbiIpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICdyZWFzb24nOiAnZXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZidM4buXaSBraGkgY2h1eeG7g24gdMOgaSBraG/huqNuOiB7c3RyKGUpfScKICAgICAgICAgICAgfQogICAgCiAgICBkZWYgX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2goc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGPDoWMgdGhhbyB0w6FjIFVJIMSR4buDIGNodXnhu4NuIHTDoGkga2hv4bqjbgogICAgICAgIFBoxrDGoW5nIHRo4bupYyBuw6B5IGPhuqduIMSRxrDhu6NjIGdoaSDEkcOoIGLhu59pIGzhu5twIGNvbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhcmdldF9hY2NvdW50OiBUw6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24gxJHhur9uCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiB7CiAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IGJvb2wsCiAgICAgICAgICAgICAgICAncmVhc29uJzogc3RyIChu4bq/dSB0aOG6pXQgYuG6oWkgLSAnYWNjb3VudF9ub3RfZm91bmQnLCAndWlfZXJyb3InLCBldGMuKSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJzogc3RyCiAgICAgICAgICAgIH0KICAgICAgICAiIiIKICAgICAgICAjIFBoxrDGoW5nIHRo4bupYyBjxqEgc+G7nyBjaOG7iSBsb2cgY+G6o25oIGLDoW8KICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiUGjGsMahbmcgdGjhu6ljIF9wZXJmb3JtX2FjY291bnRfc3dpdGNoIGNoxrBhIMSRxrDhu6NjIHRyaeG7g24ga2hhaSBjaG8ge3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICdyZWFzb24nOiAnbm90X2ltcGxlbWVudGVkJywKICAgICAgICAgICAgJ21lc3NhZ2UnOiBmJ1BoxrDGoW5nIHRo4bupYyBfcGVyZm9ybV9hY2NvdW50X3N3aXRjaCBjaMawYSDEkcaw4bujYyB0cmnhu4NuIGtoYWkgY2hvIHtzZWxmLl9fY2xhc3NfXy5fX25hbWVfX30nCiAgICAgICAgfQogICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIGdldF9jdXJyZW50X2xvZ2dlZF9pbl91c2VybmFtZShzZWxmKSAtPiBPcHRpb25hbFtzdHJdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyIGhv4bq3YyBOb25lOiBVc2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcCwgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIGPDswogICAgICAgICIiIgogICAgICAgICMgUGjGsMahbmcgdGjhu6ljIGPGoSBz4bufIGNo4buJIGxvZyBj4bqjbmggYsOhbwogICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJQaMawxqFuZyB0aOG7qWMgZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lIGNoxrBhIMSRxrDhu6NjIHRyaeG7g24ga2hhaSBjaG8ge3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIHJlY29yZF9qb2JfaGlzdG9yeShzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSwgcmVzdWx0OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEdoaSBs4bqhaSBs4buLY2ggc+G7rSBqb2IgdsOgbyBkYXRhYmFzZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgcmVzdWx0OiBL4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVVSUQgY+G7p2EgYuG6o24gZ2hpIGzhu4tjaCBz4butIGpvYiBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZAogICAgICAgICAgICBkZXZpY2VfaWQgPSBzZWxmLmRiLmdldF9vcl9jcmVhdGVfZGV2aWNlX2lkKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2h14bqpbiBi4buLIGThu68gbGnhu4d1IGpvYiBoaXN0b3J5CiAgICAgICAgICAgIGpvYl9kYXRhID0gewogICAgICAgICAgICAgICAgImFjY291bnRfdXVpZCI6IGFjY291bnQuZ2V0KCJhY2NvdW50X3V1aWQiLCAiIiksCiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgImFwcCI6IHNlbGYuYXBwX25hbWUsCiAgICAgICAgICAgICAgICAiam9iX2lkIjogam9iLmdldCgiaWQiLCAiIiksCiAgICAgICAgICAgICAgICAiam9iX3R5cGUiOiBqb2IuZ2V0KCJ0eXBlIiwgIiIpLAogICAgICAgICAgICAgICAgIm9iamVjdF9pZCI6IGpvYi5nZXQoIm9iamVjdF9pZCIsICIiKSwKICAgICAgICAgICAgICAgICJsaW5rIjogam9iLmdldCgibGluayIsICIiKSwKICAgICAgICAgICAgICAgICJzdGF0dXMiOiByZXN1bHQuZ2V0KCJzdGF0dXMiLCAwKSwKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogcmVzdWx0LmdldCgic3VjY2VzcyIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICJwcmljZSI6IGpvYi5nZXQoInByaWNlX2FmdGVyX2Nvc3QiLCAwKSwKICAgICAgICAgICAgICAgICJlcnJvcl9tZXNzYWdlIjogcmVzdWx0LmdldCgibWVzc2FnZSIsICIiKSBpZiBub3QgcmVzdWx0LmdldCgic3VjY2VzcyIsIEZhbHNlKSBlbHNlICIiLAogICAgICAgICAgICAgICAgImNyZWF0ZWRfYXQiOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZSAgIyDEkOG6o20gYuG6o28gdHLhuqFuZyB0aMOhaSBsw6AgY2jGsGEgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgIGpvYl91dWlkID0gc2VsZi5kYi5hZGRfam9iX2hpc3Rvcnkoam9iX2RhdGEpCiAgICAgICAgICAgIGlmIGpvYl91dWlkOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiLEkMOjIGzGsHUgbOG7i2NoIHPhu60gam9iIHtqb2IuZ2V0KCdpZCcpfSB2w6BvIGRhdGFiYXNlIHbhu5tpIFVVSUQ6IHtqb2JfdXVpZH0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIktow7RuZyB0aOG7gyBsxrB1IGzhu4tjaCBz4butIGpvYiB7am9iLmdldCgnaWQnKX0gdsOgbyBkYXRhYmFzZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gam9iX3V1aWQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGdoaSBs4buLY2ggc+G7rSBqb2IiKQogICAgICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgcmVwb3J0X2pvYl9jb21wbGV0ZWQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0sIHJlcG9ydF9kYXRhOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgcmVwb3J0X2RhdGE6IEThu68gbGnhu4d1IGLDoW8gY8OhbwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgYsOhbyBjw6FvIHThu6sgQVBJCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGpvYl9pZCB04burIGpvYgogICAgICAgICAgICBqb2JfaWQgPSBqb2IuZ2V0KCJpZCIpCiAgICAgICAgICAgIGlmIG5vdCBqb2JfaWQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IGpvYl9pZCB0cm9uZyBqb2IiKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiAiS2jDtG5nIHTDrG0gdGjhuqV5IGpvYl9pZCB0cm9uZyBqb2IifQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2h14bqpbiBi4buLIGThu68gbGnhu4d1IGLDoW8gY8OhbwogICAgICAgICAgICBwYXlsb2FkID0gewogICAgICAgICAgICAgICAgImlkIjogam9iX2lkLAogICAgICAgICAgICAgICAgInN0YXR1cyI6IFRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBiw6FvIGPDoW8gbuG6v3UgY8OzCiAgICAgICAgICAgIGlmIHJlcG9ydF9kYXRhOgogICAgICAgICAgICAgICAgcGF5bG9hZC51cGRhdGUocmVwb3J0X2RhdGEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBBUEkgYsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaAogICAgICAgICAgICB1cmwgPSBzZWxmLmdldF9jb21wbGV0ZV9qb2JzX3VybCgpCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuZ29saWtlX3NlcnZpY2UuYXBpX3JlcXVlc3QodXJsLCBtZXRob2Q9IlBPU1QiLCBwYXlsb2FkPXBheWxvYWQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcmVzdWx0OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBiw6FvIGPDoW8gam9iIMSRw6MgaG/DoG4gdGjDoG5oIikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIktow7RuZyB0aOG7gyBiw6FvIGPDoW8gam9iIMSRw6MgaG/DoG4gdGjDoG5oIn0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBiw6FvIGPDoW8gam9iIHtqb2JfaWR9IGhvw6BuIHRow6BuaCB0aMOgbmggY8O0bmciKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJtZXNzYWdlIjogIsSQw6MgYsOhbyBjw6FvIGpvYiBob8OgbiB0aMOgbmggdGjDoG5oIGPDtG5nIiwgImRhdGEiOiByZXN1bHR9CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgYsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaCIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogZiJM4buXaSBraGkgYsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaDoge3N0cihlKX0ifQogICAgICAgICAgICAKICAgIGRlZiByZXBvcnRfam9iX3NraXBwZWQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0sIHJlYXNvbjogc3RyID0gIiIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIELDoW8gY8OhbyBqb2IgxJHDoyBi4buLIGLhu48gcXVhCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICByZWFzb246IEzDvSBkbyBi4buPIHF1YSBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIGLDoW8gY8OhbyB04burIEFQSQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBqb2JfaWQgdOG7qyBqb2IKICAgICAgICAgICAgam9iX2lkID0gam9iLmdldCgiaWQiKQogICAgICAgICAgICBpZiBub3Qgam9iX2lkOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBqb2JfaWQgdHJvbmcgam9iIikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIktow7RuZyB0w6xtIHRo4bqleSBqb2JfaWQgdHJvbmcgam9iIn0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIENodeG6qW4gYuG7iyBk4buvIGxp4buHdSBiw6FvIGPDoW8KICAgICAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICJpZCI6IGpvYl9pZAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGzDvSBkbyBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgcmVhc29uOgogICAgICAgICAgICAgICAgcGF5bG9hZFsicmVhc29uIl0gPSByZWFzb24KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSSBiw6FvIGPDoW8gam9iIMSRw6MgYuG7iyBi4buPIHF1YQogICAgICAgICAgICB1cmwgPSBzZWxmLmdldF9za2lwX2pvYnNfdXJsKCkKICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi5nb2xpa2Vfc2VydmljZS5hcGlfcmVxdWVzdCh1cmwsIG1ldGhvZD0iUE9TVCIsIHBheWxvYWQ9cGF5bG9hZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCByZXN1bHQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGLDoW8gY8OhbyBqb2IgxJHDoyBi4buLIGLhu48gcXVhIikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIktow7RuZyB0aOG7gyBiw6FvIGPDoW8gam9iIMSRw6MgYuG7iyBi4buPIHF1YSJ9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgYsOhbyBjw6FvIGpvYiB7am9iX2lkfSBi4buLIGLhu48gcXVhIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgIm1lc3NhZ2UiOiAixJDDoyBiw6FvIGPDoW8gam9iIGLhu4sgYuG7jyBxdWEgdGjDoG5oIGPDtG5nIiwgImRhdGEiOiByZXN1bHR9CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgYsOhbyBjw6FvIGpvYiDEkcOjIGLhu4sgYuG7jyBxdWEiKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6IGYiTOG7l2kga2hpIGLDoW8gY8OhbyBqb2IgxJHDoyBi4buLIGLhu48gcXVhOiB7c3RyKGUpfSJ9CiAgICAKICAgIGRlZiBnZXRfYWNjb3VudF9saXN0X3VybChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgVVJMIEFQSSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIEFQSSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICIiIgogICAgICAgIHJldHVybiBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS97c2VsZi5hcHBfbmFtZX0iCiAgICAgICAgCiAgICBkZWYgZ2V0X2FjY291bnRfZGV0YWlsX3VybChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgVVJMIEFQSSBjaGkgdGnhur90IHTDoGkga2hv4bqjbgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIEFQSSBjaGkgdGnhur90IHTDoGkga2hv4bqjbgogICAgICAgICIiIgogICAgICAgIHJldHVybiBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS97c2VsZi5hcHBfbmFtZX0tYWNjb3VudCIKICAgICAgICAKICAgIGRlZiBnZXRfam9iX2xpc3RfdXJsKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBVUkwgQVBJIGRhbmggc8OhY2ggam9iCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVUkwgQVBJIGRhbmggc8OhY2ggam9iCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L2FkdmVydGlzaW5nL3B1Ymxpc2hlcnMve3NlbGYuYXBwX25hbWV9L2pvYnMiCiAgICAgICAgCiAgICBkZWYgZ2V0X2pvYl9yZXBvcnRfdXJsKHNlbGYsIGpvYl9pZDogc3RyKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgVVJMIEFQSSBiw6FvIGPDoW8gam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgam9iX2lkOiBJRCBj4bunYSBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVUkwgQVBJIGLDoW8gY8OhbyBqb2IKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9L2pvYnMve2pvYl9pZH0vcmVwb3J0IgogICAgCiAgICAjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAjIEFCU1RSQUNUIE1FVEhPRFMgQ0hPIENBUkUgQUNUSU9OUyAoS0jDlE5HIFBI4bqiSSBKT0IpCiAgICAjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAKICAgIGRlZiBwZXJmb3JtX25ld3NmZWVkX2FjdGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGjDoG5oIMSR4buZbmcgdnXhu5F0IG5ld3NmZWVkL2LhuqNuZyB0aW4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJwZXJmb3JtX25ld3NmZWVkX2FjdGlvbiBjaMawYSDEkcaw4bujYyBpbXBsZW1lbnQgY2hvIHtzZWxmLl9fY2xhc3NfXy5fX25hbWVfX30iKQogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcGVyZm9ybV9yZWVsc19hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBow6BuaCDEkeG7mW5nIHhlbSByZWVscy92aWRlbwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmInBlcmZvcm1fcmVlbHNfYWN0aW9uIGNoxrBhIMSRxrDhu6NjIGltcGxlbWVudCBjaG8ge3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBwZXJmb3JtX25vdGlmaWNhdGlvbl9hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBow6BuaCDEkeG7mW5nIHhlbSB0aMO0bmcgYsOhbwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmInBlcmZvcm1fbm90aWZpY2F0aW9uX2FjdGlvbiBjaMawYSDEkcaw4bujYyBpbXBsZW1lbnQgY2hvIHtzZWxmLl9fY2xhc3NfXy5fX25hbWVfX30iKQogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcGVyZm9ybV9wcm9maWxlX2FjdGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGjDoG5oIMSR4buZbmcgeGVtIHByb2ZpbGUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJwZXJmb3JtX3Byb2ZpbGVfYWN0aW9uIGNoxrBhIMSRxrDhu6NjIGltcGxlbWVudCBjaG8ge3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBwZXJmb3JtX2V4cGxvcmVfYWN0aW9uKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gaMOgbmggxJHhu5luZyBraMOhbSBwaMOhL3TDrG0gaGnhu4N1CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYicGVyZm9ybV9leHBsb3JlX2FjdGlvbiBjaMawYSDEkcaw4bujYyBpbXBsZW1lbnQgY2hvIHtzZWxmLl9fY2xhc3NfXy5fX25hbWVfX30iKQogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcGVyZm9ybV9zZWFyY2hfYWN0aW9uKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gaMOgbmggxJHhu5luZyB0w6xtIGtp4bq/bQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmInBlcmZvcm1fc2VhcmNoX2FjdGlvbiBjaMawYSDEkcaw4bujYyBpbXBsZW1lbnQgY2hvIHtzZWxmLl9fY2xhc3NfXy5fX25hbWVfX30iKQogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICAjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAjIE1FVEhPRFMgSOG7liBUUuG7oiBDSE8gQVBQIE1BTkFHRU1FTlQKICAgICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIAogICAgQGFic3RyYWN0bWV0aG9kCiAgICBkZWYgb3Blbl9hcHAoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBN4bufIGFwcCB0xrDGoW5nIOG7qW5nCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICBwYXNzCiAgICAKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIGVuc3VyZV9ob21lX3NjcmVlbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gbcOgbiBow6xuaCBob21lIChpbXBsZW1lbnRhdGlvbiBjaHVuZykKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIG1heF9yZXRyaWVzID0gMwogICAgICAgIAogICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKG1heF9yZXRyaWVzKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBCxrDhu5tjIDE6IEtp4buDbSB0cmEgcGFja2FnZSBoaeG7h24gdOG6oWkKICAgICAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICAgICAgaWYgY3VycmVudF9wYWNrYWdlICE9IHNlbGYuYXBwX3BhY2thZ2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkFwcCBjaMawYSBt4bufIChoaeG7h24gdOG6oWk6IHtjdXJyZW50X3BhY2thZ2V9KSwgxJFhbmcgbeG7nyBhcHAuLi4iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICAgICAgIyBDaOG7nSAxMCBnacOieSBjaG8gYXBwIGto4bufaSDEkeG7mW5nCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgxMCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIELGsOG7m2MgMjogS2nhu4NtIHRyYSBjw7MgcGjhuqNpIHRyYW5nIGNo4bunIGtow7RuZwogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCLEkMOjIOG7nyBtw6BuIGjDrG5oIGhvbWUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQsaw4bubYyAzOiBWYWxpZGF0ZSBhcHAga2jDtG5nIGLhu4sgYmFubmVkCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi52YWxpZGF0ZV9hcHBfbm90X2Jhbm5lZCgpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIkFwcCBi4buLIGJhbm5lZCwgxJHDs25nIHbDoCBt4bufIGzhuqFpLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDIpOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSAgIyBSZXRyeSB04burIMSR4bqndQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIELGsOG7m2MgNDogWOG7rSBsw70gY8OhYyBkaWFsb2cgdsOgIHbhu4EgaG9tZQogICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX2RpYWxvZ3NfYW5kX25hdmlnYXRlX2hvbWUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIELGsOG7m2MgNTogS2nhu4NtIHRyYSBs4bqhaQogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJBdHRlbXB0IHthdHRlbXB0ICsgMX06IFbhuqtuIGNoxrBhIHbhu4EgxJHGsOG7o2MgaG9tZSBzY3JlZW4iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kgZW5zdXJlX2hvbWVfc2NyZWVuIGF0dGVtcHQge2F0dGVtcHQgKyAxfToge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIHbhu4EgaG9tZSBzY3JlZW4gc2F1IHttYXhfcmV0cmllc30gbOG6p24gdGjhu60iKQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIHZhbGlkYXRlX2FwcF9ub3RfYmFubmVkKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSBhcHAgY8OzIGLhu4sgYmFubmVkIGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Uga2jDtG5nIGLhu4sgYmFubmVkLCBGYWxzZSBu4bq/dSBi4buLIGJhbm5lZAogICAgICAgICIiIgogICAgICAgIHBhc3MKICAgIAogICAgZGVmIF9oYW5kbGVfZGlhbG9nc19hbmRfbmF2aWdhdGVfaG9tZShzZWxmKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSBjw6FjIGRpYWxvZyB2w6AgbmF2aWdhdGUgduG7gSBob21lIChjw7MgdGjhu4Mgb3ZlcnJpZGUgdHJvbmcgc3ViY2xhc3MpCiAgICAgICAgIiIiCiAgICAgICAgIyBEZWZhdWx0IGltcGxlbWVudGF0aW9uIC0gc3ViY2xhc3MgY8OzIHRo4buDIG92ZXJyaWRlCiAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoIsSQYW5nIHjhu60gbMO9IGRpYWxvZ3MgdsOgIG5hdmlnYXRlIHbhu4EgaG9tZS4uLiIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7rSBuaOG6pW4gYmFjayBt4buZdCB2w6BpIGzhuqduCiAgICAgICAgZm9yIF8gaW4gcmFuZ2UoMyk6CiAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAKICAgICAgICAjIE7hur91IHbhuqtuIGNoxrBhIHbhu4EgxJHGsOG7o2MgaG9tZSwgdGjhu60gdMOsbSBob21lIGJ1dHRvbgogICAgICAgIGlmIG5vdCBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgIGhvbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciKQogICAgICAgICAgICBpZiBub3QgaG9tZV9idXR0b246CiAgICAgICAgICAgICAgICBob21lX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJUcmFuZyBjaOG7pyIpCiAgICAgICAgICAgIGlmIG5vdCBob21lX2J1dHRvbjoKICAgICAgICAgICAgICAgIGhvbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IkhvbWUiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGhvbWVfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCgogICAgQGFic3RyYWN0bWV0aG9kCiAgICBkZWYgaXNfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcg4bufIG3DoG4gaMOsbmggaG9tZSBraMO0bmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRYW5nIOG7nyBob21lIHNjcmVlbgogICAgICAgICIiIgogICAgICAgIHBhc3MKICAgIAogICAgIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgIyBNRVRIT0RTIEjhu5YgVFLhu6IgQ0hPIEFDVElPTiBXRUlHSFRTIENPTkZJR1VSQVRJT04KICAgICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIAogICAgZGVmIGdldF9hY3Rpb25fd2VpZ2h0cyhzZWxmKSAtPiBEaWN0W3N0ciwgaW50XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB04buJIGzhu4cgaMOgbmggxJHhu5luZyBjaG8gYXBwIG7DoHkgLSDGsHUgdGnDqm4gdOG7qyBEQiwgZmFsbGJhY2sgduG7gSBkZWZhdWx0CiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIGludF06IFThu4kgbOG7hyBow6BuaCDEkeG7mW5nIHthY3Rpb25fbmFtZTogd2VpZ2h0X3BlcmNlbnR9CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBhcHBfY29uZmlnID0gc2VsZi5nZXRfYXBwX2NvbmZpZygpCiAgICAgICAgICAgIHJldHVybiBhcHBfY29uZmlnLmdldCgiYWN0aW9uX3dlaWdodHMiLCBzZWxmLl9kZWZhdWx0X2NvbmZpZ1siYWN0aW9uX3dlaWdodHMiXSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBs4bqleSBhY3Rpb24gd2VpZ2h0cywgZMO5bmcgZGVmYXVsdDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RlZmF1bHRfY29uZmlnWyJhY3Rpb25fd2VpZ2h0cyJdCiAgICAKICAgIGRlZiBnZXRfYXBwX2NvbmZpZyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBjb25maWcgY2hvIGFwcCBuw6B5IHThu6sgREIgduG7m2kgcHJpb3JpdHk6IGFwcF9jb25maWcg4oaSIGdsb2JhbF9jb25maWcg4oaSIGRlZmF1bHQKICAgICAgICBMdcO0biDEkeG7jWMgdOG7qyBEQiwga2jDtG5nIGNhY2hlIMSR4buDIGPDsyB0aOG7gyB1cGRhdGUgcXVhIE1RVFQKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogQ29uZmlnIGPhu6dhIGFwcCwgbWVyZ2UgdGhlbyBwcmlvcml0eQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBT4butIGThu6VuZyBEQiBzZXJ2aWNlIMSR4buDIGzhuqV5IGNvbmZpZyB24bubaSBwcmlvcml0eSBsb2dpYwogICAgICAgICAgICByZXR1cm4gc2VsZi5kYi5nZXRfYXBwX2NvbmZpZyhzZWxmLmFwcF9uYW1lLCBzZWxmLl9kZWZhdWx0X2NvbmZpZykKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBs4bqleSBhcHAgY29uZmlnLCBkw7luZyBkZWZhdWx0OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGVmYXVsdF9jb25maWcuY29weSgpCiAgICAKICAgIGRlZiBzYXZlX2FwcF9jb25maWcoc2VsZiwgY29uZmlnX3VwZGF0ZXM6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEzGsHUgY29uZmlnIGNobyBhcHAgbsOgeSB2w6BvIERCIChtZXJnZSB24bubaSBjb25maWcgaGnhu4duIHThuqFpKQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGNvbmZpZ191cGRhdGVzOiBDw6FjIGNvbmZpZyBj4bqnbiBj4bqtcCBuaOG6rXQKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmRiLnVwZGF0ZV9hcHBfY29uZmlnKHNlbGYuYXBwX25hbWUsIGNvbmZpZ191cGRhdGVzKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBsxrB1IGFwcCBjb25maWc6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgaW5pdF9kZWZhdWx0X2FwcF9jb25maWcoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgdOG6oW8gY29uZmlnIG3hurdjIMSR4buLbmggY2hvIGFwcCBu4bq/dSBjaMawYSBjw7MgdHJvbmcgREIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBjb25maWcgaGnhu4duIHThuqFpIChjaOG7iSByacOqbmcgY+G7p2EgYXBwLCBraMO0bmcgbWVyZ2UpCiAgICAgICAgICAgIGFwcF9jb25maWdfa2V5ID0gZiJ7c2VsZi5hcHBfbmFtZX1fY29uZmlnIgogICAgICAgICAgICBjdXJyZW50X2FwcF9jb25maWcgPSBzZWxmLmRiLmdldChhcHBfY29uZmlnX2tleSwge30pCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgY3VycmVudF9hcHBfY29uZmlnOgogICAgICAgICAgICAgICAgIyBDaMawYSBjw7MgY29uZmlnIHJpw6puZyBjaG8gYXBwLCBsxrB1IGRlZmF1bHQKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLmRiLnNldF9hcHBfY29uZmlnKHNlbGYuYXBwX25hbWUsIHNlbGYuX2RlZmF1bHRfY29uZmlnKQogICAgICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBraOG7n2kgdOG6oW8gY29uZmlnIG3hurdjIMSR4buLbmggY2hvIHtzZWxmLmFwcF9uYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyDEkMOjIGPDsyBjb25maWcsIGtp4buDbSB0cmEgdsOgIGLhu5Ugc3VuZyBjw6FjIGtleXMgdGhp4bq/dQogICAgICAgICAgICAgICAgdXBkYXRlZCA9IEZhbHNlCiAgICAgICAgICAgICAgICBmb3Iga2V5LCBkZWZhdWx0X3ZhbHVlIGluIHNlbGYuX2RlZmF1bHRfY29uZmlnLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgaWYga2V5IG5vdCBpbiBjdXJyZW50X2FwcF9jb25maWc6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfYXBwX2NvbmZpZ1trZXldID0gZGVmYXVsdF92YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkID0gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFNwZWNpYWwgY2hlY2sgY2hvIGFjdGlvbl93ZWlnaHRzCiAgICAgICAgICAgICAgICBpZiAiYWN0aW9uX3dlaWdodHMiIGluIGN1cnJlbnRfYXBwX2NvbmZpZyBhbmQgImFjdGlvbl93ZWlnaHRzIiBpbiBzZWxmLl9kZWZhdWx0X2NvbmZpZzoKICAgICAgICAgICAgICAgICAgICBmb3IgYWN0aW9uLCB3ZWlnaHQgaW4gc2VsZi5fZGVmYXVsdF9jb25maWdbImFjdGlvbl93ZWlnaHRzIl0uaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWN0aW9uIG5vdCBpbiBjdXJyZW50X2FwcF9jb25maWdbImFjdGlvbl93ZWlnaHRzIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2FwcF9jb25maWdbImFjdGlvbl93ZWlnaHRzIl1bYWN0aW9uXSA9IHdlaWdodAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZCA9IFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXBkYXRlZDoKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5kYi5zZXRfYXBwX2NvbmZpZyhzZWxmLmFwcF9uYW1lLCBjdXJyZW50X2FwcF9jb25maWcpCiAgICAgICAgICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IGNvbmZpZyB0aGnhur91IGNobyB7c2VsZi5hcHBfbmFtZX0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlICAjIEtow7RuZyBj4bqnbiB1cGRhdGUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2jhu59pIHThuqFvIGRlZmF1bHQgYXBwIGNvbmZpZzoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBnZXRfbWluX2FjdGlvbnNfcGVyX3Nlc3Npb24oc2VsZikgLT4gaW50OgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHPhu5EgYWN0aW9uIHThu5FpIHRoaeG7g3UgbeG7l2kgc2Vzc2lvbiB04burIGNvbmZpZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGludDogU+G7kSBhY3Rpb24gdOG7kWkgdGhp4buDdQogICAgICAgICIiIgogICAgICAgIGFwcF9jb25maWcgPSBzZWxmLmdldF9hcHBfY29uZmlnKCkKICAgICAgICByZXR1cm4gYXBwX2NvbmZpZy5nZXQoIm1pbl9hY3Rpb25zX3Blcl9zZXNzaW9uIiwgNSkKICAgIAogICAgZGVmIGdldF9yYW5kb21fc2Vzc2lvbl9kdXJhdGlvbl9taW51dGVzKHNlbGYpIC0+IGludDoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aOG7nWkgZ2lhbiBzZXNzaW9uIG5n4bqrdSBuaGnDqm4gdHJvbmcga2hv4bqjbmcgbWluLW1heCB04burIGNvbmZpZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGludDogVGjhu51pIGdpYW4gc2Vzc2lvbiBuZ+G6q3Ugbmhpw6puIChwaMO6dCkKICAgICAgICAiIiIKICAgICAgICBhcHBfY29uZmlnID0gc2VsZi5nZXRfYXBwX2NvbmZpZygpCiAgICAgICAgbWluX2R1cmF0aW9uID0gYXBwX2NvbmZpZy5nZXQoIm1pbl9zZXNzaW9uX2R1cmF0aW9uX21pbnV0ZXMiLCAzMCkKICAgICAgICBtYXhfZHVyYXRpb24gPSBhcHBfY29uZmlnLmdldCgibWF4X3Nlc3Npb25fZHVyYXRpb25fbWludXRlcyIsIDYwKQogICAgICAgIAogICAgICAgICMgxJDhuqNtIGLhuqNvIG1pbiA8PSBtYXgKICAgICAgICBpZiBtaW5fZHVyYXRpb24gPiBtYXhfZHVyYXRpb246CiAgICAgICAgICAgIG1pbl9kdXJhdGlvbiwgbWF4X2R1cmF0aW9uID0gbWF4X2R1cmF0aW9uLCBtaW5fZHVyYXRpb24KICAgICAgICAKICAgICAgICBpbXBvcnQgcmFuZG9tCiAgICAgICAgcmFuZG9tX2R1cmF0aW9uID0gcmFuZG9tLnJhbmRpbnQobWluX2R1cmF0aW9uLCBtYXhfZHVyYXRpb24pCiAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJSYW5kb20gc2Vzc2lvbiBkdXJhdGlvbjoge3JhbmRvbV9kdXJhdGlvbn0gcGjDunQgKHJhbmdlOiB7bWluX2R1cmF0aW9ufS17bWF4X2R1cmF0aW9ufSkiKQogICAgICAgIAogICAgICAgIHJldHVybiByYW5kb21fZHVyYXRpb24KICAgIAogICAgZGVmIGdldF9taW5fc2Vzc2lvbl9kdXJhdGlvbl9taW51dGVzKHNlbGYpIC0+IGludDoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aOG7nWkgZ2lhbiB04buRaSB0aGnhu4N1IG3hu5dpIHNlc3Npb24gdOG7qyBjb25maWcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBpbnQ6IFRo4budaSBnaWFuIHThu5FpIHRoaeG7g3UgKHBow7p0KQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLmdldF9jb25maWcoIm1pbl9zZXNzaW9uX2R1cmF0aW9uX21pbnV0ZXMiLCAzMCkKICAgIAogICAgZGVmIGdldF9tYXhfc2Vzc2lvbl9kdXJhdGlvbl9taW51dGVzKHNlbGYpIC0+IGludDoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aOG7nWkgZ2lhbiB04buRaSDEkWEgbeG7l2kgc2Vzc2lvbiB04burIGNvbmZpZyAoYmFja3dhcmQgY29tcGF0aWJpbGl0eSkKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBpbnQ6IFRo4budaSBnaWFuIHThu5FpIMSRYSAocGjDunQpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0X2NvbmZpZygibWF4X3Nlc3Npb25fZHVyYXRpb25fbWludXRlcyIsIDYwKQogICAgCiAgICBkZWYgZ2V0X2FjdGlvbl9kZWxheV9yYW5nZShzZWxmKSAtPiB0dXBsZVtpbnQsIGludF06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkga2hv4bqjbmcgZGVsYXkgZ2nhu69hIGPDoWMgYWN0aW9ucyB04burIGNvbmZpZyAocHJpb3JpdHk6IGFwcCDihpIgZ2xvYmFsIOKGkiBkZWZhdWx0KQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHR1cGxlW2ludCwgaW50XTogKG1pbl9kZWxheSwgbWF4X2RlbGF5KSB0cm9uZyBnacOieQogICAgICAgICIiIgogICAgICAgICMgU+G7rSBk4bulbmcgZ2V0X2NvbmZpZyDEkeG7gyBjw7MgcHJpb3JpdHkgc3lzdGVtOiBhcHAg4oaSIGdsb2JhbCDihpIgZGVmYXVsdAogICAgICAgIG1pbl9kZWxheSA9IHNlbGYuZ2V0X2NvbmZpZygiYWN0aW9uX2RlbGF5X21pbiIsIDIpICAjIERlZmF1bHQ6IDIgZ2nDonkKICAgICAgICBtYXhfZGVsYXkgPSBzZWxmLmdldF9jb25maWcoImFjdGlvbl9kZWxheV9tYXgiLCA4KSAgIyBEZWZhdWx0OiA4IGdpw6J5CiAgICAgICAgcmV0dXJuIChtaW5fZGVsYXksIG1heF9kZWxheSkKICAgIAogICAgZGVmIHNob3VsZF9za2lwX2pvYl9hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSBjw7MgbsOqbiBza2lwIGpvYiBhY3Rpb24ga2jDtG5nIGThu7FhIHRyw6puIGNvbmZpZyB2w6AgdHLhuqFuZyB0aMOhaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgbsOqbiBza2lwIGpvYiBhY3Rpb24KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBhY3Rpb25fd2VpZ2h0cyDEkeG7gyBxdXnhur90IMSR4buLbmggY8OzIGzDoG0gam9iIGtow7RuZwogICAgICAgICAgICBhY3Rpb25fd2VpZ2h0cyA9IHNlbGYuZ2V0X2FjdGlvbl93ZWlnaHRzKCkKICAgICAgICAgICAgam9iX3dlaWdodCA9IGFjdGlvbl93ZWlnaHRzLmdldCgiam9iIiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Ugam9iIHdlaWdodCA9IDAgdGjDrCBza2lwIGpvYiBhY3Rpb24KICAgICAgICAgICAgaWYgam9iX3dlaWdodCA9PSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw6FjIMSRaeG7gXUga2nhu4duIGpvYiB0aMaw4budbmcKICAgICAgICAgICAgcmV0dXJuIG5vdCBzZWxmLl9jYW5fcnVuX2pvYihhY2NvdW50KQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraeG7g20gdHJhIHNraXAgam9iIGFjdGlvbjoge2V9IikKICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgQW4gdG/DoG4gLSBza2lwIG7hur91IGzhu5dpCiAgICAKICAgIGRlZiBnZXRfc3VwcG9ydGVkX2FjdGlvbnMoc2VsZikgLT4gTGlzdFtzdHJdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGRhbmggc8OhY2ggaMOgbmggxJHhu5luZyDEkcaw4bujYyBo4buXIHRy4bujIGLhu59pIGFwcCBuw6B5CiAgICAgICAgQXBwIGPDsyB0aOG7gyBvdmVycmlkZSDEkeG7gyBo4buXIHRy4bujIGPDoWMgaMOgbmggxJHhu5luZyBraMOhYyBuaGF1CiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtzdHJdOiBEYW5oIHPDoWNoIGFjdGlvbiBuYW1lcyDEkcaw4bujYyBo4buXIHRy4bujCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGxpc3Qoc2VsZi5nZXRfYWN0aW9uX3dlaWdodHMoKS5rZXlzKCkpCiAgICAKICAgIGRlZiBwZXJmb3JtX2FjdGlvbihzZWxmLCBhY3Rpb246IHN0ciwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBow6BuaCDEkeG7mW5nIMSRxrDhu6NjIGNo4buJIMSR4buLbmggduG7m2kgY29uZmlnLWJhc2VkIGxvZ2ljCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWN0aW9uOiBUw6puIGjDoG5oIMSR4buZbmcKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBhY3Rpb24gY8OzIMSRxrDhu6NjIGjhu5cgdHLhu6Mga2jDtG5nCiAgICAgICAgICAgIGlmIGFjdGlvbiBub3QgaW4gc2VsZi5nZXRfc3VwcG9ydGVkX2FjdGlvbnMoKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJBY3Rpb24gJ3thY3Rpb259JyBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7oyBi4bufaSB7c2VsZi5fX2NsYXNzX18uX19uYW1lX199IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBY4butIGzDvSDEkeG6t2MgYmnhu4d0IGNobyBqb2IgYWN0aW9uIGThu7FhIHRyw6puIGNvbmZpZwogICAgICAgICAgICBpZiBhY3Rpb24gPT0gImpvYiI6CiAgICAgICAgICAgICAgICBpZiBzZWxmLnNob3VsZF9za2lwX2pvYl9hY3Rpb24oYWNjb3VudCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlNraXAgam9iIGFjdGlvbiBjaG8ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gdGhlbyBjb25maWciKQogICAgICAgICAgICAgICAgICAgICMgVGhheSB0aOG6vyBi4bqxbmcgYWN0aW9uIGtow6FjIChraMO0bmcgcGjhuqNpIGpvYikKICAgICAgICAgICAgICAgICAgICBhbHRlcm5hdGl2ZV9hY3Rpb24gPSBzZWxmLl9jaG9vc2VfYWx0ZXJuYXRpdmVfYWN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBpZiBhbHRlcm5hdGl2ZV9hY3Rpb246CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUaOG7sWMgaGnhu4duIHthbHRlcm5hdGl2ZV9hY3Rpb259IHRoYXkgY2hvIGpvYiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnBlcmZvcm1fYWN0aW9uKGFsdGVybmF0aXZlX2FjdGlvbiwgYWNjb3VudCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBO4bq/dSBraMO0bmcgY8OzIGFsdGVybmF0aXZlLCBjb2kgbmjGsCB0aMOgbmggY8O0bmcKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu60gZ+G7jWkgbWV0aG9kIMSR4buZbmcgY2hvIGFjdGlvbiB0w7l5IGNo4buJbmggdHLGsOG7m2MKICAgICAgICAgICAgY3VzdG9tX21ldGhvZF9uYW1lID0gZiJwZXJmb3JtX3thY3Rpb259X2FjdGlvbiIKICAgICAgICAgICAgaWYgaGFzYXR0cihzZWxmLCBjdXN0b21fbWV0aG9kX25hbWUpOgogICAgICAgICAgICAgICAgY3VzdG9tX21ldGhvZCA9IGdldGF0dHIoc2VsZiwgY3VzdG9tX21ldGhvZF9uYW1lKQogICAgICAgICAgICAgICAgaWYgY2FsbGFibGUoY3VzdG9tX21ldGhvZCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlPhu60gZOG7pW5nIGN1c3RvbSBtZXRob2QgJ3tjdXN0b21fbWV0aG9kX25hbWV9JyBjaG8gYWN0aW9uICd7YWN0aW9ufSciKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXN0b21fbWV0aG9kKGFjY291bnQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE1hcHBpbmcgY8OhYyBhY3Rpb25zIHThu5tpIG1ldGhvZHMgY2h14bqpbgogICAgICAgICAgICBzdGFuZGFyZF9hY3Rpb25fbWV0aG9kcyA9IHsKICAgICAgICAgICAgICAgICJuZXdzZmVlZCI6IHNlbGYucGVyZm9ybV9uZXdzZmVlZF9hY3Rpb24sCiAgICAgICAgICAgICAgICAicmVlbHMiOiBzZWxmLnBlcmZvcm1fcmVlbHNfYWN0aW9uLAogICAgICAgICAgICAgICAgIm5vdGlmaWNhdGlvbiI6IHNlbGYucGVyZm9ybV9ub3RpZmljYXRpb25fYWN0aW9uLAogICAgICAgICAgICAgICAgInByb2ZpbGUiOiBzZWxmLnBlcmZvcm1fcHJvZmlsZV9hY3Rpb24sCiAgICAgICAgICAgICAgICAiam9iIjogc2VsZi5wZXJmb3JtX2pvYl9hY3Rpb24sCiAgICAgICAgICAgICAgICAiZXhwbG9yZSI6IHNlbGYucGVyZm9ybV9leHBsb3JlX2FjdGlvbiwKICAgICAgICAgICAgICAgICJzZWFyY2giOiBzZWxmLnBlcmZvcm1fc2VhcmNoX2FjdGlvbiwKICAgICAgICAgICAgICAgICJwb3N0Ijogc2VsZi5wZXJmb3JtX3Bvc3RfYWN0aW9uCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgbWV0aG9kIHTGsMahbmcg4bupbmcgduG7m2kgYWN0aW9uCiAgICAgICAgICAgIGFjdGlvbl9tZXRob2QgPSBzdGFuZGFyZF9hY3Rpb25fbWV0aG9kcy5nZXQoYWN0aW9uKQogICAgICAgICAgICBpZiBub3QgYWN0aW9uX21ldGhvZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgbWV0aG9kIGNobyBhY3Rpb24gJ3thY3Rpb259JyIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBhY3Rpb24KICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlRo4buxYyBoaeG7h24gYWN0aW9uICd7YWN0aW9ufScgY2hvIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICAgICAgICAgcmV0dXJuIGFjdGlvbl9tZXRob2QoYWNjb3VudCkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIHRo4buxYyBoaeG7h24gYWN0aW9uICd7YWN0aW9ufSc6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2Nob29zZV9hbHRlcm5hdGl2ZV9hY3Rpb24oc2VsZikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICAiIiIKICAgICAgICBDaOG7jW4gYWN0aW9uIHRoYXkgdGjhur8ga2hpIGtow7RuZyB0aOG7gyBsw6BtIGpvYgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVMOqbiBhY3Rpb24gdGhheSB0aOG6vywgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIGPDswogICAgICAgICIiIgogICAgICAgIGltcG9ydCByYW5kb20KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgYWN0aW9uIHdlaWdodHMga2jDtG5nIGJhbyBn4buTbSBqb2IKICAgICAgICAgICAgYWN0aW9uX3dlaWdodHMgPSBzZWxmLmdldF9hY3Rpb25fd2VpZ2h0cygpCiAgICAgICAgICAgIGFsdGVybmF0aXZlX3dlaWdodHMgPSB7azogdiBmb3IgaywgdiBpbiBhY3Rpb25fd2VpZ2h0cy5pdGVtcygpIGlmIGsgIT0gImpvYiJ9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgYWx0ZXJuYXRpdmVfd2VpZ2h0czoKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4buNbiByYW5kb20gdGhlbyB3ZWlnaHQKICAgICAgICAgICAgYWN0aW9ucyA9IGxpc3QoYWx0ZXJuYXRpdmVfd2VpZ2h0cy5rZXlzKCkpCiAgICAgICAgICAgIHdlaWdodHMgPSBsaXN0KGFsdGVybmF0aXZlX3dlaWdodHMudmFsdWVzKCkpCiAgICAgICAgICAgIAogICAgICAgICAgICBjaG9zZW5fYWN0aW9uID0gcmFuZG9tLmNob2ljZXMoYWN0aW9ucywgd2VpZ2h0cz13ZWlnaHRzLCBrPTEpWzBdCiAgICAgICAgICAgIHJldHVybiBjaG9zZW5fYWN0aW9uCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGNo4buNbiBhbHRlcm5hdGl2ZSBhY3Rpb246IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAibmV3c2ZlZWQiICAjIEZhbGxiYWNrIHRvIG5ld3NmZWVkCiAgICAKICAgIGRlZiBjYWxjdWxhdGVfYWN0aW9uc19uZWVkZWRfZm9yX3Nlc3Npb24oc2VsZiwgYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dKSAtPiBpbnQ6CiAgICAgICAgIiIiCiAgICAgICAgVMOtbmggdG/DoW4gc+G7kSBhY3Rpb25zIGPhuqduIHRoaeG6v3QgY2hvIHNlc3Npb24gZOG7sWEgdHLDqm4gY29uZmlnIHbDoCBz4buRIGpvYnMgY8OzIHRo4buDCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGludDogU+G7kSBhY3Rpb25zIGPhuqduIHRo4buxYyBoaeG7h24gdHJvbmcgc2Vzc2lvbgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBjb25maWcgbWluIGFjdGlvbnMKICAgICAgICAgICAgbWluX2FjdGlvbnMgPSBzZWxmLmdldF9taW5fYWN0aW9uc19wZXJfc2Vzc2lvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bq/bSBz4buRIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgbMOgbSBqb2IKICAgICAgICAgICAgam9iX2NhcGFibGVfYWNjb3VudHMgPSAwCiAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGFjY291bnRzOgogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2hvdWxkX3NraXBfam9iX2FjdGlvbihhY2NvdW50KToKICAgICAgICAgICAgICAgICAgICBqb2JfY2FwYWJsZV9hY2NvdW50cyArPSAxCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEJhc2UgYWN0aW9ucyBk4buxYSB0csOqbiBz4buRIHTDoGkga2hv4bqjbgogICAgICAgICAgICAjIE3hu5dpIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgbMOgbSBqb2Igc+G6vSB0xrDGoW5nIOG7qW5nIHbhu5tpIDItMyBhY3Rpb25zCiAgICAgICAgICAgIGRlZmF1bHRfYWN0aW9uc19wZXJfYWNjb3VudCA9IDIuNQogICAgICAgICAgICBhY3Rpb25zX2Zyb21fYWNjb3VudHMgPSBpbnQoam9iX2NhcGFibGVfYWNjb3VudHMgKiBkZWZhdWx0X2FjdGlvbnNfcGVyX2FjY291bnQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IG1heCBnaeG7r2EgYWN0aW9ucyB04burIGFjY291bnRzIHbDoCBtaW4gYWN0aW9ucwogICAgICAgICAgICB0b3RhbF9hY3Rpb25zID0gbWF4KGFjdGlvbnNfZnJvbV9hY2NvdW50cywgbWluX2FjdGlvbnMpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOtbmggdG/DoW4gYWN0aW9ucyBjaG8gc2Vzc2lvbjoge2pvYl9jYXBhYmxlX2FjY291bnRzfSBhY2NvdW50cyBjw7MgdGjhu4MgbMOgbSB2aeG7h2MsICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgZiJ7ZGVmYXVsdF9hY3Rpb25zX3Blcl9hY2NvdW50fSBhY3Rpb25zL2FjY291bnQgPSB7YWN0aW9uc19mcm9tX2FjY291bnRzfSBhY3Rpb25zIHThu6sgYWNjb3VudHMsICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgZiJtaW4ge21pbl9hY3Rpb25zfSA9PiB0b3RhbCB7dG90YWxfYWN0aW9uc30gYWN0aW9ucyIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdG90YWxfYWN0aW9ucwogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kgdMOtbmggdG/DoW4gYWN0aW9ucyBuZWVkZWQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldF9taW5fYWN0aW9uc19wZXJfc2Vzc2lvbigpICAjIEZhbGxiYWNrCiAgICAKICAgIGRlZiBjaG9vc2Vfd2VpZ2h0ZWRfYWN0aW9uKHNlbGYsIGV4Y2x1ZGVfYWN0aW9uczogTGlzdFtzdHJdID0gTm9uZSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIENo4buNbiBhY3Rpb24gdGhlbyB3ZWlnaHQgdOG7qyBjb25maWcKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBleGNsdWRlX2FjdGlvbnM6IERhbmggc8OhY2ggYWN0aW9ucyBj4bqnbiBsb+G6oWkgdHLhu6sKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBBY3Rpb24gxJHGsOG7o2MgY2jhu41uCiAgICAgICAgIiIiCiAgICAgICAgaW1wb3J0IHJhbmRvbQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgYWN0aW9uX3dlaWdodHMgPSBzZWxmLmdldF9hY3Rpb25fd2VpZ2h0cygpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSB0cuG7qyBhY3Rpb25zIGtow7RuZyBtb25nIG114buRbgogICAgICAgICAgICBpZiBleGNsdWRlX2FjdGlvbnM6CiAgICAgICAgICAgICAgICBhY3Rpb25fd2VpZ2h0cyA9IHtrOiB2IGZvciBrLCB2IGluIGFjdGlvbl93ZWlnaHRzLml0ZW1zKCkgaWYgayBub3QgaW4gZXhjbHVkZV9hY3Rpb25zfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGFjdGlvbl93ZWlnaHRzOgogICAgICAgICAgICAgICAgcmV0dXJuICJuZXdzZmVlZCIgICMgRmFsbGJhY2sKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2jhu41uIHJhbmRvbSB0aGVvIHdlaWdodAogICAgICAgICAgICBhY3Rpb25zID0gbGlzdChhY3Rpb25fd2VpZ2h0cy5rZXlzKCkpCiAgICAgICAgICAgIHdlaWdodHMgPSBsaXN0KGFjdGlvbl93ZWlnaHRzLnZhbHVlcygpKQogICAgICAgICAgICAKICAgICAgICAgICAgY2hvc2VuX2FjdGlvbiA9IHJhbmRvbS5jaG9pY2VzKGFjdGlvbnMsIHdlaWdodHM9d2VpZ2h0cywgaz0xKVswXQogICAgICAgICAgICByZXR1cm4gY2hvc2VuX2FjdGlvbgogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBjaOG7jW4gd2VpZ2h0ZWQgYWN0aW9uOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gIm5ld3NmZWVkIiAgIyBGYWxsYmFjawogICAgCiAgICBkZWYgcGVyZm9ybV9qb2JfYWN0aW9uKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gaMOgbmggxJHhu5luZyBsw6BtIGpvYiAtIENvbXBsZXRlIGpvYiBwcm9jZXNzaW5nIHBpcGVsaW5lCiAgICAgICAgCiAgICAgICAgUGlwZWxpbmU6CiAgICAgICAgMS4gVmFsaWRhdGUgR29MaWtlIGhlYWRlcnMKICAgICAgICAyLiBWYWxpZGF0ZSBhY2NvdW50IGNhbiBydW4gam9iCiAgICAgICAgMy4gRmV0Y2ggam9iIGZyb20gR29MaWtlICAKICAgICAgICA0LiBVcGRhdGUgZGV2aWNlIG1lc3NhZ2UKICAgICAgICA1LiBWYWxpZGF0ZSBqb2IgYmVmb3JlIGV4ZWN1dGlvbgogICAgICAgIDYuIEV4ZWN1dGUgam9iCiAgICAgICAgNy4gUmVwb3J0IGpvYiByZXN1bHQgdG8gR29MaWtlCiAgICAgICAgOC4gVXBkYXRlIGpvYiBzdGF0aXN0aWNzCiAgICAgICAgCiAgICAgICAgQXBwIGPDsyB0aOG7gyBvdmVycmlkZSDEkeG7gyBjw7MgbG9naWMgbMOgbSBqb2IgcmnDqm5nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVzZXJuYW1lID0gYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgIGFjY291bnRfaWQgPSBhY2NvdW50LmdldCgiaWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkzDoG0gam9iIGNobyB7dXNlcm5hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAwOiBLaeG7g20gdHJhIHjDoWMgdGjhu7FjIEdvTGlrZQogICAgICAgICAgICBpZiBub3Qgc2VsZi5pc19nb2xpa2VfYXV0aGVudGljYXRlZCgpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELGsOG7m2MgMTogS2nhu4NtIHRyYSBjw7MgdGjhu4MgbMOgbSBqb2Iga2jDtG5nCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9jYW5fcnVuX2pvYihhY2NvdW50KToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJBY2NvdW50IHt1c2VybmFtZX0ga2jDtG5nIHRo4buDIGzDoG0gam9iIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDI6IEZldGNoIGpvYiB04burIEdvTGlrZQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTOG6pXkgam9iIGNobyB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSIpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGpvYiA9IHNlbGYuZmV0Y2hfam9iKGFjY291bnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBqb2I6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIktow7RuZyBjw7Mgam9iIGNobyB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGzhuqV5IGpvYiBjaG8gdMOgaSBraG/huqNuIHt1c2VybmFtZX06IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAzOiBD4bqtcCBuaOG6rXQgZGV2aWNlIG1lc3NhZ2UgY2hvIGpvYgogICAgICAgICAgICBzZWxmLnVwZGF0ZV9kZXZpY2VfbWVzc2FnZV9mb3Jfam9iKGFjY291bnQsIGpvYikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyA0OiBWYWxpZGF0ZSBqb2IKICAgICAgICAgICAgaWYgbm90IHNlbGYudmFsaWRhdGVfam9iX3dpdGhfaGFuZGxlcihhY2NvdW50LCBqb2IpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkpvYiBraMO0bmcgaOG7o3AgbOG7hyBob+G6t2MgxJHDoyBza2lwIGNobyB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlICAjIFNraXAgam9iIGtow7RuZyBwaOG6o2kgbOG7l2kKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyA1OiBUaOG7sWMgaGnhu4duIGpvYgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVGjhu7FjIGhp4buHbiBqb2IgY2hvIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9OiB7am9iLmdldCgndHlwZScsICd1bmtub3duJyl9IikKICAgICAgICAgICAgam9iX3Jlc3VsdCA9IHNlbGYuZXhlY3V0ZV9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGpvYl9yZXN1bHQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyBuaOG6rW4gxJHGsOG7o2Mga+G6v3QgcXXhuqMgam9iIHThu6sgaGFuZGxlciBjaG8ge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyA2OiBCw6FvIGPDoW8ga+G6v3QgcXXhuqMgduG7gSBHb0xpa2UKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5yZXBvcnRfam9iKGFjY291bnQsIGpvYiwgam9iX3Jlc3VsdCkKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBqb2JfcmVzdWx0LmdldCgic3VjY2VzcyIsIEZhbHNlKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgYsOhbyBjw6FvIGpvYiBjaG8ge3VzZXJuYW1lfTogc3VjY2Vzcz17c3VjY2Vzc30iKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kgYsOhbyBjw6FvIGpvYiBjaG8ge3VzZXJuYW1lfToge2V9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyA3OiBD4bqtcCBuaOG6rXQgdGjhu5FuZyBrw6ogam9iCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBqb2JfcmVzdWx0LmdldCgic3VjY2VzcyIsIEZhbHNlKQogICAgICAgICAgICBqb2JfdHlwZSA9IGpvYi5nZXQoInR5cGUiLCAiIikKICAgICAgICAgICAgc2VsZi51cGRhdGVfam9iX3N0YXRzKGFjY291bnQsIHN1Y2Nlc3MsIGpvYl90eXBlLCBqb2JfcmVzdWx0KQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGzDoG0gam9iOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9jYW5fcnVuX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSB0w6BpIGtob+G6o24gY8OzIHRo4buDIGzDoG0gam9iIGtow7RuZwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHRo4buDIGzDoG0gam9iCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIDEuIEtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBjxqEgYuG6o24KICAgICAgICAgICAgYWNjb3VudF9zdGF0dXMgPSBhY2NvdW50LmdldCgic3RhdHVzIiwgImFjdGl2ZSIpCiAgICAgICAgICAgIGlmIGFjY291bnRfc3RhdHVzIGluIFsiZGlzYWJsZWQiLCAibG9nb3V0Il06CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgaW5hY3RpdmUsIGtp4buDbSB0cmEgam9iX2Rpc2FibGVfdW50aWwKICAgICAgICAgICAgaWYgYWNjb3VudF9zdGF0dXMgPT0gImluYWN0aXZlIjoKICAgICAgICAgICAgICAgIGpvYl9kaXNhYmxlX3VudGlsID0gYWNjb3VudC5nZXQoImpvYl9kaXNhYmxlX3VudGlsIiwgMCkKICAgICAgICAgICAgICAgIGlmIGpvYl9kaXNhYmxlX3VudGlsID4gdGltZS50aW1lKCk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIDIuIEtp4buDbSB0cmEgam9iX2VuYWJsZQogICAgICAgICAgICBpZiBub3QgYWNjb3VudC5nZXQoImpvYl9lbmFibGUiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgMy4gS2nhu4NtIHRyYSDEkcOjIGxpw6puIGvhur90IEdvTGlrZSAoY+G6p24gY2hvIGpvYnMpCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50LmdldCgiaXNfZ29saWtlX2xpbmtlZCIsIEZhbHNlKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyA0LiBLaeG7g20gdHJhIMSRw6MgbG9naW4KICAgICAgICAgICAgaWYgbm90IGFjY291bnQuZ2V0KCJpc19sb2dpbiIsIEZhbHNlKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyA1LiBLaeG7g20gdHJhIGdp4bubaSBo4bqhbiBkYWlseQogICAgICAgICAgICBkYWlseV9saW1pdCA9IGFjY291bnQuZ2V0KCJqb2JfbWF4X2RheSIsIDEwMCkKICAgICAgICAgICAgZGFpbHlfY291bnQgPSBhY2NvdW50LmdldCgiam9iX3RvZGF5IiwgMCkKICAgICAgICAgICAgaWYgZGFpbHlfY291bnQgPj0gZGFpbHlfbGltaXQ6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraeG7g20gdHJhIGNhbiBydW4gam9iOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF92YWxpZGF0ZV9qb2JfYmVmb3JlX2V4ZWN1dGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBWYWxpZGF0ZSBqb2IgdHLGsOG7m2Mga2hpIHRo4buxYyBoaeG7h24KICAgICAgICBBcHAgY8OzIHRo4buDIG92ZXJyaWRlIMSR4buDIGPDsyBsb2dpYyB2YWxpZGF0ZSByacOqbmcKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Ugam9iIGjhu6NwIGzhu4cKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHZhbGlkYXRpb25fcmVzdWx0ID0gc2VsZi52YWxpZGF0ZV9qb2JfYmVmb3JlX2V4ZWN1dGlvbihhY2NvdW50LCBqb2IpCiAgICAgICAgICAgIGlmIG5vdCB2YWxpZGF0aW9uX3Jlc3VsdC5nZXQoInZhbGlkIiwgVHJ1ZSk6CiAgICAgICAgICAgICAgICBpZiB2YWxpZGF0aW9uX3Jlc3VsdC5nZXQoInNob3VsZF9za2lwIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJTa2lwIGpvYiB0aGVvIHnDqnUgY+G6p3UgdmFsaWRhdGlvbiIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJKb2Iga2jDtG5nIGjhu6NwIGzhu4cgdGhlbyB2YWxpZGF0aW9uIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIHZhbGlkYXRlIGpvYjoge2V9IikKICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgVGnhur9wIHThu6VjIG7hur91IHZhbGlkYXRlIGzhu5dpCiAgICAKICAgIGRlZiB1cGRhdGVfZGV2aWNlX21lc3NhZ2VfZm9yX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSk6CiAgICAgICAgIiIiCiAgICAgICAgQ+G6rXAgbmjhuq10IGRldmljZSBtZXNzYWdlIGNobyBqb2IgaGnhu4duIHThuqFpCiAgICAgICAgQXBwIGPDsyB0aOG7gyBvdmVycmlkZSDEkeG7gyBjdXN0b20gbWVzc2FnZSBmb3JtYXQKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsaW5rID0gam9iLmdldCgnbGluaycsICcnKQogICAgICAgICAgICAjIENsZWFuIHVwIGxpbmsgxJHhu4MgaGnhu4NuIHRo4buLIG5n4bqvbiBn4buNbiBoxqFuCiAgICAgICAgICAgIGlmIGxpbmsuc3RhcnRzd2l0aCgnaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS8nKToKICAgICAgICAgICAgICAgIGxpbmsgPSBsaW5rLnJlcGxhY2UoJ2h0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vJywgJycpCiAgICAgICAgICAgIGVsaWYgbGluay5zdGFydHN3aXRoKCdodHRwczovL3d3dy50aWt0b2suY29tLycpOgogICAgICAgICAgICAgICAgbGluayA9IGxpbmsucmVwbGFjZSgnaHR0cHM6Ly93d3cudGlrdG9rLmNvbS8nLCAnJykKICAgICAgICAgICAgCiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIlt7YWNjb3VudC5nZXQoJ2FwcCcpfV1be2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX1dW3tqb2IuZ2V0KCd0eXBlJyl9XVt7bGlua31dIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgZGV2aWNlIG1lc3NhZ2UgdGjDtG5nIHF1YSBkYiBzZXJ2aWNlCiAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZiwgJ2RiJykgYW5kIHNlbGYuZGI6CiAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCBtZXNzYWdlKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBj4bqtcCBuaOG6rXQgZGV2aWNlIG1lc3NhZ2U6IHtlfSIpCiAgICAKICAgIGRlZiB2YWxpZGF0ZV9qb2Jfd2l0aF9oYW5kbGVyKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFZhbGlkYXRlIGpvYiB0csaw4bubYyBraGkgdGjhu7FjIGhp4buHbiAtIHPhu60gZOG7pW5nIGFic3RyYWN0IG1ldGhvZCB2YWxpZGF0aW9uCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGpvYiBo4bujcCBs4buHLCBGYWxzZSBu4bq/dSBj4bqnbiBza2lwIGhv4bq3YyBjb250aW51ZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgdmFsaWRhdGlvbl9yZXN1bHQgPSBzZWxmLnZhbGlkYXRlX2pvYl9iZWZvcmVfZXhlY3V0aW9uKGFjY291bnQsIGpvYikKICAgICAgICAgICAgaWYgbm90IHZhbGlkYXRpb25fcmVzdWx0LmdldCgidmFsaWQiLCBUcnVlKToKICAgICAgICAgICAgICAgIGlmIHZhbGlkYXRpb25fcmVzdWx0LmdldCgic2hvdWxkX3NraXAiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICAgICAgIyBTa2lwIGpvYgogICAgICAgICAgICAgICAgICAgIHNraXBfbWVzc2FnZSA9IHZhbGlkYXRpb25fcmVzdWx0LmdldCgibWVzc2FnZSIsICJKb2Iga2jDtG5nIGjhu6NwIGzhu4ciKQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJTa2lwIGpvYjoge3NraXBfbWVzc2FnZX0iKQogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgIyBHaGkgbOG6oWkgaGlzdG9yeSBjaG8gam9iIGLhu4sgc2tpcAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlY29yZF9qb2JfaGlzdG9yeShhY2NvdW50LCBqb2IsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAyLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiBza2lwX21lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgIyBCw6FvIHNraXAgam9iIHbhu4EgR29MaWtlCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2tpcF9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIlNraXAgam9iIGzhu5dpOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgU2xlZXAgbmfhuq9uIMSR4buDIHRyw6FuaCBzcGFtCiAgICAgICAgICAgICAgICAgICAgc2tpcF9zbGVlcF90aW1lID0gcmFuZG9tLnJhbmRpbnQoMywgMTApCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIk5naOG7iSB7c2tpcF9zbGVlcF90aW1lfXMgc2F1IGtoaSBza2lwIGpvYiDEkeG7gyB0csOhbmggc3BhbSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2xlZXBfZnVuYyhza2lwX3NsZWVwX3RpbWUpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJKb2Iga2jDtG5nIGjhu6NwIGzhu4c6IHt2YWxpZGF0aW9uX3Jlc3VsdC5nZXQoJ21lc3NhZ2UnLCAnVW5rbm93biBlcnJvcicpfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSB2YWxpZGF0ZSBqb2I6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlICAjIFRp4bq/cCB04bulYyBu4bq/dSB2YWxpZGF0ZSBs4buXaQogICAgCiAgICBkZWYgdXBkYXRlX2pvYl9zdGF0cyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgc3VjY2VzczogYm9vbCwgam9iX3R5cGU6IHN0ciwgam9iX3Jlc3VsdDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIgogICAgICAgIEPhuq1wIG5o4bqtdCB0aOG7kW5nIGvDqiBqb2IgLSBhcHAgY8OzIHRo4buDIG92ZXJyaWRlIMSR4buDIGN1c3RvbSBsb2dpYwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIHN1Y2Nlc3M6IEpvYiBjw7MgdGjDoG5oIGPDtG5nIGtow7RuZwogICAgICAgICAgICBqb2JfdHlwZTogTG/huqFpIGpvYgogICAgICAgICAgICBqb2JfcmVzdWx0OiBL4bq/dCBxdeG6oyBqb2IKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGFjY291bnRfaWQgPSBhY2NvdW50LmdldCgiaWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgICMgVMSDbmcgam9iIGNvdW50IGNobyBhY2NvdW50CiAgICAgICAgICAgICAgICBjdXJyZW50X2NvdW50ID0gYWNjb3VudC5nZXQoImpvYl90b2RheSIsIDApCiAgICAgICAgICAgICAgICBuZXdfY291bnQgPSBjdXJyZW50X2NvdW50ICsgMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTEg25nIHRvdGFsIGpvYnMKICAgICAgICAgICAgICAgIGN1cnJlbnRfdG90YWwgPSBhY2NvdW50LmdldCgidG90YWxfam9icyIsIDApCiAgICAgICAgICAgICAgICBuZXdfdG90YWwgPSBjdXJyZW50X3RvdGFsICsgMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBqb2IgY291bnQgdHJvbmcgZGF0YWJhc2UKICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZiwgJ2RiJykgYW5kIHNlbGYuZGI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JfdG9kYXkiOiBuZXdfY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0b3RhbF9qb2JzIjogbmV3X3RvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAibGFzdF9qb2JfdGltZSI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQ+G6rXAgbmjhuq10IGpvYiBjb3VudCBjaG8gYWNjb3VudCB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfTogdG9kYXk9e25ld19jb3VudH0sIHRvdGFsPXtuZXdfdG90YWx9IikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kgY+G6rXAgbmjhuq10IGpvYiBzdGF0czoge2V9Iik=').decode('utf-8'))
