import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHRocmVhZGluZwppbXBvcnQgZGF0ZXRpbWUKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgTGlzdCwgT3B0aW9uYWwKaW1wb3J0IGNvbmZpZwppbXBvcnQgdXRpbHMKZnJvbSB1dGlscyBpbXBvcnQgTG9nTGV2ZWwsIExvZ2dlcgpmcm9tIGpvYnMgaW1wb3J0IFRpa3Rva0pvYiwgSW5zdGFncmFtSm9iCgojIFThuqFvIGxvZ2dlciBjaG8gSm9iU2VydmljZQpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJKb2JTZXJ2aWNlIikKCmNsYXNzIEpvYlNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UsIGdvbGlrZV9zZXJ2aWNlKToKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgdOG6oW8gSm9iU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGRiX3NlcnZpY2U6IERhdGFiYXNlU2VydmljZSDEkeG7gyBsxrB1IHRy4buvIGThu68gbGnhu4d1CiAgICAgICAgICAgIGhlbHBlcl9zZXJ2aWNlOiBIZWxwZXJTZXJ2aWNlIMSR4buDIHTGsMahbmcgdMOhYyB24bubaSB0aGnhur90IGLhu4sKICAgICAgICAgICAgZ29saWtlX3NlcnZpY2U6IEdvTGlrZVNlcnZpY2UgxJHhu4MgZ+G7jWkgQVBJIEdvTGlrZQogICAgICAgICIiIgogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgc2VsZi5oZWxwZXIgPSBoZWxwZXJfc2VydmljZQogICAgICAgIHNlbGYuZ29saWtlX3NlcnZpY2UgPSBnb2xpa2Vfc2VydmljZQogICAgICAgIHNlbGYucnVubmluZyA9IFRydWUKICAgICAgICBzZWxmLmZvcmNlX3N0b3AgPSBGYWxzZQogICAgICAgIAogICAgICAgICMgS2jhu59pIHThuqFvIGPDoWMgam9iIGhhbmRsZXIKICAgICAgICBzZWxmLmpvYl9oYW5kbGVycyA9IHt9CiAgICAgICAgCiAgICAgICAgIyBGbGFnIMSRaeG7gXUga2hp4buDbgogICAgICAgIHNlbGYuaXNfaW5pdGlhbGl6ZWQgPSBGYWxzZQogICAgICAgIAogICAgICAgICMgVGjDtG5nIHRpbiB24buBIGPDoWMgYXBwIMSRxrDhu6NjIGvDrWNoIGhv4bqhdCAtIGzhuqV5IHThu6sgZGF0YWJhc2UgaG/hurdjIGNvbmZpZwogICAgICAgIHNlbGYuZW5hYmxlZF9hcHBzID0gc2VsZi5kYi5nZXQoImVuYWJsZWRfYXBwcyIsIGNvbmZpZy5FTkFCTEVEX0FQUFMpCiAgICAgICAgCiAgICAgICAgIyBMb2NrIMSR4buDIMSR4buTbmcgYuG7mSB0cuG6oW5nIHRow6FpCiAgICAgICAgc2VsZi5fbG9jayA9IHRocmVhZGluZy5Mb2NrKCkKICAgICAgICAKICAgICAgICAjIERpY3Rpb25hcnkgxJHhu4MgbMawdSBz4buRIGzhuqduIHRo4butIGpvYiB0aOG6pXQgYuG6oWkgdGhlbyBhY2NvdW50X2lkCiAgICAgICAgc2VsZi5mYWlsZWRfam9iX2F0dGVtcHRzID0ge30KICAgICAgICAKICAgIGRlZiBzYWZlX3NsZWVwKHNlbGYsIHNlY29uZHM6IGZsb2F0KSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIE5n4bunIGFuIHRvw6BuLCBjw7MgdGjhu4MgZOG7q25nIGzhuqFpIG5nYXkgbOG6rXAgdOG7qWMga2hpIGZvcmNlX3N0b3AgxJHGsOG7o2MgxJHhurd0IHRow6BuaCBUcnVlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2Vjb25kczogU+G7kSBnacOieSBj4bqnbiBuZ+G7pwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IG5n4bunIMSR4bunIHRo4budaSBnaWFuLCBGYWxzZSBu4bq/dSBi4buLIGThu6tuZyBs4bqhaQogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIGNoZWNrX2ludGVydmFsID0gMC41ICAjIEtp4buDbSB0cmEgbeG7l2kgMC41IGdpw6J5CiAgICAgICAgCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgc2Vjb25kczoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyB5w6p1IGPhuqd1IGThu6tuZwogICAgICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmZvcmNlX3N0b3Agb3Igbm90IHNlbGYucnVubmluZzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmfhu6cgbeG7mXQga2hv4bqjbmcgbmfhuq9uCiAgICAgICAgICAgIHNsZWVwX3RpbWUgPSBtaW4oY2hlY2tfaW50ZXJ2YWwsIHNlY29uZHMgLSAodGltZS50aW1lKCkgLSBzdGFydF90aW1lKSkKICAgICAgICAgICAgaWYgc2xlZXBfdGltZSA+IDA6CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHNsZWVwX3RpbWUpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAKICAgIGRlZiBpbml0aWFsaXplKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIHThuqFvIEpvYlNlcnZpY2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGto4bufaSB04bqhbyB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICIiIgogICAgICAgIGxvZ2dlci5pbmZvKCLEkGFuZyBraOG7n2kgdOG6oW8gSm9iU2VydmljZS4uLiIpCiAgICAgICAgCiAgICAgICAgIyAxLiBLaeG7g20gdHJhIEhlbHBlclNlcnZpY2UKICAgICAgICBoZWxwZXJfc3VjY2VzcywgaGVscGVyX2RhdGEgPSB1dGlscy5jaGVja19oZWxwZXJfc2VydmljZShzZWxmLmhlbHBlcikKICAgICAgICBpZiBub3QgaGVscGVyX3N1Y2Nlc3M6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIMSR4bq/biBIZWxwZXJTZXJ2aWNlLiBWdWkgbMOybmcga2nhu4NtIHRyYSBs4bqhaS4iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgIyBMxrB1IHRow7RuZyB0aW4gdGhp4bq/dCBi4buLIG7hur91IGPDswogICAgICAgIGlmIGhlbHBlcl9kYXRhIGFuZCAiZGF0YSIgaW4gaGVscGVyX2RhdGE6CiAgICAgICAgICAgIHNlbGYuZGIuc2F2ZV9kZXZpY2VfaW5mbyhoZWxwZXJfZGF0YSkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGzGsHUgdGjDtG5nIHRpbiB0aGnhur90IGLhu4s6IHtoZWxwZXJfZGF0YVsnZGF0YSddLmdldCgnZGV2aWNlX21vZGVsJywgJ1Vua25vd24nKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgIyAzLiBMxrB1IGPDoWMgY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaCB2w6BvIGRhdGFiYXNlIG7hur91IGNoxrBhIGPDswogICAgICAgIHNlbGYuX3NhdmVfZGVmYXVsdF9jb25maWdzKCkKICAgICAgICAgICAgCiAgICAgICAgIyA0LiBLaeG7g20gdHJhIHbDoCBs4bqleSBHb0xpa2UgaGVhZGVycyBu4bq/dSBj4bqnbgogICAgICAgIGdvbGlrZV9zdWNjZXNzID0gc2VsZi5nb2xpa2Vfc2VydmljZS5mZXRjaF9nb2xpa2VfaGVhZGVyc193aXRoX3JldHJ5KCkKICAgICAgICBpZiBub3QgZ29saWtlX3N1Y2Nlc3M6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGzhuqV5IEdvTGlrZSBoZWFkZXJzLiBWdWkgbMOybmcga2nhu4NtIHRyYSBs4bqhaS4iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICAjIDUuIEto4bufaSB04bqhbyBjw6FjIGpvYiBoYW5kbGVyCiAgICAgICAgc2VsZi5faW5pdF9qb2JfaGFuZGxlcnMoKQogICAgICAgIAogICAgICAgICMgNi4gS2jhu59pIHThuqFvIG5nw6B5IGN14buRaSBjw7luZyDEkcOjIHJlc2V0IG7hur91IGNoxrBhIGPDsyB0cm9uZyBkYXRhYmFzZQogICAgICAgIG5vdyA9IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpCiAgICAgICAgdG9kYXkgPSBub3cuZGF0ZSgpCiAgICAgICAgam9iX2hvdXIgPSBzZWxmLmRiLmdldCgiam9iX2hvdXIiLCBjb25maWcuSk9CX0hPVVIpCiAgICAgICAgcmVzZXRfdGltZSA9IGRhdGV0aW1lLmRhdGV0aW1lLmNvbWJpbmUodG9kYXksIGRhdGV0aW1lLnRpbWUoaG91cj1qb2JfaG91ciwgbWludXRlPTApKQogICAgICAgIAogICAgICAgICMgTOG6pXkgbmfDoHkgcmVzZXQgY3Xhu5FpIGPDuW5nIHThu6sgZGF0YWJhc2UKICAgICAgICBsYXN0X3Jlc2V0X2RhdGVfc3RyID0gc2VsZi5kYi5nZXQoImxhc3RfcmVzZXRfZGF0ZSIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IGxhc3RfcmVzZXRfZGF0ZV9zdHI6CiAgICAgICAgICAgICMgTuG6v3UgaGnhu4duIHThuqFpIMSRw6MgcXVhIGdp4budIHJlc2V0IGPhu6dhIG5nw6B5IGjDtG0gbmF5LCDEkcOhbmggZOG6pXUgxJHDoyByZXNldAogICAgICAgICAgICBpZiBub3cgPj0gcmVzZXRfdGltZToKICAgICAgICAgICAgICAgIGxhc3RfcmVzZXRfZGF0ZSA9IHRvZGF5CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIE7hur91IGNoxrBhIMSR4bq/biBnaeG7nSByZXNldCwgxJHDoW5oIGThuqV1IGzDoCDEkcOjIHJlc2V0IG5nw6B5IGjDtG0gcXVhCiAgICAgICAgICAgICAgICBsYXN0X3Jlc2V0X2RhdGUgPSB0b2RheSAtIGRhdGV0aW1lLnRpbWVkZWx0YShkYXlzPTEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgc2VsZi5kYi5zZXQoImxhc3RfcmVzZXRfZGF0ZSIsIGxhc3RfcmVzZXRfZGF0ZS5pc29mb3JtYXQoKSkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaOG7n2kgdOG6oW8gbmfDoHkgcmVzZXQ6IHtsYXN0X3Jlc2V0X2RhdGV9IikKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgdMOsbSB0aOG6pXkgbmfDoHkgcmVzZXQgY3Xhu5FpIGPDuW5nOiB7bGFzdF9yZXNldF9kYXRlX3N0cn0iKQogICAgICAgIAogICAgICAgIHNlbGYuaXNfaW5pdGlhbGl6ZWQgPSBUcnVlCiAgICAgICAgbG9nZ2VyLmluZm8oIkto4bufaSB04bqhbyBKb2JTZXJ2aWNlIHRow6BuaCBjw7RuZy4iKQogICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICBkZWYgX2NoZWNrX2FjY291bnRfc3luY19zdGF0dXMoc2VsZiwgYXBwX25hbWU6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiBj4bunYSBt4buZdCBhcHAKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhcHBfbmFtZTogVMOqbiDhu6luZyBk4bulbmcgY+G6p24ga2nhu4NtIHRyYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGPhuqduIMSR4buTbmcgYuG7mSBs4bqhaSwgRmFsc2UgbuG6v3Uga2jDtG5nIGPhuqduCiAgICAgICAgIiIiCiAgICAgICAgIyBM4bqleSB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mSB04burIGRhdGFiYXNlCiAgICAgICAgc3luY19zdGF0dXNfa2V5ID0gZiJ7YXBwX25hbWV9X3N5bmNfc3RhdHVzIgogICAgICAgIHN5bmNfc3RhdHVzID0gc2VsZi5kYi5nZXQoc3luY19zdGF0dXNfa2V5LCBGYWxzZSkgICMgTeG6t2MgxJHhu4tuaCBsw6AgY2jGsGEgxJHhu5NuZyBi4buZCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBjaMawYSDEkeG7k25nIGLhu5kgdGjDrCBj4bqnbiDEkeG7k25nIGLhu5kgbOG6oWkKICAgICAgICByZXR1cm4gbm90IHN5bmNfc3RhdHVzCiAgICAgICAgCiAgICBkZWYgX3VwZGF0ZV9hY2NvdW50X3N5bmNfc3RhdHVzKHNlbGYsIGFwcF9uYW1lOiBzdHIsIHN0YXR1czogYm9vbCA9IFRydWUpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiBj4bunYSBt4buZdCBhcHAKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhcHBfbmFtZTogVMOqbiDhu6luZyBk4bulbmcgY+G6p24gY+G6rXAgbmjhuq10CiAgICAgICAgICAgIHN0YXR1czogVHJ1ZSBu4bq/dSDEkcOjIMSR4buTbmcgYuG7mSwgRmFsc2UgbuG6v3UgY2jGsGEgxJHhu5NuZyBi4buZCiAgICAgICAgIiIiCiAgICAgICAgc3luY19zdGF0dXNfa2V5ID0gZiJ7YXBwX25hbWV9X3N5bmNfc3RhdHVzIgogICAgICAgIAogICAgICAgICMgQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZCiAgICAgICAgc2VsZi5kYi5zZXQoc3luY19zdGF0dXNfa2V5LCBzdGF0dXMpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mSB0w6BpIGtob+G6o24ge2FwcF9uYW1lfToge3N0YXR1c30iKQogICAgICAgIAogICAgZGVmIF9zeW5jX2FjY291bnRzX2Zvcl9hcHAoc2VsZiwgYXBwX25hbWU6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkOG7k25nIGLhu5kgdMOgaSBraG/huqNuIHbDoCBtYXAgdMOgaSBraG/huqNuIEdvTGlrZSBjaG8gbeG7mXQgYXBwIGPhu6UgdGjhu4MKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhcHBfbmFtZTogVMOqbiDhu6luZyBk4bulbmcgY+G6p24gxJHhu5NuZyBi4buZCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJHhu5NuZyBi4buZIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgYXBwX25hbWUgbm90IGluIHNlbGYuam9iX2hhbmRsZXJzOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSBqb2IgaGFuZGxlciBjaG8ge2FwcF9uYW1lfSwgYuG7jyBxdWEgxJHhu5NuZyBi4buZIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGhhbmRsZXIgPSBzZWxmLmpvYl9oYW5kbGVyc1thcHBfbmFtZV0KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgMS4gxJDhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB04burIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIMSR4buTbmcgYuG7mSB0w6BpIGtob+G6o24ge2FwcF9uYW1lfS4uLiIpCiAgICAgICAgICAgIGFjY291bnRzID0gaGFuZGxlci5zeW5jX2FjY291bnRzX3RvX2RiKCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMSR4buTbmcgYuG7mSB7bGVuKGFjY291bnRzKX0gdMOgaSBraG/huqNuIHthcHBfbmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAyLiBNYXAgdMOgaSBraG/huqNuIEdvTGlrZQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIEdvTGlrZSBjaG8ge2FwcF9uYW1lfS4uLiIpCiAgICAgICAgICAgIGdvbGlrZV9hY2NvdW50cyA9IGhhbmRsZXIuZ2V0X2dvbGlrZV9hY2NvdW50cygpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnb2xpa2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgdMOsbSB0aOG6pXkge2xlbihnb2xpa2VfYWNjb3VudHMpfSB0w6BpIGtob+G6o24gR29MaWtlIGNobyB7YXBwX25hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBM4bqleSB0w6BpIGtob+G6o24gdOG7qyB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9hY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1hcHBfbmFtZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDDgW5oIHjhuqEgdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBtYXBwZWRfYWNjb3VudHMgPSBoYW5kbGVyLm1hcF9nb2xpa2VfYWNjb3VudHMoZ29saWtlX2FjY291bnRzLCBkZXZpY2VfYWNjb3VudHMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDDoW5oIHjhuqEge2xlbihtYXBwZWRfYWNjb3VudHMpfSB0w6BpIGtob+G6o24ge2FwcF9uYW1lfSB24bubaSBHb0xpa2UiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIEdvTGlrZSBuw6BvIGNobyB7YXBwX25hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIHNlbGYuX3VwZGF0ZV9hY2NvdW50X3N5bmNfc3RhdHVzKGFwcF9uYW1lLCBUcnVlKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB2w6AgbWFwIEdvTGlrZSBjaG8ge2FwcF9uYW1lfSIpCiAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IGzDoCBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgc2VsZi5fdXBkYXRlX2FjY291bnRfc3luY19zdGF0dXMoYXBwX25hbWUsIEZhbHNlKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgIGRlZiBfc2F2ZV9kZWZhdWx0X2NvbmZpZ3Moc2VsZik6CiAgICAgICAgIiIiTMawdSBjw6FjIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmggdsOgbyBkYXRhYmFzZSBu4bq/dSBjaMawYSBjw7MiIiIKICAgICAgICBkZWZhdWx0X2NvbmZpZ3MgPSB7CiAgICAgICAgICAgICMgQ+G6pXUgaMOsbmggbGnDqm4gcXVhbiDEkeG6v24gdGjhu51pIGdpYW4gbMOgbSBqb2IKICAgICAgICAgICAgImpvYl9ob3VyIjogY29uZmlnLkpPQl9IT1VSLAogICAgICAgICAgICAiam9iX2Nvb2xkb3duX21pbnV0ZXMiOiBjb25maWcuREVGQVVMVF9DT09MRE9XTl9NSU5VVEVTLAogICAgICAgICAgICAiam9iX2NoZWNrX2ludGVydmFsIjogY29uZmlnLkpPQl9DSEVDS19JTlRFUlZBTCwKICAgICAgICAgICAgImNvb2xkb3duX2dldF9qb2JfZ29saWtlIjogMzAsICAjIFRo4budaSBnaWFuIGNo4budIChwaMO6dCkga2hpIGtow7RuZyB0w6xtIHRo4bqleSBqb2IgR29MaWtlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuqV1IGjDrG5oIGxpw6puIHF1YW4gxJHhur9uIHPhu5EgbMaw4bujbmcgam9iCiAgICAgICAgICAgICJtYXhfam9ic19wZXJfZGF5IjogY29uZmlnLk1BWF9KT0JTX1BFUl9EQVksCiAgICAgICAgICAgICJtYXhfam9ic19wZXJfc2Vzc2lvbiI6IGNvbmZpZy5NQVhfSk9CU19QRVJfU0VTU0lPTiwKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRGFuaCBzw6FjaCBjw6FjIGFwcCDEkcaw4bujYyBrw61jaCBob+G6oXQKICAgICAgICAgICAgImVuYWJsZWRfYXBwcyI6IGNvbmZpZy5FTkFCTEVEX0FQUFMsCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciBrZXksIHZhbHVlIGluIGRlZmF1bHRfY29uZmlncy5pdGVtcygpOgogICAgICAgICAgICAjIENo4buJIGzGsHUgbuG6v3UgY2jGsGEgY8OzIHRyb25nIGRhdGFiYXNlCiAgICAgICAgICAgIGlmIHNlbGYuZGIuZ2V0KGtleSkgaXMgTm9uZToKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KGtleSwgdmFsdWUpCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkMOjIGzGsHUgY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaDoge2tleX09e3ZhbHVlfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJD4bqldSBow6xuaCB7a2V5fSDEkcOjIHThu5NuIHThuqFpOiB7c2VsZi5kYi5nZXQoa2V5KX0iKQogICAgICAgIAogICAgZGVmIF9pbml0X2pvYl9oYW5kbGVycyhzZWxmKToKICAgICAgICAiIiJLaOG7n2kgdOG6oW8gY8OhYyBqb2IgaGFuZGxlciIiIgogICAgICAgICMgaW5pdCB0aMOsIHPhur0gaW5pdCBoYW5kbGVycyBjaG8gdOG6pXQgY+G6oyBjw6FjIGFwcCwgbMOgbSBhcHAgbsOgbyB0aMOsIHPhur0gdGhlbyBj4bqldSBow6xuaCBs4bqleSB04burIGRhdGFiYXNlCiAgICAgICAgZm9yIGFwcF9uYW1lIGluIGNvbmZpZy5FTkFCTEVEX0FQUFM6CiAgICAgICAgICAgIGlmIGFwcF9uYW1lID09ICJ0aWt0b2siOgogICAgICAgICAgICAgICAgc2VsZi5qb2JfaGFuZGxlcnNbYXBwX25hbWVdID0gVGlrdG9rSm9iKHNlbGYuZGIsIHNlbGYuaGVscGVyLCBzZWxmLmdvbGlrZV9zZXJ2aWNlKQogICAgICAgICAgICAgICAgIyBUcnV54buBbiBwaMawxqFuZyB0aOG7qWMgc2FmZV9zbGVlcCB2w6BvIGpvYiBoYW5kbGVyCiAgICAgICAgICAgICAgICBzZWxmLmpvYl9oYW5kbGVyc1thcHBfbmFtZV0uc2V0X3NsZWVwX2Z1bmN0aW9uKHNlbGYuc2FmZV9zbGVlcCkKICAgICAgICAgICAgZWxpZiBhcHBfbmFtZSA9PSAiaW5zdGFncmFtIjoKICAgICAgICAgICAgICAgIHNlbGYuam9iX2hhbmRsZXJzW2FwcF9uYW1lXSA9IEluc3RhZ3JhbUpvYihzZWxmLmRiLCBzZWxmLmhlbHBlciwgc2VsZi5nb2xpa2Vfc2VydmljZSkKICAgICAgICAgICAgICAgICMgVHJ1eeG7gW4gcGjGsMahbmcgdGjhu6ljIHNhZmVfc2xlZXAgdsOgbyBqb2IgaGFuZGxlcgogICAgICAgICAgICAgICAgc2VsZi5qb2JfaGFuZGxlcnNbYXBwX25hbWVdLnNldF9zbGVlcF9mdW5jdGlvbihzZWxmLnNhZmVfc2xlZXApCiAgICAgICAgICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6Mga2jhu59pIHThuqFvIHtsZW4oc2VsZi5qb2JfaGFuZGxlcnMpfSBqb2IgaGFuZGxlcjogeycsICcuam9pbihzZWxmLmpvYl9oYW5kbGVycy5rZXlzKCkpfSIpCiAgICAgICAgCiAgICBkZWYgX3Jlc2V0X2RhaWx5X2NvdW50ZXJzKHNlbGYpOgogICAgICAgICIiIlJlc2V0IGLhu5kgxJHhur9tIGjDoG5nIG5nw6B5IHbDoG8gZ2nhu50gxJHGsOG7o2MgY+G6pXUgaMOsbmgiIiIKICAgICAgICBub3cgPSBkYXRldGltZS5kYXRldGltZS5ub3coKQogICAgICAgIHRvZGF5ID0gbm93LmRhdGUoKQogICAgICAgIAogICAgICAgICMgTOG6pXkgZ2nhu50gcmVzZXQgdOG7qyBj4bqldSBow6xuaCBob+G6t2MgdOG7qyBkYXRhYmFzZSBu4bq/dSBjw7MKICAgICAgICBqb2JfaG91ciA9IHNlbGYuZGIuZ2V0KCJqb2JfaG91ciIsIGNvbmZpZy5KT0JfSE9VUikKICAgICAgICAKICAgICAgICAjIFTDrW5oIHRo4budaSDEkWnhu4NtIHJlc2V0IGPhu6dhIG5nw6B5IGjDtG0gbmF5CiAgICAgICAgcmVzZXRfdGltZSA9IGRhdGV0aW1lLmRhdGV0aW1lLmNvbWJpbmUodG9kYXksIGRhdGV0aW1lLnRpbWUoaG91cj1qb2JfaG91ciwgbWludXRlPTApKQogICAgICAgIAogICAgICAgICMgTOG6pXkgbmfDoHkgcmVzZXQgY3Xhu5FpIGPDuW5nIHThu6sgZGF0YWJhc2UKICAgICAgICBsYXN0X3Jlc2V0X2RhdGVfc3RyID0gc2VsZi5kYi5nZXQoImxhc3RfcmVzZXRfZGF0ZSIpCiAgICAgICAgbGFzdF9yZXNldF9kYXRlID0gTm9uZQogICAgICAgIAogICAgICAgIGlmIGxhc3RfcmVzZXRfZGF0ZV9zdHI6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGxhc3RfcmVzZXRfZGF0ZSA9IGRhdGV0aW1lLmRhdGUuZnJvbWlzb2Zvcm1hdChsYXN0X3Jlc2V0X2RhdGVfc3RyKQogICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIsSQ4buLbmggZOG6oW5nIG5nw6B5IHJlc2V0IGtow7RuZyBo4bujcCBs4buHOiB7bGFzdF9yZXNldF9kYXRlX3N0cn0iKQogICAgICAgICAgICAgICAgbGFzdF9yZXNldF9kYXRlID0gTm9uZQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyBxdWEgZ2nhu50gcmVzZXQgY+G7p2EgbmfDoHkgaMO0bSBuYXkgY2jGsGEgdsOgIGNoxrBhIHJlc2V0IHRyb25nIG5nw6B5IGjDtG0gbmF5CiAgICAgICAgaWYgbm93ID49IHJlc2V0X3RpbWUgYW5kIChsYXN0X3Jlc2V0X2RhdGUgaXMgTm9uZSBvciBsYXN0X3Jlc2V0X2RhdGUgPCB0b2RheSk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVGjhu7FjIGhp4buHbiByZXNldCBi4buZIMSR4bq/bSBow6BuZyBuZ8OgeSAoZ2nhu50gcmVzZXQ6IHtqb2JfaG91cn06MDApIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVzZXQgY8OhYyBi4buZIMSR4bq/bSBjaG8gdOG6pXQgY+G6oyB0w6BpIGtob+G6o24KICAgICAgICAgICAgZm9yIGFwcF9uYW1lIGluIHNlbGYuZW5hYmxlZF9hcHBzOgogICAgICAgICAgICAgICAgYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9YXBwX25hbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGFjY291bnRzOgogICAgICAgICAgICAgICAgICAgICMgUmVzZXQgc+G7kSBqb2IgaMO0bSBuYXkgdsOgIHPhu5Egam9iIHRyb25nIHBoacOqbgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX3RvZGF5IjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgImpvYnNfZG9uZV9pbl9zZXNzaW9uIjogMAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB0w6BpIGtob+G6o24gxJFhbmcg4bufIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUgdsOsIMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHksCiAgICAgICAgICAgICAgICAgICAgIyDEkeG6t3QgbOG6oWkgdHLhuqFuZyB0aMOhaSB0aMOgbmggYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgaWYgYWNjb3VudC5nZXQoInN0YXR1cyIpID09ICJpbmFjdGl2ZSIgYW5kIGFjY291bnQuZ2V0KCJpbmFjdGl2ZV9yZWFzb24iKSA9PSAixJDDoyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGpvYiBow6BuZyBuZ8OgeSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJhY3RpdmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9kaXNhYmxlX3VudGlsIjogMAogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgxJHhurd0IGzhuqFpIHRy4bqhbmcgdGjDoWkgYWN0aXZlIGNobyB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gc2F1IGtoaSByZXNldCIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyByZXNldCBi4buZIMSR4bq/bSBow6BuZyBuZ8OgeSBjaG8gdOG6pXQgY+G6oyB0w6BpIGtob+G6o24gdsOgbyB7bm93LnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBuZ8OgeSDEkcOjIHJlc2V0IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgc2VsZi5kYi5zZXQoImxhc3RfcmVzZXRfZGF0ZSIsIHRvZGF5Lmlzb2Zvcm1hdCgpKQogICAgICAgIAogICAgZGVmIF9jYW5fcnVuX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBjw7MgdGjhu4MgY2jhuqF5IGpvYiBjaG8gdMOgaSBraG/huqNuIGtow7RuZwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHRo4buDIGNo4bqheSBqb2IsIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbgogICAgICAgIGFjY291bnRfc3RhdHVzID0gYWNjb3VudC5nZXQoInN0YXR1cyIsICJhY3RpdmUiKQogICAgICAgIAogICAgICAgICMgTuG6v3UgdMOgaSBraG/huqNuIGLhu4sgZGlzYWJsZWQsIGtow7RuZyBjaG8gY2jhuqF5IGpvYgogICAgICAgIGlmIGFjY291bnRfc3RhdHVzID09ICJkaXNhYmxlZCI6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAjIE7hur91IHTDoGkga2hv4bqjbiDEkWFuZyBpbmFjdGl2ZSwga2nhu4NtIHRyYSB0aOG7nWkgZ2lhbiBjb29sZG93bgogICAgICAgIGlmIGFjY291bnRfc3RhdHVzID09ICJpbmFjdGl2ZSI6CiAgICAgICAgICAgIGpvYl9kaXNhYmxlX3VudGlsID0gYWNjb3VudC5nZXQoImpvYl9kaXNhYmxlX3VudGlsIiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgxJHDoyBo4bq/dCB0aOG7nWkgZ2lhbiBjb29sZG93biwgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgduG7gSBhY3RpdmUKICAgICAgICAgICAgaWYgam9iX2Rpc2FibGVfdW50aWwgPD0gdGltZS50aW1lKCk6CiAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIHbhu4EgYWN0aXZlCiAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHsic3RhdHVzIjogImFjdGl2ZSJ9KQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gxJHDoyBo4bq/dCB0aOG7nWkgZ2lhbiBjaOG7nSwgxJHDoyBjaHV54buDbiB24buBIHRy4bqhbmcgdGjDoWkgYWN0aXZlIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgQ2jGsGEgaOG6v3QgdGjhu51pIGdpYW4gY2jhu50KICAgICAgICAgICAgICAgIGNvb2xkb3duX3JlbWFpbiA9IGludCgoam9iX2Rpc2FibGVfdW50aWwgLSB0aW1lLnRpbWUoKSkgLyA2MCkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IMSRYW5nIHRyb25nIHRo4budaSBnaWFuIGNo4budIChjw7JuIHtjb29sZG93bl9yZW1haW59IHBow7p0KSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiBjw7MgxJHGsOG7o2MgYuG6rXQgam9iIGtow7RuZwogICAgICAgIGlmIG5vdCBhY2NvdW50LmdldCgiam9iX2VuYWJsZSIsIEZhbHNlKToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIMSRw6MgxJHGsOG7o2MgbGnDqm4ga+G6v3QgduG7m2kgR29MaWtlIGNoxrBhCiAgICAgICAgaWYgbm90IGFjY291bnQuZ2V0KCJpc19nb2xpa2VfbGlua2VkIiwgRmFsc2UpOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHPhu5Egam9iIGjDtG0gbmF5IHNvIHbhu5tpIGdp4bubaSBo4bqhbiB0cm9uZyBqb2JfbWF4X2RheQogICAgICAgIGpvYl90b2RheSA9IGFjY291bnQuZ2V0KCJqb2JfdG9kYXkiLCAwKQogICAgICAgIGpvYl9tYXhfZGF5ID0gYWNjb3VudC5nZXQoImpvYl9tYXhfZGF5IiwgMCkKICAgICAgICAKICAgICAgICAjIE7hur91IGpvYl9tYXhfZGF5IGNoxrBhIMSRxrDhu6NjIHRoaeG6v3QgbOG6rXAsIHPhu60gZOG7pW5nIGdpw6EgdHLhu4sgbeG6t2MgxJHhu4tuaCB04burIGNvbmZpZwogICAgICAgIGlmIGpvYl9tYXhfZGF5IDw9IDA6CiAgICAgICAgICAgIGpvYl9tYXhfZGF5ID0gY29uZmlnLk1BWF9KT0JTX1BFUl9EQVkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGpvYl9tYXhfZGF5IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAiam9iX21heF9kYXkiOiBqb2JfbWF4X2RheQogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICBpZiBqb2JfdG9kYXkgPj0gam9iX21heF9kYXk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgdHJvbmcgbmfDoHkgKHtqb2JfdG9kYXl9L3tqb2JfbWF4X2RheX0pIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhurd0IHTDoGkga2hv4bqjbiB2w6BvIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUgY2hvIMSR4bq/biBuZ8OgeSBow7RtIHNhdQogICAgICAgICAgICBzZWxmLl9zZXRfYWNjb3VudF9pbmFjdGl2ZV91bnRpbF9uZXh0X3Jlc2V0KGFjY291bnRbImlkIl0sICLEkMOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIGjDoG5nIG5nw6B5IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBz4buRIGpvYiB0cm9uZyBwaGnDqm4KICAgICAgICBqb2JzX2RvbmVfaW5fc2Vzc2lvbiA9IGFjY291bnQuZ2V0KCJqb2JzX2RvbmVfaW5fc2Vzc2lvbiIsIDApCiAgICAgICAgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPSBhY2NvdW50LmdldCgibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCAwKQogICAgICAgIAogICAgICAgICMgTuG6v3UgbWF4X2pvYnNfcGVyX3Nlc3Npb24gY2jGsGEgxJHGsOG7o2MgdGhp4bq/dCBs4bqtcCwgc+G7rSBk4bulbmcgZ2nDoSB0cuG7iyBt4bq3YyDEkeG7i25oCiAgICAgICAgaWYgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPD0gMDoKICAgICAgICAgICAgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPSBjb25maWcuTUFYX0pPQlNfUEVSX1NFU1NJT04KICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IG1heF9qb2JzX3Blcl9zZXNzaW9uIHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAibWF4X2pvYnNfcGVyX3Nlc3Npb24iOiBtYXhfam9ic19wZXJfc2Vzc2lvbgogICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgIGlmIGpvYnNfZG9uZV9pbl9zZXNzaW9uID49IG1heF9qb2JzX3Blcl9zZXNzaW9uOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSDEkcOjIGzDoG0gxJHhu6cge21heF9qb2JzX3Blcl9zZXNzaW9ufSBqb2IgdHJvbmcgcGhpw6puIikKICAgICAgICAgICAgIyDEkOG6t3QgdMOgaSBraG/huqNuIHbDoG8gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZSB24bubaSB0aOG7nWkgZ2lhbiBjaOG7nSBt4bq3YyDEkeG7i25oCiAgICAgICAgICAgIHNlbGYuc2V0X2FjY291bnRfaW5hY3RpdmUoYWNjb3VudFsiaWQiXSwgaW5hY3RpdmVfcmVhc29uPSLEkMOjIGhvw6BuIHRow6BuaCBz4buRIGpvYiB04buRaSDEkWEgdHJvbmcgcGhpw6puIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgTuG6v3UgxJHDoyBraeG7g20gdHJhIHF1YSB04bqldCBj4bqjIGPDoWMgxJFp4buBdSBraeG7h24sIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgY2jhuqF5IGpvYgogICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICBkZWYgX3VwZGF0ZV9qb2Jfc3RhdHMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIHN1Y2Nlc3M6IGJvb2wgPSBUcnVlKToKICAgICAgICAiIiIKICAgICAgICBD4bqtcCBuaOG6rXQgdGjhu5FuZyBrw6ogam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgc3VjY2VzczogVHJ1ZSBu4bq/dSBqb2IgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIGpvYgogICAgICAgIGpvYl90b2RheSA9IGFjY291bnQuZ2V0KCJqb2JfdG9kYXkiLCAwKQogICAgICAgIGpvYnNfZG9uZV9pbl9zZXNzaW9uID0gYWNjb3VudC5nZXQoImpvYnNfZG9uZV9pbl9zZXNzaW9uIiwgMCkKICAgICAgICAKICAgICAgICB1cGRhdGVfZGF0YSA9IHsKICAgICAgICAgICAgImxhc3Rfam9iX3RpbWUiOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAiam9iX3RvZGF5Ijogam9iX3RvZGF5ICsgMSwKICAgICAgICAgICAgImpvYnNfZG9uZV9pbl9zZXNzaW9uIjogam9ic19kb25lX2luX3Nlc3Npb24gKyAxLAogICAgICAgICAgICAidG90YWxfam9icyI6IGFjY291bnQuZ2V0KCJ0b3RhbF9qb2JzIiwgMCkgKyAxCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIG5vdCBzdWNjZXNzOgogICAgICAgICAgICAjIE7hur91IGpvYiB0aOG6pXQgYuG6oWksIHTEg25nIHPhu5EgbOG6p24gdGjhuqV0IGLhuqFpCiAgICAgICAgICAgIHVwZGF0ZV9kYXRhWyJmYWlsZWRfam9icyJdID0gYWNjb3VudC5nZXQoImZhaWxlZF9qb2JzIiwgMCkgKyAxCiAgICAgICAgICAgIAogICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgdXBkYXRlX2RhdGEpCiAgICAgICAgCiAgICAgICAgIyBSZXNldCBz4buRIGzhuqduIHRo4butIGpvYiB0aOG6pXQgYuG6oWkgbuG6v3Ugam9iIHRow6BuaCBjw7RuZwogICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICMgUmVzZXQgdHJvbmcgYuG7mSBuaOG7mwogICAgICAgICAgICBzZWxmLmZhaWxlZF9qb2JfYXR0ZW1wdHNbYWNjb3VudFsiaWQiXV0gPSAwCiAgICAgICAgCiAgICAgICAgIyBM4bqleSBz4buRIGpvYiB04buRaSDEkWEgdHJvbmcgcGhpw6puIHThu6sgYWNjb3VudAogICAgICAgIG1heF9qb2JzX3Blcl9zZXNzaW9uID0gYWNjb3VudC5nZXQoIm1heF9qb2JzX3Blcl9zZXNzaW9uIiwgMCkKICAgICAgICAKICAgICAgICAjIE7hur91IG1heF9qb2JzX3Blcl9zZXNzaW9uIGNoxrBhIMSRxrDhu6NjIHRoaeG6v3QgbOG6rXAsIHPhu60gZOG7pW5nIGdpw6EgdHLhu4sgbeG6t2MgxJHhu4tuaAogICAgICAgIGlmIG1heF9qb2JzX3Blcl9zZXNzaW9uIDw9IDA6CiAgICAgICAgICAgIG1heF9qb2JzX3Blcl9zZXNzaW9uID0gY29uZmlnLk1BWF9KT0JTX1BFUl9TRVNTSU9OCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBtYXhfam9ic19wZXJfc2Vzc2lvbiB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgewogICAgICAgICAgICAgICAgIm1heF9qb2JzX3Blcl9zZXNzaW9uIjogbWF4X2pvYnNfcGVyX3Nlc3Npb24KICAgICAgICAgICAgfSkKICAgICAgICAKICAgICAgICAjIMSQw6MgbMOgbSDEkeG7pyBz4buRIGpvYiB0cm9uZyBwaGnDqm4sIMSR4bq3dCBpbmFjdGl2ZQogICAgICAgIGlmIChqb2JzX2RvbmVfaW5fc2Vzc2lvbiArIDEpID49IG1heF9qb2JzX3Blcl9zZXNzaW9uOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSDEkcOjIGzDoG0gxJHhu6cge21heF9qb2JzX3Blcl9zZXNzaW9ufSBqb2IgdHJvbmcgcGhpw6puIikKICAgICAgICAgICAgIyDEkOG6t3QgdMOgaSBraG/huqNuIHbDoG8gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZSB24bubaSB0aOG7nWkgZ2lhbiBjaOG7nSBt4bq3YyDEkeG7i25oCiAgICAgICAgICAgIHNlbGYuc2V0X2FjY291bnRfaW5hY3RpdmUoYWNjb3VudFsiaWQiXSwgaW5hY3RpdmVfcmVhc29uPSLEkMOjIGhvw6BuIHRow6BuaCBz4buRIGpvYiB04buRaSDEkWEgdHJvbmcgcGhpw6puIikKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgbuG6v3UgxJHDoyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGpvYiBow6BuZyBuZ8OgeQogICAgICAgIGpvYl9tYXhfZGF5ID0gYWNjb3VudC5nZXQoImpvYl9tYXhfZGF5IiwgMCkKICAgICAgICBpZiBqb2JfbWF4X2RheSA8PSAwOgogICAgICAgICAgICBqb2JfbWF4X2RheSA9IGNvbmZpZy5NQVhfSk9CU19QRVJfREFZCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBqb2IgduG7q2EgbMOgbSBsw6Agam9iIGN14buRaSBjw7luZyB0cm9uZyBuZ8OgeSwgxJHhurd0IGluYWN0aXZlIMSR4bq/biBuZ8OgeSBow7RtIHNhdQogICAgICAgIGlmIChqb2JfdG9kYXkgKyAxKSA+PSBqb2JfbWF4X2RheToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gxJHDoyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGpvYiB0cm9uZyBuZ8OgeSAoe2pvYl90b2RheSsxfS97am9iX21heF9kYXl9KSIpCiAgICAgICAgICAgIHNlbGYuX3NldF9hY2NvdW50X2luYWN0aXZlX3VudGlsX25leHRfcmVzZXQoYWNjb3VudFsiaWQiXSwgIsSQw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHkiKQogICAgICAgIAogICAgZGVmIF9zZXRfYWNjb3VudF9pbmFjdGl2ZV91bnRpbF9uZXh0X3Jlc2V0KHNlbGYsIGFjY291bnRfaWQ6IGludCwgaW5hY3RpdmVfcmVhc29uOiBzdHIgPSAixJDDoyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGpvYiBow6BuZyBuZ8OgeSIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgxJDhurd0IHTDoGkga2hv4bqjbiB2w6BvIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUgY2hvIMSR4bq/biBnaeG7nSByZXNldCBj4bunYSBuZ8OgeSBow7RtIHNhdQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnRfaWQ6IElEIGPhu6dhIHTDoGkga2hv4bqjbgogICAgICAgICAgICBpbmFjdGl2ZV9yZWFzb246IEzDvSBkbyDEkeG6t3QgdMOgaSBraG/huqNuIHbDoG8gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50KGFjY291bnRfaWQpCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiBjw7MgSUQge2FjY291bnRfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZ2nhu50gcmVzZXQgdOG7qyBj4bqldSBow6xuaCBob+G6t2MgdOG7qyBkYXRhYmFzZQogICAgICAgICAgICBqb2JfaG91ciA9IHNlbGYuZGIuZ2V0KCJqb2JfaG91ciIsIGNvbmZpZy5KT0JfSE9VUikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOtbmggdGjhu51pIMSRaeG7g20gcmVzZXQgdGnhur9wIHRoZW8KICAgICAgICAgICAgbm93ID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkKICAgICAgICAgICAgbmV4dF9yZXNldCA9IG5vdy5yZXBsYWNlKGhvdXI9am9iX2hvdXIsIG1pbnV0ZT0wLCBzZWNvbmQ9MCwgbWljcm9zZWNvbmQ9MCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgdGjhu51pIMSRaeG7g20gcmVzZXQgxJHDoyBxdWEgdHJvbmcgbmfDoHkgaMO0bSBuYXksIGPhu5luZyB0aMOqbSAxIG5nw6B5CiAgICAgICAgICAgIGlmIG5vdyA+PSBuZXh0X3Jlc2V0OgogICAgICAgICAgICAgICAgbmV4dF9yZXNldCA9IG5leHRfcmVzZXQgKyBkYXRldGltZS50aW1lZGVsdGEoZGF5cz0xKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOtbmggdGjhu51pIGdpYW4gxJHhur9uIGzhuqduIHJlc2V0IHRp4bq/cCB0aGVvICjEkeG7lWkgdGjDoG5oIHRpbWVzdGFtcCkKICAgICAgICAgICAgam9iX2Rpc2FibGVfdW50aWwgPSBpbnQobmV4dF9yZXNldC50aW1lc3RhbXAoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuCiAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJpbmFjdGl2ZSIsCiAgICAgICAgICAgICAgICAiam9iX2Rpc2FibGVfdW50aWwiOiBqb2JfZGlzYWJsZV91bnRpbCwKICAgICAgICAgICAgICAgICJqb2JzX2RvbmVfaW5fc2Vzc2lvbiI6IDAsICAjIFJlc2V0IHPhu5Egam9iIMSRw6MgbMOgbSB0cm9uZyBwaGnDqm4gduG7gSAwCiAgICAgICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogaW5hY3RpdmVfcmVhc29uICAjIEzGsHUgbMO9IGRvIGluYWN0aXZlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudF9pZCwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrW5oIHPhu5EgZ2nhu50gY8OybiBs4bqhaSDEkeG6v24gbOG6p24gcmVzZXQgdGnhur9wIHRoZW8KICAgICAgICAgICAgaG91cnNfdW50aWxfcmVzZXQgPSAobmV4dF9yZXNldCAtIG5vdykudG90YWxfc2Vjb25kcygpIC8gMzYwMAogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMSR4bq3dCB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gdsOgbyB0cuG6oW5nIHRow6FpIGluYWN0aXZlIMSR4bq/biBnaeG7nSByZXNldCB0aeG6v3AgdGhlbyAoe25leHRfcmVzZXQuaG91cn06MDApLCBjw7JuIGtob+G6o25nIHtob3Vyc191bnRpbF9yZXNldDouMWZ9IGdp4budLiBMw70gZG86IHtpbmFjdGl2ZV9yZWFzb259IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2lsbCBhcHAgc2F1IGtoaSDEkeG6t3QgdMOgaSBraG/huqNuIGluYWN0aXZlCiAgICAgICAgICAgIGFwcF9uYW1lID0gYWNjb3VudC5nZXQoImFwcCIpCiAgICAgICAgICAgIGlmIGFwcF9uYW1lIGFuZCBhcHBfbmFtZSBpbiBjb25maWcuQVBQX1BBQ0tBR0VTOgogICAgICAgICAgICAgICAgcGFja2FnZV9uYW1lID0gY29uZmlnLkFQUF9QQUNLQUdFU1thcHBfbmFtZV0KICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDs25nIOG7qW5nIGThu6VuZyB7YXBwX25hbWV9IChwYWNrYWdlOiB7cGFja2FnZV9uYW1lfSkgc2F1IGtoaSDEkeG6t3QgaW5hY3RpdmUiKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKHBhY2thZ2VfbmFtZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIMSR4bq3dCB0w6BpIGtob+G6o24gSUQge2FjY291bnRfaWR9IHbDoG8gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZSDEkeG6v24gbmfDoHkgaMO0bSBzYXUiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgIGRlZiBzZXRfYWNjb3VudF9pbmFjdGl2ZShzZWxmLCBhY2NvdW50X2lkOiBpbnQsIGNvb2xkb3duX21pbnV0ZXM6IGludCA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgIGluYWN0aXZlX3JlYXNvbjogc3RyID0gIsSQw6MgaG/DoG4gdGjDoG5oIHPhu5Egam9iIHRyb25nIHBoacOqbiIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgxJDhurd0IHTDoGkga2hv4bqjbiB2w6BvIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50X2lkOiBJRCBj4bunYSB0w6BpIGtob+G6o24KICAgICAgICAgICAgY29vbGRvd25fbWludXRlczogU+G7kSBwaMO6dCBj4bqnbiBjaOG7nSB0csaw4bubYyBraGkgdMOgaSBraG/huqNuIMSRxrDhu6NjIGFjdGl2ZSBs4bqhaSAobeG6t2MgxJHhu4tuaCBs4bqleSB04burIGPhuqV1IGjDrG5oKQogICAgICAgICAgICBpbmFjdGl2ZV9yZWFzb246IEzDvSBkbyDEkeG6t3QgdMOgaSBraG/huqNuIHbDoG8gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50KGFjY291bnRfaWQpCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiBjw7MgSUQge2FjY291bnRfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIGNo4buJIMSR4buLbmggdGjhu51pIGdpYW4gY29vbGRvd24sIGzhuqV5IHThu6sgY+G6pXUgaMOsbmgKICAgICAgICAgICAgaWYgY29vbGRvd25fbWludXRlcyBpcyBOb25lOgogICAgICAgICAgICAgICAgY29vbGRvd25fbWludXRlcyA9IHNlbGYuZGIuZ2V0KCJqb2JfY29vbGRvd25fbWludXRlcyIsIGNvbmZpZy5ERUZBVUxUX0NPT0xET1dOX01JTlVURVMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUw61uaCB0aOG7nWkgxJFp4buDbSBo4bq/dCBo4bqhbiBpbmFjdGl2ZQogICAgICAgICAgICBqb2JfZGlzYWJsZV91bnRpbCA9IGludCh0aW1lLnRpbWUoKSArIGNvb2xkb3duX21pbnV0ZXMgKiA2MCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuCiAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJpbmFjdGl2ZSIsCiAgICAgICAgICAgICAgICAiam9iX2Rpc2FibGVfdW50aWwiOiBqb2JfZGlzYWJsZV91bnRpbCwKICAgICAgICAgICAgICAgICJqb2JzX2RvbmVfaW5fc2Vzc2lvbiI6IDAsICAjIFJlc2V0IHPhu5Egam9iIMSRw6MgbMOgbSB0cm9uZyBwaGnDqm4gduG7gSAwCiAgICAgICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogaW5hY3RpdmVfcmVhc29uICAjIEzGsHUgbMO9IGRvIGluYWN0aXZlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudF9pZCwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgxJHhurd0IHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSB2w6BvIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUgdHJvbmcge2Nvb2xkb3duX21pbnV0ZXN9IHBow7p0IHbDoCByZXNldCBz4buRIGpvYiB0cm9uZyBwaGnDqm4uIEzDvSBkbzoge2luYWN0aXZlX3JlYXNvbn0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaWxsIGFwcCBzYXUga2hpIMSR4bq3dCB0w6BpIGtob+G6o24gaW5hY3RpdmUKICAgICAgICAgICAgYXBwX25hbWUgPSBhY2NvdW50LmdldCgiYXBwIikKICAgICAgICAgICAgaWYgYXBwX25hbWUgYW5kIGFwcF9uYW1lIGluIGNvbmZpZy5BUFBfUEFDS0FHRVM6CiAgICAgICAgICAgICAgICBwYWNrYWdlX25hbWUgPSBjb25maWcuQVBQX1BBQ0tBR0VTW2FwcF9uYW1lXQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOzbmcg4bupbmcgZOG7pW5nIHthcHBfbmFtZX0gKHBhY2thZ2U6IHtwYWNrYWdlX25hbWV9KSBzYXUga2hpIMSR4bq3dCBpbmFjdGl2ZSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAocGFja2FnZV9uYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgxJHhurd0IHTDoGkga2hv4bqjbiBJRCB7YWNjb3VudF9pZH0gdsOgbyB0cuG6oW5nIHRow6FpIGluYWN0aXZlIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgSm9iU2VydmljZSB0cm9uZyB0aHJlYWQgcmnDqm5nCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgdGhyZWFkaW5nLlRocmVhZDogVGhyZWFkIMSRYW5nIGNo4bqheSBKb2JTZXJ2aWNlIGhv4bq3YyBOb25lIG7hur91IGzhu5dpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bq3dCB0cuG6oW5nIHRow6FpIHJ1bm5pbmcKICAgICAgICAgICAgc2VsZi5ydW5uaW5nID0gVHJ1ZQogICAgICAgICAgICBzZWxmLmZvcmNlX3N0b3AgPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyB0aHJlYWQKICAgICAgICAgICAgdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5ydW4pCiAgICAgICAgICAgIHRocmVhZC5kYWVtb24gPSBUcnVlCiAgICAgICAgICAgIHRocmVhZC5zdGFydCgpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdGhyZWFkCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkga2jhu59pIMSR4buZbmcgSm9iU2VydmljZSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgZGVmIHJlc2V0X2luYWN0aXZlX2FjY291bnRzKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgdsOgIGtow7RpIHBo4bulYyBjw6FjIHTDoGkga2hv4bqjbiBpbmFjdGl2ZSDEkcOjIGjhur90IHRo4budaSBnaWFuIGNo4budCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdOG6pXQgY+G6oyB0w6BpIGtob+G6o24g4bufIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUKICAgICAgICAgICAgZm9yIGFwcF9uYW1lIGluIHNlbGYuZW5hYmxlZF9hcHBzOgogICAgICAgICAgICAgICAgaW5hY3RpdmVfYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9YXBwX25hbWUsIHN0YXR1cz0iaW5hY3RpdmUiKSBvciBbXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBpbmFjdGl2ZV9hY2NvdW50czoKICAgICAgICAgICAgICAgICAgICBqb2JfZGlzYWJsZV91bnRpbCA9IGFjY291bnQuZ2V0KCJqb2JfZGlzYWJsZV91bnRpbCIsIDApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSDEkcOjIGjhur90IHRo4budaSBnaWFuIGNo4budLCBjaHV54buDbiB24buBIHRy4bqhbmcgdGjDoWkgYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgaWYgam9iX2Rpc2FibGVfdW50aWwgPD0gY3VycmVudF90aW1lOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHsic3RhdHVzIjogImFjdGl2ZSJ9KQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSAoSUQ6IHthY2NvdW50WydpZCddfSkgxJHDoyBo4bq/dCB0aOG7nWkgZ2lhbiBjaOG7nSwgxJHDoyBjaHV54buDbiB24buBIHRy4bqhbmcgdGjDoWkgYWN0aXZlIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdfbWludXRlcyA9IGludCgoam9iX2Rpc2FibGVfdW50aWwgLSBjdXJyZW50X3RpbWUpIC8gNjApCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSBjw7JuIHtyZW1haW5pbmdfbWludXRlc30gcGjDunQg4bufIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUiKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraeG7g20gdHJhIHbDoCBraMO0aSBwaOG7pWMgdMOgaSBraG/huqNuIGluYWN0aXZlIikKICAgIAogICAgZGVmIHJ1bihzZWxmKToKICAgICAgICAiIiIKICAgICAgICBDaOG6oXkgSm9iU2VydmljZSB0cm9uZyBt4buZdCB2w7JuZyBs4bq3cAogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBzZWxmLmlzX2luaXRpYWxpemVkOgogICAgICAgICAgICBpZiBub3Qgc2VsZi5pbml0aWFsaXplKCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBraOG7n2kgdOG6oW8gSm9iU2VydmljZS4gS2jDtG5nIHRo4buDIGNo4bqheS4iKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIkLhuq90IMSR4bqndSBjaOG6oXkgSm9iU2VydmljZS4uLiIpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGRldmljZV9pZAogICAgICAgIGRldmljZV9pZCA9IHNlbGYuZGIuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgICAgICAKICAgICAgICBpZiBub3QgZGV2aWNlX2lkOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCBkZXZpY2VfaWQgaGnhu4duIHThuqFpLCBKb2JTZXJ2aWNlIGtow7RuZyB0aOG7gyBjaOG6oXkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgIyBCaeG6v24gbMawdSB0cuG7ryB0w6BpIGtob+G6o24gxJFhbmcgbMOgbSB2aeG7h2MgaGnhu4duIHThuqFpIGNobyBt4buXaSDhu6luZyBk4bulbmcKICAgICAgICBjdXJyZW50X3dvcmtpbmdfYWNjb3VudHMgPSB7fQogICAgICAgIAogICAgICAgIHdoaWxlIHNlbGYucnVubmluZzoKICAgICAgICAgICAgIyBSZXNldCBiaeG6v24gZm9yY2Vfc3RvcCBu4bq/dSBjw7MKICAgICAgICAgICAgd2l0aCBzZWxmLl9sb2NrOgogICAgICAgICAgICAgICAgc2VsZi5mb3JjZV9zdG9wID0gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IGLhu5kgxJHhur9tIGjDoG5nIG5nw6B5IG7hur91IGPhuqduCiAgICAgICAgICAgIHNlbGYuX3Jlc2V0X2RhaWx5X2NvdW50ZXJzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2w6Aga2jDtGkgcGjhu6VjIGPDoWMgdMOgaSBraG/huqNuIGluYWN0aXZlIMSRw6MgaOG6v3QgdGjhu51pIGdpYW4gY2jhu50KICAgICAgICAgICAgc2VsZi5yZXNldF9pbmFjdGl2ZV9hY2NvdW50cygpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIER1eeG7h3QgcXVhIHThu6tuZyBhcHAgxJHGsOG7o2Mga8OtY2ggaG/huqF0CiAgICAgICAgICAgICAgICBlbmFibGVkX2FwcHMgPSBzZWxmLmRiLmdldCgiZW5hYmxlZF9hcHBzIiwgY29uZmlnLkVOQUJMRURfQVBQUykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIGFwcF9uYW1lIGluIGVuYWJsZWRfYXBwczoKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBj4bqnbiBk4burbmcga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgd2l0aCBzZWxmLl9sb2NrOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmZvcmNlX3N0b3Agb3Igbm90IHNlbGYucnVubmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBhcHAgY8OzIHRyb25nIGpvYl9oYW5kbGVycyBraMO0bmcKICAgICAgICAgICAgICAgICAgICBpZiBhcHBfbmFtZSBub3QgaW4gc2VsZi5qb2JfaGFuZGxlcnM6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHTDrG0gdGjhuqV5IGpvYiBoYW5kbGVyIGNobyB7YXBwX25hbWV9LCBi4buPIHF1YSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHbDoCDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIG7hur91IGPhuqduCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5fY2hlY2tfYWNjb3VudF9zeW5jX3N0YXR1cyhhcHBfbmFtZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDhu5NuZyBi4buZIHTDoGkga2hv4bqjbiBjaG8ge2FwcF9uYW1lfS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3N5bmNfYWNjb3VudHNfZm9yX2FwcChhcHBfbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlciA9IHNlbGYuam9iX2hhbmRsZXJzW2FwcF9uYW1lXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgdMOgaSBraG/huqNuIMSRYW5nIGzDoG0gdmnhu4djIGhp4buHbiB04bqhaSBj4bunYSDhu6luZyBk4bulbmcgbsOgeQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfYWNjb3VudCA9IGN1cnJlbnRfd29ya2luZ19hY2NvdW50cy5nZXQoYXBwX25hbWUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBjaMawYSBjw7MgdMOgaSBraG/huqNuIMSRYW5nIGzDoG0gdmnhu4djLCBraeG7g20gdHJhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGN1cnJlbnRfYWNjb3VudDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBM4bqleSB1c2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3VzZXJuYW1lID0gaGFuZGxlci5nZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY3VycmVudF91c2VybmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSB0w6BpIGtob+G6o24gdMawxqFuZyDhu6luZyB0cm9uZyBEQiAoxJHDoyBs4buNYyB0aGVvIGRldmljZV9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPWFwcF9uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5fYWNjb3VudCA9IG5leHQoKGFjYyBmb3IgYWNjIGluIGFjY291bnRzIGlmIGFjYy5nZXQoInVuaXF1ZV91c2VybmFtZSIpID09IGN1cnJlbnRfdXNlcm5hbWUpLCBOb25lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsb2dpbl9hY2NvdW50OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHEg25nIG5o4bqtcCB0cm9uZyBEQgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIucmVzZXRfbG9naW5fc3RhdHVzX2J5X2FwcChhcHBfbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGxvZ2luX2FjY291bnRbImlkIl0sIHsiaXNfbG9naW4iOiBUcnVlfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIHTDoGkga2hv4bqjbiBuw6B5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF93b3JraW5nX2FjY291bnRzW2FwcF9uYW1lXSA9IGxvZ2luX2FjY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2FjY291bnQgPSBsb2dpbl9hY2NvdW50CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB24bqrbiBraMO0bmcgY8OzIHTDoGkga2hv4bqjbiBuw6BvIMSR4buDIGzDoG0gdmnhu4djLCBi4buPIHF1YSDhu6luZyBk4bulbmcgbsOgeQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjdXJyZW50X2FjY291bnQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiS2jDtG5nIGPDsyB0w6BpIGtob+G6o24gbsOgbyDEkWFuZyDEkcSDbmcgbmjhuq1wIGNobyB7YXBwX25hbWV9LCBi4buPIHF1YSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSB0w6BpIGtob+G6o24gaGnhu4duIHThuqFpIGPDsyB0aOG7gyBjaOG6oXkgam9iIGtow7RuZwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9jYW5fcnVuX2pvYihjdXJyZW50X2FjY291bnQpOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7Y3VycmVudF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IGtow7RuZyB0aOG7gyBjaOG6oXkgam9iLCB0w6xtIHTDoGkga2hv4bqjbiBraMOhYyIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gdMOgaSBraG/huqNuIGtow6FjIHRo4buPYSBtw6NuIMSRaeG7gXUga2nhu4duICjEkcOjIGzhu41jIHRoZW8gZGV2aWNlX2lkKQogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1hcHBfbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dF9hY2NvdW50ID0gbmV4dCgoYWNjIGZvciBhY2MgaW4gYWNjb3VudHMgaWYgc2VsZi5fY2FuX3J1bl9qb2IoYWNjKSksIE5vbmUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbmV4dF9hY2NvdW50OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaMO0bmcgY8OzIHTDoGkga2hv4bqjbiBuw6BvIGPDsyB0aOG7gyBjaOG6oXkgam9iIGNobyB7YXBwX25hbWV9LCBi4buPIHF1YSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dvcmtpbmdfYWNjb3VudHNbYXBwX25hbWVdID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIHNhbmcgdMOgaSBraG/huqNuIGtow6FjCiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaF9zdWNjZXNzID0gaGFuZGxlci5zd2l0Y2hfdG9fYWNjb3VudChuZXh0X2FjY291bnQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN3aXRjaF9zdWNjZXNzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF93b3JraW5nX2FjY291bnRzW2FwcF9uYW1lXSA9IG5leHRfYWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9hY2NvdW50ID0gbmV4dF9hY2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgY2h1eeG7g24gc2FuZyB0w6BpIGtob+G6o24ge25leHRfYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSwgYuG7jyBxdWEiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF93b3JraW5nX2FjY291bnRzW2FwcF9uYW1lXSA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGpvYiB24bubaSB0w6BpIGtob+G6o24gaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyBjaOG6oXkgam9iIGNobyB0w6BpIGtob+G6o24ge2N1cnJlbnRfYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSAoe2FwcF9uYW1lfSkuLi4iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIGpvYgogICAgICAgICAgICAgICAgICAgICAgICBqb2IgPSBoYW5kbGVyLmZldGNoX2pvYihjdXJyZW50X2FjY291bnQpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBqb2I6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFJlc2V0IHPhu5EgbOG6p24gdGjhuqV0IGLhuqFpIGxpw6puIHRp4bq/cCBraGkgY8OzIGpvYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsZWRfam9iX2F0dGVtcHRzW2N1cnJlbnRfYWNjb3VudFsiaWQiXV0gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBqb2IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9yZXN1bHQgPSBoYW5kbGVyLmV4ZWN1dGVfam9iKGN1cnJlbnRfYWNjb3VudCwgam9iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRyw61jaCB4deG6pXQgdGjDtG5nIHRpbiB04burIGvhur90IHF14bqjIGpvYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX3N0YXR1cyA9IGpvYl9yZXN1bHRbInN0YXR1cyJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2Jfc3VjY2VzcyA9IGpvYl9yZXN1bHRbInN1Y2Nlc3MiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX21lc3NhZ2UgPSBqb2JfcmVzdWx0WyJtZXNzYWdlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBCw6FvIGPDoW8ga+G6v3QgcXXhuqMgduG7m2kgbWVzc2FnZSB04burIGvhur90IHF14bqjIGpvYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0X3N1Y2Nlc3MgPSBoYW5kbGVyLnJlcG9ydF9qb2IoY3VycmVudF9hY2NvdW50LCBqb2IsIGpvYl9yZXN1bHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRo4buRbmcga8OqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl91cGRhdGVfam9iX3N0YXRzKGN1cnJlbnRfYWNjb3VudCwgam9iX3N1Y2Nlc3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiS+G6v3QgcXXhuqMgam9iOiB7am9iX21lc3NhZ2V9IChzdGF0dXM6IHtqb2Jfc3RhdHVzfSkiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9hY2NvdW50ID0gc2VsZi5kYi5nZXRfYWNjb3VudChjdXJyZW50X2FjY291bnRbImlkIl0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dvcmtpbmdfYWNjb3VudHNbYXBwX25hbWVdID0gY3VycmVudF9hY2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIGPDsm4gY8OzIHRo4buDIGNo4bqheSBqb2IgbuG7r2Ega2jDtG5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5fY2FuX3J1bl9qb2IoY3VycmVudF9hY2NvdW50KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7Y3VycmVudF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IMSRw6MgaOG6v3Qgam9iIGPDsyB0aOG7gyBjaOG6oXkiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ2jhuqF5IG51w7RpIHTDoGkga2hv4bqjbiBu4bq/dSDEkcOjIGNo4bqheSBo4bq/dCBqb2IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmRiLmdldChmInthcHBfbmFtZX1fY2FyZV9lbmFibGUiLCBUcnVlKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5wZXJmb3JtX2NhcmUoY3VycmVudF9hY2NvdW50KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIG51w7RpIHTDoGkga2hv4bqjbiB7Y3VycmVudF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIMSQw6FuaCBk4bqldSBsw6AgY+G6p24gdMOsbSB0w6BpIGtob+G6o24ga2jDoWMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dvcmtpbmdfYWNjb3VudHNbYXBwX25hbWVdID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaMO0bmcgY8OzIGpvYiBraOG6oyBk4bulbmcgY2hvIHTDoGkga2hv4bqjbiB7Y3VycmVudF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUxINuZyBz4buRIGzhuqduIGtow7RuZyBjw7Mgam9iIGxpw6puIHRp4bq/cCB0cm9uZyBi4buZIG5o4bubCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50X2lkID0gY3VycmVudF9hY2NvdW50WyJpZCJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxlZF9qb2JfYXR0ZW1wdHNbYWNjb3VudF9pZF0gPSBzZWxmLmZhaWxlZF9qb2JfYXR0ZW1wdHMuZ2V0KGFjY291bnRfaWQsIDApICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbGVkX2F0dGVtcHRzID0gc2VsZi5mYWlsZWRfam9iX2F0dGVtcHRzW2FjY291bnRfaWRdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTuG6v3UgNSBs4bqnbiBsacOqbiB0aeG6v3Aga2jDtG5nIGPDsyBqb2IsIMSR4bq3dCB0w6BpIGtob+G6o24gdsOgbyBjaOG6vyDEkeG7mSBuZ2jhu4kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZhaWxlZF9hdHRlbXB0cyA+PSA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2xkb3duX21pbnV0ZXMgPSBzZWxmLmRiLmdldCgiY29vbGRvd25fZ2V0X2pvYl9nb2xpa2UiLCAzMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlTDoGkga2hv4bqjbiB7Y3VycmVudF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IMSRw6MgNSBs4bqnbiBsacOqbiB0aeG6v3Aga2jDtG5nIGPDsyBqb2IsIGNobyBuZ2jhu4kge2Nvb2xkb3duX21pbnV0ZXN9IHBow7p0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldF9hY2NvdW50X2luYWN0aXZlKGN1cnJlbnRfYWNjb3VudFsiaWQiXSwgY29vbGRvd25fbWludXRlcz1jb29sZG93bl9taW51dGVzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5hY3RpdmVfcmVhc29uPWYiS2jDtG5nIHTDrG0gdGjhuqV5IGpvYiBraOG6oyBk4bulbmcgc2F1IDUgbOG6p24gdGjhu60gbGnDqm4gdGnhur9wIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBs4bqhaSB0aMO0bmcgdGluIHTDoGkga2hv4bqjbiB04burIGRhdGFiYXNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9hY2NvdW50ID0gc2VsZi5kYi5nZXRfYWNjb3VudChjdXJyZW50X2FjY291bnRbImlkIl0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF93b3JraW5nX2FjY291bnRzW2FwcF9uYW1lXSA9IGN1cnJlbnRfYWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIMSQ4bujaSBt4buZdCBraG/huqNuZyB0aOG7nWkgZ2lhbiB0csaw4bubYyBraGkga2nhu4NtIHRyYSBs4bqhaSBqb2IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9jaGVja19pbnRlcnZhbCA9IHNlbGYuZGIuZ2V0KCJqb2JfY2hlY2tfaW50ZXJ2YWwiLCBjb25maWcuSk9CX0NIRUNLX0lOVEVSVkFMKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcChqb2JfY2hlY2tfaW50ZXJ2YWwpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gam9iIGNobyB0w6BpIGtob+G6o24ge2N1cnJlbnRfYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGNo4bqheSBqb2IiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhu6NpIHRyxrDhu5tjIGtoaSBjaOG6oXkgbOG6oWkKICAgICAgICAgICAgam9iX2NoZWNrX2ludGVydmFsID0gc2VsZi5kYi5nZXQoImpvYl9jaGVja19pbnRlcnZhbCIsIGNvbmZpZy5KT0JfQ0hFQ0tfSU5URVJWQUwpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoam9iX2NoZWNrX2ludGVydmFsKToKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgZGVmIHN0b3Aoc2VsZik6CiAgICAgICAgIiIiROG7q25nIEpvYlNlcnZpY2UiIiIKICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQYW5nIGThu6tuZyBKb2JTZXJ2aWNlLi4uIikKICAgICAgICAKICAgIGRlZiBmb3JjZV9zdG9wX2FsbChzZWxmKToKICAgICAgICAiIiJE4burbmcgbmdheSBs4bqtcCB04bupYyB04bqldCBj4bqjIGPDoWMgaG/huqF0IMSR4buZbmciIiIKICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgIHNlbGYuZm9yY2Vfc3RvcCA9IFRydWUKICAgICAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBsb2dnZXIuaW5mbygiROG7q25nIG5nYXkgbOG6rXAgdOG7qWMgdOG6pXQgY+G6oyBjw6FjIGhv4bqhdCDEkeG7mW5nLi4uIikKCiAgICBkZWYgc2h1dGRvd24oc2VsZik6CiAgICAgICAgIiIixJDDs25nIGThu4tjaCB24bulLCBk4burbmcgdOG6pXQgY+G6oyB3b3JrZXIgdGhyZWFkcyIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiROG7q25nIG5nYXkgbOG6rXAgdOG7qWMgdOG6pXQgY+G6oyBjw6FjIGhv4bqhdCDEkeG7mW5nLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IGThu6tuZwogICAgICAgICAgICBzZWxmLnJ1bm5pbmcgPSBGYWxzZQogICAgICAgICAgICBzZWxmLmZvcmNlX3N0b3AgPSBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQw6FuaCB0aOG7qWMgdOG6pXQgY+G6oyB3b3JrZXIgdGhyZWFkcyDEkeG7gyBjaMO6bmcga2nhu4NtIHRyYSDEkWnhu4F1IGtp4buHbiBk4burbmcKICAgICAgICAgICAgZm9yIHdvcmtlciBpbiBzZWxmLndvcmtlcnMudmFsdWVzKCk6CiAgICAgICAgICAgICAgICBpZiBoYXNhdHRyKHdvcmtlciwgIndha2VfdXAiKSBhbmQgY2FsbGFibGUod29ya2VyLndha2VfdXApOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgd29ya2VyLndha2VfdXAoKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOzbmcga+G6v3QgbuG7kWkgZGF0YWJhc2UgxJHhu4MgdHLDoW5oIGzhu5dpIHRocmVhZAogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdkYicpIGFuZCBzZWxmLmRiOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuY2xvc2UoKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIMSRw7NuZyBr4bq/dCBu4buRaSBkYXRhYmFzZToge3N0cihlKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4budIMSR4buDIHRow7RuZyBiw6FvIMSRw6MgZOG7q25nCiAgICAgICAgICAgIHNlbGYuc3RvcHBlZCA9IFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBzaHV0ZG93biBKb2JTZXJ2aWNlIikg').decode('utf-8'))
