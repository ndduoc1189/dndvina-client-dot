import base64
exec(base64.b64decode('IiIiCk1pbmluZyBNYW5hZ2VtZW50IFNlcnZpY2UKUXXhuqNuIGzDvSBtaW5pbmcgdGjDtG5nIHF1YSBBUEkKIiIiCgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHRpbWUKaW1wb3J0IGpzb24KZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIExpc3QsIEFueSwgT3B0aW9uYWwKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IGNvbmZpZwppbXBvcnQgdXRpbHMKCiMgTG9nZ2VyCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIk1pbmluZ1NlcnZpY2UiKQoKCmNsYXNzIE1pbmluZ1NlcnZpY2U6CiAgICAiIiIKICAgIFNlcnZpY2UgcXXhuqNuIGzDvSBtaW5pbmcgdGjDtG5nIHF1YSBBUEkKICAgIC0gU3luYyBjb25maWcgdOG7qyBzZXJ2ZXIgduG7gSBjbGllbnQgcXVhIE1RVFQKICAgIC0gQXV0by1zdGFydCBtaW5lcnMga2hpIGJvb3QKICAgIC0gTW9uaXRvciBoYXNoIHJhdGUgdsOgIHN0YXR1cwogICAgIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9zZXJ2aWNlLCBiYXNlX3VybDogT3B0aW9uYWxbc3RyXSA9IE5vbmUpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBNaW5pbmcgU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGRiX3NlcnZpY2U6IERhdGFiYXNlIHNlcnZpY2UgxJHhu4MgbMawdSB0aMO0bmcgdGluCiAgICAgICAgICAgIGJhc2VfdXJsOiBVUkwgY+G7p2EgbWluaW5nIEFQSSBzZXJ2ZXIgKG3hurdjIMSR4buLbmggbOG6pXkgdOG7qyBjb25maWcuREVWSUNFX0lQKQogICAgICAgICIiIgogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgIyBT4butIGThu6VuZyBERVZJQ0VfSVAgdOG7qyBjb25maWcgbuG6v3Uga2jDtG5nIHRydXnhu4FuIGJhc2VfdXJsCiAgICAgICAgaWYgYmFzZV91cmwgaXMgTm9uZToKICAgICAgICAgICAgYmFzZV91cmwgPSBmImh0dHA6Ly97Y29uZmlnLkRFVklDRV9JUH06OTA5OCIKICAgICAgICBzZWxmLmJhc2VfdXJsID0gYmFzZV91cmwKICAgICAgICAKICAgICAgICAjIExvYWQgbWluaW5nIGluZm8gdOG7qyBEQgogICAgICAgIHNlbGYuX2xvYWRfbWluaW5nX2luZm8oKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB2w6Agc3luYyBjb25maWcga2hpIGto4bufaSDEkeG7mW5nCiAgICAgICAgc2VsZi5fY2hlY2tfYW5kX3N5bmNfb25fc3RhcnR1cCgpCiAgICAgICAgCiAgICBkZWYgX2xvYWRfbWluaW5nX2luZm8oc2VsZik6CiAgICAgICAgIiIiTG9hZCBtaW5pbmcgaW5mbyB2w6AgY29uZmlnIHThu6sgZGF0YWJhc2UiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTWluaW5nIGNvbmZpZzogQ+G6pXUgaMOsbmggdOG7qyBNUVRULCBjaOG7iSB1cGRhdGUga2hpIGPDsyBNUVRUCiAgICAgICAgICAgIHNlbGYubWluaW5nX2NvbmZpZyA9IHNlbGYuZGIuZ2V0KCJtaW5pbmctY29uZmlnIiwgewogICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiAwLAogICAgICAgICAgICAgICAgImF1dG9fc3RhcnQiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJtaW5lcnMiOiBbXQogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBNaW5pbmcgaW5mbzogVHLhuqFuZyB0aMOhaSB0aOG7sWMgdOG6vyB04burIEFQSSwgc3luYyDEkeG7i25oIGvhu7MKICAgICAgICAgICAgc2VsZi5taW5pbmdfaW5mbyA9IHNlbGYuZGIuZ2V0KCJtaW5pbmctaW5mbyIsIHsKICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IDAsCiAgICAgICAgICAgICAgICAidG90YWxfbWluZXJzIjogMCwKICAgICAgICAgICAgICAgICJydW5uaW5nX21pbmVycyI6IDAsCiAgICAgICAgICAgICAgICAic3RvcHBlZF9taW5lcnMiOiAwLAogICAgICAgICAgICAgICAgIm1pbmVycyI6IFtdLAogICAgICAgICAgICAgICAgImVycm9yX21lc3NhZ2UiOiAiIgogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiTG9hZGVkIG1pbmluZyBjb25maWc6IHtsZW4oc2VsZi5taW5pbmdfY29uZmlnLmdldCgnbWluZXJzJywgW10pKX0gbWluZXJzIikKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiTG9hZGVkIG1pbmluZyBpbmZvOiB7c2VsZi5taW5pbmdfaW5mby5nZXQoJ3J1bm5pbmdfbWluZXJzJywgMCl9L3tzZWxmLm1pbmluZ19pbmZvLmdldCgndG90YWxfbWluZXJzJywgMCl9IHJ1bm5pbmciKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGxvYWQgbWluaW5nIGRhdGE6IHtlfSIpCiAgICAgICAgICAgIHNlbGYubWluaW5nX2NvbmZpZyA9IHsKICAgICAgICAgICAgICAgICJsYXN0X3N5bmNfY29uZmlnIjogMCwKICAgICAgICAgICAgICAgICJhdXRvX3N0YXJ0IjogRmFsc2UsCiAgICAgICAgICAgICAgICAibWluZXJzIjogW10KICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLm1pbmluZ19pbmZvID0gewogICAgICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogMCwKICAgICAgICAgICAgICAgICJ0b3RhbF9taW5lcnMiOiAwLAogICAgICAgICAgICAgICAgInJ1bm5pbmdfbWluZXJzIjogMCwKICAgICAgICAgICAgICAgICJzdG9wcGVkX21pbmVycyI6IDAsCiAgICAgICAgICAgICAgICAibWluZXJzIjogW10sCiAgICAgICAgICAgICAgICAiZXJyb3JfbWVzc2FnZSI6IHN0cihlKQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBfc2F2ZV9taW5pbmdfY29uZmlnKHNlbGYpOgogICAgICAgICIiIkzGsHUgbWluaW5nIGNvbmZpZyB2w6BvIGRhdGFiYXNlIChjaOG7iSBraGkgY8OzIE1RVFQgdXBkYXRlKSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5kYi5zZXQoIm1pbmluZy1jb25maWciLCBzZWxmLm1pbmluZ19jb25maWcpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiU2F2ZWQgbWluaW5nIGNvbmZpZyB0byBkYXRhYmFzZSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbMawdSBtaW5pbmcgY29uZmlnOiB7ZX0iKQogICAgCiAgICBkZWYgX3NhdmVfbWluaW5nX2luZm8oc2VsZik6CiAgICAgICAgIiIiTMawdSBtaW5pbmcgaW5mbyB2w6BvIGRhdGFiYXNlIChzeW5jIMSR4buLbmgga+G7syB04burIEFQSSBzdGF0dXMpIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmRiLnNldCgibWluaW5nLWluZm8iLCBzZWxmLm1pbmluZ19pbmZvKQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIlNhdmVkIG1pbmluZyBpbmZvIHRvIGRhdGFiYXNlIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBsxrB1IG1pbmluZyBpbmZvOiB7ZX0iKQogICAgCiAgICBkZWYgX2NoZWNrX2FuZF9zeW5jX29uX3N0YXJ0dXAoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6Agc3luYyBtaW5pbmcgY29uZmlnIGtoaSBraOG7n2kgxJHhu5luZyDhu6luZyBk4bulbmcKICAgICAgICAKICAgICAgICBMb2dpYzoKICAgICAgICAxLiBLaeG7g20gdHJhIGPDsyBtaW5pbmctY29uZmlnIGtow7RuZwogICAgICAgIDIuIEtp4buDbSB0cmEgbWluaW5nIEFQSSBjw7MgY2jhuqF5IGtow7RuZwogICAgICAgIDMuIE7hur91IEFQSSBraMO0bmcgY2jhuqF5IOKGkiBTdGFydCBtaW5pbmcgc2VydmVyIGLhurFuZyB0bXV4CiAgICAgICAgNC4gxJDhu6NpIDIwcyDihpIgQ2hlY2sgbOG6oWkKICAgICAgICA1LiBO4bq/dSBr4bq/dCBu4buRaSDEkcaw4bujYyBuaMawbmcga2jDtG5nIGPDsyBtaW5lciBydW5uaW5nIOKGkiBVcGRhdGUgY29uZmlnCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OzIGNvbmZpZyBraMO0bmcKICAgICAgICAgICAgaWYgbm90IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoIm1pbmVycyIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkNoxrBhIGPDsyBtaW5pbmcgY29uZmlnLCBi4buPIHF1YSBzeW5jIGzDumMgc3RhcnR1cCIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsX3ZlcnNpb24gPSBzZWxmLm1pbmluZ19jb25maWcuZ2V0KCJsYXN0X3N5bmNfY29uZmlnIiwgMCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaeG7g20gdHJhIG1pbmluZyBjb25maWcgbMO6YyBzdGFydHVwIChsb2NhbCB2ZXJzaW9uOiB7bG9jYWxfdmVyc2lvbn0pLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBtaW5pbmcgQVBJIGPDsyBob+G6oXQgxJHhu5luZyBraMO0bmcKICAgICAgICAgICAgaWYgbm90IHNlbGYuY2hlY2tfbWluaW5nX2FwaV9oZWFsdGgoKToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJNaW5pbmcgQVBJIGNoxrBhIGNo4bqheSwgxJFhbmcga2jhu59pIMSR4buZbmcgbWluaW5nIHNlcnZlci4uLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU3RhcnQgbWluaW5nIHNlcnZlciBi4bqxbmcgdG11eAogICAgICAgICAgICAgICAgaWYgc2VsZi5fc3RhcnRfbWluaW5nX3NlcnZlcigpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGfhu61pIGzhu4duaCBraOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyLCDEkeG7o2kgMjBzLi4uIikKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIwKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgbOG6oWkgc2F1IDIwcwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmNoZWNrX21pbmluZ19hcGlfaGVhbHRoKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiTWluaW5nIEFQSSB24bqrbiBjaMawYSBz4bq1biBzw6BuZyBzYXUgMjBzLCBi4buPIHF1YSBzeW5jIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk1pbmluZyBBUEkgxJHDoyBz4bq1biBzw6BuZyBzYXUga2hpIGto4bufaSDEkeG7mW5nIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4Mga2jhu59pIMSR4buZbmcgbWluaW5nIHNlcnZlciwgYuG7jyBxdWEgc3luYyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHN0YXR1cyB04burIEFQSQogICAgICAgICAgICBzdGF0dXMgPSBzZWxmLmdldF9zdGF0dXMoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHN0YXR1cy5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHN0YXR1cyB04burIG1pbmluZyBBUEk6IHtzdGF0dXMuZ2V0KCdlcnJvcicpfSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIG1pbmVycyA9IHN0YXR1cy5nZXQoIm1pbmVycyIsIFtdKQogICAgICAgICAgICBydW5uaW5nX21pbmVycyA9IFttIGZvciBtIGluIG1pbmVycyBpZiBtLmdldCgic3RhdHVzIikgPT0gInJ1bm5pbmciXQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgY8OzIG1pbmVycyDEkWFuZyBjaOG6oXkg4oaSIFVwZGF0ZSBjb25maWcKICAgICAgICAgICAgaWYgbm90IHJ1bm5pbmdfbWluZXJzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJNaW5pbmcgQVBJIGPDsyB7bGVuKG1pbmVycyl9IG1pbmVycyBuaMawbmcga2jDtG5nIGPDsyBtaW5lciBuw6BvIMSRYW5nIGNo4bqheSwgxJFhbmcgdXBkYXRlIGNvbmZpZy4uLiIpCiAgICAgICAgICAgICAgICBzZWxmLl9mb3JjZV91cGRhdGVfY29uZmlnKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTWluaW5nIEFQSSDEkWFuZyBjaOG6oXkge2xlbihydW5uaW5nX21pbmVycyl9L3tsZW4obWluZXJzKX0gbWluZXJzLCBraMO0bmcgY+G6p24gdXBkYXRlIikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgY2hlY2sgdsOgIHN5bmMgbMO6YyBzdGFydHVwOiB7ZX0iKQogICAgCiAgICBkZWYgX3N0YXJ0X21pbmluZ19zZXJ2ZXIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyIGLhurFuZyBzaGVsbCBzY3JpcHQKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGfhu61pIGzhu4duaCB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGltcG9ydCBzdWJwcm9jZXNzCiAgICAgICAgICAgIGltcG9ydCBvcwogICAgICAgICAgICAKICAgICAgICAgICAgIyBTY3JpcHQgcGF0aAogICAgICAgICAgICBzY3JpcHRfcGF0aCA9ICIvZGF0YS9kYXRhL2NvbS50ZXJtdXgvZmlsZXMvaG9tZS9ydW4tbWluaW5nIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGZpbGUgY8OzIHThu5NuIHThuqFpIGtow7RuZwogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoc2NyaXB0X3BhdGgpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiU2NyaXB0IGZpbGUga2jDtG5nIHThu5NuIHThuqFpOiB7c2NyaXB0X3BhdGh9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUcm9uZyBUZXJtdXgsIGNo4bqheSBzY3JpcHQgdHLhu7FjIHRp4bq/cCBob+G6t2MgZMO5bmcgc2gKICAgICAgICAgICAgIyBUaOG7rSBjw6FjaCAxOiBDaOG6oXkgc2NyaXB0IHRy4buxYyB0aeG6v3AKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY21kID0gW3NjcmlwdF9wYXRoXQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyIChkaXJlY3QpOiB7JyAnLmpvaW4oY21kKX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTE1CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga2jhu59pIMSR4buZbmcgbWluaW5nIHNlcnZlciB0aMOgbmggY8O0bmcgKGRpcmVjdCkiKQogICAgICAgICAgICAgICAgICAgIGlmIHJlc3VsdC5zdGRvdXQuc3RyaXAoKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJTVERPVVQ6IHtyZXN1bHQuc3Rkb3V0LnN0cmlwKCl9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlNjcmlwdCBmYWlsZWQgKGV4aXQgY29kZToge3Jlc3VsdC5yZXR1cm5jb2RlfSkiKQogICAgICAgICAgICAgICAgICAgIGlmIHJlc3VsdC5zdGRlcnIuc3RyaXAoKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJTVERFUlI6IHtyZXN1bHQuc3RkZXJyLnN0cmlwKCl9IikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiRGlyZWN0IGV4ZWN1dGlvbiBmYWlsZWQ6IHtlfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGPDoWNoIDI6IETDuW5nIHNoIMSR4buDIGNo4bqheSBzY3JpcHQKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY21kID0gWyJzaCIsIHNjcmlwdF9wYXRoXQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyIChzaCk6IHsnICcuam9pbihjbWQpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJTY3JpcHQgZXhlY3V0ZWQgd2l0aCBleGl0IGNvZGU6IHtyZXN1bHQucmV0dXJuY29kZX0iKQogICAgICAgICAgICAgICAgaWYgcmVzdWx0LnN0ZG91dC5zdHJpcCgpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiU1RET1VUOiB7cmVzdWx0LnN0ZG91dC5zdHJpcCgpfSIpCiAgICAgICAgICAgICAgICBpZiByZXN1bHQuc3RkZXJyLnN0cmlwKCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJTVERFUlI6IHtyZXN1bHQuc3RkZXJyLnN0cmlwKCl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDb2kgbmjGsCB0aMOgbmggY8O0bmcgbuG6v3Uga2jDtG5nIGPDsyBs4buXaSBuZ2hpw6ptIHRy4buNbmcKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuVGltZW91dEV4cGlyZWQ6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiU2NyaXB0IHRpbWVvdXQgKGPDsyB0aOG7gyDEkWFuZyBjaOG6oXkgYmFja2dyb3VuZCkiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgU2NyaXB0IGPDsyB0aOG7gyBjaOG6oXkgYmFja2dyb3VuZAogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBraOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyOiB7ZS5zdGRlcnJ9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBs4buHbmggc2ggaG/hurdjIHNjcmlwdCBmaWxlIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraMO0bmcgeMOhYyDEkeG7i25oIGtoaSBraOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9mb3JjZV91cGRhdGVfY29uZmlnKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIMOJcCBideG7mWMgdXBkYXRlIGNvbmZpZyBsw6puIG1pbmluZyBBUEkKICAgICAgICBEw7luZyBraGkga2jhu59pIMSR4buZbmcgaG/hurdjIGtoaSBwaMOhdCBoaeG7h24gY29uZmlnIGtow7RuZyBraOG7m3AKICAgICAgICBC4buPIHF1YSBraeG7g20gdHJhIHRpbWVzdGFtcAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoIm1pbmVycyIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgbWluaW5nIGNvbmZpZyDEkeG7gyB1cGRhdGUiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEZvcmNlPVRydWUgxJHhu4MgYuG7jyBxdWEga2nhu4NtIHRyYSB0aW1lc3RhbXAKICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi51cGRhdGVfY29uZmlnKHNlbGYubWluaW5nX2NvbmZpZywgZm9yY2U9VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLinIUgxJDDoyBmb3JjZSB1cGRhdGUgbWluaW5nIGNvbmZpZyIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiLinYwgTOG7l2kga2hpIGZvcmNlIHVwZGF0ZSBjb25maWc6IHtyZXN1bHQuZ2V0KCdlcnJvcicpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBmb3JjZSB1cGRhdGUgY29uZmlnOiB7ZX0iKQogICAgCiAgICBkZWYgZ2V0X3N0YXR1cyhzZWxmLCBzYXZlX3RvX2RiOiBib29sID0gRmFsc2UpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRy4bqhbmcgdGjDoWkgbWluaW5nIHThu6sgQVBJCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2F2ZV90b19kYjogREVQUkVDQVRFRCAtIGtow7RuZyBjw7JuIHPhu60gZOG7pW5nIG7hu69hCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdDogU3RhdHVzIGPhu6dhIHThuqV0IGPhuqMgbWluZXJzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChmIntzZWxmLmJhc2VfdXJsfS9hcGkvc3RhdHVzIiwgdGltZW91dD01KQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgcmVzdWx0ID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIGtoaSBs4bqleSBzdGF0dXM6IHtlfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpLAogICAgICAgICAgICAgICAgIm1pbmVycyI6IFtdCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIGdldF9taW5lcl9zdGF0dXMoc2VsZiwgbmFtZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0cuG6oW5nIHRow6FpIGPhu6dhIG3hu5l0IG1pbmVyIGPhu6UgdGjhu4MKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBuYW1lOiBUw6puIG1pbmVyCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IFN0YXR1cyBj4bunYSBtaW5lcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoCiAgICAgICAgICAgICAgICBmIntzZWxmLmJhc2VfdXJsfS9hcGkvc3RhdHVzIiwKICAgICAgICAgICAgICAgIHBhcmFtcz17Im5hbWUiOiBuYW1lfSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9NQogICAgICAgICAgICApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kga2hpIGzhuqV5IHN0YXR1cyBtaW5lciB7bmFtZX06IHtlfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIHVwZGF0ZV9jb25maWcoc2VsZiwgbXF0dF9taW5pbmdfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwgZm9yY2U6IGJvb2wgPSBUcnVlKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBVcGRhdGUgbWluaW5nIGNvbmZpZyB04burIE1RVFQgc2VydmVyCiAgICAgICAgQ29uZmlnIG7DoHkgQ0jhu4ggdXBkYXRlIGtoaSBjw7MgTVFUVCB1cGRhdGUsIEtIw5RORyBzeW5jIMSR4buLbmgga+G7swogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1xdHRfbWluaW5nX2NvbmZpZzogewogICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiB0aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAiYXV0b19zdGFydCI6IGJvb2wsCiAgICAgICAgICAgICAgICAibWluZXJzIjogWy4uLl0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JjZTogTeG6t2MgxJHhu4tuaCBUcnVlIC0gTHXDtG4gdXBkYXRlIMSRw6ggbMOqbiBtaW5pbmcgQVBJCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IEvhur90IHF14bqjIHVwZGF0ZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBWYWxpZGF0ZSBjb25maWcKICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UobXF0dF9taW5pbmdfY29uZmlnLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZXJyb3IiOiAiSW52YWxpZCBjb25maWcgZm9ybWF0IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aW1lc3RhbXAKICAgICAgICAgICAgbmV3X3RpbWVzdGFtcCA9IG1xdHRfbWluaW5nX2NvbmZpZy5nZXQoImxhc3Rfc3luY19jb25maWciLCAwKQogICAgICAgICAgICBjdXJyZW50X3RpbWVzdGFtcCA9IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoImxhc3Rfc3luY19jb25maWciLCAwKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJVcGRhdGUgY29uZmlnOiBuZXdfdGltZXN0YW1wPXtuZXdfdGltZXN0YW1wfSwgY3VycmVudD17Y3VycmVudF90aW1lc3RhbXB9LCBmb3JjZT17Zm9yY2V9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTFXDlE4gTMavVSBDT05GSUcgVsOATyBEQiBUUsav4buaQywgYuG6pXQga+G7gyBBUEkgY8OzIGzhu5dpIGhheSBraMO0bmcKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkzGsHUgbWluaW5nIGNvbmZpZyB2w6BvIGRhdGFiYXNlIHRyxrDhu5tjLi4uIikKICAgICAgICAgICAgc2VsZi5taW5pbmdfY29uZmlnID0gbXF0dF9taW5pbmdfY29uZmlnCiAgICAgICAgICAgIHNlbGYuX3NhdmVfbWluaW5nX2NvbmZpZygpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLinIUgxJDDoyBsxrB1IG1pbmluZyBjb25maWcgdsOgbyBkYXRhYmFzZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGZvcmNlPUZhbHNlICh04burIE1RVFQpOiBMVcOUTiB1cGRhdGUgxJHDqCBsw6puIG1pbmluZyBBUEkKICAgICAgICAgICAgIyBO4bq/dSBmb3JjZT1UcnVlICh04burIHN0YXJ0dXApOiBLaMO0bmcgbMOgbSBnw6wgY+G6oyAoY2jhu4kgxJHhu4MgdMawxqFuZyB0aMOtY2gpCiAgICAgICAgICAgIGlmIGZvcmNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkZvcmNlIHVwZGF0ZSB04burIHN0YXJ0dXAsIGLhu48gcXVhIikKICAgICAgICAgICAgICAgICMgRm9yY2UgdXBkYXRlIGtow7RuZyBj4bqnbiBraeG7g20gdHJhIGfDrCwgdXBkYXRlIGx1w7RuCiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu61pIGNvbmZpZyDEkeG6v24gbWluaW5nIEFQSQogICAgICAgICAgICBtaW5lcnNfZGF0YSA9IG1xdHRfbWluaW5nX2NvbmZpZy5nZXQoIm1pbmVycyIsIFtdKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMb2cgxJHhu4MgZGVidWcKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyBn4butaSB7bGVuKG1pbmVyc19kYXRhKX0gbWluZXJzIMSR4bq/biBNaW5pbmcgQVBJOiIpCiAgICAgICAgICAgIGZvciBtaW5lciBpbiBtaW5lcnNfZGF0YToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiICAtIHttaW5lci5nZXQoJ2NvaW5fbmFtZScsICdVbmtub3duJyl9ICh7bWluZXIuZ2V0KCdtaW5pbmdfdG9vbCcsICdVbmtub3duJyl9KSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICBmIntzZWxmLmJhc2VfdXJsfS9hcGkvdXBkYXRlLWNvbmZpZyIsCiAgICAgICAgICAgICAgICBqc29uPW1pbmVyc19kYXRhLAogICAgICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sCiAgICAgICAgICAgICAgICB0aW1lb3V0PTMwCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSB1cGRhdGUgQVBJIHRow6BuaCBjw7RuZwogICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdWNjZXNzIik6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBVcGRhdGVkIG1pbmluZyBjb25maWcgdG8gQVBJOiB7cmVzdWx0LmdldCgndXBkYXRlZCcsIDApfS97cmVzdWx0LmdldCgndG90YWwnLCAwKX0gbWluZXJzIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMb2cgYXV0by1zdGFydCByZXN1bHQgbuG6v3UgY8OzCiAgICAgICAgICAgICAgICBhdXRvX3N0YXJ0X3Jlc3VsdCA9IHJlc3VsdC5nZXQoImF1dG9fc3RhcnRfcmVzdWx0IikKICAgICAgICAgICAgICAgIGlmIGF1dG9fc3RhcnRfcmVzdWx0OgogICAgICAgICAgICAgICAgICAgIHN0b3BwZWQgPSBhdXRvX3N0YXJ0X3Jlc3VsdC5nZXQoInN0b3BwZWQiLCBbXSkKICAgICAgICAgICAgICAgICAgICBzdGFydGVkID0gYXV0b19zdGFydF9yZXN1bHQuZ2V0KCJzdGFydGVkIiwgW10pCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJBdXRvLXJlc3RhcnQ6IHN0b3BwZWQ9e2xlbihzdG9wcGVkKX0sIHN0YXJ0ZWQ9e2xlbihzdGFydGVkKX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE1pbmluZyBBUEkgxJHDoyB04buxIMSR4buZbmcgc3RvcC9zdGFydCBraGkgYXV0b19zdGFydD10cnVlCiAgICAgICAgICAgICAgICAjIFN0YXR1cyBz4bq9IMSRxrDhu6NjIHN5bmMgxJHhu4tuaCBr4buzIGLhu59pIHN5bmNfc3RhdHVzX2Zyb21fYXBpKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgImRiX3NhdmVkIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJhcGlfdXBkYXRlZCI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiAiQ29uZmlnIMSRw6MgxJHGsOG7o2MgbMawdSB2w6BvIERCIHbDoCBn4butaSB0aMOgbmggY8O0bmcgxJHhur9uIE1pbmluZyBBUEkiLAogICAgICAgICAgICAgICAgICAgICJ1cGRhdGVkIjogcmVzdWx0LmdldCgndXBkYXRlZCcsIDApLAogICAgICAgICAgICAgICAgICAgICJ0b3RhbCI6IHJlc3VsdC5nZXQoJ3RvdGFsJywgMCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZGJfc2F2ZWQiOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICJhcGlfdXBkYXRlZCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJlcnJvciI6IGYiTWluaW5nIEFQSSB0cuG6oyB24buBIGzhu5dpOiB7cmVzdWx0LmdldCgnbWVzc2FnZScsICdVbmtub3duIGVycm9yJyl9IiwKICAgICAgICAgICAgICAgICAgICAiYXBpX3Jlc3BvbnNlIjogcmVzdWx0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSBraGkgdXBkYXRlIGNvbmZpZzoge2V9IgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDb25maWcgxJHDoyDEkcaw4bujYyBsxrB1IHbDoG8gREIsIGNo4buJIEFQSSBi4buLIGzhu5dpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImRiX3NhdmVkIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJhcGlfdXBkYXRlZCI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogZiJDb25maWcgxJHDoyBsxrB1IHbDoG8gREIgbmjGsG5nIGtow7RuZyBn4butaSDEkcaw4bujYyDEkeG6v24gTWluaW5nIEFQSToge3N0cihlKX0iLAogICAgICAgICAgICAgICAgImNvbm5lY3Rpb25fZXJyb3IiOiBUcnVlCiAgICAgICAgICAgIH0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kga2jDtG5nIG1vbmcgxJHhu6NpIGtoaSB1cGRhdGUgY29uZmlnOiB7ZX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJkYl9zYXZlZCI6IFRydWUsICAjIENvbmZpZyDEkcOjIGzGsHUg4bufIMSR4bqndSBow6BtCiAgICAgICAgICAgICAgICAiYXBpX3VwZGF0ZWQiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJlcnJvciI6IHN0cihlKQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBzdGFydF9taW5lcihzZWxmLCBuYW1lOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFN0YXJ0IG3hu5l0IG1pbmVyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbmFtZTogVMOqbiBtaW5lcgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0OiBL4bq/dCBxdeG6oyBzdGFydAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgZiJ7c2VsZi5iYXNlX3VybH0vYXBpL3N0YXJ0IiwKICAgICAgICAgICAgICAgIGpzb249eyJuYW1lIjogbmFtZX0sCiAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgcmVzdWx0ID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdWNjZXNzIik6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBTdGFydGVkIG1pbmVyOiB7bmFtZX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiLinYwgRmFpbGVkIHRvIHN0YXJ0IG1pbmVyIHtuYW1lfToge3Jlc3VsdC5nZXQoJ21lc3NhZ2UnKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICAKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBzdGFydCBtaW5lciB7bmFtZX06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIHN0b3BfbWluZXIoc2VsZiwgbmFtZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBTdG9wIG3hu5l0IG1pbmVyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbmFtZTogVMOqbiBtaW5lcgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0OiBL4bq/dCBxdeG6oyBzdG9wCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICBmIntzZWxmLmJhc2VfdXJsfS9hcGkvc3RvcCIsCiAgICAgICAgICAgICAgICBqc29uPXsibmFtZSI6IG5hbWV9LAogICAgICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sCiAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0LmdldCgic3VjY2VzcyIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLinIUgU3RvcHBlZCBtaW5lcjoge25hbWV9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYi4p2MIEZhaWxlZCB0byBzdG9wIG1pbmVyIHtuYW1lfToge3Jlc3VsdC5nZXQoJ21lc3NhZ2UnKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICAKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBzdG9wIG1pbmVyIHtuYW1lfToge2V9IikKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZXJyb3IiOiBzdHIoZSkKICAgICAgICAgICAgfQogICAgCiAgICBkZWYgc3RvcF9taW5lcnMoc2VsZiwgbmFtZXM6IExpc3Rbc3RyXSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgU3RvcCBuaGnhu4F1IG1pbmVycwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG5hbWVzOiBEYW5oIHPDoWNoIHTDqm4gbWluZXJzCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IEvhur90IHF14bqjIHN0b3AKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgIGYie3NlbGYuYmFzZV91cmx9L2FwaS9zdG9wIiwKICAgICAgICAgICAgICAgIGpzb249eyJuYW1lcyI6IG5hbWVzfSwKICAgICAgICAgICAgICAgIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9LAogICAgICAgICAgICAgICAgdGltZW91dD0zMAogICAgICAgICAgICApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgIHN0b3BwZWQgPSByZXN1bHQuZ2V0KCJzdG9wcGVkIiwgW10pCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBTdG9wcGVkIHtsZW4oc3RvcHBlZCl9IG1pbmVycyIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHN0b3AgbWluZXJzOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJlcnJvciI6IHN0cihlKQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBmb3JjZV9zdG9wX2FsbChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBFbWVyZ2VuY3kgc3RvcCB04bqldCBj4bqjIG1pbmluZyBwcm9jZXNzZXMKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0OiBL4bq/dCBxdeG6oyBmb3JjZSBzdG9wCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICBmIntzZWxmLmJhc2VfdXJsfS9hcGkvZm9yY2Utc3RvcC1hbGwiLAogICAgICAgICAgICAgICAgdGltZW91dD0zMAogICAgICAgICAgICApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgIGtpbGxlZF9jb3VudCA9IHJlc3VsdC5nZXQoImtpbGxlZF9jb3VudCIsIDApCiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKaoO+4jyBGb3JjZSBraWxsZWQge2tpbGxlZF9jb3VudH0gbWluaW5nIHByb2Nlc3NlcyIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGZvcmNlIHN0b3AgYWxsOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJlcnJvciI6IHN0cihlKQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBmb3JtYXRfaGFzaF9yYXRlKHNlbGYsIGhhc2hfcmF0ZV9oczogZmxvYXQpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBGb3JtYXQgaGFzaCByYXRlIHThu6sgSC9zIHNhbmcgS0gvcywgTUgvcywgR0gvcwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGhhc2hfcmF0ZV9oczogSGFzaCByYXRlIHRyb25nIEgvcwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IEZvcm1hdHRlZCBoYXNoIHJhdGUKICAgICAgICAiIiIKICAgICAgICBpZiBoYXNoX3JhdGVfaHMgPj0gMWU5OgogICAgICAgICAgICByZXR1cm4gZiJ7aGFzaF9yYXRlX2hzLzFlOTouMmZ9IEdIL3MiCiAgICAgICAgZWxpZiBoYXNoX3JhdGVfaHMgPj0gMWU2OgogICAgICAgICAgICByZXR1cm4gZiJ7aGFzaF9yYXRlX2hzLzFlNjouMmZ9IE1IL3MiCiAgICAgICAgZWxpZiBoYXNoX3JhdGVfaHMgPj0gMWUzOgogICAgICAgICAgICByZXR1cm4gZiJ7aGFzaF9yYXRlX2hzLzFlMzouMmZ9IEtIL3MiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIGYie2hhc2hfcmF0ZV9oczouMmZ9IEgvcyIKICAgIAogICAgZGVmIHN5bmNfY29uZmlnX2Zyb21fbXF0dChzZWxmLCBtcXR0X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgU3luYyBjb25maWcgdOG7qyBNUVRUIHNlcnZlciB24buBIGNsaWVudAogICAgICAgIENI4buIIGfhu41pIGtoaSBjw7MgTVFUVCB1cGRhdGUsIEtIw5RORyBn4buNaSDEkeG7i25oIGvhu7MKICAgICAgICAKICAgICAgICBMb2dpYzoKICAgICAgICAxLiBM4bqleSBsYXN0X3N5bmNfY29uZmlnIHThu6sgbWluaW5nLWNvbmZpZwogICAgICAgIDIuIFNvIHPDoW5oIHbhu5tpIHRpbWVzdGFtcCB04burIE1RVFQKICAgICAgICAzLiBO4bq/dSBNUVRUIG3hu5tpIGjGoW46CiAgICAgICAgICAgLSBLaeG7g20gdHJhIG1pbmluZyBBUEkgY8OzIMSRYW5nIGNo4bqheSBraMO0bmcKICAgICAgICAgICAtIE7hur91IMSRYW5nIGNo4bqheTogS2nhu4NtIHRyYSB2ZXJzaW9uIOKGkiBVcGRhdGUgbuG6v3UgY+G6p24KICAgICAgICAgICAtIE7hur91IGtow7RuZyBjaOG6oXk6IFVwZGF0ZSBsdcO0bgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1xdHRfY29uZmlnOiBDb25maWcgbmjhuq1uIHThu6sgTVFUVCBzZXJ2ZXIgduG7m2kgY+G6pXUgdHLDumM6CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiB0aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgImF1dG9fc3RhcnQiOiBib29sLAogICAgICAgICAgICAgICAgICAgICJtaW5lcnMiOiBbLi4uXQogICAgICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Ugc3luYyB0aMOgbmggY8O0bmcgKERCIMSRxrDhu6NjIGzGsHUsIGLhuqV0IGvhu4MgQVBJIGPDsyBs4buXaSBoYXkga2jDtG5nKQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgbXF0dF90aW1lc3RhbXAgPSBtcXR0X2NvbmZpZy5nZXQoImxhc3Rfc3luY19jb25maWciLCAwKQogICAgICAgICAgICBsb2NhbF90aW1lc3RhbXAgPSBzZWxmLm1pbmluZ19jb25maWcuZ2V0KCJsYXN0X3N5bmNfY29uZmlnIiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiU3luYyBjb25maWcgZnJvbSBNUVRUOiBNUVRUIHRpbWVzdGFtcD17bXF0dF90aW1lc3RhbXB9LCBMb2NhbCB0aW1lc3RhbXA9e2xvY2FsX3RpbWVzdGFtcH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbXF0dF90aW1lc3RhbXAgPiBsb2NhbF90aW1lc3RhbXA6CiAgICAgICAgICAgICAgICAjIE1RVFQgY29uZmlnIG3hu5tpIGjGoW4KICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJNUVRUIGNvbmZpZyBt4bubaSBoxqFuLCDEkWFuZyBraeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgbWluaW5nIEFQSS4uLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBtaW5pbmcgQVBJIGPDsyBob+G6oXQgxJHhu5luZyBraMO0bmcKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmNoZWNrX21pbmluZ19hcGlfaGVhbHRoKCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk1pbmluZyBBUEkgY2jGsGEgc+G6tW4gc8OgbmcsIGzGsHUgY29uZmlnIHbDoG8gREIgdsOgIHPhur0gc3luYyBBUEkgc2F1IikKICAgICAgICAgICAgICAgICAgICAjIEzGsHUgY29uZmlnIHbDoG8gREIsIEFQSSBz4bq9IMSRxrDhu6NjIHN5bmMga2hpIG1pbmluZyBzZXJ2ZXIga2jhu59pIMSR4buZbmcKICAgICAgICAgICAgICAgICAgICBzZWxmLm1pbmluZ19jb25maWcgPSBtcXR0X2NvbmZpZwogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NhdmVfbWluaW5nX2NvbmZpZygpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIuKchSDEkMOjIGzGsHUgY29uZmlnIHbDoG8gREIsIHPhur0gc3luYyB24bubaSBBUEkga2hpIG1pbmluZyBzZXJ2ZXIgc+G6tW4gc8OgbmciKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlICAjIENvaSBuaMawIHRow6BuaCBjw7RuZyB2w6wgREIgxJHDoyBsxrB1CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgc3RhdHVzIHThu6sgQVBJCiAgICAgICAgICAgICAgICBzdGF0dXMgPSBzZWxmLmdldF9zdGF0dXMoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3Qgc3RhdHVzLmdldCgic3VjY2VzcyIpOgogICAgICAgICAgICAgICAgICAgICMgQVBJIGzhu5dpIOKGkiBVcGRhdGUgbHXDtG4gKGzGsHUgREIgKyB0aOG7rSBn4butaSBBUEkpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk1pbmluZyBBUEkgbOG7l2ksIMSRYW5nIHVwZGF0ZSBjb25maWcuLi4iKQogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYudXBkYXRlX2NvbmZpZyhtcXR0X2NvbmZpZykKICAgICAgICAgICAgICAgICAgICAjIE7hur91IERCIMSRw6MgbMawdSB0aMOsIGNvaSBuaMawIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuZ2V0KCJkYl9zYXZlZCIsIEZhbHNlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBtaW5lcnMgPSBzdGF0dXMuZ2V0KCJtaW5lcnMiLCBbXSkKICAgICAgICAgICAgICAgIGFwaV92ZXJzaW9uID0gc3RhdHVzLmdldCgiY29uZmlnX3ZlcnNpb24iLCAwKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyBjw7MgbWluZXJzIOKGkiBVcGRhdGUgbHXDtG4KICAgICAgICAgICAgICAgIGlmIG5vdCBtaW5lcnM6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk1pbmluZyBBUEkgY2jGsGEgY8OzIG1pbmVycywgxJFhbmcgdXBkYXRlIGNvbmZpZy4uLiIpCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi51cGRhdGVfY29uZmlnKG1xdHRfY29uZmlnKQogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgREIgxJHDoyBsxrB1IHRow6wgY29pIG5oxrAgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXQoImRiX3NhdmVkIiwgRmFsc2UpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIG1pbmVycyDihpIgS2nhu4NtIHRyYSB2ZXJzaW9uCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk1pbmluZyBBUEkgxJFhbmcgY2jhuqF5IHtsZW4obWluZXJzKX0gbWluZXJzICh2ZXJzaW9uOiB7YXBpX3ZlcnNpb259KSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGFwaV92ZXJzaW9uICE9IG1xdHRfdGltZXN0YW1wOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVmVyc2lvbiBraMOhYyBuaGF1LCDEkWFuZyB1cGRhdGUgY29uZmlnLi4uIikKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBzZWxmLnVwZGF0ZV9jb25maWcobXF0dF9jb25maWcpCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBEQiDEkcOjIGzGsHUgdGjDrCBjb2kgbmjGsCB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmdldCgiZGJfc2F2ZWQiLCBGYWxzZSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBWZXJzaW9uIMSRw6Mga2jhu5twLCBjaOG7iSBj4bqnbiBsxrB1IHbDoG8gREIKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiTWluaW5nIEFQSSDEkcOjIGPDsyBjb25maWcgdmVyc2lvbiBt4bubaSBuaOG6pXQiKQogICAgICAgICAgICAgICAgICAgIHNlbGYubWluaW5nX2NvbmZpZyA9IG1xdHRfY29uZmlnCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2F2ZV9taW5pbmdfY29uZmlnKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBDb25maWcgxJHDoyBzeW5jIGhv4bq3YyBNUVRUIGPFqSBoxqFuLCBi4buPIHF1YQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkNvbmZpZyDEkcOjIMSRxrDhu6NjIHN5bmMsIGtow7RuZyBj4bqnbiB1cGRhdGUiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHN5bmMgY29uZmlnIHThu6sgTVFUVDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBnZXRfbWluaW5nX3N1bW1hcnkoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdOG7lW5nIGjhu6NwIHRow7RuZyB0aW4gbWluaW5nCiAgICAgICAgR+G7jEkgVFLhu7BDIFRJ4bq+UCBBUEkgxJHhu4MgbOG6pXkgc3RhdHVzIHJlYWwtdGltZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IFN1bW1hcnkgYmFvIGfhu5NtOgogICAgICAgICAgICAgICAgLSBO4bq/dSBraMO0bmcgY8OzIGNvbmZpZyBjb2luIOKGkiBUcuG6oyB24buBIHt9IHLhu5duZwogICAgICAgICAgICAgICAgLSBO4bq/dSBjw7MgY29uZmlnIGNvaW4g4oaSIEzhuqV5IHN0YXR1cyB04burIEFQSQogICAgICAgICAgICAgICAgLSBO4bq/dSBBUEkgbOG7l2kgQ29ubmVjdGlvbiByZWZ1c2VkIOKGkiBBdXRvIHN0YXJ0IG1pbmluZyBzZXJ2ZXIgMSBs4bqnbgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDsyBjb25maWcgY29pbiBraMO0bmcKICAgICAgICAgICAgaWYgbm90IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoIm1pbmVycyIpOgogICAgICAgICAgICAgICAgIyBLaMO0bmcgY8OzIGNvbmZpZyBjb2luIOKGkiBUcuG6oyB24buBIHLhu5duZwogICAgICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPDsyBjb25maWcgY29pbiDihpIgR+G7jWkgQVBJIMSR4buDIGzhuqV5IHN0YXR1cyByZWFsLXRpbWUKICAgICAgICAgICAgc3RhdHVzID0gc2VsZi5nZXRfc3RhdHVzKHNhdmVfdG9fZGI9RmFsc2UpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc3RhdHVzLmdldCgic3VjY2VzcyIpOgogICAgICAgICAgICAgICAgIyBBUEkgbOG7l2kKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IHN0YXR1cy5nZXQoImVycm9yIiwgIlVua25vd24gZXJyb3IiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbuG6v3UgbMOgIGzhu5dpIENvbm5lY3Rpb24gcmVmdXNlZCDihpIgQXV0byBzdGFydCBtaW5pbmcgc2VydmVyCiAgICAgICAgICAgICAgICBpZiAiQ29ubmVjdGlvbiByZWZ1c2VkIiBpbiBlcnJvcl9tc2cgb3IgIkZhaWxlZCB0byBlc3RhYmxpc2ggYSBuZXcgY29ubmVjdGlvbiIgaW4gZXJyb3JfbXNnOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTWluaW5nIEFQSSBraMO0bmcga+G6v3QgbuG7kWkgxJHGsOG7o2MsIMSRYW5nIGto4bufaSDEkeG7mW5nIG1pbmluZyBzZXJ2ZXIuLi4iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgR+G7jWkgbOG7h25oIHJ1bi1taW5pbmcgMSBs4bqnbgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX3N0YXJ0X21pbmluZ19zZXJ2ZXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgZ+G7rWkgbOG7h25oIGto4bufaSDEkeG7mW5nIG1pbmluZyBzZXJ2ZXIiKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGto4bufaSDEkeG7mW5nIG1pbmluZyBzZXJ2ZXIiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgdGjDtG5nIHRpbiBs4buXaQogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTWluaW5nIEFQSSBs4buXaToge2Vycm9yX21zZ30iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgImF1dG9fc3RhcnQiOiBzZWxmLm1pbmluZ19jb25maWcuZ2V0KCJhdXRvX3N0YXJ0IiwgRmFsc2UpLAogICAgICAgICAgICAgICAgICAgICJsYXN0X3N5bmNfY29uZmlnIjogc2VsZi5taW5pbmdfY29uZmlnLmdldCgibGFzdF9zeW5jX2NvbmZpZyIsIDApLAogICAgICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICAgICAgICAgInRvdGFsX21pbmVycyI6IDAsCiAgICAgICAgICAgICAgICAgICAgInJ1bm5pbmdfbWluZXJzIjogMCwKICAgICAgICAgICAgICAgICAgICAic3RvcHBlZF9taW5lcnMiOiAwLAogICAgICAgICAgICAgICAgICAgICJlcnJvcl9tZXNzYWdlIjogZiJLaMO0bmcga+G6v3QgbuG7kWkgxJHGsOG7o2MgTWluaW5nIEFQSToge2Vycm9yX21zZ30iLAogICAgICAgICAgICAgICAgICAgICJtaW5lcnMiOiBbXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBtaW5lcnMgdOG7qyBBUEkgcmVzcG9uc2UKICAgICAgICAgICAgbWluZXJzID0gc3RhdHVzLmdldCgibWluZXJzIiwgW10pCiAgICAgICAgICAgIHJ1bm5pbmdfY291bnQgPSBzdW0oMSBmb3IgbSBpbiBtaW5lcnMgaWYgbS5nZXQoInN0YXR1cyIpID09ICJydW5uaW5nIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRm9ybWF0IGhhc2ggcmF0ZSBjaG8gbeG7l2kgbWluZXIKICAgICAgICAgICAgbWluZXJzX2RldGFpbCA9IFtdCiAgICAgICAgICAgIGZvciBtaW5lciBpbiBtaW5lcnM6CiAgICAgICAgICAgICAgICBoYXNoX3JhdGVfaHMgPSBtaW5lci5nZXQoImhhc2hfcmF0ZSIsIDApCiAgICAgICAgICAgICAgICBtaW5lcnNfZGV0YWlsLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiBtaW5lci5nZXQoIm5hbWUiKSwKICAgICAgICAgICAgICAgICAgICAiY29pbl9uYW1lIjogbWluZXIuZ2V0KCJjb2luX25hbWUiKSwKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogbWluZXIuZ2V0KCJzdGF0dXMiKSwKICAgICAgICAgICAgICAgICAgICAiaGFzaF9yYXRlX2hzIjogaGFzaF9yYXRlX2hzLAogICAgICAgICAgICAgICAgICAgICJoYXNoX3JhdGVfZm9ybWF0dGVkIjogc2VsZi5mb3JtYXRfaGFzaF9yYXRlKGhhc2hfcmF0ZV9ocyksCiAgICAgICAgICAgICAgICAgICAgIm1pbmluZ190b29sIjogbWluZXIuZ2V0KCJtaW5pbmdfdG9vbCIpLAogICAgICAgICAgICAgICAgICAgICJwaWQiOiBtaW5lci5nZXQoInBpZCIpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogVHJ1ZSwKICAgICAgICAgICAgICAgICMgVGjDtG5nIHRpbiBjb25maWcgdOG7qyBtaW5pbmctY29uZmlnCiAgICAgICAgICAgICAgICAiYXV0b19zdGFydCI6IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoImF1dG9fc3RhcnQiLCBGYWxzZSksCiAgICAgICAgICAgICAgICAibGFzdF9zeW5jX2NvbmZpZyI6IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoImxhc3Rfc3luY19jb25maWciLCAwKSwKICAgICAgICAgICAgICAgICMgVGjDtG5nIHRpbiBzdGF0dXMgcmVhbC10aW1lIHThu6sgQVBJCiAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAgICAgInRvdGFsX21pbmVycyI6IGxlbihtaW5lcnMpLAogICAgICAgICAgICAgICAgInJ1bm5pbmdfbWluZXJzIjogcnVubmluZ19jb3VudCwKICAgICAgICAgICAgICAgICJzdG9wcGVkX21pbmVycyI6IGxlbihtaW5lcnMpIC0gcnVubmluZ19jb3VudCwKICAgICAgICAgICAgICAgICJlcnJvcl9tZXNzYWdlIjogIiIsCiAgICAgICAgICAgICAgICAibWluZXJzIjogbWluZXJzX2RldGFpbAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSBraGkgbOG6pXkgbWluaW5nIHN1bW1hcnk6IHtlfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSBraMO0bmcgY8OzIGNvbmZpZyBjb2luIOKGkiBUcuG6oyB24buBIHLhu5duZwogICAgICAgICAgICBpZiBub3Qgc2VsZi5taW5pbmdfY29uZmlnLmdldCgibWluZXJzIik6CiAgICAgICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImF1dG9fc3RhcnQiOiBzZWxmLm1pbmluZ19jb25maWcuZ2V0KCJhdXRvX3N0YXJ0IiwgRmFsc2UpLAogICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiBzZWxmLm1pbmluZ19jb25maWcuZ2V0KCJsYXN0X3N5bmNfY29uZmlnIiwgMCksCiAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAgICAgInRvdGFsX21pbmVycyI6IDAsCiAgICAgICAgICAgICAgICAicnVubmluZ19taW5lcnMiOiAwLAogICAgICAgICAgICAgICAgInN0b3BwZWRfbWluZXJzIjogMCwKICAgICAgICAgICAgICAgICJlcnJvcl9tZXNzYWdlIjogZXJyb3JfbXNnLAogICAgICAgICAgICAgICAgIm1pbmVycyI6IFtdCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIGNoZWNrX21pbmluZ19hcGlfaGVhbHRoKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSBtaW5pbmcgQVBJIHNlcnZlciBjw7MgaG/huqF0IMSR4buZbmcga2jDtG5nCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBzZXJ2ZXIgaG/huqF0IMSR4buZbmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGYie3NlbGYuYmFzZV91cmx9L2FwaS9zdGF0dXMiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQo=').decode('utf-8'))
