import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aHJlYWRpbmcKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgT3B0aW9uYWwKaW1wb3J0IHV0aWxzCgojIFThuqFvIGxvZ2dlciByacOqbmcgY2hvIFByb3h5U2VydmljZQpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJQcm94eVNlcnZpY2UiKQoKY2xhc3MgUHJveHlTZXJ2aWNlOgogICAgIiIiCiAgICBTZXJ2aWNlIHF14bqjbiBsw70gcHJveHkgdsOgIHTGsMahbmcgdMOhYyB24bubaSBwcm94eSBzZXJ2ZXIKICAgICIiIgogICAgCiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBQcm94eVNlcnZpY2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBkYl9zZXJ2aWNlOiBEYXRhYmFzZVNlcnZpY2UgxJHhu4MgbMawdSB0cuG7ryBk4buvIGxp4buHdQogICAgICAgICAgICBoZWxwZXJfc2VydmljZTogSGVscGVyU2VydmljZSDEkeG7gyB0xrDGoW5nIHTDoWMgduG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5kYiA9IGRiX3NlcnZpY2UKICAgICAgICBzZWxmLmhlbHBlciA9IGhlbHBlcl9zZXJ2aWNlCiAgICAgICAgCiAgICAgICAgIyBUcuG6oW5nIHRow6FpIHByb3h5IGhp4buHbiB04bqhaQogICAgICAgIHNlbGYuY3VycmVudF9wcm94eV9pZCA9IE5vbmUKICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfbmFtZSA9IE5vbmUKICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUgPSBOb25lICAjIFRhYmxlIG5hbWUgxJHGsOG7o2MgY+G6pXAgdOG7qyBwcm94eSBzZXJ2ZXIKICAgICAgICBzZWxmLnByb3h5X2xhc3RfdXBkYXRlID0gMCAgIyBUaOG7nWkgZ2lhbiB1cGRhdGUgY3Xhu5FpIGPDuW5nCiAgICAgICAgCiAgICAgICAgIyDEkOG6v20gc+G7kSBs4bqnbiB0aOG6pXQgYuG6oWkga2hpIHNldHVwIHByb3h5CiAgICAgICAgc2VsZi5wcm94eV9zZXR1cF9mYWlsX2NvdW50ID0gMAogICAgICAgIAogICAgICAgICMgVGhyZWFkIHVwZGF0ZSDEkeG7i25oIGvhu7MKICAgICAgICBzZWxmLnVwZGF0ZV90aHJlYWQgPSBOb25lCiAgICAgICAgc2VsZi51cGRhdGVfdGhyZWFkX3J1bm5pbmcgPSBGYWxzZQogICAgICAgIHNlbGYudXBkYXRlX2ludGVydmFsID0gMjAgICMgQ+G6rXAgbmjhuq10IG3hu5dpIDIwIGdpw6J5CiAgICAgICAgCiAgICAgICAgIyBYw7NhIHByb3h5IHRhYmxlIG5hbWUgY8WpIGto4buPaSBkZXZpY2UgY29uZmlnIGtoaSBraOG7n2kgdOG6oW8KICAgICAgICBzZWxmLmRiLnNldF9kZXZpY2VfY29uZmlnKCJwcm94eV90YWJsZV9uYW1lIiwgTm9uZSkKICAgIAogICAgZGVmIF9zdGFydF91cGRhdGVfdGhyZWFkKHNlbGYpOgogICAgICAgICIiIkLhuq90IMSR4bqndSB0aHJlYWQgdXBkYXRlIMSR4buLbmgga+G7syIiIgogICAgICAgIGlmIHNlbGYudXBkYXRlX3RocmVhZCBhbmQgc2VsZi51cGRhdGVfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiVGhyZWFkIHVwZGF0ZSBwcm94eSDEkcOjIMSRYW5nIGNo4bqheSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBzZWxmLnVwZGF0ZV90aHJlYWRfcnVubmluZyA9IFRydWUKICAgICAgICBzZWxmLnVwZGF0ZV90aHJlYWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1zZWxmLl91cGRhdGVfd29ya2VyLCBkYWVtb249VHJ1ZSkKICAgICAgICBzZWxmLnVwZGF0ZV90aHJlYWQuc3RhcnQoKQogICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBi4bqvdCDEkeG6p3UgdGhyZWFkIHVwZGF0ZSBwcm94eSAoaW50ZXJ2YWw6IHtzZWxmLnVwZGF0ZV9pbnRlcnZhbH1zKSIpCiAgICAgICAgCiAgICBkZWYgX3N0b3BfdXBkYXRlX3RocmVhZChzZWxmKToKICAgICAgICAiIiJE4burbmcgdGhyZWFkIHVwZGF0ZSDEkeG7i25oIGvhu7MiIiIKICAgICAgICBzZWxmLnVwZGF0ZV90aHJlYWRfcnVubmluZyA9IEZhbHNlCiAgICAgICAgaWYgc2VsZi51cGRhdGVfdGhyZWFkIGFuZCBzZWxmLnVwZGF0ZV90aHJlYWQuaXNfYWxpdmUoKToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQYW5nIGThu6tuZyB0aHJlYWQgdXBkYXRlIHByb3h5Li4uIikKICAgICAgICAgICAgc2VsZi51cGRhdGVfdGhyZWFkLmpvaW4odGltZW91dD01KQogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBk4burbmcgdGhyZWFkIHVwZGF0ZSBwcm94eSIpCiAgICAgICAgICAgIAogICAgZGVmIF91cGRhdGVfd29ya2VyKHNlbGYpOgogICAgICAgICIiIldvcmtlciBmdW5jdGlvbiBjaG8gdGhyZWFkIHVwZGF0ZSDEkeG7i25oIGvhu7MiIiIKICAgICAgICBsb2dnZXIuaW5mbygiVGhyZWFkIHVwZGF0ZSBwcm94eSDEkcOjIGLhuq90IMSR4bqndSIpCiAgICAgICAgCiAgICAgICAgd2hpbGUgc2VsZi51cGRhdGVfdGhyZWFkX3J1bm5pbmc6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgQ2jhu4kgdXBkYXRlIGtoaSBwcm94eSDEkWFuZyBhY3RpdmUKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfcHJveHlfYWN0aXZlKCk6CiAgICAgICAgICAgICAgICAgICAgY3VycmVudF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3RpbWUgLSBzZWxmLnByb3h5X2xhc3RfdXBkYXRlID49IHNlbGYudXBkYXRlX2ludGVydmFsOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnVwZGF0ZV9wcm94eSgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJUaHJlYWQgYXV0by11cGRhdGUgcHJveHkgdGltZXN0YW1wIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiVGhyZWFkIGF1dG8tdXBkYXRlIHByb3h5IHRpbWVzdGFtcCB0aOG6pXQgYuG6oWkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFNsZWVwIHbhu5tpIGtp4buDbSB0cmEgxJFp4buBdSBraeG7h24gZOG7q25nCiAgICAgICAgICAgICAgICBmb3IgXyBpbiByYW5nZShzZWxmLnVwZGF0ZV9pbnRlcnZhbCk6CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYudXBkYXRlX3RocmVhZF9ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHRyb25nIHRocmVhZCB1cGRhdGUgcHJveHk6IHtlfSIpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDUpICAjIFNsZWVwIG5n4bqvbiBraGkgY8OzIGzhu5dpCiAgICAgICAgICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbygiVGhyZWFkIHVwZGF0ZSBwcm94eSDEkcOjIGThu6tuZyIpCiAgICAKICAgIGRlZiBfcHJveHlfYXBpX2NhbGwoc2VsZiwgZW5kcG9pbnQ6IHN0ciwgZGF0YTogRGljdFtzdHIsIEFueV0pIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBH4buNaSBBUEkgcHJveHkgc2VydmVyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZW5kcG9pbnQ6IEVuZHBvaW50IEFQSSAocmVnaXN0ZXIsIHVwZGF0ZSwgdW5yZWdpc3RlciwgcmVzZXQtaXApCiAgICAgICAgICAgIGRhdGE6IEThu68gbGnhu4d1IGfhu61pCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgcmVzcG9uc2UgaG/hurdjIE5vbmUgbuG6v3UgbOG7l2kKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByb3h5X3NlcnZlciA9IHNlbGYuZGIuZ2V0KCJwcm94eV9zZXJ2ZXIiLCAiaHR0cDovLzEwLjAuMC41OjkwMzIiKQogICAgICAgICAgICB1cmwgPSBmIntwcm94eV9zZXJ2ZXJ9L3tlbmRwb2ludH0iCiAgICAgICAgICAgIAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBqc29uPWRhdGEsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJQcm94eSBBUEkge2VuZHBvaW50fSBmYWlsZWQgd2l0aCBzdGF0dXMge3Jlc3BvbnNlLnN0YXR1c19jb2RlfToge3Jlc3BvbnNlLnRleHR9IikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4buNaSBQcm94eSBBUEkge2VuZHBvaW50fToge2V9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIHJlZ2lzdGVyX3Byb3h5KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgxJDEg25nIGvDvSB24bubaSBwcm94eSBzZXJ2ZXIgxJHhu4MgxJHGsOG7o2MgY+G6pXAgcGjDoXQgdGFibGUgKHZlcnNpb24gxJHGoW4gZ2nhuqNuKQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJHGsOG7o2MgY+G6pXAgdGFibGUsIEZhbHNlIG7hur91IHbDoG8gcXVldWUgaG/hurdjIGzhu5dpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgaGVscGVyIHNlcnZpY2UKICAgICAgICAgICAgbG9jYWxfaXAgPSBzZWxmLmhlbHBlci5nZXRfbG9jYWxfaXAoKQogICAgICAgICAgICBpZiBub3QgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBs4bqleSBsb2NhbCBJUCwgYuG7jyBxdWEgxJHEg25nIGvDvSBwcm94eSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGRhdGEgPSB7ImxvY2FsX2lwIjogbG9jYWxfaXB9CiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5fcHJveHlfYXBpX2NhbGwoInJlZ2lzdGVyIiwgZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCByZXNwb25zZToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHN0YXR1cyA9IHJlc3BvbnNlLmdldCgic3RhdHVzIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN0YXR1cyA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICAjIMSQxrDhu6NjIGPhuqVwIHRhYmxlIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgdGFibGVfbmFtZSA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoInRhYmxlX25hbWUiKQogICAgICAgICAgICAgICAgYWN0aW9uID0gcmVzcG9uc2UuZ2V0KCJkYXRhIiwge30pLmdldCgiYWN0aW9uIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlID0gdGFibGVfbmFtZQogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X25hbWUgPSBmInt0YWJsZV9uYW1lfSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMxrB1IHByb3h5IHRhYmxlIG5hbWUgdsOgbyBkZXZpY2UgY29uZmlnIMSR4buDIGfhu61pIGzDqm4gc2VydmVyCiAgICAgICAgICAgICAgICBzZWxmLmRiLnNldF9kZXZpY2VfY29uZmlnKCJwcm94eV90YWJsZV9uYW1lIiwgdGFibGVfbmFtZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQcm94eSDEkcOjIMSRxrDhu6NjIGPhuqVwIHRhYmxlOiB7dGFibGVfbmFtZX0gKGFjdGlvbjoge2FjdGlvbn0pIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBC4bqvdCDEkeG6p3UgdGhyZWFkIHVwZGF0ZSDEkeG7i25oIGvhu7MKICAgICAgICAgICAgICAgIHNlbGYuX3N0YXJ0X3VwZGF0ZV90aHJlYWQoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVsaWYgc3RhdHVzID09ICJxdWV1ZWQiOgogICAgICAgICAgICAgICAgIyBWw6BvIHF1ZXVlIGNo4budCiAgICAgICAgICAgICAgICBxdWV1ZV9wb3NpdGlvbiA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoInF1ZXVlX3Bvc2l0aW9uIiwgMCkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiUHJveHkgc2VydmVyIGZ1bGwsIHbDoG8gaMOgbmcgxJHhu6NpIHbhu4sgdHLDrSB7cXVldWVfcG9zaXRpb259IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJQcm94eSByZWdpc3RlciB0aOG6pXQgYuG6oWk6IHtyZXNwb25zZS5nZXQoJ21lc3NhZ2UnLCAnVW5rbm93biBlcnJvcicpfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMSRxINuZyBrw70gcHJveHkiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHVwZGF0ZV9wcm94eShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEPhuq1wIG5o4bqtdCB0aW1lc3RhbXAgc+G7rSBk4bulbmcgcHJveHkKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHVwZGF0ZSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBoZWxwZXIgc2VydmljZQogICAgICAgICAgICBsb2NhbF9pcCA9IHNlbGYuaGVscGVyLmdldF9sb2NhbF9pcCgpCiAgICAgICAgICAgIGlmIG5vdCBsb2NhbF9pcDoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgbOG6pXkgbG9jYWwgSVAsIGLhu48gcXVhIHVwZGF0ZSBwcm94eSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGRhdGEgPSB7ImxvY2FsX2lwIjogbG9jYWxfaXB9CiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5fcHJveHlfYXBpX2NhbGwoInVwZGF0ZSIsIGRhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICBzZWxmLnByb3h5X2xhc3RfdXBkYXRlID0gdGltZS50aW1lKCkKICAgICAgICAgICAgICAgICMgTG9nIHRow7RuZyB0aW4gdOG7qyByZXNwb25zZSBu4bq/dSBjw7MKICAgICAgICAgICAgICAgIGRhdGEgPSByZXNwb25zZS5nZXQoImRhdGEiLCB7fSkKICAgICAgICAgICAgICAgIHRhYmxlX25hbWUgPSBkYXRhLmdldCgidGFibGVfbmFtZSIsICJ1bmtub3duIikKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlByb3h5IHVwZGF0ZSB0aMOgbmggY8O0bmcgY2hvIHRhYmxlOiB7dGFibGVfbmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiUHJveHkgdXBkYXRlIHRo4bqldCBi4bqhaToge3Jlc3BvbnNlLmdldCgnbWVzc2FnZScpIGlmIHJlc3BvbnNlIGVsc2UgJ05vIHJlc3BvbnNlJ30iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHVwZGF0ZSBwcm94eToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB1bnJlZ2lzdGVyX3Byb3h5KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgSOG7p3kgxJHEg25nIGvDvSB2w6AgZ2nhuqNpIHBow7NuZyB0YWJsZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdW5yZWdpc3RlciB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBoZWxwZXIgc2VydmljZQogICAgICAgICAgICBsb2NhbF9pcCA9IHNlbGYuaGVscGVyLmdldF9sb2NhbF9pcCgpCiAgICAgICAgICAgIGlmIG5vdCBsb2NhbF9pcDoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgbOG6pXkgbG9jYWwgSVAsIGLhu48gcXVhIHVucmVnaXN0ZXIgcHJveHkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBkYXRhID0geyJsb2NhbF9pcCI6IGxvY2FsX2lwfQogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuX3Byb3h5X2FwaV9jYWxsKCJ1bnJlZ2lzdGVyIiwgZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgIHJlbGVhc2VkX3RhYmxlID0gcmVzcG9uc2UuZ2V0KCJkYXRhIiwge30pLmdldCgicmVsZWFzZWRfdGFibGUiKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIHVucmVnaXN0ZXIgcHJveHkgdsOgIGdp4bqjaSBwaMOzbmcgdGFibGU6IHtyZWxlYXNlZF90YWJsZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEThu6tuZyB0aHJlYWQgdXBkYXRlIMSR4buLbmgga+G7swogICAgICAgICAgICAgICAgc2VsZi5fc3RvcF91cGRhdGVfdGhyZWFkKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBSZXNldCB0cuG6oW5nIHRow6FpIHByb3h5CiAgICAgICAgICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUgPSBOb25lCiAgICAgICAgICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfbmFtZSA9IE5vbmUKICAgICAgICAgICAgICAgIHNlbGYucHJveHlfbGFzdF91cGRhdGUgPSAwCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgWMOzYSBwcm94eSB0YWJsZSBuYW1lIGto4buPaSBkZXZpY2UgY29uZmlnCiAgICAgICAgICAgICAgICBzZWxmLmRiLnNldF9kZXZpY2VfY29uZmlnKCJwcm94eV90YWJsZV9uYW1lIiwgTm9uZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiUHJveHkgdW5yZWdpc3RlciB0aOG6pXQgYuG6oWk6IHtyZXNwb25zZS5nZXQoJ21lc3NhZ2UnKSBpZiByZXNwb25zZSBlbHNlICdObyByZXNwb25zZSd9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSB1bnJlZ2lzdGVyIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHJlc2V0X2lwKHNlbGYsIHRhYmxlX25hbWU6IHN0ciA9IE5vbmUpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUmVzZXQgSVAgY2hvIHByb3h5IGhp4buHbiB04bqhaSBob+G6t2MgdGFibGUgxJHGsOG7o2MgY2jhu4kgxJHhu4tuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhYmxlX25hbWU6IFTDqm4gdGFibGUgY+G6p24gcmVzZXQgSVAgKG9wdGlvbmFsLCBu4bq/dSBraMO0bmcgY8OzIHPhur0gZMO5bmcgdGFibGUgaGnhu4duIHThuqFpKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHJlc2V0IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFPhu60gZOG7pW5nIHRhYmxlIMSRxrDhu6NjIGNo4buJIMSR4buLbmggaG/hurdjIHRhYmxlIGhp4buHbiB04bqhaQogICAgICAgICAgICB0YXJnZXRfdGFibGUgPSB0YWJsZV9uYW1lIG9yIHNlbGYuY3VycmVudF9wcm94eV90YWJsZQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHRhcmdldF90YWJsZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIGPDsyB0YWJsZSBwcm94eSDEkeG7gyByZXNldCBJUCIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2h1eeG7g24gdGFibGUgbmFtZSB0aMOgbmggcHBvZSBuYW1lCiAgICAgICAgICAgIHBwb2VfbmFtZSA9IHRhcmdldF90YWJsZS5yZXBsYWNlKCJ0b18iLCAiIikgICMgQ2h1eeG7g24gInRvX3BwcG9lMiIgdGjDoG5oICJwcHBvZTIiCiAgICAgICAgICAgIHJlc2V0X2RhdGEgPSB7InBwb2VfbmFtZSI6IGYie3Bwb2VfbmFtZX0ifQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyByZXNldCBJUCBjaG8gdGFibGU6IHt0YXJnZXRfdGFibGV9IChwcG9lOiB7cHBvZV9uYW1lfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzZXRfcmVzcG9uc2UgPSBzZWxmLl9wcm94eV9hcGlfY2FsbCgicmVzZXQtaXAiLCByZXNldF9kYXRhKQogICAgICAgICAgICBpZiByZXNldF9yZXNwb25zZSBhbmQgcmVzZXRfcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgcmVzZXQgSVAgY2hvIHtwcG9lX25hbWV9IHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gcmVzZXRfcmVzcG9uc2UuZ2V0KCdtZXNzYWdlJykgaWYgcmVzZXRfcmVzcG9uc2UgZWxzZSAnTm8gcmVzcG9uc2UnCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgcmVzZXQgSVAgY2hvIHtwcG9lX25hbWV9OiB7ZXJyb3JfbXNnfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSByZXNldCBJUCBjaG8gdGFibGU6IHt0YWJsZV9uYW1lIG9yIHNlbGYuY3VycmVudF9wcm94eV90YWJsZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGNoZWNrX3Byb3h5X3JlcXVpcmVtZW50KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6AgxJHEg25nIGvDvSBwcm94eSBu4bq/dSBj4bqnbgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHByb3h5IGhv4bq3YyBraMO0bmcgY+G6p24gcHJveHksIEZhbHNlIG7hur91IGPhuqduIHByb3h5IG5oxrBuZyBjaMawYSDEkcaw4bujYyBj4bqlcAogICAgICAgICIiIgogICAgICAgIHVzZV9wcm94eSA9IHNlbGYuZGIuZ2V0KCJ1c2VfcHJveHkiLCBGYWxzZSkKICAgICAgICAKICAgICAgICBpZiBub3QgdXNlX3Byb3h5OgogICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBLaMO0bmcgY+G6p24gcHJveHkKICAgICAgICAgICAgCiAgICAgICAgIyBO4bq/dSDEkcOjIGPDsyB0YWJsZSB0aMOsIHJldHVybiBUcnVlCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAjIENoxrBhIGPDsyB0YWJsZSwgdGjhu60gxJHEg25nIGvDvQogICAgICAgIHJldHVybiBzZWxmLnJlZ2lzdGVyX3Byb3h5KCkKICAgIAogICAgZGVmIGdldF9wcm94eV9kaXNwbGF5X25hbWUoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHTDqm4gaGnhu4NuIHRo4buLIGNobyBwcm94eSBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFTDqm4gaGnhu4NuIHRo4buLIGPhu6dhIHByb3h5CiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X25hbWU6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmN1cnJlbnRfcHJveHlfbmFtZQogICAgICAgIGVsaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICByZXR1cm4gZiJ7c2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlfSIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIlVua25vd24iCiAgICAKICAgIGRlZiBzZXR1cF9wcm94eV9mb3Jfc2Vzc2lvbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgY2hvIHBoacOqbiBsw6BtIHZp4buHYwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGhp4bq/dCBs4bqtcCB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgICMgTuG6v3UgxJHDoyBjw7MgdGFibGUgcHJveHkgdGjDrCBzZXR1cCB4b25nIHLhu5NpCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICBwcm94eV9uYW1lID0gc2VsZi5nZXRfcHJveHlfZGlzcGxheV9uYW1lKCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQcm94eSB7cHJveHlfbmFtZX0gxJHDoyBz4bq1biBzw6BuZyBjaG8gcGhpw6puIGzDoG0gdmnhu4djIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgIyBO4bq/dSBjaMawYSBjw7MgdGjDrCDEkcSDbmcga8O9CiAgICAgICAgcmV0dXJuIHNlbGYucmVnaXN0ZXJfcHJveHkoKQogICAgCiAgICBkZWYgcmVsZWFzZV9wcm94eV9hZnRlcl9zZXNzaW9uKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgR2nhuqNpIHBow7NuZyBwcm94eSBzYXUga2hpIGvhur90IHRow7pjIHBoacOqbiBsw6BtIHZp4buHYwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgZ2nhuqNpIHBow7NuZyB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICAgICAgcHJveHlfbmFtZSA9IHNlbGYuZ2V0X3Byb3h5X2Rpc3BsYXlfbmFtZSgpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGdp4bqjaSBwaMOzbmcgcHJveHkge3Byb3h5X25hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBH4buNaSBBUEkgdW5yZWdpc3RlcgogICAgICAgICAgICAgICAgaWYgc2VsZi51bnJlZ2lzdGVyX3Byb3h5KCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGdp4bqjaSBwaMOzbmcgcHJveHkge3Byb3h5X25hbWV9IHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJHaeG6o2kgcGjDs25nIHByb3h5IHtwcm94eV9uYW1lfSB0aOG6pXQgYuG6oWkiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJLaMO0bmcgY8OzIHByb3h5IMSR4buDIGdp4bqjaSBwaMOzbmciKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgZ2nhuqNpIHBow7NuZyBwcm94eSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgaXNfcHJveHlfYWN0aXZlKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIHByb3h5IMSRYW5nIGhv4bqhdCDEkeG7mW5nIGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHByb3h5IMSRYW5nIGhv4bqhdCDEkeG7mW5nLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gYm9vbChzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUpCiAgICAKICAgIGRlZiBnZXRfcHJveHlfaW5mbyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIHByb3h5IGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBUaMO0bmcgdGluIHByb3h5CiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgInByb3h5X2lkIjogc2VsZi5jdXJyZW50X3Byb3h5X2lkLAogICAgICAgICAgICAicHJveHlfbmFtZSI6IHNlbGYuY3VycmVudF9wcm94eV9uYW1lLAogICAgICAgICAgICAicHJveHlfdGFibGUiOiBzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUsCiAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IHNlbGYucHJveHlfbGFzdF91cGRhdGUsCiAgICAgICAgICAgICJkaXNwbGF5X25hbWUiOiBzZWxmLmdldF9wcm94eV9kaXNwbGF5X25hbWUoKSwKICAgICAgICAgICAgImlzX2FjdGl2ZSI6IHNlbGYuaXNfcHJveHlfYWN0aXZlKCkKICAgICAgICB9CiAgICAKICAgIGRlZiBmb3JjZV9yZXNldF9jdXJyZW50X2lwKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQuG6r3QgYnXhu5ljIHJlc2V0IElQIGNobyBwcm94eSBoaeG7h24gdOG6oWkgKGPDsyB0aOG7gyBn4buNaSB0cm9uZyBxdcOhIHRyw6xuaCBsw6BtIHZp4buHYykKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHJlc2V0IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuY3VycmVudF9wcm94eV90YWJsZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgcHJveHkgxJFhbmcgaG/huqF0IMSR4buZbmcgxJHhu4MgcmVzZXQgSVAiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIkLhuq90IGJ14buZYyByZXNldCBJUCBjaG8gcHJveHkgaGnhu4duIHThuqFpIHRyb25nIHF1w6EgdHLDrG5oIGzDoG0gdmnhu4djIikKICAgICAgICByZXR1cm4gc2VsZi5yZXNldF9pcCgpCiAgICAKICAgIGRlZiBnZXRfcHJveHlfc3RhdHVzKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0cuG6oW5nIHRow6FpIHByb3h5IGhp4buHbiB04bqhaSBkxrDhu5tpIGThuqFuZyBzdHJpbmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFRy4bqhbmcgdGjDoWkgcHJveHkKICAgICAgICAiIiIKICAgICAgICBpZiBub3Qgc2VsZi5kYi5nZXQoInVzZV9wcm94eSIsIEZhbHNlKToKICAgICAgICAgICAgcmV0dXJuICJLaMO0bmcgc+G7rSBk4bulbmcgcHJveHkiCiAgICAgICAgZWxpZiBub3Qgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICByZXR1cm4gIkNoxrBhIGPDsyBwcm94eSIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gZiLEkGFuZyBz4butIGThu6VuZyBwcm94eToge3NlbGYuZ2V0X3Byb3h5X2Rpc3BsYXlfbmFtZSgpfSIKICAgIAogICAgZGVmIGVuc3VyZV9wcm94eV9pZl9uZWVkZWQoc2VsZiwgcmVhc29uOiBzdHIgPSAiQ+G6p24gcHJveHkgY2hvIGhv4bqhdCDEkeG7mW5nIikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28gY8OzIHByb3h5IG7hur91IGPhuqduIHRoaeG6v3QKICAgICAgICBU4buxIMSR4buZbmcga2nhu4NtIHRyYSB1c2VfcHJveHkgY29uZmlnIHbDoCDEkcSDbmcga8O9IHByb3h5IG7hur91IGNoxrBhIGPDswogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHJlYXNvbjogTMO9IGRvIGPhuqduIHByb3h5ICjEkeG7gyBsb2cpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHByb3h5IGhv4bq3YyBraMO0bmcgY+G6p24gcHJveHksIEZhbHNlIG7hur91IGPhuqduIHByb3h5IG5oxrBuZyBraMO0bmcgxJHEg25nIGvDvSDEkcaw4bujYwogICAgICAgICIiIgogICAgICAgIHVzZV9wcm94eSA9IHNlbGYuZGIuZ2V0KCJ1c2VfcHJveHkiLCBGYWxzZSkKICAgICAgICAKICAgICAgICAjIE7hur91IGtow7RuZyBz4butIGThu6VuZyBwcm94eSwgbHXDtG4gdHLhuqMgduG7gSBUcnVlCiAgICAgICAgaWYgbm90IHVzZV9wcm94eToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJLaMO0bmcgY+G6p24gcHJveHkgdGhlbyBjb25maWciKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAjIE7hur91IMSRw6MgY8OzIHByb3h5IGFjdGl2ZSwgdHLhuqMgduG7gSBUcnVlCiAgICAgICAgaWYgc2VsZi5pc19wcm94eV9hY3RpdmUoKToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJQcm94eSDEkcOjIHPhurVuIHPDoG5nIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgIyBD4bqnbiBwcm94eSBuaMawbmcgY2jGsGEgY8OzLCB0aOG7rSDEkcSDbmcga8O9CiAgICAgICAgbG9nZ2VyLmluZm8oZiJ7cmVhc29ufSwgxJHEg25nIGvDvSBwcm94eS4uLiIpCiAgICAgICAgcmV0dXJuIHNlbGYucmVnaXN0ZXJfcHJveHlfd2l0aF9yZXRyeSgpCiAgICAKICAgIGRlZiByZWdpc3Rlcl9wcm94eV93aXRoX3JldHJ5KHNlbGYsIG1heF9yZXRyaWVzOiBpbnQgPSA5OTksIHJldHJ5X2ludGVydmFsOiBpbnQgPSAxMCkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkMSDbmcga8O9IHByb3h5IHbhu5tpIHJldHJ5IHbDoCBj4bqtcCBuaOG6rXQgZGV2aWNlIG1lc3NhZ2Uga2hpIGNo4budIHF1ZXVlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbWF4X3JldHJpZXM6IFPhu5EgbOG6p24gdGjhu60gdOG7kWkgxJFhCiAgICAgICAgICAgIHJldHJ5X2ludGVydmFsOiBUaOG7nWkgZ2lhbiBjaOG7nSBnaeG7r2EgY8OhYyBs4bqnbiB0aOG7rSAoZ2nDonkpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJHEg25nIGvDvSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKG1heF9yZXRyaWVzKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSBsb2NhbCBJUCB04burIGhlbHBlciBzZXJ2aWNlCiAgICAgICAgICAgICAgICBsb2NhbF9pcCA9IHNlbGYuaGVscGVyLmdldF9sb2NhbF9pcCgpCiAgICAgICAgICAgICAgICBpZiBub3QgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgbOG6pXkgbG9jYWwgSVAsIGLhu48gcXVhIMSRxINuZyBrw70gcHJveHkiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkYXRhID0geyJsb2NhbF9pcCI6IGxvY2FsX2lwfQogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9wcm94eV9hcGlfY2FsbCgicmVnaXN0ZXIiLCBkYXRhKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgcmVzcG9uc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9yZXRyaWVzIC0gMToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJQcm94eSBBUEkgbOG7l2ksIHRo4butIGzhuqFpIHNhdSB7cmV0cnlfaW50ZXJ2YWx9cyAobOG6p24ge2F0dGVtcHQgKyAxfS97bWF4X3JldHJpZXN9KSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsIGYixJBhbmcgY2jhu50gcHJveHkgLSBM4buXaSBBUEkgKHRo4butIGzhuqFpIHthdHRlbXB0ICsgMX0ve21heF9yZXRyaWVzfSkiKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHJldHJ5X2ludGVydmFsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc3RhdHVzID0gcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBzdGF0dXMgPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgICAgICMgxJDGsOG7o2MgY+G6pXAgdGFibGUgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgdGFibGVfbmFtZSA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoInRhYmxlX25hbWUiKQogICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoImFjdGlvbiIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlID0gdGFibGVfbmFtZQogICAgICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm94eV9uYW1lID0gZiJ7dGFibGVfbmFtZX0iCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBMxrB1IHByb3h5IHRhYmxlIG5hbWUgdsOgbyBkZXZpY2UgY29uZmlnIMSR4buDIGfhu61pIGzDqm4gc2VydmVyCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXRfZGV2aWNlX2NvbmZpZygicHJveHlfdGFibGVfbmFtZSIsIHRhYmxlX25hbWUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQcm94eSDEkcOjIMSRxrDhu6NjIGPhuqVwIHRhYmxlOiB7dGFibGVfbmFtZX0gKGFjdGlvbjoge2FjdGlvbn0pIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIELhuq90IMSR4bqndSB0aHJlYWQgdXBkYXRlIMSR4buLbmgga+G7swogICAgICAgICAgICAgICAgICAgIHNlbGYuX3N0YXJ0X3VwZGF0ZV90aHJlYWQoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIHN0YXR1cyA9PSAicXVldWVkIjoKICAgICAgICAgICAgICAgICAgICAjIFbDoG8gcXVldWUgY2jhu50KICAgICAgICAgICAgICAgICAgICBxdWV1ZV9wb3NpdGlvbiA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoInF1ZXVlX3Bvc2l0aW9uIiwgMCkKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlByb3h5IHNlcnZlciBmdWxsLCB2w6BvIGjDoG5nIMSR4bujaSB24buLIHRyw60ge3F1ZXVlX3Bvc2l0aW9ufSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgZGV2aWNlIG1lc3NhZ2UgduG7m2kgdGjDtG5nIHRpbiBxdWV1ZQogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsIGYixJBhbmcgY2jhu50gcHJveHkgLSBIw6BuZyDEkeG7o2k6IHtxdWV1ZV9wb3NpdGlvbn0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCBtYXhfcmV0cmllcyAtIDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAocmV0cnlfaW50ZXJ2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiLEkMOjIHRo4butIHttYXhfcmV0cmllc30gbOG6p24gbmjGsG5nIHbhuqtuIHRyb25nIHF1ZXVlLCBk4burbmcgdGjhu60iKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIlByb3h5IHJlZ2lzdGVyIHRo4bqldCBi4bqhaToge3Jlc3BvbnNlLmdldCgnbWVzc2FnZScsICdVbmtub3duIGVycm9yJyl9IikKICAgICAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X3JldHJpZXMgLSAxOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCBmIsSQYW5nIGNo4budIHByb3h5IC0gTOG7l2kgxJHEg25nIGvDvSAodGjhu60gbOG6oWkge2F0dGVtcHQgKyAxfS97bWF4X3JldHJpZXN9KSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAocmV0cnlfaW50ZXJ2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgxJHEg25nIGvDvSBwcm94eSBs4bqnbiB7YXR0ZW1wdCArIDF9IikKICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCBtYXhfcmV0cmllcyAtIDE6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9tZXNzYWdlIiwgZiLEkGFuZyBjaOG7nSBwcm94eSAtIEzhu5dpIGvhur90IG7hu5FpICh0aOG7rSBs4bqhaSB7YXR0ZW1wdCArIDF9L3ttYXhfcmV0cmllc30pIikKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHJldHJ5X2ludGVydmFsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHNodXRkb3duKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIENsZWFudXAga2hpIHThuq90IHNlcnZpY2UgLSBk4burbmcgdGhyZWFkIHVwZGF0ZSB2w6AgdW5yZWdpc3RlciBwcm94eQogICAgICAgICIiIgogICAgICAgIGxvZ2dlci5pbmZvKCJTaHV0dGluZyBkb3duIFByb3h5U2VydmljZS4uLiIpCiAgICAgICAgCiAgICAgICAgIyBE4burbmcgdGhyZWFkIHVwZGF0ZSB0csaw4bubYwogICAgICAgIHNlbGYuX3N0b3BfdXBkYXRlX3RocmVhZCgpCiAgICAgICAgCiAgICAgICAgIyBVbnJlZ2lzdGVyIHByb3h5IG7hur91IMSRYW5nIGFjdGl2ZQogICAgICAgIGlmIHNlbGYuaXNfcHJveHlfYWN0aXZlKCk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJVbnJlZ2lzdGVyIHByb3h5IHRyb25nIHF1w6EgdHLDrG5oIHNodXRkb3duIikKICAgICAgICAgICAgc2VsZi51bnJlZ2lzdGVyX3Byb3h5KCkKICAgICAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIlByb3h5U2VydmljZSDEkcOjIHNodXRkb3duIGhvw6BuIHThuqV0IikK').decode('utf-8'))
