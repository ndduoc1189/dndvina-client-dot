import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHJlCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBvcwppbXBvcnQgY29uZmlnCmltcG9ydCB1dGlscwpmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgcXVvdGUsIHVucXVvdGUKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgT3B0aW9uYWwsIFR1cGxlLCBMaXN0LCBVbmlvbgp0cnk6CiAgICBmcm9tIGx4bWwgaW1wb3J0IGV0cmVlCiAgICBMWE1MX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgTFhNTF9BVkFJTEFCTEUgPSBGYWxzZQoKIyBU4bqhbyBsb2dnZXIgY2hvIEhlbHBlclNlcnZpY2UKbG9nZ2VyID0gdXRpbHMuZ2V0X2xvZ2dlcigiSGVscGVyU2VydmljZSIpCgpjbGFzcyBIZWxwZXJTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGJhc2VfdXJsOiBzdHIgPSBOb25lLCBkYl9zZXJ2aWNlPU5vbmUpOgogICAgICAgICMgU+G7rSBk4bulbmcgY29uZmlnIG7hur91IGJhc2VfdXJsIGtow7RuZyDEkcaw4bujYyBjdW5nIGPhuqVwCiAgICAgICAgaWYgYmFzZV91cmwgaXMgTm9uZToKICAgICAgICAgICAgYmFzZV91cmwgPSBjb25maWcuSEVMUEVSX1NFUlZJQ0VfVVJMCiAgICAgICAgCiAgICAgICAgc2VsZi5iYXNlX3VybCA9IGJhc2VfdXJsCiAgICAgICAgc2VsZi5pc19hZGJfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICBzZWxmLmRldmljZV9pcCA9IGNvbmZpZy5ERVZJQ0VfSVAgICMgU+G7rSBk4bulbmcgREVWSUNFX0lQIHThu6sgY29uZmlnCiAgICAgICAgc2VsZi5kYl9zZXJ2aWNlID0gZGJfc2VydmljZQogICAgICAgIAogICAgICAgICMgTHXDtG4gdGjhu60ga+G6v3QgbuG7kWkgQURCIHbhu5tpIElQIHThu6sgY29uZmlnCiAgICAgICAgc2VsZi5jaGVja19hbmRfY29ubmVjdF9hZGIoKQoKICAgIGRlZiBjaGVja19hbmRfY29ubmVjdF9hZGIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHbDoCBr4bq/dCBu4buRaSBBREIgdOG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgQURCIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBraMO0bmcKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJhZGIiLCAiLS12ZXJzaW9uIl0sIGNoZWNrPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEvhur90IG7hu5FpIEFEQiDEkeG6v24gdGhp4bq/dCBi4buLIHPhu60gZOG7pW5nIMSR4buLYSBjaOG7iSB04burIGNvbmZpZwogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIMSR4bq/biB0aGnhur90IGLhu4sKICAgICAgICAgICAgY29ubmVjdF9wcm9jZXNzID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbImFkYiIsICJjb25uZWN0IiwgYWRiX2FkZHJlc3NdLAogICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyBr4bq/dCBu4buRaQogICAgICAgICAgICBpZiAiY29ubmVjdGVkIiBpbiBjb25uZWN0X3Byb2Nlc3Muc3Rkb3V0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBUcnVlCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6Mga+G6v3QgbuG7kWkgQURCIHRow6BuaCBjw7RuZyDEkeG6v24ge2FkYl9hZGRyZXNzfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IChzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciwgRmlsZU5vdEZvdW5kRXJyb3IpIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBr4bq/dCBu4buRaSBBREI6IHtlfSIpCiAgICAgICAgCiAgICAgICAgc2VsZi5pc19hZGJfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2dldF9hZGJfZGV2aWNlX3BhcmFtKHNlbGYpIC0+IExpc3Rbc3RyXToKICAgICAgICAiIiIKICAgICAgICBUcuG6oyB24buBIHRoYW0gc+G7kSB0aGnhur90IGLhu4sgY2hvIGzhu4duaCBBREIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W3N0cl06IERhbmggc8OhY2ggWy1zLCBkZXZpY2VfaWRdIGhv4bq3YyBsaXN0IHLhu5duZyBu4bq/dSBraMO0bmcgY8OzIHRoaeG6v3QgYuG7iwogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgYWRiX2FkZHJlc3MgPSBmIntjb25maWcuQURCX0hPU1R9Ontjb25maWcuQURCX1BPUlR9IgogICAgICAgICAgICByZXR1cm4gWyItcyIsIGFkYl9hZGRyZXNzXQogICAgICAgIHJldHVybiBbXQoKICAgIGRlZiBfbWFrZV9yZXF1ZXN0KHNlbGYsIGVuZHBvaW50OiBzdHIsIHBhcmFtczogRGljdFtzdHIsIEFueV0gPSBOb25lLCB0aW1lb3V0OiBpbnQgPSAxMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiByZXF1ZXN0IEFQSSB2w6AgdHLhuqMgduG7gSBr4bq/dCBxdeG6oyBk4bqhbmcgSlNPTiBob+G6t2MgWE1MCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZW5kcG9pbnQ6IEFQSSBlbmRwb2ludAogICAgICAgICAgICBwYXJhbXM6IFF1ZXJ5IHBhcmFtZXRlcnMKICAgICAgICAgICAgdGltZW91dDogUmVxdWVzdCB0aW1lb3V0IGluIHNlY29uZHMgKGRlZmF1bHQ6IDEwKQogICAgICAgICIiIgogICAgICAgIHVybCA9IGYie3NlbGYuYmFzZV91cmx9L3tlbmRwb2ludH0iCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRoaeG6v3QgbOG6rXAgdGltZW91dCBjaG8gcmVxdWVzdAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9dGltZW91dCkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgQ29udGVudC1UeXBlCiAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgaWYgJ2FwcGxpY2F0aW9uL3htbCcgaW4gY29udGVudF90eXBlIG9yIGVuZHBvaW50ID09ICdkdW1wLXNjcmVlbi14bWwnOgogICAgICAgICAgICAgICAgIyBUcuG6oyB24buBIFhNTCBkxrDhu5tpIGThuqFuZyB0ZXh0CiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJkYXRhIjogcmVzcG9uc2UudGV4dH0KICAgICAgICAgICAgZWxpZiAnaW1hZ2UvJyBpbiBjb250ZW50X3R5cGU6CiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgYmluYXJ5IGRhdGEgY2hvIOG6o25oIChzY3JlZW5zaG90KQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLmNvbnRlbnQsICJjb250ZW50X3R5cGUiOiBjb250ZW50X3R5cGV9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgSlNPTgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlRpbWVvdXQ6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiUmVxdWVzdCB0aW1lb3V0IGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCIpCiAgICAgICAgICAgIHNlbGYuX3Jlc3RhcnRfaGVscGVyX2FwcCgpCiAgICAgICAgICAgICMgVGjhu60gbOG6oWkgcmVxdWVzdCBzYXUga2hpIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKSAgIyBDaOG7nSAxIGdpw6J5IMSR4buDIOG7qW5nIGThu6VuZyBraOG7n2kgxJHhu5luZwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PXRpbWVvdXQpCiAgICAgICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29udGVudF90eXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICAgICAgaWYgJ2FwcGxpY2F0aW9uL3htbCcgaW4gY29udGVudF90eXBlIG9yIGVuZHBvaW50ID09ICdkdW1wLXNjcmVlbi14bWwnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgImRhdGEiOiByZXNwb25zZS50ZXh0fQogICAgICAgICAgICAgICAgZWxpZiAnaW1hZ2UvJyBpbiBjb250ZW50X3R5cGU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLmNvbnRlbnQsICJjb250ZW50X3R5cGUiOiBjb250ZW50X3R5cGV9CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yIGFzIGU6CiAgICAgICAgICAgICMgQuG6r3QgbOG7l2kga+G6v3QgbuG7kWkgYuG7iyB04burIGNo4buRaSBob+G6t2Mga2jDtG5nIHRo4buDIGvhur90IG7hu5FpCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga+G6v3QgbuG7kWkga2hpIGfhu41pIHt1cmx9LCB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICBzZWxmLl9yZXN0YXJ0X2hlbHBlcl9hcHAoKQogICAgICAgICAgICAjIFRo4butIGzhuqFpIHJlcXVlc3Qgc2F1IGtoaSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikgICMgQ2jhu50gMiBnacOieSDEkeG7gyDhu6luZyBk4bulbmcga2jhu59pIMSR4buZbmcKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgcGFyYW1zPXBhcmFtcywgdGltZW91dD10aW1lb3V0KQogICAgICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJkYXRhIjogcmVzcG9uc2UudGV4dH0KICAgICAgICAgICAgICAgIGVsaWYgJ2ltYWdlLycgaW4gY29udGVudF90eXBlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgImRhdGEiOiByZXNwb25zZS5jb250ZW50LCAiY29udGVudF90eXBlIjogY29udGVudF90eXBlfQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIlbhuqtuIGzhu5dpIHNhdSBraGkgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gcmVxdWVzdDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CgogICAgZGVmIF9yZXN0YXJ0X2hlbHBlcl9hcHAoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHPhu60gZOG7pW5nIEFEQgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBpZiBzZWxmLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaOG7n2kgxJHhu5luZyBoZWxwZXIgYXBwIGLhurFuZyBBREIKICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJzaGVsbCIsICJhbSIsICJzdGFydCIsICItbiIsICJjb20uZG5kdmluYS5oZWxwZXIvLk1haW5BY3Rpdml0eSJdCiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHF1YSBBREIiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHbDrCBBREIgY2jGsGEgxJHGsOG7o2Mga+G6v3QgbuG7kWkiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgdGFwKHNlbGYsIHg6IGludCwgeTogaW50KSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaOG6oW0gdsOgbyB24buLIHRyw60geCx5IHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJ0YXAiLCBwYXJhbXM9eyJ4IjogeCwgInkiOiB5fSkKCiAgICBkZWYgdGFwX2VsZW1lbnQoc2VsZiwgYm91bmRzOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIG3hu5l0IHBo4bqnbiB04butIGThu7FhIHRyw6puIGJvdW5kcyBj4bunYSBuw7MKICAgICAgICBGb3JtYXQgYm91bmRzOiAiW3gxLHkxXVt4Mix5Ml0iIGhv4bq3YyBlbGVtZW50IGRpY3QKICAgICAgICAiIiIKICAgICAgICAjIE7hur91IGJvdW5kcyBsw6AgbeG7mXQgZGljdCAoZWxlbWVudCksIGzhuqV5IGJvdW5kcyBzdHJpbmcgdOG7qyDEkcOzCiAgICAgICAgaWYgaXNpbnN0YW5jZShib3VuZHMsIGRpY3QpOgogICAgICAgICAgICBib3VuZHMgPSBib3VuZHMuZ2V0KCJib3VuZHMiLCAiWzAsMF1bMCwwXSIpCiAgICAgICAgICAgIAogICAgICAgICMgVGjhu60gY8OhYyBwYXR0ZXJuIGtow6FjIG5oYXUgxJHhu4MgcGFyc2UgYm91bmRzLCBjaG8gcGjDqXAgc+G7kSDDom0KICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgciJcWygtP1xkKyksKC0/XGQrKVxdXFsoLT9cZCspLCgtP1xkKylcXSIsICAjIFt4MSx5MV1beDIseTJdIHbhu5tpIHPhu5Egw6JtCiAgICAgICAgICAgIHIiKC0/XGQrKSwoLT9cZCspLCgtP1xkKyksKC0/XGQrKSIsICAgICAgICAgIyB4MSx5MSx4Mix5MgogICAgICAgICAgICByIlxbKC0/XGQrKTsoLT9cZCspXF1cWygtP1xkKyk7KC0/XGQrKVxdIiAgICMgW3gxO3kxXVt4Mjt5Ml0KICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUubWF0Y2gocGF0dGVybiwgYm91bmRzKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIHgxLCB5MSwgeDIsIHkyID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgcHJpbnQoZiJPcmlnaW5hbCBib3VuZHM6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpICAjIELhu48gbG9nIG7DoHkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBT4butYSBjaOG7r2EgYm91bmRzIGtow7RuZyBo4bujcCBs4buHCiAgICAgICAgICAgICAgICBpZiB5MSA8IDAgb3IgeTIgPCAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiRml4aW5nIG5lZ2F0aXZlIFkgY29vcmRpbmF0ZXMuLi4iKQogICAgICAgICAgICAgICAgICAgIGlmIHkyIDwgMDoKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gYWJzKHkyIC0geTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gbWF4KDAsIHkxKQogICAgICAgICAgICAgICAgICAgICAgICB5MiA9IHkxICsgaGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiQWRqdXN0ZWQgWTogeTE9e3kxfSwgeTI9e3kyfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHgxIDwgMCBvciB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJGaXhpbmcgbmVnYXRpdmUgWCBjb29yZGluYXRlcy4uLiIpCiAgICAgICAgICAgICAgICAgICAgaWYgeDIgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGFicyh4MiAtIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MSA9IG1heCgwLCB4MSkKICAgICAgICAgICAgICAgICAgICAgICAgeDIgPSB4MSArIHdpZHRoCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiQWRqdXN0ZWQgWDogeDE9e3gxfSwgeDI9e3gyfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBib3VuZHMgaOG7o3AgbOG7hyBzYXUga2hpIMSRaeG7gXUgY2jhu4luaAogICAgICAgICAgICAgICAgaWYgeDEgPj0geDIgb3IgeTEgPj0geTI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJJbnZhbGlkIGJvdW5kcyBhZnRlciBhZGp1c3RtZW50OiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIENo4buNbiBt4buZdCDEkWnhu4NtIHRyb25nIGJvdW5kcyB24bubaSBtYXJnaW4gYW4gdG/DoG4KICAgICAgICAgICAgICAgIG1hcmdpbiA9IG1pbigzLCAoeDIgLSB4MSkgLy8gNCwgKHkyIC0geTEpIC8vIDQpICAjIER5bmFtaWMgbWFyZ2luCiAgICAgICAgICAgICAgICBtYXJnaW4gPSBtYXgoMSwgbWFyZ2luKSAgIyDDjXQgbmjhuqV0IDFweCBtYXJnaW4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgeCA9IHJhbmRvbS5yYW5kaW50KHgxICsgbWFyZ2luLCBtYXgoeDEgKyBtYXJnaW4gKyAxLCB4MiAtIG1hcmdpbikpCiAgICAgICAgICAgICAgICB5ID0gcmFuZG9tLnJhbmRpbnQoeTEgKyBtYXJnaW4sIG1heCh5MSArIG1hcmdpbiArIDEsIHkyIC0gbWFyZ2luKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBwcmludChmIkZpbmFsIHRhcCBjb29yZGluYXRlczogKHt4fSwge3l9KSB3aXRoIG1hcmdpbiB7bWFyZ2lufSIpICAjIELhu48gbG9nIG7DoHkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudGFwKHgsIHkpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBmIsSQ4buLbmggZOG6oW5nIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hzoge2JvdW5kc30ifQoKICAgIGRlZiBzd2lwZShzZWxmLCBzdGFydFg6IGludCwgc3RhcnRZOiBpbnQsIGVuZFg6IGludCwgZW5kWTogaW50LCBkdXJhdGlvbjogaW50ID0gODAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIHRoYW8gdMOhYyB2deG7kXQgdMO5eSBjaOG7iW5oIHbhu5tpIGPDoWMgdGhhbSBz4buRIGPhu6UgdGjhu4MKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBzdGFydFg6IFThu41hIMSR4buZIFggxJFp4buDbSBi4bqvdCDEkeG6p3UKICAgICAgICAgICAgc3RhcnRZOiBU4buNYSDEkeG7mSBZIMSRaeG7g20gYuG6r3QgxJHhuqd1ICAKICAgICAgICAgICAgZW5kWDogVOG7jWEgxJHhu5kgWCDEkWnhu4NtIGvhur90IHRow7pjCiAgICAgICAgICAgIGVuZFk6IFThu41hIMSR4buZIFkgxJFp4buDbSBr4bq/dCB0aMO6YwogICAgICAgICAgICBkdXJhdGlvbjogVGjhu51pIGdpYW4gdGjhu7FjIGhp4buHbiB0aGFvIHTDoWMgdnXhu5F0IChtaWxsaXNlY29uZHMpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIHRoYW8gdMOhYwogICAgICAgICAgICAKICAgICAgICBFeGFtcGxlOgogICAgICAgICAgICAjIFZ14buRdCB04burIHRyw6puIHh14buRbmcgZMaw4bubaQogICAgICAgICAgICBoZWxwZXIuc3dpcGUoMTAwLCAyMDAsIDEwMCwgNjAwLCAxMDAwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBWdeG7kXQgdOG7qyB0csOhaSBxdWEgcGjhuqNpCiAgICAgICAgICAgIGhlbHBlci5zd2lwZSg1MCwgNDAwLCAzNTAsIDQwMCwgNTAwKQogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgInN0YXJ0WCI6IHN0YXJ0WCwKICAgICAgICAgICAgInN0YXJ0WSI6IHN0YXJ0WSwgCiAgICAgICAgICAgICJlbmRYIjogZW5kWCwKICAgICAgICAgICAgImVuZFkiOiBlbmRZLAogICAgICAgICAgICAiZHVyYXRpb24iOiBkdXJhdGlvbgogICAgICAgIH0KICAgICAgICAKICAgICAgICBsb2dnZXIuZGVidWcoZiJTd2lwZTogKHtzdGFydFh9LHtzdGFydFl9KSDihpIgKHtlbmRYfSx7ZW5kWX0pIHRyb25nIHtkdXJhdGlvbn1tcyIpCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGUiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBzd2lwZV91cChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgbMOqbiB04burIHbhu4sgdHLDrSBuZ+G6q3Ugbmhpw6puIHBow7kgaOG7o3AKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV91cCIpCgogICAgZGVmIHN3aXBlX2Rvd24oc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHh14buRbmcgdOG7qyB24buLIHRyw60gbmfhuqt1IG5oacOqbiBwaMO5IGjhu6NwCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGVfZG93biIpCgogICAgZGVmIGlucHV0X3RleHQoc2VsZiwgdGV4dDogc3RyLCBzcGVlZDogZmxvYXQgPSAxLjAsIAogICAgICAgICAgICAgICAgICBkaXJlY3RfbW9kZTogYm9vbCA9IEZhbHNlLCBwZXJmZWN0X21vZGU6IGJvb2wgPSBUcnVlKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBNw7QgcGjhu49uZyBnw7UgcGjDrW0gduG7m2kgdOG7kWMgxJHhu5kgbmfhuqt1IG5oacOqbiBnaeG7kW5nIG5nxrDhu51pIHRo4bqtdCBi4bqxbmcgQURCCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgICAgICBpZiBzZWxmLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICAjIEVzY2FwZSB0ZXh0IMSR4buDIHRyw6FuaCBs4buXaSB24bubaSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QKICAgICAgICAgICAgICAgIGVzY2FwZWRfdGV4dCA9IHRleHQucmVwbGFjZSgnICcsICdcXCAnKS5yZXBsYWNlKCcmJywgJ1xcJicpLnJlcGxhY2UoJygnLCAnXFwoJykucmVwbGFjZSgnKScsICdcXCknKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu7FjIHRoaSBBREIgaW5wdXQgdGV4dAogICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbInNoZWxsIiwgImlucHV0IiwgInRleHQiLCBmIid7ZXNjYXBlZF90ZXh0fSciXQogICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTE1CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgIm1lc3NhZ2UiOiBmIsSQw6Mgbmjhuq1wIHRleHQgJ3t0ZXh0fScgYuG6sW5nIEFEQiJ9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIHbhu4EgQVBJIG7hur91IGtow7RuZyBjw7MgQURCCiAgICAgICAgICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICAgICAgICAgInRleHQiOiB0ZXh0LAogICAgICAgICAgICAgICAgICAgICJzcGVlZCI6IHNwZWVkLAogICAgICAgICAgICAgICAgICAgICJkaXJlY3RfbW9kZSI6IHN0cihkaXJlY3RfbW9kZSkubG93ZXIoKSwKICAgICAgICAgICAgICAgICAgICAicGVyZmVjdF9tb2RlIjogc3RyKHBlcmZlY3RfbW9kZSkubG93ZXIoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgiaW5wdXRfdGV4dCIsIHBhcmFtcz1wYXJhbXMpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5UaW1lb3V0RXhwaXJlZDoKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJUaW1lb3V0IGtoaSBn4butaSBBREIgaW5wdXQgdGV4dDoge3RleHR9IikKICAgICAgICAgICAgIyBGYWxsYmFjayB24buBIEFQSQogICAgICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICAgICAidGV4dCI6IHRleHQsCiAgICAgICAgICAgICAgICAic3BlZWQiOiBzcGVlZCwKICAgICAgICAgICAgICAgICJkaXJlY3RfbW9kZSI6IHN0cihkaXJlY3RfbW9kZSkubG93ZXIoKSwKICAgICAgICAgICAgICAgICJwZXJmZWN0X21vZGUiOiBzdHIocGVyZmVjdF9tb2RlKS5sb3dlcigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgiaW5wdXRfdGV4dCIsIHBhcmFtcz1wYXJhbXMpCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIEFEQiBpbnB1dCB0ZXh0ICd7dGV4dH0nOiB7ZX0iKQogICAgICAgICAgICAjIEZhbGxiYWNrIHbhu4EgQVBJCiAgICAgICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICJ0ZXh0IjogdGV4dCwKICAgICAgICAgICAgICAgICJzcGVlZCI6IHNwZWVkLAogICAgICAgICAgICAgICAgImRpcmVjdF9tb2RlIjogc3RyKGRpcmVjdF9tb2RlKS5sb3dlcigpLAogICAgICAgICAgICAgICAgInBlcmZlY3RfbW9kZSI6IHN0cihwZXJmZWN0X21vZGUpLmxvd2VyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpbnB1dF90ZXh0IiwgcGFyYW1zPXBhcmFtcykKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtow7RuZyB4w6FjIMSR4buLbmgga2hpIGfhu61pIEFEQiBpbnB1dCB0ZXh0ICd7dGV4dH0nOiB7ZX0iKQogICAgICAgICAgICAjIEZhbGxiYWNrIHbhu4EgQVBJCiAgICAgICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICJ0ZXh0IjogdGV4dCwKICAgICAgICAgICAgICAgICJzcGVlZCI6IHNwZWVkLAogICAgICAgICAgICAgICAgImRpcmVjdF9tb2RlIjogc3RyKGRpcmVjdF9tb2RlKS5sb3dlcigpLAogICAgICAgICAgICAgICAgInBlcmZlY3RfbW9kZSI6IHN0cihwZXJmZWN0X21vZGUpLmxvd2VyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpbnB1dF90ZXh0IiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgc2hvd190b2FzdChzZWxmLCBtZXNzYWdlOiBzdHIsIHR5cGVfOiBzdHIgPSAiaW5mbyIsIAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogc3RyID0gImJvdHRvbSIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEhp4buDbiB0aOG7iyB0aMO0bmcgYsOhbyB0b2FzdAogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgIm1lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAidHlwZSI6IHR5cGVfLAogICAgICAgICAgICAicG9zaXRpb24iOiBwb3NpdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJ0b2FzdC1tZXNzYWdlIiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgZ2V0X2RldmljZV9pbmZvKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRow7RuZyB0aW4gY2hpIHRp4bq/dCB24buBIHRoaeG6v3QgYuG7iwogICAgICAgICIiIgogICAgICAgIHJlc3VsdCA9IHNlbGYuX21ha2VfcmVxdWVzdCgiZGV2aWNlLWluZm8iKQogICAgICAgIAogICAgICAgICMgTuG6v3Uga+G6v3QgcXXhuqMgdGjDoG5oIGPDtG5nLCB0aMOqbSB0aMO0bmcgdGluIGludGVybmV0IElQIHbDoCB1c2VyX2lkCiAgICAgICAgaWYgcmVzdWx0LmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gcmVzdWx0OgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IGludGVybmV0IElQIGLhurFuZyByZXF1ZXN0cwogICAgICAgICAgICAgICAgaW50ZXJuZXRfaXAgPSBzZWxmLl9nZXRfaW50ZXJuZXRfaXAoKQogICAgICAgICAgICAgICAgaWYgaW50ZXJuZXRfaXA6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bImludGVybmV0X2lwIl0gPSBpbnRlcm5ldF9pcAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXN1bHRbImRhdGEiXVsiaW50ZXJuZXRfaXAiXSA9ICJ1bmtub3duIgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBs4bqleSBpbnRlcm5ldCBJUDoge2V9IikKICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJpbnRlcm5ldF9pcCJdID0gImVycm9yIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSB1c2VyX2lkIHThu6sgZGF0YWJhc2UgY29uZmlnICjEkcOjIMSRxrDhu6NjIMSR4buNYyAxIGzhuqduIGtoaSBraOG7n2kgxJHhu5luZykKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBDaOG7iSBs4bqleSB1c2VyX2lkIHThu6sgZGF0YWJhc2UsIGtow7RuZyDEkeG7jWMgZmlsZSBu4buvYQogICAgICAgICAgICAgICAgdXNlcl9pZCA9IHNlbGYuZGJfc2VydmljZS5nZXQoInVzZXJfaWQiKSBpZiBoYXNhdHRyKHNlbGYsICdkYl9zZXJ2aWNlJykgYW5kIHNlbGYuZGJfc2VydmljZSBlbHNlIE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaMOqbSB1c2VyX2lkIHbDoG8gcmVzdWx0CiAgICAgICAgICAgICAgICBpZiB1c2VyX2lkOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJ1c2VyX2lkIl0gPSB1c2VyX2lkCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJ1c2VyX2lkIl0gPSAidW5rbm93biIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgdXNlcl9pZDoge2V9IikKICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJ1c2VyX2lkIl0gPSAiZXJyb3IiCiAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgCiAgICBkZWYgX2dldF9pbnRlcm5ldF9pcChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgxJHhu4thIGNo4buJIElQIGPDtG5nIGPhu5luZyBi4bqxbmcgcmVxdWVzdHMKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IMSQ4buLYSBjaOG7iSBJUCBjw7RuZyBj4buZbmcgaG/hurdjIGNodeG7l2kgcuG7l25nIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmlwaWZ5Lm9yZyIsIHRpbWVvdXQ9MykKICAgICAgICAgICAgaXAgPSByZXNwb25zZS50ZXh0LnN0cmlwKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSDEkeG7i25oIGThuqFuZyBJUCDEkcahbiBnaeG6o24KICAgICAgICAgICAgaWYgcmUubWF0Y2gocideXGR7MSwzfVwuXGR7MSwzfVwuXGR7MSwzfVwuXGR7MSwzfSQnLCBpcCk6CiAgICAgICAgICAgICAgICByZXR1cm4gaXAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiS+G6v3QgcXXhuqMga2jDtG5nIHBo4bqjaSBsw6AgSVAgaOG7o3AgbOG7hzoge2lwfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlRpbWVvdXQ6CiAgICAgICAgICAgIHByaW50KCJUaW1lb3V0IGtoaSBs4bqleSBpbnRlcm5ldCBJUCAoMyBnacOieSkiKQogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGzhuqV5IGludGVybmV0IElQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2jDtG5nIHjDoWMgxJHhu4tuaCBraGkgbOG6pXkgaW50ZXJuZXQgSVA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBjaGVja19pbnRlcm5ldChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEga+G6v3QgbuG7kWkgaW50ZXJuZXQKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGPDsyBr4bq/dCBu4buRaSBpbnRlcm5ldCwgRmFsc2UgbuG6v3Uga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIMSR4bq/biBHb29nbGUgRE5TIHbhu5tpIHRpbWVvdXQgbmfhuq9uCiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovLzguOC44LjgiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBUaOG7rSB24bubaSBt4buZdCBkb21haW4ga2jDoWMKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL3d3dy5nb29nbGUuY29tIiwgdGltZW91dD01KQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBnZXRfbG9jYWxfaXAoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IMSR4buLYSBjaOG7iSBJUCBsb2NhbCBj4bunYSB0aGnhur90IGLhu4sgdOG7qyBkZXZpY2UgaW5mbwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogxJDhu4thIGNo4buJIElQIGxvY2FsIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgICAgICBpZiBkZXZpY2VfaW5mby5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgcmV0dXJuIGRldmljZV9pbmZvWyJkYXRhIl0uZ2V0KCJsb2NhbF9pcCIsICIiKQogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGzhuqV5IGxvY2FsIElQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgZHVtcF9zY3JlZW5feG1sKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBEdW1wIHRvw6BuIGLhu5kgY+G6pXUgdHLDumMgWE1MIGPhu6dhIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgCiAgICAgICAgVHLhuqMgduG7gSBu4buZaSBkdW5nIFhNTCBkxrDhu5tpIGThuqFuZyBjaHXhu5dpCiAgICAgICAgIiIiCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImR1bXAtc2NyZWVuLXhtbCIpCiAgICAgICAgaWYgcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJkYXRhIl0KICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgb3Blbl9hcHAoc2VsZiwgcGFja2FnZTogc3RyLCBhY3Rpdml0eTogc3RyID0gTm9uZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTeG7nyBt4buZdCDhu6luZyBk4bulbmcgduG7m2kgcGFja2FnZSBuYW1lIHbDoCBhY3Rpdml0eSBj4bulIHRo4buDCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0geyJwYWNrYWdlIjogcGFja2FnZX0KICAgICAgICBpZiBhY3Rpdml0eToKICAgICAgICAgICAgcGFyYW1zWyJhY3Rpdml0eSJdID0gYWN0aXZpdHkKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJvcGVuX2FwcCIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIGNsb3NlX2FwcChzZWxmLCBwYWNrYWdlOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIMSQw7NuZyBt4buZdCDhu6luZyBk4bulbmcgxJFhbmcgY2jhuqF5CiAgICAgICAgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgxJDDs25nIOG7qW5nIGThu6VuZyBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCBmImFtIGZvcmNlLXN0b3Age3BhY2thZ2V9Il0KICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAibWVzc2FnZSI6IGYixJDDoyDEkcOzbmcge3BhY2thZ2V9IGLhurFuZyBBREIifQogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIMSRw7NuZyDhu6luZyBk4bulbmcgYuG6sW5nIEFEQjoge2V9IikKICAgICAgICAgICAgICAgICMgTuG6v3UgbOG7l2ksIHRo4butIHBoxrDGoW5nIHRo4bupYyBIVFRQCiAgICAgICAgCiAgICAgICAgIyBT4butIGThu6VuZyBIVFRQIEFQSSBu4bq/dSBraMO0bmcgY8OzIEFEQiBob+G6t2MgQURCIGLhu4sgbOG7l2kKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19ob21lIikKCiAgICBkZWYgX3Nhbml0aXplX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTCDEkeG7gyB0csOhbmggbOG7l2kga2hpIHBow6JuIHTDrWNoCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IENodeG7l2kgWE1MIGPhuqduIHjhu60gbMO9CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogQ2h14buXaSBYTUwgxJHDoyDEkcaw4bujYyB44butIGzDvQogICAgICAgICIiIgogICAgICAgICMgVGhheSB0aOG6vyBjw6FjIGvDvSB04buxICYga2jDtG5nIGjhu6NwIGzhu4cgYuG6sW5nICZhbXA7CiAgICAgICAgIyBOaMawbmcgZ2nhu68gbmd1ecOqbiBjw6FjIGVudGl0eSBo4bujcCBs4buHIG5oxrAgJmFtcDssICZsdDssICZndDssICZxdW90OywgJmFwb3M7CiAgICAgICAgeG1sX2NvbnRlbnQgPSByZS5zdWIocicmKD8hKGFtcHxsdHxndHxxdW90fGFwb3MpOyknLCAnJmFtcDsnLCB4bWxfY29udGVudCkKICAgICAgICAKICAgICAgICAjIExv4bqhaSBi4buPIGPDoWMga8O9IHThu7EgxJFp4buBdSBraGnhu4NuIGtow7RuZyBo4bujcCBs4buHIHRyb25nIFhNTAogICAgICAgIHhtbF9jb250ZW50ID0gcmUuc3ViKHInW1x4MDAtXHgwOFx4MEJceDBDXHgwRS1ceDFGXScsICcnLCB4bWxfY29udGVudCkKICAgICAgICAKICAgICAgICByZXR1cm4geG1sX2NvbnRlbnQKCiAgICBkZWYgZmluZF9lbGVtZW50X2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCAKICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHBo4bqnbiB04butIHRyb25nIFhNTCBk4buxYSB0csOqbiB0ZXh0LCBjb250ZW50LWRlc2MsIHJlc291cmNlLWlkLCBjbGFzcyBob+G6t2MgdmlzaWJsZS10by11c2VyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IE7hu5lpIGR1bmcgWE1MCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBQaOG6p24gdOG7rSDEkeG6p3UgdGnDqm4gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyBYUGF0aCBxdWVyeSBk4buxYSB0csOqbiBjw6FjIMSRaeG7gXUga2nhu4duCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EgdHJvbmcgdGV4dAogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ2NvbnRhaW5zKEB0ZXh0LCAie3RleHR9IiknKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRhaW5zOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRyb25nIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ2NvbnRhaW5zKEBjb250ZW50LWRlc2MsICJ7Y29udGVudF9kZXNjfSIpJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0BjbGFzcz0ie2NsYXNzX25hbWV9IicpCiAgICAgICAgICAgICAgICBpZiB2aXNpYmxlX3RvX3VzZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV92YWx1ZSA9ICJ0cnVlIiBpZiB2aXNpYmxlX3RvX3VzZXIgZWxzZSAiZmFsc2UiCiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdmlzaWJsZS10by11c2VyPSJ7dmlzaWJsZV92YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgPSAiLy9ub2RlIgogICAgICAgICAgICAgICAgaWYgY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSArPSAiWyIgKyAiIGFuZCAiLmpvaW4oY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHBo4bqnbiB04butIMSR4bqndSB0acOqbiBwaMO5IGjhu6NwCiAgICAgICAgICAgICAgICBlbGVtZW50ID0gcm9vdC54cGF0aCh4cGF0aF9xdWVyeSkKICAgICAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VsZW1lbnRfdG9fZGljdChlbGVtZW50WzBdKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIHBo4bqnbiB04butIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4CiAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRoYXkgdsOsIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgcGF0dGVybiA9IGYndGV4dD0iW14iXSp7cmUuZXNjYXBlKHRleHQpfVteIl0qIicKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZid0ZXh0PSJ7dGV4dH0iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgdGV4dAogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgaWYgY29udGVudF9kZXNjOgogICAgICAgICAgICBpZiBjb250YWluczoKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EgdGhheSB2w6wga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZidjb250ZW50LWRlc2M9IlteIl0qe3JlLmVzY2FwZShjb250ZW50X2Rlc2MpfVteIl0qIicKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZidjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgaWYgcmVzb3VyY2VfaWQ6CiAgICAgICAgICAgIHBhdHRlcm4gPSBmJ3Jlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBpZiBjbGFzc19uYW1lOgogICAgICAgICAgICBwYXR0ZXJuID0gZidjbGFzcz0ie2NsYXNzX25hbWV9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIGNsYXNzCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZmluZF9wYXJlbnRfZWxlbWVudF9pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgY2hpbGRfZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgY2hhIGPhu6dhIG3hu5l0IGVsZW1lbnQgY29uIHRyb25nIFhNTAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICBjaGlsZF9lbGVtZW50OiBFbGVtZW50IGNvbiAoZGljdCB24bubaSBjw6FjIHRodeG7mWMgdMOtbmggbmjGsCBib3VuZHMsIHRleHQsIGV0Yy4pCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogRWxlbWVudCBjaGEgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50IG9yIG5vdCBjaGlsZF9lbGVtZW50OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyDEkWnhu4F1IGtp4buHbiDEkeG7gyB0w6xtIGVsZW1lbnQgY29uIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGNoaWxkX2VsZW1lbnQuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBpZiBrZXkgaW4gWyd0ZXh0JywgJ2NvbnRlbnQtZGVzYycsICdyZXNvdXJjZS1pZCcsICdjbGFzcycsICdib3VuZHMnLCAndmlzaWJsZS10by11c2VyJ106CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHtrZXl9PSJ7dmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBjb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ID0gIi8vbm9kZVsiICsgIiBhbmQgIi5qb2luKGNvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBlbGVtZW50IGNvbgogICAgICAgICAgICAgICAgY2hpbGRfbm9kZXMgPSByb290LnhwYXRoKHhwYXRoX3F1ZXJ5KQogICAgICAgICAgICAgICAgaWYgY2hpbGRfbm9kZXM6CiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBlbGVtZW50IGNoYSBj4bunYSBlbGVtZW50IGNvbiDEkeG6p3UgdGnDqm4gdMOsbSDEkcaw4bujYwogICAgICAgICAgICAgICAgICAgIHBhcmVudF9ub2RlID0gY2hpbGRfbm9kZXNbMF0uZ2V0cGFyZW50KCkKICAgICAgICAgICAgICAgICAgICBpZiBwYXJlbnRfbm9kZSBpcyBub3QgTm9uZSBhbmQgcGFyZW50X25vZGUudGFnID09ICdub2RlJzoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VsZW1lbnRfdG9fZGljdChwYXJlbnRfbm9kZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IGNoYSB24bubaSBseG1sOiB7ZX0iKQogICAgICAgIAogICAgICAgICMgRmFsbGJhY2s6IFTDrG0ga2nhur9tIGLhurFuZyByZWdleCAocGjhu6ljIHThuqFwIGjGoW4gbmjGsG5nIGPhuqduIHRoaeG6v3QpCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFTDrG0gYm91bmRzIGPhu6dhIGVsZW1lbnQgY29uIMSR4buDIHjDoWMgxJHhu4tuaCB24buLIHRyw60KICAgICAgICAgICAgY2hpbGRfYm91bmRzID0gY2hpbGRfZWxlbWVudC5nZXQoJ2JvdW5kcycsICcnKQogICAgICAgICAgICBpZiBub3QgY2hpbGRfYm91bmRzOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBwYXR0ZXJuIGPhu6dhIGVsZW1lbnQgY29uIHRyb25nIFhNTAogICAgICAgICAgICBjaGlsZF9wYXR0ZXJuID0gTm9uZQogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBjaGlsZF9lbGVtZW50Lml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiBrZXkgaW4gWyd0ZXh0JywgJ2NvbnRlbnQtZGVzYycsICdyZXNvdXJjZS1pZCcsICdjbGFzcyddIGFuZCB2YWx1ZToKICAgICAgICAgICAgICAgICAgICBlc2NhcGVkX3ZhbHVlID0gcmUuZXNjYXBlKHN0cih2YWx1ZSkpCiAgICAgICAgICAgICAgICAgICAgcGF0dGVybiA9IGYne2tleX09Intlc2NhcGVkX3ZhbHVlfSInCiAgICAgICAgICAgICAgICAgICAgaWYgcGF0dGVybiBpbiB4bWxfY29udGVudDoKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfcGF0dGVybiA9IHBhdHRlcm4KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBjaGlsZF9wYXR0ZXJuOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB24buLIHRyw60gY+G7p2EgZWxlbWVudCBjb24gdHJvbmcgWE1MCiAgICAgICAgICAgIGNoaWxkX21hdGNoID0gcmUuc2VhcmNoKGNoaWxkX3BhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBub3QgY2hpbGRfbWF0Y2g6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIHBhdHRlcm4gbsOgeQogICAgICAgICAgICBjaGlsZF9zdGFydCA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIGNoaWxkX21hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgIGlmIGNoaWxkX3N0YXJ0ID09IC0xOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNoYSBi4bqxbmcgY8OhY2ggxJHhur9tIGxldmVsCiAgICAgICAgICAgICMgVMOsbSBuZ8aw4bujYyBs4bqhaSDEkeG7gyB0w6xtIHRo4bq7IG5vZGUgY2hhIGfhuqduIG5o4bqldAogICAgICAgICAgICBwYXJlbnRfc3RhcnQgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBjaGlsZF9zdGFydCkKICAgICAgICAgICAgaWYgcGFyZW50X3N0YXJ0ID09IC0xOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIHBhcmVudF9lbmQgPSB4bWxfY29udGVudC5maW5kKCc+JywgcGFyZW50X3N0YXJ0KSArIDEKICAgICAgICAgICAgcGFyZW50X2NvbnRlbnQgPSB4bWxfY29udGVudFtwYXJlbnRfc3RhcnQ6cGFyZW50X2VuZF0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMocGFyZW50X2NvbnRlbnQpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IGNoYSB24bubaSByZWdleDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIGZpbmRfY2hpbGRfZWxlbWVudHNfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIHBhcmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIGVsZW1lbnQgY29uIGPhu6dhIG3hu5l0IGVsZW1lbnQgY2hhIHRyb25nIFhNTAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICBwYXJlbnRfZWxlbWVudDogRWxlbWVudCBjaGEgKGRpY3QgduG7m2kgY8OhYyB0aHXhu5ljIHTDrW5oIG5oxrAgYm91bmRzLCB0ZXh0LCBldGMuKQogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgZWxlbWVudCBjb24gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICByZXN1bHRzID0gW10KICAgICAgICAKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQgb3Igbm90IHBhcmVudF9lbGVtZW50OgogICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgY2hhIHRyxrDhu5tjCiAgICAgICAgICAgICAgICBwYXJlbnRfY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBwYXJlbnRfZWxlbWVudC5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgIGlmIGtleSBpbiBbJ3RleHQnLCAnY29udGVudC1kZXNjJywgJ3Jlc291cmNlLWlkJywgJ2NsYXNzJywgJ2JvdW5kcycsICd2aXNpYmxlLXRvLXVzZXInXToKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHtrZXl9PSJ7dmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBwYXJlbnRfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwYXJlbnRfeHBhdGggPSAiLy9ub2RlWyIgKyAiIGFuZCAiLmpvaW4ocGFyZW50X2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICBwYXJlbnRfbm9kZXMgPSByb290LnhwYXRoKHBhcmVudF94cGF0aCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHBhcmVudF9ub2RlczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gdOG6pXQgY+G6oyBlbGVtZW50IGNvbiBj4bunYSBlbGVtZW50IGNoYQogICAgICAgICAgICAgICAgZm9yIHBhcmVudF9ub2RlIGluIHBhcmVudF9ub2RlczoKICAgICAgICAgICAgICAgICAgICAjIFjDonkgZOG7sW5nIMSRaeG7gXUga2nhu4duIHTDrG0ga2nhur9tIGNobyBlbGVtZW50IGNvbgogICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZF9jb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMuYXBwZW5kKGYnQGNsYXNzPSJ7Y2xhc3NfbmFtZX0iJykKICAgICAgICAgICAgICAgICAgICBpZiB2aXNpYmxlX3RvX3VzZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdmFsdWUgPSAidHJ1ZSIgaWYgdmlzaWJsZV90b191c2VyIGVsc2UgImZhbHNlIgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZF9jb25kaXRpb25zLmFwcGVuZChmJ0B2aXNpYmxlLXRvLXVzZXI9Int2aXNpYmxlX3ZhbHVlfSInKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSBlbGVtZW50IGNvbiB0cm9uZyBwYXJlbnQgbm9kZQogICAgICAgICAgICAgICAgICAgIGNoaWxkX3hwYXRoID0gIi4vL25vZGUiCiAgICAgICAgICAgICAgICAgICAgaWYgY2hpbGRfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfeHBhdGggKz0gIlsiICsgIiBhbmQgIi5qb2luKGNoaWxkX2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY2hpbGRfbm9kZXMgPSBwYXJlbnRfbm9kZS54cGF0aChjaGlsZF94cGF0aCkKICAgICAgICAgICAgICAgICAgICBmb3IgY2hpbGRfbm9kZSBpbiBjaGlsZF9ub2RlczoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoc2VsZi5fZWxlbWVudF90b19kaWN0KGNoaWxkX25vZGUpKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IGNvbiB24bubaSBseG1sOiB7ZX0iKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzCiAgICAKICAgIGRlZiBmaW5kX2NoaWxkX2VsZW1lbnRfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIHBhcmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgY29uIMSR4bqndSB0acOqbiBj4bunYSBt4buZdCBlbGVtZW50IGNoYSB0cm9uZyBYTUwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgcGFyZW50X2VsZW1lbnQ6IEVsZW1lbnQgY2hhIChkaWN0IHbhu5tpIGPDoWMgdGh14buZYyB0w61uaCBuaMawIGJvdW5kcywgdGV4dCwgZXRjLikKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IEVsZW1lbnQgY29uIMSR4bqndSB0acOqbiB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICBjaGlsZF9lbGVtZW50cyA9IHNlbGYuZmluZF9jaGlsZF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgIHhtbF9jb250ZW50LCBwYXJlbnRfZWxlbWVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyLCBjb250YWlucwogICAgICAgICkKICAgICAgICByZXR1cm4gY2hpbGRfZWxlbWVudHNbMF0gaWYgY2hpbGRfZWxlbWVudHMgZWxzZSBOb25lCiAgICAKICAgIGRlZiBmaW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSB0cm9uZyBYTUwgcGjDuSBo4bujcCB24bubaSDEkWnhu4F1IGtp4buHbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgcGjhuqduIHThu60gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICByZXN1bHRzID0gW10KICAgICAgICAKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQ6CiAgICAgICAgICAgIHJldHVybiByZXN1bHRzCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwgxJHhu4MgdHLDoW5oIGzhu5dpIEVudGl0eVJlZgogICAgICAgICAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLl9zYW5pdGl6ZV94bWwoeG1sX2NvbnRlbnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUGFyc2UgWE1MIHbhu5tpIHTDuXkgY2jhu41uIHJlY292ZXIgxJHhu4MgeOG7rSBsw70gbOG7l2kKICAgICAgICAgICAgICAgIHBhcnNlciA9IGV0cmVlLlhNTFBhcnNlcihyZWNvdmVyPVRydWUpCiAgICAgICAgICAgICAgICByb290ID0gZXRyZWUuZnJvbXN0cmluZyh4bWxfY29udGVudC5lbmNvZGUoJ3V0Zi04JyksIHBhcnNlcj1wYXJzZXIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgWMOieSBk4buxbmcgWFBhdGggcXVlcnkgZOG7sWEgdHLDqm4gY8OhYyDEkWnhu4F1IGtp4buHbgogICAgICAgICAgICAgICAgY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICBpZiB0ZXh0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRhaW5zOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRyb25nIHRleHQKICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidjb250YWlucyhAdGV4dCwgInt0ZXh0fSIpJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0B0ZXh0PSJ7dGV4dH0iJykKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBpZiBjb250YWluczoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYSB0cm9uZyBjb250ZW50LWRlc2MKICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidjb250YWlucyhAY29udGVudC1kZXNjLCAie2NvbnRlbnRfZGVzY30iKScpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMKICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAcmVzb3VyY2UtaWQ9IntyZXNvdXJjZV9pZH0iJykKICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY2xhc3M9IntjbGFzc19uYW1lfSInKQogICAgICAgICAgICAgICAgaWYgdmlzaWJsZV90b191c2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdmFsdWUgPSAidHJ1ZSIgaWYgdmlzaWJsZV90b191c2VyIGVsc2UgImZhbHNlIgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHZpc2libGUtdG8tdXNlcj0ie3Zpc2libGVfdmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ID0gIi8vbm9kZSIKICAgICAgICAgICAgICAgIGlmIGNvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgKz0gIlsiICsgIiBhbmQgIi5qb2luKGNvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIHBo4bqnbiB04butIHBow7kgaOG7o3AKICAgICAgICAgICAgICAgIGVsZW1lbnRzID0gcm9vdC54cGF0aCh4cGF0aF9xdWVyeSkKICAgICAgICAgICAgICAgIGZvciBlbGVtZW50IGluIGVsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2VsZW1lbnRfdG9fZGljdChlbGVtZW50KSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBwaOG6p24gdOG7rSB24bubaSBseG1sOiB7ZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiJUaOG7rSB0w6xtIHBo4bqnbiB04butIGLhurFuZyBwaMawxqFuZyB0aOG7qWMgdGhheSB0aOG6vy4uLiIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4IChjaOG7iSB0cuG6oyB24buBIGvhur90IHF14bqjIMSRxqFuIGdp4bqjbikKICAgICAgICBpZiBub3QgcmVzdWx0cyBhbmQgdGV4dDoKICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRoYXkgdsOsIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgcGF0dGVybiA9IGYndGV4dD0iW14iXSp7cmUuZXNjYXBlKHRleHQpfVteIl0qIicKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gZid0ZXh0PSJ7dGV4dH0iJwogICAgICAgICAgICBmb3IgbWF0Y2ggaW4gcmUuZmluZGl0ZXIocGF0dGVybiwgeG1sX2NvbnRlbnQpOgogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHJlc3VsdHMgYW5kIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhIHRoYXkgdsOsIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgcGF0dGVybiA9IGYnY29udGVudC1kZXNjPSJbXiJdKntyZS5lc2NhcGUoY29udGVudF9kZXNjKX1bXiJdKiInCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYwogICAgICAgICAgICAgICAgcGF0dGVybiA9IGYnY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInCiAgICAgICAgICAgIGZvciBtYXRjaCBpbiByZS5maW5kaXRlcihwYXR0ZXJuLCB4bWxfY29udGVudCk6CiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KSkKICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgCiAgICBkZWYgX2V4dHJhY3RfYXR0cmlidXRlcyhzZWxmLCBub2RlX2NvbnRlbnQ6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVHLDrWNoIHh14bqldCBjw6FjIHRodeG7mWMgdMOtbmggdOG7qyBu4buZaSBkdW5nIGPhu6dhIG3hu5l0IHRo4bq7IG5vZGUKICAgICAgICAiIiIKICAgICAgICBhdHRyaWJ1dGVzID0ge30KICAgICAgICAKICAgICAgICAjIEPDoWMgdGh14buZYyB0w61uaCBj4bqnbiB0csOtY2ggeHXhuqV0CiAgICAgICAgYXR0cl9wYXR0ZXJucyA9IHsKICAgICAgICAgICAgImNsYXNzIjogcidjbGFzcz0iKFteIl0qKSInLAogICAgICAgICAgICAicGFja2FnZSI6IHIncGFja2FnZT0iKFteIl0qKSInLAogICAgICAgICAgICAicmVzb3VyY2UtaWQiOiByJ3Jlc291cmNlLWlkPSIoW14iXSopIicsCiAgICAgICAgICAgICJ0ZXh0Ijogcid0ZXh0PSIoW14iXSopIicsCiAgICAgICAgICAgICJjb250ZW50LWRlc2MiOiByJ2NvbnRlbnQtZGVzYz0iKFteIl0qKSInLAogICAgICAgICAgICAiYm91bmRzIjogcidib3VuZHM9IihbXiJdKikiJywKICAgICAgICAgICAgImNoZWNrYWJsZSI6IHInY2hlY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJjaGVja2VkIjogcidjaGVja2VkPSIoW14iXSopIicsCiAgICAgICAgICAgICJjbGlja2FibGUiOiByJ2NsaWNrYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAiZW5hYmxlZCI6IHInZW5hYmxlZD0iKFteIl0qKSInLAogICAgICAgICAgICAiZm9jdXNhYmxlIjogcidmb2N1c2FibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImZvY3VzZWQiOiByJ2ZvY3VzZWQ9IihbXiJdKikiJywKICAgICAgICAgICAgInNjcm9sbGFibGUiOiByJ3Njcm9sbGFibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImxvbmctY2xpY2thYmxlIjogcidsb25nLWNsaWNrYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAicGFzc3dvcmQiOiByJ3Bhc3N3b3JkPSIoW14iXSopIicsCiAgICAgICAgICAgICJzZWxlY3RlZCI6IHInc2VsZWN0ZWQ9IihbXiJdKikiJwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgYXR0cl9uYW1lLCBwYXR0ZXJuIGluIGF0dHJfcGF0dGVybnMuaXRlbXMoKToKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgbm9kZV9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXNbYXR0cl9uYW1lXSA9IG1hdGNoLmdyb3VwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gYXR0cmlidXRlcwoKICAgIGRlZiBfZWxlbWVudF90b19kaWN0KHNlbGYsIGVsZW1lbnQpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENodXnhu4NuIMSR4buVaSBt4buZdCBwaOG6p24gdOG7rSBYTUwgdOG7qyBseG1sIHRow6BuaCBkaWN0CiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0ID0ge30KICAgICAgICAKICAgICAgICAjIEzhuqV5IHThuqV0IGPhuqMgdGh14buZYyB0w61uaAogICAgICAgIGZvciBrZXksIHZhbHVlIGluIGVsZW1lbnQuYXR0cmliLml0ZW1zKCk6CiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWUKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdAoKICAgIGRlZiBmaW5kX2VsZW1lbnQoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSBwaOG6p24gdOG7rSB0csOqbiBtw6BuIGjDrG5oIGThu7FhIHRyw6puIHRleHQsIGNvbnRlbnQtZGVzYywgcmVzb3VyY2UtaWQsIGNsYXNzIGhv4bq3YyB2aXNpYmxlLXRvLXVzZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogUGjhuqduIHThu60gxJHhuqd1IHRpw6puIHTDrG0gdGjhuqV5IGhv4bq3YyBOb25lIG7hur91IGtow7RuZyB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUsIHZpc2libGVfdG9fdXNlciwgY29udGFpbnMpCgogICAgZGVmIGZpbmRfYWxsX2VsZW1lbnRzKHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlLCBjb250YWluczogYm9vbCA9IEZhbHNlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSB0csOqbiBtw6BuIGjDrG5oIHBow7kgaOG7o3AgduG7m2kgxJFp4buBdSBraeG7h24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgcGjhuqduIHThu60gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICByZXR1cm4gc2VsZi5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoeG1sX2NvbnRlbnQsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUsIHZpc2libGVfdG9fdXNlciwgY29udGFpbnMpCgogICAgZGVmIGZpbmRfY2hpbGRfZWxlbWVudHMoc2VsZiwgcGFyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgZWxlbWVudCBjb24gY+G7p2EgbeG7mXQgZWxlbWVudCBjaGEgdHLDqm4gbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwYXJlbnRfZWxlbWVudDogRWxlbWVudCBjaGEgKGRpY3QgduG7m2kgY8OhYyB0aHXhu5ljIHTDrW5oIG5oxrAgYm91bmRzLCB0ZXh0LCBldGMuKQogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgZWxlbWVudCBjb24gdMOsbSB0aOG6pXkKICAgICAgICAgICAgCiAgICAgICAgRXhhbXBsZToKICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgR3JpZFZpZXcgdHJvbmcgbeG7mXQgVmlld0dyb3VwCiAgICAgICAgICAgIHBhcmVudCA9IGhlbHBlci5maW5kX2VsZW1lbnQoY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuVmlld0dyb3VwIikKICAgICAgICAgICAgZ3JpZF92aWV3cyA9IGhlbHBlci5maW5kX2NoaWxkX2VsZW1lbnRzKHBhcmVudCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuR3JpZFZpZXciKQogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfY2hpbGRfZWxlbWVudHNfaW5feG1sKHhtbF9jb250ZW50LCBwYXJlbnRfZWxlbWVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyLCBjb250YWlucykKCiAgICBkZWYgZmluZF9jaGlsZF9lbGVtZW50KHNlbGYsIHBhcmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgY29uIMSR4bqndSB0acOqbiBj4bunYSBt4buZdCBlbGVtZW50IGNoYSB0csOqbiBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBhcmVudF9lbGVtZW50OiBFbGVtZW50IGNoYSAoZGljdCB24bubaSBjw6FjIHRodeG7mWMgdMOtbmggbmjGsCBib3VuZHMsIHRleHQsIGV0Yy4pCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBFbGVtZW50IGNvbiDEkeG6p3UgdGnDqm4gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgICAgIAogICAgICAgIEV4YW1wbGU6CiAgICAgICAgICAgICMgVMOsbSBt4buZdCBUZXh0VmlldyB0cm9uZyBt4buZdCBMaW5lYXJMYXlvdXQgY+G7pSB0aOG7gwogICAgICAgICAgICBwYXJlbnQgPSBoZWxwZXIuZmluZF9lbGVtZW50KGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkxpbmVhckxheW91dCIsIHJlc291cmNlX2lkPSJjb20uZXhhbXBsZTppZC9jb250YWluZXIiKQogICAgICAgICAgICB0ZXh0X3ZpZXcgPSBoZWxwZXIuZmluZF9jaGlsZF9lbGVtZW50KHBhcmVudCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuVGV4dFZpZXciKQogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfY2hpbGRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIHBhcmVudF9lbGVtZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIsIGNvbnRhaW5zKQoKICAgIGRlZiBnZXRfbmV4dF9lbGVtZW50X2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCBjdXJyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gZWxlbWVudCB0aeG6v3AgdGhlbyAoYW5oIGVtKSBj4bunYSBlbGVtZW50IGhp4buHbiB04bqhaSB0cm9uZyBYTUwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgY3VycmVudF9lbGVtZW50OiBFbGVtZW50IGhp4buHbiB04bqhaSDEkeG7gyBsw6BtIG3hu5FjCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgZWxlbWVudCB0aeG6v3AgdGhlbyBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBlbGVtZW50IHRp4bq/cCB0aGVvIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgdGnhur9wIHRoZW8gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIGVsZW1lbnQgdGnhur9wIHRoZW8gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICBjb250YWluczogRmFsc2UgxJHhu4MgdMOsbSBraeG6v20ga2jhu5twIGNow61uaCB4w6FjICht4bq3YyDEkeG7i25oKSwgVHJ1ZSDEkeG7gyB0w6xtIGtp4bq/bSBjaOG7qWEgdOG7qyBraMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IEVsZW1lbnQgdGnhur9wIHRoZW8gaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50IG9yIG5vdCBjdXJyZW50X2VsZW1lbnQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gZWxlbWVudCBoaeG7h24gdOG6oWkgdHLGsOG7m2MKICAgICAgICAgICAgICAgIGN1cnJlbnRfY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBjdXJyZW50X2VsZW1lbnQuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBpZiBrZXkgaW4gWyd0ZXh0JywgJ2NvbnRlbnQtZGVzYycsICdyZXNvdXJjZS1pZCcsICdjbGFzcycsICdib3VuZHMnLCAndmlzaWJsZS10by11c2VyJ106CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfY29uZGl0aW9ucy5hcHBlbmQoZidAe2tleX09Int2YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGN1cnJlbnRfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdXJyZW50X3hwYXRoID0gIi8vbm9kZVsiICsgIiBhbmQgIi5qb2luKGN1cnJlbnRfY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIGN1cnJlbnRfbm9kZXMgPSByb290LnhwYXRoKGN1cnJlbnRfeHBhdGgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBjdXJyZW50X25vZGVzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN1cnJlbnRfbm9kZSA9IGN1cnJlbnRfbm9kZXNbMF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgdGnhur9wIHRoZW8gKGZvbGxvd2luZy1zaWJsaW5nKQogICAgICAgICAgICAgICAgbmV4dF9jb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfY29uZGl0aW9ucy5hcHBlbmQoZidjb250YWlucyhAdGV4dCwgInt0ZXh0fSIpJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBuZXh0X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRhaW5zOgogICAgICAgICAgICAgICAgICAgICAgICBuZXh0X2NvbmRpdGlvbnMuYXBwZW5kKGYnY29udGFpbnMoQGNvbnRlbnQtZGVzYywgIntjb250ZW50X2Rlc2N9IiknKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgbmV4dF9jb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBuZXh0X2NvbmRpdGlvbnMuYXBwZW5kKGYnQGNsYXNzPSJ7Y2xhc3NfbmFtZX0iJykKICAgICAgICAgICAgICAgIGlmIHZpc2libGVfdG9fdXNlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3ZhbHVlID0gInRydWUiIGlmIHZpc2libGVfdG9fdXNlciBlbHNlICJmYWxzZSIKICAgICAgICAgICAgICAgICAgICBuZXh0X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHZpc2libGUtdG8tdXNlcj0ie3Zpc2libGVfdmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBhbmggZW0gdGnhur9wIHRoZW8KICAgICAgICAgICAgICAgIG5leHRfeHBhdGggPSAiZm9sbG93aW5nLXNpYmxpbmc6Om5vZGUiCiAgICAgICAgICAgICAgICBpZiBuZXh0X2NvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgbmV4dF94cGF0aCArPSAiWyIgKyAiIGFuZCAiLmpvaW4obmV4dF9jb25kaXRpb25zKSArICJdIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBuZXh0X25vZGVzID0gY3VycmVudF9ub2RlLnhwYXRoKG5leHRfeHBhdGgpCiAgICAgICAgICAgICAgICBpZiBuZXh0X25vZGVzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbGVtZW50X3RvX2RpY3QobmV4dF9ub2Rlc1swXSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IHRp4bq/cCB0aGVvIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgZ2V0X3ByZXZfZWxlbWVudF9pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgY3VycmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyAoYW5oIGVtKSBj4bunYSBlbGVtZW50IGhp4buHbiB04bqhaSB0cm9uZyBYTUwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgY3VycmVudF9lbGVtZW50OiBFbGVtZW50IGhp4buHbiB04bqhaSDEkeG7gyBsw6BtIG3hu5FjCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgZWxlbWVudCB0csaw4bubYyDEkcOzIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBlbGVtZW50IHRyxrDhu5tjIMSRw7MgY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIGNvbnRhaW5zOiBGYWxzZSDEkeG7gyB0w6xtIGtp4bq/bSBraOG7m3AgY2jDrW5oIHjDoWMgKG3hurdjIMSR4buLbmgpLCBUcnVlIMSR4buDIHTDrG0ga2nhur9tIGNo4bupYSB04burIGtow7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogRWxlbWVudCB0csaw4bubYyDEkcOzIGhv4bq3YyBOb25lIG7hur91IGtow7RuZyB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIGlmIG5vdCB4bWxfY29udGVudCBvciBub3QgY3VycmVudF9lbGVtZW50OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgaGnhu4duIHThuqFpIHRyxrDhu5tjCiAgICAgICAgICAgICAgICBjdXJyZW50X2NvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gY3VycmVudF9lbGVtZW50Lml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgaWYga2V5IGluIFsndGV4dCcsICdjb250ZW50LWRlc2MnLCAncmVzb3VyY2UtaWQnLCAnY2xhc3MnLCAnYm91bmRzJywgJ3Zpc2libGUtdG8tdXNlciddOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHtrZXl9PSJ7dmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBjdXJyZW50X2NvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3VycmVudF94cGF0aCA9ICIvL25vZGVbIiArICIgYW5kICIuam9pbihjdXJyZW50X2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICBjdXJyZW50X25vZGVzID0gcm9vdC54cGF0aChjdXJyZW50X3hwYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgY3VycmVudF9ub2RlczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdXJyZW50X25vZGUgPSBjdXJyZW50X25vZGVzWzBdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBlbGVtZW50IHRyxrDhu5tjIMSRw7MgKHByZWNlZGluZy1zaWJsaW5nKQogICAgICAgICAgICAgICAgcHJldl9jb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGFpbnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZfY29uZGl0aW9ucy5hcHBlbmQoZidjb250YWlucyhAdGV4dCwgInt0ZXh0fSIpJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmV2X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRhaW5zOgogICAgICAgICAgICAgICAgICAgICAgICBwcmV2X2NvbmRpdGlvbnMuYXBwZW5kKGYnY29udGFpbnMoQGNvbnRlbnQtZGVzYywgIntjb250ZW50X2Rlc2N9IiknKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZfY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcHJldl9jb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBwcmV2X2NvbmRpdGlvbnMuYXBwZW5kKGYnQGNsYXNzPSJ7Y2xhc3NfbmFtZX0iJykKICAgICAgICAgICAgICAgIGlmIHZpc2libGVfdG9fdXNlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3ZhbHVlID0gInRydWUiIGlmIHZpc2libGVfdG9fdXNlciBlbHNlICJmYWxzZSIKICAgICAgICAgICAgICAgICAgICBwcmV2X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHZpc2libGUtdG8tdXNlcj0ie3Zpc2libGVfdmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBhbmggZW0gdHLGsOG7m2MgxJHDsyAobOG6pXkgY8OhaSBjdeG7kWkgY8O5bmcgdsOsIHByZWNlZGluZy1zaWJsaW5nIHRy4bqjIHbhu4EgdGhlbyB0aOG7qSB04buxIG5nxrDhu6NjKQogICAgICAgICAgICAgICAgcHJldl94cGF0aCA9ICJwcmVjZWRpbmctc2libGluZzo6bm9kZSIKICAgICAgICAgICAgICAgIGlmIHByZXZfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICBwcmV2X3hwYXRoICs9ICJbIiArICIgYW5kICIuam9pbihwcmV2X2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHByZXZfbm9kZXMgPSBjdXJyZW50X25vZGUueHBhdGgocHJldl94cGF0aCkKICAgICAgICAgICAgICAgIGlmIHByZXZfbm9kZXM6CiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBlbGVtZW50IGN14buRaSBjw7luZyB2w6wgcHJlY2VkaW5nLXNpYmxpbmcgdHLhuqMgduG7gSB0aGVvIHRo4bupIHThu7EgbmfGsOG7o2MKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZWxlbWVudF90b19kaWN0KHByZXZfbm9kZXNbLTFdKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyB24bubaSBseG1sOiB7ZX0iKQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIGdldF9uZXh0X2VsZW1lbnQoc2VsZiwgY3VycmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIGNvbnRhaW5zOiBib29sID0gRmFsc2UpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgdGnhur9wIHRoZW8gKGFuaCBlbSkgY+G7p2EgZWxlbWVudCBoaeG7h24gdOG6oWkgdHLDqm4gbcOgbiBow6xuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGN1cnJlbnRfZWxlbWVudDogRWxlbWVudCBoaeG7h24gdOG6oWkgxJHhu4MgbMOgbSBt4buRYwogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIGVsZW1lbnQgdGnhur9wIHRoZW8gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgZWxlbWVudCB0aeG6v3AgdGhlbyBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBlbGVtZW50IHRp4bq/cCB0aGVvIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBlbGVtZW50IHRp4bq/cCB0aGVvIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBFbGVtZW50IHRp4bq/cCB0aGVvIGhv4bq3YyBOb25lIG7hur91IGtow7RuZyB0w6xtIHRo4bqleQogICAgICAgICAgICAKICAgICAgICBFeGFtcGxlOgogICAgICAgICAgICAjIFTDrG0gYnV0dG9uIHRp4bq/cCB0aGVvIHNhdSBidXR0b24gaGnhu4duIHThuqFpCiAgICAgICAgICAgIGN1cnJlbnRfYnRuID0gaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJQcmV2aW91cyIpCiAgICAgICAgICAgIG5leHRfYnRuID0gaGVscGVyLmdldF9uZXh0X2VsZW1lbnQoY3VycmVudF9idG4sIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIpCiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0X25leHRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIGN1cnJlbnRfZWxlbWVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyLCBjb250YWlucykKCiAgICBkZWYgZ2V0X3ByZXZfZWxlbWVudChzZWxmLCBjdXJyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gZWxlbWVudCB0csaw4bubYyDEkcOzIChhbmggZW0pIGPhu6dhIGVsZW1lbnQgaGnhu4duIHThuqFpIHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBjdXJyZW50X2VsZW1lbnQ6IEVsZW1lbnQgaGnhu4duIHThuqFpIMSR4buDIGzDoG0gbeG7kWMKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBlbGVtZW50IHRyxrDhu5tjIMSRw7MgY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgZWxlbWVudCB0csaw4bubYyDEkcOzIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgdHLGsOG7m2MgxJHDsyBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgZWxlbWVudCB0csaw4bubYyDEkcOzIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBFbGVtZW50IHRyxrDhu5tjIMSRw7MgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgICAgIAogICAgICAgIEV4YW1wbGU6CiAgICAgICAgICAgICMgVMOsbSBidXR0b24gdHLGsOG7m2MgxJHDsyB0csaw4bubYyBidXR0b24gaGnhu4duIHThuqFpCiAgICAgICAgICAgIGN1cnJlbnRfYnRuID0gaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJOZXh0IikKICAgICAgICAgICAgcHJldl9idG4gPSBoZWxwZXIuZ2V0X3ByZXZfZWxlbWVudChjdXJyZW50X2J0biwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuQnV0dG9uIikKICAgICAgICAiIiIKICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICByZXR1cm4gc2VsZi5nZXRfcHJldl9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgY3VycmVudF9lbGVtZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIsIGNvbnRhaW5zKQoKICAgIGRlZiBpc19lbGVtZW50X3NlbGVjdGVkKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyDEkcaw4bujYyBjaOG7jW4gaGF5IGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgic2VsZWN0ZWQiKSA9PSAidHJ1ZSIKCiAgICBkZWYgd2FpdF9mb3JfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgdGltZW91dDogaW50ID0gMzAsIAogICAgICAgICAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbDogaW50ID0gMSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIENo4budIMSR4bujaSBjaG8gxJHhur9uIGtoaSBt4buZdCBwaOG6p24gdOG7rSB4deG6pXQgaGnhu4duIHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIHRpbWVvdXQ6IFRo4budaSBnaWFuIGNo4budIHThu5FpIMSRYSAoZ2nDonkpCiAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBLaG/huqNuZyB0aOG7nWkgZ2lhbiBnaeG7r2EgY8OhYyBs4bqnbiBraeG7g20gdHJhIChnacOieSkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBQaOG6p24gdOG7rSB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSB0aW1lb3V0CiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgdGltZW91dDoKICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuZmluZF9lbGVtZW50KHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUsIHZpc2libGVfdG9fdXNlciwgY29udGFpbnMpCiAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgd2FpdF90b190YXBfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgdGltZW91dDogaW50ID0gMzAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbDogaW50ID0gMSwgZGVsYXlfYmVmb3JlX3RhcDogaW50ID0gMSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgZWxlbWVudCB4deG6pXQgaGnhu4duLCBkZWxheSBt4buZdCBraG/huqNuZyB0aOG7nWkgZ2lhbiwgcuG7k2kgdGFwIHbDoG8gZWxlbWVudAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgdGltZW91dDogVGjhu51pIGdpYW4gY2jhu50gdOG7kWkgxJFhIMSR4buDIHTDrG0gZWxlbWVudCAoZ2nDonkpCiAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBLaG/huqNuZyB0aOG7nWkgZ2lhbiBnaeG7r2EgY8OhYyBs4bqnbiBraeG7g20gdHJhIChnacOieSkKICAgICAgICAgICAgZGVsYXlfYmVmb3JlX3RhcDogVGjhu51pIGdpYW4gZGVsYXkgdHLGsOG7m2Mga2hpIHRhcCAoZ2nDonksIG3hurdjIMSR4buLbmggMSBnacOieSkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaOG7nSBlbGVtZW50IHh14bqldCBoaeG7h24KICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYud2FpdF9mb3JfZWxlbWVudCgKICAgICAgICAgICAgICAgIHRleHQ9dGV4dCwgCiAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2M9Y29udGVudF9kZXNjLCAKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPXJlc291cmNlX2lkLCAKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9Y2xhc3NfbmFtZSwKICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcj12aXNpYmxlX3RvX3VzZXIsIAogICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0LCAKICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsPWNoZWNrX2ludGVydmFsLAogICAgICAgICAgICAgICAgY29udGFpbnM9Y29udGFpbnMKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAjIFThuqFvIHRow7RuZyBiw6FvIGzhu5dpIGNoaSB0aeG6v3QKICAgICAgICAgICAgICAgIGNyaXRlcmlhID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQ6CiAgICAgICAgICAgICAgICAgICAgY3JpdGVyaWEuYXBwZW5kKGYidGV4dD0ne3RleHR9JyIpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgY3JpdGVyaWEuYXBwZW5kKGYiY29udGVudF9kZXNjPSd7Y29udGVudF9kZXNjfSciKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQ6CiAgICAgICAgICAgICAgICAgICAgY3JpdGVyaWEuYXBwZW5kKGYicmVzb3VyY2VfaWQ9J3tyZXNvdXJjZV9pZH0nIikKICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWU6CiAgICAgICAgICAgICAgICAgICAgY3JpdGVyaWEuYXBwZW5kKGYiY2xhc3NfbmFtZT0ne2NsYXNzX25hbWV9JyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNyaXRlcmlhX3N0ciA9ICIsICIuam9pbihjcml0ZXJpYSkgaWYgY3JpdGVyaWEgZWxzZSAia2jDtG5nIHjDoWMgxJHhu4tuaCIKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYiS2jDtG5nIHTDrG0gdGjhuqV5IGVsZW1lbnQgc2F1IHt0aW1lb3V0fXMgduG7m2kgdGnDqnUgY2jDrToge2NyaXRlcmlhX3N0cn0iCiAgICAgICAgICAgICAgICBwcmludChlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBEZWxheSB0csaw4bubYyBraGkgdGFwCiAgICAgICAgICAgIGlmIGRlbGF5X2JlZm9yZV90YXAgPiAwOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcChkZWxheV9iZWZvcmVfdGFwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUYXAgdsOgbyBlbGVtZW50CiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYudGFwX2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEga+G6v3QgcXXhuqMgdGFwCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mbyA9IFtdCiAgICAgICAgICAgICAgICBpZiB0ZXh0OgogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mby5hcHBlbmQoZiJ0ZXh0PSd7dGV4dH0nIikKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8uYXBwZW5kKGYiY29udGVudF9kZXNjPSd7Y29udGVudF9kZXNjfSciKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQ6CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9pbmZvLmFwcGVuZChmInJlc291cmNlX2lkPSd7cmVzb3VyY2VfaWR9JyIpCiAgICAgICAgICAgICAgICBpZiBjbGFzc19uYW1lOgogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mby5hcHBlbmQoZiJjbGFzc19uYW1lPSd7Y2xhc3NfbmFtZX0nIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxlbWVudF9zdHIgPSAiLCAiLmpvaW4oZWxlbWVudF9pbmZvKSBpZiBlbGVtZW50X2luZm8gZWxzZSAiZWxlbWVudCIKICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyB0YXAgdGjDoG5oIGPDtG5nIHbDoG8ge2VsZW1lbnRfc3RyfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGFwIGVsZW1lbnQ6IHtyZXN1bHQuZ2V0KCdtZXNzYWdlJywgJ0tow7RuZyB4w6FjIMSR4buLbmgnKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSB0cm9uZyB3YWl0X3RvX3RhcF9lbGVtZW50OiB7c3RyKGUpfSIKICAgICAgICAgICAgcHJpbnQoZXJyb3JfbXNnKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfdGV4dChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRleHQgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NvbnRlbnRfZGVzYyhzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGNvbnRlbnQtZGVzYyBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9yZXNvdXJjZV9pZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHJlc291cmNlLWlkIGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJyZXNvdXJjZS1pZCIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2xhc3Moc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBjbGFzcyBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2xhc3MiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2VuYWJsZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGvDrWNoIGhv4bqhdCBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImVuYWJsZWQiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NsaWNrYWJsZShzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgdGjhu4MgbmjhuqVwIHbDoG8ga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjbGlja2FibGUiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2ZvY3VzZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGZvY3VzIGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiZm9jdXNlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2hlY2tlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2MgY2jhu41uIGtow7RuZyAoY2hvIGNoZWNrYm94KQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2hlY2tlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfYm91bmRzKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBUdXBsZVtpbnQsIGludCwgaW50LCBpbnRdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHThu41hIMSR4buZIGJvdW5kcyBj4bunYSBwaOG6p24gdOG7rSBkxrDhu5tpIGThuqFuZyB0dXBsZSAoeDEsIHkxLCB4MiwgeTIpCiAgICAgICAgWOG7rSBsw70gY8OhYyB0csaw4budbmcgaOG7o3AgYm91bmRzIGtow7RuZyBo4bujcCBs4buHICjDom0sIDAsIGhv4bq3YyBmb3JtYXQgc2FpKQogICAgICAgICIiIgogICAgICAgIGJvdW5kcyA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiWzAsMF1bMCwwXSIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7rSBjw6FjIHBhdHRlcm4ga2jDoWMgbmhhdSDEkeG7gyBwYXJzZSBib3VuZHMKICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgciJcWygtP1xkKyksKC0/XGQrKVxdXFsoLT9cZCspLCgtP1xkKylcXSIsICAjIFBhdHRlcm4gaGnhu4duIHThuqFpLCBjaG8gcGjDqXAgc+G7kSDDom0KICAgICAgICAgICAgciIoLT9cZCspLCgtP1xkKyksKC0/XGQrKSwoLT9cZCspIiwgICAgICAgICAjIFBhdHRlcm46IHgxLHkxLHgyLHkyCiAgICAgICAgICAgIHIiXFsoLT9cZCspOygtP1xkKylcXVxbKC0/XGQrKTsoLT9cZCspXF0iICAgIyBQYXR0ZXJuIHbhu5tpIGThuqV1IDsKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUubWF0Y2gocGF0dGVybiwgYm91bmRzKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIHgxLCB5MSwgeDIsIHkyID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU+G7rWEgY2jhu69hIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hwogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7MgdOG7jWEgxJHhu5kgw6JtLCDEkWnhu4F1IGNo4buJbmgKICAgICAgICAgICAgICAgIGlmIHkxIDwgMCBvciB5MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogQm91bmRzIGPDsyB04buNYSDEkeG7mSB5IMOibTogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgICAgICAjIE7hur91IHkyIMOibSwgY8OzIHRo4buDIGVsZW1lbnQgbuG6sW0gdHLDqm4gdGhhbmggc3RhdHVzIGJhcgogICAgICAgICAgICAgICAgICAgIGlmIHkyIDwgMDoKICAgICAgICAgICAgICAgICAgICAgICAgIyDEkGnhu4F1IGNo4buJbmggxJHhu4MgZWxlbWVudCBjw7MgdGjhu4MgdGFwIMSRxrDhu6NjCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGFicyh5MiAtIHkxKSAgIyBDaGnhu4F1IGNhbyBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gbWF4KDAsIHkxKSAgIyDEkOG6o20gYuG6o28geTEgPj0gMAogICAgICAgICAgICAgICAgICAgICAgICB5MiA9IHkxICsgaGVpZ2h0ICAjIMSQ4bq3dCB5MiBkxrDGoW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyDEkWnhu4F1IGNo4buJbmggYm91bmRzIHRow6BuaDogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgeDEgPCAwIG9yIHgyIDwgMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBCb3VuZHMgY8OzIHThu41hIMSR4buZIHggw6JtOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgICAgICMgVMawxqFuZyB04buxIHbhu5tpIHgKICAgICAgICAgICAgICAgICAgICBpZiB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gYWJzKHgyIC0geDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gbWF4KDAsIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHgxICsgd2lkdGgKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIMSRaeG7gXUgY2jhu4luaCBib3VuZHMgdGjDoG5oOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgYm91bmRzIGjhu6NwIGzhu4cgc2F1IGtoaSDEkWnhu4F1IGNo4buJbmgKICAgICAgICAgICAgICAgIGlmIHgxIDwgeDIgYW5kIHkxIDwgeTIgYW5kIG5vdCAoeDEgPT0gMCBhbmQgeTEgPT0gMCBhbmQgeDIgPT0gMCBhbmQgeTIgPT0gMCk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh4MSwgeTEsIHgyLCB5MikKICAgICAgICAKICAgICAgICAjIE7hur91IGtow7RuZyBwYXJzZSDEkcaw4bujYyBob+G6t2MgdOG6pXQgY+G6oyBsw6AgMCwgdGjhu60gbOG6pXkgdOG7qyB0aHXhu5ljIHTDrW5oIGtow6FjCiAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogS2jDtG5nIHRo4buDIHBhcnNlIGJvdW5kcyAne2JvdW5kc30nIGPhu6dhIGVsZW1lbnQsIHRo4butIHBoxrDGoW5nIHBow6FwIGtow6FjLi4uIikKICAgICAgICAKICAgICAgICAjIFRo4butIGzhuqV5IHThu6sgY8OhYyB0aHXhu5ljIHTDrW5oIGtow6FjIG7hur91IGPDswogICAgICAgIHggPSBlbGVtZW50LmdldCgieCIsIDApCiAgICAgICAgeSA9IGVsZW1lbnQuZ2V0KCJ5IiwgMCkKICAgICAgICB3aWR0aCA9IGVsZW1lbnQuZ2V0KCJ3aWR0aCIsIDEwMCkgICMgRGVmYXVsdCB3aWR0aAogICAgICAgIGhlaWdodCA9IGVsZW1lbnQuZ2V0KCJoZWlnaHQiLCA1MCkgICMgRGVmYXVsdCBoZWlnaHQKICAgICAgICAKICAgICAgICBpZiB4IG9yIHkgb3Igd2lkdGggIT0gMTAwIG9yIGhlaWdodCAhPSA1MDogICMgQ8OzIMOtdCBuaOG6pXQgbeG7mXQgdGh14buZYyB0w61uaCBraMOhYyAwL2RlZmF1bHQKICAgICAgICAgICAgcmV0dXJuICh4LCB5LCB4ICsgd2lkdGgsIHkgKyBoZWlnaHQpCiAgICAgICAgCiAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogRWxlbWVudCBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4csIHPhu60gZOG7pW5nIHThu41hIMSR4buZIG3hurdjIMSR4buLbmgiKQogICAgICAgIHJldHVybiAoMCwgMCwgMTAwLCA1MCkgICMgRmFsbGJhY2sgYm91bmRzIG5o4buPCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jZW50ZXIoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IFR1cGxlW2ludCwgaW50XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB04buNYSDEkeG7mSB0cnVuZyB0w6JtIGPhu6dhIHBo4bqnbiB04butIHbhu5tpIHjhu60gbMO9IGzhu5dpIG7Dom5nIGNhbwogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICBwcmludCgiQ+G6o25oIGLDoW86IEVsZW1lbnQgbMOgIE5vbmUgaG/hurdjIHLhu5duZyIpCiAgICAgICAgICAgIHJldHVybiAoMCwgMCkKICAgICAgICAgICAgCiAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyhlbGVtZW50KQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBib3VuZHMgaOG7o3AgbOG7hwogICAgICAgIGlmIHgxID49IHgyIG9yIHkxID49IHkyOgogICAgICAgICAgICBib3VuZHNfc3RyID0gZWxlbWVudC5nZXQoImJvdW5kcyIsICIiKQogICAgICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBCb3VuZHMga2jDtG5nIGjhu6NwIGzhu4cgJ3tib3VuZHNfc3RyfSc6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hywgdHLhuqMgduG7gSB04buNYSDEkeG7mSBhbiB0b8OgbiDhu58gZ2nhu69hIG3DoG4gaMOsbmgKICAgICAgICAgICAgc2NyZWVuX3dpZHRoLCBzY3JlZW5faGVpZ2h0ID0gc2VsZi5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgICAgICBpZiBzY3JlZW5fd2lkdGggPiAwIGFuZCBzY3JlZW5faGVpZ2h0ID4gMDoKICAgICAgICAgICAgICAgIGNlbnRlcl94ID0gc2NyZWVuX3dpZHRoIC8vIDIKICAgICAgICAgICAgICAgIGNlbnRlcl95ID0gc2NyZWVuX2hlaWdodCAvLyAyCiAgICAgICAgICAgICAgICByZXR1cm4gKGNlbnRlcl94LCBjZW50ZXJfeSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiAoNTQwLCA5NjApICAjIFThu41hIMSR4buZIG3hurdjIMSR4buLbmggY2hvIG3DoG4gaMOsbmggMTA4MHgxOTIwCiAgICAgICAgCiAgICAgICAgY2VudGVyX3ggPSAoeDEgKyB4MikgLy8gMgogICAgICAgIGNlbnRlcl95ID0gKHkxICsgeTIpIC8vIDIKICAgICAgICAKICAgICAgICAjIFRow6ptIG3hu5l0IGNow7p0IHJhbmRvbSDEkeG7gyB0csOhbmggZGV0ZWN0aW9uICjCsTMgcGl4ZWxzKQogICAgICAgIGNlbnRlcl94ICs9IHJhbmRvbS5yYW5kaW50KC0zLCAzKQogICAgICAgIGNlbnRlcl95ICs9IHJhbmRvbS5yYW5kaW50KC0zLCAzKQogICAgICAgIAogICAgICAgICMgxJDhuqNtIGLhuqNvIHThu41hIMSR4buZIHRyb25nIHBo4bqhbSB2aSBtw6BuIGjDrG5oCiAgICAgICAgc2NyZWVuX3dpZHRoLCBzY3JlZW5faGVpZ2h0ID0gc2VsZi5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgIGlmIHNjcmVlbl93aWR0aCA+IDAgYW5kIHNjcmVlbl9oZWlnaHQgPiAwOgogICAgICAgICAgICBjZW50ZXJfeCA9IG1heCgxMCwgbWluKGNlbnRlcl94LCBzY3JlZW5fd2lkdGggLSAxMCkpICAjIE1hcmdpbiAxMHB4IHThu6sgYmnDqm4KICAgICAgICAgICAgY2VudGVyX3kgPSBtYXgoMTAsIG1pbihjZW50ZXJfeSwgc2NyZWVuX2hlaWdodCAtIDEwKSkKICAgICAgICAKICAgICAgICByZXR1cm4gKGNlbnRlcl94LCBjZW50ZXJfeSkKICAgIAogICAgZGVmIHRhcF9lbGVtZW50X2NlbnRlcihzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhuqFtIHbDoG8gcGjhuqduIHThu60gduG7m2kgdMOtbmggcmFuZG9tIChz4butIGThu6VuZyB0YXBfZWxlbWVudCBiw6puIHRyb25nKQogICAgICAgIE7hur91IGVsZW1lbnQgcXXDoSBuaOG7jyB0aMOsIG3hu5tpIGTDuW5nIGNlbnRlciwgbmfGsOG7o2MgbOG6oWkgc+G6vSB0YXAgcmFuZG9tCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIkVsZW1lbnQgbMOgIE5vbmUgaG/hurdjIHLhu5duZyJ9CiAgICAgICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHZpc2libGUtdG8tdXNlciB0csaw4bubYwogICAgICAgICAgICB2aXNpYmxlID0gZWxlbWVudC5nZXQoInZpc2libGUtdG8tdXNlciIsICJ0cnVlIikKICAgICAgICAgICAgaWYgdmlzaWJsZSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgcHJpbnQoIkPhuqNuaCBiw6FvOiBFbGVtZW50IGPDsyB2aXNpYmxlLXRvLXVzZXI9J2ZhbHNlJywgduG6q24gdGjhu60gdGFwLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgYm91bmRzIGPhu6dhIGVsZW1lbnQgxJHhu4Mga2nhu4NtIHRyYSBrw61jaCB0aMaw4bubYwogICAgICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IHNlbGYuZ2V0X2VsZW1lbnRfYm91bmRzKGVsZW1lbnQpCiAgICAgICAgICAgIHdpZHRoID0geDIgLSB4MQogICAgICAgICAgICBoZWlnaHQgPSB5MiAtIHkxCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGVsZW1lbnQgcXXDoSBuaOG7jyAoPCAyMHB4IHdpZHRoIGhv4bq3YyBoZWlnaHQpLCBkw7luZyBjZW50ZXIKICAgICAgICAgICAgaWYgd2lkdGggPCAyMCBvciBoZWlnaHQgPCAyMDoKICAgICAgICAgICAgICAgIHByaW50KGYiRWxlbWVudCBuaOG7jyAoe3dpZHRofXh7aGVpZ2h0fXB4KSwgc+G7rSBk4bulbmcgdGFwIGNlbnRlciIpCiAgICAgICAgICAgICAgICB4LCB5ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHThu41hIMSR4buZIGjhu6NwIGzhu4cKICAgICAgICAgICAgICAgIGlmIHggPD0gMCBhbmQgeSA8PSAwOgogICAgICAgICAgICAgICAgICAgIGJvdW5kc19zdHIgPSBlbGVtZW50LmdldCgiYm91bmRzIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgaWYgYm91bmRzX3N0ciBhbmQgYm91bmRzX3N0ciAhPSAiWzAsMF1bMCwwXSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcF9lbGVtZW50KGJvdW5kc19zdHIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiAiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCB04buNYSDEkeG7mSDEkeG7gyB0YXAifQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi50YXAoeCwgeSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRWxlbWVudCDEkeG7pyBs4bubbiwgc+G7rSBk4bulbmcgdGFwX2VsZW1lbnQgxJHhu4MgdGFwIHJhbmRvbQogICAgICAgICAgICAgICAgIyBwcmludChmIkVsZW1lbnQgxJHhu6cgbOG7m24gKHt3aWR0aH14e2hlaWdodH1weCksIHPhu60gZOG7pW5nIHRhcCByYW5kb20iKSAgIyBC4buPIGxvZyBuw6B5CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi50YXBfZWxlbWVudChlbGVtZW50KQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6IGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7c3RyKGUpfSJ9CiAgICAKICAgIGRlZiBsb25nX3ByZXNzKHNlbGYsIHg6IGludCwgeTogaW50LCBkdXJhdGlvbjogaW50ID0gMTAwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIGdp4buvIHThuqFpIHbhu4sgdHLDrSB4LHkgdHJvbmcgbeG7mXQga2hv4bqjbmcgdGjhu51pIGdpYW4KICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICJ4IjogeCwKICAgICAgICAgICAgInkiOiB5LAogICAgICAgICAgICAiZHVyYXRpb24iOiBkdXJhdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJsb25nX3ByZXNzIiwgcGFyYW1zPXBhcmFtcykKICAgIAogICAgZGVmIGxvbmdfcHJlc3NfZWxlbWVudChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSwgZHVyYXRpb246IGludCA9IDEwMDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBnaeG7ryB04bqhaSB0cnVuZyB0w6JtIGPhu6dhIHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgeCwgeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgcmV0dXJuIHNlbGYubG9uZ19wcmVzcyh4LCB5LCBkdXJhdGlvbikKICAgIAogICAgZGVmIHN3aXBlX2JldHdlZW5fZWxlbWVudHMoc2VsZiwgc3RhcnRfZWxlbWVudDogRGljdFtzdHIsIEFueV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRfZWxlbWVudDogRGljdFtzdHIsIEFueV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogaW50ID0gNTAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgdOG7qyBwaOG6p24gdOG7rSBzdGFydF9lbGVtZW50IMSR4bq/biBwaOG6p24gdOG7rSBlbmRfZWxlbWVudAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3gsIHN0YXJ0X3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihzdGFydF9lbGVtZW50KQogICAgICAgIGVuZF94LCBlbmRfeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVuZF9lbGVtZW50KQogICAgICAgIHJldHVybiBzZWxmLnN3aXBlKHN0YXJ0X3gsIHN0YXJ0X3ksIGVuZF94LCBlbmRfeSwgZHVyYXRpb24pCiAgICAKICAgIGRlZiB3YWl0X2Zvcl9lbGVtZW50X3RvX2Rpc2FwcGVhcihzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgdGltZW91dDogaW50ID0gMzAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbDogaW50ID0gMSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgbeG7mXQgcGjhuqduIHThu60gYmnhur9uIG3huqV0IGto4buPaSBtw6BuIGjDrG5oCiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgdGltZW91dDoKICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuZmluZF9lbGVtZW50KHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNvbnRhaW5zPWNvbnRhaW5zKQogICAgICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdGltZS5zbGVlcChjaGVja19pbnRlcnZhbCkKICAgICAgICAKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHdhaXRfZm9yX2FueV9lbGVtZW50KHNlbGYsIGVsZW1lbnRzX3RvX2ZpbmQ6IExpc3RbRGljdFtzdHIsIHN0cl1dLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogaW50ID0gMzAsIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIGLhuqV0IGvhu7MgcGjhuqduIHThu60gbsOgbyB0cm9uZyBkYW5oIHPDoWNoIHh14bqldCBoaeG7h24KICAgICAgICAKICAgICAgICBlbGVtZW50c190b19maW5kIGzDoCBkYW5oIHPDoWNoIGPDoWMgZGljdCB24bubaSBjw6FjIGtow7NhOiB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkCiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgdGltZW91dDoKICAgICAgICAgICAgZm9yIGVsZW1lbnRfY3JpdGVyaWEgaW4gZWxlbWVudHNfdG9fZmluZDoKICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmZpbmRfZWxlbWVudCgKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2NyaXRlcmlhLmdldCgidGV4dCIpLCAKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2NyaXRlcmlhLmdldCgiY29udGVudF9kZXNjIiksIAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfY3JpdGVyaWEuZ2V0KCJyZXNvdXJjZV9pZCIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiBlbGVtZW50OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdGltZS5zbGVlcChjaGVja19pbnRlcnZhbCkKICAgICAgICAKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZ2V0X3NjcmVlbl9zaXplKHNlbGYpIC0+IFR1cGxlW2ludCwgaW50XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBrw61jaCB0aMaw4bubYyBtw6BuIGjDrG5oICh3aWR0aCwgaGVpZ2h0KQogICAgICAgICIiIgogICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgIGlmIGRldmljZV9pbmZvWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgIHJldHVybiAoZGV2aWNlX2luZm9bImRhdGEiXVsic2NyZWVuX3dpZHRoIl0sIGRldmljZV9pbmZvWyJkYXRhIl1bInNjcmVlbl9oZWlnaHQiXSkKICAgICAgICByZXR1cm4gKDAsIDApCiAgICAKICAgIGRlZiB0YWtlX3NjcmVlbnNob3Qoc2VsZiwgZmlsZV9wYXRoOiBzdHIgPSBOb25lLCByZXNpemU6IGJvb2wgPSBGYWxzZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu6VwIOG6o25oIG3DoG4gaMOsbmggdsOgIGzGsHUgdsOgbyBmaWxlX3BhdGggKG7hur91IMSRxrDhu6NjIGN1bmcgY+G6pXApCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZmlsZV9wYXRoOiDEkMaw4budbmcgZOG6q24gZmlsZSDEkeG7gyBsxrB1IChvcHRpb25hbCkKICAgICAgICAgICAgcmVzaXplOiBUcnVlIMSR4buDIHJlc2l6ZSDhuqNuaCAob3B0aW9uYWwpCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0ge30KICAgICAgICBpZiBmaWxlX3BhdGg6CiAgICAgICAgICAgIHBhcmFtc1siZmlsZV9wYXRoIl0gPSBmaWxlX3BhdGgKICAgICAgICBpZiByZXNpemU6CiAgICAgICAgICAgIHBhcmFtc1sicmVzaXplIl0gPSAidHJ1ZSIKICAgICAgICAjIFPhu60gZOG7pW5nIHRpbWVvdXQgZMOgaSBoxqFuIGNobyBzY3JlZW5zaG90IHbDrCBs4bqnbiDEkeG6p3UgY8OzIHRo4buDIGNo4bqtbQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInNjcmVlbnNob3QiLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PTMwKQogICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfYWN0aXZpdHkoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHTDqm4gYWN0aXZpdHkgaGnhu4duIHThuqFpCiAgICAgICAgIiIiCiAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgaWYgZGV2aWNlX2luZm9bInN0YXR1cyJdID09ICJzdWNjZXNzIiBhbmQgImN1cnJlbnRfYWN0aXZpdHkiIGluIGRldmljZV9pbmZvWyJkYXRhIl06CiAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaW5mb1siZGF0YSJdWyJjdXJyZW50X2FjdGl2aXR5Il0KICAgICAgICByZXR1cm4gIiIKICAgIAogICAgZGVmIGdldF9jdXJyZW50X3BhY2thZ2Uoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHTDqm4gcGFja2FnZSBoaeG7h24gdOG6oWkKICAgICAgICAiIiIKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiY3VycmVudC1wYWNrYWdlIikKICAgICAgICBpZiByZXNwb25zZS5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIHJlc3BvbnNlOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXS5nZXQoInBhY2thZ2UiLCAiIikKICAgICAgICByZXR1cm4gIiIKICAgIAogICAgZGVmIHByZXNzX2VudGVyKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IEVudGVyIGLhurFuZyBBREIga2V5ZXZlbnQKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaOG7sWMgdGhpIEFEQiBrZXlldmVudCBFTlRFUiAoNjYpCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCAiaW5wdXQiLCAia2V5ZXZlbnQiLCAiNjYiXQogICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgIm1lc3NhZ2UiOiAixJDDoyBuaOG6pW4gRW50ZXIgYuG6sW5nIEFEQiJ9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIHbhu4EgQVBJIG7hur91IGtow7RuZyBjw7MgQURCCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19lbnRlciIpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5UaW1lb3V0RXhwaXJlZDoKICAgICAgICAgICAgcHJpbnQoIlRpbWVvdXQga2hpIGfhu61pIEFEQiBrZXlldmVudCBFbnRlciIpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2VudGVyIikKICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBBREIga2V5ZXZlbnQgRW50ZXI6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2VudGVyIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2jDtG5nIHjDoWMgxJHhu4tuaCBraGkgZ+G7rWkgQURCIGtleWV2ZW50IEVudGVyOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19lbnRlciIpCiAgICAKICAgIGRlZiBwcmVzc19iYWNrKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IEJhY2sKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19iYWNrIikKICAgIAogICAgZGVmIHByZXNzX2hvbWUoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgSG9tZQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2hvbWUiKQogICAgCiAgICBkZWYgcHJlc3NfcmVjZW50X2FwcHMoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgUmVjZW50IEFwcHMKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19yZWNlbnRfYXBwcyIpCgogICAgZGVmIGlzX2FwcF9pbnN0YWxsZWQoc2VsZiwgcGFja2FnZV9uYW1lOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIMSRw6MgxJHGsOG7o2MgY8OgaSDEkeG6t3QgdHLDqm4gdGhp4bq/dCBi4buLIGNoxrBhCiAgICAgICAgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGFja2FnZV9uYW1lOiBUw6puIHBhY2thZ2UgY+G7p2Eg4bupbmcgZOG7pW5nIGPhuqduIGtp4buDbSB0cmEKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDhu6luZyBk4bulbmcgxJHDoyBjw6BpIMSR4bq3dCwgRmFsc2UgbuG6v3UgY2jGsGEKICAgICAgICAiIiIKICAgICAgICAjIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEg4bupbmcgZOG7pW5nIGLhurFuZyBBREIKICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJzaGVsbCIsIGYicG0gbGlzdCBwYWNrYWdlcyB8IGdyZXAgLXggcGFja2FnZTp7cGFja2FnZV9uYW1lfSJdCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIGvhur90IHF14bqjLCDhu6luZyBk4bulbmcgxJHDoyDEkcaw4bujYyBjw6BpIMSR4bq3dAogICAgICAgICAgICAgICAgcmV0dXJuIHBhY2thZ2VfbmFtZSBpbiByZXN1bHQuc3Rkb3V0CiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvcjoKICAgICAgICAgICAgICAgICMgTuG6v3UgbOG7l2kgQURCLCBz4butIGThu6VuZyBBUEkgSFRUUAogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgSFRUUCBBUEkKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiaXNfaW5zdGFsbGVkIiwgeyJwYWNrYWdlIjogcGFja2FnZV9uYW1lfSkKICAgICAgICBpZiByZXNwb25zZVsic3RhdHVzIl0gPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXS5nZXQoImlzX2luc3RhbGxlZCIsIEZhbHNlKQogICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIGZpbmRfZWxlbWVudHMoc2VsZiwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwgdGV4dDogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgY29udGFpbnM6IGJvb2wgPSBGYWxzZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgcGjhuqduIHThu60gdGhlbyBjbGFzc19uYW1lLCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkIGhv4bq3YyB2aXNpYmxlLXRvLXVzZXIKICAgICAgICDEkMOieSBsw6AgbeG7mXQgcGjGsMahbmcgdGjhu6ljIHRp4buHbiBs4bujaSBr4bq/dCBo4bujcCBkdW1wX3NjcmVlbl94bWwgdsOgIGZpbmRfYWxsX2VsZW1lbnRzX2luX3htbAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgY29udGFpbnM6IEZhbHNlIMSR4buDIHTDrG0ga2nhur9tIGto4bubcCBjaMOtbmggeMOhYyAobeG6t2MgxJHhu4tuaCksIFRydWUgxJHhu4MgdMOsbSBraeG6v20gY2jhu6lhIHThu6sga2jDs2EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggY8OhYyBwaOG6p24gdOG7rSB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgICMgTOG6pXkgWE1MIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgZmluZF9hbGxfZWxlbWVudHNfaW5feG1sIMSR4buDIHTDrG0gY8OhYyBwaOG6p24gdOG7rQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgIHRleHQ9dGV4dCwgCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYz1jb250ZW50X2Rlc2MsIAogICAgICAgICAgICByZXNvdXJjZV9pZD1yZXNvdXJjZV9pZCwKICAgICAgICAgICAgY2xhc3NfbmFtZT1jbGFzc19uYW1lLAogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI9dmlzaWJsZV90b191c2VyLAogICAgICAgICAgICBjb250YWlucz1jb250YWlucwogICAgICAgICkKCiAgICBkZWYgb3Blbl91cmwoc2VsZiwgdXJsOiBzdHIsIHBhY2thZ2U6IHN0ciA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3hu58gbeG7mXQgVVJMIHRyw6puIHRoaeG6v3QgYuG7iy4gSOG7r3Ugw61jaCDEkeG7gyBt4bufIGPDoWMgbGluayBt4bqhbmcgeMOjIGjhu5lpIHRy4buxYyB0aeG6v3AuCiAgICAgICAgVHLGsOG7m2Mga2hpIG3hu58gbGluayBz4bq9IGLhuqVtIEhvbWUgdsOgIGNo4budIDItNSBnacOieS4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB1cmw6IFVSTCBj4bqnbiBt4bufICh2w60gZOG7pTogaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS91c2VybmFtZS8pCiAgICAgICAgICAgIHBhY2thZ2U6IFBhY2thZ2UgbmFtZSBj4bunYSDhu6luZyBk4bulbmcgxJHhu4MgbeG7nyBVUkwgKHTDuXkgY2jhu41uKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQsaw4bubYyAxOiBC4bqlbSBuw7p0IEhvbWUgdHLGsOG7m2MKICAgICAgICAgICAgcHJpbnQoIkLhuqVtIG7DunQgSG9tZSB0csaw4bubYyBraGkgbeG7nyBVUkwuLi4iKQogICAgICAgICAgICBzZWxmLnByZXNzX2hvbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDI6IENo4budIG5n4bqrdSBuaGnDqm4gMi01IGdpw6J5CiAgICAgICAgICAgIGltcG9ydCByYW5kb20KICAgICAgICAgICAgaW1wb3J0IHRpbWUKICAgICAgICAgICAgd2FpdF90aW1lID0gcmFuZG9tLnVuaWZvcm0oMiwgNSkKICAgICAgICAgICAgcHJpbnQoZiJDaOG7nSB7d2FpdF90aW1lOi4xZn1zIHRyxrDhu5tjIGtoaSBt4bufIFVSTC4uLiIpCiAgICAgICAgICAgIHRpbWUuc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDM6IFRp4bq/biBow6BuaCBt4bufIFVSTAogICAgICAgICAgICBwcmludChmIk3hu58gVVJMOiB7dXJsfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFVSTCBlbmNvZGUgxJHhu4MgdHLDoW5oIGzhu5dpIHbhu5tpIGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdAogICAgICAgICAgICAjIENo4buJIGVuY29kZSBwaOG6p24gc2F1IGRvbWFpbiDEkeG7gyBnaeG7ryBuZ3V5w6puIHByb3RvY29sIHbDoCBkb21haW4KICAgICAgICAgICAgaWYgJzovLycgaW4gdXJsOgogICAgICAgICAgICAgICAgcGFydHMgPSB1cmwuc3BsaXQoJzovLycsIDEpCiAgICAgICAgICAgICAgICBpZiBsZW4ocGFydHMpID09IDI6CiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2wgPSBwYXJ0c1swXQogICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZyA9IHBhcnRzWzFdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgJy8nIGluIHJlbWFpbmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluX3BhcnRzID0gcmVtYWluaW5nLnNwbGl0KCcvJywgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluID0gZG9tYWluX3BhcnRzWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBkb21haW5fcGFydHNbMV0KICAgICAgICAgICAgICAgICAgICAgICAgIyBFbmNvZGUgcGF0aCBwYXJ0LCBuaMawbmcgZ2nhu68gbmd1ecOqbiBjw6FjIGvDvSB04buxIGFuIHRvw6BuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZWRfcGF0aCA9IHF1b3RlKHBhdGgsIHNhZmU9Jy9AOj8jW10hJCZcJygpKissOz0nKQogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3VybCA9IGYie3Byb3RvY29sfTovL3tkb21haW59L3tlbmNvZGVkX3BhdGh9IgogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZWRfdXJsID0gdXJsICAjIENo4buJIGPDsyBkb21haW4sIGtow7RuZyBj4bqnbiBlbmNvZGUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZW5jb2RlZF91cmwgPSB1cmwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgS2jDtG5nIGPDsyBwcm90b2NvbCwgZW5jb2RlIHRvw6BuIGLhu5kKICAgICAgICAgICAgICAgIGVuY29kZWRfdXJsID0gcXVvdGUodXJsLCBzYWZlPScvQDo/I1tdISQmXCcoKSorLDs9JykKICAgICAgICAgICAgCiAgICAgICAgICAgIHBhcmFtcyA9IHsidXJsIjogZW5jb2RlZF91cmx9CiAgICAgICAgICAgIGlmIHBhY2thZ2U6CiAgICAgICAgICAgICAgICBwYXJhbXNbInBhY2thZ2UiXSA9IHBhY2thZ2UKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgib3Blbl91cmwiLCBwYXJhbXM9cGFyYW1zKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGVuY29kZSBVUkw6IHtlfSIpCiAgICAgICAgICAgICMgRmFsbGJhY2s6IGfhu61pIFVSTCBn4buRYyBu4bq/dSBjw7MgbOG7l2kgZW5jb2RlCiAgICAgICAgICAgIHBhcmFtcyA9IHsidXJsIjogdXJsfQogICAgICAgICAgICBpZiBwYWNrYWdlOgogICAgICAgICAgICAgICAgcGFyYW1zWyJwYWNrYWdlIl0gPSBwYWNrYWdlCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoIm9wZW5fdXJsIiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgZ2V0X2NsaXBib2FyZChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgbuG7mWkgZHVuZyBjbGlwYm9hcmQgdOG7qyB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IE7hu5lpIGR1bmcgY2xpcGJvYXJkIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSBraMO0bmcgY8OzIG7hu5lpIGR1bmcKICAgICAgICAiIiIKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiY2xpcGJvYXJkIikKICAgICAgICBpZiByZXNwb25zZS5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgcmVzcG9uc2UuZ2V0KCJkYXRhIiwge30pLmdldCgiaGFzX2NvbnRlbnQiKToKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJkYXRhIl1bImNsaXBib2FyZF90ZXh0Il0KICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgc3dpcGVfbGVmdChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgc2FuZyB0csOhaSAodOG7kWkgxrB1IGNobyBuZ8OzbiBjw6FpIHRheSBwaOG6o2kpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGVfbGVmdCIpCgogICAgZGVmIHN3aXBlX3JpZ2h0KHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCBzYW5nIHBo4bqjaSAodOG7kWkgxrB1IGNobyBuZ8OzbiBjw6FpIHRheSBwaOG6o2kpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGVfcmlnaHQiKQoKICAgIGRlZiBzZXR1cF9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgY2hvIHBoacOqbiBsw6BtIHZp4buHYwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgduG7m2kgY8OhYyB0csaw4budbmc6CiAgICAgICAgICAgICAgICAtIGlkOiBJRCBj4bunYSBwcm94eQogICAgICAgICAgICAgICAgLSB0eXBlOiBMb+G6oWkgcHJveHkgKHBwb2UsIGh0dHAsIHNvY2tzNSwgZXRjLikKICAgICAgICAgICAgICAgIC0gaG9zdDogxJDhu4thIGNo4buJIHNlcnZlciBwcm94eQogICAgICAgICAgICAgICAgLSBwb3J0OiBQb3J0IGPhu6dhIHByb3h5CiAgICAgICAgICAgICAgICAtIHVzZXJuYW1lOiBVc2VybmFtZSAobuG6v3UgY8OzKQogICAgICAgICAgICAgICAgLSBwYXNzd29yZDogUGFzc3dvcmQgKG7hur91IGPDsykKICAgICAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGhp4bq/dCBs4bqtcCB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJveHlfdHlwZSA9IHByb3h5X2NvbmZpZy5nZXQoInR5cGUiLCAiIikubG93ZXIoKQogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHByb3h5X3R5cGUgPT0gInBwb2UiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NldHVwX3Bwb2VfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbGlmIHByb3h5X3R5cGUgaW4gWyJodHRwIiwgImh0dHBzIl06CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fc2V0dXBfaHR0cF9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSA9PSAic29ja3M1IjoKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZXR1cF9zb2NrczVfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJMb+G6oWkgcHJveHkga2jDtG5nIMSRxrDhu6NjIGjhu5cgdHLhu6M6IHtwcm94eV90eXBlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9zZXR1cF9wcG9lX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBQUFBvRQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgUFBQb0UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaG9zdCA9IHByb3h5X2NvbmZpZy5nZXQoInNlcnZlcl9pcCIpCiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgicHJveHlfaWQiKQogICAgICAgICAgICBwcm94eV9uYW1lID0gcHJveHlfY29uZmlnLmdldCgibmFtZSIpCiAgICAgICAgICAgIGlmIG5vdCBob3N0OgogICAgICAgICAgICAgICAgcHJpbnQoIlRoaeG6v3UgdGjDtG5nIHRpbiBob3N0IGNobyBwcm94eSBQUFBvRSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSSByZWdpc3RlciB0csaw4bubYwogICAgICAgICAgICByZWdpc3Rlcl91cmwgPSBmImh0dHA6Ly97aG9zdH0vcmVnaXN0ZXIiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgZGV2aWNlIGluZm8KICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgIGxvY2FsX2lwID0gIiIKICAgICAgICAgICAgaWYgZGV2aWNlX2luZm8uZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiBkZXZpY2VfaW5mbzoKICAgICAgICAgICAgICAgIGxvY2FsX2lwID0gZGV2aWNlX2luZm9bImRhdGEiXS5nZXQoImxvY2FsX2lwIiwgIiIpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZWdpc3Rlcl9kYXRhID0geyJuYW1lIjogcHJveHlfbmFtZX0KICAgICAgICAgICAgICAgIGlmIGxvY2FsX2lwOgogICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyX2RhdGFbImxvY2FsX2lwIl0gPSBsb2NhbF9pcAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVnaXN0ZXJfcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyX3VybCwgCiAgICAgICAgICAgICAgICAgICAganNvbj1yZWdpc3Rlcl9kYXRhLCAKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwgCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgcmVnaXN0ZXJfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyDEkcSDbmcga8O9IHRow6BuaCBjw7RuZyB24bubaSBwcm94eSBQUFBvRSBzZXJ2ZXI6IHtob3N0fSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIMSRxINuZyBrw70gduG7m2kgcHJveHkgUFBQb0Ugc2VydmVyOiB7cmVnaXN0ZXJfcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIMSR4bq/biBwcm94eSBQUFBvRSBzZXJ2ZXIge2hvc3R9OiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBSZXNldCBJUCBwcm94eQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRoaeG6v3QgbOG6rXAgcHJveHkgUFBQb0U6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfc2V0dXBfaHR0cF9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgSFRUUC9IVFRQUwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgSFRUUAogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4buRaSB24bubaSBIVFRQIHByb3h5LCBjaOG7iSBj4bqnbiByZXNldCBJUAogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRoaeG6v3QgbOG6rXAgcHJveHkgSFRUUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9zZXR1cF9zb2NrczVfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaGnhur90IGzhuq1wIHByb3h5IFNPQ0tTNQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgU09DS1M1CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhu5FpIHbhu5tpIFNPQ0tTNSBwcm94eSwgY2jhu4kgY+G6p24gcmVzZXQgSVAKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Jlc2V0X3Byb3h5X2lwKHByb3h5X2NvbmZpZykKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aGnhur90IGzhuq1wIHByb3h5IFNPQ0tTNToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9yZXNldF9wcm94eV9pcChzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFJlc2V0IElQIHByb3h5IChsb2dpYyBjxakgxJHGsOG7o2MgY2h1eeG7g24gdsOgbyDEkcOieSkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTG9naWMgcmVzZXQgSVAgcHJveHkgc+G6vSDEkcaw4bujYyBpbXBsZW1lbnQgdMO5eSB0aGVvIGxv4bqhaSBwcm94eQogICAgICAgICAgICAjIEhp4buHbiB04bqhaSByZXR1cm4gVHJ1ZSDEkeG7gyBraMO0bmcgYmxvY2sgd29ya2Zsb3cKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJpZCIpCiAgICAgICAgICAgIHByb3h5X3R5cGUgPSBwcm94eV9jb25maWcuZ2V0KCJ0eXBlIiwgInVua25vd24iKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoZiJSZXNldCBJUCBjaG8gcHJveHkge3Byb3h5X2lkfSAodHlwZToge3Byb3h5X3R5cGV9KSIpCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSBjw7MgdGjDtG5nIHRpbiByZXNldCBJUAogICAgICAgICAgICByZXNldF9pcF9saW5rID0gcHJveHlfY29uZmlnLmdldCgibGlua19yZXNldF9pcCIpCiAgICAgICAgICAgIHBwb2VfbmFtZSA9IHByb3h5X2NvbmZpZy5nZXQoInBwb2VfbmFtZSIpCgogICAgICAgICAgICBpZiByZXNldF9pcF9saW5rIGFuZCBwcG9lX25hbWU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyBH4butaSBQT1NUIHJlcXVlc3QgxJHhu4MgcmVzZXQgSVAKICAgICAgICAgICAgICAgICAgICByZXNldF9kYXRhID0geyJwcG9lX25hbWUiOiBwcG9lX25hbWV9CiAgICAgICAgICAgICAgICAgICAgcmVzZXRfcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgICAgICByZXNldF9pcF9saW5rLCAKICAgICAgICAgICAgICAgICAgICAgICAganNvbj1yZXNldF9kYXRhLCAKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sIAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIHJlc2V0X3Jlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIHJlc2V0IElQIHRow6BuaCBjw7RuZyBjaG8gcHJveHkge3Bwb2VfbmFtZX0iKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHJlc2V0IElQOiBIVFRQIHtyZXNldF9yZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGfhu61pIHJlcXVlc3QgcmVzZXQgSVA6IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludCgiVGhp4bq/dSB0aMO0bmcgdGluIGxpbmtfcmVzZXRfaXAgaG/hurdjIHByb3h5X25hbWUiKQogICAgICAgICAgICAjIFRPRE86IEltcGxlbWVudCBsb2dpYyByZXNldCBJUCBj4bulIHRo4buDIGNobyB04burbmcgbG/huqFpIHByb3h5CiAgICAgICAgICAgICMgVsOtIGThu6U6IGfhu41pIEFQSSByZXNldCBJUCwgaG/hurdjIHRo4buxYyBoaeG7h24gY8OhYyBs4buHbmggY+G6p24gdGhp4bq/dAogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSByZXNldCBJUCBwcm94eToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIHJlc2V0X3Byb3h5X2lwKHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUGjGsMahbmcgdGjhu6ljIHB1YmxpYyDEkeG7gyByZXNldCBJUCBwcm94eSAoxJHhu4MgdMawxqFuZyB0aMOtY2ggduG7m2kgY29kZSBjxakpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX3Jlc2V0X3Byb3h5X2lwKHByb3h5X2NvbmZpZykKCiAgICBkZWYgdW5yZWdpc3Rlcl9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IHNhdSBraGkgc+G7rSBk4bulbmcgeG9uZwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgKHTDuXkgY2jhu41uLCBjw7MgdGjhu4MgbOG6pXkgdOG7qyBkYXRhYmFzZSBu4bq/dSBraMO0bmcgdHJ1eeG7gW4pCiAgICAgICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGjhu6d5IMSRxINuZyBrw70gdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHRydXnhu4FuIHByb3h5X2NvbmZpZywgY8OzIHRo4buDIGzhuqV5IHThu6sgZGF0YWJhc2UgaG/hurdjIGNvbnRleHQgaGnhu4duIHThuqFpCiAgICAgICAgICAgIGlmIG5vdCBwcm94eV9jb25maWc6CiAgICAgICAgICAgICAgICBwcmludCgiS2jDtG5nIGPDsyBwcm94eSBjb25maWcgxJHhu4MgdW5yZWdpc3RlciIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBDb2kgbmjGsCB0aMOgbmggY8O0bmcgbuG6v3Uga2jDtG5nIGPDsyBnw6wgxJHhu4MgdW5yZWdpc3RlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHByb3h5X3R5cGUgPSBwcm94eV9jb25maWcuZ2V0KCJ0eXBlIiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJpZCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwcm94eV90eXBlID09ICJwcG9lIjoKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl91bnJlZ2lzdGVyX3Bwb2VfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbGlmIHByb3h5X3R5cGUgaW4gWyJodHRwIiwgImh0dHBzIl06CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdW5yZWdpc3Rlcl9odHRwX3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxpZiBwcm94eV90eXBlID09ICJzb2NrczUiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3VucmVnaXN0ZXJfc29ja3M1X3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiTG/huqFpIHByb3h5IGtow7RuZyBj4bqnbiB1bnJlZ2lzdGVyIGhv4bq3YyBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7ozoge3Byb3h5X3R5cGV9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGjhu6d5IMSRxINuZyBrw70gcHJveHk6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfdW5yZWdpc3Rlcl9wcG9lX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgSOG7p3kgxJHEg25nIGvDvSBwcm94eSBQUFBvRQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgUFBQb0UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaG9zdCA9IHByb3h5X2NvbmZpZy5nZXQoInNlcnZlcl9pcCIpCiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgicHJveHlfaWQiKQogICAgICAgICAgICBwcm94eV9uYW1lID0gcHJveHlfY29uZmlnLmdldCgibmFtZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgaG9zdDoKICAgICAgICAgICAgICAgIHByaW50KCJUaGnhur91IHRow7RuZyB0aW4gaG9zdCBjaG8gcHJveHkgUFBQb0UsIGLhu48gcXVhIHVucmVnaXN0ZXIiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSSB1bnJlZ2lzdGVyCiAgICAgICAgICAgIHVucmVnaXN0ZXJfdXJsID0gZiJodHRwOi8ve2hvc3R9L3VucmVnaXN0ZXIiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgZGV2aWNlIGluZm8KICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgIGxvY2FsX2lwID0gIiIKICAgICAgICAgICAgaWYgZGV2aWNlX2luZm8uZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiBkZXZpY2VfaW5mbzoKICAgICAgICAgICAgICAgIGxvY2FsX2lwID0gZGV2aWNlX2luZm9bImRhdGEiXS5nZXQoImxvY2FsX2lwIiwgIiIpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyX2RhdGEgPSB7Im5hbWUiOiBwcm94eV9uYW1lfQogICAgICAgICAgICAgICAgaWYgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl9kYXRhWyJsb2NhbF9pcCJdID0gbG9jYWxfaXAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJfcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJfdXJsLCAKICAgICAgICAgICAgICAgICAgICBqc29uPXVucmVnaXN0ZXJfZGF0YSwgCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sIAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIHVucmVnaXN0ZXJfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyBo4buneSDEkcSDbmcga8O9IHRow6BuaCBjw7RuZyB24bubaSBwcm94eSBQUFBvRSBzZXJ2ZXI6IHtob3N0fSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSB24bubaSBwcm94eSBQUFBvRSBzZXJ2ZXI6IHt1bnJlZ2lzdGVyX3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIktow7RuZyB0aOG7gyBr4bq/dCBu4buRaSDEkeG6v24gcHJveHkgUFBQb0Ugc2VydmVyIHtob3N0fSDEkeG7gyB1bnJlZ2lzdGVyOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGjhu6d5IMSRxINuZyBrw70gcHJveHkgUFBQb0U6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfdW5yZWdpc3Rlcl9odHRwX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgSOG7p3kgxJHEg25nIGvDvSBwcm94eSBIVFRQL0hUVFBTCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBIVFRQCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgSFRUUCBwcm94eSB0aMaw4budbmcga2jDtG5nIGPhuqduIHVucmVnaXN0ZXIgxJHhurdjIGJp4buHdAogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgcHJpbnQoZiJI4buneSDEkcSDbmcga8O9IHByb3h5IEhUVFAge3Byb3h5X2lkfSAoa2jDtG5nIGPhuqduIHRoYW8gdMOhYyDEkeG6t2MgYmnhu4d0KSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eSBIVFRQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3VucmVnaXN0ZXJfc29ja3M1X3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgSOG7p3kgxJHEg25nIGvDvSBwcm94eSBTT0NLUzUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IFNPQ0tTNQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFNPQ0tTNSBwcm94eSB0aMaw4budbmcga2jDtG5nIGPhuqduIHVucmVnaXN0ZXIgxJHhurdjIGJp4buHdAogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgcHJpbnQoZiJI4buneSDEkcSDbmcga8O9IHByb3h5IFNPQ0tTNSB7cHJveHlfaWR9IChraMO0bmcgY+G6p24gdGhhbyB0w6FjIMSR4bq3YyBiaeG7h3QpIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHByb3h5IFNPQ0tTNToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGRlYnVnX2VsZW1lbnRfYm91bmRzKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIERlYnVnIHRow7RuZyB0aW4gYm91bmRzIGPhu6dhIGVsZW1lbnQgxJHhu4Mga2nhu4NtIHRyYSB4ZW0gY8OzIHRhcCDEkcaw4bujYyBraMO0bmcKICAgICAgICAiIiIKICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgcHJpbnQoIkRFQlVHOiBFbGVtZW50IGlzIE5vbmUgb3IgZW1wdHkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgcHJpbnQoIj09PSBERUJVRyBFTEVNRU5UIEJPVU5EUyA9PT0iKQogICAgICAgIGJvdW5kc19zdHIgPSBlbGVtZW50LmdldCgiYm91bmRzIiwgIiIpCiAgICAgICAgcHJpbnQoZiJPcmlnaW5hbCBib3VuZHMgc3RyaW5nOiAne2JvdW5kc19zdHJ9JyIpCiAgICAgICAgCiAgICAgICAgIyBUZXN0IGdldF9lbGVtZW50X2JvdW5kcwogICAgICAgIHgxLCB5MSwgeDIsIHkyID0gc2VsZi5nZXRfZWxlbWVudF9ib3VuZHMoZWxlbWVudCkKICAgICAgICBwcmludChmIlBhcnNlZCBib3VuZHM6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgCiAgICAgICAgIyBUZXN0IGdldF9lbGVtZW50X2NlbnRlcgogICAgICAgIGNlbnRlcl94LCBjZW50ZXJfeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgcHJpbnQoZiJDYWxjdWxhdGVkIGNlbnRlcjogKHtjZW50ZXJfeH0sIHtjZW50ZXJfeX0pIikKICAgICAgICAKICAgICAgICAjIFRlc3QgduG7m2kgdsOtIGThu6UgY+G7pSB0aOG7gwogICAgICAgIHByaW50KCJcbi0tLSBUZXN0aW5nIHdpdGggZXhhbXBsZSBib3VuZHMgWzM2LDBdWzg0LC0zMF0gLS0tIikKICAgICAgICB0ZXN0X2VsZW1lbnQgPSB7ImJvdW5kcyI6ICJbMzYsMF1bODQsLTMwXSIsICJjb250ZW50LWRlc2MiOiAiVMOsbSBraeG6v20ifQogICAgICAgIAogICAgICAgIHRlc3RfeDEsIHRlc3RfeTEsIHRlc3RfeDIsIHRlc3RfeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyh0ZXN0X2VsZW1lbnQpCiAgICAgICAgcHJpbnQoZiJUZXN0IHBhcnNlZCBib3VuZHM6ICh7dGVzdF94MX0sIHt0ZXN0X3kxfSwge3Rlc3RfeDJ9LCB7dGVzdF95Mn0pIikKICAgICAgICAKICAgICAgICB0ZXN0X2NlbnRlcl94LCB0ZXN0X2NlbnRlcl95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIodGVzdF9lbGVtZW50KQogICAgICAgIHByaW50KGYiVGVzdCBjYWxjdWxhdGVkIGNlbnRlcjogKHt0ZXN0X2NlbnRlcl94fSwge3Rlc3RfY2VudGVyX3l9KSIpCiAgICAgICAgCiAgICAgICAgIyBUZXN0IHRhcF9lbGVtZW50CiAgICAgICAgcHJpbnQoIlxuLS0tIFRlc3RpbmcgdGFwX2VsZW1lbnQgLS0tIikKICAgICAgICByZXN1bHQgPSBzZWxmLnRhcF9lbGVtZW50KHRlc3RfZWxlbWVudCkKICAgICAgICBwcmludChmIlRhcCByZXN1bHQ6IHtyZXN1bHR9IikKICAgICAgICAKICAgICAgICBwcmludCgiPT09IEVORCBERUJVRyA9PT0iKQoKICAgIGRlZiBkb3dubG9hZF9pbWFnZShzZWxmLCBzZXJ2ZXI6IHN0ciA9ICJodHRwOi8vaW1nLmRuZHZpbmEuY29tIiwgY291bnQ6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVOG6o2kg4bqjbmggdOG7qyBzZXJ2ZXIgduG7gSB0aGnhur90IGLhu4sgdGjDtG5nIHF1YSBoZWxwZXIgc2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHNlcnZlcjogU2VydmVyIMSR4buLYSBjaOG7iSAobuG6v3UgTm9uZSB0aMOsIMSR4buNYyB04burIGNvbmZpZyBkYiwgbeG6t2MgxJHhu4tuaCAiaHR0cDovL2ltZy5kbmR2aW5hLmNvbSIpCiAgICAgICAgICAgIGNvdW50OiBT4buRIGzGsOG7o25nIOG6o25oIGPhuqduIHThuqNpICht4bq3YyDEkeG7i25oIDEpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdOG6o2kgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgc2VydmVyIHThu6sgZGF0YWJhc2UgbuG6v3Uga2jDtG5nIHRydXnhu4FuIHbDoG8KICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIHNlcnZlciBjw7MgcHJvdG9jb2wKICAgICAgICAgICAgaWYgbm90IHNlcnZlci5zdGFydHN3aXRoKCgiaHR0cDovLyIsICJodHRwczovLyIpKToKICAgICAgICAgICAgICAgIHNlcnZlciA9IGYiaHR0cDovL3tzZXJ2ZXJ9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyBYw6J5IGThu7FuZyBVUkwgZOG7sWEgdHLDqm4gc+G7kSBsxrDhu6NuZyDhuqNuaAogICAgICAgICAgICBpZiBjb3VudCA9PSAxOgogICAgICAgICAgICAgICAgIyBUcsaw4budbmcgaOG7o3AgdOG6o2kgMSDhuqNuaCAtIHPhu60gZOG7pW5nIGVuZHBvaW50IHJhbmRvbS1hdmF0YXIKICAgICAgICAgICAgICAgIGltYWdlX3VybCA9IGYie3NlcnZlcn0vcmFuZG9tLWF2YXRhciIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVHLGsOG7nW5nIGjhu6NwIHThuqNpIG5oaeG7gXUg4bqjbmggLSBz4butIGThu6VuZyBlbmRwb2ludCBnZXQtc2ltaWxhci1pbWFnZXMKICAgICAgICAgICAgICAgIGltYWdlX3VybCA9IGYie3NlcnZlcn0vZ2V0LXNpbWlsYXItaW1hZ2VzP2NvdW50PXtjb3VudH0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFPhu60gZOG7pW5nIF9tYWtlX3JlcXVlc3QgxJHhu4MgdOG6rW4gZOG7pW5nIGPGoSBjaOG6vyByZXRyeSB2w6AgZXJyb3IgaGFuZGxpbmcgY8OzIHPhurVuCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuX21ha2VfcmVxdWVzdCgiZG93bmxvYWQtaW1hZ2UiLCBwYXJhbXM9eyJ1cmwiOiBpbWFnZV91cmx9KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBY4butIGzDvSByZXNwb25zZSBmb3JtYXQgdGjhu7FjIHThur8KICAgICAgICAgICAgIyBSZXNwb25zZTogeyJkYXRhIjogeyJzdWNjZXNzIjogdHJ1ZSwgIm1lc3NhZ2UiOiAiLi4uIiwgImRhdGEiOiB7Li4ufX0sICJtZXNzYWdlIjogIi4uLiIsICJzdGF0dXMiOiAic3VjY2VzcyJ9CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmVzdWx0LCBkaWN0KSBhbmQgcmVzdWx0LmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGRhdGEuc3VjY2VzcyB2w6AgZGF0YS5tZXNzYWdlCiAgICAgICAgICAgICAgICBkYXRhX3NlY3Rpb24gPSByZXN1bHQuZ2V0KCJkYXRhIiwge30pCiAgICAgICAgICAgICAgICBzdWNjZXNzID0gZGF0YV9zZWN0aW9uLmdldCgic3VjY2VzcyIsIEZhbHNlKQogICAgICAgICAgICAgICAgbWVzc2FnZSA9IGRhdGFfc2VjdGlvbi5nZXQoIm1lc3NhZ2UiLCAiIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MgYW5kICJ0aMOgbmggY8O0bmciIGluIG1lc3NhZ2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHThuqNpIOG6o25oOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiMgVGVzdCBmdW5jdGlvbiBmb3IgdGhlIHByb2JsZW1hdGljIGVsZW1lbnQKZGVmIHRlc3RfcHJvYmxlbWF0aWNfZWxlbWVudCgpOgogICAgIiIiCiAgICBUZXN0IGZ1bmN0aW9uIMSR4buDIGtp4buDbSB0cmEgZWxlbWVudCBjw7MgYm91bmRzIMOibQogICAgIiIiCiAgICBoZWxwZXIgPSBIZWxwZXJTZXJ2aWNlKCkKICAgIAogICAgIyBFbGVtZW50IHThu6sgdsOtIGThu6UgY+G7p2EgdXNlcgogICAgcHJvYmxlbWF0aWNfZWxlbWVudCA9IHsKICAgICAgICAiY2xhc3MiOiAiYW5kcm9pZC53aWRnZXQuSW1hZ2VWaWV3IiwKICAgICAgICAicGFja2FnZSI6ICJjb20uc3MuYW5kcm9pZC51Z2MudHJpbGwiLCAKICAgICAgICAicmVzb3VyY2UtaWQiOiAiY29tLnNzLmFuZHJvaWQudWdjLnRyaWxsOmlkL2RlbCIsCiAgICAgICAgInRleHQiOiAibnVsbCIsCiAgICAgICAgImNvbnRlbnQtZGVzYyI6ICJUw6xtIGtp4bq/bSIsCiAgICAgICAgImJvdW5kcyI6ICJbMzYsMF1bODQsLTMwXSIsCiAgICAgICAgImNsaWNrYWJsZSI6ICJmYWxzZSIsCiAgICAgICAgImVuYWJsZWQiOiAidHJ1ZSIsCiAgICAgICAgInZpc2libGUtdG8tdXNlciI6ICJmYWxzZSIKICAgIH0KICAgIAogICAgcHJpbnQoIlRlc3RpbmcgcHJvYmxlbWF0aWMgZWxlbWVudCB3aXRoIGJvdW5kcyBbMzYsMF1bODQsLTMwXSIpCiAgICBoZWxwZXIuZGVidWdfZWxlbWVudF9ib3VuZHMocHJvYmxlbWF0aWNfZWxlbWVudCkKICAgIAogICAgcHJpbnQoIlxuVHJ5aW5nIHRvIHRhcCB0aGUgZWxlbWVudC4uLiIpCiAgICByZXN1bHQgPSBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2JsZW1hdGljX2VsZW1lbnQpCiAgICBwcmludChmIkZpbmFsIHRhcCByZXN1bHQ6IHtyZXN1bHR9IikKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICB0ZXN0X3Byb2JsZW1hdGljX2VsZW1lbnQoKQogICAgCiAgICAjIFbDrSBk4bulIHPhu60gZOG7pW5nCiAgICBoZWxwZXIgPSBIZWxwZXJTZXJ2aWNlKCkKICAgIAogICAgIyBM4bqleSBrw61jaCB0aMaw4bubYyBtw6BuIGjDrG5oCiAgICB3aWR0aCwgaGVpZ2h0ID0gaGVscGVyLmdldF9zY3JlZW5fc2l6ZSgpCiAgICBwcmludChmIkvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmg6IHt3aWR0aH14e2hlaWdodH0iKQogICAgCiAgICAjIE3hu58gVGlrVG9rCiAgICBoZWxwZXIub3Blbl9hcHAoImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbCIpCiAgICAKICAgICMgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG7DunQgIlRyYW5nIGNo4bunIiBob+G6t2MgbsO6dCAiS2jDoW0gcGjDoSIgeHXhuqV0IGhp4buHbgogICAgZWxlbWVudHNfdG9fZmluZCA9IFsKICAgICAgICB7ImNvbnRlbnRfZGVzYyI6ICJUcmFuZyBjaOG7pyJ9LAogICAgICAgIHsiY29udGVudF9kZXNjIjogIktow6FtIHBow6EifQogICAgXQogICAgCiAgICBlbGVtZW50ID0gaGVscGVyLndhaXRfZm9yX2FueV9lbGVtZW50KGVsZW1lbnRzX3RvX2ZpbmQpCiAgICAKICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgcHJpbnQoZiLEkMOjIHTDrG0gdGjhuqV5IHBo4bqnbiB04butOiB7aGVscGVyLmdldF9lbGVtZW50X2NvbnRlbnRfZGVzYyhlbGVtZW50KX0iKQogICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIktow7RuZyB0w6xtIHRo4bqleSBwaOG6p24gdOG7rSBuw6BvIHNhdSB0aOG7nWkgZ2lhbiBjaOG7nSIp').decode('utf-8'))
