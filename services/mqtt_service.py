import base64
exec(base64.b64decode('aW1wb3J0IHBhaG8ubXF0dC5jbGllbnQgYXMgbXF0dAppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCB1dWlkCmltcG9ydCBvcwpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBMaXN0LCBPcHRpb25hbCwgQ2FsbGFibGUsIFVuaW9uCmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCgojIExvZ2dlcgpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJNUVRUU2VydmljZSIpCgpjbGFzcyBNUVRUU2VydmljZToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9zZXJ2aWNlLCBkZXZpY2VfaWQsIGhlbHBlcl9zZXJ2aWNlPU5vbmUpOgogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgc2VsZi5kZXZpY2VfaWQgPSBkZXZpY2VfaWQKICAgICAgICBzZWxmLmhlbHBlcl9zZXJ2aWNlID0gaGVscGVyX3NlcnZpY2UKICAgICAgICAjIEto4bufaSB04bqhbyBjbGllbnQgduG7m2kgSUQgZHV5IG5o4bqldAogICAgICAgIHNlbGYuY2xpZW50X2lkID0gZiJ7Y29uZmlnLk1RVFRfQ0xJRU5UX0lEX1BSRUZJWH1fe3N0cih1dWlkLnV1aWQ0KCkpWzo4XX0iCiAgICAgICAgCiAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIGvhur90IG7hu5FpIHThu6sgY29uZmlnCiAgICAgICAgc2VsZi5icm9rZXJfdXJsID0gY29uZmlnLk1RVFRfU0VSVkVSU1tjb25maWcuTU9ERV0KICAgICAgICAjIFBow6JuIHTDrWNoIFVSTAogICAgICAgIHNlbGYuYnJva2VyX2FkZHJlc3MgPSBzZWxmLmJyb2tlcl91cmwucmVwbGFjZSgibXF0dDovLyIsICIiKS5zcGxpdCgiOiIpWzBdCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmJyb2tlcl9wb3J0ID0gaW50KHNlbGYuYnJva2VyX3VybC5zcGxpdCgiOiIpWy0xXSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHNlbGYuYnJva2VyX3BvcnQgPSAxODgzICAjIFBvcnQgbeG6t2MgxJHhu4tuaAoKICAgICAgICAjIFRow7RuZyB0aW4geMOhYyB0aOG7sWMKICAgICAgICBzZWxmLnVzZXJuYW1lID0gY29uZmlnLk1RVFRfVVNFUk5BTUUKICAgICAgICBzZWxmLnBhc3N3b3JkID0gY29uZmlnLk1RVFRfUEFTU1dPUkQKICAgICAgICAKICAgICAgICAjIFRy4bqhbmcgdGjDoWkga+G6v3QgbuG7kWkKICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5jbGllbnQgPSBOb25lCiAgICAgICAgc2VsZi5kZXZpY2VfaWQgPSBzZWxmLl9nZXRfZGV2aWNlX2lkKCkKICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIHJlY29ubmVjdAogICAgICAgIHNlbGYucmVjb25uZWN0X2RlbGF5ID0gY29uZmlnLk1RVFRfUkVDT05ORUNUX0RFTEFZCiAgICAgICAgc2VsZi5tYXhfcmVjb25uZWN0X2RlbGF5ID0gY29uZmlnLk1RVFRfTUFYX1JFQ09OTkVDVF9ERUxBWQogICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ID0gMAogICAgICAgIAogICAgICAgICMgTVFUVCB0b3BpY3MKICAgICAgICBzZWxmLnRvcGljX2NsaWVudF9zeW5jID0gY29uZmlnLk1RVFRfVE9QSUNfQ0xJRU5UX1NZTkMKICAgICAgICBzZWxmLnRvcGljX3NlcnZlcl90YXNrID0gZiJ7Y29uZmlnLk1RVFRfVE9QSUNfU0VSVkVSX1RBU0tfUFJFRklYfS97c2VsZi5kZXZpY2VfaWR9IgogICAgICAgIAogICAgICAgICMgxJDEg25nIGvDvSBoYW5kbGVycyB44butIGzDvSB0YXNrIHThu6sgc2VydmVyCiAgICAgICAgc2VsZi50YXNrX2hhbmRsZXJzID0ge30KICAgICAgICAKICAgICAgICAjIFRocmVhZCBjaG8gdmnhu4djIMSR4buTbmcgYuG7mSB2w6AgeOG7rSBsw70KICAgICAgICBzZWxmLnN5bmNfdGhyZWFkID0gTm9uZQogICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgc2VsZi5zdG9wX2V2ZW50ID0gdGhyZWFkaW5nLkV2ZW50KCkKICAgICAgICAjIEzhuqV5IHN5bmNfaW50ZXJ2YWwgdOG7qyBj4bqldSBow6xuaCB0aGnhur90IGLhu4ssIG7hur91IGtow7RuZyBjw7MgdGjDrCBz4butIGThu6VuZyBnacOhIHRy4buLIG3hurdjIMSR4buLbmgKICAgICAgICBzZWxmLnN5bmNfaW50ZXJ2YWwgPSBzZWxmLmRiLmdldF9kZXZpY2VfY29uZmlnKCJzeW5jX2ludGVydmFsIiwgY29uZmlnLlNZTkNfSU5URVJWQUwpICAjIGdpw6J5CiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIG3DtGkgdHLGsOG7nW5nIFRlcm11eAogICAgICAgIHNlbGYuaXNfdGVybXV4ID0gJ1RFUk1VWF9WRVJTSU9OJyBpbiBvcy5lbnZpcm9uIG9yICcvZGF0YS9kYXRhL2NvbS50ZXJtdXgnIGluIG9zLmVudmlyb24uZ2V0KCdQQVRIJywgJycpCiAgICAgICAgaWYgc2VsZi5pc190ZXJtdXg6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkGFuZyBjaOG6oXkgdHJvbmcgbcO0aSB0csaw4budbmcgVGVybXV4IikKICAgICAgICAKICAgIGRlZiBfZ2V0X2RldmljZV9pZChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiTOG6pXkgZGV2aWNlX2lkIGPhu6dhIHRoaeG6v3QgYuG7iyBoaeG7h24gdOG6oWkiIiIKICAgICAgICByZXR1cm4gc2VsZi5kYi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgCiAgICBkZWYgY29ubmVjdChzZWxmKSAtPiBib29sOgogICAgICAgICIiIkvhur90IG7hu5FpIMSR4bq/biBNUVRUIGJyb2tlciB2w6AgY2jhu50gY2hvIMSR4bq/biBraGkga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBzdG9wX2V2ZW50IMSRxrDhu6NjIHJlc2V0CiAgICAgICAgICAgIHNlbGYuc3RvcF9ldmVudC5jbGVhcigpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIGNsaWVudCBNUVRUIG3hu5tpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgVGjhu60gc+G7rSBk4bulbmcgQVBJIHYyIHRyxrDhu5tjCiAgICAgICAgICAgICAgICBzZWxmLmNsaWVudCA9IG1xdHQuQ2xpZW50KAogICAgICAgICAgICAgICAgICAgIGNsaWVudF9pZD1zZWxmLmNsaWVudF9pZCwgCiAgICAgICAgICAgICAgICAgICAgY2xlYW5fc2Vzc2lvbj1UcnVlLCAKICAgICAgICAgICAgICAgICAgICBwcm90b2NvbD1tcXR0Lk1RVFR2MzExLAogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrX2FwaV92ZXJzaW9uPW1xdHQuQ2FsbGJhY2tBUElWZXJzaW9uLlZFUlNJT04yCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiU+G7rSBk4bulbmcgTVFUVCBBUEkgdjIiKQogICAgICAgICAgICBleGNlcHQgKEF0dHJpYnV0ZUVycm9yLCBUeXBlRXJyb3IpOgogICAgICAgICAgICAgICAgIyBGYWxsYmFjayB24buBIEFQSSB2MSBu4bq/dSBjw7MgbOG7l2kKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJT4butIGThu6VuZyBNUVRUIEFQSSB2MSIpCiAgICAgICAgICAgICAgICBzZWxmLmNsaWVudCA9IG1xdHQuQ2xpZW50KHNlbGYuY2xpZW50X2lkLCBjbGVhbl9zZXNzaW9uPVRydWUsIHByb3RvY29sPW1xdHQuTVFUVHYzMTEpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bq3dCBjYWxsYmFjayBoYW5kbGVycwogICAgICAgICAgICBzZWxmLmNsaWVudC5vbl9jb25uZWN0ID0gc2VsZi5fb25fY29ubmVjdAogICAgICAgICAgICBzZWxmLmNsaWVudC5vbl9tZXNzYWdlID0gc2VsZi5fb25fbWVzc2FnZQogICAgICAgICAgICBzZWxmLmNsaWVudC5vbl9kaXNjb25uZWN0ID0gc2VsZi5fb25fZGlzY29ubmVjdAogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6t3QgdXNlcm5hbWUgdsOgIHBhc3N3b3JkIG7hur91IGPDswogICAgICAgICAgICBpZiBzZWxmLnVzZXJuYW1lIGFuZCBzZWxmLnBhc3N3b3JkOgogICAgICAgICAgICAgICAgc2VsZi5jbGllbnQudXNlcm5hbWVfcHdfc2V0KHNlbGYudXNlcm5hbWUsIHNlbGYucGFzc3dvcmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRoaeG6v3QgbOG6rXAgdOG7sSDEkeG7mW5nIGvhur90IG7hu5FpIGzhuqFpCiAgICAgICAgICAgICMgxJDhurd0IGdpw6EgdHLhu4sgbMOgIEZhbHNlIMSR4buDIHThu7EgeOG7rSBsw70gdmnhu4djIGvhur90IG7hu5FpIGzhuqFpCiAgICAgICAgICAgIHNlbGYuY2xpZW50LnJlY29ubmVjdF9kZWxheV9zZXQobWluX2RlbGF5PTEsIG1heF9kZWxheT02MCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS+G6v3QgbuG7kWkgxJHhur9uIGJyb2tlcgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGvhur90IG7hu5FpIHThu5tpIE1RVFQgYnJva2VyIHtzZWxmLmJyb2tlcl9hZGRyZXNzfTp7c2VsZi5icm9rZXJfcG9ydH0iKQogICAgICAgICAgICBzZWxmLmNsaWVudC5jb25uZWN0X2FzeW5jKHNlbGYuYnJva2VyX2FkZHJlc3MsIHNlbGYuYnJva2VyX3BvcnQsIGtlZXBhbGl2ZT02MCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgbG9vcCB0cm9uZyB0aHJlYWQgcmnDqm5nCiAgICAgICAgICAgIHNlbGYuY2xpZW50Lmxvb3Bfc3RhcnQoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaOG7nSBjaG8gxJHhur9uIGtoaSBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcgaG/hurdjIGPDsyB5w6p1IGPhuqd1IGThu6tuZwogICAgICAgICAgICByZXRyeV9jb3VudCA9IDAKICAgICAgICAgICAgd2hpbGUgbm90IHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgaWYgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIG5o4bqtbiB5w6p1IGPhuqd1IGThu6tuZywgaOG7p3kga+G6v3QgbuG7kWkgTVFUVCIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5jbGllbnQubG9vcF9zdG9wKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICAgICAgcmV0cnlfY291bnQgKz0gMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIExvZyB0aMO0bmcgYsOhbyBt4buXaSA1IGdpw6J5CiAgICAgICAgICAgICAgICBpZiByZXRyeV9jb3VudCAlIDUgPT0gMDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGNo4budIGvhur90IG7hu5FpIE1RVFQgKMSRw6MgdGjhu60ge3JldHJ5X2NvdW50fSBnacOieSkuLi4iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IHNhdSA2MCBnacOieSB24bqrbiBraMO0bmcga+G6v3QgbuG7kWkgxJHGsOG7o2MsIHRo4butIGvhur90IG7hu5FpIGzhuqFpCiAgICAgICAgICAgICAgICBpZiByZXRyeV9jb3VudCA+PSA2MCBhbmQgbm90IHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJUaOG7nWkgZ2lhbiBjaOG7nSBr4bq/dCBu4buRaSBxdcOhIGzDonUsIHRo4butIGvhur90IG7hu5FpIGzhuqFpLi4uIikKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgROG7q25nIGNsaWVudCBoaeG7h24gdOG6oWkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jbGllbnQubG9vcF9zdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu60ga+G6v3QgbuG7kWkgbOG6oWkgdOG7qyDEkeG6p3UKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlRo4butIGvhur90IG7hu5FpIGzhuqFpIE1RVFQgYnJva2VyLi4uIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jbGllbnQucmVjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnlfY291bnQgPSAwCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyByZWNvbm5lY3RfZXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB0aOG7rSBr4bq/dCBu4buRaSBs4bqhaToge3N0cihyZWNvbm5lY3RfZXJyb3IpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcgxJHhur9uIE1RVFQgYnJva2VyIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBr4bq/dCBu4buRaSBNUVRUOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICMgTuG6v3UgY8OzIGzhu5dpIGtoaSBr4bq/dCBu4buRaSwgdGjhu60ga+G6v3QgbuG7kWkgbOG6oWkKICAgICAgICAgICAgc2VsZi5faGFuZGxlX3JlY29ubmVjdCgpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2hhbmRsZV9yZWNvbm5lY3Qoc2VsZik6CiAgICAgICAgIiIiWOG7rSBsw70ga+G6v3QgbuG7kWkgbOG6oWkga2hpIG3huqV0IGvhur90IG7hu5FpIiIiCiAgICAgICAgaWYgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpOgogICAgICAgICAgICByZXR1cm4gICMgS2jDtG5nIGvhur90IG7hu5FpIGzhuqFpIG7hur91IMSRw6MgecOqdSBj4bqndSBk4burbmcKICAgICAgICAgICAgCiAgICAgICAgIyBUw61uaCB0b8OhbiB0aOG7nWkgZ2lhbiBjaOG7nSB0csaw4bubYyBraGkga+G6v3QgbuG7kWkgbOG6oWkKICAgICAgICBkZWxheSA9IG1pbihzZWxmLnJlY29ubmVjdF9kZWxheSAqICgyICoqIHNlbGYucmVjb25uZWN0X2NvdW50KSwgc2VsZi5tYXhfcmVjb25uZWN0X2RlbGF5KQogICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ICs9IDEKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmIlRo4butIGvhur90IG7hu5FpIGzhuqFpIHNhdSB7ZGVsYXl9IGdpw6J5Li4uIikKICAgICAgICB0aW1lLnNsZWVwKGRlbGF5KQogICAgICAgIAogICAgICAgICMgVGjhu60ga+G6v3QgbuG7kWkgbOG6oWkKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLmNvbm5lY3QoKQogICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgIyBH4butaSB0aMO0bmcgYsOhbyBr4bq/dCBu4buRaSBzYXUga2hpIGvhur90IG7hu5FpIGzhuqFpIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2Nvbm5lY3Rfbm90aWZpY2F0aW9uKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGvhur90IG7hu5FpIGzhuqFpOiB7c3RyKGUpfSIpCiAgICAKICAgIGRlZiBfb25fY29ubmVjdChzZWxmLCBjbGllbnQsIHVzZXJkYXRhLCBmbGFncywgcmMsIHByb3BlcnRpZXM9Tm9uZSk6CiAgICAgICAgIiIiQ2FsbGJhY2sga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZyAoaOG7lyB0cuG7oyBj4bqjIEFQSSB2MSB2w6AgdjIpIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiByYyA9PSAwOgogICAgICAgICAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBUcnVlCiAgICAgICAgICAgICAgICBzZWxmLnJlY29ubmVjdF9jb3VudCA9IDAgICMgUmVzZXQgcmVjb25uZWN0IGNvdW50ZXIKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZyB04bubaSBNUVRUIGJyb2tlciIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgxJDEg25nIGvDvSBuaOG6rW4gdGFzayB04burIHNlcnZlcgogICAgICAgICAgICAgICAgc2VsZi5jbGllbnQuc3Vic2NyaWJlKHNlbGYudG9waWNfc2VydmVyX3Rhc2ssIHFvcz0xKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMSRxINuZyBrw70gbmjhuq1uIHRhc2sgdOG6oWk6IHtzZWxmLnRvcGljX3NlcnZlcl90YXNrfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgR+G7rWkgdGjDtG5nIGLDoW8ga+G6v3QgbuG7kWkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9jb25uZWN0X25vdGlmaWNhdGlvbigpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJL4bq/dCBu4buRaSBNUVRUIHRo4bqldCBi4bqhaSB24bubaSBtw6MgbOG7l2k6IHtyY30iKQogICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX3JlY29ubmVjdCgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB0cm9uZyBjYWxsYmFjayBfb25fY29ubmVjdDoge3N0cihlKX0iKQogICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYuX2hhbmRsZV9yZWNvbm5lY3QoKQogICAgCiAgICBkZWYgX29uX21lc3NhZ2Uoc2VsZiwgY2xpZW50LCB1c2VyZGF0YSwgbXNnLCBwcm9wZXJ0aWVzPU5vbmUpOgogICAgICAgICIiIkNhbGxiYWNrIGtoaSBuaOG6rW4gxJHGsOG7o2MgdGluIG5o4bqvbiAoaOG7lyB0cuG7oyBj4bqjIEFQSSB2MSB2w6AgdjIpIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5o4bqtbiB0aW4gbmjhuq9uIHRyw6puIGvDqm5oIHttc2cudG9waWN9IikKICAgICAgICAgICAgcGF5bG9hZCA9IGpzb24ubG9hZHMobXNnLnBheWxvYWQuZGVjb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBY4butIGzDvSB0aMO0bmcgYsOhbyB04burIHNlcnZlcgogICAgICAgICAgICBpZiBtc2cudG9waWMgPT0gc2VsZi50b3BpY19zZXJ2ZXJfdGFzazoKICAgICAgICAgICAgICAgIHNlbGYuX2hhbmRsZV9zZXJ2ZXJfdGFzayhwYXlsb2FkKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgeOG7rSBsw70gdGluIG5o4bqvbiBNUVRUOiB7c3RyKGUpfSIpCiAgICAKICAgIGRlZiBfb25fZGlzY29ubmVjdChzZWxmLCBjbGllbnQsIHVzZXJkYXRhLCByYywgcHJvcGVydGllcz1Ob25lLCByZWFzb25fY29kZT1Ob25lLCAqKmt3YXJncyk6CiAgICAgICAgIiIiQ2FsbGJhY2sga2hpIG5n4bqvdCBr4bq/dCBu4buRaSAoaOG7lyB0cuG7oyBj4bqjIEFQSSB2MSB2w6AgdjIpIiIiCiAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIGlmIHJjICE9IDA6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTmfhuq90IGvhur90IG7hu5FpIE1RVFQga2jDtG5nIG1vbmcgbXXhu5FuIHbhu5tpIG3DoyBs4buXaToge3JjfSIpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnN0b3BfZXZlbnQuaXNfc2V0KCk6CiAgICAgICAgICAgICAgICBzZWxmLl9oYW5kbGVfcmVjb25uZWN0KCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBuZ+G6r3Qga+G6v3QgbuG7kWkgTVFUVCIpCiAgICAKICAgIGRlZiBfaGFuZGxlX3NlcnZlcl90YXNrKHNlbGYsIHBheWxvYWQpOgogICAgICAgICIiIljhu60gbMO9IHRhc2sgdOG7qyBzZXJ2ZXIiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRhc2tfdHlwZSA9IHBheWxvYWQuZ2V0KCJ0YXNrX3R5cGUiKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gdGFzayB04burIHNlcnZlcjoge3Rhc2tfdHlwZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBoYW5kbGVyIHTGsMahbmcg4bupbmcgbuG6v3UgxJHDoyDEkcSDbmcga8O9CiAgICAgICAgICAgIGlmIHRhc2tfdHlwZSBpbiBzZWxmLnRhc2tfaGFuZGxlcnM6CiAgICAgICAgICAgICAgICBzZWxmLnRhc2tfaGFuZGxlcnNbdGFza190eXBlXShwYXlsb2FkKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgaGFuZGxlciBjaG8gdGFza190eXBlOiB7dGFza190eXBlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHjhu60gbMO9IHRhc2sgdOG7qyBzZXJ2ZXI6IHtzdHIoZSl9IikKICAgIAogICAgZGVmIHJlZ2lzdGVyX3Rhc2tfaGFuZGxlcihzZWxmLCB0YXNrX3R5cGU6IHN0ciwgaGFuZGxlcjogQ2FsbGFibGUpOgogICAgICAgICIiIgogICAgICAgIMSQxINuZyBrw70gaGFuZGxlciBjaG8gbG/huqFpIHRhc2sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX3R5cGU6IExv4bqhaSB0YXNrCiAgICAgICAgICAgIGhhbmRsZXI6IEjDoG0geOG7rSBsw70gdGFzawogICAgICAgICIiIgogICAgICAgIHNlbGYudGFza19oYW5kbGVyc1t0YXNrX3R5cGVdID0gaGFuZGxlcgogICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDEkcSDbmcga8O9IGhhbmRsZXIgY2hvIHRhc2sge3Rhc2tfdHlwZX0iKQogICAgCiAgICBkZWYgc3luY19kYXRhKHNlbGYpOgogICAgICAgICIiIsSQ4buTbmcgYuG7mSBk4buvIGxp4buHdSB24bubaSBzZXJ2ZXIiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTuG6v3UgY2jGsGEga+G6v3QgbuG7kWkgTVFUVCwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mQogICAgICAgICAgICBpZiBub3Qgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ2jGsGEga+G6v3QgbuG7kWkgTVFUVCwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGhlbHBlciBzZXJ2aWNlCiAgICAgICAgICAgIGhlbHBlciA9IHNlbGYuaGVscGVyX3NlcnZpY2UKICAgICAgICAgICAgaWYgbm90IGhlbHBlcjoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIGPDsyBoZWxwZXIgc2VydmljZSwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZAogICAgICAgICAgICBkZXZpY2VfaWQgPSBzZWxmLmRiLmdldF9vcl9jcmVhdGVfZGV2aWNlX2lkKCkKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pZDoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCBkZXZpY2VfaWQsIGtow7RuZyB0aOG7gyDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IE5vbmUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGV2aWNlX2luZm9fcmVzcG9uc2UgPSBoZWxwZXIuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBs4bqleSB0aMOgbmggY8O0bmcsIGzGsHUgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICAgICAgaWYgZGV2aWNlX2luZm9fcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvX3Jlc3BvbnNlOgogICAgICAgICAgICAgICAgICAgICMgTMawdSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iyB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zYXZlX2RldmljZV9pbmZvKGRldmljZV9pbmZvX3Jlc3BvbnNlWyJkYXRhIl0pCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBkZXZpY2VfaW5mb19yZXNwb25zZVsiZGF0YSJdCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBs4bqleSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7izoge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYyB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iywgc+G7rSBk4bulbmcgdGjDtG5nIHRpbiDEkcOjIGzGsHUgdHJvbmcgZGF0YWJhc2UKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmRiLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgdGjDtG5nIHRpbiB0aGnhur90IGLhu4ssIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSBjw7MgdGjhu4Mga2jDtG5nIMSR4bqneSDEkeG7pyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAgICAgZGV2aWNlX2NvbmZpZyA9IHNlbGYuZGIuZ2V0X2FsbF9kZXZpY2VfY29uZmlnKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTG/huqFpIGLhu48gZ29saWtlX3JlcG9ydCBraOG7j2kgZGV2aWNlX2NvbmZpZyDEkeG7gyBn4butaSByacOqbmcKICAgICAgICAgICAgZ29saWtlX3JlcG9ydCA9IE5vbmUKICAgICAgICAgICAgaWYgImdvbGlrZV9yZXBvcnQiIGluIGRldmljZV9jb25maWc6CiAgICAgICAgICAgICAgICBnb2xpa2VfcmVwb3J0ID0gZGV2aWNlX2NvbmZpZy5wb3AoImdvbGlrZV9yZXBvcnQiKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgdMOhY2ggZ29saWtlX3JlcG9ydCBraOG7j2kgZGV2aWNlX2NvbmZpZyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIGdvbGlrZV9hcGlfYmFzZSBraOG7j2kgZGV2aWNlX2NvbmZpZwogICAgICAgICAgICBpZiAiZ29saWtlX2FwaV9iYXNlIiBpbiBkZXZpY2VfY29uZmlnOgogICAgICAgICAgICAgICAgZGV2aWNlX2NvbmZpZy5wb3AoImdvbGlrZV9hcGlfYmFzZSIpCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIsSQw6MgbG/huqFpIGLhu48gZ29saWtlX2FwaV9iYXNlIGto4buPaSBk4buvIGxp4buHdSDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgY8OhYyB0w6BpIGtob+G6o24gY2jGsGEgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIHBlbmRpbmdfYWNjb3VudHMgPSBzZWxmLmRiLmdldF9wZW5kaW5nX3N5bmNfaXRlbXMoImFjY291bnRzIiwgbGltaXQ9NTApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGPDoWMgam9iIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICAgICBwZW5kaW5nX2pvYnMgPSBzZWxmLmRiLmdldF9wZW5kaW5nX3N5bmNfaXRlbXMoImpvYnNfaGlzdG9yeSIsIGxpbWl0PTUwKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6oW8gcGF5bG9hZAogICAgICAgICAgICBwYXlsb2FkID0gewogICAgICAgICAgICAgICAgImRldmljZV9pZCI6IGRldmljZV9pZCwKICAgICAgICAgICAgICAgICJkZXZpY2VfaW5mbyI6IGRldmljZV9pbmZvLAogICAgICAgICAgICAgICAgImRldmljZV9jb25maWciOiBkZXZpY2VfY29uZmlnLAogICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBnb2xpa2VfcmVwb3J0IG7hur91IGPDswogICAgICAgICAgICBpZiBnb2xpa2VfcmVwb3J0OgogICAgICAgICAgICAgICAgcGF5bG9hZFsiZ29saWtlX3JlcG9ydCJdID0gZ29saWtlX3JlcG9ydAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mSBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgcGVuZGluZ19hY2NvdW50czoKICAgICAgICAgICAgICAgIHBheWxvYWRbImFjY291bnRzIl0gPSBwZW5kaW5nX2FjY291bnRzCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQ4buTbmcgYuG7mSB7bGVuKHBlbmRpbmdfYWNjb3VudHMpfSB0w6BpIGtob+G6o24gY2jGsGEgxJHhu5NuZyBi4buZIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGpvYiBjaMawYSDEkeG7k25nIGLhu5kgbuG6v3UgY8OzCiAgICAgICAgICAgIGlmIHBlbmRpbmdfam9iczoKICAgICAgICAgICAgICAgIHBheWxvYWRbImpvYnMiXSA9IHBlbmRpbmdfam9icwogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkOG7k25nIGLhu5kge2xlbihwZW5kaW5nX2pvYnMpfSBqb2IgY2jGsGEgxJHhu5NuZyBi4buZIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu61pIGThu68gbGnhu4d1CiAgICAgICAgICAgIHNlbGYuY2xpZW50LnB1Ymxpc2goY29uZmlnLk1RVFRfVE9QSUNfQ0xJRU5UX1NZTkMsIGpzb24uZHVtcHMocGF5bG9hZCkpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UgduG7m2kgc2VydmVyLCB0aW1lc3RhbXA6IHtwYXlsb2FkWyd0aW1lc3RhbXAnXX0iKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UgduG7m2kgc2VydmVyIikKICAgIAogICAgZGVmIHN0YXJ0X3N5bmNfdGhyZWFkKHNlbGYpOgogICAgICAgICIiIkLhuq90IMSR4bqndSB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIiIgogICAgICAgIGlmIHNlbGYuc3luY190aHJlYWQgaXMgbm90IE5vbmUgYW5kIHNlbGYuc3luY190aHJlYWQuaXNfYWxpdmUoKToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIlRocmVhZCDEkeG7k25nIGLhu5kgxJHDoyDEkWFuZyBjaOG6oXkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgc2VsZi5ydW5uaW5nID0gVHJ1ZQogICAgICAgIHNlbGYuc3RvcF9ldmVudC5jbGVhcigpCiAgICAgICAgc2VsZi5zeW5jX3RocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PXNlbGYuX3N5bmNfbG9vcCwgZGFlbW9uPVRydWUpCiAgICAgICAgc2VsZi5zeW5jX3RocmVhZC5zdGFydCgpCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga2jhu59pIMSR4buZbmcgdGhyZWFkIMSR4buTbmcgYuG7mSB04buxIMSR4buZbmciKQogICAgCiAgICBkZWYgX3N5bmNfbG9vcChzZWxmKToKICAgICAgICAiIiJMb29wIMSR4buTbmcgYuG7mSB04buxIMSR4buZbmciIiIKICAgICAgICBsb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIG3hu5dpIHtzZWxmLnN5bmNfaW50ZXJ2YWx9IGdpw6J5IikKICAgICAgICAKICAgICAgICAjIEJp4bq/biDEkeG7gyB0aGVvIGTDtWkgdHLhuqFuZyB0aMOhaSBr4bq/dCBu4buRaSB0csaw4bubYyDEkcOzCiAgICAgICAgd2FzX2Nvbm5lY3RlZCA9IHNlbGYuaXNfY29ubmVjdGVkCiAgICAgICAgCiAgICAgICAgd2hpbGUgbm90IHNlbGYuc3RvcF9ldmVudC5pc19zZXQoKSBhbmQgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEga+G6v3QgbuG7kWkKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmlzX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiTVFUVCBraMO0bmcga+G6v3QgbuG7kWksIMSRYW5nIHRo4butIGvhur90IG7hu5FpIGzhuqFpLi4uIikKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5jb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGvhur90IG7hu5FpIGzhuqFpIHRow6BuaCBjw7RuZyBzYXUga2hpIG3huqV0IGvhur90IG7hu5FpCiAgICAgICAgICAgICAgICAgICAgaWYgc3VjY2VzcyBhbmQgbm90IHdhc19jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGvhur90IG7hu5FpIGzhuqFpIE1RVFQgc2F1IGtoaSBt4bqldCBr4bq/dCBu4buRaSIpCiAgICAgICAgICAgICAgICAgICAgICAgICMgR+G7rWkgdGjDtG5nIGLDoW8ga+G6v3QgbuG7kWkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2Nvbm5lY3Rfbm90aWZpY2F0aW9uKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSBr4bq/dCBu4buRaSB0csaw4bubYyDEkcOzCiAgICAgICAgICAgICAgICB3YXNfY29ubmVjdGVkID0gc2VsZi5pc19jb25uZWN0ZWQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zeW5jX2RhdGEoKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB0cm9uZyBxdcOhIHRyw6xuaCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOZ2jhu4kgxJHhur9uIGzhuqduIMSR4buTbmcgYuG7mSB0aeG6v3AgdGhlbwogICAgICAgICAgICBmb3IgXyBpbiByYW5nZShzZWxmLnN5bmNfaW50ZXJ2YWwpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpIG9yIG5vdCBzZWxmLnJ1bm5pbmc6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgIAogICAgZGVmIHN0b3Bfc3luY190aHJlYWQoc2VsZik6CiAgICAgICAgIiIiROG7q25nIHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIiIiCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBzZWxmLnN0b3BfZXZlbnQuc2V0KCkKICAgICAgICBpZiBzZWxmLnN5bmNfdGhyZWFkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLnN5bmNfdGhyZWFkLmpvaW4odGltZW91dD0yLjApCiAgICAgICAgICAgIHNlbGYuc3luY190aHJlYWQgPSBOb25lCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgZOG7q25nIHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIikKICAgIAogICAgZGVmIGRpc2Nvbm5lY3Qoc2VsZik6CiAgICAgICAgIiIiTmfhuq90IGvhur90IG7hu5FpIE1RVFQiIiIKICAgICAgICBzZWxmLnN0b3Bfc3luY190aHJlYWQoKQogICAgICAgIAogICAgICAgIGlmIHNlbGYuY2xpZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLmNsaWVudC5sb29wX3N0b3AoKQogICAgICAgICAgICBzZWxmLmNsaWVudC5kaXNjb25uZWN0KCkKICAgICAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBuZ+G6r3Qga+G6v3QgbuG7kWkgTVFUVCIpCiAgICAKICAgIGRlZiBzZXR1cF9tcXR0X2hhbmRsZXJzKHNlbGYpOgogICAgICAgICIiIlRoaeG6v3QgbOG6rXAgY8OhYyBoYW5kbGVyIGNobyBNUVRUIHRhc2tzIiIiCiAgICAgICAgIyDEkMSDbmcga8O9IGPDoWMgdGFzayBoYW5kbGVyIG3hurdjIMSR4buLbmgKICAgICAgICBzZWxmLnJlZ2lzdGVyX3Rhc2tfaGFuZGxlcigidXBkYXRlX2RldmljZV9jb25maWciLCBzZWxmLl9oYW5kbGVfdXBkYXRlX2RldmljZV9jb25maWcpCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoInVwZGF0ZV9zeW5jZWQiLCBzZWxmLl9oYW5kbGVfdXBkYXRlX3N5bmNlZCkKICAgICAgICBzZWxmLnJlZ2lzdGVyX3Rhc2tfaGFuZGxlcigiYWNjb3VudF91cGRhdGUiLCBzZWxmLl9oYW5kbGVfYWNjb3VudF91cGRhdGUpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgdGhp4bq/dCBs4bqtcCBjw6FjIE1RVFQgdGFzayBoYW5kbGVyIikKICAgICAgICAKICAgIGRlZiBfaGFuZGxlX3VwZGF0ZV9kZXZpY2VfY29uZmlnKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza19kYXRhOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2dnZXIuaW5mbygiTmjhuq1uIHnDqnUgY+G6p3UgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyB04burIHNlcnZlciIpCiAgICAgICAgICAgIGNvbmZpZ19kYXRhID0gdGFza19kYXRhLmdldCgiY29uZmlnX2RhdGEiLCB7fSkKICAgICAgICAgICAgaWYgbm90IGNvbmZpZ19kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkThu68gbGnhu4d1IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyBy4buXbmciKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgdOG7q25nIGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5kYi5zYXZlX2RldmljZV9jb25maWcoY29uZmlnX2RhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4s6IHsnLCAnLmpvaW4oY29uZmlnX2RhdGEua2V5cygpKX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBzeW5jX2ludGVydmFsIG7hur91IG7DsyB0aGF5IMSR4buVaQogICAgICAgICAgICAgICAgaWYgInN5bmNfaW50ZXJ2YWwiIGluIGNvbmZpZ19kYXRhOgogICAgICAgICAgICAgICAgICAgIG5ld19zeW5jX2ludGVydmFsID0gY29uZmlnX2RhdGFbInN5bmNfaW50ZXJ2YWwiXQogICAgICAgICAgICAgICAgICAgIGlmIG5ld19zeW5jX2ludGVydmFsICE9IHNlbGYuc3luY19pbnRlcnZhbDoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJD4bqtcCBuaOG6rXQgc3luY19pbnRlcnZhbCB04burIHtzZWxmLnN5bmNfaW50ZXJ2YWx9IHRow6BuaCB7bmV3X3N5bmNfaW50ZXJ2YWx9IikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zeW5jX2ludGVydmFsID0gbmV3X3N5bmNfaW50ZXJ2YWwKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgbOG6oWkgdGhyZWFkIMSR4buTbmcgYuG7mSBu4bq/dSDEkWFuZyBjaOG6oXkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5zeW5jX3RocmVhZCBpcyBub3QgTm9uZSBhbmQgc2VsZi5zeW5jX3RocmVhZC5pc19hbGl2ZSgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkto4bufaSDEkeG7mW5nIGzhuqFpIHRocmVhZCDEkeG7k25nIGLhu5kgduG7m2kga2hv4bqjbmcgdGjhu51pIGdpYW4gbeG7m2kiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zdG9wX3N5bmNfdGhyZWFkKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3RhcnRfc3luY190aHJlYWQoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFRow7RuZyBiw6FvIGNobyBKb2JTZXJ2aWNlIG7hur91IGPDsyB0aGF5IMSR4buVaSBsacOqbiBxdWFuIMSR4bq/biBqb2JzCiAgICAgICAgICAgICAgICBqb2JfcmVsYXRlZF9rZXlzID0gWyJtYXhfam9ic19wZXJfZGF5IiwgIm1heF9qb2JzX3Blcl9zZXNzaW9uIiwgImpvYl9pbnRlcnZhbF9zZWNvbmRzIl0KICAgICAgICAgICAgICAgIGlmIGFueShrZXkgaW4gY29uZmlnX2RhdGEgZm9yIGtleSBpbiBqb2JfcmVsYXRlZF9rZXlzKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiw4FwIGThu6VuZyBj4bqldSBow6xuaCBt4bubaSBjaG8gSm9iU2VydmljZSIpCiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgY+G6p24ga2jhu59pIMSR4buZbmcgbOG6oWksIEpvYlNlcnZpY2Ugc+G6vSBs4bqleSBj4bqldSBow6xuaCBt4bubaSBraGkgY+G6p24KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4siKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHjhu60gbMO9IGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4s6IHtzdHIoZSl9IikKCiAgICBkZWYgX2hhbmRsZV91cGRhdGVfc3luY2VkKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX2RhdGE6IEThu68gbGnhu4d1IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJOaOG6rW4gecOqdSBj4bqndSBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kgdOG7qyBzZXJ2ZXIiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIMSRw6MgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIGlmICJhY2NvdW50cyIgaW4gZGF0YSBhbmQgaXNpbnN0YW5jZShkYXRhWyJhY2NvdW50cyJdLCBsaXN0KToKICAgICAgICAgICAgICAgIGZvciBhY2NvdW50X3V1aWQgaW4gZGF0YVsiYWNjb3VudHMiXToKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLm1hcmtfYXNfc3luY2VkKCJhY2NvdW50cyIsIGFjY291bnRfdXVpZCkKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIMSRw6MgxJHhu5NuZyBi4buZOiB7YWNjb3VudF91dWlkfSIpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHtsZW4oZGF0YVsnYWNjb3VudHMnXSl9IHTDoGkga2hv4bqjbiDEkcOjIMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQw6FuaCBk4bqldSBqb2IgxJHDoyDEkeG7k25nIGLhu5kKICAgICAgICAgICAgaWYgImpvYnMiIGluIGRhdGEgYW5kIGlzaW5zdGFuY2UoZGF0YVsiam9icyJdLCBsaXN0KToKICAgICAgICAgICAgICAgIGZvciBqb2JfdXVpZCBpbiBkYXRhWyJqb2JzIl06CiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5tYXJrX2FzX3N5bmNlZCgiam9ic19oaXN0b3J5Iiwgam9iX3V1aWQpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYixJDDoW5oIGThuqV1IGpvYiDEkcOjIMSR4buTbmcgYuG7mToge2pvYl91dWlkfSIpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHtsZW4oZGF0YVsnam9icyddKX0gam9iIMSRw6MgxJHhu5NuZyBi4buZIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIHThu6sgc2VydmVyIG7hur91IGPDswogICAgICAgICAgICBpZiAibWVzc2FnZSIgaW4gdGFza19kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUaMO0bmcgYsOhbyB04burIHNlcnZlcjoge3Rhc2tfZGF0YVsnbWVzc2FnZSddfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHjhu60gbMO9IGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mToge3N0cihlKX0iKQogICAgICAgICAgICAKICAgIGRlZiBfaGFuZGxlX2NvbmZpZ191cGRhdGUoc2VsZiwgdGFza19kYXRhKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfZGF0YTogROG7ryBsaeG7h3UgdGFzayB04burIHNlcnZlcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk5o4bqtbiB5w6p1IGPhuqd1IGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB04burIHNlcnZlciIpCiAgICAgICAgICAgIGNvbmZpZ19kYXRhID0gdGFza19kYXRhLmdldCgiY29uZmlnX2RhdGEiLCB7fSkKICAgICAgICAgICAgaWYgbm90IGNvbmZpZ19kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkThu68gbGnhu4d1IGPhuqV1IGjDrG5oIHLhu5duZyIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0cm9uZyBEQgogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBjb25maWdfZGF0YS5pdGVtcygpOgogICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoa2V5LCB2YWx1ZSkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmg6IHtrZXl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbygiQ+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRow6BuaCBjw7RuZyIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB44butIGzDvSBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmg6IHtzdHIoZSl9IikKICAgIAogICAgZGVmIF9oYW5kbGVfYWNjb3VudF91cGRhdGUoc2VsZiwgdGFza19kYXRhKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIGPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfZGF0YTogROG7ryBsaeG7h3UgdGFzayB04burIHNlcnZlciBjw7MgY+G6pXUgdHLDumM6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJ0YXNrX2lkIjogInRhc2tfMTc0OTM5OTUzNjI3Ml82NDEiLAogICAgICAgICAgICAgICAgImRldmljZV9pZCI6ICJhMTI1ZjYyNGY0MWE0ZjdjIiwKICAgICAgICAgICAgICAgICJ0YXNrX3R5cGUiOiAiYWNjb3VudF91cGRhdGUiLAogICAgICAgICAgICAgICAgImRhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgImFwcCI6ICJpbnN0YWdyYW0iLAogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiaW5hY3RpdmUiLAogICAgICAgICAgICAgICAgICAgICJqb2JfbWF4X2RheSI6IDEwOCwKICAgICAgICAgICAgICAgICAgICAiam9iX3RvZGF5IjogMzAsCiAgICAgICAgICAgICAgICAgICAgImpvYl9lbmFibGUiOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICJhY2NvdW50X3V1aWQiOiAiN2VkOTU1N2QtNzZhNC00N2Y3LTg4NTAtN2NlZWYwYzY5MGFmIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJtZXNzYWdlIjogIiIsCiAgICAgICAgICAgICAgICAic3RhdHVzIjogInBlbmRpbmciCiAgICAgICAgICAgIH0KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgZGF0YSA9IHRhc2tfZGF0YS5nZXQoImRhdGEiLCB7fSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIHnDqnUgY+G6p3UgY+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiB04burIHNlcnZlciAodGFza19pZDoge3Rhc2tfaWR9KSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgZGF0YSBvciAiYWNjb3VudF91dWlkIiBub3QgaW4gZGF0YToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJE4buvIGxp4buHdSB0w6BpIGtob+G6o24ga2jDtG5nIGjhu6NwIGzhu4ciKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsICJE4buvIGxp4buHdSB0w6BpIGtob+G6o24ga2jDtG5nIGjhu6NwIGzhu4ciKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0w6BpIGtob+G6o24gdOG7qyBEQgogICAgICAgICAgICBhY2NvdW50ID0gc2VsZi5kYi5nZXRfYWNjb3VudF9ieV91dWlkKGRhdGFbImFjY291bnRfdXVpZCJdKQogICAgICAgICAgICBpZiBub3QgYWNjb3VudDoKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB24bubaSBVVUlEOiB7ZGF0YVsnYWNjb3VudF91dWlkJ119IgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0ge30KICAgICAgICAgICAgdmFsaWRfZmllbGRzID0gWyJzdGF0dXMiLCAiam9iX21heF9kYXkiLCAiam9iX3RvZGF5IiwgImpvYl9lbmFibGUiXQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZGF0YS5pdGVtcygpOgogICAgICAgICAgICAgICAgaWYga2V5IGluIHZhbGlkX2ZpZWxkczoKICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YVtrZXldID0gdmFsdWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHVwZGF0ZV9kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgdGjDtG5nIHRpbiBj4bqnbiBj4bqtcCBuaOG6rXQiKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsICJLaMO0bmcgY8OzIHRow7RuZyB0aW4gY+G6p24gY+G6rXAgbmjhuq10IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgbOG6oWkgdsOgbyBEQgogICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICcnKX0gKFVVSUQ6IHtkYXRhWydhY2NvdW50X3V1aWQnXX0pIHbhu5tpIGThu68gbGnhu4d1OiB7dXBkYXRlX2RhdGF9IikKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJzdWNjZXNzIiwgZiLEkMOjIGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnJyl9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYiS2jDtG5nIHRo4buDIGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnJyl9IgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kgeOG7rSBsw70gY+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbjoge3N0cihlKX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgIAogICAgZGVmIHNlbmRfdGFza19yZXBvcnQoc2VsZiwgdGFza19pZDogc3RyLCBkZXZpY2VfaWQ6IHN0ciwgc3RhdHVzOiBzdHIsIGNsaWVudF9tZXNzYWdlOiBzdHIgPSAiIik6CiAgICAgICAgIiIiCiAgICAgICAgR+G7rWkgYsOhbyBjw6FvIGvhur90IHF14bqjIHRo4buxYyBoaeG7h24gdGFzayBsw6puIHNlcnZlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfaWQ6IElEIGPhu6dhIHRhc2sKICAgICAgICAgICAgZGV2aWNlX2lkOiBJRCBj4bunYSB0aGnhur90IGLhu4sKICAgICAgICAgICAgc3RhdHVzOiBUcuG6oW5nIHRow6FpIHRo4buxYyBoaeG7h24gdGFzayAoJ3BlbmRpbmcnLCAnc3VjY2VzcycsICdmYWlsZWQnKQogICAgICAgICAgICBjbGllbnRfbWVzc2FnZTogVGjDtG5nIGLDoW8gdOG7qyBjbGllbnQKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmlzX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGfhu61pIGLDoW8gY8OhbyB0YXNrOiBNUVRUIGNoxrBhIGvhur90IG7hu5FpIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2h14bqpbiBi4buLIGThu68gbGnhu4d1IGLDoW8gY8OhbwogICAgICAgICAgICByZXBvcnRfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJ0YXNrX2lkIjogdGFza19pZCwKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiBkZXZpY2VfaWQsCiAgICAgICAgICAgICAgICAic3RhdHVzIjogc3RhdHVzLAogICAgICAgICAgICAgICAgImNsaWVudF9tZXNzYWdlIjogY2xpZW50X21lc3NhZ2UsCiAgICAgICAgICAgICAgICAidGltZXN0YW1wIjogaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu61pIGzDqm4gc2VydmVyCiAgICAgICAgICAgIHNlbGYuY2xpZW50LnB1Ymxpc2goCiAgICAgICAgICAgICAgICAiZG5kdmluYS9jbGllbnQvdGFza19yZXBvcnQiLCAKICAgICAgICAgICAgICAgIGpzb24uZHVtcHMocmVwb3J0X2RhdGEpLCAKICAgICAgICAgICAgICAgIHFvcz0xCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBn4butaSBiw6FvIGPDoW8gdGFzayB7dGFza19pZH0gduG7m2kgdHLhuqFuZyB0aMOhaSB7c3RhdHVzfSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIGLDoW8gY8OhbyB0YXNrOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBzZW5kX2Nvbm5lY3Rfbm90aWZpY2F0aW9uKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpIMSR4bq/biBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmlzX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpOiBNUVRUIGNoxrBhIGvhur90IG7hu5FpIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZGV2aWNlX2lkCiAgICAgICAgICAgIGRldmljZV9pZCA9IHNlbGYuZGIuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHXhuqluIGLhu4sgZOG7ryBsaeG7h3UgdGjDtG5nIGLDoW8KICAgICAgICAgICAgY29ubmVjdF9kYXRhID0gewogICAgICAgICAgICAgICAgImRldmljZV9pZCI6IGRldmljZV9pZCwKICAgICAgICAgICAgICAgICJ0aW1lc3RhbXAiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7rWkgbMOqbiBzZXJ2ZXIKICAgICAgICAgICAgc2VsZi5jbGllbnQucHVibGlzaCgKICAgICAgICAgICAgICAgICJkbmR2aW5hL2NsaWVudC9jb25uZWN0IiwgCiAgICAgICAgICAgICAgICBqc29uLmR1bXBzKGNvbm5lY3RfZGF0YSksIAogICAgICAgICAgICAgICAgcW9zPTEKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpIGNobyB0aGnhur90IGLhu4sge2RldmljZV9pZH0iKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4butaSB0aMO0bmcgYsOhbyBr4bq/dCBu4buRaToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlIHRyb25nIG3hu5l0IHRocmVhZCByacOqbmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICB0aHJlYWRpbmcuVGhyZWFkOiBUaHJlYWQgxJFhbmcgY2jhuqF5IE1RVFQgc2VydmljZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUaGnhur90IGzhuq1wIGPDoWMgaGFuZGxlciB0csaw4bubYyBraGkga+G6v3QgbuG7kWkKICAgICAgICAgICAgc2VsZi5zZXR1cF9tcXR0X2hhbmRsZXJzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS+G6v3QgbuG7kWkgTVFUVCAtIGjDoG0gbsOgeSBz4bq9IGNo4budIGNobyDEkeG6v24ga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZwogICAgICAgICAgICBsb2dnZXIuaW5mbygiS2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlLi4uIikKICAgICAgICAgICAgc2VsZi5jb25uZWN0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQuG6r3QgxJHhuqd1IHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIHNhdSBraGkgxJHDoyBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcKICAgICAgICAgICAgaWYgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0X3N5bmNfdGhyZWFkKCkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGto4bufaSDEkeG7mW5nIE1RVFQgc2VydmljZSB2w6AgxJHhu5NuZyBi4buZIGThu68gbGnhu4d1IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJNUVRUIHNlcnZpY2UgxJFhbmcgY2jhuqF5IG5oxrBuZyBjaMawYSBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHNlbGYuc3luY190aHJlYWQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraOG7n2kgxJHhu5luZyBNUVRUIHNlcnZpY2UiKQogICAgICAgICAgICByZXR1cm4gTm9uZQ==').decode('utf-8'))
