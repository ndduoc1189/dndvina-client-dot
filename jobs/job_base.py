import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgTGlzdCwgT3B0aW9uYWwsIENhbGxhYmxlCmZyb20gYWJjIGltcG9ydCBBQkMsIGFic3RyYWN0bWV0aG9kCmltcG9ydCB1dGlscwpmcm9tIHV0aWxzIGltcG9ydCBMb2dMZXZlbCwgTG9nZ2VyCmltcG9ydCB1cmxsaWIucGFyc2UKaW1wb3J0IHJhbmRvbQppbXBvcnQgY29uZmlnCiMgVOG6oW8gbG9nZ2VyIGNobyBCYXNlSm9iCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIkJhc2VKb2IiKQoKY2xhc3MgQmFzZUpvYihBQkMpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZT1Ob25lKToKICAgICAgICBzZWxmLmRiID0gZGJfc2VydmljZQogICAgICAgIHNlbGYuaGVscGVyID0gaGVscGVyX3NlcnZpY2UKICAgICAgICBzZWxmLmdvbGlrZV9zZXJ2aWNlID0gZ29saWtlX3NlcnZpY2UKICAgICAgICBzZWxmLmFwcF9wYWNrYWdlID0gIiIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gIiIKICAgICAgICAjIEjDoG0gc2xlZXAgbeG6t2MgxJHhu4tuaCBsw6AgdGltZS5zbGVlcAogICAgICAgIHNlbGYuX3NsZWVwX2Z1bmMgPSB0aW1lLnNsZWVwCiAgICAgICAgIyBU4bqhbyBsb2dnZXIgY2hvIGluc3RhbmNlIGPhu6UgdGjhu4MKICAgICAgICBzZWxmLmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoZiJKb2Iue3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpCiAgICAgICAgCiAgICBAYWJzdHJhY3RtZXRob2QKICAgIGRlZiBnZXRfYWNjb3VudHNfZnJvbV9kZXZpY2Uoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdOG7qyB0aGnhur90IGLhu4siIiIKICAgICAgICBwYXNzCiAgICAgICAgCiAgICBAYWJzdHJhY3RtZXRob2QKICAgIGRlZiBwZXJmb3JtX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSk6CiAgICAgICAgIiIiVGjhu7FjIGhp4buHbiBjw7RuZyB2aeG7h2MgduG7m2kgdMOgaSBraG/huqNuIiIiCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQYW5nIHRo4buxYyBoaeG7h24gam9iIGNobyB0w6BpIGtob+G6o246IHthY2NvdW50Wyd1bmlxdWVfdXNlcm5hbWUnXX0iKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBnaeG7m2kgaOG6oW4gam9iCiAgICAgICAgbWF4X2pvYnNfcGVyX2RheSA9IHNlbGYuZGIuZ2V0X2RldmljZV9jb25maWcoIm1heF9qb2JzX3Blcl9kYXkiLCAzMCkKICAgICAgICBtYXhfam9ic19wZXJfc2Vzc2lvbiA9IHNlbGYuZGIuZ2V0X2RldmljZV9jb25maWcoIm1heF9qb2JzX3Blcl9zZXNzaW9uIiwgMTApCiAgICAgICAgCiAgICAgICAgam9iX3RvZGF5ID0gYWNjb3VudC5nZXQoJ2pvYl90b2RheScsIDApCiAgICAgICAgam9ic19kb25lX2luX3Nlc3Npb24gPSBhY2NvdW50LmdldCgnam9ic19kb25lX2luX3Nlc3Npb24nLCAwKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBnaeG7m2kgaOG6oW4gam9iIHRoZW8gbmfDoHkKICAgICAgICBpZiBqb2JfdG9kYXkgPj0gbWF4X2pvYnNfcGVyX2RheToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudFsndW5pcXVlX3VzZXJuYW1lJ119IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMO0bSBuYXkgKHtqb2JfdG9kYXl9L3ttYXhfam9ic19wZXJfZGF5fSkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGdp4bubaSBo4bqhbiBqb2IgdGhlbyBwaGnDqm4KICAgICAgICBpZiBqb2JzX2RvbmVfaW5fc2Vzc2lvbiA+PSBtYXhfam9ic19wZXJfc2Vzc2lvbjoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudFsndW5pcXVlX3VzZXJuYW1lJ119IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgdHJvbmcgcGhpw6puIG7DoHkgKHtqb2JzX2RvbmVfaW5fc2Vzc2lvbn0ve21heF9qb2JzX3Blcl9zZXNzaW9ufSkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIEzhuqV5IGpvYiB04burIEdvTGlrZQogICAgICAgIGpvYnMgPSBzZWxmLmdldF9hdmFpbGFibGVfam9icyhhY2NvdW50KQogICAgICAgIGlmIG5vdCBqb2JzOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiS2jDtG5nIGPDsyBqb2Iga2jhuqMgZOG7pW5nIGNobyB0w6BpIGtob+G6o24ge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAjIFjhu60gbMO9IHThu6tuZyBqb2IKICAgICAgICBmb3Igam9iIGluIGpvYnM6CiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuZXhlY3V0ZV9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICBpZiByZXN1bHRbInN1Y2Nlc3MiXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGhvw6BuIHRow6BuaCBqb2Ige2pvYlsnaWQnXX0gbG/huqFpIHtqb2JbJ3R5cGUnXX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIktow7RuZyB0aOG7gyBob8OgbiB0aMOgbmggam9iIHtqb2JbJ2lkJ119IGxv4bqhaSB7am9iWyd0eXBlJ119OiB7cmVzdWx0WydtZXNzYWdlJ119IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIELDoW8gY8OhbyBr4bq/dCBxdeG6oyBqb2IKICAgICAgICAgICAgcmVwb3J0X3N1Y2Nlc3MgPSBzZWxmLnJlcG9ydF9qb2IoYWNjb3VudCwgam9iLCByZXN1bHQpCiAgICAgICAgICAgIGlmIHJlcG9ydF9zdWNjZXNzOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgYsOhbyBjw6FvIGvhur90IHF14bqjIGpvYiB7am9iWydpZCddfSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIktow7RuZyB0aOG7gyBiw6FvIGPDoW8ga+G6v3QgcXXhuqMgam9iIHtqb2JbJ2lkJ119IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bujaSB0aOG7nWkgZ2lhbiBj4bqldSBow6xuaCB0csaw4bubYyBraGkgbMOgbSBqb2IgdGnhur9wIHRoZW8KICAgICAgICAgICAgam9iX2ludGVydmFsID0gc2VsZi5kYi5nZXRfZGV2aWNlX2NvbmZpZygiam9iX2ludGVydmFsX3NlY29uZHMiLCA1KQogICAgICAgICAgICB3YWl0X3RpbWUgPSByYW5kb20ucmFuZGludChqb2JfaW50ZXJ2YWwsIGpvYl9pbnRlcnZhbCArIDUpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkOG7o2kge3dhaXRfdGltZX1zIHRyxrDhu5tjIGtoaSBsw6BtIGpvYiB0aeG6v3AgdGhlbyIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgCiAgICBAYWJzdHJhY3RtZXRob2QKICAgIGRlZiBwZXJmb3JtX2NhcmUoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIk51w7RpIHTDoGkga2hv4bqjbiwgdMawxqFuZyB0w6FjIMSR4buDIHTEg25nIMSR4buZIHV5IHTDrW4iIiIKICAgICAgICBwYXNzCiAgICAgICAgCiAgICBkZWYgc3luY19hY2NvdW50c190b19kYihzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICDEkOG7k25nIGLhu5kgdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLIHbDoG8gZGF0YWJhc2UKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdOG7qyB0aGnhur90IGLhu4sKICAgICAgICAgICAgZGV2aWNlX2FjY291bnRzID0gc2VsZi5nZXRfYWNjb3VudHNfZnJvbV9kZXZpY2UoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBkZXZpY2VfaWQgdOG7qyBkYXRhYmFzZQogICAgICAgICAgICBhbmRyb2lkX2lkID0gc2VsZi5kYi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBob+G6t2MgdGjDqm0gbeG7m2kgdsOgbyBEQgogICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBkZXZpY2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICAjIFRow6ptIHRow7RuZyB0aW4gYXBwIHbDoCBkZXZpY2VfaWQKICAgICAgICAgICAgICAgIGFjY291bnRbImFwcCJdID0gc2VsZi5hcHBfbmFtZQogICAgICAgICAgICAgICAgYWNjb3VudFsiZGV2aWNlX2lkIl0gPSBhbmRyb2lkX2lkCiAgICAgICAgICAgICAgICAjIMSQw6FuaCBk4bqldSBsw6AgY2jGsGEgxJHhu5NuZyBi4buZIMSR4buDIGfhu61pIGzDqm4gc2VydmVyCiAgICAgICAgICAgICAgICBhY2NvdW50WyJpc19zeW5jIl0gPSBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdMOgaSBraG/huqNuIMSRw6MgdOG7k24gdOG6oWkgY2jGsGEKICAgICAgICAgICAgICAgIGV4aXN0aW5nX2FjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPXNlbGYuYXBwX25hbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB0w6BpIGtob+G6o24gdHJvbmcgREIgZOG7sWEgdsOgbyB1bmlxdWVfdXNlcm5hbWUKICAgICAgICAgICAgICAgIGV4aXN0aW5nX2FjY291bnQgPSBOb25lCiAgICAgICAgICAgICAgICBmb3IgYWNjIGluIGV4aXN0aW5nX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgIGlmIGFjYy5nZXQoInVuaXF1ZV91c2VybmFtZSIpID09IGFjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKToKICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfYWNjb3VudCA9IGFjYwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBleGlzdGluZ19hY2NvdW50OgogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBleGlzdGluZ19hY2NvdW50WyJpZCJdCiAgICAgICAgICAgICAgICAgICAgIyBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRfaWQsIGFjY291bnQpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgVGjDqm0gdMOgaSBraG/huqNuIG3hu5tpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5hZGRfYWNjb3VudChhY2NvdW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBkZXZpY2VfYWNjb3VudHMKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIHtzZWxmLmFwcF9uYW1lfSIpCiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAKICAgIGRlZiBydW4oc2VsZiwgaGVscGVyX2F2YWlsYWJsZTogYm9vbCA9IFRydWUsIG5ldHdvcmtfYXZhaWxhYmxlOiBib29sID0gVHJ1ZSk6CiAgICAgICAgIiIiCiAgICAgICAgQ2jhuqF5IGpvYiB24bubaSBjw6FjIHTDoGkga2hv4bqjbiDEkcaw4bujYyBrw61jaCBob+G6oXQKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBoZWxwZXJfYXZhaWxhYmxlOiBUcnVlIG7hur91IEhlbHBlclNlcnZpY2UgxJFhbmcgaG/huqF0IMSR4buZbmcKICAgICAgICAgICAgbmV0d29ya19hdmFpbGFibGU6IFRydWUgbuG6v3UgbeG6oW5nIMSRYW5nIGhv4bqhdCDEkeG7mW5nCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IGhlbHBlcl9hdmFpbGFibGUgb3Igbm90IG5ldHdvcmtfYXZhaWxhYmxlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQuG7jyBxdWEgam9iIHtzZWxmLmFwcF9uYW1lfSBkbyB0aGnhur90IGLhu4sgaG/hurdjIG3huqFuZyBraMO0bmcga2jhuqMgZOG7pW5nIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB4w6FjIHRo4buxYyBHb0xpa2UKICAgICAgICBpZiBub3Qgc2VsZi5pc19nb2xpa2VfYXV0aGVudGljYXRlZCgpOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQuG7jyBxdWEgam9iIHtzZWxmLmFwcF9uYW1lfSBkbyBjaMawYSBjw7MgeMOhYyB0aOG7sWMgR29MaWtlIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHGsOG7o2Mga8OtY2ggaG/huqF0IHbDoCB0aHXhu5ljIHRoaeG6v3QgYuG7iyBoaeG7h24gdOG6oWkKICAgICAgICBhY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1zZWxmLmFwcF9uYW1lLCBqb2JfZW5hYmxlPVRydWUpCiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBhY2NvdW50czoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIktow7RuZyBjw7MgdMOgaSBraG/huqNuIHtzZWxmLmFwcF9uYW1lfSBuw6BvIHRodeG7mWMgdGhp4bq/dCBi4buLIGhp4buHbiB04bqhaSDEkcaw4bujYyBrw61jaCBob+G6oXQgxJHhu4MgY2jhuqF5IGpvYiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50czoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDoGkgxJHhurd0IHhlbSBjw7MgbsOqbiBjaOG6oXkgam9iIGhheSBraMO0bmcKICAgICAgICAgICAgICAgIGlmIHNlbGYuZGIuZ2V0KGYie3NlbGYuYXBwX25hbWV9X2pvYl9lbmFibGUiLCBUcnVlKToKICAgICAgICAgICAgICAgICAgICBzZWxmLnBlcmZvcm1fam9iKGFjY291bnQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OgaSDEkeG6t3QgeGVtIGPDsyBuw6puIG51w7RpIHTDoGkga2hv4bqjbiBoYXkga2jDtG5nCiAgICAgICAgICAgICAgICBpZiBzZWxmLmRiLmdldChmIntzZWxmLmFwcF9uYW1lfV9jYXJlX2VuYWJsZSIsIFRydWUpOgogICAgICAgICAgICAgICAgICAgIHNlbGYucGVyZm9ybV9jYXJlKGFjY291bnQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSBjaOG6oXkgam9iIGNobyB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0iKQogICAgCiAgICBkZWYgaXNfZ29saWtlX2F1dGhlbnRpY2F0ZWQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSDEkcOjIGPDsyB0aMO0bmcgdGluIHjDoWMgdGjhu7FjIEdvTGlrZSBjaMawYQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJHDoyB4w6FjIHRo4buxYywgRmFsc2UgbuG6v3UgY2jGsGEKICAgICAgICAiIiIKICAgICAgICBnb2xpa2VfaGVhZGVycyA9IHNlbGYuZGIuZ2V0KCJnb2xpa2VfaGVhZGVycyIsIHt9KQogICAgICAgIHJldHVybiBib29sKGdvbGlrZV9oZWFkZXJzIGFuZCAiYXV0aG9yaXphdGlvbiIgaW4gZ29saWtlX2hlYWRlcnMpCiAgICAKICAgIGRlZiBhcGlfcmVxdWVzdChzZWxmLCB1cmw6IHN0ciwgbWV0aG9kOiBzdHIgPSAiR0VUIiwgcGF5bG9hZDogRGljdFtzdHIsIEFueV0gPSBOb25lKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgR+G7jWkgQVBJIEdvTGlrZSB0aMO0bmcgcXVhIEdvTGlrZVNlcnZpY2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB1cmw6IFVSTCBj4bunYSBBUEkKICAgICAgICAgICAgbWV0aG9kOiBQaMawxqFuZyB0aOG7qWMgSFRUUCAoR0VUIGhv4bq3YyBQT1NUKQogICAgICAgICAgICBwYXlsb2FkOiBE4buvIGxp4buHdSBn4butaSDEkWkgKGNobyBQT1NUIHJlcXVlc3QpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgaG/hurdjIE5vbmU6IEvhur90IHF14bqjIEFQSSBu4bq/dSB0aMOgbmggY8O0bmcsIE5vbmUgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuZ29saWtlX3NlcnZpY2U6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGfhu41pIEFQSTogR29MaWtlU2VydmljZSBjaMawYSDEkcaw4bujYyBjdW5nIGPhuqVwIGNobyB7c2VsZi5hcHBfbmFtZX0gam9iIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgIyBY4butIGzDvSBwYXlsb2FkIGNobyBHRVQgcmVxdWVzdCAtIHRow6ptIHbDoG8gVVJMCiAgICAgICAgaWYgbWV0aG9kLnVwcGVyKCkgPT0gIkdFVCIgYW5kIHBheWxvYWQ6CiAgICAgICAgICAgICMgVOG6oW8gcXVlcnkgc3RyaW5nIHThu6sgcGF5bG9hZAogICAgICAgICAgICBxdWVyeV9wYXJhbXMgPSBbXQogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBwYXlsb2FkLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiB2YWx1ZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBxdWVyeV9wYXJhbXMuYXBwZW5kKGYie3VybGxpYi5wYXJzZS5xdW90ZShrZXkpfT17dXJsbGliLnBhcnNlLnF1b3RlKHN0cih2YWx1ZSkpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIHF1ZXJ5IHN0cmluZyB2w6BvIFVSTAogICAgICAgICAgICBpZiBxdWVyeV9wYXJhbXM6CiAgICAgICAgICAgICAgICBzZXBhcmF0b3IgPSAiJiIgaWYgIj8iIGluIHVybCBlbHNlICI/IgogICAgICAgICAgICAgICAgdXJsID0gZiJ7dXJsfXtzZXBhcmF0b3J9eycmJy5qb2luKHF1ZXJ5X3BhcmFtcyl9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6t3QgcGF5bG9hZCB24buBIE5vbmUgdsOsIMSRw6MgxJHGsGEgdsOgbyBVUkwKICAgICAgICAgICAgcGF5bG9hZCA9IE5vbmUKICAgICAgICAKICAgICAgICByZXR1cm4gc2VsZi5nb2xpa2Vfc2VydmljZS5hcGlfcmVxdWVzdCh1cmwsIG1ldGhvZCwgcGF5bG9hZCkKICAgIAogICAgZGVmIGdldF9nb2xpa2VfYWNjb3VudHMoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHDoyDEkcSDbmcga8O9IHbhu5tpIEdvTGlrZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBHb0xpa2UKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDGsOG7nW5nIGThuqtuIEFQSSBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICB1cmwgPSBmIntzZWxmLmdldF9hY2NvdW50X3VybCgpfSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJCiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5hcGlfcmVxdWVzdCh1cmwpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgYWNjb3VudHMgPSByZXNwb25zZS5nZXQoImRhdGEiLCBbXSkKICAgICAgICAgICAgICAgIHJldHVybiBhY2NvdW50cwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBHb0xpa2UiKQogICAgICAgICAgICByZXR1cm4gW10KICAgIAogICAgZGVmIG1hcF9nb2xpa2VfYWNjb3VudHMoc2VsZiwgZ29saWtlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSwgZGV2aWNlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgw4FuaCB44bqhIHTDoGkga2hv4bqjbiB04burIEdvTGlrZSB2w6BvIHTDoGkga2hv4bqjbiB0csOqbiB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBnb2xpa2VfYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuIHThu6sgR29MaWtlIEFQSQogICAgICAgICAgICBkZXZpY2VfYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHDoyDDoW5oIHjhuqEKICAgICAgICAiIiIKICAgICAgICAjIFBoxrDGoW5nIHRo4bupYyBt4bq3YyDEkeG7i25oLCBj4bqnbiBvdmVycmlkZSDhu58gbOG7m3AgY29uCiAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBmZXRjaF9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIGpvYiB04burIEdvTGlrZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgaG/hurdjIE5vbmU6IFRow7RuZyB0aW4gam9iIG7hur91IGPDsywgTm9uZSBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQxrDhu51uZyBk4bqrbiBBUEkgbOG6pXkgam9iCiAgICAgICAgICAgIHVybCA9IGYie3NlbGYuZ2V0X2pvYnNfdXJsKCl9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaGFtIHPhu5EgdMO5eSB0aGVvIGxv4bqhaSBhcHAKICAgICAgICAgICAgcGFyYW1zID0gc2VsZi5nZXRfam9iX3BhcmFtcyhhY2NvdW50KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBBUEkKICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmFwaV9yZXF1ZXN0KHVybCwgIkdFVCIsIHBhcmFtcykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN1Y2Nlc3MiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBqb2IgPSByZXNwb25zZS5nZXQoImRhdGEiLCBOb25lKQogICAgICAgICAgICAgICAgaWYgam9iOgogICAgICAgICAgICAgICAgICAgICMgQ2h14bqpbiBow7NhIGThu68gbGnhu4d1IGpvYgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLm1hcF9qb2JfZGF0YShqb2IpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgam9iIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIG1hcF9qb2JfZGF0YShzZWxmLCBqb2JfZGF0YTogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENodeG6qW4gaMOzYSBk4buvIGxp4buHdSBqb2IgdOG7qyBBUEkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2JfZGF0YTogROG7ryBsaeG7h3Ugam9iIHThu6sgQVBJCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBE4buvIGxp4buHdSBqb2IgxJHDoyBjaHXhuqluIGjDs2EKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiYXBwIjogc2VsZi5hcHBfbmFtZSwKICAgICAgICAgICAgImlkIjogam9iX2RhdGEuZ2V0KCJpZCIpLAogICAgICAgICAgICAibGluayI6IGpvYl9kYXRhLmdldCgibGluayIpLAogICAgICAgICAgICAidHlwZSI6IGpvYl9kYXRhLmdldCgidHlwZSIpLAogICAgICAgICAgICAib2JqZWN0X2lkIjogam9iX2RhdGEuZ2V0KCJvYmplY3RfaWQiKSwKICAgICAgICAgICAgInByaWNlX2FmdGVyX2Nvc3QiOiBqb2JfZGF0YS5nZXQoInByaWNlX2FmdGVyX2Nvc3QiKSwKICAgICAgICAgICAgInN0YXR1cyI6ICJpZGxlIiwgICMgU3RhdHVzIG3hurdjIMSR4buLbmggbMOgIGlkbGUKICAgICAgICAgICAgInJhd19kYXRhIjogam9iX2RhdGEgICMgTMawdSBs4bqhaSBk4buvIGxp4buHdSBn4buRYyDEkeG7gyB0aGFtIGto4bqjbyBraGkgY+G6p24KICAgICAgICB9CiAgICAKICAgIGRlZiBleGVjdXRlX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIGpvYiwgYmFvIGfhu5NtOgogICAgICAgICAgICAgICAgLSBzdGF0dXMgKGludCk6IE3DoyB0cuG6oW5nIHRow6FpIGpvYgogICAgICAgICAgICAgICAgICAgIDA6IENoxrBhIHRo4buxYyBoaeG7h24KICAgICAgICAgICAgICAgICAgICAxOiBUaMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICAyOiBUaOG6pXQgYuG6oWksIGtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcKICAgICAgICAgICAgICAgICAgICAzOiBUaOG6pXQgYuG6oWksIMSRw6MgYuG7iyB1bmZvbGxvdy91bmxpa2UKICAgICAgICAgICAgICAgIC0gbWVzc2FnZSAoc3RyKTogVGjDtG5nIGLDoW8ga+G6v3QgcXXhuqMKICAgICAgICAgICAgICAgIC0gc3VjY2VzcyAoYm9vbCk6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICAjIE3hurdjIMSR4buLbmgga2jDtG5nIGzDoG0gZ8OsLCBj4bqnbiBvdmVycmlkZSDhu58gbOG7m3AgY29uCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlRo4buxYyBoaeG7h24gam9iIGNobyB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0iKQogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJzdGF0dXMiOiAwLAogICAgICAgICAgICAibWVzc2FnZSI6ICJDaMawYSB0aOG7sWMgaGnhu4duIGpvYiIsCiAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UKICAgICAgICB9CiAgICAKICAgIGRlZiByZXBvcnRfam9iKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldLCByZXN1bHQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIELDoW8gY8OhbyBr4bq/dCBxdeG6oyBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIHJlc3VsdDogS+G6v3QgcXXhuqMgdGjhu7FjIGhp4buHbiBqb2IgYmFvIGfhu5NtOgogICAgICAgICAgICAgICAgLSBzdGF0dXMgKGludCk6IE3DoyB0cuG6oW5nIHRow6FpIGpvYgogICAgICAgICAgICAgICAgICAgIDE6IFRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIDI6IFRo4bqldCBi4bqhaSwga2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZwogICAgICAgICAgICAgICAgICAgIDM6IFRo4bqldCBi4bqhaSwgxJHDoyBi4buLIHVuZm9sbG93L3VubGlrZQogICAgICAgICAgICAgICAgLSBtZXNzYWdlIChzdHIpOiBUaMO0bmcgYsOhbyBr4bq/dCBxdeG6owogICAgICAgICAgICAgICAgLSBzdWNjZXNzIChib29sKTogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGLDoW8gY8OhbyB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgam9iX2lkID0gam9iLmdldCgiaWQiKQogICAgICAgICAgICBqb2JfdHlwZSA9IGpvYi5nZXQoInR5cGUiLCAiIikKICAgICAgICAgICAgam9iX3N0YXR1cyA9IHJlc3VsdC5nZXQoInN0YXR1cyIsIDApCiAgICAgICAgICAgIGpvYl9zdWNjZXNzID0gcmVzdWx0LmdldCgic3VjY2VzcyIsIEZhbHNlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBHaGkgbOG6oWkgbOG7i2NoIHPhu60gam9iCiAgICAgICAgICAgIHNlbGYucmVjb3JkX2pvYl9oaXN0b3J5KGFjY291bnQsIGpvYiwgcmVzdWx0KQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGpvYl9pZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgY8OzIElEIGpvYiDEkeG7gyBiw6FvIGPDoW8iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgam9iIHbDoCB44butIGzDvSB0xrDGoW5nIOG7qW5nCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IHN0YXR1cyBsw6AgMiAobOG7l2kga2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZyksIGjhu6d5IGpvYiB2w6AgYsOhbyBjw6FvIHRo4bqldCBi4bqhaQogICAgICAgICAgICBpZiBqb2Jfc3RhdHVzID09IDI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gam9iIHtqb2JfaWR9LCBraMO0bmcgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nLCBo4buneSBqb2IiKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuc2tpcF9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBzdGF0dXMgbMOgIDMgKMSRw6MgYuG7iyB1bmZvbGxvdy91bmxpa2UpLCBo4buneSBqb2IgdsOgIHbDtCBoaeG7h3UgaMOzYSB0w6BpIGtob+G6o24gdOG6oW0gdGjhu51pCiAgICAgICAgICAgIGlmIGpvYl9zdGF0dXMgPT0gMzoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJQaMOhdCBoaeG7h24gYuG7iyB1bmZvbGxvdy91bmxpa2UsIHbDtCBoaeG7h3UgaMOzYSB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gdHJvbmcgMjRoIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBI4buneSBqb2IgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICBzZWxmLnNraXBfam9iKGFjY291bnQsIGpvYikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkOG6t3QgdMOgaSBraG/huqNuIHbDoG8gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZSB0cm9uZyAyNGgKICAgICAgICAgICAgICAgIGNvb2xkb3duX21pbnV0ZXMgPSAyNCAqIDYwICAjIDI0IGdp4budCiAgICAgICAgICAgICAgICBhY2NvdW50X2lkID0gYWNjb3VudC5nZXQoImlkIikKICAgICAgICAgICAgICAgIGlmIGFjY291bnRfaWQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiaW5hY3RpdmUiLAogICAgICAgICAgICAgICAgICAgICAgICAiam9iX2Rpc2FibGVfdW50aWwiOiBpbnQodGltZS50aW1lKCkgKyBjb29sZG93bl9taW51dGVzICogNjApLAogICAgICAgICAgICAgICAgICAgICAgICAiZGlzYWJsZV9yZWFzb24iOiBmIkLhu4sgcGjDoXQgaGnhu4duIHVuZm9sbG93L3VubGlrZSB0cm9uZyBqb2Ige2pvYl90eXBlfSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UgICMgxJDDoW5oIGThuqV1IHTDoGkga2hv4bqjbiBj4bqnbiDEkeG7k25nIGLhu5kKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Ugam9iIHRow6BuaCBjw7RuZywgYsOhbyBjw6FvIGvhur90IHF14bqjCiAgICAgICAgICAgIGlmIGpvYl9zdWNjZXNzOgogICAgICAgICAgICAgICAgIyBVUkwgQVBJIGLDoW8gY8OhbyBqb2IKICAgICAgICAgICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICAgICAgICAgIHVybCA9IGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L2FkdmVydGlzaW5nL3B1Ymxpc2hlcnMve3NlbGYuYXBwX25hbWV9L2NvbXBsZXRlLWpvYnMiCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVOG6oW8gcGF5bG9hZCBjaG8gYsOhbyBjw6FvIGpvYgogICAgICAgICAgICAgICAgcGF5bG9hZCA9IHNlbGYuZ2V0X3JlcG9ydF9wYXlsb2FkKGFjY291bnQsIGpvYikKICAgICAgICAgICAgICAgIGlmIG5vdCBwYXlsb2FkOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgdOG6oW8gcGF5bG9hZCBjaG8gYsOhbyBjw6FvIGpvYiIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu60gZ+G7jWkgQVBJIHThu5FpIMSRYSAzIGzhuqduCiAgICAgICAgICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZSgzKToKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuYXBpX3JlcXVlc3QodXJsLCAiUE9TVCIsIHBheWxvYWQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2UgYW5kIHJlc3BvbnNlLmdldCgic3VjY2VzcyIsIEZhbHNlKToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgYsOhbyBjw6FvIGpvYiB7am9iX2lkfSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjhu5FuZyBrw6ogam9iCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGpvYl90eXBlIGluIFsiZm9sbG93IiwgImxpa2UiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYl90b2RheSA9IGFjY291bnQuZ2V0KCJqb2JfdG9kYXkiLCAwKSArIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYnNfZG9uZV9pbl9zZXNzaW9uID0gYWNjb3VudC5nZXQoImpvYnNfZG9uZV9pbl9zZXNzaW9uIiwgMCkgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9qb2JzID0gYWNjb3VudC5nZXQoInRvdGFsX2pvYnMiLCAwKSArIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl90b2RheSI6IGpvYl90b2RheSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9ic19kb25lX2luX3Nlc3Npb24iOiBqb2JzX2RvbmVfaW5fc2Vzc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidG90YWxfam9icyI6IHRvdGFsX2pvYnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImxhc3Rfam9iX3RpbWUiOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UgICMgxJDDoW5oIGThuqV1IHTDoGkga2hv4bqjbiBj4bqnbiDEkeG7k25nIGLhu5kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN0YXR1cyIpID09IDQwMDoKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gcmVzcG9uc2UuZ2V0KCdtZXNzYWdlJywgJycpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiW3thdHRlbXB0ICsgMX1dIELDoW8gY8OhbyBqb2IgbOG7l2k6IHtlcnJvcl9tc2d9LCB0aOG7rSBs4bqhaSBzYXUgNXMuLi4iKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDUpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJQaOG6o24gaOG7k2kga2jDtG5nIG1vbmcgxJHhu6NpIGtoaSBiw6FvIGPDoW8gam9iOiB7cmVzcG9uc2V9IikKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdGjDoG5oIGPDtG5nIHNhdSAzIGzhuqduIHRo4butLCBo4buneSBqb2IKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGLDoW8gY8OhbyBqb2Ige2pvYl9pZH0gc2F1IDMgbOG6p24gdGjhu60iKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuc2tpcF9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBKb2Iga2jDtG5nIHRow6BuaCBjw7RuZywgaOG7p3kgam9iCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiSm9iIHtqb2JfaWR9IGtow7RuZyB0aMOgbmggY8O0bmcsIGjhu6d5IGpvYiIpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5za2lwX2pvYihhY2NvdW50LCBqb2IpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGLDoW8gY8OhbyBqb2IiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGdldF9yZXBvcnRfcGF5bG9hZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVOG6oW8gcGF5bG9hZCBjaG8gdmnhu4djIGLDoW8gY8OhbyBob8OgbiB0aMOgbmggam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogUGF5bG9hZCBjaG8gQVBJIGLDoW8gY8OhbwogICAgICAgICIiIgogICAgICAgIGdvbGlrZV9pZCA9IGFjY291bnQuZ2V0KCJnb2xpa2VfaWQiKQogICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICAKICAgICAgICBpZiBub3QgZ29saWtlX2lkIG9yIG5vdCBqb2JfaWQ6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJUaGnhur91IHRow7RuZyB0aW4gdMOgaSBraG/huqNuIGhv4bq3YyBqb2IgxJHhu4MgdOG6oW8gcGF5bG9hZCBiw6FvIGPDoW8iKQogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImFkc19pZCI6IGpvYl9pZCwKICAgICAgICAgICAgImFjY291bnRfaWQiOiBnb2xpa2VfaWQsCiAgICAgICAgICAgICJhc3luYyI6IFRydWUsCiAgICAgICAgICAgICJkYXRhIjogTm9uZQogICAgICAgIH0KICAgIAogICAgZGVmIGdldF9za2lwX3BheWxvYWQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFThuqFvIHBheWxvYWQgY2hvIHZp4buHYyBi4buPIHF1YS9o4buneSBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBQYXlsb2FkIGNobyBBUEkgc2tpcCBqb2IKICAgICAgICAiIiIKICAgICAgICBnb2xpa2VfaWQgPSBhY2NvdW50LmdldCgiZ29saWtlX2lkIikKICAgICAgICBqb2JfaWQgPSBqb2IuZ2V0KCJpZCIpCiAgICAgICAgam9iX3R5cGUgPSBqb2IuZ2V0KCJ0eXBlIikKICAgICAgICBvYmplY3RfaWQgPSBqb2IuZ2V0KCJvYmplY3RfaWQiKQogICAgICAgIAogICAgICAgIGlmIG5vdCBnb2xpa2VfaWQgb3Igbm90IGpvYl9pZDoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIlRoaeG6v3UgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24gaG/hurdjIGpvYiDEkeG7gyB04bqhbyBwYXlsb2FkIGjhu6d5IikKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJhZHNfaWQiOiBqb2JfaWQsCiAgICAgICAgICAgICJhY2NvdW50X2lkIjogZ29saWtlX2lkLAogICAgICAgICAgICAib2JqZWN0X2lkIjogb2JqZWN0X2lkLAogICAgICAgICAgICAidHlwZSI6IGpvYl90eXBlCiAgICAgICAgfQogICAgICAgIAogICAgZGVmIHNraXBfam9iKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIELhu48gcXVhL2jhu6d5IGpvYiBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgaOG7p3kgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBpbXBvcnQgY29uZmlnCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFVSTCBBUEkgxJHhu4Mgc2tpcCBqb2IKICAgICAgICAgICAgdXJsID0gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0vYWR2ZXJ0aXNpbmcvcHVibGlzaGVycy97c2VsZi5hcHBfbmFtZX0vc2tpcC1qb2JzIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBwYXlsb2FkIGNobyB2aeG7h2Mgc2tpcCBqb2IKICAgICAgICAgICAgcGF5bG9hZCA9IHNlbGYuZ2V0X3NraXBfcGF5bG9hZChhY2NvdW50LCBqb2IpCiAgICAgICAgICAgIGlmIG5vdCBwYXlsb2FkOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB04bqhbyBwYXlsb2FkIGNobyBza2lwIGpvYiIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJCiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5hcGlfcmVxdWVzdCh1cmwsICJQT1NUIiwgcGF5bG9hZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN1Y2Nlc3MiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBo4buneSBqb2Ige2pvYi5nZXQoJ2lkJyl9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkjhu6d5IGpvYiB7am9iLmdldCgnaWQnKX0gdGjhuqV0IGLhuqFpOiB7cmVzcG9uc2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBo4buneSBqb2IiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGdldF9hcGlfYmFzZV91cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBn4buRYyBj4bunYSBBUEkgR29MaWtlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVUkwgZ+G7kWMKICAgICAgICAiIiIKICAgICAgICBpbXBvcnQgY29uZmlnCiAgICAgICAgcmV0dXJuIGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L3tzZWxmLmFwcF9uYW1lfSIKICAgIAogICAgZGVmIGdldF9hY2NvdW50X3VybChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgVVJMIEFQSSB0w6BpIGtob+G6o24gY+G7p2EgR29MaWtlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVUkwgQVBJIHTDoGkga2hv4bqjbgogICAgICAgICIiIgogICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9LWFjY291bnQiCiAgICAKICAgIGRlZiBnZXRfam9ic191cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgam9icyBj4bunYSBHb0xpa2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgam9icwogICAgICAgICIiIgogICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0vYWR2ZXJ0aXNpbmcvcHVibGlzaGVycy97c2VsZi5hcHBfbmFtZX0vam9icyIKICAgIAogICAgZGVmIGdldF9qb2JfcmVwb3J0X3VybChzZWxmLCBqb2JfaWQ6IHN0cikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgYsOhbyBjw6FvIGpvYiBj4bunYSBHb0xpa2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2JfaWQ6IElEIGPhu6dhIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgYsOhbyBjw6FvIGpvYgogICAgICAgICIiIgogICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9L2pvYnMve2pvYl9pZH0vcmVwb3J0IgogICAgCiAgICBkZWYgZ2V0X2pvYl9wYXJhbXMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRoYW0gc+G7kSDEkeG7gyBn4buNaSBBUEkgbOG6pXkgam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IFRoYW0gc+G7kQogICAgICAgICIiIgogICAgICAgICMgTeG6t2MgxJHhu4tuaCBraMO0bmcgY8OzIHRoYW0gc+G7kSwgY+G6p24gb3ZlcnJpZGUg4bufIGzhu5twIGNvbgogICAgICAgIHJldHVybiB7fQogICAgCiAgICBkZWYgZ2V0X2FjY291bnRzX2Zyb21fZGV2aWNlKHNlbGYpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIlBoxrDGoW5nIHRo4bupYyBjxqEgc+G7nyDEkeG7gyBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiwgY+G6p24gb3ZlcnJpZGUg4bufIGNsYXNzIGNvbiIiIgogICAgICAgIHJldHVybiBbXQogICAgCiAgICBkZWYgcGVyZm9ybV9jYXJlKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKToKICAgICAgICAiIiJOdcO0aSB0w6BpIGtob+G6o24sIGPhuqduIG92ZXJyaWRlIOG7nyBjbGFzcyBjb24iIiIKICAgICAgICBwYXNzCiAgICAKICAgIGRlZiBzZXRfc2xlZXBfZnVuY3Rpb24oc2VsZiwgc2xlZXBfZnVuYzogQ2FsbGFibGVbW2Zsb2F0XSwgYm9vbF0pOgogICAgICAgICIiIgogICAgICAgIMSQ4bq3dCBow6BtIHNsZWVwIHTDuXkgY2jhu4luaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHNsZWVwX2Z1bmM6IEjDoG0gc2xlZXAgbmjhuq1uIG3hu5l0IHRoYW0gc+G7kSBsw6Agc+G7kSBnacOieSB2w6AgdHLhuqMgduG7gSBUcnVlIG7hur91IHNsZWVwIMSR4bunIHRo4budaSBnaWFuLAogICAgICAgICAgICAgICAgICAgICAgICBGYWxzZSBu4bq/dSBi4buLIGThu6tuZyBs4bqhaQogICAgICAgICIiIgogICAgICAgIHNlbGYuX3NsZWVwX2Z1bmMgPSBzbGVlcF9mdW5jCiAgICAgICAgCiAgICBkZWYgc2FmZV9zbGVlcChzZWxmLCBzZWNvbmRzOiBmbG9hdCkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBOZ+G7pyBhbiB0b8OgbiwgY8OzIHRo4buDIGThu6tuZyBs4bqhaSBuZ2F5IGzhuq1wIHThu6ljCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2Vjb25kczogU+G7kSBnacOieSBj4bqnbiBuZ+G7pwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IG5n4bunIMSR4bunIHRo4budaSBnaWFuLCBGYWxzZSBu4bq/dSBi4buLIGThu6tuZyBs4bqhaQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9zbGVlcF9mdW5jKHNlY29uZHMpCiAgICAKICAgIGRlZiBzd2l0Y2hfdG9fYWNjb3VudChzZWxmLCB0YXJnZXRfYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ2h1eeG7g24gxJHhu5VpIHNhbmcgdMOgaSBraG/huqNuIG3hu6VjIHRpw6p1CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFyZ2V0X2FjY291bnQ6IFTDoGkga2hv4bqjbiBj4bqnbiBjaHV54buDbiDEkeG6v24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBjaHV54buDbiDEkeG7lWkgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkGFuZyBjaHV54buDbiDEkeG7lWkgc2FuZyB0w6BpIGtob+G6o24ge3RhcmdldF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJ3Vua25vd24nKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6t3QgdGjhu51pIGdpYW4gY2jhu50gdOG7kWkgxJFhIChnacOieSkKICAgICAgICAgICAgdGltZW91dCA9IDYwCiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB1c2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcAogICAgICAgICAgICBjdXJyZW50X3VzZXJuYW1lID0gc2VsZi5nZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoKQogICAgICAgICAgICB0YXJnZXRfdXNlcm5hbWUgPSB0YXJnZXRfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IMSRw6MgxJHEg25nIG5o4bqtcCDEkcO6bmcgdMOgaSBraG/huqNuIHLhu5NpLCBraMO0bmcgY+G6p24gY2h1eeG7g24gxJHhu5VpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfdXNlcm5hbWUgYW5kIGN1cnJlbnRfdXNlcm5hbWUgPT0gdGFyZ2V0X3VzZXJuYW1lOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgxJHEg25nIG5o4bqtcCB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gcuG7k2kiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgY2jGsGEgxJHEg25nIG5o4bqtcCDEkcO6bmcgdMOgaSBraG/huqNuLCB0aOG7sWMgaGnhu4duIGNodXnhu4NuIMSR4buVaQogICAgICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgUGjGsMahbmcgdGjhu6ljIG7DoHkgc+G6vSDEkcaw4bujYyBnaGkgxJHDqCBi4bufaSBs4bubcCBjb24gdMO5eSB0aGVvIOG7qW5nIGThu6VuZwogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLl9wZXJmb3JtX2FjY291bnRfc3dpdGNoKHRhcmdldF9hY2NvdW50KQogICAgICAgICAgICAgICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgICAgICMgxJDhu6NpIG3hu5l0IGNow7p0IMSR4buDIOG7qW5nIGThu6VuZyBsb2FkIHhvbmcKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgeGVtIMSRw6MgY2h1eeG7g24gxJHDum5nIHTDoGkga2hv4bqjbiBjaMawYQogICAgICAgICAgICAgICAgICAgICAgICBuZXdfdXNlcm5hbWUgPSBzZWxmLmdldF9jdXJyZW50X2xvZ2dlZF9pbl91c2VybmFtZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBuZXdfdXNlcm5hbWUgYW5kIG5ld191c2VybmFtZSA9PSB0YXJnZXRfdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBjaHV54buDbiBzYW5nIHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSRxINuZyBuaOG6rXAgdHJvbmcgREIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIucmVzZXRfbG9naW5fc3RhdHVzX2J5X2FwcChzZWxmLmFwcF9uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudCh0YXJnZXRfYWNjb3VudFsiaWQiXSwgeyJpc19sb2dpbiI6IFRydWV9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgY2jGsGEgdGjDoG5oIGPDtG5nLCDEkeG7o2kgbeG7mXQgY2jDunQgcuG7k2kgdGjhu60gbOG6oWkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBjaHV54buDbiB0w6BpIGtob+G6o246IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGNodXnhu4NuIHNhbmcgdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IHNhdSB7dGltZW91dH0gZ2nDonkiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSBjaHV54buDbiB0w6BpIGtob+G6o24iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9wZXJmb3JtX2FjY291bnRfc3dpdGNoKHNlbGYsIHRhcmdldF9hY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGPDoWMgdGhhbyB0w6FjIFVJIMSR4buDIGNodXnhu4NuIHTDoGkga2hv4bqjbgogICAgICAgIFBoxrDGoW5nIHRo4bupYyBuw6B5IGPhuqduIMSRxrDhu6NjIGdoaSDEkcOoIGLhu59pIGzhu5twIGNvbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhcmdldF9hY2NvdW50OiBUw6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24gxJHhur9uCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICAjIFBoxrDGoW5nIHRo4bupYyBjxqEgc+G7nyBjaOG7iSBsb2cgY+G6o25oIGLDoW8KICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiUGjGsMahbmcgdGjhu6ljIF9wZXJmb3JtX2FjY291bnRfc3dpdGNoIGNoxrBhIMSRxrDhu6NjIHRyaeG7g24ga2hhaSBjaG8ge3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKHNlbGYpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdXNlcm5hbWUgY+G7p2EgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHIgaG/hurdjIE5vbmU6IFVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wLCBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgIyBQaMawxqFuZyB0aOG7qWMgY8ahIHPhu58gY2jhu4kgbG9nIGPhuqNuaCBiw6FvCiAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIlBoxrDGoW5nIHRo4bupYyBnZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUgY2jGsGEgxJHGsOG7o2MgdHJp4buDbiBraGFpIGNobyB7c2VsZi5fX2NsYXNzX18uX19uYW1lX199IikKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgcmVjb3JkX2pvYl9oaXN0b3J5KHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldLCByZXN1bHQ6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgR2hpIGzhuqFpIGzhu4tjaCBz4butIGpvYiB2w6BvIGRhdGFiYXNlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICByZXN1bHQ6IEvhur90IHF14bqjIHRo4buxYyBoaeG7h24gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVVJRCBj4bunYSBi4bqjbiBnaGkgbOG7i2NoIHPhu60gam9iIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgZGV2aWNlX2lkCiAgICAgICAgICAgIGRldmljZV9pZCA9IHNlbGYuZGIuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHXhuqluIGLhu4sgZOG7ryBsaeG7h3Ugam9iIGhpc3RvcnkKICAgICAgICAgICAgam9iX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAiYWNjb3VudF91dWlkIjogYWNjb3VudC5nZXQoImFjY291bnRfdXVpZCIsICIiKSwKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiBkZXZpY2VfaWQsCiAgICAgICAgICAgICAgICAiYXBwIjogc2VsZi5hcHBfbmFtZSwKICAgICAgICAgICAgICAgICJqb2JfaWQiOiBqb2IuZ2V0KCJpZCIsICIiKSwKICAgICAgICAgICAgICAgICJqb2JfdHlwZSI6IGpvYi5nZXQoInR5cGUiLCAiIiksCiAgICAgICAgICAgICAgICAib2JqZWN0X2lkIjogam9iLmdldCgib2JqZWN0X2lkIiwgIiIpLAogICAgICAgICAgICAgICAgImxpbmsiOiBqb2IuZ2V0KCJsaW5rIiwgIiIpLAogICAgICAgICAgICAgICAgInN0YXR1cyI6IHJlc3VsdC5nZXQoInN0YXR1cyIsIDApLAogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiByZXN1bHQuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgInByaWNlIjogam9iLmdldCgicHJpY2VfYWZ0ZXJfY29zdCIsIDApLAogICAgICAgICAgICAgICAgImVycm9yX21lc3NhZ2UiOiByZXN1bHQuZ2V0KCJtZXNzYWdlIiwgIiIpIGlmIG5vdCByZXN1bHQuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpIGVsc2UgIiIsCiAgICAgICAgICAgICAgICAiY3JlYXRlZF9hdCI6IGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlICAjIMSQ4bqjbSBi4bqjbyB0cuG6oW5nIHRow6FpIGzDoCBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgam9iX3V1aWQgPSBzZWxmLmRiLmFkZF9qb2JfaGlzdG9yeShqb2JfZGF0YSkKICAgICAgICAgICAgaWYgam9iX3V1aWQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIsSQw6MgbMawdSBs4buLY2ggc+G7rSBqb2Ige2pvYi5nZXQoJ2lkJyl9IHbDoG8gZGF0YWJhc2UgduG7m2kgVVVJRDoge2pvYl91dWlkfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHRo4buDIGzGsHUgbOG7i2NoIHPhu60gam9iIHtqb2IuZ2V0KCdpZCcpfSB2w6BvIGRhdGFiYXNlIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBqb2JfdXVpZAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgZ2hpIGzhu4tjaCBz4butIGpvYiIpCiAgICAgICAgICAgIHJldHVybiAiIgoKICAgIGRlZiByZXBvcnRfam9iX2NvbXBsZXRlZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSwgcmVwb3J0X2RhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBCw6FvIGPDoW8gam9iIMSRw6MgaG/DoG4gdGjDoG5oCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICByZXBvcnRfZGF0YTogROG7ryBsaeG7h3UgYsOhbyBjw6FvCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyBiw6FvIGPDoW8gdOG7qyBBUEkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgam9iX2lkIHThu6sgam9iCiAgICAgICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICAgICAgaWYgbm90IGpvYl9pZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgam9iX2lkIHRyb25nIGpvYiIpCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6ICJLaMO0bmcgdMOsbSB0aOG6pXkgam9iX2lkIHRyb25nIGpvYiJ9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHXhuqluIGLhu4sgZOG7ryBsaeG7h3UgYsOhbyBjw6FvCiAgICAgICAgICAgIHBheWxvYWQgPSB7CiAgICAgICAgICAgICAgICAiaWQiOiBqb2JfaWQsCiAgICAgICAgICAgICAgICAic3RhdHVzIjogVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGThu68gbGnhu4d1IGLDoW8gY8OhbyBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgcmVwb3J0X2RhdGE6CiAgICAgICAgICAgICAgICBwYXlsb2FkLnVwZGF0ZShyZXBvcnRfZGF0YSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSSBiw6FvIGPDoW8gam9iIMSRw6MgaG/DoG4gdGjDoG5oCiAgICAgICAgICAgIHVybCA9IGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L2FkdmVydGlzaW5nL3B1Ymxpc2hlcnMve3NlbGYuYXBwX25hbWV9L2NvbXBsZXRlLWpvYnMiCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuZ29saWtlX3NlcnZpY2UuYXBpX3JlcXVlc3QodXJsLCBtZXRob2Q9IlBPU1QiLCBwYXlsb2FkPXBheWxvYWQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcmVzdWx0OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBiw6FvIGPDoW8gam9iIMSRw6MgaG/DoG4gdGjDoG5oIikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIktow7RuZyB0aOG7gyBiw6FvIGPDoW8gam9iIMSRw6MgaG/DoG4gdGjDoG5oIn0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBiw6FvIGPDoW8gam9iIHtqb2JfaWR9IGhvw6BuIHRow6BuaCB0aMOgbmggY8O0bmciKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJtZXNzYWdlIjogIsSQw6MgYsOhbyBjw6FvIGpvYiBob8OgbiB0aMOgbmggdGjDoG5oIGPDtG5nIiwgImRhdGEiOiByZXN1bHR9CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgYsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaCIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogZiJM4buXaSBraGkgYsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaDoge3N0cihlKX0ifQogICAgICAgICAgICAKICAgIGRlZiByZXBvcnRfam9iX3NraXBwZWQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0sIHJlYXNvbjogc3RyID0gIiIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIELDoW8gY8OhbyBqb2IgxJHDoyBi4buLIGLhu48gcXVhCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICByZWFzb246IEzDvSBkbyBi4buPIHF1YSBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIGLDoW8gY8OhbyB04burIEFQSQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBqb2JfaWQgdOG7qyBqb2IKICAgICAgICAgICAgam9iX2lkID0gam9iLmdldCgiaWQiKQogICAgICAgICAgICBpZiBub3Qgam9iX2lkOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBqb2JfaWQgdHJvbmcgam9iIikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIktow7RuZyB0w6xtIHRo4bqleSBqb2JfaWQgdHJvbmcgam9iIn0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIENodeG6qW4gYuG7iyBk4buvIGxp4buHdSBiw6FvIGPDoW8KICAgICAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICJpZCI6IGpvYl9pZAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGzDvSBkbyBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgcmVhc29uOgogICAgICAgICAgICAgICAgcGF5bG9hZFsicmVhc29uIl0gPSByZWFzb24KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSSBiw6FvIGPDoW8gam9iIMSRw6MgYuG7iyBi4buPIHF1YQogICAgICAgICAgICB1cmwgPSBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS9hZHZlcnRpc2luZy9wdWJsaXNoZXJzL3tzZWxmLmFwcF9uYW1lfS9za2lwLWpvYnMiCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuZ29saWtlX3NlcnZpY2UuYXBpX3JlcXVlc3QodXJsLCBtZXRob2Q9IlBPU1QiLCBwYXlsb2FkPXBheWxvYWQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcmVzdWx0OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBiw6FvIGPDoW8gam9iIMSRw6MgYuG7iyBi4buPIHF1YSIpCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6ICJLaMO0bmcgdGjhu4MgYsOhbyBjw6FvIGpvYiDEkcOjIGLhu4sgYuG7jyBxdWEifQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGLDoW8gY8OhbyBqb2Ige2pvYl9pZH0gYuG7iyBi4buPIHF1YSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJtZXNzYWdlIjogIsSQw6MgYsOhbyBjw6FvIGpvYiBi4buLIGLhu48gcXVhIHRow6BuaCBjw7RuZyIsICJkYXRhIjogcmVzdWx0fQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGLDoW8gY8OhbyBqb2IgxJHDoyBi4buLIGLhu48gcXVhIikKICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBmIkzhu5dpIGtoaSBiw6FvIGPDoW8gam9iIMSRw6MgYuG7iyBi4buPIHF1YToge3N0cihlKX0ifQogICAgCiAgICBkZWYgZ2V0X2FjY291bnRfbGlzdF91cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9IgogICAgICAgIAogICAgZGVmIGdldF9hY2NvdW50X2RldGFpbF91cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgY2hpIHRp4bq/dCB0w6BpIGtob+G6o24KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgY2hpIHRp4bq/dCB0w6BpIGtob+G6o24KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9LWFjY291bnQiCiAgICAgICAgCiAgICBkZWYgZ2V0X2pvYl9saXN0X3VybChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgVVJMIEFQSSBkYW5oIHPDoWNoIGpvYgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIEFQSSBkYW5oIHPDoWNoIGpvYgogICAgICAgICIiIgogICAgICAgIHJldHVybiBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS9hZHZlcnRpc2luZy9wdWJsaXNoZXJzL3tzZWxmLmFwcF9uYW1lfS9qb2JzIgogICAgICAgIAogICAgZGVmIGdldF9qb2JfcmVwb3J0X3VybChzZWxmLCBqb2JfaWQ6IHN0cikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgYsOhbyBjw6FvIGpvYgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl9pZDogSUQgY+G7p2Egam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIEFQSSBiw6FvIGPDoW8gam9iCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L3tzZWxmLmFwcF9uYW1lfS9qb2JzL3tqb2JfaWR9L3JlcG9ydCIg').decode('utf-8'))
