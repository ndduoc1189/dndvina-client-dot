import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHJlcXVlc3RzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsCmltcG9ydCB1dGlscwoKIyBU4bqhbyBsb2dnZXIgcmnDqm5nIGNobyBQcm94eVNlcnZpY2UKbG9nZ2VyID0gdXRpbHMuZ2V0X2xvZ2dlcigiUHJveHlTZXJ2aWNlIikKCmNsYXNzIFByb3h5U2VydmljZToKICAgICIiIgogICAgU2VydmljZSBxdeG6o24gbMO9IHByb3h5IHbDoCB0xrDGoW5nIHTDoWMgduG7m2kgcHJveHkgc2VydmVyCiAgICAiIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlKToKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgdOG6oW8gUHJveHlTZXJ2aWNlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZGJfc2VydmljZTogRGF0YWJhc2VTZXJ2aWNlIMSR4buDIGzGsHUgdHLhu68gZOG7ryBsaeG7h3UKICAgICAgICAgICAgaGVscGVyX3NlcnZpY2U6IEhlbHBlclNlcnZpY2UgxJHhu4MgdMawxqFuZyB0w6FjIHbhu5tpIHRoaeG6v3QgYuG7iwogICAgICAgICIiIgogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgc2VsZi5oZWxwZXIgPSBoZWxwZXJfc2VydmljZQogICAgICAgIAogICAgICAgICMgVHLhuqFuZyB0aMOhaSBwcm94eSBoaeG7h24gdOG6oWkKICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfaWQgPSBOb25lCiAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X25hbWUgPSBOb25lCiAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlID0gTm9uZSAgIyBUYWJsZSBuYW1lIMSRxrDhu6NjIGPhuqVwIHThu6sgcHJveHkgc2VydmVyCiAgICAgICAgc2VsZi5wcm94eV9sYXN0X3VwZGF0ZSA9IDAgICMgVGjhu51pIGdpYW4gdXBkYXRlIGN14buRaSBjw7luZwogICAgICAgIAogICAgICAgICMgxJDhur9tIHPhu5EgbOG6p24gdGjhuqV0IGLhuqFpIGtoaSBzZXR1cCBwcm94eQogICAgICAgIHNlbGYucHJveHlfc2V0dXBfZmFpbF9jb3VudCA9IDAKICAgICAgICAKICAgICAgICAjIFjDs2EgcHJveHkgdGFibGUgbmFtZSBjxakga2jhu49pIGRldmljZSBjb25maWcga2hpIGto4bufaSB04bqhbwogICAgICAgIHNlbGYuZGIuc2V0X2RldmljZV9jb25maWcoInByb3h5X3RhYmxlX25hbWUiLCBOb25lKQogICAgCiAgICBkZWYgX3Byb3h5X2FwaV9jYWxsKHNlbGYsIGVuZHBvaW50OiBzdHIsIGRhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgR+G7jWkgQVBJIHByb3h5IHNlcnZlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGVuZHBvaW50OiBFbmRwb2ludCBBUEkgKHJlZ2lzdGVyLCB1cGRhdGUsIHVucmVnaXN0ZXIsIHJlc2V0LWlwKQogICAgICAgICAgICBkYXRhOiBE4buvIGxp4buHdSBn4butaQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0IHJlc3BvbnNlIGhv4bq3YyBOb25lIG7hur91IGzhu5dpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcm94eV9zZXJ2ZXIgPSBzZWxmLmRiLmdldCgicHJveHlfc2VydmVyIiwgImh0dHA6Ly8xMC4wLjAuNTo5MDMyIikKICAgICAgICAgICAgdXJsID0gZiJ7cHJveHlfc2VydmVyfS97ZW5kcG9pbnR9IgogICAgICAgICAgICAKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwganNvbj1kYXRhLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiUHJveHkgQVBJIHtlbmRwb2ludH0gZmFpbGVkIHdpdGggc3RhdHVzIHtyZXNwb25zZS5zdGF0dXNfY29kZX06IHtyZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7jWkgUHJveHkgQVBJIHtlbmRwb2ludH06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGRlZiByZWdpc3Rlcl9wcm94eShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQxINuZyBrw70gduG7m2kgcHJveHkgc2VydmVyIMSR4buDIMSRxrDhu6NjIGPhuqVwIHBow6F0IHRhYmxlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkcaw4bujYyBj4bqlcCB0YWJsZSBob+G6t2MgxJHDoyBjw7MgdGFibGUsIEZhbHNlIG7hur91IHbDoG8gcXVldWUgaG/hurdjIGzhu5dpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgaGVscGVyIHNlcnZpY2UKICAgICAgICAgICAgbG9jYWxfaXAgPSBzZWxmLmhlbHBlci5nZXRfbG9jYWxfaXAoKQogICAgICAgICAgICBpZiBub3QgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBs4bqleSBsb2NhbCBJUCwgYuG7jyBxdWEgxJHEg25nIGvDvSBwcm94eSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGRhdGEgPSB7ImxvY2FsX2lwIjogbG9jYWxfaXB9CiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5fcHJveHlfYXBpX2NhbGwoInJlZ2lzdGVyIiwgZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCByZXNwb25zZToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHN0YXR1cyA9IHJlc3BvbnNlLmdldCgic3RhdHVzIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN0YXR1cyA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICAjIMSQxrDhu6NjIGPhuqVwIHRhYmxlIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgdGFibGVfbmFtZSA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoInRhYmxlX25hbWUiKQogICAgICAgICAgICAgICAgYWN0aW9uID0gcmVzcG9uc2UuZ2V0KCJkYXRhIiwge30pLmdldCgiYWN0aW9uIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlID0gdGFibGVfbmFtZQogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X25hbWUgPSBmInt0YWJsZV9uYW1lfSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMxrB1IHByb3h5IHRhYmxlIG5hbWUgdsOgbyBkZXZpY2UgY29uZmlnIMSR4buDIGfhu61pIGzDqm4gc2VydmVyCiAgICAgICAgICAgICAgICBzZWxmLmRiLnNldF9kZXZpY2VfY29uZmlnKCJwcm94eV90YWJsZV9uYW1lIiwgdGFibGVfbmFtZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQcm94eSDEkcOjIMSRxrDhu6NjIGPhuqVwIHRhYmxlOiB7dGFibGVfbmFtZX0gKGFjdGlvbjoge2FjdGlvbn0pIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBH4buNaSByZXNldC1pcCDEkeG7gyDEkeG7lWkgSVAgbeG7m2kKICAgICAgICAgICAgICAgIGlmIHRhYmxlX25hbWU6CiAgICAgICAgICAgICAgICAgICAgcHBvZV9uYW1lID0gdGFibGVfbmFtZS5yZXBsYWNlKCJ0b18iLCAiIikgICMgQ2h1eeG7g24gInRvX3BwcG9lMiIgdGjDoG5oICJwcHBvZTIiCiAgICAgICAgICAgICAgICAgICAgcmVzZXRfZGF0YSA9IHsicHBvZV9uYW1lIjogZiJ7cHBvZV9uYW1lfSJ9IAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXNldF9yZXNwb25zZSA9IHNlbGYuX3Byb3h5X2FwaV9jYWxsKCJyZXNldC1pcCIsIHJlc2V0X2RhdGEpCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzZXRfcmVzcG9uc2UgYW5kIHJlc2V0X3Jlc3BvbnNlLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgcmVzZXQgSVAgY2hvIHtyZXNldF9kYXRhWydwcG9lX25hbWUnXX0iKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHRo4buDIHJlc2V0IElQIGNobyB7cmVzZXRfZGF0YVsncHBvZV9uYW1lJ119IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmIHN0YXR1cyA9PSAicXVldWVkIjoKICAgICAgICAgICAgICAgICMgVsOgbyBxdWV1ZSBjaOG7nQogICAgICAgICAgICAgICAgcXVldWVfcG9zaXRpb24gPSByZXNwb25zZS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJxdWV1ZV9wb3NpdGlvbiIsIDApCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlByb3h5IHNlcnZlciBmdWxsLCB2w6BvIGjDoG5nIMSR4bujaSB24buLIHRyw60ge3F1ZXVlX3Bvc2l0aW9ufSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiUHJveHkgcmVnaXN0ZXIgdGjhuqV0IGLhuqFpOiB7cmVzcG9uc2UuZ2V0KCdtZXNzYWdlJywgJ1Vua25vd24gZXJyb3InKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSDEkcSDbmcga8O9IHByb3h5IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB1cGRhdGVfcHJveHkoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBD4bqtcCBuaOG6rXQgdGltZXN0YW1wIHPhu60gZOG7pW5nIHByb3h5CiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB1cGRhdGUgdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgaGVscGVyIHNlcnZpY2UKICAgICAgICAgICAgbG9jYWxfaXAgPSBzZWxmLmhlbHBlci5nZXRfbG9jYWxfaXAoKQogICAgICAgICAgICBpZiBub3QgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIGzhuqV5IGxvY2FsIElQLCBi4buPIHF1YSB1cGRhdGUgcHJveHkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBkYXRhID0geyJsb2NhbF9pcCI6IGxvY2FsX2lwfQogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuX3Byb3h5X2FwaV9jYWxsKCJ1cGRhdGUiLCBkYXRhKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzcG9uc2UgYW5kIHJlc3BvbnNlLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgc2VsZi5wcm94eV9sYXN0X3VwZGF0ZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgICAgICAjIExvZyB0aMO0bmcgdGluIHThu6sgcmVzcG9uc2UgbuG6v3UgY8OzCiAgICAgICAgICAgICAgICBkYXRhID0gcmVzcG9uc2UuZ2V0KCJkYXRhIiwge30pCiAgICAgICAgICAgICAgICB0YWJsZV9uYW1lID0gZGF0YS5nZXQoInRhYmxlX25hbWUiLCAidW5rbm93biIpCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJQcm94eSB1cGRhdGUgdGjDoG5oIGPDtG5nIGNobyB0YWJsZToge3RhYmxlX25hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlByb3h5IHVwZGF0ZSB0aOG6pXQgYuG6oWk6IHtyZXNwb25zZS5nZXQoJ21lc3NhZ2UnKSBpZiByZXNwb25zZSBlbHNlICdObyByZXNwb25zZSd9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSB1cGRhdGUgcHJveHk6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdW5yZWdpc3Rlcl9wcm94eShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEjhu6d5IMSRxINuZyBrw70gdsOgIGdp4bqjaSBwaMOzbmcgdGFibGUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHVucmVnaXN0ZXIgdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgaGVscGVyIHNlcnZpY2UKICAgICAgICAgICAgbG9jYWxfaXAgPSBzZWxmLmhlbHBlci5nZXRfbG9jYWxfaXAoKQogICAgICAgICAgICBpZiBub3QgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIGzhuqV5IGxvY2FsIElQLCBi4buPIHF1YSB1bnJlZ2lzdGVyIHByb3h5IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgZGF0YSA9IHsibG9jYWxfaXAiOiBsb2NhbF9pcH0KICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9wcm94eV9hcGlfY2FsbCgidW5yZWdpc3RlciIsIGRhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICByZWxlYXNlZF90YWJsZSA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoInJlbGVhc2VkX3RhYmxlIikKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyB1bnJlZ2lzdGVyIHByb3h5IHbDoCBnaeG6o2kgcGjDs25nIHRhYmxlOiB7cmVsZWFzZWRfdGFibGV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBSZXNldCB0cuG6oW5nIHRow6FpIHByb3h5CiAgICAgICAgICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUgPSBOb25lCiAgICAgICAgICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfbmFtZSA9IE5vbmUKICAgICAgICAgICAgICAgIHNlbGYucHJveHlfbGFzdF91cGRhdGUgPSAwCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgWMOzYSBwcm94eSB0YWJsZSBuYW1lIGto4buPaSBkZXZpY2UgY29uZmlnCiAgICAgICAgICAgICAgICBzZWxmLmRiLnNldF9kZXZpY2VfY29uZmlnKCJwcm94eV90YWJsZV9uYW1lIiwgTm9uZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiUHJveHkgdW5yZWdpc3RlciB0aOG6pXQgYuG6oWk6IHtyZXNwb25zZS5nZXQoJ21lc3NhZ2UnKSBpZiByZXNwb25zZSBlbHNlICdObyByZXNwb25zZSd9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSB1bnJlZ2lzdGVyIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHJlc2V0X2lwKHNlbGYsIHRhYmxlX25hbWU6IHN0ciA9IE5vbmUpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUmVzZXQgSVAgY2hvIHByb3h5IGhp4buHbiB04bqhaSBob+G6t2MgdGFibGUgxJHGsOG7o2MgY2jhu4kgxJHhu4tuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhYmxlX25hbWU6IFTDqm4gdGFibGUgY+G6p24gcmVzZXQgSVAgKG9wdGlvbmFsLCBu4bq/dSBraMO0bmcgY8OzIHPhur0gZMO5bmcgdGFibGUgaGnhu4duIHThuqFpKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHJlc2V0IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFPhu60gZOG7pW5nIHRhYmxlIMSRxrDhu6NjIGNo4buJIMSR4buLbmggaG/hurdjIHRhYmxlIGhp4buHbiB04bqhaQogICAgICAgICAgICB0YXJnZXRfdGFibGUgPSB0YWJsZV9uYW1lIG9yIHNlbGYuY3VycmVudF9wcm94eV90YWJsZQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHRhcmdldF90YWJsZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIGPDsyB0YWJsZSBwcm94eSDEkeG7gyByZXNldCBJUCIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2h1eeG7g24gdGFibGUgbmFtZSB0aMOgbmggcHBvZSBuYW1lCiAgICAgICAgICAgIHBwb2VfbmFtZSA9IHRhcmdldF90YWJsZS5yZXBsYWNlKCJ0b18iLCAiIikgICMgQ2h1eeG7g24gInRvX3BwcG9lMiIgdGjDoG5oICJwcHBvZTIiCiAgICAgICAgICAgIHJlc2V0X2RhdGEgPSB7InBwb2VfbmFtZSI6IGYie3Bwb2VfbmFtZX0ifQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyByZXNldCBJUCBjaG8gdGFibGU6IHt0YXJnZXRfdGFibGV9IChwcG9lOiB7cHBvZV9uYW1lfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzZXRfcmVzcG9uc2UgPSBzZWxmLl9wcm94eV9hcGlfY2FsbCgicmVzZXQtaXAiLCByZXNldF9kYXRhKQogICAgICAgICAgICBpZiByZXNldF9yZXNwb25zZSBhbmQgcmVzZXRfcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgcmVzZXQgSVAgY2hvIHtwcG9lX25hbWV9IHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gcmVzZXRfcmVzcG9uc2UuZ2V0KCdtZXNzYWdlJykgaWYgcmVzZXRfcmVzcG9uc2UgZWxzZSAnTm8gcmVzcG9uc2UnCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgcmVzZXQgSVAgY2hvIHtwcG9lX25hbWV9OiB7ZXJyb3JfbXNnfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSByZXNldCBJUCBjaG8gdGFibGU6IHt0YWJsZV9uYW1lIG9yIHNlbGYuY3VycmVudF9wcm94eV90YWJsZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGNoZWNrX3Byb3h5X3JlcXVpcmVtZW50KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6AgxJHEg25nIGvDvSBwcm94eSBu4bq/dSBj4bqnbgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHByb3h5IGhv4bq3YyBraMO0bmcgY+G6p24gcHJveHksIEZhbHNlIG7hur91IGPhuqduIHByb3h5IG5oxrBuZyBjaMawYSDEkcaw4bujYyBj4bqlcAogICAgICAgICIiIgogICAgICAgIHVzZV9wcm94eSA9IHNlbGYuZGIuZ2V0KCJ1c2VfcHJveHkiLCBGYWxzZSkKICAgICAgICAKICAgICAgICBpZiBub3QgdXNlX3Byb3h5OgogICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBLaMO0bmcgY+G6p24gcHJveHkKICAgICAgICAgICAgCiAgICAgICAgIyBO4bq/dSDEkcOjIGPDsyB0YWJsZSB0aMOsIHJldHVybiBUcnVlCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAjIENoxrBhIGPDsyB0YWJsZSwgdGjhu60gxJHEg25nIGvDvQogICAgICAgIHJldHVybiBzZWxmLnJlZ2lzdGVyX3Byb3h5KCkKICAgIAogICAgZGVmIGdldF9wcm94eV9kaXNwbGF5X25hbWUoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHTDqm4gaGnhu4NuIHRo4buLIGNobyBwcm94eSBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFTDqm4gaGnhu4NuIHRo4buLIGPhu6dhIHByb3h5CiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X25hbWU6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmN1cnJlbnRfcHJveHlfbmFtZQogICAgICAgIGVsaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICByZXR1cm4gZiJ7c2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlfSIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIlVua25vd24iCiAgICAKICAgIGRlZiBzZXR1cF9wcm94eV9mb3Jfc2Vzc2lvbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgY2hvIHBoacOqbiBsw6BtIHZp4buHYwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGhp4bq/dCBs4bqtcCB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgICMgTuG6v3UgxJHDoyBjw7MgdGFibGUgcHJveHkgdGjDrCBzZXR1cCB4b25nIHLhu5NpCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICBwcm94eV9uYW1lID0gc2VsZi5nZXRfcHJveHlfZGlzcGxheV9uYW1lKCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQcm94eSB7cHJveHlfbmFtZX0gxJHDoyBz4bq1biBzw6BuZyBjaG8gcGhpw6puIGzDoG0gdmnhu4djIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgIyBO4bq/dSBjaMawYSBjw7MgdGjDrCDEkcSDbmcga8O9CiAgICAgICAgcmV0dXJuIHNlbGYucmVnaXN0ZXJfcHJveHkoKQogICAgCiAgICBkZWYgcmVsZWFzZV9wcm94eV9hZnRlcl9zZXNzaW9uKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgR2nhuqNpIHBow7NuZyBwcm94eSBzYXUga2hpIGvhur90IHRow7pjIHBoacOqbiBsw6BtIHZp4buHYwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgZ2nhuqNpIHBow7NuZyB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICAgICAgcHJveHlfbmFtZSA9IHNlbGYuZ2V0X3Byb3h5X2Rpc3BsYXlfbmFtZSgpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGdp4bqjaSBwaMOzbmcgcHJveHkge3Byb3h5X25hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBH4buNaSBBUEkgdW5yZWdpc3RlcgogICAgICAgICAgICAgICAgaWYgc2VsZi51bnJlZ2lzdGVyX3Byb3h5KCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGdp4bqjaSBwaMOzbmcgcHJveHkge3Byb3h5X25hbWV9IHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJHaeG6o2kgcGjDs25nIHByb3h5IHtwcm94eV9uYW1lfSB0aOG6pXQgYuG6oWkiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJLaMO0bmcgY8OzIHByb3h5IMSR4buDIGdp4bqjaSBwaMOzbmciKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgZ2nhuqNpIHBow7NuZyBwcm94eSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgaXNfcHJveHlfYWN0aXZlKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIHByb3h5IMSRYW5nIGhv4bqhdCDEkeG7mW5nIGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHByb3h5IMSRYW5nIGhv4bqhdCDEkeG7mW5nLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gYm9vbChzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUpCiAgICAKICAgIGRlZiBnZXRfcHJveHlfaW5mbyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIHByb3h5IGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBUaMO0bmcgdGluIHByb3h5CiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgInByb3h5X2lkIjogc2VsZi5jdXJyZW50X3Byb3h5X2lkLAogICAgICAgICAgICAicHJveHlfbmFtZSI6IHNlbGYuY3VycmVudF9wcm94eV9uYW1lLAogICAgICAgICAgICAicHJveHlfdGFibGUiOiBzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUsCiAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IHNlbGYucHJveHlfbGFzdF91cGRhdGUsCiAgICAgICAgICAgICJkaXNwbGF5X25hbWUiOiBzZWxmLmdldF9wcm94eV9kaXNwbGF5X25hbWUoKSwKICAgICAgICAgICAgImlzX2FjdGl2ZSI6IHNlbGYuaXNfcHJveHlfYWN0aXZlKCkKICAgICAgICB9CiAgICAKICAgIGRlZiBmb3JjZV9yZXNldF9jdXJyZW50X2lwKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQuG6r3QgYnXhu5ljIHJlc2V0IElQIGNobyBwcm94eSBoaeG7h24gdOG6oWkgKGPDsyB0aOG7gyBn4buNaSB0cm9uZyBxdcOhIHRyw6xuaCBsw6BtIHZp4buHYykKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHJlc2V0IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuY3VycmVudF9wcm94eV90YWJsZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgcHJveHkgxJFhbmcgaG/huqF0IMSR4buZbmcgxJHhu4MgcmVzZXQgSVAiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIkLhuq90IGJ14buZYyByZXNldCBJUCBjaG8gcHJveHkgaGnhu4duIHThuqFpIHRyb25nIHF1w6EgdHLDrG5oIGzDoG0gdmnhu4djIikKICAgICAgICByZXR1cm4gc2VsZi5yZXNldF9pcCgpCiAgICAKICAgIGRlZiBnZXRfcHJveHlfc3RhdHVzKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0cuG6oW5nIHRow6FpIHByb3h5IGhp4buHbiB04bqhaSBkxrDhu5tpIGThuqFuZyBzdHJpbmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFRy4bqhbmcgdGjDoWkgcHJveHkKICAgICAgICAiIiIKICAgICAgICBpZiBub3Qgc2VsZi5kYi5nZXQoInVzZV9wcm94eSIsIEZhbHNlKToKICAgICAgICAgICAgcmV0dXJuICJLaMO0bmcgc+G7rSBk4bulbmcgcHJveHkiCiAgICAgICAgZWxpZiBub3Qgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICByZXR1cm4gIkNoxrBhIGPDsyBwcm94eSIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gZiLEkGFuZyBz4butIGThu6VuZyBwcm94eToge3NlbGYuZ2V0X3Byb3h5X2Rpc3BsYXlfbmFtZSgpfSIK').decode('utf-8'))
