import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBMaXN0CmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCmZyb20gdXRpbHMgaW1wb3J0IExvZ0xldmVsLCBMb2dnZXIKCiMgVOG6oW8gbG9nZ2VyIHJpw6puZyBjaG8gR29MaWtlU2VydmljZQpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJHb0xpa2VTZXJ2aWNlIikKCiMgS2nhu4NtIHRyYSB2w6AgaW1wb3J0IGPDoWMgdGjGsCB2aeG7h24gY+G6p24gdGhp4bq/dAp0cnk6CiAgICBpbXBvcnQgcHljaHJvbWUKICAgIFBZQ0hST01FX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLndhcm5pbmcoIlRoxrAgdmnhu4duIHB5Y2hyb21lIGtow7RuZyBraOG6oyBk4bulbmcuIEjDo3kgY8OgaSDEkeG6t3QgYuG6sW5nIGzhu4duaDogcGlwIGluc3RhbGwgcHljaHJvbWUiKQogICAgUFlDSFJPTUVfQVZBSUxBQkxFID0gRmFsc2UKCnRyeToKICAgIGltcG9ydCBjbG91ZHNjcmFwZXIKICAgIENMT1VEU0NSQVBFUl9BVkFJTEFCTEUgPSBUcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIGxvZ2dlci53YXJuaW5nKCJUaMawIHZp4buHbiBjbG91ZHNjcmFwZXIga2jDtG5nIGto4bqjIGThu6VuZy4gSMOjeSBjw6BpIMSR4bq3dCBi4bqxbmcgbOG7h25oOiBwaXAgaW5zdGFsbCBjbG91ZHNjcmFwZXIiKQogICAgQ0xPVURTQ1JBUEVSX0FWQUlMQUJMRSA9IEZhbHNlCgp0cnk6CiAgICBpbXBvcnQgY3VybF9jZmZpCiAgICBmcm9tIGN1cmxfY2ZmaSBpbXBvcnQgcmVxdWVzdHMgYXMgY3VybF9yZXF1ZXN0cwogICAgQ1VSTF9DRkZJX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLndhcm5pbmcoIlRoxrAgdmnhu4duIGN1cmxfY2ZmaSBraMO0bmcga2jhuqMgZOG7pW5nLiBIw6N5IGPDoGkgxJHhurd0IGLhurFuZyBs4buHbmg6IHBpcCBpbnN0YWxsIGN1cmwtY2ZmaSIpCiAgICBDVVJMX0NGRklfQVZBSUxBQkxFID0gRmFsc2UKCmNsYXNzIEJyb3dzZXI6CiAgICAiIiIKICAgIEzhu5twIGdp4bqjIGzhuq1wIEJyb3dzZXIgY+G7p2EgcHljaHJvbWUgbuG6v3UgdGjGsCB2aeG7h24ga2jDtG5nIGto4bqjIGThu6VuZwogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgdXJsKToKICAgICAgICBzZWxmLnVybCA9IHVybAogICAgICAgIAogICAgZGVmIGxpc3RfdGFiKHNlbGYpOgogICAgICAgIHJldHVybiBbXQogICAgICAgIAogICAgZGVmIG5ld190YWIoc2VsZik6CiAgICAgICAgcmV0dXJuIE5vbmUKCmNsYXNzIEdvTGlrZVNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBHb0xpa2UgU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGRiX3NlcnZpY2U6IERhdGFiYXNlIHNlcnZpY2UgxJHhu4MgbMawdSB0aMO0bmcgdGluCiAgICAgICAgICAgIGhlbHBlcl9zZXJ2aWNlOiBIZWxwZXIgc2VydmljZSDEkeG7gyB0xrDGoW5nIHTDoWMgduG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5kYiA9IGRiX3NlcnZpY2UKICAgICAgICBzZWxmLmhlbHBlciA9IGhlbHBlcl9zZXJ2aWNlCiAgICAgICAgCiAgICAgICAgIyBD4bqldSBow6xuaCBjaG8gQVBJIHJlcXVlc3RzCiAgICAgICAgc2VsZi51c2VyX2FnZW50ID0gIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgSykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzExNC4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiIKICAgICAgICAKICAgICAgICAjIFF1eeG6v3QgxJHhu4tuaCBz4butIGThu6VuZyBjdXJsX2NmZmkgaGF5IGNsb3Vkc2NyYXBlcgogICAgICAgICMgVHLDqm4gVGVybXV4IHRoxrDhu51uZyBz4butIGThu6VuZyBjbG91ZHNjcmFwZXIgZG8gY3VybF9jZmZpIGPDsyB0aOG7gyBraMO0bmcgdMawxqFuZyB0aMOtY2gKICAgICAgICAjIGlzX3Rlcm11eCA9IHNlbGYuX2NoZWNrX2lzX3Rlcm11eCgpCiAgICAgICAgc2VsZi51c2VfY3VybF9jZmZpID0gQ1VSTF9DRkZJX0FWQUlMQUJMRQogICAgICAgIAogICAgICAgICMgS2jhu59pIHThuqFvIGNsaWVudAogICAgICAgIGlmIG5vdCBzZWxmLnVzZV9jdXJsX2NmZmkgYW5kIENMT1VEU0NSQVBFUl9BVkFJTEFCTEU6CiAgICAgICAgICAgIHNlbGYuY2xpZW50ID0gY2xvdWRzY3JhcGVyLmNyZWF0ZV9zY3JhcGVyKAogICAgICAgICAgICAgICAgYnJvd3Nlcj17CiAgICAgICAgICAgICAgICAgICAgJ2Jyb3dzZXInOiAnY2hyb21lJywKICAgICAgICAgICAgICAgICAgICAncGxhdGZvcm0nOiAnYW5kcm9pZCcsCiAgICAgICAgICAgICAgICAgICAgJ2Rlc2t0b3AnOiBGYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBGYWxsYmFjayB0byByZWd1bGFyIHJlcXVlc3RzIGlmIG5laXRoZXIgaXMgYXZhaWxhYmxlCiAgICAgICAgICAgIHNlbGYuY2xpZW50ID0gcmVxdWVzdHMuU2Vzc2lvbigpCiAgICAgICAgICAgIAogICAgICAgICMgQ+G6pXUgaMOsbmggdMO5eSBjaOG7jW4gY2hvIGN1cmxfY2ZmaQogICAgICAgIHNlbGYuaW1wZXJzb25hdGUgPSAiY2hyb21lMTEwIgogICAgICAgIAogICAgICAgICMgQmnhur9uIHRoZW8gZMO1aSB0aHJlYWQgcmVwb3J0CiAgICAgICAgc2VsZi5yZXBvcnRfdGhyZWFkID0gTm9uZQogICAgICAgIAogICAgICAgICMgS2jhu59pIMSR4buZbmcgdGhyZWFkIHJlcG9ydAogICAgICAgIHNlbGYuc3RhcnRfcmVwb3J0X3RocmVhZCgpCgogICAgZGVmIF9jaGVja19pc190ZXJtdXgoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSDhu6luZyBk4bulbmcgY8OzIMSRYW5nIGNo4bqheSB0csOqbiBUZXJtdXgga2jDtG5nCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkWFuZyBjaOG6oXkgdHLDqm4gVGVybXV4CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgYmnhur9uIG3DtGkgdHLGsOG7nW5nIFRFUk1VWF9WRVJTSU9OIGhv4bq3YyDEkcaw4budbmcgZOG6q24gVGVybXV4IHRyb25nIFBBVEgKICAgICAgICAgICAgaW1wb3J0IG9zCiAgICAgICAgICAgIHJldHVybiAnVEVSTVVYX1ZFUlNJT04nIGluIG9zLmVudmlyb24gb3IgJy9kYXRhL2RhdGEvY29tLnRlcm11eCcgaW4gb3MuZW52aXJvbi5nZXQoJ1BBVEgnLCAnJykKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBmZXRjaF9nb2xpa2VfaGVhZGVycyhzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGhlYWRlcnMgdOG7qyBDaHJvbWUgdsOgIGzGsHUgdsOgbyBkYXRhYmFzZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBpZiBub3QgUFlDSFJPTUVfQVZBSUxBQkxFOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBs4bqleSBHb0xpa2UgaGVhZGVyczogdGjGsCB2aeG7h24gcHljaHJvbWUga2jDtG5nIGto4bqjIGThu6VuZyIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgIGZyb20gcHljaHJvbWUgaW1wb3J0IEJyb3dzZXIKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBDaHJvbWUgxJHDoyBjw6BpIMSR4bq3dCBjaMawYQogICAgICAgICAgICBpZiBub3Qgc2VsZi5oZWxwZXIuaXNfYXBwX2luc3RhbGxlZCgiY29tLmFuZHJvaWQuY2hyb21lIik6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkNocm9tZSBjaMawYSDEkcaw4bujYyBjw6BpIMSR4bq3dCB0csOqbiB0aGnhur90IGLhu4siKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIENocm9tZSB24bubaSBsaW5rIEdvTGlrZSB0cuG7sWMgdGnhur9wIGLhurFuZyBBREIKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk3hu58gQ2hyb21lIHbhu5tpIGxpbmsgR29MaWtlIHRy4buxYyB0aeG6v3AuLi4iKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmhlbHBlci5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iyB04burIGhlbHBlcgogICAgICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLmhlbHBlci5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTeG7nyBDaHJvbWUgduG7m2kgbGluayBHb0xpa2UgdHLhu7FjIHRp4bq/cAogICAgICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWwogICAgICAgICAgICAgICAgICAgICAgICAic2hlbGwiLCAiYW0iLCAic3RhcnQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgIi1uIiwgImNvbS5hbmRyb2lkLmNocm9tZS9jb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICItYSIsICJhbmRyb2lkLmludGVudC5hY3Rpb24uVklFVyIsCiAgICAgICAgICAgICAgICAgICAgICAgICItZCIsICJodHRwczovL2FwcC5nb2xpa2UubmV0IgogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIG3hu58gQ2hyb21lIHbhu5tpIEdvTGlrZSBi4bqxbmcgQURCIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJBREIga2jDtG5nIMSRxrDhu6NjIGvhur90IG7hu5FpLCBraMO0bmcgdGjhu4MgbeG7nyBDaHJvbWUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBt4bufIENocm9tZSBi4bqxbmcgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4budIENocm9tZSB04bqjaSB4b25nCiAgICAgICAgICAgIHRpbWUuc2xlZXAoNikKCiAgICAgICAgICAgICMgVGhp4bq/dCBs4bqtcCBDaHJvbWUgZGVidWcgcG9ydCBi4bqxbmcgQURCCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLmhlbHBlci5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbImZvcndhcmQiLCAidGNwOjkyMjMiLCAibG9jYWxhYnN0cmFjdDpjaHJvbWVfZGV2dG9vbHNfcmVtb3RlIl0KICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgdGhp4bq/dCBs4bqtcCBDaHJvbWUgZGVidWcgcG9ydCIpCiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHRoaeG6v3QgbOG6rXAgQ2hyb21lIGRlYnVnIHBvcnQ6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEvhur90IG7hu5FpIMSR4bq/biBDaHJvbWUgYuG6sW5nIHB5Y2hyb21lCiAgICAgICAgICAgIGJyb3dzZXIgPSBCcm93c2VyKCJodHRwOi8vbG9jYWxob3N0OjkyMjMiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0YWIgaGnhu4duIHThuqFpIChz4bq9IGzDoCB0YWIgR29MaWtlIHbDrCB24burYSBt4bufKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0YWJzID0gYnJvd3Nlci5saXN0X3RhYigpCiAgICAgICAgICAgICAgICBpZiBub3QgdGFiczoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSB0YWIgbsOgbyB0cm9uZyBDaHJvbWUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBT4butIGThu6VuZyB0YWIgxJHhuqd1IHRpw6puICh0YWIgR29MaWtlIHbhu6thIG3hu58pCiAgICAgICAgICAgICAgICBnb2xpa2VfdGFiID0gdGFic1swXQogICAgICAgICAgICAgICAgZ29saWtlX3RhYi5zdGFydCgpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBr4bq/dCBu4buRaSDEkeG6v24gdGFiIEdvTGlrZSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGvhur90IG7hu5FpIMSR4bq/biBDaHJvbWUgdGFiOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELhuq10IHRoZW8gZMO1aSBt4bqhbmcKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ29saWtlX3RhYi5OZXR3b3JrLmVuYWJsZSgpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBi4bqtdCB0aGVvIGTDtWkgbeG6oW5nIikKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGLhuq10IHRoZW8gZMO1aSBt4bqhbmc6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQmnhur9uIMSR4buDIGtp4buDbSB0cmEgeGVtIHJlcXVlc3QgxJHDoyDEkcaw4bujYyBnaGkgbmjhuq1uIGNoxrBhCiAgICAgICAgICAgIHJlcXVlc3RfY2FwdHVyZWQgPSBGYWxzZQogICAgICAgICAgICBoZWFkZXJzID0gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMSDbmcga8O9IHPhu7Ega2nhu4duIHJlcXVlc3RXaWxsQmVTZW50CiAgICAgICAgICAgIGRlZiByZXF1ZXN0X2NhbGxiYWNrKCoqa3dhcmdzKToKICAgICAgICAgICAgICAgIG5vbmxvY2FsIHJlcXVlc3RfY2FwdHVyZWQsIGhlYWRlcnMKICAgICAgICAgICAgICAgIGlmIHJlcXVlc3RfY2FwdHVyZWQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBrd2FyZ3MuZ2V0KCJyZXF1ZXN0Iiwge30pCiAgICAgICAgICAgICAgICB1cmwgPSByZXF1ZXN0LmdldCgidXJsIiwgIiIpCiAgICAgICAgICAgICAgICBtZXRob2QgPSByZXF1ZXN0LmdldCgibWV0aG9kIiwgIiIpCiAgICAgICAgICAgICAgICBpZiAiaHR0cHM6Ly9nYXRld2F5LmdvbGlrZS5uZXQvYXBpL3N0YXRpc3RpY3MvcmVwb3J0IiBpbiB1cmwgYW5kIG1ldGhvZCA9PSAiR0VUIjoKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzID0gcmVxdWVzdC5nZXQoImhlYWRlcnMiLCB7fSkKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBnaGkgbmjhuq1uIGhlYWRlcnMgR29MaWtlIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdF9jYXB0dXJlZCA9IFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIGdvbGlrZV90YWIuTmV0d29yay5yZXF1ZXN0V2lsbEJlU2VudCA9IHJlcXVlc3RfY2FsbGJhY2sKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6o2kgbOG6oWkgdHJhbmcgxJHhu4MgxJHhuqNtIGLhuqNvIGPDsyByZXF1ZXN0IEFQSQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBnb2xpa2VfdGFiLmNhbGxfbWV0aG9kKCJQYWdlLnJlbG9hZCIpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyB04bqjaSBs4bqhaSB0cmFuZyBHb0xpa2UiKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgdOG6o2kgbOG6oWkgdHJhbmc6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhu6NpIMSR4buDIGdoaSBuaOG6rW4gcmVxdWVzdAogICAgICAgICAgICBsb2dnZXIuaW5mbygixJBhbmcgY2jhu50gZ2hpIG5o4bqtbiByZXF1ZXN0IEdvTGlrZS4uLiIpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMTApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuq90IHRoZW8gZMO1aSBt4bqhbmcKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ29saWtlX3RhYi5OZXR3b3JrLmRpc2FibGUoKQogICAgICAgICAgICAgICAgZ29saWtlX3RhYi5OZXR3b3JrLnJlcXVlc3RXaWxsQmVTZW50ID0gTm9uZQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgdOG6r3QgdGhlbyBkw7VpIG3huqFuZyIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHThuq90IHRoZW8gZMO1aSBt4bqhbmc6IHtlfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBoZWFkZXJzOgogICAgICAgICAgICAgICAgIyBMxrB1IGhlYWRlcnMgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICAgICAgc2VsZi5zYXZlX2dvbGlrZV9oZWFkZXJzKGhlYWRlcnMpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBsxrB1IGhlYWRlcnMgdsOgbyBkYXRhYmFzZSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBs4bqleSB0aMO0bmcgdGluIHjDoWMgdGjhu7FjIEdvTGlrZSwgdnVpIGzDsm5nIGtp4buDbSB0cmEgbOG6oWkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBs4bqleSBHb0xpa2UgaGVhZGVycyIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRw7NuZyBDaHJvbWUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAKICAgIGRlZiBzYXZlX2dvbGlrZV9oZWFkZXJzKHNlbGYsIGhlYWRlcnM6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEzGsHUgR29MaWtlIGhlYWRlcnMgdsOgbyBkYXRhYmFzZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGhlYWRlcnM6IEhlYWRlcnMgdOG7qyByZXF1ZXN0IEdvTGlrZQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIENo4buJIGzGsHUgdsOgbyBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgxJHhu4MgxJHhu5NuZyBi4buZIHbhu5tpIHNlcnZlcgogICAgICAgICAgICBzZWxmLmRiLnNldF9kZXZpY2VfY29uZmlnKCJnb2xpa2VfaGVhZGVycyIsIGhlYWRlcnMpCiAgICAgICAgICAgIHNlbGYuZGIuc2V0X2RldmljZV9jb25maWcoImdvbGlrZV9oZWFkZXJzX3VwZGF0ZWQiLCBpbnQodGltZS50aW1lKCkpKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBsxrB1IEdvTGlrZSBoZWFkZXJzOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGdldF9nb2xpa2VfaGVhZGVycyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBHb0xpa2UgaGVhZGVycyB04burIGRhdGFiYXNlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEhlYWRlcnMgaG/hurdjIGRpY3Rpb25hcnkgcuG7l25nIG7hur91IGtow7RuZyBjw7MKICAgICAgICAiIiIKICAgICAgICAjIENo4buJIGzhuqV5IHThu6sgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLCiAgICAgICAgcmV0dXJuIHNlbGYuZGIuZ2V0X2RldmljZV9jb25maWcoImdvbGlrZV9oZWFkZXJzIiwge30pCiAgICAgICAgCiAgICBkZWYgaXNfZ29saWtlX2F1dGhlbnRpY2F0ZWQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiJ+CiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gxJHDoyBjw7MgdGjDtG5nIHRpbiB4w6FjIHRo4buxYyBHb0xpa2UgY2jGsGEKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRw6MgeMOhYyB0aOG7sWMsIEZhbHNlIG7hur91IGNoxrBhCiAgICAgICAgIiIiCiAgICAgICAgaGVhZGVycyA9IHNlbGYuZ2V0X2dvbGlrZV9oZWFkZXJzKCkKICAgICAgICAjIEtp4buDbSB0cmEgY8OzIGF1dGhvcml6YXRpb24gdHJvbmcgaGVhZGVycwogICAgICAgIHJldHVybiBib29sKGhlYWRlcnMpCiAgICAKICAgIGRlZiBmZXRjaF9nb2xpa2VfaGVhZGVyc193aXRoX3JldHJ5KHNlbGYsIGZvcmNlX3JlZnJlc2g6IGJvb2wgPSBGYWxzZSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBHb0xpa2UgaGVhZGVycyB24bubaSBjxqEgY2jhur8gdGjhu60gbOG6oWkuIFRo4butIGzhuqFpIHThu5FpIMSRYSA1IGzhuqduIG7hur91IHRo4bqldCBi4bqhaS4KICAgICAgICBDaOG7iSBs4bqleSBs4bqhaSBoZWFkZXJzIDEgbOG6p24gbeG7l2kgbmfDoHkgZOG7sWEgdsOgbyB0aOG7nWkgZ2lhbiBj4bqtcCBuaOG6rXQgY3Xhu5FpIGPDuW5nLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGZvcmNlX3JlZnJlc2g6IE7hur91IFRydWUsIHPhur0gbHXDtG4gbOG6pXkgbOG6oWkgaGVhZGVycyBi4bqldCBr4buDIHRo4budaSBnaWFuIGPhuq1wIG5o4bqtdCBjdeG7kWkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkcOjIGPDsyBoZWFkZXJzIGjhu6NwIGzhu4cgaG/hurdjIGzhuqV5IMSRxrDhu6NjIGhlYWRlcnMgbeG7m2ksIEZhbHNlIG7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYwogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyBjw7MgdGjDtG5nIHRpbiB4w6FjIHRo4buxYyBHb0xpa2UgY2jGsGEKICAgICAgICBpZiBzZWxmLmlzX2dvbGlrZV9hdXRoZW50aWNhdGVkKCkgYW5kIG5vdCBmb3JjZV9yZWZyZXNoOgogICAgICAgICAgICAjIEtp4buDbSB0cmEgdGjhu51pIGdpYW4gY+G6rXAgbmjhuq10IGN14buRaQogICAgICAgICAgICBsYXN0X3VwZGF0ZSA9IHNlbGYuZGIuZ2V0KCJnb2xpa2VfaGVhZGVyc191cGRhdGVkIiwgMCkKICAgICAgICAgICAgY3VycmVudF90aW1lID0gaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSDEkcOjIGPhuq1wIG5o4bqtdCB0cm9uZyB2w7JuZyAyNCBnaeG7nSBxdWEsIGtow7RuZyBj4bqnbiBs4bqleSBs4bqhaQogICAgICAgICAgICBpZiBjdXJyZW50X3RpbWUgLSBsYXN0X3VwZGF0ZSA8IDg2NDAwOiAgIyAyNCBnaeG7nSA9IDg2NDAwIGdpw6J5CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBjw7MgdGjDtG5nIHRpbiB4w6FjIHRo4buxYyBHb0xpa2UgdsOgIGNoxrBhIHF1w6EgMjQgZ2nhu50gdOG7qyBs4bqnbiBj4bqtcCBuaOG6rXQgY3Xhu5FpIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBxdcOhIDI0IGdp4budIHThu6sgbOG6p24gY+G6rXAgbmjhuq10IGN14buRaSwgc+G6vSBsw6BtIG3hu5tpIGhlYWRlcnMgR29MaWtlIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBmb3JjZV9yZWZyZXNoOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkLhuq90IGJ14buZYyBsw6BtIG3hu5tpIGhlYWRlcnMgR29MaWtlIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJDaMawYSBjw7MgdGjDtG5nIHRpbiB4w6FjIHRo4buxYyBHb0xpa2UsIHPhur0gbOG6pXkgaGVhZGVycyBt4bubaSIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7sWMgaGnhu4duIGzhuqV5IGhlYWRlcnMgduG7m2kgY8ahIGNo4bq/IHRo4butIGzhuqFpCiAgICAgICAgbWF4X2F0dGVtcHRzID0gNSAgIyBUxINuZyBz4buRIGzhuqduIHRo4butIHThu6sgMyBsw6puIDUKICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZSgxLCBtYXhfYXR0ZW1wdHMgKyAxKToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyBs4bqleSBHb0xpa2UgaGVhZGVycyAobOG6p24gdGjhu60ge2F0dGVtcHR9L3ttYXhfYXR0ZW1wdHN9KS4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFRo4butIGzhuqV5IGhlYWRlcnMKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLmZldGNoX2dvbGlrZV9oZWFkZXJzKCkKICAgICAgICAgICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgbOG6pXkgdsOgIGzGsHUgaGVhZGVycyBHb0xpa2UgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0aOG7gyBs4bqleSBoZWFkZXJzIEdvTGlrZSBs4bqnbiB7YXR0ZW1wdH0sIHPhur0gdGjhu60gbOG6oWkuLi4iKQogICAgICAgICAgICAgICAgICAgICMgxJDDs25nIENocm9tZSBu4bq/dSBjw7JuIG3hu58KICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9hdHRlbXB0czoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSB0aGVvIHPhu5EgbOG6p24gdGjhu60gKDEwcywgMjBzLCAzMHMsIDQwcykKICAgICAgICAgICAgICAgICAgICAgICAgd2FpdF90aW1lID0gYXR0ZW1wdCAqIDEwCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDhu6NpIHt3YWl0X3RpbWV9IGdpw6J5IHRyxrDhu5tjIGtoaSB0aOG7rSBs4bqhaS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbOG6pXkgaGVhZGVycyBHb0xpa2U6IHtlfSIpCiAgICAgICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBDaHJvbWUgxJHGsOG7o2MgxJHDs25nCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X2F0dGVtcHRzOgogICAgICAgICAgICAgICAgICAgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gdGhlbyBz4buRIGzhuqduIHRo4butICgxMHMsIDIwcywgMzBzLCA0MHMpCiAgICAgICAgICAgICAgICAgICAgd2FpdF90aW1lID0gYXR0ZW1wdCAqIDEwCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkOG7o2kge3dhaXRfdGltZX0gZ2nDonkgdHLGsOG7m2Mga2hpIHRo4butIGzhuqFpLi4uIikKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHdhaXRfdGltZSkKICAgICAgICAKICAgICAgICBsb2dnZXIuZXJyb3IoZiLEkMOjIHRo4butIGzhuqV5IEdvTGlrZSBoZWFkZXJzIHttYXhfYXR0ZW1wdHN9IGzhuqduIG5oxrBuZyBraMO0bmcgdGjDoG5oIGPDtG5nIikKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgYXBpX3JlcXVlc3Qoc2VsZiwgdXJsLCBtZXRob2Q9IkdFVCIsIHBheWxvYWQ9Tm9uZSk6CiAgICAgICAgIiIiCiAgICAgICAgR+G7jWkgQVBJIGPhu6dhIEdvTGlrZSB24bubaSBoZWFkZXJzIMSRw6MgbMawdQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHVybDogVVJMIGPhu6dhIEFQSQogICAgICAgICAgICBtZXRob2Q6IFBoxrDGoW5nIHRo4bupYyBIVFRQIChHRVQgaG/hurdjIFBPU1QpCiAgICAgICAgICAgIHBheWxvYWQ6IEThu68gbGnhu4d1IGfhu61pIMSRaSAoY2hvIFBPU1QgcmVxdWVzdCkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdCBob+G6t2MgTm9uZTogS+G6v3QgcXXhuqMgQVBJIG7hur91IHRow6BuaCBjw7RuZywgTm9uZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgaGVhZGVycyB04burIGRhdGFiYXNlCiAgICAgICAgICAgIGhlYWRlcnMgPSBzZWxmLmdldF9nb2xpa2VfaGVhZGVycygpCiAgICAgICAgICAgIGlmIG5vdCBoZWFkZXJzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgR29MaWtlIGhlYWRlcnMiKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIGhlYWRlcnMgY8OzIHVzZXItYWdlbnQKICAgICAgICAgICAgaWYgInVzZXItYWdlbnQiIG5vdCBpbiBoZWFkZXJzIGFuZCAiVXNlci1BZ2VudCIgbm90IGluIGhlYWRlcnM6CiAgICAgICAgICAgICAgICBoZWFkZXJzWyJ1c2VyLWFnZW50Il0gPSBzZWxmLnVzZXJfYWdlbnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IEFQSSBiYXNlIFVSTCB04burIGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyBob+G6t2Mgc+G7rSBk4bulbmcgbeG6t2MgxJHhu4tuaCB04burIGNvbmZpZwogICAgICAgICAgICBhcGlfYmFzZSA9IHNlbGYuZGIuZ2V0X2RldmljZV9jb25maWcoImdvbGlrZV9hcGlfYmFzZSIsIGNvbmZpZy5HT0xJS0VfQVBJX0JBU0UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IFVSTCBraMO0bmcgYuG6r3QgxJHhuqd1IGLhurFuZyBodHRwLCB0aMOqbSBhcGlfYmFzZSB2w6BvIHRyxrDhu5tjCiAgICAgICAgICAgIGlmIG5vdCB1cmwuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgICAgICAgICAgdXJsID0gZiJ7YXBpX2Jhc2V9L3t1cmwubHN0cmlwKCcvJyl9IgoKICAgICAgICAgICAgIyBT4butIGThu6VuZyBjdXJsX2NmZmkgaG/hurdjIGNsb3Vkc2NyYXBlciB0w7l5IHRoZW8gbcO0aSB0csaw4budbmcKICAgICAgICAgICAgaWYgc2VsZi51c2VfY3VybF9jZmZpIGFuZCBDVVJMX0NGRklfQVZBSUxBQkxFOgogICAgICAgICAgICAgICAgaWYgbWV0aG9kID09ICJHRVQiOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3VybF9yZXF1ZXN0cy5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICBpbXBlcnNvbmF0ZT1zZWxmLmltcGVyc29uYXRlCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxpZiBtZXRob2QgPT0gIlBPU1QiOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3VybF9yZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb249cGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICBpbXBlcnNvbmF0ZT1zZWxmLmltcGVyc29uYXRlCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJNZXRob2Qga2jDtG5nIGjhu6NwIGzhu4c6IHttZXRob2R9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBT4butIGThu6VuZyBjbG91ZHNjcmFwZXIgaG/hurdjIGZhbGxiYWNrIHRvIHJlcXVlc3RzCiAgICAgICAgICAgICAgICBpZiBtZXRob2QgPT0gIkdFVCI6CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmNsaWVudC5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxpZiBtZXRob2QgPT0gIlBPU1QiOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5jbGllbnQucG9zdCgKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBqc29uPXBheWxvYWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTWV0aG9kIGtow7RuZyBo4bujcCBs4buHOiB7bWV0aG9kfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gaGnhu4NuIHRo4buLIGzhu5dpIGThu4UgxJHhu41jIGjGoW4KICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IHJlc3BvbnNlLnRleHQKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIFBhcnNlIHJlc3BvbnNlIGzDoCBKU09OCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfanNvbiA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAgICAgICAgICMgRm9ybWF0IGxvZyB0aMOgbmggMSBkw7JuZwogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IGVycm9yX2pzb24uZ2V0KCdzdGF0dXMnLCByZXNwb25zZS5zdGF0dXNfY29kZSkKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZXJyb3JfanNvbi5nZXQoJ3N1Y2Nlc3MnLCBGYWxzZSkKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gZXJyb3JfanNvbi5nZXQoJ21lc3NhZ2UnLCAnS2jDtG5nIGPDsyB0aMO0bmcgYsOhbyBs4buXaScpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBH4buZcCB0aMOgbmggMSBkw7JuZwogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkFQSSB0cuG6oyB24buBIGzhu5dpIFt7c3RhdHVzfV0gW3N1Y2Nlc3M6IHtzdWNjZXNzfV0ge21lc3NhZ2V9IikKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyBwaOG6o2kgSlNPTiwgaGnhu4NuIHRo4buLIHRleHQgdGjDtAogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkFQSSB0cuG6oyB24buBIGzhu5dpIHtyZXNwb25zZS5zdGF0dXNfY29kZX06IHtlcnJvcl9tc2d9IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu41pIEFQSToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBfY3VybF9jZmZpX3JlcXVlc3Qoc2VsZiwgdXJsOiBzdHIsIG1ldGhvZDogc3RyID0gImdldCIsIGhlYWRlcnM6IERpY3Rbc3RyLCBzdHJdID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogRGljdFtzdHIsIEFueV0gPSBOb25lLCB0aW1lb3V0OiBpbnQgPSAzMCkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gcmVxdWVzdCBz4butIGThu6VuZyBjdXJsX2NmZmkgKGhp4buHdSBxdeG6oyBjaG8gQ2xvdWRmbGFyZSkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG1ldGhvZC5sb3dlcigpID09ICJnZXQiOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjdXJsX3JlcXVlc3RzLmdldCgKICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgIGRhdGE9ZGF0YSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQsCiAgICAgICAgICAgICAgICAgICAgaW1wZXJzb25hdGU9ImNocm9tZTExMCIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxzZTogICMgUE9TVAogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjdXJsX3JlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycywKICAgICAgICAgICAgICAgICAgICBkYXRhPWRhdGEsCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0LAogICAgICAgICAgICAgICAgICAgIGltcGVyc29uYXRlPSJjaHJvbWUxMTAiCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBzdGF0dXMgY29kZToge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu41pIEFQSToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgIGRlZiBmZXRjaF9nb2xpa2VfcmVwb3J0KHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IHThu6sgR29MaWtlIHbDoCB04buVbmcgaOG7o3AgbOG6oWkKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogVGjDtG5nIHRpbiByZXBvcnQgxJHDoyB04buVbmcgaOG7o3AgaG/hurdjIGRpY3QgcuG7l25nIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKCiAgICAgICAgICAgICMgR+G7jWkgQVBJIC9tZSDEkeG7gyBs4bqleSB0aMO0bmcgdGluIG5nxrDhu51pIGTDuW5nCiAgICAgICAgICAgIHVzZXJfaW5mbyA9IHNlbGYuYXBpX3JlcXVlc3QoInVzZXJzL21lIikKICAgICAgICAgICAgdXNlcl9zdW1tYXJ5ID0ge30KICAgICAgICAgICAgaWYgdXNlcl9pbmZvIGFuZCB1c2VyX2luZm8uZ2V0KCJzdWNjZXNzIiwgRmFsc2UpIGFuZCAiZGF0YSIgaW4gdXNlcl9pbmZvOgogICAgICAgICAgICAgICAgZGF0YV91c2VyID0gdXNlcl9pbmZvWyJkYXRhIl0KICAgICAgICAgICAgICAgIHVzZXJfc3VtbWFyeSA9IHsKICAgICAgICAgICAgICAgICAgICAiZ29saWtlX3VzZXJfaWQiOiBkYXRhX3VzZXIuZ2V0KCJpZCIpLAogICAgICAgICAgICAgICAgICAgICJnb2xpa2VfdXNlcl9uYW1lIjogZGF0YV91c2VyLmdldCgibmFtZSIpLAogICAgICAgICAgICAgICAgICAgICJnb2xpa2VfdXNlcl9lbWFpbCI6IGRhdGFfdXNlci5nZXQoImVtYWlsIiksCiAgICAgICAgICAgICAgICAgICAgImdvbGlrZV91c2VyX3VzZXJuYW1lIjogZGF0YV91c2VyLmdldCgidXNlcm5hbWUiKSwKICAgICAgICAgICAgICAgICAgICAiaW5zdGFncmFtX3ZlcmlmeV9jb2RlIjogZGF0YV91c2VyLmdldCgiaW5zdGFncmFtX3ZlcmlmeV9jb2RlIikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlRow7RuZyB0aW4gbmfGsOG7nWkgZMO5bmcgR29MaWtlOiB7dXNlcl9zdW1tYXJ5fSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHRow7RuZyB0aW4gL21lIHThu6sgR29MaWtlIGhv4bq3YyBwaOG6o24gaOG7k2kga2jDtG5nIGjhu6NwIGzhu4ciKQoKICAgICAgICAgICAgIyBH4buNaSBBUEkgcmVwb3J0CiAgICAgICAgICAgIHJlcG9ydF9kYXRhID0gc2VsZi5hcGlfcmVxdWVzdCgic3RhdGlzdGljcy9yZXBvcnQiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHJlcG9ydF9kYXRhIG9yICJzdWNjZXNzIiBub3QgaW4gcmVwb3J0X2RhdGEgb3Igbm90IHJlcG9ydF9kYXRhWyJzdWNjZXNzIl06CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCB04burIEdvTGlrZSIpCiAgICAgICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFThu5VuZyBo4bujcCB0aMO0bmcgdGluCiAgICAgICAgICAgIGN1cnJlbnRfY29pbiA9IHJlcG9ydF9kYXRhLmdldCgiY3VycmVudF9jb2luIiwgMCkKICAgICAgICAgICAgbWVzc2FnZSA9IHJlcG9ydF9kYXRhLmdldCgibWVzc2FnZSIsICIiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw61uaCB04buVbmcgcGVuZGluZ19jb2luIHbDoCBob2xkX2NvaW4gdOG7qyBjw6FjIGFwcCBxdWFuIHTDom0KICAgICAgICAgICAgYXBwcyA9IFsiaW5zdGFncmFtIiwgInRpa3RvayIsICJzbmFwY2hhdCJdCiAgICAgICAgICAgIHRvdGFsX3BlbmRpbmdfY29pbiA9IDAKICAgICAgICAgICAgdG90YWxfaG9sZF9jb2luID0gMAogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGFwcCBpbiBhcHBzOgogICAgICAgICAgICAgICAgaWYgYXBwIGluIHJlcG9ydF9kYXRhOgogICAgICAgICAgICAgICAgICAgIGFwcF9kYXRhID0gcmVwb3J0X2RhdGFbYXBwXQogICAgICAgICAgICAgICAgICAgIHRvdGFsX3BlbmRpbmdfY29pbiArPSBhcHBfZGF0YS5nZXQoInBlbmRpbmdfY29pbiIsIDApCiAgICAgICAgICAgICAgICAgICAgdG90YWxfaG9sZF9jb2luICs9IGFwcF9kYXRhLmdldCgiaG9sZF9jb2luIiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgCgogICAgICAgICAgICAjIFThuqFvIGRpY3Qga+G6v3QgcXXhuqMgdOG7lW5nIGjhu6NwCiAgICAgICAgICAgIHN1bW1hcnkgPSB7CiAgICAgICAgICAgICAgICAiY3VycmVudF9jb2luIjogY3VycmVudF9jb2luLAogICAgICAgICAgICAgICAgInRvdGFsX3BlbmRpbmdfY29pbiI6IHRvdGFsX3BlbmRpbmdfY29pbiwKICAgICAgICAgICAgICAgICJ0b3RhbF9ob2xkX2NvaW4iOiB0b3RhbF9ob2xkX2NvaW4sCiAgICAgICAgICAgICAgICAiZ29saWtlX3JlcG9ydF9tZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgICAgICJnb2xpa2VfcmVwb3J0X3VwZGF0ZWRfYXQiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgIyBHaMOpcCB0aMO0bmcgdGluIG5nxrDhu51pIGTDuW5nIHbDoG8gc3VtbWFyeQogICAgICAgICAgICBzdW1tYXJ5LnVwZGF0ZSh1c2VyX3N1bW1hcnkpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICBzZWxmLmRiLnNldCgiZ29saWtlX3JlcG9ydCIsIHN1bW1hcnkpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiBHb0xpa2UgcmVwb3J0OiB4dSBoaeG7h24gdOG6oWk9e2N1cnJlbnRfY29pbn0sIHh1IMSRYW5nIGNo4budPXt0b3RhbF9wZW5kaW5nX2NvaW59LCB4dSBnaeG7rz17dG90YWxfaG9sZF9jb2lufSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc3VtbWFyeQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IHThu6sgR29MaWtlOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgCiAgICBkZWYgc3RhcnRfcmVwb3J0X3RocmVhZChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgxJHhu5luZyB0aHJlYWQgxJHhu4tuaCBr4buzIGzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IHThu6sgR29MaWtlCiAgICAgICAgIiIiCiAgICAgICAgIyBLaeG7g20gdHJhIHRocmVhZCDEkcOjIGNo4bqheSBjaMawYQogICAgICAgIGlmIHNlbGYucmVwb3J0X3RocmVhZCBpcyBub3QgTm9uZSBhbmQgc2VsZi5yZXBvcnRfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJUaHJlYWQgcmVwb3J0IEdvTGlrZSDEkcOjIMSRYW5nIGNo4bqheSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBpbXBvcnQgdGhyZWFkaW5nCiAgICAgICAgCiAgICAgICAgZGVmIHJlcG9ydF9sb29wKCk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJC4bqvdCDEkeG6p3UgdGhyZWFkIGzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IEdvTGlrZSDEkeG7i25oIGvhu7MiKQogICAgICAgICAgICAKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6MgY8OzIGhlYWRlcnMgY2jGsGEKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2dvbGlrZV9hdXRoZW50aWNhdGVkKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgTOG6pXkgdGjDtG5nIHRpbiByZXBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5mZXRjaF9nb2xpa2VfcmVwb3J0KCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ2jGsGEgY8OzIGhlYWRlcnMgR29MaWtlLCBraMO0bmcgdGjhu4MgbOG6pXkgdGjDtG5nIHRpbiByZXBvcnQiKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB0cm9uZyB0aHJlYWQgcmVwb3J0IEdvTGlrZToge2V9IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmfhu6cgMTAgcGjDunQKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoNjAwKQogICAgICAgIAogICAgICAgICMgVOG6oW8gdsOgIGto4bufaSDEkeG7mW5nIHRocmVhZAogICAgICAgIHNlbGYucmVwb3J0X3RocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PXJlcG9ydF9sb29wLCBkYWVtb249VHJ1ZSkKICAgICAgICBzZWxmLnJlcG9ydF90aHJlYWQuc3RhcnQoKQogICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGto4bufaSDEkeG7mW5nIHRocmVhZCBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCBHb0xpa2UgxJHhu4tuaCBr4buzIikKCiAgICBkZWYgZ2V0X2dvbGlrZV9yZXBvcnQoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgR29MaWtlIMSRw6MgbMawdSB0cm9uZyBkYXRhYmFzZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBUaMO0bmcgdGluIHJlcG9ydCBob+G6t2MgZGljdCBy4buXbmcgbuG6v3Uga2jDtG5nIGPDswogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLmRiLmdldCgiZ29saWtlX3JlcG9ydCIsIHt9KQo=').decode('utf-8'))
