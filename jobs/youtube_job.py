import base64
exec(base64.b64decode('aW1wb3J0IGRhdGV0aW1lCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IHJlCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIExpc3QsIE9wdGlvbmFsCmZyb20gam9icy5qb2JfYmFzZSBpbXBvcnQgQmFzZUpvYgoKY2xhc3MgWW91dHViZUpvYihCYXNlSm9iKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9zZXJ2aWNlLCBoZWxwZXJfc2VydmljZSwgZ29saWtlX3NlcnZpY2U9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhkYl9zZXJ2aWNlLCBoZWxwZXJfc2VydmljZSwgZ29saWtlX3NlcnZpY2UpCiAgICAgICAgc2VsZi5hcHBfcGFja2FnZSA9ICJjb20uZ29vZ2xlLmFuZHJvaWQueW91dHViZSIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gInlvdXR1YmUiCiAgICAgICAgCiAgICAgICAgIyBPdmVycmlkZSBkZWZhdWx0IGNvbmZpZyBjaG8gWW91VHViZQogICAgICAgIHNlbGYuX2RlZmF1bHRfY29uZmlnLnVwZGF0ZSh7CiAgICAgICAgICAgICJhY3Rpb25fd2VpZ2h0cyI6IHsKICAgICAgICAgICAgICAgICJyYW5kb21fdmlld192aWRlb19jaGFuZWwiOiAxMDAsICAjIDEwMCUgeGVtIHZpZGVvL2NoYW5uZWwgcmFuZG9tCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJtaW5fYWN0aW9uc19wZXJfc2Vzc2lvbiI6IDMsCiAgICAgICAgICAgICJtYXhfYWN0aW9uc19wZXJfc2Vzc2lvbiI6IDUwLCAgIyBZb3VUdWJlIGPDsyB0aOG7gyBjw7Mgbmhp4buBdSBhY3Rpb25zIGjGoW4gKDUwIHRoYXkgdsOsIDMwKQogICAgICAgICAgICAibWF4X3Nlc3Npb25fZHVyYXRpb25fbWludXRlcyI6IDE1LAogICAgICAgICAgICAiYWN0aW9uX2RlbGF5X21pbiI6IDUsCiAgICAgICAgICAgICJhY3Rpb25fZGVsYXlfbWF4IjogMTUsCiAgICAgICAgICAgICJrZXlfc2VhcmNoX2lkIjogImRzakVFTXBaay1RLGp1Z0k2VXJVLWZJLGtwUmlFcHE3YXdnLDMzM2Nsa2R6S0JNLHdPUnNhemhJRzM0LGxnWDVROVNQRThFLGN4ZFU2YklrVi1nLDM1dEc2SUZpQk9jLFg3MEVNN041ZEpZLF8xQmw4UDdURVk0LE5GSmx5RUxxZDF3LFBBOWZXV2JIWHRzLEc1by1oRlhwTzFZLDV3ZW45aERjSTRZIiwKICAgICAgICAgICAgIm5hbWVfY2hhbm5lbCI6ICJExaluZyBCw6lvIE9mZmljaWFsLERUQ0FLRSBUVixExaluZyBCw6lvIFZsb2ciLCAgIyBDw7MgdGjhu4MgbMOgIDEga8OqbmggaG/hurdjIG5oaeG7gXUga8OqbmggcGjDom4gY8OhY2ggYuG7n2kgZOG6pXUgcGjhuql5CiAgICAgICAgICAgICJhZF93YXRjaF90aW1lX21pbiI6IDEwLCAgICAgICMgVGjhu51pIGdpYW4geGVtIHF14bqjbmcgY8OhbyB04buRaSB0aGnhu4N1IChnacOieSkKICAgICAgICAgICAgImFkX3dhdGNoX3RpbWVfbWF4IjogMzAsICAgICAjIFRo4budaSBnaWFuIHhlbSBxdeG6o25nIGPDoW8gdOG7kWkgxJFhIChnacOieSkKICAgICAgICAgICAgInZpZGVvX3dhdGNoX3RpbWVfbWluIjogMTAwLCAgIyBUaOG7nWkgZ2lhbiB4ZW0gdmlkZW8gdOG7kWkgdGhp4buDdSAoZ2nDonkpCiAgICAgICAgICAgICJ2aWRlb193YXRjaF90aW1lX21heCI6IDE4MCwgICMgVGjhu51pIGdpYW4geGVtIHZpZGVvIHThu5FpIMSRYSAoZ2nDonkpCiAgICAgICAgICAgICJ2aWRlb19yZXdhdGNoX2Nvb2xkb3duX21pbnV0ZXMiOiAzMDAgICMgVGjhu51pIGdpYW4gZ2nDo24gY8OhY2ggdHLGsOG7m2Mga2hpIHhlbSBs4bqhaSB2aWRlbyAocGjDunQpCiAgICAgICAgfSkKICAgIAogICAgZGVmIGR1bXBfc2NyZWVuKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEZhbGxiYWNrIG1ldGhvZCDEkeG7gyB0xrDGoW5nIHRow61jaCB24bubaSBjw6FjIG1ldGhvZCBjw7MgdGjhu4MgZ+G7jWkgZHVtcF9zY3JlZW4oKQogICAgICAgIHRoYXkgdsOsIGR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAKICAgIGRlZiBnZXRfc3VwcG9ydGVkX2FjdGlvbnMoc2VsZikgLT4gTGlzdFtzdHJdOgogICAgICAgICIiIgogICAgICAgIE92ZXJyaWRlIGRhbmggc8OhY2ggYWN0aW9ucyDEkcaw4bujYyBZb3VUdWJlIGjhu5cgdHLhu6MKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W3N0cl06IERhbmggc8OhY2ggYWN0aW9ucyBZb3VUdWJlIGjhu5cgdHLhu6MKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gbGlzdChzZWxmLmdldF9hY3Rpb25fd2VpZ2h0cygpLmtleXMoKSkKICAgIAogICAgZGVmIGdldF90YXJnZXRfY2hhbm5lbHMoc2VsZikgLT4gTGlzdFtzdHJdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGRhbmggc8OhY2gga8OqbmggdGFyZ2V0IHThu6sgY29uZmlnCiAgICAgICAgSOG7lyB0cuG7oyAxIGvDqm5oIGhv4bq3YyBuaGnhu4F1IGvDqm5oIHBow6JuIGPDoWNoIGLhu59pIGThuqV1IHBo4bqpeQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3Rbc3RyXTogRGFuaCBzw6FjaCB0w6puIGvDqm5oCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb25maWcgPSBzZWxmLmdldF9hcHBfY29uZmlnKCkKICAgICAgICAgICAgbmFtZV9jaGFubmVsID0gY29uZmlnLmdldCgibmFtZV9jaGFubmVsIiwgIkTFqW5nIELDqW8gT2ZmaWNpYWwiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBjw7MgZOG6pXUgcGjhuql5IHRow6wgc3BsaXQgdGjDoG5oIG5oaeG7gXUga8OqbmgsIGtow7RuZyB0aMOsIGNo4buJIDEga8OqbmgKICAgICAgICAgICAgaWYgIiwiIGluIG5hbWVfY2hhbm5lbDoKICAgICAgICAgICAgICAgIHRhcmdldF9jaGFubmVscyA9IFtjaGFubmVsLnN0cmlwKCkgZm9yIGNoYW5uZWwgaW4gbmFtZV9jaGFubmVsLnNwbGl0KCIsIikgaWYgY2hhbm5lbC5zdHJpcCgpXQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdGFyZ2V0X2NoYW5uZWxzID0gW25hbWVfY2hhbm5lbC5zdHJpcCgpXSBpZiBuYW1lX2NoYW5uZWwuc3RyaXAoKSBlbHNlIFtdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEZhbGxiYWNrIG7hur91IHLhu5duZwogICAgICAgICAgICBpZiBub3QgdGFyZ2V0X2NoYW5uZWxzOgogICAgICAgICAgICAgICAgdGFyZ2V0X2NoYW5uZWxzID0gWyJExaluZyBCw6lvIE9mZmljaWFsIl0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB0YXJnZXRfY2hhbm5lbHMKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kgbOG6pXkgdGFyZ2V0IGNoYW5uZWxzOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gWyJExaluZyBCw6lvIE9mZmljaWFsIl0gICMgRmFsbGJhY2sKICAgICAgICAKICAgIGRlZiBnZXRfYWNjb3VudHNfZnJvbV9kZXZpY2Uoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gWW91VHViZSB04burIHRoaeG6v3QgYuG7iwogICAgICAgIFlvdVR1YmUgbHXDtG4gcmV0dXJuIDEgYWNjb3VudCB24bubaSB1bmlxdWVfdXNlcm5hbWUgPSAibm8uYWNjb3VudCIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIFlvdVR1YmUgdOG7qyB0aGnhur90IGLhu4siKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBZb3VUdWJlIGNo4buJIGPDsyAxIGFjY291bnQgbeG6t2MgxJHhu4tuaAogICAgICAgICAgICBhY2NvdW50cyA9IFt7CiAgICAgICAgICAgICAgICAidW5pcXVlX3VzZXJuYW1lIjogIm5vLmFjY291bnQiLAogICAgICAgICAgICAgICAgInVuaXF1ZV9pZCI6ICJuby5hY2NvdW50IiwgCiAgICAgICAgICAgICAgICAibmlja25hbWUiOiAiWW91VHViZSBBY2NvdW50IiwKICAgICAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiAiIiwKICAgICAgICAgICAgICAgICJpc19sb2dpbiI6IFRydWUsCiAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIH1dCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkge2xlbihhY2NvdW50cyl9IHTDoGkga2hv4bqjbiBZb3VUdWJlIikKICAgICAgICAgICAgcmV0dXJuIGFjY291bnRzCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gWW91VHViZSIpCiAgICAgICAgICAgIHJldHVybiBbXQogICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKHNlbGYpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdXNlcm5hbWUgY+G7p2EgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAKICAgICAgICBZb3VUdWJlIGx1w7RuIHJldHVybiAibm8uYWNjb3VudCIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6ICJuby5hY2NvdW50IgogICAgICAgICIiIgogICAgICAgIHJldHVybiAibm8uYWNjb3VudCIKICAgIAogICAgZGVmIF9wZXJmb3JtX2FjY291bnRfc3dpdGNoKHNlbGYsIHRhcmdldF9hY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBjaHV54buDbiB0w6BpIGtob+G6o24KICAgICAgICBZb3VUdWJlIGtow7RuZyBj4bqnbiBjaHV54buDbiB0w6BpIGtob+G6o24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXJnZXRfYWNjb3VudDogVMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuIMSR4bq/bgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgY2h1eeG7g24gdMOgaSBraG/huqNuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLAogICAgICAgICAgICAnbWVzc2FnZSc6ICdZb3VUdWJlIGtow7RuZyBj4bqnbiBjaHV54buDbiB0w6BpIGtob+G6o24nCiAgICAgICAgfQogICAgCiAgICBkZWYgb3Blbl9hcHAoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBN4bufIOG7qW5nIGThu6VuZyBZb3VUdWJlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk3hu58g4bupbmcgZOG7pW5nIFlvdVR1YmUiKQogICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcChzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kgbeG7nyBZb3VUdWJlOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGlzX2hvbWVfc2NyZWVuKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIMSRYW5nIOG7nyBtw6BuIGjDrG5oIGhvbWUgWW91VHViZSBraMO0bmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRYW5nIOG7nyBob21lIHNjcmVlbgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OzIGPDoWMgZWxlbWVudCDEkeG6t2MgdHLGsG5nIGPhu6dhIFlvdVR1YmUgaG9tZQogICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygixJBhbmcgZ+G7jWkgaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpIHRyb25nIGlzX2hvbWVfc2NyZWVuLi4uIikKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gY8OhYyBpbmRpY2F0b3IgY+G7p2EgWW91VHViZSBob21lCiAgICAgICAgICAgIGhvbWVfaW5kaWNhdG9ycyA9IFsKICAgICAgICAgICAgICAgICdjb20uZ29vZ2xlLmFuZHJvaWQueW91dHViZTppZC95b3V0dWJlX2xvZ28nLAogICAgICAgICAgICAgICAgJ1RyYW5nIGNo4bunJywKICAgICAgICAgICAgICAgICdTaG9ydHMnCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBpbmRpY2F0b3IgaW4gaG9tZV9pbmRpY2F0b3JzOgogICAgICAgICAgICAgICAgaWYgaW5kaWNhdG9yIGluIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2nhu4NtIHRyYSBob21lIHNjcmVlbjoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9zY3JlZW4oc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIFBow6F0IGhp4buHbiBtw6BuIGjDrG5oIGhp4buHbiB04bqhaSBj4bunYSBZb3VUdWJlCiAgICAgICAgxJDhuqNtIGLhuqNvIFlvdVR1YmUgxJFhbmcgbeG7nyB0csaw4bubYyBraGkgcGjDoXQgaGnhu4duIHNjcmVlbgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogTG/huqFpIG3DoG4gaMOsbmggaGnhu4duIHThuqFpICgnaG9tZScsICdob21lX3NlYXJjaCcsICd2aWV3X3ZpZGVvJywgJ3Vua25vd24nKQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gWW91VHViZSDEkWFuZyBt4bufCiAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICBpZiBjdXJyZW50X3BhY2thZ2UgIT0gc2VsZi5hcHBfcGFja2FnZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJZb3VUdWJlIGNoxrBhIG3hu58gKHBhY2thZ2UgaGnhu4duIHThuqFpOiB7Y3VycmVudF9wYWNrYWdlfSksIMSRYW5nIG3hu58gWW91VHViZS4uLiIpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5vcGVuX2FwcCgpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgbeG7nyBZb3VUdWJlIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInVua25vd24iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgxJDhu6NpIGFwcCBsb2FkCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHBhY2thZ2UKICAgICAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICAgICAgaWYgY3VycmVudF9wYWNrYWdlICE9IHNlbGYuYXBwX3BhY2thZ2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJW4bqrbiBraMO0bmcgcGjhuqNpIFlvdVR1YmUgYXBwOiB7Y3VycmVudF9wYWNrYWdlfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJ1bmtub3duIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBYTUwgY+G7p2EgbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoIsSQYW5nIGfhu41pIGhlbHBlci5kdW1wX3NjcmVlbl94bWwoKS4uLiIpCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyBs4bqleSDEkcaw4bujYyBzY3JlZW4gWE1MIikKICAgICAgICAgICAgICAgIHJldHVybiAidW5rbm93biIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2aWV3X3ZpZGVvIHNjcmVlbiB0csaw4bubYyAoxrB1IHRpw6puIGNhbyBuaOG6pXQpCiAgICAgICAgICAgIGlmICJjb20uZ29vZ2xlLmFuZHJvaWQueW91dHViZTppZC93YXRjaF9wbGF5ZXIiIGluIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICByZXR1cm4gInZpZXdfdmlkZW8iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgaG9tZV9zZWFyY2ggc2NyZWVuCiAgICAgICAgICAgIHNlYXJjaF9pbmRpY2F0b3JzID0gWwogICAgICAgICAgICAgICAgIlRo4butIHTDrG0ga2nhur9tIMSR4buDIGLhuq90IMSR4bqndSIsCiAgICAgICAgICAgICAgICAiVMOsbSB0csOqbiBZb3VUdWJlIgogICAgICAgICAgICBdCiAgICAgICAgICAgIGZvciBpbmRpY2F0b3IgaW4gc2VhcmNoX2luZGljYXRvcnM6CiAgICAgICAgICAgICAgICBpZiBpbmRpY2F0b3IgaW4gc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImhvbWVfc2VhcmNoIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGhvbWUgc2NyZWVuIChr4bq/IHRo4burYSBsb2dpYyB04burIGlzX2hvbWVfc2NyZWVuKQogICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gImhvbWUiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtow7RuZyB4w6FjIMSR4buLbmggxJHGsOG7o2MKICAgICAgICAgICAgcmV0dXJuICJ1bmtub3duIgogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kgcGjDoXQgaGnhu4duIGN1cnJlbnQgc2NyZWVuOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gInVua25vd24iCiAgICAKICAgIGRlZiBlbnN1cmVfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28gxJFhbmcg4bufIG3DoG4gaMOsbmggaG9tZSBZb3VUdWJlCiAgICAgICAgS+G6v3QgaOG7o3AgZ2nhu69hIG7DunQgYmFjayB2w6AgYuG6pW0gdsOgbyBUcmFuZyBjaOG7py9Ib21lCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcgduG7gSBob21lIHNjcmVlbgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBO4bq/dSDEkcOjIOG7nyBob21lIHRow6wgT0sKICAgICAgICAgICAgc2VsZi5faGFuZGxlX2Nsb3NlX3BvcHVwcygpCiAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJBhbmcgY+G7kSBn4bqvbmcgcXVheSB24buBIHRyYW5nIGNo4bunIFlvdVR1YmUiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7rSAxOiBUw6xtIHbDoCBi4bqlbSBuw7p0ICJUcmFuZyBjaOG7pyIgaG/hurdjICJIb21lIiB0csaw4bubYwogICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJUcmFuZyBjaOG7pyIpCiAgICAgICAgICAgIGlmIG5vdCBob21lX3RhYjoKICAgICAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IkhvbWUiKQogICAgICAgICAgICBpZiBub3QgaG9tZV90YWI6CiAgICAgICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIikKICAgICAgICAgICAgaWYgbm90IGhvbWVfdGFiOgogICAgICAgICAgICAgICAgaG9tZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJIb21lIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiBob21lX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlTDrG0gdGjhuqV5IG7DunQgVHJhbmcgY2jhu6cvSG9tZSwgxJFhbmcgYuG6pW0uLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfdGFiKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu60gMjogQuG6pW0gYmFjayAxLTIgbOG6p24gcuG7k2kgdMOsbSBIb21lIGJ1dHRvbgogICAgICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZSgyKToKICAgICAgICAgICAgICAgIHNlbGYuX2hhbmRsZV9jbG9zZV9wb3B1cHMoKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlRo4butIGLhuqVtIGJhY2sgbOG6p24ge2F0dGVtcHQgKyAxfSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgxJHDoyB24buBIGhvbWUgY2jGsGEKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gSG9tZSBidXR0b24gc2F1IGtoaSBiYWNrCiAgICAgICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJUcmFuZyBjaOG7pyIpCiAgICAgICAgICAgICAgICBpZiBub3QgaG9tZV90YWI6CiAgICAgICAgICAgICAgICAgICAgaG9tZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iSG9tZSIpCiAgICAgICAgICAgICAgICBpZiBub3QgaG9tZV90YWI6CiAgICAgICAgICAgICAgICAgICAgaG9tZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJUcmFuZyBjaOG7pyIpCiAgICAgICAgICAgICAgICBpZiBub3QgaG9tZV90YWI6CiAgICAgICAgICAgICAgICAgICAgaG9tZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJIb21lIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGhvbWVfdGFiOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlTDrG0gdGjhuqV5IG7DunQgVHJhbmcgY2jhu6cvSG9tZSBzYXUgYmFjaywgxJFhbmcgYuG6pW0uLi4iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihob21lX3RhYikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIDM6IEJhY2sgbmhp4buBdSBs4bqnbiBoxqFuIG7hur91IHbhuqtuIGNoxrBhIHbhu4EgxJHGsOG7o2MKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVGjhu60gYmFjayBuaGnhu4F1IGzhuqduIMSR4buDIHbhu4EgaG9tZSIpCiAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKDMpOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7rSA0OiBDdeG7kWkgY8O5bmcgbeG7nyBs4bqhaSBhcHAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTeG7nyBs4bqhaSDhu6luZyBk4bulbmcgWW91VHViZSIpCiAgICAgICAgICAgIHNlbGYub3Blbl9hcHAoKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykKICAgICAgICAgICAgcmV0dXJuIHNlbGYuaXNfaG9tZV9zY3JlZW4oKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kgZW5zdXJlIGhvbWUgc2NyZWVuOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHZhbGlkYXRlX2FwcF9ub3RfYmFubmVkKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSBhcHAgY8OzIGLhu4sgYmFubmVkIGtow7RuZwogICAgICAgIFlvdVR1YmUgw610IGtoaSBi4buLIGJhbiBuw6puIGx1w7RuIHJldHVybiBUcnVlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBraMO0bmcgYuG7iyBiYW5uZWQKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICBpZiBjdXJyZW50X3BhY2thZ2UgIT0gc2VsZi5hcHBfcGFja2FnZToKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlICAjIEFwcCBjaMawYSBt4bufCiAgICAgICAgICAgIAogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDoWMgZOG6pXUgaGnhu4d1IGLhu4sgYmFuIChu4bq/dSBjw7MpCiAgICAgICAgICAgIGJhbl9pbmRpY2F0b3JzID0gWwogICAgICAgICAgICAgICAgIkFjY291bnQgc3VzcGVuZGVkIiwKICAgICAgICAgICAgICAgICJUaGlzIGFjY291bnQgaGFzIGJlZW4gdGVybWluYXRlZCIsCiAgICAgICAgICAgICAgICAiQ29tbXVuaXR5IEd1aWRlbGluZXMgdmlvbGF0aW9uIgogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgaW5kaWNhdG9yIGluIGJhbl9pbmRpY2F0b3JzOgogICAgICAgICAgICAgICAgaWYgaW5kaWNhdG9yLmxvd2VyKCkgaW4gc2NyZWVuX3htbC5sb3dlcigpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJQaMOhdCBoaeG7h24gYXBwIGLhu4sgYmFuOiB7aW5kaWNhdG9yfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2nhu4NtIHRyYSBhcHAgYmFubmVkOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBEZWZhdWx0IGtow7RuZyBi4buLIGJhbgogICAgCiAgICBkZWYgcGVyZm9ybV9yYW5kb21fdmlld192aWRlb19jaGFuZWxfYWN0aW9uKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gaMOgbmggxJHhu5luZyB4ZW0gdmlkZW8vY2hhbm5lbCBuZ+G6q3Ugbmhpw6puCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUaOG7sWMgaGnhu4duIHJhbmRvbSB2aWV3IHZpZGVvL2NoYW5uZWwgY2hvIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICAgICAgICAgc2VsZi5faGFuZGxlX2Nsb3NlX3BvcHVwcygpCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgICAgICBjdXJyZW50X3NjcmVlbiA9IHNlbGYuZ2V0X2N1cnJlbnRfc2NyZWVuKCkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkN1cnJlbnQgc2NyZWVuOiB7Y3VycmVudF9zY3JlZW59IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgWOG7rSBsw70gdGhlbyBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgICAgICBpZiBjdXJyZW50X3NjcmVlbiA9PSAidmlld192aWRlbyI6CiAgICAgICAgICAgICAgICAjIMSQw6MgxJFhbmcgeGVtIHZpZGVvLCBjw7MgdGjhu4MgdGnhur9wIHThu6VjIHhlbSBob+G6t2MgdGhvw6F0CiAgICAgICAgICAgICAgICAjIMSQYW5nIHhlbSB2aWRlbywgY8OzIHRo4buDIHTDrG0gdsOgIGLhuqVtIHbDoG8gcGxheWxpc3QgZW50cnkgcG9pbnQKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQYW5nIHhlbSB2aWRlbywgdMOsbSBwbGF5bGlzdCBlbnRyeSBwb2ludCIpCiAgICAgICAgICAgICAgICBwbGF5bGlzdF9lbnRyeSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmdvb2dsZS5hbmRyb2lkLnlvdXR1YmU6aWQvcGxheWxpc3RfZW50cnlfcG9pbnRfY29udGFpbmVyIikKICAgICAgICAgICAgICAgIGlmIHBsYXlsaXN0X2VudHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlTDrG0gdGjhuqV5IHBsYXlsaXN0IGVudHJ5IHBvaW50LCDEkWFuZyBi4bqlbS4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHBsYXlsaXN0X2VudHJ5KQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgcGxheWxpc3QgZW50cnkgcG9pbnQsIFRo4butIHZ14buRdCDEkeG7gSB4deG6pXQiKQoKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9nZXRfZmlyc3RfdmlkZW9fdG9fdmlldygpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSB2aWRlbyBuw6BvIMSR4buDIHhlbSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKQoKICAgICAgICAgICAgZWxpZiBjdXJyZW50X3NjcmVlbiA9PSAiaG9tZV9zZWFyY2giOgogICAgICAgICAgICAgICAgIyDEkGFuZyDhu58gbcOgbiBow6xuaCBzZWFyY2gsIGPDsyB0aOG7gyB0w6xtIGtp4bq/bSBob+G6t2MgduG7gSBob21lCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkGFuZyDhu58gbcOgbiBow6xuaCBzZWFyY2giKQogICAgICAgICAgICAgICAgc2VsZi5fcGVyZm9ybV9zZWFyY2hfZnJvbV9zZWFyY2hfc2NyZWVuKCkKICAgICAgICAgICAgZWxpZiBjdXJyZW50X3NjcmVlbiA9PSAiaG9tZSI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkGFuZyDhu58gbcOgbiBow6xuaCBob21lIikKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9nZXRfZmlyc3RfdmlkZW9fdG9fdmlldygpOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSB2aWRlbyBuw6BvIMSR4buDIHhlbSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcGVyZm9ybV9zZWFyY2hfZnJvbV9zZWFyY2hfc2NyZWVuKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSB0aOG7sWMgaGnhu4duIHJhbmRvbSB2aWV3OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9wZXJmb3JtX3NlYXJjaF9mcm9tX3NlYXJjaF9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIHTDrG0ga2nhur9tIGtoaSDEkWFuZyDhu58gbcOgbiBow6xuaCBzZWFyY2gKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVGjhu7FjIGhp4buHbiBzZWFyY2ggdOG7qyBtw6BuIGjDrG5oIHNlYXJjaCIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHNlYXJjaCB0ZXJtcyB04burIGNvbmZpZwogICAgICAgICAgICBjb25maWcgPSBzZWxmLmdldF9hcHBfY29uZmlnKCkKICAgICAgICAgICAga2V5X3NlYXJjaF9pZCA9IGNvbmZpZy5nZXQoImtleV9zZWFyY2hfaWQiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGtleV9zZWFyY2hfaWQ6CiAgICAgICAgICAgICAgICAjIFNwbGl0IGLhurFuZyBk4bqldSBwaOG6qXkgdsOgIGzhuqV5IHJhbmRvbQogICAgICAgICAgICAgICAgc2VhcmNoX2lkcyA9IFtzLnN0cmlwKCkgZm9yIHMgaW4ga2V5X3NlYXJjaF9pZC5zcGxpdCgiLCIpIGlmIHMuc3RyaXAoKV0KICAgICAgICAgICAgICAgIGlmIHNlYXJjaF9pZHM6CiAgICAgICAgICAgICAgICAgICAgdGVybSA9IHJhbmRvbS5jaG9pY2Uoc2VhcmNoX2lkcykKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBGYWxsYmFjayBu4bq/dSBjb25maWcgcuG7l25nCiAgICAgICAgICAgICAgICAgICAgdGVybSA9IHJhbmRvbS5jaG9pY2UoWyJtdXNpYyIsICJ0dXRvcmlhbCIsICJnYW1pbmciXSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRmFsbGJhY2sgbuG6v3Uga2jDtG5nIGPDsyBjb25maWcKICAgICAgICAgICAgICAgIHRlcm0gPSByYW5kb20uY2hvaWNlKFsibXVzaWMiLCAidHV0b3JpYWwiLCAiZ2FtaW5nIl0pCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiU2VhcmNoIHRlcm06IHt0ZXJtfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gc2VhcmNoIGJveCB24bubaSBuaGnhu4F1IHZhcmlhbnRzCiAgICAgICAgICAgIHNlYXJjaF9ib3ggPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9InNlYXJjaF9lZGl0X3RleHQiKQogICAgICAgICAgICBpZiBub3Qgc2VhcmNoX2JveDoKICAgICAgICAgICAgICAgIHNlYXJjaF9ib3ggPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJUw6xtIGtp4bq/bSIpCiAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfYm94OgogICAgICAgICAgICAgICAgc2VhcmNoX2JveCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJUw6xtIHRyw6puIFlvdVR1YmUiKQogICAgICAgICAgICBpZiBub3Qgc2VhcmNoX2JveDoKICAgICAgICAgICAgICAgIHNlYXJjaF9ib3ggPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL3NlYXJjaF9jbGVhciIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzZWFyY2hfYm94OgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF9ib3gpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOaOG6rXAgc2VhcmNoIHRlcm0KICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmlucHV0X3RleHQodGVybSkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5o4bqlbiBzZWFyY2gKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2VudGVyKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gdsOgIHhlbSB2aWRlbyDEkeG6p3UgdGnDqm4gY+G7p2Ega8OqbmggxJHDoyBjb25maWcKICAgICAgICAgICAgICAgIHZpZGVvX2ZvdW5kID0gc2VsZi5fZ2V0X2ZpcnN0X3ZpZGVvX3RvX3ZpZXcoKQogICAgICAgICAgICAgICAgaWYgdmlkZW9fZm91bmQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgdmlkZW8gY+G7p2Ega8OqbmgsIHNjcm9sbCBr4bq/dCBxdeG6oyBzZWFyY2gKICAgICAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKDIpOgogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBRdWF5IGzhuqFpIGhvbWUKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgc2VhcmNoIGJveCIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBzZWFyY2ggdOG7qyBzZWFyY2ggc2NyZWVuOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9nZXRfZmlyc3RfdmlkZW9fdG9fdmlldyhzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdsOgIHhlbSB2aWRlbyDEkeG6p3UgdGnDqm4gY+G7p2EgY8OhYyBrw6puaCDEkcOjIGNvbmZpZyB0cm9uZyBr4bq/dCBxdeG6oyBzZWFyY2gKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHTDrG0gdGjhuqV5IHbDoCB4ZW0gdmlkZW8gdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2gga8OqbmggdOG7qyBjb25maWcKICAgICAgICAgICAgdGFyZ2V0X2NoYW5uZWxzID0gc2VsZi5nZXRfdGFyZ2V0X2NoYW5uZWxzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHZpZGVvIGPhu6dhIGPDoWMga8Oqbmg6IHsnLCAnLmpvaW4odGFyZ2V0X2NoYW5uZWxzKX0iKQogICAgICAgICAgICBtYXhfc2Nyb2xscyA9IDE1ICAjIEdp4bubaSBo4bqhbiBz4buRIGzhuqduIHNjcm9sbAogICAgICAgICAgICBmb3Igc2Nyb2xsX2NvdW50IGluIHJhbmdlKG1heF9zY3JvbGxzKToKICAgICAgICAgICAgICAgICMgTOG6pXkgWE1MIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyBlcXVhbGl6ZXIgdGjDrCB2deG7kXQgbMOqbgogICAgICAgICAgICAgICAgZXF1YWxpemVyX2VsZW1lbnQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL2VxdWFsaXplciIpCiAgICAgICAgICAgICAgICBpZiBlcXVhbGl6ZXJfZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIHRo4bqleSBlcXVhbGl6ZXIsIMSRYW5nIHZ14buRdCBsw6puLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICB2aWRlb19idXR0b25zID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50cyhyZXNvdXJjZV9pZD0iY29tLmdvb2dsZS5hbmRyb2lkLnlvdXR1YmU6aWQvY2hhbm5lbCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCB2aWRlb19idXR0b25zOgogICAgICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIHZpZGVvIGJ1dHRvbnMgY8OzIHRow7RuZyB0aW4ga8OqbmggIAogICAgICAgICAgICAgICAgICAgIHZpZGVvX2J1dHRvbnMgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRzKAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGZvciBidXR0b24gaW4gdmlkZW9fYnV0dG9uczoKICAgICAgICAgICAgICAgICAgICBidXR0b25fZGVzYyA9IGJ1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBidXR0b25fZGVzYyBvciBidXR0b25fZGVzYyA9PSAibnVsbCI6ICAjIEZhbGxiYWNrIG7hur91IGNvbnRlbnQtZGVzYyBy4buXbmcKICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uX2Rlc2MgPSBidXR0b24uZ2V0KCJ0ZXh0IiwgIiIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGNvbnRlbnQtZGVzYyBjaOG7qWEgdMOqbiBi4bqldCBr4buzIGvDqm5oIHRhcmdldCBuw6BvCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZF9jaGFubmVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgIGZvciB0YXJnZXRfY2hhbm5lbCBpbiB0YXJnZXRfY2hhbm5lbHM6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRfY2hhbm5lbCBpbiBidXR0b25fZGVzYyBhbmQgInBow6F0IHZpZGVvIiBpbiBidXR0b25fZGVzYykgb3IgdGFyZ2V0X2NoYW5uZWwgPT0gYnV0dG9uX2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVkX2NoYW5uZWwgPSB0YXJnZXRfY2hhbm5lbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBtYXRjaGVkX2NoYW5uZWw6CiAgICAgICAgICAgICAgICAgICAgICAgICMgTOG6pXkgdmlkZW8gdGl0bGUgxJHhu4Mga2nhu4NtIHRyYSBs4buLY2ggc+G7rQogICAgICAgICAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gdGl0bGUgdOG7qyByZXNvdXJjZS1pZCB0csaw4bubYwogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZV9lbGVtZW50ID0gc2VsZi5oZWxwZXIuZ2V0X25leHRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgYnV0dG9uLCByZXNvdXJjZV9pZD0iY29tLmdvb2dsZS5hbmRyb2lkLnlvdXR1YmU6aWQvdGl0bGUiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB0aXRsZV9lbGVtZW50OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGVfdGV4dCA9IHRpdGxlX2VsZW1lbnQuZ2V0KCJ0ZXh0IiwgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0aXRsZV90ZXh0IGFuZCB0aXRsZV90ZXh0LnN0cmlwKCkgYW5kIHRpdGxlX3RleHQgIT0gIm51bGwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX3RpdGxlID0gdGl0bGVfdGV4dC5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHZpZGVvIHRpdGxlIHThu6sgcmVzb3VyY2UtaWQ6IHt2aWRlb190aXRsZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb190aXRsZSA9IHNlbGYuX2V4dHJhY3RfdmlkZW9fdGl0bGVfZnJvbV9lbGVtZW50KGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX3RpdGxlID0gc2VsZi5fZXh0cmFjdF92aWRlb190aXRsZV9mcm9tX2VsZW1lbnQoYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSB2aWRlbyDEkcOjIHhlbSBn4bqnbiDEkcOieSBjaMawYQogICAgICAgICAgICAgICAgICAgICAgICBpZiB2aWRlb190aXRsZSBhbmQgbm90IHNlbGYuX2Nhbl93YXRjaF92aWRlbyh2aWRlb190aXRsZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQuG7jyBxdWEgdmlkZW8gxJHDoyB4ZW0gZ+G6p24gxJHDonk6IHt2aWRlb190aXRsZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB2aWRlbyBj4bunYSB7bWF0Y2hlZF9jaGFubmVsfToge2J1dHRvbl9kZXNjfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIENsaWNrIHbDoG8gdmlkZW8KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgxJHDoyB2w6BvIHZpZGVvIGNoxrBhCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfc2NyZWVuID0gc2VsZi5nZXRfY3VycmVudF9zY3JlZW4oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3NjcmVlbiA9PSAidmlld192aWRlbyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIGjDoG0gd2F0Y2hfdmlkZW8oKSDEkeG7gyB4ZW0gduG7m2kgeOG7rSBsw70gcXXhuqNuZyBjw6FvIHbDoCBraOG6o28gc8OhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHbDoCDEkcOzbmcgcG9wdXAvZGlhbG9nIG7hur91IGPDswogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX2Nsb3NlX3BvcHVwcygpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYud2F0Y2hfdmlkZW8oKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB2w6BvIMSRxrDhu6NjIHZpZGVvLCB0aOG7rSB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgdmlkZW8gY+G7p2EgY8OhYyBrw6puaCB0YXJnZXQsIHNjcm9sbCB4deG7kW5nIMSR4buDIHTDrG0gdGjDqm0KICAgICAgICAgICAgICAgIGlmIHNjcm9sbF9jb3VudCA8IG1heF9zY3JvbGxzIC0gMTogICMgS2jDtG5nIHNjcm9sbCDhu58gbOG6p24gY3Xhu5FpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlNjcm9sbCB7c2Nyb2xsX2NvdW50ICsgMX0ve21heF9zY3JvbGxzfSDEkeG7gyB0w6xtIHZpZGVvIGPhu6dhIGPDoWMga8Oqbmg6IHsnLCAnLmpvaW4odGFyZ2V0X2NoYW5uZWxzKX0iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMC41LCAxLjApKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSB2aWRlbyBj4bunYSBjw6FjIGvDqm5oIHsnLCAnLmpvaW4odGFyZ2V0X2NoYW5uZWxzKX0gc2F1IHttYXhfc2Nyb2xsc30gbOG6p24gc2Nyb2xsIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSB0w6xtIHZpZGVvIMSR4bqndSB0acOqbjoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB3YXRjaF92aWRlbyhzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFhlbSB2aWRlbyB24bubaSB44butIGzDvSBxdeG6o25nIGPDoW8gdsOgIGto4bqjbyBzw6F0CiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB4ZW0gdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4bqvdCDEkeG6p3UgeGVtIHZpZGVvIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdGjDtG5nIHRpbiB2aWRlbyB0csaw4bubYyBraGkgeGVtCiAgICAgICAgICAgIHZpZGVvX3RpdGxlID0gIiIKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGNvbmZpZyB0aOG7nWkgZ2lhbiB4ZW0KICAgICAgICAgICAgY29uZmlnID0gc2VsZi5nZXRfYXBwX2NvbmZpZygpCiAgICAgICAgICAgIGFkX3dhdGNoX21pbiA9IGNvbmZpZy5nZXQoImFkX3dhdGNoX3RpbWVfbWluIiwgNSkKICAgICAgICAgICAgYWRfd2F0Y2hfbWF4ID0gY29uZmlnLmdldCgiYWRfd2F0Y2hfdGltZV9tYXgiLCAzMCkKICAgICAgICAgICAgdmlkZW9fd2F0Y2hfbWluID0gY29uZmlnLmdldCgidmlkZW9fd2F0Y2hfdGltZV9taW4iLCAxNSkKICAgICAgICAgICAgdmlkZW9fd2F0Y2hfbWF4ID0gY29uZmlnLmdldCgidmlkZW9fd2F0Y2hfdGltZV9tYXgiLCAxMDApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bujaSB2aWRlbyBsb2FkCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICBzZWxmLl9oYW5kbGVfY2xvc2VfcG9wdXBzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgMS4gS2nhu4NtIHRyYSB2w6AgeOG7rSBsw70gIkLhu48gcXVhIGto4bqjbyBzw6F0IgogICAgICAgICAgICBzZWxmLl9oYW5kbGVfc2tpcF9zdXJ2ZXkoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAyLiBLaeG7g20gdHJhIHbDoCB44butIGzDvSBxdeG6o25nIGPDoW8gLSBs4bq3cCBs4bqhaSDEkeG6v24ga2hpIGjhur90IHF14bqjbmcgY8Ohbywgw610IG5o4bqldCAyIGzhuqduCiAgICAgICAgICAgIGFkX2hhbmRsZWRfY291bnQgPSAwCiAgICAgICAgICAgIG1heF9zYWZldHlfbGltaXQgPSAxMCAgIyBHaeG7m2kgaOG6oW4gYW4gdG/DoG4gxJHhu4MgdHLDoW5oIHbDtCBo4bqhbgogICAgICAgICAgICAKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgIGFkX2ZvdW5kID0gc2VsZi5faGFuZGxlX2FkdmVydGlzZW1lbnQoYWRfd2F0Y2hfbWluLCBhZF93YXRjaF9tYXgpCiAgICAgICAgICAgICAgICBhZF9oYW5kbGVkX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIGlmIGFkX2ZvdW5kOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHjhu60gbMO9IHF14bqjbmcgY8OhbyBs4bqnbiB7YWRfaGFuZGxlZF9jb3VudH0iKQogICAgICAgICAgICAgICAgICAgICMgxJDhu6NpIG3hu5l0IGNow7p0IHRyxrDhu5tjIGtoaSBraeG7g20gdHJhIHF14bqjbmcgY8OhbyB0aeG6v3AgdGhlbwogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyB0w6xtIHRo4bqleSBxdeG6o25nIGPDoW8KICAgICAgICAgICAgICAgICAgICBpZiBhZF9oYW5kbGVkX2NvdW50ID49IDI6CiAgICAgICAgICAgICAgICAgICAgICAgICMgxJDDoyB44butIGzDvSDDrXQgbmjhuqV0IDIgbOG6p24gdsOgIGtow7RuZyBjw7JuIHF14bqjbmcgY8OhbyDihpIgZOG7q25nCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJIb8OgbiB0aMOgbmggeOG7rSBsw70ge2FkX2hhbmRsZWRfY291bnR9IHF14bqjbmcgY8OhbyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZWxpZiBhZF9oYW5kbGVkX2NvdW50ID09IDE6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQ2jhu4kgeOG7rSBsw70gMSBs4bqnbiwgdGjhu60gdGjDqm0gMSBs4bqnbiBu4buvYQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIHjhu60gbMO9IDEgcXXhuqNuZyBjw6FvLCBraeG7g20gdHJhIHRow6ptIGzhuqduIG7hu69hLi4uIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgcXXhuqNuZyBjw6FvIG7DoG8g4oaSIGThu6tuZwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEdp4bubaSBo4bqhbiBhbiB0b8OgbgogICAgICAgICAgICAgICAgaWYgYWRfaGFuZGxlZF9jb3VudCA+PSBtYXhfc2FmZXR5X2xpbWl0OgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLEkOG6oXQgZ2nhu5tpIGjhuqFuIGFuIHRvw6BuIHttYXhfc2FmZXR5X2xpbWl0fSBxdeG6o25nIGPDoW8sIGThu6tuZyB44butIGzDvSIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGFkX2hhbmRsZWRfY291bnQgPiAwOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlThu5VuZyBz4buRIHF14bqjbmcgY8OhbyDEkcOjIHjhu60gbMO9OiB7YWRfaGFuZGxlZF9jb3VudH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5faGFuZGxlX2Nsb3NlX3BvcHVwcygpCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHZpZGVvIHRpdGxlIHThu6sgWE1MIGhp4buHbiB04bqhaQogICAgICAgICAgICAgICAgeG1sX3N0cmluZyA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICBpZiB4bWxfc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICMgUGjGsMahbmcgcGjDoXAgMTogVMOsbSBWaWV3R3JvdXAgY8OzIHRleHQgdsOgIGNvbnRlbnQtZGVzYyBnaeG7kW5nIG5oYXUgKMSRw6J5IGzDoCB0aXRsZSBjaMOtbmgpCiAgICAgICAgICAgICAgICAgICAgIyDGr3UgdGnDqm4gdMOsbSBlbGVtZW50IGPDsyB0ZXh0IGTDoGkgaMahbiB2w6Aga2jDtG5nIHBo4bqjaSBxdeG6o25nIGPDoW8KICAgICAgICAgICAgICAgICAgICBhbGxfZWxlbWVudHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoeG1sX3N0cmluZywgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXdHcm91cCIpCiAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlcyA9IFtdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yIGVsZW1lbnQgaW4gYWxsX2VsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudF9kZXNjID0gZWxlbWVudC5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICAjIFRpdGxlIHRoxrDhu51uZyBjw7MgdGV4dCB2w6AgY29udGVudC1kZXNjIGdp4buRbmcgbmhhdSB2w6AgZMOgaSA+IDE1IGvDvSB04buxCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0IGFuZCBjb250ZW50X2Rlc2MgYW5kIHRleHQgPT0gY29udGVudF9kZXNjIGFuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbih0ZXh0KSA+IDE1IGFuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsxrDhu6N0IHhlbSIgbm90IGluIHRleHQgYW5kICJwaMO6dCIgbm90IGluIHRleHQgYW5kICJnacOieSIgbm90IGluIHRleHQgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibsSDbSB0csaw4bubYyIgbm90IGluIHRleHQgYW5kICJ0aMOhbmcgdHLGsOG7m2MiIG5vdCBpbiB0ZXh0IGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIsSRxrDhu6NjIHTDoGkgdHLhu6MiIG5vdCBpbiB0ZXh0Lmxvd2VyKCkgYW5kICJzcG9uc29yIiBub3QgaW4gdGV4dC5sb3dlcigpKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZXMuYXBwZW5kKCh0ZXh0LnN0cmlwKCksIGxlbih0ZXh0KSkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBDaOG7jW4gY2FuZGlkYXRlIGPDsyB0ZXh0IGTDoGkgbmjhuqV0ICh0aMaw4budbmcgbMOgIHRpw6p1IMSR4buBIHZpZGVvIGNow61uaCkKICAgICAgICAgICAgICAgICAgICBpZiBjYW5kaWRhdGVzOgogICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVzLnNvcnQoa2V5PWxhbWJkYSB4OiB4WzFdLCByZXZlcnNlPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX3RpdGxlID0gY2FuZGlkYXRlc1swXVswXQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgdmlkZW8gdGl0bGUgdOG7qyBWaWV3R3JvdXA6IHt2aWRlb190aXRsZX0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgUGjGsMahbmcgcGjDoXAgMjogVMOsbSB04burIGJ1dHRvbiBjaOG7qWEgdG/DoG4gYuG7mSB0aMO0bmcgdGluIHZpZGVvCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHZpZGVvX3RpdGxlOgogICAgICAgICAgICAgICAgICAgICAgICBidXR0b25fZWxlbWVudHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoeG1sX3N0cmluZywgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuQnV0dG9uIikKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGJ1dHRvbiBpbiBidXR0b25fZWxlbWVudHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBidXR0b24uZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSBidXR0b24gY8OzIGNvbnRlbnQtZGVzYyBjaOG7qWEgdGl0bGUgdmlkZW8gZMOgaQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnRfZGVzYyBhbmQgbGVuKGNvbnRlbnRfZGVzYykgPiAzMCBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbnkoa2V5d29yZCBpbiBjb250ZW50X2Rlc2MubG93ZXIoKSBmb3Iga2V5d29yZCBpbiBbIm12IiwgIm9mZmljaWFsIiwgImNvdmVyIiwgIm11c2ljIiwgInZpZGVvIl0pIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLEkcaw4bujYyB0w6BpIHRy4bujIiBub3QgaW4gY29udGVudF9kZXNjLmxvd2VyKCkgYW5kICJzcG9uc29yIiBub3QgaW4gY29udGVudF9kZXNjLmxvd2VyKCkpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ8OzIHRo4buDIMSRw6J5IGzDoCB0aXRsZSB0cm9uZyBidXR0b24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb190aXRsZSA9IGNvbnRlbnRfZGVzYy5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHZpZGVvIHRpdGxlIHThu6sgYnV0dG9uIGNvbnRlbnQtZGVzYzoge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgY29udGVudF9kZXNjIGFuZCAicGjDoXQgdmlkZW8iIGluIGNvbnRlbnRfZGVzYyBhbmQgIiAtICIgaW4gY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUGFyc2UgY29udGVudC1kZXNjIMSR4buDIGzhuqV5IHRpdGxlIChwaOG6p24gxJHhuqd1IHRyxrDhu5tjIGThuqV1IHBo4bqpeSDEkeG6p3UgdGnDqm4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydHMgPSBjb250ZW50X2Rlc2Muc3BsaXQoIiAtICIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA+PSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IHBo4bqnbiDEkeG6p3UsIGLhu48gcGjhuqduIGN14buRaSBjaOG7qWEgbWV0YWRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGVfcGFydCA9IHBhcnRzWzBdLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBwaOG6p24gdGjhu51pIGdpYW4gbuG6v3UgY8OzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJwaMO6dCIgbm90IGluIHRpdGxlX3BhcnQgYW5kICJnacOieSIgbm90IGluIHRpdGxlX3BhcnQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb190aXRsZSA9IHRpdGxlX3BhcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB2aWRlbyB0aXRsZSB04burIGJ1dHRvbjoge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgUGjGsMahbmcgcGjDoXAgMzogRmFsbGJhY2sgLSB0w6xtIHRleHQgZMOgaSBuaOG6pXQgY8OzIMO9IG5naMSpYSAobG/huqFpIHRy4burIHF14bqjbmcgY8OhbykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgdmlkZW9fdGl0bGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGFsbF9lbGVtZW50cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCh4bWxfc3RyaW5nKQogICAgICAgICAgICAgICAgICAgICAgICBsb25nZXN0X3RleHQgPSAiIgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgZWxlbWVudCBpbiBhbGxfZWxlbWVudHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0IGFuZCBsZW4odGV4dCkgPiBsZW4obG9uZ2VzdF90ZXh0KSBhbmQgbGVuKHRleHQpID4gMTUgYW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsxrDhu6N0IHhlbSIgbm90IGluIHRleHQgYW5kICJwaMO6dCIgbm90IGluIHRleHQgYW5kICJnacOieSIgbm90IGluIHRleHQgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm7Eg20gdHLGsOG7m2MiIG5vdCBpbiB0ZXh0IGFuZCAidGjDoW5nIHRyxrDhu5tjIiBub3QgaW4gdGV4dCBhbmQgIm5nw6B5IHRyxrDhu5tjIiBub3QgaW4gdGV4dCBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAixJHGsOG7o2MgdMOgaSB0cuG7oyIgbm90IGluIHRleHQubG93ZXIoKSBhbmQgInNwb25zb3IiIG5vdCBpbiB0ZXh0Lmxvd2VyKCkpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdlc3RfdGV4dCA9IHRleHQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG9uZ2VzdF90ZXh0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9fdGl0bGUgPSBsb25nZXN0X3RleHQuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHZpZGVvIHRpdGxlIHThu6sgdGV4dCBkw6BpIG5o4bqldDoge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHZpZGVvIHRpdGxlOiB7ZX0iKQoKICAgICAgICAgICAgIyBIaeG7g24gdGjhu4sgdGjDtG5nIGLDoW8gxJFhbmcgeGVtIHZpZGVvCiAgICAgICAgICAgIGlmIHZpZGVvX3RpdGxlOgogICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9tZXNzYWdlIiwgZiLEkGFuZyB4ZW0gdmlkZW8gWW91VHViZToge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgeGVtIHZpZGVvOiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsICLEkGFuZyB4ZW0gdmlkZW8gWW91VHViZSIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkGFuZyB4ZW0gdmlkZW8gWW91VHViZTogKGtow7RuZyBs4bqleSDEkcaw4bujYyB0aXRsZSkiKQoKICAgICAgICAgICAgIyAzLiBYZW0gdmlkZW8gY2jDrW5oCiAgICAgICAgICAgIHdhdGNoX3RpbWUgPSByYW5kb20ucmFuZGludCh2aWRlb193YXRjaF9taW4sIHZpZGVvX3dhdGNoX21heCkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlhlbSB2aWRlbyB0cm9uZyB7d2F0Y2hfdGltZX0gZ2nDonkiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2F0Y2hfdGltZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgNC4gTMawdSB2aWRlbyB2w6BvIGzhu4tjaCBz4butIG7hur91IGzhuqV5IMSRxrDhu6NjIHRpdGxlCiAgICAgICAgICAgIGlmIHZpZGVvX3RpdGxlOgogICAgICAgICAgICAgICAgc2VsZi5fc2F2ZV92aWRlb190b19oaXN0b3J5KHZpZGVvX3RpdGxlKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoIktow7RuZyBs4bqleSDEkcaw4bujYyB2aWRlbyB0aXRsZSDEkeG7gyBsxrB1IHbDoG8gbOG7i2NoIHPhu60iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB4ZW0gdmlkZW86IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2hhbmRsZV9za2lwX3N1cnZleShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IGLhu48gcXVhIGto4bqjbyBzw6F0IG7hur91IGPDswogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdMOsbSB0aOG6pXkgdsOgIGLhu48gcXVhIGto4bqjbyBzw6F0CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFTDrG0gYnV0dG9uICJC4buPIHF1YSBraOG6o28gc8OhdCIgaG/hurdjICJTa2lwIHN1cnZleSIKICAgICAgICAgICAgc2tpcF9zdXJ2ZXlfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IkLhu48gcXVhIGto4bqjbyBzw6F0IiwgY29udGFpbnM9VHJ1ZSkKICAgICAgICAgICAgaWYgbm90IHNraXBfc3VydmV5X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNraXBfc3VydmV5X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJTa2lwIHN1cnZleSIsIGNvbnRhaW5zPVRydWUpCiAgICAgICAgICAgIGlmIG5vdCBza2lwX3N1cnZleV9idXR0b246CiAgICAgICAgICAgICAgICBza2lwX3N1cnZleV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJC4buPIHF1YSBraOG6o28gc8OhdCIsIGNvbnRhaW5zPVRydWUpCiAgICAgICAgICAgIGlmIG5vdCBza2lwX3N1cnZleV9idXR0b246CiAgICAgICAgICAgICAgICBza2lwX3N1cnZleV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJTa2lwIHN1cnZleSIsIGNvbnRhaW5zPVRydWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBza2lwX3N1cnZleV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIHRo4bqleSBraOG6o28gc8OhdCwgxJFhbmcgYuG7jyBxdWEuLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNraXBfc3VydmV5X2J1dHRvbikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHjhu60gbMO9IGto4bqjbyBzw6F0OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9oYW5kbGVfYWR2ZXJ0aXNlbWVudChzZWxmLCBhZF93YXRjaF9taW46IGludCwgYWRfd2F0Y2hfbWF4OiBpbnQpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gcXXhuqNuZyBjw6FvIG7hur91IGPDswogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFkX3dhdGNoX21pbjogVGjhu51pIGdpYW4geGVtIHF14bqjbmcgY8OhbyB04buRaSB0aGnhu4N1CiAgICAgICAgICAgIGFkX3dhdGNoX21heDogVGjhu51pIGdpYW4geGVtIHF14bqjbmcgY8OhbyB04buRaSDEkWEKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0w6xtIHRo4bqleSB2w6AgeGVtIHF14bqjbmcgY8OhbwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDoWMgaW5kaWNhdG9yIGPhu6dhIHF14bqjbmcgY8OhbwogICAgICAgICAgICBhZF9pbmRpY2F0b3JzID0gWwogICAgICAgICAgICAgICAgIyBUZXh0IGluZGljYXRvcnMKICAgICAgICAgICAgICAgICgidGV4dCIsICJRdeG6o25nIGPDoW8iLCBUcnVlKSwKICAgICAgICAgICAgICAgICgidGV4dCIsICJBZHZlcnRpc2VtZW50IiwgVHJ1ZSksCiAgICAgICAgICAgICAgICAjIENvbnRlbnQtZGVzYyBpbmRpY2F0b3JzCiAgICAgICAgICAgICAgICAoImNvbnRlbnRfZGVzYyIsICJRdeG6o25nIGPDoW8iLCBUcnVlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIlNraXAgYWQiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIkLhu48gcXVhIHF14bqjbmcgY8OhbyIsIFRydWUpLAogICAgICAgICAgICAgICAgIyBSZXNvdXJjZS1pZCBpbmRpY2F0b3JzCiAgICAgICAgICAgICAgICAoInJlc291cmNlX2lkIiwgImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL2FkX3Byb2dyZXNzX3RleHQiLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoInJlc291cmNlX2lkIiwgInNraXBfYWRfYnV0dG9uIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgKCJyZXNvdXJjZV9pZCIsICJ2aWRlb19hZHMiLCBGYWxzZSksCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBxdeG6o25nIGPDoW8gLSDEkeG7jWMgWE1MIG3hu5l0IGzhuqduCiAgICAgICAgICAgIGFkX2ZvdW5kID0gRmFsc2UKICAgICAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKSAgIyDEkOG7jWMgWE1MIG3hu5l0IGzhuqduIGR1eSBuaOG6pXQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHhtbF9jb250ZW50OgogICAgICAgICAgICAgICAgZm9yIGluZGljYXRvcl90eXBlLCBpbmRpY2F0b3JfdmFsdWUsIHVzZV9jb250YWlucyBpbiBhZF9pbmRpY2F0b3JzOgogICAgICAgICAgICAgICAgICAgIGlmIGluZGljYXRvcl90eXBlID09ICJ0ZXh0IjoKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIHRleHQ9aW5kaWNhdG9yX3ZhbHVlLCBjb250YWlucz11c2VfY29udGFpbnMpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpbmRpY2F0b3JfdHlwZSA9PSAiY29udGVudF9kZXNjIjoKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIGNvbnRlbnRfZGVzYz1pbmRpY2F0b3JfdmFsdWUsIGNvbnRhaW5zPXVzZV9jb250YWlucykKICAgICAgICAgICAgICAgICAgICBlbGlmIGluZGljYXRvcl90eXBlID09ICJyZXNvdXJjZV9pZCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHhtbF9jb250ZW50LCByZXNvdXJjZV9pZD1pbmRpY2F0b3JfdmFsdWUsIGNvbnRhaW5zPXVzZV9jb250YWlucykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkX2ZvdW5kID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgYWRfZm91bmQ6CiAgICAgICAgICAgICAgICAjIFhlbSBxdeG6o25nIGPDoW8gdHJvbmcgdGjhu51pIGdpYW4gcmFuZG9tCiAgICAgICAgICAgICAgICBhZF93YXRjaF90aW1lID0gcmFuZG9tLnJhbmRpbnQoYWRfd2F0Y2hfbWluLCBhZF93YXRjaF9tYXgpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgcXXhuqNuZyBjw6FvLCB4ZW0gdHJvbmcge2FkX3dhdGNoX3RpbWV9IGdpw6J5IikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChhZF93YXRjaF90aW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gdsOgIGLhuqVtICJTa2lwIGFkIiBu4bq/dSBjw7MKICAgICAgICAgICAgICAgIHNlbGYuX3RyeV9za2lwX2FkKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHjhu60gbMO9IHF14bqjbmcgY8Ohbzoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfdHJ5X3NraXBfYWQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaOG7rSBi4buPIHF1YSBxdeG6o25nIGPDoW8gbuG6v3UgY8OzIGJ1dHRvbiBza2lwCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0w6xtIHRo4bqleSB2w6AgYuG6pW0gc2tpcAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUw6xtIGJ1dHRvbiBza2lwIGFkCiAgICAgICAgICAgIHNraXBfYnV0dG9ucyA9IFsKICAgICAgICAgICAgICAgICgidGV4dCIsICJTa2lwIiwgVHJ1ZSksCiAgICAgICAgICAgICAgICAoInRleHQiLCAiU2tpcCBhZCIsIFRydWUpLAogICAgICAgICAgICAgICAgKCJ0ZXh0IiwgIlNraXAgYWRzIiwgVHJ1ZSksCiAgICAgICAgICAgICAgICAoInRleHQiLCAiQuG7jyBxdWEiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgidGV4dCIsICJC4buPIHF1YSBxdeG6o25nIGPDoW8iLCBUcnVlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIlNraXAiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIlNraXAgYWQiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIkLhu48gcXVhIiwgVHJ1ZSksCiAgICAgICAgICAgICAgICAoInJlc291cmNlX2lkIiwgInNraXBfYWRfYnV0dG9uIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgKCJyZXNvdXJjZV9pZCIsICJza2lwX2J1dHRvbiIsIEZhbHNlKSwKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGJ1dHRvbl90eXBlLCBidXR0b25fdmFsdWUsIHVzZV9jb250YWlucyBpbiBza2lwX2J1dHRvbnM6CiAgICAgICAgICAgICAgICBpZiBidXR0b25fdHlwZSA9PSAidGV4dCI6CiAgICAgICAgICAgICAgICAgICAgc2tpcF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD1idXR0b25fdmFsdWUsIGNvbnRhaW5zPXVzZV9jb250YWlucykKICAgICAgICAgICAgICAgIGVsaWYgYnV0dG9uX3R5cGUgPT0gImNvbnRlbnRfZGVzYyI6CiAgICAgICAgICAgICAgICAgICAgc2tpcF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPWJ1dHRvbl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgZWxpZiBidXR0b25fdHlwZSA9PSAicmVzb3VyY2VfaWQiOgogICAgICAgICAgICAgICAgICAgIHNraXBfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHJlc291cmNlX2lkPWJ1dHRvbl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBza2lwX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4buPIHF1YSBxdeG6o25nIGPDoW8iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihza2lwX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgYuG7jyBxdWEgcXXhuqNuZyBjw6FvOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9oYW5kbGVfY2xvc2VfcG9wdXBzKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gxJHDs25nIGPDoWMgcG9wdXAvZGlhbG9nIG7hur91IGPDswogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdMOsbSB0aOG6pXkgdsOgIMSRw7NuZyBwb3B1cAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG7jWMgWE1MIG3hu5l0IGzhuqduIGR1eSBuaOG6pXQKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gYnV0dG9uICLEkMOzbmciIHThu6sgWE1MIMSRw6MgxJHhu41jCiAgICAgICAgICAgIGNsb3NlX2J1dHRvbnMgPSBbCiAgICAgICAgICAgICAgICAoImNvbnRlbnRfZGVzYyIsICLEkMOzbmciLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoImNvbnRlbnRfZGVzYyIsICJDbG9zZSIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICgidGV4dCIsICLEkMOzbmciLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoInRleHQiLCAiQ2xvc2UiLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoInRleHQiLCAiw5ciLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoImNvbnRlbnRfZGVzYyIsICJEaXNtaXNzIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgKCJyZXNvdXJjZV9pZCIsICJjb20uZ29vZ2xlLmFuZHJvaWQueW91dHViZTppZC9tb2Rlcm5fbWluaXBsYXllcl9jbG9zZSIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICgicmVzb3VyY2VfaWQiLCAiY29tLmdvb2dsZS5hbmRyb2lkLnlvdXR1YmU6aWQvY2xvc2VfYnV0dG9uIiwgRmFsc2UpLAogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICBwb3B1cF9jbG9zZWQgPSBGYWxzZQogICAgICAgICAgICBmb3IgYnV0dG9uX3R5cGUsIGJ1dHRvbl92YWx1ZSwgdXNlX2NvbnRhaW5zIGluIGNsb3NlX2J1dHRvbnM6CiAgICAgICAgICAgICAgICBpZiBidXR0b25fdHlwZSA9PSAidGV4dCI6CiAgICAgICAgICAgICAgICAgICAgY2xvc2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PWJ1dHRvbl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgZWxpZiBidXR0b25fdHlwZSA9PSAiY29udGVudF9kZXNjIjoKICAgICAgICAgICAgICAgICAgICBjbG9zZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz1idXR0b25fdmFsdWUsIGNvbnRhaW5zPXVzZV9jb250YWlucykKICAgICAgICAgICAgICAgIGVsaWYgYnV0dG9uX3R5cGUgPT0gInJlc291cmNlX2lkIjoKICAgICAgICAgICAgICAgICAgICBjbG9zZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPWJ1dHRvbl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBjbG9zZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHBvcHVwIHbhu5tpIHtidXR0b25fdHlwZX09J3tidXR0b25fdmFsdWV9JywgxJFhbmcgxJHDs25nLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoY2xvc2VfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgIHBvcHVwX2Nsb3NlZCA9IFRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHBvcHVwX2Nsb3NlZAogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIMSRw7NuZyBwb3B1cDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgICMgPT09PT0gVklERU8gSElTVE9SWSBNQU5BR0VNRU5UID09PT09CiAgICAKICAgIGRlZiBfc2F2ZV92aWRlb190b19oaXN0b3J5KHNlbGYsIHZpZGVvX3RpdGxlOiBzdHIpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgTMawdSB2aWRlbyB2w6BvIGzhu4tjaCBz4butIMSRw6MgeGVtIHRyb25nIGpvYnNfaGlzdG9yeSB0YWJsZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHZpZGVvX3RpdGxlOiBUw6puIHZpZGVvCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3QgdmlkZW9fdGl0bGUgb3IgdmlkZW9fdGl0bGUuc3RyaXAoKSA9PSAiIjoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgYWNjb3VudCAibm8uYWNjb3VudCIgY2hvIFlvdVR1YmUKICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnRfYnlfdW5pcXVlX3VzZXJuYW1lKHNlbGYuYXBwX25hbWUsICJuby5hY2NvdW50IikKICAgICAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgYWNjb3VudCBuby5hY2NvdW50IGNobyBZb3VUdWJlIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBqb2IgZGF0YSBjaG8gdmlkZW8gaGlzdG9yeQogICAgICAgICAgICBqb2JfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJhY2NvdW50X3V1aWQiOiBhY2NvdW50WyJhY2NvdW50X3V1aWQiXSwKICAgICAgICAgICAgICAgICJhcHAiOiBzZWxmLmFwcF9uYW1lLAogICAgICAgICAgICAgICAgImpvYl90eXBlIjogInZpZXciLAogICAgICAgICAgICAgICAgIm9iamVjdF9pZCI6IHZpZGVvX3RpdGxlLCAgIyBMxrB1IHZpZGVvIHRpdGxlIHbDoG8gb2JqZWN0X2lkCiAgICAgICAgICAgICAgICAibGluayI6ICIiLAogICAgICAgICAgICAgICAgInN0YXR1cyI6IDEsICAjIFN1Y2Nlc3MKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJwcmljZSI6IDAsCiAgICAgICAgICAgICAgICAiZXJyb3JfbWVzc2FnZSI6ICIiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSB2w6BvIGpvYnNfaGlzdG9yeQogICAgICAgICAgICBqb2JfdXVpZCA9IHNlbGYuZGIuYWRkX2pvYl9oaXN0b3J5KGpvYl9kYXRhKQogICAgICAgICAgICBpZiBqb2JfdXVpZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGzGsHUgdmlkZW8gdsOgbyBs4buLY2ggc+G7rToge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHRo4buDIGzGsHUgdmlkZW8gdsOgbyBs4buLY2ggc+G7rToge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBsxrB1IHZpZGVvIGhpc3Rvcnk6IHtlfSIpCiAgICAKICAgIGRlZiBfY2FuX3dhdGNoX3ZpZGVvKHNlbGYsIHZpZGVvX3RpdGxlOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIHRo4buDIHhlbSB2aWRlbyBraMO0bmcgKHF1ZXJ5IHRy4buxYyB0aeG6v3AgZGF0YWJhc2UpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdmlkZW9fdGl0bGU6IFTDqm4gdmlkZW8KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBjw7MgdGjhu4MgeGVtCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3QgdmlkZW9fdGl0bGUgb3IgdmlkZW9fdGl0bGUuc3RyaXAoKSA9PSAiIjoKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGFjY291bnQgIm5vLmFjY291bnQiIGNobyBZb3VUdWJlCiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50X2J5X3VuaXF1ZV91c2VybmFtZShzZWxmLmFwcF9uYW1lLCAibm8uYWNjb3VudCIpCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgS2jDtG5nIGPDsyBhY2NvdW50IHRow6wgY2hvIHBow6lwIHhlbQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbmZpZyA9IHNlbGYuZ2V0X2FwcF9jb25maWcoKQogICAgICAgICAgICBjb29sZG93bl9taW51dGVzID0gY29uZmlnLmdldCgidmlkZW9fcmV3YXRjaF9jb29sZG93bl9taW51dGVzIiwgMjQwKQogICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIGNvb2xkb3duX3NlY29uZHMgPSBjb29sZG93bl9taW51dGVzICogNjAKICAgICAgICAgICAgY3V0b2ZmX3RpbWUgPSBjdXJyZW50X3RpbWUgLSBjb29sZG93bl9zZWNvbmRzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFF1ZXJ5IHRy4buxYyB0aeG6v3AgZGF0YWJhc2UgxJHhu4Mga2nhu4NtIHRyYSB2aWRlbyDEkcOjIHhlbSBn4bqnbiDEkcOieSBjaMawYQogICAgICAgICAgICBjb25uID0gc2VsZi5kYi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgIAogICAgICAgICAgICBxdWVyeSA9ICIiIgogICAgICAgICAgICAgICAgU0VMRUNUIGNyZWF0ZWRfYXQgRlJPTSBqb2JzX2hpc3RvcnkgCiAgICAgICAgICAgICAgICBXSEVSRSBhY2NvdW50X3V1aWQgPSA/IAogICAgICAgICAgICAgICAgQU5EIGpvYl90eXBlID0gJ3ZpZXcnIAogICAgICAgICAgICAgICAgQU5EIG9iamVjdF9pZCA9ID8gCiAgICAgICAgICAgICAgICBBTkQgY3JlYXRlZF9hdCA+ID8KICAgICAgICAgICAgICAgIE9SREVSIEJZIGNyZWF0ZWRfYXQgREVTQyAKICAgICAgICAgICAgICAgIExJTUlUIDEKICAgICAgICAgICAgIiIiCiAgICAgICAgICAgIAogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZShxdWVyeSwgKGFjY291bnRbImFjY291bnRfdXVpZCJdLCB2aWRlb190aXRsZSwgY3V0b2ZmX3RpbWUpKQogICAgICAgICAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0OgogICAgICAgICAgICAgICAgIyBWaWRlbyDEkcOjIHhlbSB0cm9uZyB0aOG7nWkgZ2lhbiBjb29sZG93bgogICAgICAgICAgICAgICAgbGFzdF93YXRjaGVkID0gcmVzdWx0WzBdCiAgICAgICAgICAgICAgICB0aW1lX2RpZmYgPSBjdXJyZW50X3RpbWUgLSBsYXN0X3dhdGNoZWQKICAgICAgICAgICAgICAgIHJlbWFpbmluZ19ob3VycyA9IChjb29sZG93bl9zZWNvbmRzIC0gdGltZV9kaWZmKSAvIDM2MDAKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJWaWRlbyAne3ZpZGVvX3RpdGxlfScgxJHDoyB4ZW0gZ+G6p24gxJHDonksIGPDsm4ge3JlbWFpbmluZ19ob3VyczouMWZ9aCDEkeG7gyB4ZW0gbOG6oWkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFZpZGVvIGNoxrBhIHhlbSBob+G6t2MgxJHDoyDEkeG7pyB0aOG7nWkgZ2lhbiBjb29sZG93bgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlZpZGVvICd7dmlkZW9fdGl0bGV9JyBjw7MgdGjhu4MgeGVtIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraeG7g20gdHJhIGNhbiB3YXRjaCB2aWRlbzoge2V9IikKICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgRGVmYXVsdCBjaG8gcGjDqXAgeGVtCiAgICAKICAgIGRlZiBfZXh0cmFjdF92aWRlb190aXRsZV9mcm9tX2VsZW1lbnQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBUcsOtY2ggeHXhuqV0IHTDqm4gdmlkZW8gdOG7qyBlbGVtZW50IHbDoCBsw6BtIHPhuqFjaCB0acOqdSDEkeG7gQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGVsZW1lbnQ6IEVsZW1lbnQgY2jhu6lhIHRow7RuZyB0aW4gdmlkZW8KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBUw6puIHZpZGVvIMSRw6MgbMOgbSBz4bqhY2ggaG/hurdjIGNodeG7l2kgcuG7l25nCiAgICAgICAgIiIiCiAgICAgICAgZGVmIGNsZWFuX3RpdGxlKHRpdGxlOiBzdHIpIC0+IHN0cjoKICAgICAgICAgICAgIiIiTMOgbSBz4bqhY2ggdmlkZW8gdGl0bGUsIGxv4bqhaSBi4buPIGPDoWMgdGjDtG5nIHRpbiB0aOG7q2EiIiIKICAgICAgICAgICAgaWYgbm90IHRpdGxlOgogICAgICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIHBo4bqnbiB0aOG7nWkgZ2lhbiDhu58gY3Xhu5FpIG5oxrAgIi0gMiBwaMO6dCIsICItIDEgZ2nhu50iLCAiLSAzMCBnacOieSIKICAgICAgICAgICAgdGl0bGUgPSByZS5zdWIocidccypbLeKAk11ccypcZCtccyoocGjDunR8Z2nDonl8Z2nhu518dGnhur9uZylccyokJywgJycsIHRpdGxlLCBmbGFncz1yZS5JR05PUkVDQVNFKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBwaOG6p24gdGjhu51pIGdpYW4gZm9ybWF0IGtow6FjIG5oxrAgIigyOjMwKSIsICJbMzo0NV0iCiAgICAgICAgICAgIHRpdGxlID0gcmUuc3ViKHInXHMqW1xbXChdXHMqXGQrOlxkK1xzKltcXVwpXVxzKiQnLCAnJywgdGl0bGUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIHRow7RuZyB0aW4gbMaw4bujdCB4ZW0g4bufIGN14buRaSBuaMawICItIDFNIHZpZXdzIiwgIi0gMTAwSyBsxrDhu6N0IHhlbSIKICAgICAgICAgICAgdGl0bGUgPSByZS5zdWIocidccypbLeKAk11ccypcZCtbS01CXT9ccyoodmlld3M/fGzGsOG7o3QgeGVtKVxzKiQnLCAnJywgdGl0bGUsIGZsYWdzPXJlLklHTk9SRUNBU0UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIGtob+G6o25nIHRy4bqvbmcgdGjhu6thIHbDoCB0cuG6oyB24buBCiAgICAgICAgICAgIHJldHVybiB0aXRsZS5zdHJpcCgpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRo4butIGzhuqV5IHThu6sgdGV4dCB0csaw4bubYwogICAgICAgICAgICB0ZXh0ID0gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgICAgICAgICAgaWYgdGV4dCBhbmQgdGV4dCAhPSAibnVsbCIgYW5kIGxlbih0ZXh0KSA+IDU6CiAgICAgICAgICAgICAgICAjIELhu48gcXVhIG5o4buvbmcgdGV4dCBraMO0bmcgcGjhuqNpIHTDqm4gdmlkZW8KICAgICAgICAgICAgICAgIGlmIGFueShrZXl3b3JkIGluIHRleHQubG93ZXIoKSBmb3Iga2V5d29yZCBpbiBbImzGsOG7o3QgeGVtIiwgInBow7p0IiwgImdpw6J5IiwgIm7Eg20gdHLGsOG7m2MiLCAidGjDoW5nIHRyxrDhu5tjIiwgIm5nw6B5IHRyxrDhu5tjIiwgImdp4budIHRyxrDhu5tjIl0pOgogICAgICAgICAgICAgICAgICAgIHBhc3MgICMgS2jDtG5nIHBo4bqjaSB0aXRsZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xlYW5fdGl0bGUodGV4dC5zdHJpcCgpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7rSBs4bqleSB04burIGNvbnRlbnQtZGVzYwogICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBlbGVtZW50LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBhbmQgY29udGVudF9kZXNjICE9ICJudWxsIjoKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gY29udGVudC1kZXNjIGPDsyBmb3JtYXQ6ICJUw6puIHZpZGVvLCBUw6puIGvDqm5oLCBYIGzGsOG7o3QgeGVtLCBZIHRo4budaSBnaWFuLCBwaMOhdCB2aWRlbyIKICAgICAgICAgICAgICAgIGlmICJwaMOhdCB2aWRlbyIgaW4gY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgICAgIHBhcnRzID0gY29udGVudF9kZXNjLnNwbGl0KCIsICIpCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX3RpdGxlID0gcGFydHNbMF0uc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB2aWRlb190aXRsZSBhbmQgbGVuKHZpZGVvX3RpdGxlKSA+IDU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xlYW5fdGl0bGUodmlkZW9fdGl0bGUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgSG/hurdjIGNvbnRlbnQtZGVzYyBjaOG7iSBjaOG7qWEgdGjDtG5nIHRpbiB2aWRlbwogICAgICAgICAgICAgICAgaWYgImzGsOG7o3QgeGVtIiBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHBo4bqnbiB0csaw4bubYyAibMaw4bujdCB4ZW0iIGPDsyB0aOG7gyBsw6AgdGl0bGUKICAgICAgICAgICAgICAgICAgICBwYXJ0cyA9IGNvbnRlbnRfZGVzYy5zcGxpdCgibMaw4bujdCB4ZW0iKVswXS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBwaOG6p24gY3Xhu5FpIGPDsyB0aOG7gyBsw6Agc+G7kQogICAgICAgICAgICAgICAgICAgIHRpdGxlX3BhcnRzID0gcGFydHMuc3BsaXQoKQogICAgICAgICAgICAgICAgICAgIGlmIGxlbih0aXRsZV9wYXJ0cykgPiAzOiAgIyDEkOG6o20gYuG6o28gY8OzIMSR4bunIHThu6sgxJHhu4MgbMOgIHRpdGxlCiAgICAgICAgICAgICAgICAgICAgICAgICMgQuG7jyAxLTIgdOG7qyBjdeG7kWkgY8OzIHRo4buDIGzDoCBz4buRIGzGsOG7o3QgeGVtCiAgICAgICAgICAgICAgICAgICAgICAgIHBvdGVudGlhbF90aXRsZSA9ICIgIi5qb2luKHRpdGxlX3BhcnRzWzotMl0pLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBvdGVudGlhbF90aXRsZSkgPiAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbGVhbl90aXRsZShwb3RlbnRpYWxfdGl0bGUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgRmFsbGJhY2s6IG7hur91IGNvbnRlbnQtZGVzYyBkw6BpIHbDoCBjw7Mgw70gbmdoxKlhCiAgICAgICAgICAgICAgICBpZiBsZW4oY29udGVudF9kZXNjKSA+IDEwIGFuZCBub3QgYW55KGtleXdvcmQgaW4gY29udGVudF9kZXNjLmxvd2VyKCkgZm9yIGtleXdvcmQgaW4gWyJidXR0b24iLCAiaW1hZ2UiLCAidmlldyJdKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xlYW5fdGl0bGUoY29udGVudF9kZXNjLnN0cmlwKCkpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGV4dHJhY3QgdmlkZW8gdGl0bGU6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgCiAgICAjID09PT09IEdPTElLRSBJTlRFR1JBVElPTiAoWU9VVFVCRSBLSMOUTkcgU1VQUE9SVCkgPT09PT0KICAgIAogICAgZGVmIG1hcF9nb2xpa2VfYWNjb3VudHMoc2VsZiwgZ29saWtlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSwgZGV2aWNlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgWW91VHViZSBraMO0bmcgaOG7lyB0cuG7oyBHb0xpa2UKICAgICAgICAiIiIKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJZb3VUdWJlIGtow7RuZyBo4buXIHRy4bujIEdvTGlrZSBpbnRlZ3JhdGlvbiIpCiAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBnZXRfam9iX3BhcmFtcyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiWW91VHViZSBraMO0bmcgaOG7lyB0cuG7oyBqb2IgcGFyYW1zIiIiCiAgICAgICAgcmV0dXJuIHt9CiAgICAKICAgIGRlZiBleGVjdXRlX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgWW91VHViZSBraMO0bmcgdGjhu7FjIGhp4buHbiBqb2JzIHThu6sgR29MaWtlCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDAsICJZb3VUdWJlIGtow7RuZyBo4buXIHRy4bujIGpvYnMiLCBGYWxzZSkK').decode('utf-8'))
