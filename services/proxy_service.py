import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aHJlYWRpbmcKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgT3B0aW9uYWwKaW1wb3J0IHV0aWxzCgojIFThuqFvIGxvZ2dlciByacOqbmcgY2hvIFByb3h5U2VydmljZQpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJQcm94eVNlcnZpY2UiKQoKY2xhc3MgUHJveHlTZXJ2aWNlOgogICAgIiIiCiAgICBTZXJ2aWNlIHF14bqjbiBsw70gcHJveHkgdsOgIHTGsMahbmcgdMOhYyB24bubaSBwcm94eSBzZXJ2ZXIKICAgICIiIgogICAgCiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBQcm94eVNlcnZpY2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBkYl9zZXJ2aWNlOiBEYXRhYmFzZVNlcnZpY2UgxJHhu4MgbMawdSB0cuG7ryBk4buvIGxp4buHdQogICAgICAgICAgICBoZWxwZXJfc2VydmljZTogSGVscGVyU2VydmljZSDEkeG7gyB0xrDGoW5nIHTDoWMgduG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5kYiA9IGRiX3NlcnZpY2UKICAgICAgICBzZWxmLmhlbHBlciA9IGhlbHBlcl9zZXJ2aWNlCiAgICAgICAgCiAgICAgICAgIyBUcuG6oW5nIHRow6FpIHByb3h5IGhp4buHbiB04bqhaQogICAgICAgIHNlbGYuY3VycmVudF9wcm94eV9pZCA9IE5vbmUKICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfbmFtZSA9IE5vbmUKICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUgPSBOb25lICAjIFRhYmxlIG5hbWUgxJHGsOG7o2MgY+G6pXAgdOG7qyBwcm94eSBzZXJ2ZXIKICAgICAgICBzZWxmLnByb3h5X2xhc3RfdXBkYXRlID0gMCAgIyBUaOG7nWkgZ2lhbiB1cGRhdGUgY3Xhu5FpIGPDuW5nCiAgICAgICAgCiAgICAgICAgIyDEkOG6v20gc+G7kSBs4bqnbiB0aOG6pXQgYuG6oWkga2hpIHNldHVwIHByb3h5CiAgICAgICAgc2VsZi5wcm94eV9zZXR1cF9mYWlsX2NvdW50ID0gMAogICAgICAgIAogICAgICAgICMgVGhyZWFkIHVwZGF0ZSDEkeG7i25oIGvhu7MKICAgICAgICBzZWxmLnVwZGF0ZV90aHJlYWQgPSBOb25lCiAgICAgICAgc2VsZi51cGRhdGVfdGhyZWFkX3J1bm5pbmcgPSBGYWxzZQogICAgICAgIHNlbGYudXBkYXRlX2ludGVydmFsID0gMjAgICMgQ+G6rXAgbmjhuq10IG3hu5dpIDIwIGdpw6J5CiAgICAgICAgCiAgICAgICAgIyBYw7NhIHByb3h5IHRhYmxlIG5hbWUgY8WpIGto4buPaSBkZXZpY2UgY29uZmlnIGtoaSBraOG7n2kgdOG6oW8KICAgICAgICBzZWxmLmRiLnNldF9kZXZpY2VfY29uZmlnKCJwcm94eV90YWJsZV9uYW1lIiwgTm9uZSkKICAgIAogICAgZGVmIF9zdGFydF91cGRhdGVfdGhyZWFkKHNlbGYpOgogICAgICAgICIiIkLhuq90IMSR4bqndSB0aHJlYWQgdXBkYXRlIMSR4buLbmgga+G7syIiIgogICAgICAgIGlmIHNlbGYudXBkYXRlX3RocmVhZCBhbmQgc2VsZi51cGRhdGVfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiVGhyZWFkIHVwZGF0ZSBwcm94eSDEkcOjIMSRYW5nIGNo4bqheSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBzZWxmLnVwZGF0ZV90aHJlYWRfcnVubmluZyA9IFRydWUKICAgICAgICBzZWxmLnVwZGF0ZV90aHJlYWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1zZWxmLl91cGRhdGVfd29ya2VyLCBkYWVtb249VHJ1ZSkKICAgICAgICBzZWxmLnVwZGF0ZV90aHJlYWQuc3RhcnQoKQogICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBi4bqvdCDEkeG6p3UgdGhyZWFkIHVwZGF0ZSBwcm94eSAoaW50ZXJ2YWw6IHtzZWxmLnVwZGF0ZV9pbnRlcnZhbH1zKSIpCiAgICAgICAgCiAgICBkZWYgX3N0b3BfdXBkYXRlX3RocmVhZChzZWxmKToKICAgICAgICAiIiJE4burbmcgdGhyZWFkIHVwZGF0ZSDEkeG7i25oIGvhu7MiIiIKICAgICAgICBzZWxmLnVwZGF0ZV90aHJlYWRfcnVubmluZyA9IEZhbHNlCiAgICAgICAgaWYgc2VsZi51cGRhdGVfdGhyZWFkIGFuZCBzZWxmLnVwZGF0ZV90aHJlYWQuaXNfYWxpdmUoKToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQYW5nIGThu6tuZyB0aHJlYWQgdXBkYXRlIHByb3h5Li4uIikKICAgICAgICAgICAgc2VsZi51cGRhdGVfdGhyZWFkLmpvaW4odGltZW91dD01KQogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBk4burbmcgdGhyZWFkIHVwZGF0ZSBwcm94eSIpCiAgICAgICAgICAgIAogICAgZGVmIF91cGRhdGVfd29ya2VyKHNlbGYpOgogICAgICAgICIiIldvcmtlciBmdW5jdGlvbiBjaG8gdGhyZWFkIHVwZGF0ZSDEkeG7i25oIGvhu7MiIiIKICAgICAgICBsb2dnZXIuaW5mbygiVGhyZWFkIHVwZGF0ZSBwcm94eSDEkcOjIGLhuq90IMSR4bqndSIpCiAgICAgICAgCiAgICAgICAgd2hpbGUgc2VsZi51cGRhdGVfdGhyZWFkX3J1bm5pbmc6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgQ2jhu4kgdXBkYXRlIGtoaSBwcm94eSDEkWFuZyBhY3RpdmUKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfcHJveHlfYWN0aXZlKCk6CiAgICAgICAgICAgICAgICAgICAgY3VycmVudF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3RpbWUgLSBzZWxmLnByb3h5X2xhc3RfdXBkYXRlID49IHNlbGYudXBkYXRlX2ludGVydmFsOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnVwZGF0ZV9wcm94eSgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJUaHJlYWQgYXV0by11cGRhdGUgcHJveHkgdGltZXN0YW1wIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiVGhyZWFkIGF1dG8tdXBkYXRlIHByb3h5IHRpbWVzdGFtcCB0aOG6pXQgYuG6oWkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFNsZWVwIHbhu5tpIGtp4buDbSB0cmEgxJFp4buBdSBraeG7h24gZOG7q25nCiAgICAgICAgICAgICAgICBmb3IgXyBpbiByYW5nZShzZWxmLnVwZGF0ZV9pbnRlcnZhbCk6CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYudXBkYXRlX3RocmVhZF9ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHRyb25nIHRocmVhZCB1cGRhdGUgcHJveHk6IHtlfSIpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDUpICAjIFNsZWVwIG5n4bqvbiBraGkgY8OzIGzhu5dpCiAgICAgICAgICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbygiVGhyZWFkIHVwZGF0ZSBwcm94eSDEkcOjIGThu6tuZyIpCiAgICAKICAgIGRlZiBfcHJveHlfYXBpX2NhbGwoc2VsZiwgZW5kcG9pbnQ6IHN0ciwgZGF0YTogRGljdFtzdHIsIEFueV0pIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBH4buNaSBBUEkgcHJveHkgc2VydmVyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZW5kcG9pbnQ6IEVuZHBvaW50IEFQSSAocmVnaXN0ZXIsIHVwZGF0ZSwgdW5yZWdpc3RlciwgcmVzZXQtaXApCiAgICAgICAgICAgIGRhdGE6IEThu68gbGnhu4d1IGfhu61pCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgcmVzcG9uc2UgaG/hurdjIE5vbmUgbuG6v3UgbOG7l2kKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgcHJveHkgY29uZmlnIHThu6sgcHJveHlfY29uZmlnCiAgICAgICAgICAgIHByb3h5X2NvbmZpZyA9IHNlbGYuZGIuZ2V0X3Byb3h5X2NvbmZpZyh7fSkKICAgICAgICAgICAgcHJveHlfc2VydmVyID0gcHJveHlfY29uZmlnLmdldCgicHJveHlfc2VydmVyIiwgImh0dHA6Ly8xMC4wLjAuNjo5MDMyIikKICAgICAgICAgICAgdXJsID0gZiJ7cHJveHlfc2VydmVyfS97ZW5kcG9pbnR9IgogICAgICAgICAgICAKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwganNvbj1kYXRhLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiUHJveHkgQVBJIHtlbmRwb2ludH0gZmFpbGVkIHdpdGggc3RhdHVzIHtyZXNwb25zZS5zdGF0dXNfY29kZX06IHtyZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7jWkgUHJveHkgQVBJIHtlbmRwb2ludH06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGRlZiByZWdpc3Rlcl9wcm94eShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQxINuZyBrw70gduG7m2kgcHJveHkgc2VydmVyIMSR4buDIMSRxrDhu6NjIGPhuqVwIHBow6F0IHRhYmxlICh2ZXJzaW9uIMSRxqFuIGdp4bqjbikKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRxrDhu6NjIGPhuqVwIHRhYmxlLCBGYWxzZSBu4bq/dSB2w6BvIHF1ZXVlIGhv4bq3YyBs4buXaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBsb2NhbCBJUCB04burIGhlbHBlciBzZXJ2aWNlCiAgICAgICAgICAgIGxvY2FsX2lwID0gc2VsZi5oZWxwZXIuZ2V0X2xvY2FsX2lwKCkKICAgICAgICAgICAgaWYgbm90IGxvY2FsX2lwOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgbOG6pXkgbG9jYWwgSVAsIGLhu48gcXVhIMSRxINuZyBrw70gcHJveHkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBkYXRhID0geyJsb2NhbF9pcCI6IGxvY2FsX2lwfQogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuX3Byb3h5X2FwaV9jYWxsKCJyZWdpc3RlciIsIGRhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcmVzcG9uc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzdGF0dXMgPSByZXNwb25zZS5nZXQoInN0YXR1cyIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdGF0dXMgPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgIyDEkMaw4bujYyBj4bqlcCB0YWJsZSB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIHRhYmxlX25hbWUgPSByZXNwb25zZS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJ0YWJsZV9uYW1lIikKICAgICAgICAgICAgICAgIGFjdGlvbiA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoImFjdGlvbiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm94eV90YWJsZSA9IHRhYmxlX25hbWUKICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm94eV9uYW1lID0gZiJ7dGFibGVfbmFtZX0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTMawdSBwcm94eSB0YWJsZSBuYW1lIHbDoG8gZGV2aWNlIGNvbmZpZyDEkeG7gyBn4butaSBsw6puIHNlcnZlcgogICAgICAgICAgICAgICAgc2VsZi5kYi5zZXRfZGV2aWNlX2NvbmZpZygicHJveHlfdGFibGVfbmFtZSIsIHRhYmxlX25hbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiUHJveHkgxJHDoyDEkcaw4bujYyBj4bqlcCB0YWJsZToge3RhYmxlX25hbWV9IChhY3Rpb246IHthY3Rpb259KSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQuG6r3QgxJHhuqd1IHRocmVhZCB1cGRhdGUgxJHhu4tuaCBr4buzCiAgICAgICAgICAgICAgICBzZWxmLl9zdGFydF91cGRhdGVfdGhyZWFkKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmIHN0YXR1cyA9PSAicXVldWVkIjoKICAgICAgICAgICAgICAgICMgVsOgbyBxdWV1ZSBjaOG7nQogICAgICAgICAgICAgICAgcXVldWVfcG9zaXRpb24gPSByZXNwb25zZS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJxdWV1ZV9wb3NpdGlvbiIsIDApCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlByb3h5IHNlcnZlciBmdWxsLCB2w6BvIGjDoG5nIMSR4bujaSB24buLIHRyw60ge3F1ZXVlX3Bvc2l0aW9ufSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiUHJveHkgcmVnaXN0ZXIgdGjhuqV0IGLhuqFpOiB7cmVzcG9uc2UuZ2V0KCdtZXNzYWdlJywgJ1Vua25vd24gZXJyb3InKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSDEkcSDbmcga8O9IHByb3h5IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB1cGRhdGVfcHJveHkoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBD4bqtcCBuaOG6rXQgdGltZXN0YW1wIHPhu60gZOG7pW5nIHByb3h5CiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB1cGRhdGUgdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgaGVscGVyIHNlcnZpY2UKICAgICAgICAgICAgbG9jYWxfaXAgPSBzZWxmLmhlbHBlci5nZXRfbG9jYWxfaXAoKQogICAgICAgICAgICBpZiBub3QgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIGzhuqV5IGxvY2FsIElQLCBi4buPIHF1YSB1cGRhdGUgcHJveHkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBkYXRhID0geyJsb2NhbF9pcCI6IGxvY2FsX2lwfQogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuX3Byb3h5X2FwaV9jYWxsKCJ1cGRhdGUiLCBkYXRhKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzcG9uc2UgYW5kIHJlc3BvbnNlLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgc2VsZi5wcm94eV9sYXN0X3VwZGF0ZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgICAgICAjIExvZyB0aMO0bmcgdGluIHThu6sgcmVzcG9uc2UgbuG6v3UgY8OzCiAgICAgICAgICAgICAgICBkYXRhID0gcmVzcG9uc2UuZ2V0KCJkYXRhIiwge30pCiAgICAgICAgICAgICAgICB0YWJsZV9uYW1lID0gZGF0YS5nZXQoInRhYmxlX25hbWUiLCAidW5rbm93biIpCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJQcm94eSB1cGRhdGUgdGjDoG5oIGPDtG5nIGNobyB0YWJsZToge3RhYmxlX25hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlByb3h5IHVwZGF0ZSB0aOG6pXQgYuG6oWk6IHtyZXNwb25zZS5nZXQoJ21lc3NhZ2UnKSBpZiByZXNwb25zZSBlbHNlICdObyByZXNwb25zZSd9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSB1cGRhdGUgcHJveHk6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdW5yZWdpc3Rlcl9wcm94eShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEjhu6d5IMSRxINuZyBrw70gdsOgIGdp4bqjaSBwaMOzbmcgdGFibGUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHVucmVnaXN0ZXIgdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgaGVscGVyIHNlcnZpY2UKICAgICAgICAgICAgbG9jYWxfaXAgPSBzZWxmLmhlbHBlci5nZXRfbG9jYWxfaXAoKQogICAgICAgICAgICBpZiBub3QgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIGzhuqV5IGxvY2FsIElQLCBi4buPIHF1YSB1bnJlZ2lzdGVyIHByb3h5IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgZGF0YSA9IHsibG9jYWxfaXAiOiBsb2NhbF9pcH0KICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9wcm94eV9hcGlfY2FsbCgidW5yZWdpc3RlciIsIGRhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICByZWxlYXNlZF90YWJsZSA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoInJlbGVhc2VkX3RhYmxlIikKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyB1bnJlZ2lzdGVyIHByb3h5IHbDoCBnaeG6o2kgcGjDs25nIHRhYmxlOiB7cmVsZWFzZWRfdGFibGV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBE4burbmcgdGhyZWFkIHVwZGF0ZSDEkeG7i25oIGvhu7MKICAgICAgICAgICAgICAgIHNlbGYuX3N0b3BfdXBkYXRlX3RocmVhZCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUmVzZXQgdHLhuqFuZyB0aMOhaSBwcm94eQogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlID0gTm9uZQogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb3h5X25hbWUgPSBOb25lCiAgICAgICAgICAgICAgICBzZWxmLnByb3h5X2xhc3RfdXBkYXRlID0gMAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjDs2EgcHJveHkgdGFibGUgbmFtZSBraOG7j2kgZGV2aWNlIGNvbmZpZwogICAgICAgICAgICAgICAgc2VsZi5kYi5zZXRfZGV2aWNlX2NvbmZpZygicHJveHlfdGFibGVfbmFtZSIsIE5vbmUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlByb3h5IHVucmVnaXN0ZXIgdGjhuqV0IGLhuqFpOiB7cmVzcG9uc2UuZ2V0KCdtZXNzYWdlJykgaWYgcmVzcG9uc2UgZWxzZSAnTm8gcmVzcG9uc2UnfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgdW5yZWdpc3RlciBwcm94eToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiByZXNldF9pcChzZWxmLCB0YWJsZV9uYW1lOiBzdHIgPSBOb25lKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFJlc2V0IElQIGNobyBwcm94eSBoaeG7h24gdOG6oWkgaG/hurdjIHRhYmxlIMSRxrDhu6NjIGNo4buJIMSR4buLbmgKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YWJsZV9uYW1lOiBUw6puIHRhYmxlIGPhuqduIHJlc2V0IElQIChvcHRpb25hbCwgbuG6v3Uga2jDtG5nIGPDsyBz4bq9IGTDuW5nIHRhYmxlIGhp4buHbiB04bqhaSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSByZXNldCB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBT4butIGThu6VuZyB0YWJsZSDEkcaw4bujYyBjaOG7iSDEkeG7i25oIGhv4bq3YyB0YWJsZSBoaeG7h24gdOG6oWkKICAgICAgICAgICAgdGFyZ2V0X3RhYmxlID0gdGFibGVfbmFtZSBvciBzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRfdGFibGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyBjw7MgdGFibGUgcHJveHkgxJHhu4MgcmVzZXQgSVAiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENodXnhu4NuIHRhYmxlIG5hbWUgdGjDoG5oIHBwb2UgbmFtZQogICAgICAgICAgICBwcG9lX25hbWUgPSB0YXJnZXRfdGFibGUucmVwbGFjZSgidG9fIiwgIiIpICAjIENodXnhu4NuICJ0b19wcHBvZTIiIHRow6BuaCAicHBwb2UyIgogICAgICAgICAgICByZXNldF9kYXRhID0geyJwcG9lX25hbWUiOiBmIntwcG9lX25hbWV9In0KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJBhbmcgcmVzZXQgSVAgY2hvIHRhYmxlOiB7dGFyZ2V0X3RhYmxlfSAocHBvZToge3Bwb2VfbmFtZX0pIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc2V0X3Jlc3BvbnNlID0gc2VsZi5fcHJveHlfYXBpX2NhbGwoInJlc2V0LWlwIiwgcmVzZXRfZGF0YSkKICAgICAgICAgICAgaWYgcmVzZXRfcmVzcG9uc2UgYW5kIHJlc2V0X3Jlc3BvbnNlLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIHJlc2V0IElQIGNobyB7cHBvZV9uYW1lfSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IHJlc2V0X3Jlc3BvbnNlLmdldCgnbWVzc2FnZScpIGlmIHJlc2V0X3Jlc3BvbnNlIGVsc2UgJ05vIHJlc3BvbnNlJwogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIHJlc2V0IElQIGNobyB7cHBvZV9uYW1lfToge2Vycm9yX21zZ30iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgcmVzZXQgSVAgY2hvIHRhYmxlOiB7dGFibGVfbmFtZSBvciBzZWxmLmN1cnJlbnRfcHJveHlfdGFibGV9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBjaGVja19wcm94eV9yZXF1aXJlbWVudChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgdsOgIMSRxINuZyBrw70gcHJveHkgbuG6v3UgY+G6p24KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGPDsyBwcm94eSBob+G6t2Mga2jDtG5nIGPhuqduIHByb3h5LCBGYWxzZSBu4bq/dSBj4bqnbiBwcm94eSBuaMawbmcgY2jGsGEgxJHGsOG7o2MgY+G6pXAKICAgICAgICAiIiIKICAgICAgICAjIEtp4buDbSB0cmEgY8OzIHPhu60gZOG7pW5nIHByb3h5IGtow7RuZyB04burIHByb3h5X2NvbmZpZwogICAgICAgIHByb3h5X2NvbmZpZyA9IHNlbGYuZGIuZ2V0X3Byb3h5X2NvbmZpZyh7fSkKICAgICAgICB1c2VfcHJveHkgPSBwcm94eV9jb25maWcuZ2V0KCJ1c2VfcHJveHkiLCBGYWxzZSkKICAgICAgICAKICAgICAgICBpZiBub3QgdXNlX3Byb3h5OgogICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBLaMO0bmcgY+G6p24gcHJveHkKICAgICAgICAgICAgCiAgICAgICAgIyBO4bq/dSDEkcOjIGPDsyB0YWJsZSB0aMOsIHJldHVybiBUcnVlCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAjIENoxrBhIGPDsyB0YWJsZSwgdGjhu60gxJHEg25nIGvDvQogICAgICAgIHJldHVybiBzZWxmLnJlZ2lzdGVyX3Byb3h5KCkKICAgIAogICAgZGVmIGdldF9wcm94eV9kaXNwbGF5X25hbWUoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHTDqm4gaGnhu4NuIHRo4buLIGNobyBwcm94eSBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFTDqm4gaGnhu4NuIHRo4buLIGPhu6dhIHByb3h5CiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X25hbWU6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmN1cnJlbnRfcHJveHlfbmFtZQogICAgICAgIGVsaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICByZXR1cm4gZiJ7c2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlfSIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIlVua25vd24iCiAgICAKICAgIGRlZiBzZXR1cF9wcm94eV9mb3Jfc2Vzc2lvbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgY2hvIHBoacOqbiBsw6BtIHZp4buHYwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGhp4bq/dCBs4bqtcCB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgICMgTuG6v3UgxJHDoyBjw7MgdGFibGUgcHJveHkgdGjDrCBzZXR1cCB4b25nIHLhu5NpCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICBwcm94eV9uYW1lID0gc2VsZi5nZXRfcHJveHlfZGlzcGxheV9uYW1lKCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQcm94eSB7cHJveHlfbmFtZX0gxJHDoyBz4bq1biBzw6BuZyBjaG8gcGhpw6puIGzDoG0gdmnhu4djIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgIyBO4bq/dSBjaMawYSBjw7MgdGjDrCDEkcSDbmcga8O9CiAgICAgICAgcmV0dXJuIHNlbGYucmVnaXN0ZXJfcHJveHkoKQogICAgCiAgICBkZWYgcmVsZWFzZV9wcm94eV9hZnRlcl9zZXNzaW9uKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgR2nhuqNpIHBow7NuZyBwcm94eSBzYXUga2hpIGvhur90IHRow7pjIHBoacOqbiBsw6BtIHZp4buHYwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgZ2nhuqNpIHBow7NuZyB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICAgICAgcHJveHlfbmFtZSA9IHNlbGYuZ2V0X3Byb3h5X2Rpc3BsYXlfbmFtZSgpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGdp4bqjaSBwaMOzbmcgcHJveHkge3Byb3h5X25hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBH4buNaSBBUEkgdW5yZWdpc3RlcgogICAgICAgICAgICAgICAgaWYgc2VsZi51bnJlZ2lzdGVyX3Byb3h5KCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGdp4bqjaSBwaMOzbmcgcHJveHkge3Byb3h5X25hbWV9IHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJHaeG6o2kgcGjDs25nIHByb3h5IHtwcm94eV9uYW1lfSB0aOG6pXQgYuG6oWkiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJLaMO0bmcgY8OzIHByb3h5IMSR4buDIGdp4bqjaSBwaMOzbmciKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgZ2nhuqNpIHBow7NuZyBwcm94eSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgaXNfcHJveHlfYWN0aXZlKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIHByb3h5IMSRYW5nIGhv4bqhdCDEkeG7mW5nIGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHByb3h5IMSRYW5nIGhv4bqhdCDEkeG7mW5nLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gYm9vbChzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUpCiAgICAKICAgIGRlZiBnZXRfcHJveHlfaW5mbyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIHByb3h5IGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBUaMO0bmcgdGluIHByb3h5CiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgInByb3h5X2lkIjogc2VsZi5jdXJyZW50X3Byb3h5X2lkLAogICAgICAgICAgICAicHJveHlfbmFtZSI6IHNlbGYuY3VycmVudF9wcm94eV9uYW1lLAogICAgICAgICAgICAicHJveHlfdGFibGUiOiBzZWxmLmN1cnJlbnRfcHJveHlfdGFibGUsCiAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IHNlbGYucHJveHlfbGFzdF91cGRhdGUsCiAgICAgICAgICAgICJkaXNwbGF5X25hbWUiOiBzZWxmLmdldF9wcm94eV9kaXNwbGF5X25hbWUoKSwKICAgICAgICAgICAgImlzX2FjdGl2ZSI6IHNlbGYuaXNfcHJveHlfYWN0aXZlKCkKICAgICAgICB9CiAgICAKICAgIGRlZiBmb3JjZV9yZXNldF9jdXJyZW50X2lwKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQuG6r3QgYnXhu5ljIHJlc2V0IElQIGNobyBwcm94eSBoaeG7h24gdOG6oWkgKGPDsyB0aOG7gyBn4buNaSB0cm9uZyBxdcOhIHRyw6xuaCBsw6BtIHZp4buHYykKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHJlc2V0IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuY3VycmVudF9wcm94eV90YWJsZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgcHJveHkgxJFhbmcgaG/huqF0IMSR4buZbmcgxJHhu4MgcmVzZXQgSVAiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIkLhuq90IGJ14buZYyByZXNldCBJUCBjaG8gcHJveHkgaGnhu4duIHThuqFpIHRyb25nIHF1w6EgdHLDrG5oIGzDoG0gdmnhu4djIikKICAgICAgICByZXR1cm4gc2VsZi5yZXNldF9pcCgpCiAgICAKICAgIGRlZiBnZXRfcHJveHlfc3RhdHVzKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0cuG6oW5nIHRow6FpIHByb3h5IGhp4buHbiB04bqhaSBkxrDhu5tpIGThuqFuZyBzdHJpbmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFRy4bqhbmcgdGjDoWkgcHJveHkKICAgICAgICAiIiIKICAgICAgICBwcm94eV9jb25maWcgPSBzZWxmLmRiLmdldF9wcm94eV9jb25maWcoe30pCiAgICAgICAgaWYgbm90IHByb3h5X2NvbmZpZy5nZXQoInVzZV9wcm94eSIsIEZhbHNlKToKICAgICAgICAgICAgcmV0dXJuICJLaMO0bmcgc+G7rSBk4bulbmcgcHJveHkiCiAgICAgICAgZWxpZiBub3Qgc2VsZi5jdXJyZW50X3Byb3h5X3RhYmxlOgogICAgICAgICAgICByZXR1cm4gIkNoxrBhIGPDsyBwcm94eSIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gZiLEkGFuZyBz4butIGThu6VuZyBwcm94eToge3NlbGYuZ2V0X3Byb3h5X2Rpc3BsYXlfbmFtZSgpfSIKICAgIAogICAgZGVmIGVuc3VyZV9wcm94eV9pZl9uZWVkZWQoc2VsZiwgcmVhc29uOiBzdHIgPSAiQ+G6p24gcHJveHkgY2hvIGhv4bqhdCDEkeG7mW5nIikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28gY8OzIHByb3h5IG7hur91IGPhuqduIHRoaeG6v3QKICAgICAgICBU4buxIMSR4buZbmcga2nhu4NtIHRyYSB1c2VfcHJveHkgY29uZmlnIHbDoCDEkcSDbmcga8O9IHByb3h5IG7hur91IGNoxrBhIGPDswogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHJlYXNvbjogTMO9IGRvIGPhuqduIHByb3h5ICjEkeG7gyBsb2cpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHByb3h5IGhv4bq3YyBraMO0bmcgY+G6p24gcHJveHksIEZhbHNlIG7hur91IGPhuqduIHByb3h5IG5oxrBuZyBraMO0bmcgxJHEg25nIGvDvSDEkcaw4bujYwogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSBjw7Mgc+G7rSBk4bulbmcgcHJveHkga2jDtG5nIHThu6sgcHJveHlfY29uZmlnICAKICAgICAgICBwcm94eV9jb25maWcgPSBzZWxmLmRiLmdldF9wcm94eV9jb25maWcoe30pCiAgICAgICAgdXNlX3Byb3h5ID0gcHJveHlfY29uZmlnLmdldCgidXNlX3Byb3h5IiwgRmFsc2UpCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBraMO0bmcgc+G7rSBk4bulbmcgcHJveHksIGx1w7RuIHRy4bqjIHbhu4EgVHJ1ZQogICAgICAgIGlmIG5vdCB1c2VfcHJveHk6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiS2jDtG5nIGPhuqduIHByb3h5IHRoZW8gY29uZmlnIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgIyBO4bq/dSDEkcOjIGPDsyBwcm94eSBhY3RpdmUsIHRy4bqjIHbhu4EgVHJ1ZQogICAgICAgIGlmIHNlbGYuaXNfcHJveHlfYWN0aXZlKCk6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUHJveHkgxJHDoyBz4bq1biBzw6BuZyIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICMgQ+G6p24gcHJveHkgbmjGsG5nIGNoxrBhIGPDsywgdGjhu60gxJHEg25nIGvDvQogICAgICAgIGxvZ2dlci5pbmZvKGYie3JlYXNvbn0sIMSRxINuZyBrw70gcHJveHkuLi4iKQogICAgICAgIHJldHVybiBzZWxmLnJlZ2lzdGVyX3Byb3h5X3dpdGhfcmV0cnkoKQogICAgCiAgICBkZWYgcmVnaXN0ZXJfcHJveHlfd2l0aF9yZXRyeShzZWxmLCBtYXhfcmV0cmllczogaW50ID0gOTk5LCByZXRyeV9pbnRlcnZhbDogaW50ID0gMTApIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgxJDEg25nIGvDvSBwcm94eSB24bubaSByZXRyeSB2w6AgY+G6rXAgbmjhuq10IGRldmljZSBtZXNzYWdlIGtoaSBjaOG7nSBxdWV1ZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1heF9yZXRyaWVzOiBT4buRIGzhuqduIHRo4butIHThu5FpIMSRYQogICAgICAgICAgICByZXRyeV9pbnRlcnZhbDogVGjhu51pIGdpYW4gY2jhu50gZ2nhu69hIGPDoWMgbOG6p24gdGjhu60gKGdpw6J5KQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRxINuZyBrw70gdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfcmV0cmllcyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBoZWxwZXIgc2VydmljZQogICAgICAgICAgICAgICAgbG9jYWxfaXAgPSBzZWxmLmhlbHBlci5nZXRfbG9jYWxfaXAoKQogICAgICAgICAgICAgICAgaWYgbm90IGxvY2FsX2lwOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGzhuqV5IGxvY2FsIElQLCBi4buPIHF1YSDEkcSDbmcga8O9IHByb3h5IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZGF0YSA9IHsibG9jYWxfaXAiOiBsb2NhbF9pcH0KICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5fcHJveHlfYXBpX2NhbGwoInJlZ2lzdGVyIiwgZGF0YSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHJlc3BvbnNlOgogICAgICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCBtYXhfcmV0cmllcyAtIDE6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiUHJveHkgQVBJIGzhu5dpLCB0aOG7rSBs4bqhaSBzYXUge3JldHJ5X2ludGVydmFsfXMgKGzhuqduIHthdHRlbXB0ICsgMX0ve21heF9yZXRyaWVzfSkiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCBmIsSQYW5nIGNo4budIHByb3h5IC0gTOG7l2kgQVBJICh0aOG7rSBs4bqhaSB7YXR0ZW1wdCArIDF9L3ttYXhfcmV0cmllc30pIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcChyZXRyeV9pbnRlcnZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHN0YXR1cyA9IHJlc3BvbnNlLmdldCgic3RhdHVzIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgc3RhdHVzID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgICAgICAjIMSQxrDhu6NjIGPhuqVwIHRhYmxlIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIHRhYmxlX25hbWUgPSByZXNwb25zZS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJ0YWJsZV9uYW1lIikKICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSByZXNwb25zZS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJhY3Rpb24iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm94eV90YWJsZSA9IHRhYmxlX25hbWUKICAgICAgICAgICAgICAgICAgICBzZWxmLmN1cnJlbnRfcHJveHlfbmFtZSA9IGYie3RhYmxlX25hbWV9IgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTMawdSBwcm94eSB0YWJsZSBuYW1lIHbDoG8gZGV2aWNlIGNvbmZpZyDEkeG7gyBn4butaSBsw6puIHNlcnZlcgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0X2RldmljZV9jb25maWcoInByb3h5X3RhYmxlX25hbWUiLCB0YWJsZV9uYW1lKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiUHJveHkgxJHDoyDEkcaw4bujYyBj4bqlcCB0YWJsZToge3RhYmxlX25hbWV9IChhY3Rpb246IHthY3Rpb259KSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBC4bqvdCDEkeG6p3UgdGhyZWFkIHVwZGF0ZSDEkeG7i25oIGvhu7MKICAgICAgICAgICAgICAgICAgICBzZWxmLl9zdGFydF91cGRhdGVfdGhyZWFkKCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxpZiBzdGF0dXMgPT0gInF1ZXVlZCI6CiAgICAgICAgICAgICAgICAgICAgIyBWw6BvIHF1ZXVlIGNo4budCiAgICAgICAgICAgICAgICAgICAgcXVldWVfcG9zaXRpb24gPSByZXNwb25zZS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJxdWV1ZV9wb3NpdGlvbiIsIDApCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQcm94eSBzZXJ2ZXIgZnVsbCwgdsOgbyBow6BuZyDEkeG7o2kgduG7iyB0csOtIHtxdWV1ZV9wb3NpdGlvbn0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGRldmljZSBtZXNzYWdlIHbhu5tpIHRow7RuZyB0aW4gcXVldWUKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCBmIsSQYW5nIGNo4budIHByb3h5IC0gSMOgbmcgxJHhu6NpOiB7cXVldWVfcG9zaXRpb259IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X3JldHJpZXMgLSAxOgogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHJldHJ5X2ludGVydmFsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYixJDDoyB0aOG7rSB7bWF4X3JldHJpZXN9IGzhuqduIG5oxrBuZyB24bqrbiB0cm9uZyBxdWV1ZSwgZOG7q25nIHRo4butIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJQcm94eSByZWdpc3RlciB0aOG6pXQgYuG6oWk6IHtyZXNwb25zZS5nZXQoJ21lc3NhZ2UnLCAnVW5rbm93biBlcnJvcicpfSIpCiAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9yZXRyaWVzIC0gMToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9tZXNzYWdlIiwgZiLEkGFuZyBjaOG7nSBwcm94eSAtIEzhu5dpIMSRxINuZyBrw70gKHRo4butIGzhuqFpIHthdHRlbXB0ICsgMX0ve21heF9yZXRyaWVzfSkiKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHJldHJ5X2ludGVydmFsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIMSRxINuZyBrw70gcHJveHkgbOG6p24ge2F0dGVtcHQgKyAxfSIpCiAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X3JldHJpZXMgLSAxOgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsIGYixJBhbmcgY2jhu50gcHJveHkgLSBM4buXaSBr4bq/dCBu4buRaSAodGjhu60gbOG6oWkge2F0dGVtcHQgKyAxfS97bWF4X3JldHJpZXN9KSIpCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcChyZXRyeV9pbnRlcnZhbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBzaHV0ZG93bihzZWxmKToKICAgICAgICAiIiIKICAgICAgICBDbGVhbnVwIGtoaSB04bqvdCBzZXJ2aWNlIC0gZOG7q25nIHRocmVhZCB1cGRhdGUgdsOgIHVucmVnaXN0ZXIgcHJveHkKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygiU2h1dHRpbmcgZG93biBQcm94eVNlcnZpY2UuLi4iKQogICAgICAgIAogICAgICAgICMgROG7q25nIHRocmVhZCB1cGRhdGUgdHLGsOG7m2MKICAgICAgICBzZWxmLl9zdG9wX3VwZGF0ZV90aHJlYWQoKQogICAgICAgIAogICAgICAgICMgVW5yZWdpc3RlciBwcm94eSBu4bq/dSDEkWFuZyBhY3RpdmUKICAgICAgICBpZiBzZWxmLmlzX3Byb3h5X2FjdGl2ZSgpOgogICAgICAgICAgICBsb2dnZXIuaW5mbygiVW5yZWdpc3RlciBwcm94eSB0cm9uZyBxdcOhIHRyw6xuaCBzaHV0ZG93biIpCiAgICAgICAgICAgIHNlbGYudW5yZWdpc3Rlcl9wcm94eSgpCiAgICAgICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKCJQcm94eVNlcnZpY2UgxJHDoyBzaHV0ZG93biBob8OgbiB04bqldCIpCg==').decode('utf-8'))
