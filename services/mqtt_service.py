import base64
exec(base64.b64decode('aW1wb3J0IHBhaG8ubXF0dC5jbGllbnQgYXMgbXF0dAppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCB1dWlkCmltcG9ydCBvcwpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBMaXN0LCBPcHRpb25hbCwgQ2FsbGFibGUsIFVuaW9uCmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCmltcG9ydCBzb2NrZXQKCiMgTG9nZ2VyCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIk1RVFRTZXJ2aWNlIikKCmNsYXNzIE1RVFRTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGRldmljZV9pZCwgaGVscGVyX3NlcnZpY2U9Tm9uZSk6CiAgICAgICAgIyBLaOG7n2kgdOG6oW8gY8OhYyBzZXJ2aWNlCiAgICAgICAgc2VsZi5kYiA9IGRiX3NlcnZpY2UKICAgICAgICBzZWxmLmhlbHBlcl9zZXJ2aWNlID0gaGVscGVyX3NlcnZpY2UKICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIE1RVFQKICAgICAgICBzZWxmLmNsaWVudF9pZCA9IGYie2NvbmZpZy5NUVRUX0NMSUVOVF9JRF9QUkVGSVh9X3tkZXZpY2VfaWR9IgogICAgICAgIHNlbGYuYnJva2VyX3VybCA9IGNvbmZpZy5NUVRUX1NFUlZFUlNbY29uZmlnLk1PREVdCiAgICAgICAgc2VsZi5icm9rZXJfYWRkcmVzcyA9IHNlbGYuYnJva2VyX3VybC5yZXBsYWNlKCJtcXR0Oi8vIiwgIiIpLnNwbGl0KCI6IilbMF0KICAgICAgICBzZWxmLmJyb2tlcl9wb3J0ID0gaW50KHNlbGYuYnJva2VyX3VybC5zcGxpdCgiOiIpWy0xXSkgaWYgIjoiIGluIHNlbGYuYnJva2VyX3VybCBlbHNlIDE4ODMKICAgICAgICBzZWxmLnVzZXJuYW1lID0gY29uZmlnLk1RVFRfVVNFUk5BTUUKICAgICAgICBzZWxmLnBhc3N3b3JkID0gY29uZmlnLk1RVFRfUEFTU1dPUkQKICAgICAgICAKICAgICAgICAjIFRy4bqhbmcgdGjDoWkga+G6v3QgbuG7kWkKICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5jbGllbnQgPSBOb25lCiAgICAgICAgc2VsZi5kZXZpY2VfaWQgPSBkZXZpY2VfaWQKICAgICAgICAKICAgICAgICAKICAgICAgICAjIFRvcGljcwogICAgICAgIHNlbGYudG9waWNfY2xpZW50X3N5bmMgPSBjb25maWcuTVFUVF9UT1BJQ19DTElFTlRfU1lOQwogICAgICAgIHNlbGYudG9waWNfc2VydmVyX3Rhc2sgPSBmIntjb25maWcuTVFUVF9UT1BJQ19TRVJWRVJfVEFTS19QUkVGSVh9L3tzZWxmLmRldmljZV9pZH0iCiAgICAgICAgCiAgICAgICAgIyBRdeG6o24gbMO9IHRhc2sgdsOgIHN5bmMKICAgICAgICBzZWxmLnRhc2tfaGFuZGxlcnMgPSB7fQogICAgICAgIHNlbGYuc3luY190aHJlYWQgPSBOb25lCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBzZWxmLnN0b3BfZXZlbnQgPSB0aHJlYWRpbmcuRXZlbnQoKQogICAgICAgIHNlbGYuc3luY19pbnRlcnZhbCA9IHNlbGYuZGIuZ2V0X2RldmljZV9jb25maWcoInN5bmNfaW50ZXJ2YWwiLCBjb25maWcuU1lOQ19JTlRFUlZBTCkKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgbcO0aSB0csaw4budbmcgVGVybXV4CiAgICAgICAgc2VsZi5pc190ZXJtdXggPSAnVEVSTVVYX1ZFUlNJT04nIGluIG9zLmVudmlyb24gb3IgJy9kYXRhL2RhdGEvY29tLnRlcm11eCcgaW4gb3MuZW52aXJvbi5nZXQoJ1BBVEgnLCAnJykKICAgICAgICBpZiBzZWxmLmlzX3Rlcm11eDoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQYW5nIGNo4bqheSB0cm9uZyBtw7RpIHRyxrDhu51uZyBUZXJtdXgiKQoKICAgIGRlZiBfY3JlYXRlX2NsaWVudChzZWxmKSAtPiBtcXR0LkNsaWVudDoKICAgICAgICAiIiJU4bqhbyB2w6AgY+G6pXUgaMOsbmggTVFUVCBjbGllbnQiIiIKICAgICAgICBjbGllbnQgPSBOb25lCgogICAgICAgICMgVGjhu60gdOG6oW8gduG7m2kgQVBJIHYyCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjbGllbnQgPSBtcXR0LkNsaWVudCgKICAgICAgICAgICAgICAgIGNsaWVudF9pZD1zZWxmLmNsaWVudF9pZCwKICAgICAgICAgICAgICAgIGNsZWFuX3Nlc3Npb249VHJ1ZSwKICAgICAgICAgICAgICAgIHByb3RvY29sPW1xdHQuTVFUVHYzMTEsCiAgICAgICAgICAgICAgICBjYWxsYmFja19hcGlfdmVyc2lvbj1nZXRhdHRyKG1xdHQuQ2FsbGJhY2tBUElWZXJzaW9uLCAnVkVSU0lPTjInLCBOb25lKQogICAgICAgICAgICApCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJU4bqhbyBNUVRUIGNsaWVudCB24bubaSBBUEkgdjIiKQogICAgICAgIGV4Y2VwdCAoQXR0cmlidXRlRXJyb3IsIFR5cGVFcnJvcik6CiAgICAgICAgICAgICMgRmFsbGJhY2sgQVBJIHYxCiAgICAgICAgICAgIGNsaWVudCA9IG1xdHQuQ2xpZW50KAogICAgICAgICAgICAgICAgY2xpZW50X2lkPXNlbGYuY2xpZW50X2lkLAogICAgICAgICAgICAgICAgY2xlYW5fc2Vzc2lvbj1UcnVlLAogICAgICAgICAgICAgICAgcHJvdG9jb2w9bXF0dC5NUVRUdjMxMQogICAgICAgICAgICApCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJU4bqhbyBNUVRUIGNsaWVudCB24bubaSBBUEkgdjEiKQogICAgICAgIAogICAgICAgICMgQ+G6pXUgaMOsbmggeMOhYyB0aOG7sWMgbuG6v3UgY8OzCiAgICAgICAgaWYgc2VsZi51c2VybmFtZSBhbmQgc2VsZi5wYXNzd29yZDoKICAgICAgICAgICAgY2xpZW50LnVzZXJuYW1lX3B3X3NldChzZWxmLnVzZXJuYW1lLCBzZWxmLnBhc3N3b3JkKQogICAgICAgIAogICAgICAgICMgxJDEg25nIGvDvSBjYWxsYmFjawogICAgICAgIGNsaWVudC5vbl9jb25uZWN0ID0gc2VsZi5fb25fY29ubmVjdAogICAgICAgIGNsaWVudC5vbl9tZXNzYWdlID0gc2VsZi5fb25fbWVzc2FnZQogICAgICAgIGNsaWVudC5vbl9kaXNjb25uZWN0ID0gc2VsZi5fb25fZGlzY29ubmVjdAogICAgICAgIAogICAgICAgIHJldHVybiBjbGllbnQKCiAgICBkZWYgY29ubmVjdChzZWxmKSAtPiBib29sOgogICAgICAgICIiIkvhur90IG7hu5FpIMSR4bq/biBNUVRUIGJyb2tlciIiIgogICAgICAgIGRlZiBjYW5fY29ubmVjdChob3N0OiBzdHIsIHBvcnQ6IGludCwgdGltZW91dDogZmxvYXQgPSAyLjApIC0+IGJvb2w6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHdpdGggc29ja2V0LmNyZWF0ZV9jb25uZWN0aW9uKChob3N0LCBwb3J0KSwgdGltZW91dD10aW1lb3V0KToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIG1haW5faG9zdCA9IHNlbGYuYnJva2VyX2FkZHJlc3MKICAgICAgICBtYWluX3BvcnQgPSBzZWxmLmJyb2tlcl9wb3J0CiAgICAgICAgZmFsbGJhY2tfaG9zdCA9ICIxMC4wLjAuNSIKICAgICAgICBmYWxsYmFja19wb3J0ID0gOTAyMAoKICAgICAgICAjIEtp4buDbSB0cmEga+G6v3QgbuG7kWkgc29ja2V0IHThu5tpIGPhuqMgMiBJUAogICAgICAgIG1haW5fb2sgPSBjYW5fY29ubmVjdChtYWluX2hvc3QsIG1haW5fcG9ydCkKICAgICAgICBmYWxsYmFja19vayA9IGNhbl9jb25uZWN0KGZhbGxiYWNrX2hvc3QsIGZhbGxiYWNrX3BvcnQpCgogICAgICAgIGlmIG1haW5fb2s6CiAgICAgICAgICAgIGNvbm5lY3RfaG9zdCA9IG1haW5faG9zdAogICAgICAgICAgICBjb25uZWN0X3BvcnQgPSBtYWluX3BvcnQKICAgICAgICBlbGlmIGZhbGxiYWNrX29rOgogICAgICAgICAgICBjb25uZWN0X2hvc3QgPSBmYWxsYmFja19ob3N0CiAgICAgICAgICAgIGNvbm5lY3RfcG9ydCA9IGZhbGxiYWNrX3BvcnQKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJLaMO0bmcga+G6v3QgbuG7kWkgxJHGsOG7o2Mgc29ja2V0IHThu5tpIGPhuqMge21haW5faG9zdH06e21haW5fcG9ydH0gbOG6q24ge2ZhbGxiYWNrX2hvc3R9OntmYWxsYmFja19wb3J0fSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVOG6oW8gY2xpZW50IG3hu5tpIG7hur91IGNoxrBhIGPDswogICAgICAgICAgICBpZiBzZWxmLmNsaWVudCBpcyBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5jbGllbnQgPSBzZWxmLl9jcmVhdGVfY2xpZW50KCkKICAgICAgICAgICAgIyBSZXNldCB0cuG6oW5nIHRow6FpCiAgICAgICAgICAgIHNlbGYuc3RvcF9ldmVudC5jbGVhcigpCiAgICAgICAgICAgIHNlbGYuaXNfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICAgICAgc2VsZi5jbGllbnQucmVjb25uZWN0X2RlbGF5X3NldChtaW5fZGVsYXk9MSwgbWF4X2RlbGF5PTYwKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGvhur90IG7hu5FpIHThu5tpIE1RVFQgYnJva2VyIHtjb25uZWN0X2hvc3R9Ontjb25uZWN0X3BvcnR9IikKICAgICAgICAgICAgc2VsZi5jbGllbnQuY29ubmVjdF9hc3luYyhjb25uZWN0X2hvc3QsIGNvbm5lY3RfcG9ydCwga2VlcGFsaXZlPTYwKQogICAgICAgICAgICBzZWxmLmNsaWVudC5sb29wX3N0YXJ0KCkKCiAgICAgICAgICAgIGRlZiBfd2FpdF9jb25uZWN0ZWQodGltZW91dF9zZWM6IGludCA9IDEwKSAtPiBib29sOgogICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UodGltZW91dF9zZWMpOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgaWYgX3dhaXRfY29ubmVjdGVkKCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6Mga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nIMSR4bq/biBNUVRUIGJyb2tlciB7Y29ubmVjdF9ob3N0fTp7Y29ubmVjdF9wb3J0fSIpCiAgICAgICAgICAgICAgICBzZWxmLmJyb2tlcl9hZGRyZXNzID0gY29ubmVjdF9ob3N0CiAgICAgICAgICAgICAgICBzZWxmLmJyb2tlcl9wb3J0ID0gY29ubmVjdF9wb3J0CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS+G6v3QgbuG7kWkgTVFUVCB0aOG6pXQgYuG6oWkgdOG7m2kge2Nvbm5lY3RfaG9zdH06e2Nvbm5lY3RfcG9ydH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkga+G6v3QgbuG7kWkgTVFUVDoge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZW5zdXJlX2Nvbm5lY3RlZChzZWxmKSAtPiBib29sOgogICAgICAgICIiIsSQ4bqjbSBi4bqjbyBr4bq/dCBu4buRaSBNUVRUIHRyxrDhu5tjIGtoaSB0aOG7sWMgaGnhu4duIGPDoWMgdGhhbyB0w6FjIiIiCiAgICAgICAgaWYgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk1RVFQgY2jGsGEga+G6v3QgbuG7kWksIMSRYW5nIHRo4butIGvhur90IG7hu5FpIGzhuqFpLi4uIikKICAgICAgICByZXR1cm4gc2VsZi5jb25uZWN0KCkKCiAgICBkZWYgX29uX2Nvbm5lY3Qoc2VsZiwgY2xpZW50LCB1c2VyZGF0YSwgZmxhZ3MsIHJjLCBwcm9wZXJ0aWVzPU5vbmUpOgogICAgICAgICIiIkNhbGxiYWNrIGtoaSBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmciIiIKICAgICAgICBpZiByYyA9PSAwOgogICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IFRydWUKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nIHThu5tpIE1RVFQgYnJva2VyIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDEg25nIGvDvSBuaOG6rW4gdGFzawogICAgICAgICAgICBzZWxmLmNsaWVudC5zdWJzY3JpYmUoc2VsZi50b3BpY19zZXJ2ZXJfdGFzaywgcW9zPTEpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDEkcSDbmcga8O9IG5o4bqtbiB0YXNrIHThuqFpOiB7c2VsZi50b3BpY19zZXJ2ZXJfdGFza30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4butaSB0aMO0bmcgYsOhbyBr4bq/dCBu4buRaQogICAgICAgICAgICBzZWxmLnNlbmRfY29ubmVjdF9ub3RpZmljYXRpb24oKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkvhur90IG7hu5FpIE1RVFQgdGjhuqV0IGLhuqFpIHbhu5tpIG3DoyBs4buXaToge3JjfSIpCgogICAgZGVmIF9vbl9kaXNjb25uZWN0KHNlbGYsIGNsaWVudCwgdXNlcmRhdGEsIHJjLCBwcm9wZXJ0aWVzPU5vbmUsIHJlYXNvbl9jb2RlPU5vbmUsICoqa3dhcmdzKToKICAgICAgICAiIiJDYWxsYmFjayBraGkgbmfhuq90IGvhur90IG7hu5FpIiIiCiAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIGlmIHJjICE9IDA6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTmfhuq90IGvhur90IG7hu5FpIE1RVFQga2jDtG5nIG1vbmcgbXXhu5FuIHbhu5tpIG3DoyBs4buXaToge3JjfSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mgbmfhuq90IGvhur90IG7hu5FpIE1RVFQiKQoKICAgIGRlZiBfc2FmZV9wdWJsaXNoKHNlbGYsIHRvcGljOiBzdHIsIHBheWxvYWQ6IHN0ciwgcW9zOiBpbnQgPSAxKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEfhu61pIG1lc3NhZ2UgYW4gdG/DoG4gduG7m2kga2nhu4NtIHRyYSBr4bq/dCBu4buRaSB0csaw4bubYyBraGkgcHVibGlzaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRvcGljOiBNUVRUIHRvcGljCiAgICAgICAgICAgIHBheWxvYWQ6IE7hu5lpIGR1bmcgbWVzc2FnZSAoc3RyaW5nKQogICAgICAgICAgICBxb3M6IFF1YWxpdHkgb2YgU2VydmljZSAoMCwgMSwgaG/hurdjIDIpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgZ+G7rWkgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9jb25uZWN0ZWQoKToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBn4butaSBtZXNzYWdlIMSR4bq/biB7dG9waWN9OiBNUVRUIGNoxrBhIGvhur90IG7hu5FpIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi5jbGllbnQucHVibGlzaCh0b3BpYywgcGF5bG9hZCwgcW9zPXFvcykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5yYyA9PSBtcXR0Lk1RVFRfRVJSX1NVQ0NFU1M6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgZ+G7rWkgbWVzc2FnZSB0aMOgbmggY8O0bmcgxJHhur9uIHt0b3BpY30iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4butaSBtZXNzYWdlIMSR4bq/biB7dG9waWN9OiB7bXF0dC5lcnJvcl9zdHJpbmcocmVzdWx0LnJjKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIG1lc3NhZ2UgxJHhur9uIHt0b3BpY306IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIHNlbmRfdGFza19yZXBvcnQoc2VsZiwgdGFza19pZDogc3RyLCBkZXZpY2VfaWQ6IHN0ciwgc3RhdHVzOiBzdHIsIGNsaWVudF9tZXNzYWdlOiBzdHIgPSAiIik6CiAgICAgICAgIiIiR+G7rWkgYsOhbyBjw6FvIGvhur90IHF14bqjIHRo4buxYyBoaeG7h24gdGFzayIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVwb3J0X2RhdGEgPSB7CiAgICAgICAgICAgICAgICAidGFza19pZCI6IHRhc2tfaWQsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgInN0YXR1cyI6IHN0YXR1cywKICAgICAgICAgICAgICAgICJjbGllbnRfbWVzc2FnZSI6IGNsaWVudF9tZXNzYWdlLAogICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgc2VsZi5fc2FmZV9wdWJsaXNoKCJkbmR2aW5hL2NsaWVudC90YXNrX3JlcG9ydCIsIGpzb24uZHVtcHMocmVwb3J0X2RhdGEpKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBn4butaSBiw6FvIGPDoW8gdGFzayB7dGFza19pZH0gduG7m2kgdHLhuqFuZyB0aMOhaSB7c3RhdHVzfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7rWkgYsOhbyBjw6FvIHRhc2s6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIHNlbmRfY29ubmVjdF9ub3RpZmljYXRpb24oc2VsZik6CiAgICAgICAgIiIiR+G7rWkgdGjDtG5nIGLDoW8ga+G6v3QgbuG7kWkgxJHhur9uIHNlcnZlciIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgY29ubmVjdF9kYXRhID0gewogICAgICAgICAgICAgICAgImRldmljZV9pZCI6IHNlbGYuZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgc2VsZi5fc2FmZV9wdWJsaXNoKCJkbmR2aW5hL2NsaWVudC9jb25uZWN0IiwganNvbi5kdW1wcyhjb25uZWN0X2RhdGEpKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBn4butaSB0aMO0bmcgYsOhbyBr4bq/dCBu4buRaSBjaG8gdGhp4bq/dCBi4buLIHtzZWxmLmRldmljZV9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiByZWdpc3Rlcl90YXNrX2hhbmRsZXIoc2VsZiwgdGFza190eXBlOiBzdHIsIGhhbmRsZXI6IENhbGxhYmxlKToKICAgICAgICAiIiIKICAgICAgICDEkMSDbmcga8O9IGhhbmRsZXIgY2hvIGxv4bqhaSB0YXNrCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza190eXBlOiBMb+G6oWkgdGFzawogICAgICAgICAgICBoYW5kbGVyOiBIw6BtIHjhu60gbMO9IHRhc2sKICAgICAgICAiIiIKICAgICAgICBzZWxmLnRhc2tfaGFuZGxlcnNbdGFza190eXBlXSA9IGhhbmRsZXIKICAgIAogICAgZGVmIHN5bmNfZGF0YShzZWxmKToKICAgICAgICAiIiLEkOG7k25nIGLhu5kgZOG7ryBsaeG7h3UgduG7m2kgc2VydmVyIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIE7hur91IGNoxrBhIGvhur90IG7hu5FpIE1RVFQsIGtow7RuZyB0aOG7gyDEkeG7k25nIGLhu5kKICAgICAgICAgICAgaWYgbm90IHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkNoxrBhIGvhur90IG7hu5FpIE1RVFQsIGtow7RuZyB0aOG7gyDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBoZWxwZXIgc2VydmljZQogICAgICAgICAgICBoZWxwZXIgPSBzZWxmLmhlbHBlcl9zZXJ2aWNlCiAgICAgICAgICAgIGlmIG5vdCBoZWxwZXI6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyBjw7MgaGVscGVyIHNlcnZpY2UsIGtow7RuZyB0aOG7gyDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBkZXZpY2VfaWQKICAgICAgICAgICAgZGV2aWNlX2lkID0gc2VsZi5kYi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgICAgIGlmIG5vdCBkZXZpY2VfaWQ6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB4w6FjIMSR4buLbmggZGV2aWNlX2lkLCBraMO0bmcgdGjhu4MgxJHhu5NuZyBi4buZIGThu68gbGnhu4d1IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdGjDtG5nIHRpbiB0aGnhur90IGLhu4sKICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBOb25lCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRldmljZV9pbmZvX3Jlc3BvbnNlID0gaGVscGVyLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgbOG6pXkgdGjDoG5oIGPDtG5nLCBsxrB1IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgICAgIGlmIGRldmljZV9pbmZvX3Jlc3BvbnNlWyJzdGF0dXMiXSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiBkZXZpY2VfaW5mb19yZXNwb25zZToKICAgICAgICAgICAgICAgICAgICAjIEzGsHUgdGjDtG5nIHRpbiB0aGnhur90IGLhu4sgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2F2ZV9kZXZpY2VfaW5mbyhkZXZpY2VfaW5mb19yZXNwb25zZVsiZGF0YSJdKQogICAgICAgICAgICAgICAgICAgIGRldmljZV9pbmZvID0gZGV2aWNlX2luZm9fcmVzcG9uc2VbImRhdGEiXQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbOG6pXkgdGjDtG5nIHRpbiB0aGnhur90IGLhu4s6IHtlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgbOG6pXkgxJHGsOG7o2MgdGjDtG5nIHRpbiB0aGnhur90IGLhu4ssIHPhu60gZOG7pW5nIHRow7RuZyB0aW4gxJHDoyBsxrB1IHRyb25nIGRhdGFiYXNlCiAgICAgICAgICAgIGlmIG5vdCBkZXZpY2VfaW5mbzoKICAgICAgICAgICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5kYi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBkZXZpY2VfaW5mbzoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJLaMO0bmcgY8OzIHRow7RuZyB0aW4gdGhp4bq/dCBi4buLLCDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UgY8OzIHRo4buDIGtow7RuZyDEkeG6p3kgxJHhu6ciKQogICAgICAgICAgICAgICAgZGV2aWNlX2luZm8gPSB7fQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGRldmljZV9jb25maWcgPSBzZWxmLmRiLmdldF9hbGxfZGV2aWNlX2NvbmZpZygpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu5lwIGPDoWMgdHLhuqFuZyB0aMOhaSBydW50aW1lIChwYXVzZV9qb2IsIGRldmljZV9pc193b3JraW5nLCBkZXZpY2VfbWVzc2FnZSkgdsOgbyBkZXZpY2VfaW5mbwogICAgICAgICAgICBmb3IgcnVudGltZV9rZXkgaW4gWyJwYXVzZV9qb2IiLCAiZGV2aWNlX2lzX3dvcmtpbmciLCAiZGV2aWNlX21lc3NhZ2UiXToKICAgICAgICAgICAgICAgIGlmIHJ1bnRpbWVfa2V5IGluIGRldmljZV9jb25maWc6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2luZm9bcnVudGltZV9rZXldID0gZGV2aWNlX2NvbmZpZy5wb3AocnVudGltZV9rZXkpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgR2nDoSB0cuG7iyBt4bq3YyDEkeG7i25oIG7hur91IGNoxrBhIGPhuqV1IGjDrG5oCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2luZm9bcnVudGltZV9rZXldID0gRmFsc2UgaWYgcnVudGltZV9rZXkgIT0gImRldmljZV9tZXNzYWdlIiBlbHNlICIiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIGdvbGlrZV9yZXBvcnQga2jhu49pIGRldmljZV9jb25maWcgxJHhu4MgZ+G7rWkgcmnDqm5nCiAgICAgICAgICAgIGdvbGlrZV9yZXBvcnQgPSBOb25lCiAgICAgICAgICAgIGlmICJnb2xpa2VfcmVwb3J0IiBpbiBkZXZpY2VfY29uZmlnOgogICAgICAgICAgICAgICAgZ29saWtlX3JlcG9ydCA9IGRldmljZV9jb25maWcucG9wKCJnb2xpa2VfcmVwb3J0IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTG/huqFpIGLhu48gZ29saWtlX2FwaV9iYXNlIGto4buPaSBkZXZpY2VfY29uZmlnCiAgICAgICAgICAgIGlmICJnb2xpa2VfYXBpX2Jhc2UiIGluIGRldmljZV9jb25maWc6CiAgICAgICAgICAgICAgICBkZXZpY2VfY29uZmlnLnBvcCgiZ29saWtlX2FwaV9iYXNlIikKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygixJDDoyBsb+G6oWkgYuG7jyBnb2xpa2VfYXBpX2Jhc2Uga2jhu49pIGThu68gbGnhu4d1IMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBjw6FjIHTDoGkga2hv4bqjbiBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgcGVuZGluZ19hY2NvdW50cyA9IHNlbGYuZGIuZ2V0X3BlbmRpbmdfc3luY19pdGVtcygiYWNjb3VudHMiLCBsaW1pdD01MCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgY8OhYyBqb2IgY2jGsGEgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIHBlbmRpbmdfam9icyA9IHNlbGYuZGIuZ2V0X3BlbmRpbmdfc3luY19pdGVtcygiam9ic19oaXN0b3J5IiwgbGltaXQ9NTApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBwYXlsb2FkCiAgICAgICAgICAgIHBheWxvYWQgPSB7CiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgImRldmljZV9pbmZvIjogZGV2aWNlX2luZm8sCiAgICAgICAgICAgICAgICAiZGV2aWNlX2NvbmZpZyI6IGRldmljZV9jb25maWcsCiAgICAgICAgICAgICAgICAidGltZXN0YW1wIjogaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGdvbGlrZV9yZXBvcnQgbuG6v3UgY8OzCiAgICAgICAgICAgIGlmIGdvbGlrZV9yZXBvcnQ6CiAgICAgICAgICAgICAgICBwYXlsb2FkWyJnb2xpa2VfcmVwb3J0Il0gPSBnb2xpa2VfcmVwb3J0CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSB0w6BpIGtob+G6o24gY2jGsGEgxJHhu5NuZyBi4buZIG7hur91IGPDswogICAgICAgICAgICBpZiBwZW5kaW5nX2FjY291bnRzOgogICAgICAgICAgICAgICAgcGF5bG9hZFsiYWNjb3VudHMiXSA9IHBlbmRpbmdfYWNjb3VudHMKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDhu5NuZyBi4buZIHtsZW4ocGVuZGluZ19hY2NvdW50cyl9IHTDoGkga2hv4bqjbiBjaMawYSDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gam9iIGNoxrBhIMSR4buTbmcgYuG7mSBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgcGVuZGluZ19qb2JzOgogICAgICAgICAgICAgICAgcGF5bG9hZFsiam9icyJdID0gcGVuZGluZ19qb2JzCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQ4buTbmcgYuG7mSB7bGVuKHBlbmRpbmdfam9icyl9IGpvYiBjaMawYSDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7rWkgZOG7ryBsaeG7h3UKICAgICAgICAgICAgc2VsZi5fc2FmZV9wdWJsaXNoKGNvbmZpZy5NUVRUX1RPUElDX0NMSUVOVF9TWU5DLCBqc29uLmR1bXBzKHBheWxvYWQpKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UgduG7m2kgc2VydmVyIikKICAgIAogICAgZGVmIHN0YXJ0X3N5bmNfdGhyZWFkKHNlbGYpOgogICAgICAgICIiIkLhuq90IMSR4bqndSB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIiIgogICAgICAgIGlmIHNlbGYuc3luY190aHJlYWQgaXMgbm90IE5vbmUgYW5kIHNlbGYuc3luY190aHJlYWQuaXNfYWxpdmUoKToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIlRocmVhZCDEkeG7k25nIGLhu5kgxJHDoyDEkWFuZyBjaOG6oXkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgc2VsZi5ydW5uaW5nID0gVHJ1ZQogICAgICAgIHNlbGYuc3RvcF9ldmVudC5jbGVhcigpCiAgICAgICAgc2VsZi5zeW5jX3RocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PXNlbGYuX3N5bmNfbG9vcCwgZGFlbW9uPVRydWUpCiAgICAgICAgc2VsZi5zeW5jX3RocmVhZC5zdGFydCgpCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga2jhu59pIMSR4buZbmcgdGhyZWFkIMSR4buTbmcgYuG7mSB04buxIMSR4buZbmciKQogICAgCiAgICBkZWYgX3N5bmNfbG9vcChzZWxmKToKICAgICAgICAiIiJMb29wIMSR4buTbmcgYuG7mSB04buxIMSR4buZbmciIiIKICAgICAgICBsb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIG3hu5dpIHtzZWxmLnN5bmNfaW50ZXJ2YWx9IGdpw6J5IikKCiAgICAgICAgd2hpbGUgbm90IHNlbGYuc3RvcF9ldmVudC5pc19zZXQoKSBhbmQgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnN5bmNfZGF0YSgpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHRyb25nIHF1w6EgdHLDrG5oIMSR4buTbmcgYuG7mSB04buxIMSR4buZbmc6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE5naOG7iSDEkeG6v24gbOG6p24gxJHhu5NuZyBi4buZIHRp4bq/cCB0aGVvCiAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKHNlbGYuc3luY19pbnRlcnZhbCk6CiAgICAgICAgICAgICAgICBpZiBzZWxmLnN0b3BfZXZlbnQuaXNfc2V0KCkgb3Igbm90IHNlbGYucnVubmluZzoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgCiAgICBkZWYgc3RvcF9zeW5jX3RocmVhZChzZWxmKToKICAgICAgICAiIiJE4burbmcgdGhyZWFkIMSR4buTbmcgYuG7mSB04buxIMSR4buZbmciIiIKICAgICAgICBzZWxmLnJ1bm5pbmcgPSBGYWxzZQogICAgICAgIHNlbGYuc3RvcF9ldmVudC5zZXQoKQogICAgICAgIGlmIHNlbGYuc3luY190aHJlYWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuc3luY190aHJlYWQuam9pbih0aW1lb3V0PTIuMCkKICAgICAgICAgICAgc2VsZi5zeW5jX3RocmVhZCA9IE5vbmUKICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBk4burbmcgdGhyZWFkIMSR4buTbmcgYuG7mSB04buxIMSR4buZbmciKQogICAgCiAgICBkZWYgZGlzY29ubmVjdChzZWxmKToKICAgICAgICAiIiJOZ+G6r3Qga+G6v3QgbuG7kWkgTVFUVCIiIgogICAgICAgIHNlbGYuc3RvcF9zeW5jX3RocmVhZCgpCiAgICAgICAgCiAgICAgICAgaWYgc2VsZi5jbGllbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuY2xpZW50Lmxvb3Bfc3RvcCgpCiAgICAgICAgICAgIHNlbGYuY2xpZW50LmRpc2Nvbm5lY3QoKQogICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIG5n4bqvdCBr4bq/dCBu4buRaSBNUVRUIikKICAgIAogICAgZGVmIHNldHVwX21xdHRfaGFuZGxlcnMoc2VsZik6CiAgICAgICAgIiIiVGhp4bq/dCBs4bqtcCBjw6FjIGhhbmRsZXIgY2hvIE1RVFQgdGFza3MiIiIKICAgICAgICAjIMSQxINuZyBrw70gY8OhYyB0YXNrIGhhbmRsZXIgbeG6t2MgxJHhu4tuaAogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJ1cGRhdGVfY29uZmlnIiwgc2VsZi5faGFuZGxlX3VwZGF0ZV9kZXZpY2VfY29uZmlnKQogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJ1cGRhdGVfc3luY2VkIiwgc2VsZi5faGFuZGxlX3VwZGF0ZV9zeW5jZWQpCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoImFjY291bnRfdXBkYXRlIiwgc2VsZi5faGFuZGxlX2FjY291bnRfdXBkYXRlKQogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIHRoaeG6v3QgbOG6rXAgY8OhYyBNUVRUIHRhc2sgaGFuZGxlciIpCiAgICAgICAgCiAgICBkZWYgX2hhbmRsZV91cGRhdGVfZGV2aWNlX2NvbmZpZyhzZWxmLCB0YXNrX2RhdGEpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfZGF0YTogROG7ryBsaeG7h3UgdGFzayB04burIHNlcnZlcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gecOqdSBj4bqndSBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLIHThu6sgc2VydmVyICh0YXNrX2lkOiB7dGFza19pZH0pIikKICAgICAgICAgICAgY29uZmlnX2RhdGEgPSB0YXNrX2RhdGEuZ2V0KCJjb25maWdfZGF0YSIsIHt9KQogICAgICAgICAgICBpZiBub3QgY29uZmlnX2RhdGE6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiROG7ryBsaeG7h3UgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLIHLhu5duZyIpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgIkThu68gbGnhu4d1IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyBy4buXbmciKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgdOG7q25nIGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5kYi5zYXZlX2RldmljZV9jb25maWcoY29uZmlnX2RhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4s6IHsnLCAnLmpvaW4oY29uZmlnX2RhdGEua2V5cygpKX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBzeW5jX2ludGVydmFsIG7hur91IG7DsyB0aGF5IMSR4buVaQogICAgICAgICAgICAgICAgaWYgInN5bmNfaW50ZXJ2YWwiIGluIGNvbmZpZ19kYXRhOgogICAgICAgICAgICAgICAgICAgIG5ld19zeW5jX2ludGVydmFsID0gY29uZmlnX2RhdGFbInN5bmNfaW50ZXJ2YWwiXQogICAgICAgICAgICAgICAgICAgIGlmIG5ld19zeW5jX2ludGVydmFsICE9IHNlbGYuc3luY19pbnRlcnZhbDoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJD4bqtcCBuaOG6rXQgc3luY19pbnRlcnZhbCB04burIHtzZWxmLnN5bmNfaW50ZXJ2YWx9IHRow6BuaCB7bmV3X3N5bmNfaW50ZXJ2YWx9IikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zeW5jX2ludGVydmFsID0gbmV3X3N5bmNfaW50ZXJ2YWwKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgbOG6oWkgdGhyZWFkIMSR4buTbmcgYuG7mSBu4bq/dSDEkWFuZyBjaOG6oXkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5zeW5jX3RocmVhZCBpcyBub3QgTm9uZSBhbmQgc2VsZi5zeW5jX3RocmVhZC5pc19hbGl2ZSgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkto4bufaSDEkeG7mW5nIGzhuqFpIHRocmVhZCDEkeG7k25nIGLhu5kgduG7m2kga2hv4bqjbmcgdGjhu51pIGdpYW4gbeG7m2kiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zdG9wX3N5bmNfdGhyZWFkKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3RhcnRfc3luY190aHJlYWQoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFRow7RuZyBiw6FvIGNobyBKb2JTZXJ2aWNlIG7hur91IGPDsyB0aGF5IMSR4buVaSBsacOqbiBxdWFuIMSR4bq/biBqb2JzCiAgICAgICAgICAgICAgICBqb2JfcmVsYXRlZF9rZXlzID0gWyJtYXhfam9ic19wZXJfZGF5IiwgIm1heF9qb2JzX3Blcl9zZXNzaW9uIiwgImpvYl9pbnRlcnZhbF9zZWNvbmRzIiwiY2FyZV9pbl93b3JraW5nX2pvYiJdCiAgICAgICAgICAgICAgICBpZiBhbnkoa2V5IGluIGNvbmZpZ19kYXRhIGZvciBrZXkgaW4gam9iX3JlbGF0ZWRfa2V5cyk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsOBcCBk4bulbmcgY+G6pXUgaMOsbmggbeG7m2kgY2hvIEpvYlNlcnZpY2UiKQogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIGPhuqduIGto4bufaSDEkeG7mW5nIGzhuqFpLCBKb2JTZXJ2aWNlIHPhur0gbOG6pXkgY+G6pXUgaMOsbmggbeG7m2kga2hpIGPhuqduCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgR+G7rWkgYsOhbyBjw6FvIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBmIsSQw6MgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7izogeycsICcuam9pbihjb25maWdfZGF0YS5rZXlzKCkpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9ICJLaMO0bmcgdGjhu4MgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kgeOG7rSBsw70gY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7izoge3N0cihlKX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKCiAgICBkZWYgX2hhbmRsZV91cGRhdGVfc3luY2VkKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX2RhdGE6IEThu68gbGnhu4d1IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJOaOG6rW4gecOqdSBj4bqndSBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kgdOG7qyBzZXJ2ZXIiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIMSRw6MgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIGlmICJhY2NvdW50cyIgaW4gZGF0YSBhbmQgaXNpbnN0YW5jZShkYXRhWyJhY2NvdW50cyJdLCBsaXN0KToKICAgICAgICAgICAgICAgIGZvciBhY2NvdW50X3V1aWQgaW4gZGF0YVsiYWNjb3VudHMiXToKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLm1hcmtfYXNfc3luY2VkKCJhY2NvdW50cyIsIGFjY291bnRfdXVpZCkKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIMSRw6MgxJHhu5NuZyBi4buZOiB7YWNjb3VudF91dWlkfSIpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHtsZW4oZGF0YVsnYWNjb3VudHMnXSl9IHTDoGkga2hv4bqjbiDEkcOjIMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQw6FuaCBk4bqldSBqb2IgxJHDoyDEkeG7k25nIGLhu5kKICAgICAgICAgICAgaWYgImpvYnMiIGluIGRhdGEgYW5kIGlzaW5zdGFuY2UoZGF0YVsiam9icyJdLCBsaXN0KToKICAgICAgICAgICAgICAgIGZvciBqb2JfdXVpZCBpbiBkYXRhWyJqb2JzIl06CiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5tYXJrX2FzX3N5bmNlZCgiam9ic19oaXN0b3J5Iiwgam9iX3V1aWQpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYixJDDoW5oIGThuqV1IGpvYiDEkcOjIMSR4buTbmcgYuG7mToge2pvYl91dWlkfSIpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHtsZW4oZGF0YVsnam9icyddKX0gam9iIMSRw6MgxJHhu5NuZyBi4buZIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIHThu6sgc2VydmVyIG7hur91IGPDswogICAgICAgICAgICBpZiAibWVzc2FnZSIgaW4gdGFza19kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUaMO0bmcgYsOhbyB04burIHNlcnZlcjoge3Rhc2tfZGF0YVsnbWVzc2FnZSddfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHjhu60gbMO9IGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mToge3N0cihlKX0iKQogICAgICAgICAgICAKICAgIAogICAgZGVmIF9oYW5kbGVfYWNjb3VudF91cGRhdGUoc2VsZiwgdGFza19kYXRhKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIGPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfZGF0YTogROG7ryBsaeG7h3UgdGFzayB04burIHNlcnZlciBjw7MgY+G6pXUgdHLDumM6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJ0YXNrX2lkIjogInRhc2tfMTc0OTM5OTUzNjI3Ml82NDEiLAogICAgICAgICAgICAgICAgImRldmljZV9pZCI6ICJhMTI1ZjYyNGY0MWE0ZjdjIiwKICAgICAgICAgICAgICAgICJ0YXNrX3R5cGUiOiAiYWNjb3VudF91cGRhdGUiLAogICAgICAgICAgICAgICAgImRhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgImFwcCI6ICJpbnN0YWdyYW0iLAogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiaW5hY3RpdmUiLAogICAgICAgICAgICAgICAgICAgICJqb2JfbWF4X2RheSI6IDEwOCwKICAgICAgICAgICAgICAgICAgICAiam9iX3RvZGF5IjogMzAsCiAgICAgICAgICAgICAgICAgICAgImpvYl9lbmFibGUiOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICJhY2NvdW50X3V1aWQiOiAiN2VkOTU1N2QtNzZhNC00N2Y3LTg4NTAtN2NlZWYwYzY5MGFmIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJtZXNzYWdlIjogIiIsCiAgICAgICAgICAgICAgICAic3RhdHVzIjogInBlbmRpbmciCiAgICAgICAgICAgIH0KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgZGF0YSA9IHRhc2tfZGF0YS5nZXQoImRhdGEiLCB7fSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIHnDqnUgY+G6p3UgY+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiB04burIHNlcnZlciAodGFza19pZDoge3Rhc2tfaWR9KSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgZGF0YSBvciAiYWNjb3VudF91dWlkIiBub3QgaW4gZGF0YToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJE4buvIGxp4buHdSB0w6BpIGtob+G6o24ga2jDtG5nIGjhu6NwIGzhu4ciKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsICJE4buvIGxp4buHdSB0w6BpIGtob+G6o24ga2jDtG5nIGjhu6NwIGzhu4ciKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0w6BpIGtob+G6o24gdOG7qyBEQgogICAgICAgICAgICBhY2NvdW50ID0gc2VsZi5kYi5nZXRfYWNjb3VudF9ieV91dWlkKGRhdGFbImFjY291bnRfdXVpZCJdKQogICAgICAgICAgICBpZiBub3QgYWNjb3VudDoKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB24bubaSBVVUlEOiB7ZGF0YVsnYWNjb3VudF91dWlkJ119IgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0ge30KICAgICAgICAgICAgdmFsaWRfZmllbGRzID0gWyJzdGF0dXMiLCAiam9iX21heF9kYXkiLCAibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCAiam9iX2VuYWJsZSIsImpvYl9kaXNhYmxlX3VudGlsIiwibWF4X2ZvbGxvd19zZXNzaW9uIiwibWF4X2ZvbGxvd19kYXkiLCJkaXNhYmxlX2ZvbGxvdyJdCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBkYXRhLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiBrZXkgaW4gdmFsaWRfZmllbGRzOgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhW2tleV0gPSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgdXBkYXRlX2RhdGE6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIGPDsyB0aMO0bmcgdGluIGPhuqduIGPhuq1wIG5o4bqtdCIpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgIktow7RuZyBjw7MgdGjDtG5nIHRpbiBj4bqnbiBj4bqtcCBuaOG6rXQiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSBs4bqhaSB2w6BvIERCCiAgICAgICAgICAgIHVwZGF0ZV9kYXRhWyJpc19zeW5jIl0gPSBGYWxzZQogICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICcnKX0gKFVVSUQ6IHtkYXRhWydhY2NvdW50X3V1aWQnXX0pIHbhu5tpIGThu68gbGnhu4d1OiB7dXBkYXRlX2RhdGF9IikKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJzdWNjZXNzIiwgZiLEkMOjIGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnJyl9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYiS2jDtG5nIHRo4buDIGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnJyl9IgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kgeOG7rSBsw70gY+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbjoge3N0cihlKX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCgogICAgZGVmIHN0YXJ0KHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSDEkeG7mW5nIE1RVFQgc2VydmljZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Uga2jhu59pIMSR4buZbmcgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVGhp4bq/dCBs4bqtcCBjw6FjIGhhbmRsZXIgdHLGsOG7m2Mga2hpIGvhur90IG7hu5FpCiAgICAgICAgICAgIHNlbGYuc2V0dXBfbXF0dF9oYW5kbGVycygpCiAgICAgICAgICAgIHNlbGYuY29ubmVjdCgpCiAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgc3luYyB0aHJlYWQgc2F1IGtoaSBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcKICAgICAgICAgICAgc2VsZi5zdGFydF9zeW5jX3RocmVhZCgpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGto4bufaSDEkeG7mW5nIE1RVFQgc2VydmljZSB2w6AgxJHhu5NuZyBi4buZIGThu68gbGnhu4d1IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkga2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9vbl9tZXNzYWdlKHNlbGYsIGNsaWVudCwgdXNlcmRhdGEsIG1zZywgcHJvcGVydGllcz1Ob25lKToKICAgICAgICAiIiIKICAgICAgICBDYWxsYmFjayBraGkgbmjhuq1uIMSRxrDhu6NjIG1lc3NhZ2UgdOG7qyBNUVRUIGJyb2tlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGNsaWVudDogTVFUVCBjbGllbnQgaW5zdGFuY2UKICAgICAgICAgICAgdXNlcmRhdGE6IFVzZXIgZGF0YSDEkcaw4bujYyB0cnV54buBbiB2w6BvIGNsaWVudAogICAgICAgICAgICBtc2c6IE1lc3NhZ2Ugb2JqZWN0IGNo4bupYSB0b3BpYyB2w6AgcGF5bG9hZAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBQcm9wZXJ0aWVzIGPhu6dhIG1lc3NhZ2UgKE1RVFQgdjUpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5o4bqtbiBtZXNzYWdlIHThu6sgdG9waWM6IHttc2cudG9waWN9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUGFyc2UgcGF5bG9hZCBKU09OCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBheWxvYWQgPSBqc29uLmxvYWRzKG1zZy5wYXlsb2FkLmRlY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIHBhcnNlIEpTT04gdOG7qyBwYXlsb2FkOiB7bXNnLnBheWxvYWR9IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBY4butIGzDvSBtZXNzYWdlIGThu7FhIHRyw6puIHRvcGljCiAgICAgICAgICAgIGlmIG1zZy50b3BpYyA9PSBzZWxmLnRvcGljX3NlcnZlcl90YXNrOgogICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX3NlcnZlcl90YXNrKHBheWxvYWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIk5o4bqtbiBtZXNzYWdlIHThu6sgdG9waWMga2jDtG5nIHjDoWMgxJHhu4tuaDoge21zZy50b3BpY30iKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB44butIGzDvSBtZXNzYWdlOiB7c3RyKGUpfSIpCgogICAgZGVmIF9oYW5kbGVfc2VydmVyX3Rhc2soc2VsZiwgcGF5bG9hZDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwYXlsb2FkOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXNrX3R5cGUgPSBwYXlsb2FkLmdldCgidGFza190eXBlIikKICAgICAgICAgICAgaWYgbm90IHRhc2tfdHlwZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJOaOG6rW4gdGFzayBraMO0bmcgY8OzIHRhc2tfdHlwZSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIHRhc2sgdOG7qyBzZXJ2ZXI6IHt0YXNrX3R5cGV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgaGFuZGxlciB0xrDGoW5nIOG7qW5nIG7hur91IMSRw6MgxJHEg25nIGvDvQogICAgICAgICAgICBpZiB0YXNrX3R5cGUgaW4gc2VsZi50YXNrX2hhbmRsZXJzOgogICAgICAgICAgICAgICAgc2VsZi50YXNrX2hhbmRsZXJzW3Rhc2tfdHlwZV0ocGF5bG9hZCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHTDrG0gdGjhuqV5IGhhbmRsZXIgY2hvIHRhc2tfdHlwZToge3Rhc2tfdHlwZX0iKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHjhu60gbMO9IHRhc2sgdOG7qyBzZXJ2ZXI6IHtzdHIoZSl9Iik=').decode('utf-8'))
