import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHRocmVhZGluZwppbXBvcnQgZGF0ZXRpbWUKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgTGlzdCwgT3B0aW9uYWwKaW1wb3J0IGNvbmZpZwppbXBvcnQgdXRpbHMKZnJvbSB1dGlscyBpbXBvcnQgTG9nTGV2ZWwsIExvZ2dlcgpmcm9tIGpvYnMgaW1wb3J0IFRpa3Rva0pvYiwgSW5zdGFncmFtSm9iCgojIFThuqFvIGxvZ2dlciBjaG8gSm9iU2VydmljZQpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJKb2JTZXJ2aWNlIikKCmNsYXNzIEpvYlNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UsIGdvbGlrZV9zZXJ2aWNlKToKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgdOG6oW8gSm9iU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGRiX3NlcnZpY2U6IERhdGFiYXNlU2VydmljZSDEkeG7gyBsxrB1IHRy4buvIGThu68gbGnhu4d1CiAgICAgICAgICAgIGhlbHBlcl9zZXJ2aWNlOiBIZWxwZXJTZXJ2aWNlIMSR4buDIHTGsMahbmcgdMOhYyB24bubaSB0aGnhur90IGLhu4sKICAgICAgICAgICAgZ29saWtlX3NlcnZpY2U6IEdvTGlrZVNlcnZpY2UgxJHhu4MgZ+G7jWkgQVBJIEdvTGlrZQogICAgICAgICIiIgogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgc2VsZi5oZWxwZXIgPSBoZWxwZXJfc2VydmljZQogICAgICAgIHNlbGYuZ29saWtlX3NlcnZpY2UgPSBnb2xpa2Vfc2VydmljZQogICAgICAgIHNlbGYucnVubmluZyA9IFRydWUKICAgICAgICBzZWxmLmZvcmNlX3N0b3AgPSBGYWxzZQogICAgICAgIAogICAgICAgICMgS2jhu59pIHThuqFvIGPDoWMgam9iIGhhbmRsZXIKICAgICAgICBzZWxmLmpvYl9oYW5kbGVycyA9IHt9CiAgICAgICAgCiAgICAgICAgIyBGbGFnIMSRaeG7gXUga2hp4buDbgogICAgICAgIHNlbGYuaXNfaW5pdGlhbGl6ZWQgPSBGYWxzZQogICAgICAgIAogICAgICAgICMgVGjDtG5nIHRpbiB24buBIGPDoWMgYXBwIMSRxrDhu6NjIGvDrWNoIGhv4bqhdCAtIGzhuqV5IHThu6sgZGF0YWJhc2UgaG/hurdjIGNvbmZpZwogICAgICAgIHNlbGYuZW5hYmxlZF9hcHBzID0gc2VsZi5kYi5nZXQoImVuYWJsZWRfYXBwcyIsIGNvbmZpZy5FTkFCTEVEX0FQUFMpCiAgICAgICAgCiAgICAgICAgIyBMb2NrIMSR4buDIMSR4buTbmcgYuG7mSB0cuG6oW5nIHRow6FpCiAgICAgICAgc2VsZi5fbG9jayA9IHRocmVhZGluZy5Mb2NrKCkKICAgICAgICAKICAgICAgICAjIERpY3Rpb25hcnkgxJHhu4MgbMawdSBz4buRIGzhuqduIHRo4butIGpvYiB0aOG6pXQgYuG6oWkgdGhlbyBhY2NvdW50X2lkCiAgICAgICAgc2VsZi5mYWlsZWRfam9iX2F0dGVtcHRzID0ge30KICAgICAgICAKICAgICAgICAjIMSQ4bq/bSBz4buRIGzhuqduIGxpw6puIHRp4bq/cCBqb2IgZm9sbG93IHRy4bqjIHbhu4Egc3RhdHVzIDQgKHBlbmRpbmcpCiAgICAgICAgc2VsZi5mb2xsb3dfcGVuZGluZ19jb3VudHMgPSB7fQogICAgICAgIAogICAgZGVmIHNhZmVfc2xlZXAoc2VsZiwgc2Vjb25kczogZmxvYXQpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgTmfhu6cgYW4gdG/DoG4sIGPDsyB0aOG7gyBk4burbmcgbOG6oWkgbmdheSBs4bqtcCB04bupYyBraGkgZm9yY2Vfc3RvcCDEkcaw4bujYyDEkeG6t3QgdGjDoG5oIFRydWUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBzZWNvbmRzOiBT4buRIGdpw6J5IGPhuqduIG5n4bunCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Ugbmfhu6cgxJHhu6cgdGjhu51pIGdpYW4sIEZhbHNlIG7hur91IGLhu4sgZOG7q25nIGzhuqFpCiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgY2hlY2tfaW50ZXJ2YWwgPSAwLjUgICMgS2nhu4NtIHRyYSBt4buXaSAwLjUgZ2nDonkKICAgICAgICAKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCBzZWNvbmRzOgogICAgICAgICAgICAjIEtp4buDbSB0cmEgbuG6v3UgY8OzIHnDqnUgY+G6p3UgZOG7q25nCiAgICAgICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgICAgIGlmIHNlbGYuZm9yY2Vfc3RvcCBvciBub3Qgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBOZ+G7pyBt4buZdCBraG/huqNuZyBuZ+G6r24KICAgICAgICAgICAgc2xlZXBfdGltZSA9IG1pbihjaGVja19pbnRlcnZhbCwgc2Vjb25kcyAtICh0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUpKQogICAgICAgICAgICBpZiBzbGVlcF90aW1lID4gMDoKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoc2xlZXBfdGltZSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIAogICAgZGVmIGluaXRpYWxpemUoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgdOG6oW8gSm9iU2VydmljZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Uga2jhu59pIHThuqFvIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3Uga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQYW5nIGto4bufaSB04bqhbyBKb2JTZXJ2aWNlLi4uIikKICAgICAgICAKICAgICAgICAjIDEuIEtp4buDbSB0cmEgSGVscGVyU2VydmljZQogICAgICAgIGhlbHBlcl9zdWNjZXNzLCBoZWxwZXJfZGF0YSA9IHV0aWxzLmNoZWNrX2hlbHBlcl9zZXJ2aWNlKHNlbGYuaGVscGVyKQogICAgICAgIGlmIG5vdCBoZWxwZXJfc3VjY2VzczoKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4Mga+G6v3QgbuG7kWkgxJHhur9uIEhlbHBlclNlcnZpY2UuIFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpLiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAjIEzGsHUgdGjDtG5nIHRpbiB0aGnhur90IGLhu4sgbuG6v3UgY8OzCiAgICAgICAgaWYgaGVscGVyX2RhdGEgYW5kICJkYXRhIiBpbiBoZWxwZXJfZGF0YToKICAgICAgICAgICAgc2VsZi5kYi5zYXZlX2RldmljZV9pbmZvKGhlbHBlcl9kYXRhKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgbMawdSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7izoge2hlbHBlcl9kYXRhWydkYXRhJ10uZ2V0KCdkZXZpY2VfbW9kZWwnLCAnVW5rbm93bicpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAjIDMuIEzGsHUgY8OhYyBj4bqldSBow6xuaCBt4bq3YyDEkeG7i25oIHbDoG8gZGF0YWJhc2UgbuG6v3UgY2jGsGEgY8OzCiAgICAgICAgc2VsZi5fc2F2ZV9kZWZhdWx0X2NvbmZpZ3MoKQogICAgICAgICAgICAKICAgICAgICAjIDQuIEtp4buDbSB0cmEgdsOgIGzhuqV5IEdvTGlrZSBoZWFkZXJzIG7hur91IGPhuqduCiAgICAgICAgZ29saWtlX3N1Y2Nlc3MgPSBzZWxmLmdvbGlrZV9zZXJ2aWNlLmZldGNoX2dvbGlrZV9oZWFkZXJzX3dpdGhfcmV0cnkoKQogICAgICAgIGlmIG5vdCBnb2xpa2Vfc3VjY2VzczoKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgbOG6pXkgR29MaWtlIGhlYWRlcnMuIFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpLiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgICMgNS4gS2jhu59pIHThuqFvIGPDoWMgam9iIGhhbmRsZXIKICAgICAgICBzZWxmLl9pbml0X2pvYl9oYW5kbGVycygpCiAgICAgICAgCiAgICAgICAgIyA2LiBLaOG7n2kgdOG6oW8gbmfDoHkgY3Xhu5FpIGPDuW5nIMSRw6MgcmVzZXQgbuG6v3UgY2jGsGEgY8OzIHRyb25nIGRhdGFiYXNlCiAgICAgICAgbm93ID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkKICAgICAgICB0b2RheSA9IG5vdy5kYXRlKCkKICAgICAgICBqb2JfaG91ciA9IHNlbGYuZGIuZ2V0KCJqb2JfaG91ciIsIGNvbmZpZy5KT0JfSE9VUikKICAgICAgICByZXNldF90aW1lID0gZGF0ZXRpbWUuZGF0ZXRpbWUuY29tYmluZSh0b2RheSwgZGF0ZXRpbWUudGltZShob3VyPWpvYl9ob3VyLCBtaW51dGU9MCkpCiAgICAgICAgCiAgICAgICAgIyBM4bqleSBuZ8OgeSByZXNldCBjdeG7kWkgY8O5bmcgdOG7qyBkYXRhYmFzZQogICAgICAgIGxhc3RfcmVzZXRfZGF0ZV9zdHIgPSBzZWxmLmRiLmdldCgibGFzdF9yZXNldF9kYXRlIikKICAgICAgICAKICAgICAgICBpZiBub3QgbGFzdF9yZXNldF9kYXRlX3N0cjoKICAgICAgICAgICAgIyBO4bq/dSBoaeG7h24gdOG6oWkgxJHDoyBxdWEgZ2nhu50gcmVzZXQgY+G7p2EgbmfDoHkgaMO0bSBuYXksIMSRw6FuaCBk4bqldSDEkcOjIHJlc2V0CiAgICAgICAgICAgIGlmIG5vdyA+PSByZXNldF90aW1lOgogICAgICAgICAgICAgICAgbGFzdF9yZXNldF9kYXRlID0gdG9kYXkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgTuG6v3UgY2jGsGEgxJHhur9uIGdp4budIHJlc2V0LCDEkcOhbmggZOG6pXUgbMOgIMSRw6MgcmVzZXQgbmfDoHkgaMO0bSBxdWEKICAgICAgICAgICAgICAgIGxhc3RfcmVzZXRfZGF0ZSA9IHRvZGF5IC0gZGF0ZXRpbWUudGltZWRlbHRhKGRheXM9MSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICBzZWxmLmRiLnNldCgibGFzdF9yZXNldF9kYXRlIiwgbGFzdF9yZXNldF9kYXRlLmlzb2Zvcm1hdCgpKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIkto4bufaSB04bqhbyBuZ8OgeSByZXNldDoge2xhc3RfcmVzZXRfZGF0ZX0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyB0w6xtIHRo4bqleSBuZ8OgeSByZXNldCBjdeG7kWkgY8O5bmc6IHtsYXN0X3Jlc2V0X2RhdGVfc3RyfSIpCiAgICAgICAgCiAgICAgICAgc2VsZi5pc19pbml0aWFsaXplZCA9IFRydWUKICAgICAgICBsb2dnZXIuaW5mbygiS2jhu59pIHThuqFvIEpvYlNlcnZpY2UgdGjDoG5oIGPDtG5nLiIpCiAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAKICAgIGRlZiBfY2hlY2tfYWNjb3VudF9zeW5jX3N0YXR1cyhzZWxmLCBhcHBfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIGPhu6dhIG3hu5l0IGFwcAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFwcF9uYW1lOiBUw6puIOG7qW5nIGThu6VuZyBj4bqnbiBraeG7g20gdHJhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY+G6p24gxJHhu5NuZyBi4buZIGzhuqFpLCBGYWxzZSBu4bq/dSBraMO0bmcgY+G6p24KICAgICAgICAiIiIKICAgICAgICAjIEzhuqV5IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZIHThu6sgZGF0YWJhc2UKICAgICAgICBzeW5jX3N0YXR1c19rZXkgPSBmInthcHBfbmFtZX1fc3luY19zdGF0dXMiCiAgICAgICAgc3luY19zdGF0dXMgPSBzZWxmLmRiLmdldChzeW5jX3N0YXR1c19rZXksIEZhbHNlKSAgIyBN4bq3YyDEkeG7i25oIGzDoCBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAKICAgICAgICAjIE7hur91IGNoxrBhIMSR4buTbmcgYuG7mSB0aMOsIGPhuqduIMSR4buTbmcgYuG7mSBs4bqhaQogICAgICAgIHJldHVybiBub3Qgc3luY19zdGF0dXMKICAgICAgICAKICAgIGRlZiBfdXBkYXRlX2FjY291bnRfc3luY19zdGF0dXMoc2VsZiwgYXBwX25hbWU6IHN0ciwgc3RhdHVzOiBib29sID0gVHJ1ZSkgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIGPhu6dhIG3hu5l0IGFwcAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFwcF9uYW1lOiBUw6puIOG7qW5nIGThu6VuZyBj4bqnbiBj4bqtcCBuaOG6rXQKICAgICAgICAgICAgc3RhdHVzOiBUcnVlIG7hur91IMSRw6MgxJHhu5NuZyBi4buZLCBGYWxzZSBu4bq/dSBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAiIiIKICAgICAgICBzeW5jX3N0YXR1c19rZXkgPSBmInthcHBfbmFtZX1fc3luY19zdGF0dXMiCiAgICAgICAgCiAgICAgICAgIyBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kKICAgICAgICBzZWxmLmRiLnNldChzeW5jX3N0YXR1c19rZXksIHN0YXR1cykKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB7YXBwX25hbWV9OiB7c3RhdHVzfSIpCiAgICAgICAgCiAgICBkZWYgX3N5bmNfYWNjb3VudHNfZm9yX2FwcChzZWxmLCBhcHBfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQ4buTbmcgYuG7mSB0w6BpIGtob+G6o24gdsOgIG1hcCB0w6BpIGtob+G6o24gR29MaWtlIGNobyBt4buZdCBhcHAgY+G7pSB0aOG7gwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFwcF9uYW1lOiBUw6puIOG7qW5nIGThu6VuZyBj4bqnbiDEkeG7k25nIGLhu5kKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkeG7k25nIGLhu5kgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBpZiBhcHBfbmFtZSBub3QgaW4gc2VsZi5qb2JfaGFuZGxlcnM6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHTDrG0gdGjhuqV5IGpvYiBoYW5kbGVyIGNobyB7YXBwX25hbWV9LCBi4buPIHF1YSDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgaGFuZGxlciA9IHNlbGYuam9iX2hhbmRsZXJzW2FwcF9uYW1lXQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyAxLiDEkOG7k25nIGLhu5kgdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJBhbmcgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB7YXBwX25hbWV9Li4uIikKICAgICAgICAgICAgYWNjb3VudHMgPSBoYW5kbGVyLnN5bmNfYWNjb3VudHNfdG9fZGIoKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgxJHhu5NuZyBi4buZIHtsZW4oYWNjb3VudHMpfSB0w6BpIGtob+G6o24ge2FwcF9uYW1lfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIDIuIE1hcCB0w6BpIGtob+G6o24gR29MaWtlCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJBhbmcgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gR29MaWtlIGNobyB7YXBwX25hbWV9Li4uIikKICAgICAgICAgICAgZ29saWtlX2FjY291bnRzID0gaGFuZGxlci5nZXRfZ29saWtlX2FjY291bnRzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdvbGlrZV9hY2NvdW50czoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyB0w6xtIHRo4bqleSB7bGVuKGdvbGlrZV9hY2NvdW50cyl9IHTDoGkga2hv4bqjbiBHb0xpa2UgY2hvIHthcHBfbmFtZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzhuqV5IHTDoGkga2hv4bqjbiB04burIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX2FjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPWFwcF9uYW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMOBbmggeOG6oSB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIG1hcHBlZF9hY2NvdW50cyA9IGhhbmRsZXIubWFwX2dvbGlrZV9hY2NvdW50cyhnb2xpa2VfYWNjb3VudHMsIGRldmljZV9hY2NvdW50cykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMOhbmggeOG6oSB7bGVuKG1hcHBlZF9hY2NvdW50cyl9IHTDoGkga2hv4bqjbiB7YXBwX25hbWV9IHbhu5tpIEdvTGlrZSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gR29MaWtlIG7DoG8gY2hvIHthcHBfbmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgc2VsZi5fdXBkYXRlX2FjY291bnRfc3luY19zdGF0dXMoYXBwX25hbWUsIFRydWUpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIHbDoCBtYXAgR29MaWtlIGNobyB7YXBwX25hbWV9IikKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgbMOgIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICAgICBzZWxmLl91cGRhdGVfYWNjb3VudF9zeW5jX3N0YXR1cyhhcHBfbmFtZSwgRmFsc2UpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIF9zYXZlX2RlZmF1bHRfY29uZmlncyhzZWxmKToKICAgICAgICAiIiJMxrB1IGPDoWMgY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaCB2w6BvIGRhdGFiYXNlIG7hur91IGNoxrBhIGPDsyIiIgogICAgICAgIGRlZmF1bHRfY29uZmlncyA9IHsKICAgICAgICAgICAgIyBD4bqldSBow6xuaCBsacOqbiBxdWFuIMSR4bq/biB0aOG7nWkgZ2lhbiBsw6BtIGpvYgogICAgICAgICAgICAiam9iX2hvdXIiOiBjb25maWcuSk9CX0hPVVIsCiAgICAgICAgICAgICJqb2JfY29vbGRvd25fbWludXRlcyI6IGNvbmZpZy5ERUZBVUxUX0NPT0xET1dOX01JTlVURVMsCiAgICAgICAgICAgICJqb2JfY2hlY2tfaW50ZXJ2YWwiOiBjb25maWcuSk9CX0NIRUNLX0lOVEVSVkFMLAogICAgICAgICAgICAiY29vbGRvd25fZ2V0X2pvYl9nb2xpa2UiOiAzMCwgICMgVGjhu51pIGdpYW4gY2jhu50gKHBow7p0KSBraGkga2jDtG5nIHTDrG0gdGjhuqV5IGpvYiBHb0xpa2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6pXUgaMOsbmggbGnDqm4gcXVhbiDEkeG6v24gc+G7kSBsxrDhu6NuZyBqb2IKICAgICAgICAgICAgIm1heF9qb2JzX3Blcl9kYXkiOiBjb25maWcuTUFYX0pPQlNfUEVSX0RBWSwKICAgICAgICAgICAgIm1heF9qb2JzX3Blcl9zZXNzaW9uIjogY29uZmlnLk1BWF9KT0JTX1BFUl9TRVNTSU9OLAogICAgICAgICAgICAKICAgICAgICAgICAgIyBUcuG6oW5nIHRow6FpIHThuqFtIGThu6tuZyB04burIHNlcnZlcgogICAgICAgICAgICAicGF1c2Vfam9iIjogRmFsc2UsCiAgICAgICAgICAgICMgVHLhuqFuZyB0aMOhaSB0aGnhur90IGLhu4sgxJFhbmcgbMOgbSB2aeG7h2MKICAgICAgICAgICAgImRldmljZV9pc193b3JraW5nIjogRmFsc2UsCiAgICAgICAgICAgICJkZXZpY2VfbWVzc2FnZSI6ICIiLAogICAgICAgICAgICAKICAgICAgICAgICAgIyBEYW5oIHPDoWNoIGPDoWMgYXBwIMSRxrDhu6NjIGvDrWNoIGhv4bqhdAogICAgICAgICAgICAiZW5hYmxlZF9hcHBzIjogY29uZmlnLkVOQUJMRURfQVBQUywKICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciBrZXksIHZhbHVlIGluIGRlZmF1bHRfY29uZmlncy5pdGVtcygpOgogICAgICAgICAgICAjIENo4buJIGzGsHUgbuG6v3UgY2jGsGEgY8OzIHRyb25nIGRhdGFiYXNlCiAgICAgICAgICAgIGlmIHNlbGYuZGIuZ2V0KGtleSkgaXMgTm9uZToKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KGtleSwgdmFsdWUpCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkMOjIGzGsHUgY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaDoge2tleX09e3ZhbHVlfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJD4bqldSBow6xuaCB7a2V5fSDEkcOjIHThu5NuIHThuqFpOiB7c2VsZi5kYi5nZXQoa2V5KX0iKQogICAgICAgIAogICAgZGVmIF9pbml0X2pvYl9oYW5kbGVycyhzZWxmKToKICAgICAgICAiIiJLaOG7n2kgdOG6oW8gY8OhYyBqb2IgaGFuZGxlciIiIgogICAgICAgICMgaW5pdCB0aMOsIHPhur0gaW5pdCBoYW5kbGVycyBjaG8gdOG6pXQgY+G6oyBjw6FjIGFwcCwgbMOgbSBhcHAgbsOgbyB0aMOsIHPhur0gdGhlbyBj4bqldSBow6xuaCBs4bqleSB04burIGRhdGFiYXNlCiAgICAgICAgZm9yIGFwcF9uYW1lIGluIGNvbmZpZy5FTkFCTEVEX0FQUFM6CiAgICAgICAgICAgIGlmIGFwcF9uYW1lID09ICJ0aWt0b2siOgogICAgICAgICAgICAgICAgc2VsZi5qb2JfaGFuZGxlcnNbYXBwX25hbWVdID0gVGlrdG9rSm9iKHNlbGYuZGIsIHNlbGYuaGVscGVyLCBzZWxmLmdvbGlrZV9zZXJ2aWNlKQogICAgICAgICAgICAgICAgIyBUcnV54buBbiBwaMawxqFuZyB0aOG7qWMgc2FmZV9zbGVlcCB2w6BvIGpvYiBoYW5kbGVyCiAgICAgICAgICAgICAgICBzZWxmLmpvYl9oYW5kbGVyc1thcHBfbmFtZV0uc2V0X3NsZWVwX2Z1bmN0aW9uKHNlbGYuc2FmZV9zbGVlcCkKICAgICAgICAgICAgZWxpZiBhcHBfbmFtZSA9PSAiaW5zdGFncmFtIjoKICAgICAgICAgICAgICAgIHNlbGYuam9iX2hhbmRsZXJzW2FwcF9uYW1lXSA9IEluc3RhZ3JhbUpvYihzZWxmLmRiLCBzZWxmLmhlbHBlciwgc2VsZi5nb2xpa2Vfc2VydmljZSkKICAgICAgICAgICAgICAgICMgVHJ1eeG7gW4gcGjGsMahbmcgdGjhu6ljIHNhZmVfc2xlZXAgdsOgbyBqb2IgaGFuZGxlcgogICAgICAgICAgICAgICAgc2VsZi5qb2JfaGFuZGxlcnNbYXBwX25hbWVdLnNldF9zbGVlcF9mdW5jdGlvbihzZWxmLnNhZmVfc2xlZXApCiAgICAgICAgICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6Mga2jhu59pIHThuqFvIHtsZW4oc2VsZi5qb2JfaGFuZGxlcnMpfSBqb2IgaGFuZGxlcjogeycsICcuam9pbihzZWxmLmpvYl9oYW5kbGVycy5rZXlzKCkpfSIpCiAgICAgICAgCiAgICBkZWYgX3Jlc2V0X2RhaWx5X2NvdW50ZXJzKHNlbGYpOgogICAgICAgICIiIlJlc2V0IGLhu5kgxJHhur9tIGjDoG5nIG5nw6B5IHbDoG8gZ2nhu50gxJHGsOG7o2MgY+G6pXUgaMOsbmgiIiIKICAgICAgICBub3cgPSBkYXRldGltZS5kYXRldGltZS5ub3coKQogICAgICAgIHRvZGF5ID0gbm93LmRhdGUoKQogICAgICAgIAogICAgICAgICMgTOG6pXkgZ2nhu50gcmVzZXQgdOG7qyBj4bqldSBow6xuaCBob+G6t2MgdOG7qyBkYXRhYmFzZSBu4bq/dSBjw7MKICAgICAgICBqb2JfaG91ciA9IHNlbGYuZGIuZ2V0KCJqb2JfaG91ciIsIGNvbmZpZy5KT0JfSE9VUikKICAgICAgICAKICAgICAgICAjIFTDrW5oIHRo4budaSDEkWnhu4NtIHJlc2V0IGPhu6dhIG5nw6B5IGjDtG0gbmF5CiAgICAgICAgcmVzZXRfdGltZSA9IGRhdGV0aW1lLmRhdGV0aW1lLmNvbWJpbmUodG9kYXksIGRhdGV0aW1lLnRpbWUoaG91cj1qb2JfaG91ciwgbWludXRlPTApKQogICAgICAgIAogICAgICAgICMgTOG6pXkgbmfDoHkgcmVzZXQgY3Xhu5FpIGPDuW5nIHThu6sgZGF0YWJhc2UKICAgICAgICBsYXN0X3Jlc2V0X2RhdGVfc3RyID0gc2VsZi5kYi5nZXQoImxhc3RfcmVzZXRfZGF0ZSIpCiAgICAgICAgbGFzdF9yZXNldF9kYXRlID0gTm9uZQogICAgICAgIAogICAgICAgIGlmIGxhc3RfcmVzZXRfZGF0ZV9zdHI6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGxhc3RfcmVzZXRfZGF0ZSA9IGRhdGV0aW1lLmRhdGUuZnJvbWlzb2Zvcm1hdChsYXN0X3Jlc2V0X2RhdGVfc3RyKQogICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIsSQ4buLbmggZOG6oW5nIG5nw6B5IHJlc2V0IGtow7RuZyBo4bujcCBs4buHOiB7bGFzdF9yZXNldF9kYXRlX3N0cn0iKQogICAgICAgICAgICAgICAgbGFzdF9yZXNldF9kYXRlID0gTm9uZQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyBxdWEgZ2nhu50gcmVzZXQgY+G7p2EgbmfDoHkgaMO0bSBuYXkgY2jGsGEgdsOgIGNoxrBhIHJlc2V0IHRyb25nIG5nw6B5IGjDtG0gbmF5CiAgICAgICAgaWYgbm93ID49IHJlc2V0X3RpbWUgYW5kIChsYXN0X3Jlc2V0X2RhdGUgaXMgTm9uZSBvciBsYXN0X3Jlc2V0X2RhdGUgPCB0b2RheSk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVGjhu7FjIGhp4buHbiByZXNldCBi4buZIMSR4bq/bSBow6BuZyBuZ8OgeSAoZ2nhu50gcmVzZXQ6IHtqb2JfaG91cn06MDApIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVzZXQgY8OhYyBi4buZIMSR4bq/bSBjaG8gdOG6pXQgY+G6oyB0w6BpIGtob+G6o24KICAgICAgICAgICAgZm9yIGFwcF9uYW1lIGluIHNlbGYuZW5hYmxlZF9hcHBzOgogICAgICAgICAgICAgICAgYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9YXBwX25hbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGFjY291bnRzOgogICAgICAgICAgICAgICAgICAgICMgUmVzZXQgc+G7kSBqb2IgaMO0bSBuYXkgdsOgIHPhu5Egam9iIHRyb25nIHBoacOqbgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgewogICAgICAgICAgICAgICAgICAgICAgICAiam9iX3RvZGF5IjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgImpvYnNfZG9uZV9pbl9zZXNzaW9uIjogMAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB0w6BpIGtob+G6o24gxJFhbmcg4bufIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUgdsOsIMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHksCiAgICAgICAgICAgICAgICAgICAgIyDEkeG6t3QgbOG6oWkgdHLhuqFuZyB0aMOhaSB0aMOgbmggYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgaWYgYWNjb3VudC5nZXQoInN0YXR1cyIpID09ICJpbmFjdGl2ZSIgYW5kIGFjY291bnQuZ2V0KCJpbmFjdGl2ZV9yZWFzb24iKSA9PSAixJDDoyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGpvYiBow6BuZyBuZ8OgeSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJhY3RpdmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9kaXNhYmxlX3VudGlsIjogMAogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgxJHhurd0IGzhuqFpIHRy4bqhbmcgdGjDoWkgYWN0aXZlIGNobyB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gc2F1IGtoaSByZXNldCIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyByZXNldCBi4buZIMSR4bq/bSBow6BuZyBuZ8OgeSBjaG8gdOG6pXQgY+G6oyB0w6BpIGtob+G6o24gdsOgbyB7bm93LnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBuZ8OgeSDEkcOjIHJlc2V0IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgc2VsZi5kYi5zZXQoImxhc3RfcmVzZXRfZGF0ZSIsIHRvZGF5Lmlzb2Zvcm1hdCgpKQogICAgICAgIAogICAgZGVmIF9jYW5fcnVuX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBjw7MgdGjhu4MgY2jhuqF5IGpvYiBjaG8gdMOgaSBraG/huqNuIGtow7RuZwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY8OzIHRo4buDIGNo4bqheSBqb2IsIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbgogICAgICAgIGFjY291bnRfc3RhdHVzID0gYWNjb3VudC5nZXQoInN0YXR1cyIsICJhY3RpdmUiKQogICAgICAgIAogICAgICAgICMgTuG6v3UgdMOgaSBraG/huqNuIGLhu4sgZGlzYWJsZWQsIGtow7RuZyBjaG8gY2jhuqF5IGpvYgogICAgICAgIGlmIGFjY291bnRfc3RhdHVzID09ICJkaXNhYmxlZCI6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAjIE7hur91IHTDoGkga2hv4bqjbiDEkWFuZyBpbmFjdGl2ZSwga2nhu4NtIHRyYSB0aOG7nWkgZ2lhbiBjb29sZG93bgogICAgICAgIGlmIGFjY291bnRfc3RhdHVzID09ICJpbmFjdGl2ZSI6CiAgICAgICAgICAgIGpvYl9kaXNhYmxlX3VudGlsID0gYWNjb3VudC5nZXQoImpvYl9kaXNhYmxlX3VudGlsIiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgxJHDoyBo4bq/dCB0aOG7nWkgZ2lhbiBjb29sZG93biwgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgduG7gSBhY3RpdmUKICAgICAgICAgICAgaWYgam9iX2Rpc2FibGVfdW50aWwgPD0gdGltZS50aW1lKCk6CiAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIHbhu4EgYWN0aXZlCiAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHsic3RhdHVzIjogImFjdGl2ZSJ9KQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gxJHDoyBo4bq/dCB0aOG7nWkgZ2lhbiBjaOG7nSwgxJHDoyBjaHV54buDbiB24buBIHRy4bqhbmcgdGjDoWkgYWN0aXZlIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgQ2jGsGEgaOG6v3QgdGjhu51pIGdpYW4gY2jhu50KICAgICAgICAgICAgICAgIGNvb2xkb3duX3JlbWFpbiA9IGludCgoam9iX2Rpc2FibGVfdW50aWwgLSB0aW1lLnRpbWUoKSkgLyA2MCkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IMSRYW5nIHRyb25nIHRo4budaSBnaWFuIGNo4budIChjw7JuIHtjb29sZG93bl9yZW1haW59IHBow7p0KSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiBjw7MgxJHGsOG7o2MgYuG6rXQgam9iIGtow7RuZwogICAgICAgIGlmIG5vdCBhY2NvdW50LmdldCgiam9iX2VuYWJsZSIsIEZhbHNlKToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIMSRw6MgxJHGsOG7o2MgbGnDqm4ga+G6v3QgduG7m2kgR29MaWtlIGNoxrBhCiAgICAgICAgaWYgbm90IGFjY291bnQuZ2V0KCJpc19nb2xpa2VfbGlua2VkIiwgRmFsc2UpOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHPhu5Egam9iIGjDtG0gbmF5IHNvIHbhu5tpIGdp4bubaSBo4bqhbiB0cm9uZyBqb2JfbWF4X2RheQogICAgICAgIGpvYl90b2RheSA9IGFjY291bnQuZ2V0KCJqb2JfdG9kYXkiLCAwKQogICAgICAgIGpvYl9tYXhfZGF5ID0gYWNjb3VudC5nZXQoImpvYl9tYXhfZGF5IiwgMCkKICAgICAgICAKICAgICAgICAjIE7hur91IGpvYl9tYXhfZGF5IGNoxrBhIMSRxrDhu6NjIHRoaeG6v3QgbOG6rXAsIHPhu60gZOG7pW5nIGdpw6EgdHLhu4sgbeG6t2MgxJHhu4tuaCB04burIGNvbmZpZwogICAgICAgIGlmIGpvYl9tYXhfZGF5IDw9IDA6CiAgICAgICAgICAgIGpvYl9tYXhfZGF5ID0gY29uZmlnLk1BWF9KT0JTX1BFUl9EQVkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGpvYl9tYXhfZGF5IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAiam9iX21heF9kYXkiOiBqb2JfbWF4X2RheQogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICBpZiBqb2JfdG9kYXkgPj0gam9iX21heF9kYXk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgdHJvbmcgbmfDoHkgKHtqb2JfdG9kYXl9L3tqb2JfbWF4X2RheX0pIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhurd0IHTDoGkga2hv4bqjbiB2w6BvIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUgY2hvIMSR4bq/biBuZ8OgeSBow7RtIHNhdQogICAgICAgICAgICBzZWxmLmRiLnNldF9hY2NvdW50X2luYWN0aXZlX3VudGlsX25leHRfcmVzZXQoYWNjb3VudFsiaWQiXSwgIsSQw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHkiKQogICAgICAgICAgICBhcHBfbmFtZSA9IGFjY291bnQuZ2V0KCJhcHAiKQogICAgICAgICAgICBpZiBhcHBfbmFtZSBhbmQgYXBwX25hbWUgaW4gY29uZmlnLkFQUF9QQUNLQUdFUzoKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcChjb25maWcuQVBQX1BBQ0tBR0VTW2FwcF9uYW1lXSkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBz4buRIGpvYiB0cm9uZyBwaGnDqm4KICAgICAgICBqb2JzX2RvbmVfaW5fc2Vzc2lvbiA9IGFjY291bnQuZ2V0KCJqb2JzX2RvbmVfaW5fc2Vzc2lvbiIsIDApCiAgICAgICAgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPSBhY2NvdW50LmdldCgibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCAwKQogICAgICAgIAogICAgICAgICMgTuG6v3UgbWF4X2pvYnNfcGVyX3Nlc3Npb24gY2jGsGEgxJHGsOG7o2MgdGhp4bq/dCBs4bqtcCwgc+G7rSBk4bulbmcgZ2nDoSB0cuG7iyBt4bq3YyDEkeG7i25oCiAgICAgICAgaWYgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPD0gMDoKICAgICAgICAgICAgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPSBjb25maWcuTUFYX0pPQlNfUEVSX1NFU1NJT04KICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IG1heF9qb2JzX3Blcl9zZXNzaW9uIHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAibWF4X2pvYnNfcGVyX3Nlc3Npb24iOiBtYXhfam9ic19wZXJfc2Vzc2lvbgogICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgIGlmIGpvYnNfZG9uZV9pbl9zZXNzaW9uID49IG1heF9qb2JzX3Blcl9zZXNzaW9uOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSDEkcOjIGzDoG0gxJHhu6cge21heF9qb2JzX3Blcl9zZXNzaW9ufSBqb2IgdHJvbmcgcGhpw6puIikKICAgICAgICAgICAgIyDEkOG6t3QgdMOgaSBraG/huqNuIHbDoG8gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZSB24bubaSB0aOG7nWkgZ2lhbiBjaOG7nSBt4bq3YyDEkeG7i25oCiAgICAgICAgICAgIHNlbGYuZGIuc2V0X2FjY291bnRfaW5hY3RpdmUoYWNjb3VudFsiaWQiXSwgaW5hY3RpdmVfcmVhc29uPSLEkMOjIGhvw6BuIHRow6BuaCBz4buRIGpvYiB04buRaSDEkWEgdHJvbmcgcGhpw6puIikKICAgICAgICAgICAgIyDEkMOzbmcgYXBwIHNhdSBraGkgxJHhurd0IGluYWN0aXZlCiAgICAgICAgICAgIGFwcF9uYW1lID0gYWNjb3VudC5nZXQoImFwcCIpCiAgICAgICAgICAgIGlmIGFwcF9uYW1lIGFuZCBhcHBfbmFtZSBpbiBjb25maWcuQVBQX1BBQ0tBR0VTOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKGNvbmZpZy5BUFBfUEFDS0FHRVNbYXBwX25hbWVdKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgIyBO4bq/dSDEkcOjIGtp4buDbSB0cmEgcXVhIHThuqV0IGPhuqMgY8OhYyDEkWnhu4F1IGtp4buHbiwgdMOgaSBraG/huqNuIGPDsyB0aOG7gyBjaOG6oXkgam9iCiAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAKICAgIGRlZiBfdXBkYXRlX2pvYl9zdGF0cyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgc3VjY2VzczogYm9vbCA9IFRydWUpOgogICAgICAgICIiIgogICAgICAgIEPhuq1wIG5o4bqtdCB0aOG7kW5nIGvDqiBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBzdWNjZXNzOiBUcnVlIG7hur91IGpvYiB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgICMgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gam9iCiAgICAgICAgam9iX3RvZGF5ID0gYWNjb3VudC5nZXQoImpvYl90b2RheSIsIDApCiAgICAgICAgam9ic19kb25lX2luX3Nlc3Npb24gPSBhY2NvdW50LmdldCgiam9ic19kb25lX2luX3Nlc3Npb24iLCAwKQogICAgICAgIAogICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAibGFzdF9qb2JfdGltZSI6IGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICJqb2JfdG9kYXkiOiBqb2JfdG9kYXkgKyAxLAogICAgICAgICAgICAiam9ic19kb25lX2luX3Nlc3Npb24iOiBqb2JzX2RvbmVfaW5fc2Vzc2lvbiArIDEsCiAgICAgICAgICAgICJ0b3RhbF9qb2JzIjogYWNjb3VudC5nZXQoInRvdGFsX2pvYnMiLCAwKSArIDEKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgbm90IHN1Y2Nlc3M6CiAgICAgICAgICAgICMgTuG6v3Ugam9iIHRo4bqldCBi4bqhaSwgdMSDbmcgc+G7kSBs4bqnbiB0aOG6pXQgYuG6oWkKICAgICAgICAgICAgdXBkYXRlX2RhdGFbImZhaWxlZF9qb2JzIl0gPSBhY2NvdW50LmdldCgiZmFpbGVkX2pvYnMiLCAwKSArIDEKICAgICAgICAgICAgCiAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB1cGRhdGVfZGF0YSkKICAgICAgICAKICAgICAgICAjIFJlc2V0IHPhu5EgbOG6p24gdGjhu60gam9iIHRo4bqldCBi4bqhaSBu4bq/dSBqb2IgdGjDoG5oIGPDtG5nCiAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgIyBSZXNldCB0cm9uZyBi4buZIG5o4bubCiAgICAgICAgICAgIHNlbGYuZmFpbGVkX2pvYl9hdHRlbXB0c1thY2NvdW50WyJpZCJdXSA9IDAKICAgICAgICAKICAgICAgICAjIEzhuqV5IHPhu5Egam9iIHThu5FpIMSRYSB0cm9uZyBwaGnDqm4gdOG7qyBhY2NvdW50CiAgICAgICAgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPSBhY2NvdW50LmdldCgibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCAwKQogICAgICAgIAogICAgICAgICMgTuG6v3UgbWF4X2pvYnNfcGVyX3Nlc3Npb24gY2jGsGEgxJHGsOG7o2MgdGhp4bq/dCBs4bqtcCwgc+G7rSBk4bulbmcgZ2nDoSB0cuG7iyBt4bq3YyDEkeG7i25oCiAgICAgICAgaWYgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPD0gMDoKICAgICAgICAgICAgbWF4X2pvYnNfcGVyX3Nlc3Npb24gPSBjb25maWcuTUFYX0pPQlNfUEVSX1NFU1NJT04KICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IG1heF9qb2JzX3Blcl9zZXNzaW9uIHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAibWF4X2pvYnNfcGVyX3Nlc3Npb24iOiBtYXhfam9ic19wZXJfc2Vzc2lvbgogICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgICMgxJDDoyBsw6BtIMSR4bunIHPhu5Egam9iIHRyb25nIHBoacOqbiwgxJHhurd0IGluYWN0aXZlCiAgICAgICAgaWYgKGpvYnNfZG9uZV9pbl9zZXNzaW9uICsgMSkgPj0gbWF4X2pvYnNfcGVyX3Nlc3Npb246CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IMSRw6MgbMOgbSDEkeG7pyB7bWF4X2pvYnNfcGVyX3Nlc3Npb259IGpvYiB0cm9uZyBwaGnDqm4iKQogICAgICAgICAgICAjIMSQ4bq3dCB0w6BpIGtob+G6o24gdsOgbyB0cuG6oW5nIHRow6FpIGluYWN0aXZlIHbhu5tpIHRo4budaSBnaWFuIGNo4budIG3hurdjIMSR4buLbmgKICAgICAgICAgICAgc2VsZi5kYi5zZXRfYWNjb3VudF9pbmFjdGl2ZShhY2NvdW50WyJpZCJdLCBpbmFjdGl2ZV9yZWFzb249IsSQw6MgaG/DoG4gdGjDoG5oIHPhu5Egam9iIHThu5FpIMSRYSB0cm9uZyBwaGnDqm4iKQogICAgICAgICAgICAjIMSQw7NuZyBhcHAgc2F1IGtoaSDEkeG6t3QgaW5hY3RpdmUKICAgICAgICAgICAgYXBwX25hbWUgPSBhY2NvdW50LmdldCgiYXBwIikKICAgICAgICAgICAgaWYgYXBwX25hbWUgYW5kIGFwcF9uYW1lIGluIGNvbmZpZy5BUFBfUEFDS0FHRVM6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoY29uZmlnLkFQUF9QQUNLQUdFU1thcHBfbmFtZV0pCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHkKICAgICAgICBqb2JfbWF4X2RheSA9IGFjY291bnQuZ2V0KCJqb2JfbWF4X2RheSIsIDApCiAgICAgICAgaWYgam9iX21heF9kYXkgPD0gMDoKICAgICAgICAgICAgam9iX21heF9kYXkgPSBjb25maWcuTUFYX0pPQlNfUEVSX0RBWQogICAgICAgIAogICAgICAgICMgTuG6v3Ugam9iIHbhu6thIGzDoG0gbMOgIGpvYiBjdeG7kWkgY8O5bmcgdHJvbmcgbmfDoHksIMSR4bq3dCBpbmFjdGl2ZSDEkeG6v24gbmfDoHkgaMO0bSBzYXUKICAgICAgICBpZiAoam9iX3RvZGF5ICsgMSkgPj0gam9iX21heF9kYXk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgdHJvbmcgbmfDoHkgKHtqb2JfdG9kYXkrMX0ve2pvYl9tYXhfZGF5fSkiKQogICAgICAgICAgICBzZWxmLmRiLnNldF9hY2NvdW50X2luYWN0aXZlX3VudGlsX25leHRfcmVzZXQoYWNjb3VudFsiaWQiXSwgIsSQw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHkiKQogICAgICAgICAgICBhcHBfbmFtZSA9IGFjY291bnQuZ2V0KCJhcHAiKQogICAgICAgICAgICBpZiBhcHBfbmFtZSBhbmQgYXBwX25hbWUgaW4gY29uZmlnLkFQUF9QQUNLQUdFUzoKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcChjb25maWcuQVBQX1BBQ0tBR0VTW2FwcF9uYW1lXSkKICAgICAgICAKICAgIGRlZiBzdGFydChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgxJHhu5luZyBKb2JTZXJ2aWNlIHRyb25nIHRocmVhZCByacOqbmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICB0aHJlYWRpbmcuVGhyZWFkOiBUaHJlYWQgxJFhbmcgY2jhuqF5IEpvYlNlcnZpY2UgaG/hurdjIE5vbmUgbuG6v3UgbOG7l2kKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhurd0IHRy4bqhbmcgdGjDoWkgcnVubmluZwogICAgICAgICAgICBzZWxmLnJ1bm5pbmcgPSBUcnVlCiAgICAgICAgICAgIHNlbGYuZm9yY2Vfc3RvcCA9IEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHRocmVhZAogICAgICAgICAgICB0aHJlYWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1zZWxmLnJ1bikKICAgICAgICAgICAgdGhyZWFkLmRhZW1vbiA9IFRydWUKICAgICAgICAgICAgdGhyZWFkLnN0YXJ0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB0aHJlYWQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraOG7n2kgxJHhu5luZyBKb2JTZXJ2aWNlIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICBkZWYgcmVzZXRfaW5hY3RpdmVfYWNjb3VudHMoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6Aga2jDtGkgcGjhu6VjIGPDoWMgdMOgaSBraG/huqNuIGluYWN0aXZlIMSRw6MgaOG6v3QgdGjhu51pIGdpYW4gY2jhu50KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB04bqldCBj4bqjIHTDoGkga2hv4bqjbiDhu58gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZQogICAgICAgICAgICBmb3IgYXBwX25hbWUgaW4gc2VsZi5lbmFibGVkX2FwcHM6CiAgICAgICAgICAgICAgICBpbmFjdGl2ZV9hY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1hcHBfbmFtZSwgc3RhdHVzPSJpbmFjdGl2ZSIpIG9yIFtdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGluYWN0aXZlX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgIGpvYl9kaXNhYmxlX3VudGlsID0gYWNjb3VudC5nZXQoImpvYl9kaXNhYmxlX3VudGlsIiwgMCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE7hur91IMSRw6MgaOG6v3QgdGjhu51pIGdpYW4gY2jhu50sIGNodXnhu4NuIHbhu4EgdHLhuqFuZyB0aMOhaSBhY3RpdmUKICAgICAgICAgICAgICAgICAgICBpZiBqb2JfZGlzYWJsZV91bnRpbCA8PSBjdXJyZW50X3RpbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgeyJzdGF0dXMiOiAiYWN0aXZlIn0pCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IChJRDoge2FjY291bnRbJ2lkJ119KSDEkcOjIGjhur90IHRo4budaSBnaWFuIGNo4budLCDEkcOjIGNodXnhu4NuIHbhu4EgdHLhuqFuZyB0aMOhaSBhY3RpdmUiKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ19taW51dGVzID0gaW50KChqb2JfZGlzYWJsZV91bnRpbCAtIGN1cnJlbnRfdGltZSkgLyA2MCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IGPDsm4ge3JlbWFpbmluZ19taW51dGVzfSBwaMO6dCDhu58gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGtp4buDbSB0cmEgdsOgIGtow7RpIHBo4bulYyB0w6BpIGtob+G6o24gaW5hY3RpdmUiKQogICAgCiAgICBkZWYgaXNfYWNjb3VudF9jYW5fcnVuX2pvYihzZWxmLCBhcHBfbmFtZTpzdHIgKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiBjw7MgdGjhu4MgY2jhuqF5IGpvYiBraMO0bmcKICAgICAgICAiIiIKICAgICAgICBhY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1hcHBfbmFtZSkKICAgICAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50czoKICAgICAgICAgICAgaWYoc2VsZi5fY2FuX3J1bl9qb2IoYWNjb3VudCkpOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHJ1bihzZWxmKToKICAgICAgICAiIiIKICAgICAgICBDaOG6oXkgSm9iU2VydmljZSB0cm9uZyBt4buZdCB2w7JuZyBs4bq3cAogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBzZWxmLmlzX2luaXRpYWxpemVkOgogICAgICAgICAgICBpZiBub3Qgc2VsZi5pbml0aWFsaXplKCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBraOG7n2kgdOG6oW8gSm9iU2VydmljZS4gS2jDtG5nIHRo4buDIGNo4bqheS4iKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIkLhuq90IMSR4bqndSBjaOG6oXkgSm9iU2VydmljZS4uLiIpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGRldmljZV9pZAogICAgICAgIGRldmljZV9pZCA9IHNlbGYuZGIuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgICAgICAKICAgICAgICBpZiBub3QgZGV2aWNlX2lkOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCBkZXZpY2VfaWQgaGnhu4duIHThuqFpLCBKb2JTZXJ2aWNlIGtow7RuZyB0aOG7gyBjaOG6oXkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgIyBCaeG6v24gbMawdSB0cuG7ryB0w6BpIGtob+G6o24gxJFhbmcgbMOgbSB2aeG7h2MgaGnhu4duIHThuqFpIGNobyBt4buXaSDhu6luZyBk4bulbmcKICAgICAgICBjdXJyZW50X3dvcmtpbmdfYWNjb3VudHMgPSB7fQogICAgICAgIAogICAgICAgIHdoaWxlIHNlbGYucnVubmluZzoKICAgICAgICAgICAgIyBSZXNldCBiaeG6v24gZm9yY2Vfc3RvcCBu4bq/dSBjw7MKICAgICAgICAgICAgd2l0aCBzZWxmLl9sb2NrOgogICAgICAgICAgICAgICAgc2VsZi5mb3JjZV9zdG9wID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB5w6p1IGPhuqd1IHThuqFtIGThu6tuZyB04burIHNlcnZlciAoY29uZmlnICJwYXVzZV9qb2IiKQogICAgICAgICAgICBpZiBzZWxmLmRiLmdldCgicGF1c2Vfam9iIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkPDsyB5w6p1IGPhuqd1IHThuqFtIGThu6tuZyB04burIHNlcnZlciwgdOG6oW0gZOG7q25nIHjhu60gbMO9IGpvYiIpCiAgICAgICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyB0cuG6oW5nIHRow6FpIHRoaeG6v3QgYuG7iyBraMO0bmcgaGnhu4NuIHRo4buLIMSRYW5nIGzDoG0gdmnhu4djCiAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX2lzX3dvcmtpbmciLCBGYWxzZSkKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsICIiKQogICAgICAgICAgICAgICAgam9iX2NoZWNrX2ludGVydmFsID0gc2VsZi5kYi5nZXQoImpvYl9jaGVja19pbnRlcnZhbCIsIGNvbmZpZy5KT0JfQ0hFQ0tfSU5URVJWQUwpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKGpvYl9jaGVja19pbnRlcnZhbCk6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IGLhu5kgxJHhur9tIGjDoG5nIG5nw6B5IG7hur91IGPhuqduCiAgICAgICAgICAgIHNlbGYuX3Jlc2V0X2RhaWx5X2NvdW50ZXJzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2w6Aga2jDtGkgcGjhu6VjIGPDoWMgdMOgaSBraG/huqNuIGluYWN0aXZlIMSRw6MgaOG6v3QgdGjhu51pIGdpYW4gY2jhu50KICAgICAgICAgICAgc2VsZi5yZXNldF9pbmFjdGl2ZV9hY2NvdW50cygpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIER1eeG7h3QgcXVhIHThu6tuZyBhcHAgxJHGsOG7o2Mga8OtY2ggaG/huqF0CiAgICAgICAgICAgICAgICBlbmFibGVkX2FwcHMgPSBzZWxmLmRiLmdldCgiZW5hYmxlZF9hcHBzIiwgY29uZmlnLkVOQUJMRURfQVBQUykKICAgICAgICAgICAgICAgIGlmKGxlbihlbmFibGVkX2FwcHMpPT0wKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIktow7RuZyBjw7MgYXBwIG7DoG8gxJHGsOG7o2Mga8OtY2ggaG/huqF0LCDEkeG7o2kge2NvbmZpZy5KT0JfQ0hFQ0tfSU5URVJWQUx9IGdpw6J5IikKICAgICAgICAgICAgICAgICAgICAjIMSQ4bujaSBt4buZdCBraG/huqNuZyB0aOG7nWkgZ2lhbiB0csaw4bubYyBraGkga2nhu4NtIHRyYSBs4bqhaSBqb2IKICAgICAgICAgICAgICAgICAgICBqb2JfY2hlY2tfaW50ZXJ2YWwgPSBzZWxmLmRiLmdldCgiam9iX2NoZWNrX2ludGVydmFsIiwgY29uZmlnLkpPQl9DSEVDS19JTlRFUlZBTCkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKGpvYl9jaGVja19pbnRlcnZhbCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICBmb3IgYXBwX25hbWUgaW4gZW5hYmxlZF9hcHBzOgogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIGPhuqduIGThu6tuZyBraMO0bmcKICAgICAgICAgICAgICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuZm9yY2Vfc3RvcCBvciBub3Qgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGFwcCBjw7MgdHJvbmcgam9iX2hhbmRsZXJzIGtow7RuZwogICAgICAgICAgICAgICAgICAgIGlmIGFwcF9uYW1lIG5vdCBpbiBzZWxmLmpvYl9oYW5kbGVyczoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgam9iIGhhbmRsZXIgY2hvIHthcHBfbmFtZX0sIGLhu48gcXVhIikKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdsOgIMSR4buTbmcgYuG7mSB0w6BpIGtob+G6o24gbuG6v3UgY+G6p24KICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLl9jaGVja19hY2NvdW50X3N5bmNfc3RhdHVzKGFwcF9uYW1lKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkOG7k25nIGLhu5kgdMOgaSBraG/huqNuIGNobyB7YXBwX25hbWV9Li4uIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fc3luY19hY2NvdW50c19mb3JfYXBwKGFwcF9uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyID0gc2VsZi5qb2JfaGFuZGxlcnNbYXBwX25hbWVdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSB0w6BpIGtob+G6o24gxJFhbmcgbMOgbSB2aeG7h2MgaGnhu4duIHThuqFpIGPhu6dhIOG7qW5nIGThu6VuZyBuw6B5CiAgICAgICAgICAgICAgICAgICAgY3VycmVudF9hY2NvdW50ID0gY3VycmVudF93b3JraW5nX2FjY291bnRzLmdldChhcHBfbmFtZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGNoxrBhIGPDsyB0w6BpIGtob+G6o24gxJFhbmcgbMOgbSB2aeG7h2MsIGtp4buDbSB0cmEgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY3VycmVudF9hY2NvdW50OgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuaXNfYWNjb3VudF9jYW5fcnVuX2pvYihhcHBfbmFtZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIktow7RuZyBjw7MgdMOgaSBraG/huqNuIG7DoG8gxJHGsOG7o2MgbMOgbSB2aeG7h2MsIGLhu48gcXVhIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgxJDhu6NpIG3hu5l0IGtob+G6o25nIHRo4budaSBnaWFuIHRyxrDhu5tjIGtoaSBraeG7g20gdHJhIGzhuqFpIGpvYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX2NoZWNrX2ludGVydmFsID0gc2VsZi5kYi5nZXQoImpvYl9jaGVja19pbnRlcnZhbCIsIGNvbmZpZy5KT0JfQ0hFQ0tfSU5URVJWQUwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKGpvYl9jaGVja19pbnRlcnZhbCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IHVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdXNlcm5hbWUgPSBoYW5kbGVyLmdldF9jdXJyZW50X2xvZ2dlZF9pbl91c2VybmFtZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3VzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHTDoGkga2hv4bqjbiB0xrDGoW5nIOG7qW5nIHRyb25nIERCICjEkcOjIGzhu41jIHRoZW8gZGV2aWNlX2lkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9YXBwX25hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dpbl9hY2NvdW50ID0gbmV4dCgoYWNjIGZvciBhY2MgaW4gYWNjb3VudHMgaWYgYWNjLmdldCgidW5pcXVlX3VzZXJuYW1lIikgPT0gY3VycmVudF91c2VybmFtZSksIE5vbmUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxvZ2luX2FjY291bnQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkcSDbmcgbmjhuq1wIHRyb25nIERCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5yZXNldF9sb2dpbl9zdGF0dXNfYnlfYXBwKGFwcF9uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQobG9naW5fYWNjb3VudFsiaWQiXSwgeyJpc19sb2dpbiI6IFRydWV9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgU+G7rSBk4bulbmcgdMOgaSBraG/huqNuIG7DoHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dvcmtpbmdfYWNjb3VudHNbYXBwX25hbWVdID0gbG9naW5fYWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfYWNjb3VudCA9IGxvZ2luX2FjY291bnQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE7hur91IHbhuqtuIGtow7RuZyBjw7MgdMOgaSBraG/huqNuIG7DoG8gxJHhu4MgbMOgbSB2aeG7h2MsIGLhu48gcXVhIOG7qW5nIGThu6VuZyBuw6B5CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGN1cnJlbnRfYWNjb3VudDoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaMO0bmcgY8OzIHTDoGkga2hv4bqjbiBuw6BvIMSRYW5nIMSRxINuZyBuaOG6rXAgY2hvIHthcHBfbmFtZX0sIGLhu48gcXVhIikKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiBoaeG7h24gdOG6oWkgY8OzIHRo4buDIGNo4bqheSBqb2Iga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX2Nhbl9ydW5fam9iKGN1cnJlbnRfYWNjb3VudCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHtjdXJyZW50X2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0ga2jDtG5nIHRo4buDIGNo4bqheSBqb2IsIHTDrG0gdMOgaSBraG/huqNuIGtow6FjIikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSB0w6BpIGtob+G6o24ga2jDoWMgdGjhu49hIG3Do24gxJFp4buBdSBraeG7h24gKMSRw6MgbOG7jWMgdGhlbyBkZXZpY2VfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPWFwcF9uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBuZXh0X2FjY291bnQgPSBuZXh0KChhY2MgZm9yIGFjYyBpbiBhY2NvdW50cyBpZiBzZWxmLl9jYW5fcnVuX2pvYihhY2MpKSwgTm9uZSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBuZXh0X2FjY291bnQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIktow7RuZyBjw7MgdMOgaSBraG/huqNuIG7DoG8gY8OzIHRo4buDIGNo4bqheSBqb2IgY2hvIHthcHBfbmFtZX0sIGLhu48gcXVhIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfd29ya2luZ19hY2NvdW50c1thcHBfbmFtZV0gPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmNsb3NlX2FwcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgc2FuZyB0w6BpIGtob+G6o24ga2jDoWMKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoX3N1Y2Nlc3MgPSBoYW5kbGVyLnN3aXRjaF90b19hY2NvdW50KG5leHRfYWNjb3VudCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3dpdGNoX3N1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dvcmtpbmdfYWNjb3VudHNbYXBwX25hbWVdID0gbmV4dF9hY2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2FjY291bnQgPSBuZXh0X2FjY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBjaHV54buDbiBzYW5nIHTDoGkga2hv4bqjbiB7bmV4dF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9LCBi4buPIHF1YSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dvcmtpbmdfYWNjb3VudHNbYXBwX25hbWVdID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5jbG9zZV9hcHAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRo4buxYyBoaeG7h24gam9iIHbhu5tpIHTDoGkga2hv4bqjbiBoaeG7h24gdOG6oWkKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGNo4bqheSBqb2IgY2hvIHTDoGkga2hv4bqjbiB7Y3VycmVudF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9ICh7YXBwX25hbWV9KS4uLiIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gam9iCiAgICAgICAgICAgICAgICAgICAgICAgIGpvYiA9IGhhbmRsZXIuZmV0Y2hfam9iKGN1cnJlbnRfYWNjb3VudCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGpvYjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmVzZXQgc+G7kSBs4bqnbiB0aOG6pXQgYuG6oWkgbGnDqm4gdGnhur9wIGtoaSBjw7Mgam9iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxlZF9qb2JfYXR0ZW1wdHNbY3VycmVudF9hY2NvdW50WyJpZCJdXSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdGhp4bq/dCBi4buLIMSRYW5nIGzDoG0gdmnhu4djIHbDoCBnaGkgbWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9pc193b3JraW5nIiwgVHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsIGYiW3thcHBfbmFtZX1dW3tqb2IuZ2V0KCd0eXBlJyl9XVt7am9iLmdldCgnbGluaycsICcnKX1dIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTuG6v3UgdMOgaSBraG/huqNuIMSRYW5nIGLhu4sga2jDs2EgRk9MTE9XIHbDoCBqb2IgbMOgIGZvbGxvdyB0aMOsIGLhu48gcXVhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgam9iIGFuZCBqb2IuZ2V0KCJ0eXBlIiwgIiIpLmxvd2VyKCkgPT0gImZvbGxvdyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGN1cnJlbnRfYWNjb3VudC5nZXQoInN0YXR1cyIpID09ICJpbmFjdGl2ZV9mb2xsb3ciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5hY3RpdmVfdW50aWwgPSBjdXJyZW50X2FjY291bnQuZ2V0KCJqb2JfZGlzYWJsZV91bnRpbCIsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgdGltZSBhcyBfdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaW5hY3RpdmVfdW50aWwgPiBfdC50aW1lKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge2N1cnJlbnRfYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSDEkWFuZyBi4buLIGtow7NhIEZPTExPVyB04bubaSB7aW5hY3RpdmVfdW50aWx9LCBza2lwIGpvYiBmb2xsb3ciKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQuG7jyBxdWEgam9iIG7DoHkgYuG6sW5nIGPDoWNoIHNraXAgdHLDqm4gR29MaWtlIMSR4buDIGtow7RuZyBi4buLIHBo4bqhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5yZWNvcmRfam9iX2hpc3RvcnkoY3VycmVudF9hY2NvdW50LCBqb2IsIHsic3RhdHVzIjogMiwgInN1Y2Nlc3MiOiBGYWxzZSwgIm1lc3NhZ2UiOiAixJBhbmcgYuG7iyBraMOzYSBGT0xMT1cgLCBI4buneSBqb2IuIn0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuc2tpcF9qb2IoY3VycmVudF9hY2NvdW50LCBqb2IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBfZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJTa2lwIGpvYiBs4buXaToge19lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyByZXNldCBkZXZpY2UgbWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfaXNfd29ya2luZyIsIEZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ2jhu50gbeG7mXQga2hv4bqjbmcgdHLGsOG7m2MgdsOybmcgbOG6t3AgdGnhur9wIHRoZW8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKHNlbGYuZGIuZ2V0KCJqb2JfY2hlY2tfaW50ZXJ2YWwiLCBjb25maWcuSk9CX0NIRUNLX0lOVEVSVkFMKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGpvYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9yZXN1bHQgPSBoYW5kbGVyLmV4ZWN1dGVfam9iKGN1cnJlbnRfYWNjb3VudCwgam9iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxseToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNhdSBraGkga+G6v3QgdGjDumMgam9iICh0aMOgbmggY8O0bmcgaGF5IHRo4bqldCBi4bqhaSkgxJHhurd0IGzhuqFpIHRy4bqhbmcgdGjDoWkgbMOgbSB2aeG7h2MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX2lzX3dvcmtpbmciLCBGYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IHRow7RuZyB0aW4gdOG7qyBr4bq/dCBxdeG6oyBqb2IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9zdGF0dXMgPSBqb2JfcmVzdWx0WyJzdGF0dXMiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX3N1Y2Nlc3MgPSBqb2JfcmVzdWx0WyJzdWNjZXNzIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9tZXNzYWdlID0gam9iX3Jlc3VsdFsibWVzc2FnZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgWOG7rSBsw70gbOG7l2kgZm9sbG93IHBlbmRpbmcgKHN0YXR1cyA0KSBY4butIGzDvSBjaG8gaW5zdGFncmFtIHRow7RpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBqb2Jfc3RhdHVzID09IDQgYW5kIGpvYi5nZXQoInR5cGUiLCAiIikubG93ZXIoKSA9PSAiZm9sbG93IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbnQgPSBzZWxmLmZvbGxvd19wZW5kaW5nX2NvdW50cy5nZXQoY3VycmVudF9hY2NvdW50WyJpZCJdLCAwKSArIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZvbGxvd19wZW5kaW5nX2NvdW50c1tjdXJyZW50X2FjY291bnRbImlkIl1dID0gY250CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3BlbmRpbmcgPSA1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY250ID49IG1heF9wZW5kaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlTDoGkga2hv4bqjbiB7Y3VycmVudF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IMSRw6Mge2NudH0gbOG6p24gbGnDqm4gdGnhur9wIGZvbGxvdyBwZW5kaW5nLCBraMOzYSBGT0xMT1cgxJHhur9uIGdp4budIHJlc2V0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXRfYWNjb3VudF9pbmFjdGl2ZV9mb2xsb3dfdW50aWxfbmV4dF9yZXNldChjdXJyZW50X2FjY291bnRbImlkIl0sICJMacOqbiB0aeG6v3AgbOG7l2kgZm9sbG93IHBlbmRpbmciKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZvbGxvd19wZW5kaW5nX2NvdW50c1tjdXJyZW50X2FjY291bnRbImlkIl1dID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIMSQw7NuZyBhcHAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwX25hbWVfdG1wID0gY3VycmVudF9hY2NvdW50LmdldCgiYXBwIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXBwX25hbWVfdG1wIGFuZCBhcHBfbmFtZV90bXAgaW4gY29uZmlnLkFQUF9QQUNLQUdFUzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcChjb25maWcuQVBQX1BBQ0tBR0VTW2FwcF9uYW1lX3RtcF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGpvYi5nZXQoInR5cGUiLCAiIikubG93ZXIoKSA9PSAiZm9sbG93IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFJlc2V0IMSR4bq/bSBu4bq/dSBqb2Iga2jDtG5nIHBo4bqjaSBmb2xsb3cgcGVuZGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZm9sbG93X3BlbmRpbmdfY291bnRzW2N1cnJlbnRfYWNjb3VudFsiaWQiXV0gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQsOhbyBjw6FvIGvhur90IHF14bqjIHbhu5tpIG1lc3NhZ2UgdOG7qyBr4bq/dCBxdeG6oyBqb2IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydF9zdWNjZXNzID0gaGFuZGxlci5yZXBvcnRfam9iKGN1cnJlbnRfYWNjb3VudCwgam9iLCBqb2JfcmVzdWx0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aOG7kW5nIGvDqgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdXBkYXRlX2pvYl9zdGF0cyhjdXJyZW50X2FjY291bnQsIGpvYl9zdWNjZXNzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIkvhur90IHF14bqjIGpvYjoge2pvYl9tZXNzYWdlfSAoc3RhdHVzOiB7am9iX3N0YXR1c30pIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnQoY3VycmVudF9hY2NvdW50WyJpZCJdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF93b3JraW5nX2FjY291bnRzW2FwcF9uYW1lXSA9IGN1cnJlbnRfYWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiBjw7JuIGPDsyB0aOG7gyBjaOG6oXkgam9iIG7hu69hIGtow7RuZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX2Nhbl9ydW5fam9iKGN1cnJlbnRfYWNjb3VudCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge2N1cnJlbnRfYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSDEkcOjIGjhur90IGpvYiBjw7MgdGjhu4MgY2jhuqF5IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIENo4bqheSBudcO0aSB0w6BpIGtob+G6o24gbuG6v3UgxJHDoyBjaOG6oXkgaOG6v3Qgam9iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5kYi5nZXQoZiJ7YXBwX25hbWV9X2NhcmVfZW5hYmxlIiwgVHJ1ZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIucGVyZm9ybV9jYXJlKGN1cnJlbnRfYWNjb3VudCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSBudcO0aSB0w6BpIGtob+G6o24ge2N1cnJlbnRfYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgbMOgIGPhuqduIHTDrG0gdMOgaSBraG/huqNuIGtow6FjCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF93b3JraW5nX2FjY291bnRzW2FwcF9uYW1lXSA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmNsb3NlX2FwcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIktow7RuZyBjw7Mgam9iIGto4bqjIGThu6VuZyBjaG8gdMOgaSBraG/huqNuIHtjdXJyZW50X2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFTEg25nIHPhu5EgbOG6p24ga2jDtG5nIGPDsyBqb2IgbGnDqm4gdGnhur9wIHRyb25nIGLhu5kgbmjhu5sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBjdXJyZW50X2FjY291bnRbImlkIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZmFpbGVkX2pvYl9hdHRlbXB0c1thY2NvdW50X2lkXSA9IHNlbGYuZmFpbGVkX2pvYl9hdHRlbXB0cy5nZXQoYWNjb3VudF9pZCwgMCkgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsZWRfYXR0ZW1wdHMgPSBzZWxmLmZhaWxlZF9qb2JfYXR0ZW1wdHNbYWNjb3VudF9pZF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSA1IGzhuqduIGxpw6puIHRp4bq/cCBraMO0bmcgY8OzIGpvYiwgxJHhurd0IHTDoGkga2hv4bqjbiB2w6BvIGNo4bq/IMSR4buZIG5naOG7iQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmFpbGVkX2F0dGVtcHRzID49IDU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29vbGRvd25fbWludXRlcyA9IHNlbGYuZGIuZ2V0KCJjb29sZG93bl9nZXRfam9iX2dvbGlrZSIsIDMwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiVMOgaSBraG/huqNuIHtjdXJyZW50X2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gxJHDoyA1IGzhuqduIGxpw6puIHRp4bq/cCBraMO0bmcgY8OzIGpvYiwgY2hvIG5naOG7iSB7Y29vbGRvd25fbWludXRlc30gcGjDunQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0X2FjY291bnRfaW5hY3RpdmUoY3VycmVudF9hY2NvdW50WyJpZCJdLCBjb29sZG93bl9taW51dGVzPWNvb2xkb3duX21pbnV0ZXMsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmFjdGl2ZV9yZWFzb249ZiJLaMO0bmcgdMOsbSB0aOG6pXkgam9iIGto4bqjIGThu6VuZyBzYXUgNSBs4bqnbiB0aOG7rSBsacOqbiB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcF9uYW1lID0gY3VycmVudF9hY2NvdW50LmdldCgiYXBwIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhcHBfbmFtZSBhbmQgYXBwX25hbWUgaW4gY29uZmlnLkFQUF9QQUNLQUdFUzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKGNvbmZpZy5BUFBfUEFDS0FHRVNbYXBwX25hbWVdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGzhuqFpIHRow7RuZyB0aW4gdMOgaSBraG/huqNuIHThu6sgZGF0YWJhc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2FjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50KGN1cnJlbnRfYWNjb3VudFsiaWQiXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dvcmtpbmdfYWNjb3VudHNbYXBwX25hbWVdID0gY3VycmVudF9hY2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgxJDhu6NpIG3hu5l0IGtob+G6o25nIHRo4budaSBnaWFuIHRyxrDhu5tjIGtoaSBraeG7g20gdHJhIGzhuqFpIGpvYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX2NoZWNrX2ludGVydmFsID0gc2VsZi5kYi5nZXQoImpvYl9jaGVja19pbnRlcnZhbCIsIGNvbmZpZy5KT0JfQ0hFQ0tfSU5URVJWQUwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKGpvYl9jaGVja19pbnRlcnZhbCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBqb2IgY2hvIHTDoGkga2hv4bqjbiB7Y3VycmVudF9hY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgY2jhuqF5IGpvYiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG7o2kgdHLGsOG7m2Mga2hpIGNo4bqheSBs4bqhaQogICAgICAgICAgICBqb2JfY2hlY2tfaW50ZXJ2YWwgPSBzZWxmLmRiLmdldCgiam9iX2NoZWNrX2ludGVydmFsIiwgY29uZmlnLkpPQl9DSEVDS19JTlRFUlZBTCkKICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcChqb2JfY2hlY2tfaW50ZXJ2YWwpOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICBkZWYgc3RvcChzZWxmKToKICAgICAgICAiIiJE4burbmcgSm9iU2VydmljZSIiIgogICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBsb2dnZXIuaW5mbygixJBhbmcgZOG7q25nIEpvYlNlcnZpY2UuLi4iKQogICAgICAgIAogICAgZGVmIGZvcmNlX3N0b3BfYWxsKHNlbGYpOgogICAgICAgICIiIkThu6tuZyBuZ2F5IGzhuq1wIHThu6ljIHThuqV0IGPhuqMgY8OhYyBob+G6oXQgxJHhu5luZyIiIgogICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgc2VsZi5mb3JjZV9zdG9wID0gVHJ1ZQogICAgICAgICAgICBzZWxmLnJ1bm5pbmcgPSBGYWxzZQogICAgICAgIGxvZ2dlci5pbmZvKCJE4burbmcgbmdheSBs4bqtcCB04bupYyB04bqldCBj4bqjIGPDoWMgaG/huqF0IMSR4buZbmcuLi4iKQoKICAgIGRlZiBzaHV0ZG93bihzZWxmKToKICAgICAgICAiIiLEkMOzbmcgZOG7i2NoIHbhu6UsIGThu6tuZyB04bqldCBj4bqjIHdvcmtlciB0aHJlYWRzIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJE4burbmcgbmdheSBs4bqtcCB04bupYyB04bqldCBj4bqjIGPDoWMgaG/huqF0IMSR4buZbmcuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgZOG7q25nCiAgICAgICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYuZm9yY2Vfc3RvcCA9IFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDDoW5oIHRo4bupYyB04bqldCBj4bqjIHdvcmtlciB0aHJlYWRzIMSR4buDIGNow7puZyBraeG7g20gdHJhIMSRaeG7gXUga2nhu4duIGThu6tuZwogICAgICAgICAgICBmb3Igd29ya2VyIGluIHNlbGYud29ya2Vycy52YWx1ZXMoKToKICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIod29ya2VyLCAid2FrZV91cCIpIGFuZCBjYWxsYWJsZSh3b3JrZXIud2FrZV91cCk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICB3b3JrZXIud2FrZV91cCgpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQw7NuZyBr4bq/dCBu4buRaSBkYXRhYmFzZSDEkeG7gyB0csOhbmggbOG7l2kgdGhyZWFkCiAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZiwgJ2RiJykgYW5kIHNlbGYuZGI6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5jbG9zZSgpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgxJHDs25nIGvhur90IG7hu5FpIGRhdGFiYXNlOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhu50gxJHhu4MgdGjDtG5nIGLDoW8gxJHDoyBk4burbmcKICAgICAgICAgICAgc2VsZi5zdG9wcGVkID0gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIHNodXRkb3duIEpvYlNlcnZpY2UiKSA=').decode('utf-8'))
