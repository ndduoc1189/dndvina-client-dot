import base64
exec(base64.b64decode('aW1wb3J0IGRhdGV0aW1lCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IG9zCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIExpc3QsIE9wdGlvbmFsCmZyb20gam9icy5qb2JfYmFzZSBpbXBvcnQgQmFzZUpvYgoKY2xhc3MgSW5zdGFncmFtSm9iKEJhc2VKb2IpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZSkKICAgICAgICBzZWxmLmFwcF9wYWNrYWdlID0gImNvbS5pbnN0YWdyYW0uYW5kcm9pZCIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gImluc3RhZ3JhbSIKICAgICAgICAKICAgICAgICAjIE92ZXJyaWRlIGRlZmF1bHQgY29uZmlnIGNobyBJbnN0YWdyYW0KICAgICAgICBzZWxmLl9kZWZhdWx0X2NvbmZpZy51cGRhdGUoewogICAgICAgICAgICAiYWN0aW9uX3dlaWdodHMiOiB7CiAgICAgICAgICAgICAgICAibmV3c2ZlZWQiOiAxOCwgICAgICAjIDE4JSB2deG7kXQgZmVlZCAoY2FvIGjGoW4gdsOsIEluc3RhZ3JhbSBjw7Mgbmhp4buBdSBwb3N0cykKICAgICAgICAgICAgICAgICJyZWVscyI6IDIyLCAgICAgICAgICMgMjIlIHhlbSByZWVscwogICAgICAgICAgICAgICAgIm5vdGlmaWNhdGlvbiI6IDEwLCAgICMgMTAlIHhlbSB0aMO0bmcgYsOhbwogICAgICAgICAgICAgICAgInByb2ZpbGUiOiAxNSwgICAgICAgIyAxNSUgeGVtIHByb2ZpbGUgIAogICAgICAgICAgICAgICAgImpvYiI6IDIwLCAgICAgICAgICAgIyAyMCUgbMOgbSBqb2IgKGdp4buvIG5ndXnDqm4pCiAgICAgICAgICAgICAgICAiZXhwbG9yZSI6IDgsICAgICAgICAjIDglIGtow6FtIHBow6EgKHRo4bqlcCBoxqFuIFRpa1RvaykKICAgICAgICAgICAgICAgICJwb3N0IjogNSwgICAgICAgICAgICMgNSUgxJHEg25nIGLDoGkgKMOtdCBkw7luZyB0cm9uZyBJbnN0YWdyYW0pCiAgICAgICAgICAgICAgICAic3RvcnkiOiA1ICAgICAgICAgICAjIDUlIHhlbSBzdG9yaWVzIChhY3Rpb24gcmnDqm5nIGPhu6dhIEluc3RhZ3JhbSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImRlbGF5X3Bvc3RfdmlkZW9fbWludXRlIjogMTQ0MCwgICMgVGjhu51pIGdpYW4gY2jhu50gZ2nhu69hIGPDoWMgbOG6p24gxJHEg25nIOG6o25oIChwaMO6dCkgLSBt4bq3YyDEkeG7i25oIDI0IGdp4budCiAgICAgICAgfSkKICAgIAogICAgZGVmIGdldF9zdXBwb3J0ZWRfYWN0aW9ucyhzZWxmKSAtPiBMaXN0W3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgT3ZlcnJpZGUgZGFuaCBzw6FjaCBhY3Rpb25zIMSRxrDhu6NjIEluc3RhZ3JhbSBo4buXIHRy4bujCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtzdHJdOiBEYW5oIHPDoWNoIGFjdGlvbnMgSW5zdGFncmFtIGjhu5cgdHLhu6MKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gbGlzdChzZWxmLmdldF9hY3Rpb25fd2VpZ2h0cygpLmtleXMoKSkKICAgICAgICAKICAgIGRlZiBkdW1wX3NjcmVlbl93aXRoX3JldHJ5KHNlbGYsIG1heF9yZXRyaWVzPTMsIHdhaXRfYmV0d2Vlbl9yZXRyaWVzPTAuNSk6CiAgICAgICAgIiIiCiAgICAgICAgRHVtcCBtw6BuIGjDrG5oIFhNTCB24bubaSBjxqEgY2jhur8gdGjhu60gbOG6oWkgbuG6v3UgZ+G6t3AgbOG7l2kKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtYXhfcmV0cmllczogU+G7kSBs4bqnbiB0aOG7rSB04buRaSDEkWEKICAgICAgICAgICAgd2FpdF9iZXR3ZWVuX3JldHJpZXM6IFRo4budaSBnaWFuIGNo4budIGdp4buvYSBjw6FjIGzhuqduIHRo4butIChnacOieSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBYTUwgY+G7p2EgbcOgbiBow6xuaCBob+G6t2MgTm9uZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfcmV0cmllcyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgxJDhu6NpIFVJIOG7lW4gxJHhu4tuaAogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhaXRfYmV0d2Vlbl9yZXRyaWVzKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICByZXR1cm4gc2NyZWVuX3htbAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIGR1bXAgWE1MIChs4bqnbiB7YXR0ZW1wdCsxfS97bWF4X3JldHJpZXN9KToge3N0cihlKX0iKQogICAgICAgICAgICAgICAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBjaG8gbOG6p24gdGjhu60gdGnhur9wIHRoZW8KICAgICAgICAgICAgICAgIHdhaXRfYmV0d2Vlbl9yZXRyaWVzICs9IDAuNQogICAgICAgICAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgZHVtcCBYTUwgc2F1IHttYXhfcmV0cmllc30gbOG6p24gdGjhu60iKQogICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICBkZWYgaXNfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcg4bufIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgSW5zdGFncmFtIGhheSBraMO0bmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRYW5nIOG7nyB0cmFuZyBjaOG7pywgRmFsc2UgbuG6v3Uga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgcGFja2FnZSBoaeG7h24gdOG6oWkgdHLGsOG7m2MgdGnDqm4KICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgICAgICAjIEtp4buDbSB0cmEgMTogQ8OzIG7DunQgIlRyYW5nIGNo4bunIiDEkcaw4bujYyBjaOG7jW4gKHNlbGVjdGVkPXRydWUpIHRyb25nIHRoYW5oIHRhYiBraMO0bmcKICAgICAgICAgICAgaG9tZV90YWIgPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciLCB0aW1lb3V0PTIwKQogICAgICAgICAgICBpZiBob21lX3RhYjoKICAgICAgICAgICAgICAgICMgTOG6pXkgWE1MIG3DoG4gaMOsbmggaGnhu4duIHThuqFpIHbhu5tpIGPGoSBjaOG6vyB0aOG7rSBs4bqhaQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIGlmIHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQoaG9tZV90YWIpOgogICAgICAgICAgICAgICAgICAgIGxvZ29fYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvdGl0bGVfbG9nb19jaGV2cm9uX2NvbnRhaW5lciIKICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgIGlmIGxvZ29fYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBsb2dvX2J1dHRvbi5nZXQoInZpc2libGUtdG8tdXNlciIpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB0w6xtIHRo4bqleSB0YWIgIlRyYW5nIGNo4bunIiBuaMawbmcgY2jGsGEgxJHGsOG7o2MgY2jhu41uLCBjbGljayB2w6BvIMSRw7MKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaG9tZV90YWIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiAxLjVzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB0w6xtIHRo4bqleSB0YWIgIlRyYW5nIGNo4bunIiBuaMawbmcgY2jGsGEgxJHGsOG7o2MgY2jhu41uLCBjbGljayB2w6BvIMSRw7MKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaG9tZV90YWIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiAxLjVzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgY8OhYyB54bq/dSB04buRIGPhu6dhIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGtp4buDbSB0cmEgbcOgbiBow6xuaCB0cmFuZyBjaOG7pyBJbnN0YWdyYW0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgZW5zdXJlX2hvbWVfc2NyZWVuKHNlbGYsIG1heF9yZXRyaWVzOiBpbnQgPSAzKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gbcOgbiBow6xuaCB0cmFuZyBjaOG7pyBJbnN0YWdyYW0sIG7hur91IGtow7RuZyB0aMOsIGto4bufaSDEkeG7mW5nIGzhuqFpIGFwcAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1heF9yZXRyaWVzOiBT4buRIGzhuqduIHRo4butIHThu5FpIMSRYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3Uga2jDtG5nCiAgICAgICAgIiIiCgoKICAgICAgICByZXRyeV9jb3VudCA9IDAKICAgICAgICAKICAgICAgICB3aGlsZSByZXRyeV9jb3VudCA8IG1heF9yZXRyaWVzOgogICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyDEkWFuZyDhu58gdHJhbmcgY2jhu6cga2jDtG5nCiAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcg4bufIHRyYW5nIGNo4bunLCDEkcOzbmcgdsOgIG3hu58gbOG6oWkgYXBwCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyBwaOG6o2kgdHJhbmcgY2jhu6cgSW5zdGFncmFtLCBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAuLi4iKQogICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoc2VsZi5hcHBfcGFja2FnZSkKCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBzYWZlX3NsZWVwIHJldHVybiB2YWx1ZSDEkeG7gyBjw7MgdGjhu4MgdGhvw6F0IHPhu5ttIGtoaSBj4bqnbiByZXN0YXJ0IHNlc3Npb24KICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgyKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyBxdcOhIHRyw6xuaCBlbnN1cmVfaG9tZV9zY3JlZW4iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBzYWZlX3NsZWVwIHJldHVybiB2YWx1ZSDEkeG7gyBjw7MgdGjhu4MgdGhvw6F0IHPhu5ttIGtoaSBj4bqnbiByZXN0YXJ0IHNlc3Npb24gIAogICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDEwKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyBxdcOhIHRyw6xuaCBlbnN1cmVfaG9tZV9zY3JlZW4iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsaWYgbm90IHNlbGYudmFsaWRhdGVfYXBwX25vdF9iYW5uZWQoKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICByZXRyeV9jb3VudCArPSAxCiAgICAgICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIG3hu58gdHJhbmcgY2jhu6cgSW5zdGFncmFtIHNhdSB7bWF4X3JldHJpZXN9IGzhuqduIHRo4butIikKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHZhbGlkYXRlX2FwcF9ub3RfYmFubmVkKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIMSQ4bqjbSBi4bqjbyBraMO0bmcgY8OzIHTDoGkga2hv4bqjbiBuw6BvIGLhu4sgYmFubmVkCiAgICAgICAgIiIiCiAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgdGV4dCAiVHJhbmcgbsOgeSBoaeG7h24ga2jDtG5nIGhp4buDbiB0aOG7iyIKICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBwYWdlX25vdF9hdmFpbGFibGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICB0ZXh0PSJUcmFuZyBuw6B5IGhp4buHbiBraMO0bmcgaGnhu4NuIHRo4buLIgogICAgICAgICkKCiAgICAgICAgaWYgcGFnZV9ub3RfYXZhaWxhYmxlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJQaMOhdCBoaeG7h24gdHJhbmcga2jDtG5nIGhp4buDbiB0aOG7iywgxJFhbmcgcmVzZXQgcHJveHkgdsOgIGzDoG0gbeG7m2kiKQogICAgICAgICAgICAjIEfhu41pIHJlc2V0X2N1cnJlbnRfcHJveHkgdGjDtG5nIHF1YSBwcm94eV9zZXJ2aWNlCiAgICAgICAgICAgIGlmIHNlbGYucHJveHlfc2VydmljZToKICAgICAgICAgICAgICAgIHJlc2V0X3N1Y2Nlc3MgPSBzZWxmLnByb3h5X3NlcnZpY2UuZm9yY2VfcmVzZXRfY3VycmVudF9pcCgpCiAgICAgICAgICAgICAgICBpZiByZXNldF9zdWNjZXNzOgogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBzYWZlX3NsZWVwIHJldHVybiB2YWx1ZSDEkeG7gyBjw7MgdGjhu4MgdGhvw6F0IHPhu5ttCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgyKToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTmjhuq1uIMSRxrDhu6NjIHnDqnUgY+G6p3UgZOG7q25nIHRyb25nIHZhbGlkYXRlX2FwcF9ub3RfYmFubmVkIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHbDoCBi4bqlbSB2w6BvIG7DunQgIkzDoG0gbeG7m2kiCiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0PSJMw6BtIG3hu5tpIgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiByZWZyZXNoX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHJlZnJlc2hfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgc2FmZV9zbGVlcCByZXR1cm4gdmFsdWUgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDMpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTmjhuq1uIMSRxrDhu6NjIHnDqnUgY+G6p3UgZOG7q25nIHRyb25nIHZhbGlkYXRlX2FwcF9ub3RfYmFubmVkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIGLhuqVtIG7DunQgbMOgbSBt4bubaSBzYXUga2hpIHJlc2V0IHByb3h5IikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCAnTMOgbSBt4bubaSciKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiUmVzZXQgcHJveHkgdGjhuqV0IGLhuqFpIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIlByb3h5IHNlcnZpY2UgY2jGsGEgxJHGsOG7o2MgdGhp4bq/dCBs4bqtcCIpCgogICAgICAgICMgS2nhu4NtIHRyYSBkaWFsb2cgY+G6o25oIGLDoW8KICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBhbGVydF9jb250YWluZXIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2lnZHNfYWxlcnRfZGlhbG9nX3RleHRfY29udGFpbmVyIgogICAgICAgICkKICAgICAgICAKICAgICAgICAjS2nhu4NtIHRyYSBjw7MgdGjDtG5nIGLDoW8gdGjhu6kgbOG6oWkgc2F1LgogICAgICAgIGlmIGFsZXJ0X2NvbnRhaW5lcjoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHRpw6p1IMSR4buBIGRpYWxvZwogICAgICAgICAgICBoZWFkbGluZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9pZ2RzX2FsZXJ0X2RpYWxvZ19oZWFkbGluZSIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaGVhZGxpbmUgYW5kIHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoaGVhZGxpbmUpID09ICJUaOG7rSBs4bqhaSBzYXUiOgogICAgICAgICAgICAgICAgIyBM4bqleSBu4buZaSBkdW5nIGPhuqNuaCBiw6FvCiAgICAgICAgICAgICAgICBzdWJ0ZXh0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvaWdkc19hbGVydF9kaWFsb2dfc3VidGV4dCIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgc3VidGV4dDoKICAgICAgICAgICAgICAgICAgICB3YXJuaW5nX21lc3NhZ2UgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHN1YnRleHQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBkYW5oIHPDoWNoIGPhuqNuaCBiw6FvIGhp4buHbiB04bqhaSB04burIGRiCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF93YXJuaW5ncyA9IHNlbGYuZGIuZ2V0KCJsb2dzLXdhcm5pbmctbWVzc2FnZSIsIFtdKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVGjDqm0gY+G6o25oIGLDoW8gbeG7m2kKICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dhcm5pbmdzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICJ0aW1lIjogZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkuaXNvZm9ybWF0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICJtZXNzIjogd2FybmluZ19tZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENo4buJIGdp4buvIGzhuqFpIHThu5FpIMSRYSAyMCBsb2cgZ+G6p24gbmjhuqV0CiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGN1cnJlbnRfd2FybmluZ3MpID4gMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfd2FybmluZ3MgPSBjdXJyZW50X3dhcm5pbmdzWy0yMDpdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBMxrB1IGzhuqFpIHbDoG8gZGIKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgibG9ncy13YXJuaW5nLW1lc3NhZ2UiLCBjdXJyZW50X3dhcm5pbmdzKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLEkMOjIGzGsHUgY+G6o25oIGLDoW86IHt3YXJuaW5nX21lc3NhZ2V9IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIELhuqVtIG7DunQgT0sgbGnDqm4gdOG7pWMgY2hvIMSR4bq/biBraGkga2jDtG5nIGPDsm4gZGlhbG9nCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZGlzbWlzc19hbGxfZGlhbG9ncygpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgCiAgICAgICAgI0tp4buDbSB0cmEgeGVtIGPDsyB0aMO0bmcgYsOhbyBwaOG6o2kgxJHEg25nIG5o4bqtcCBraMO0bmcKICAgICAgICAjIEtp4buDbSB0cmEgY29udGFpbmVyIGJsb2tzCiAgICAgICAgYmxva3NfY29udGFpbmVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9ibG9rc19jb250YWluZXIiCiAgICAgICAgKQogICAgICAgIAogICAgICAgIGlmIGJsb2tzX2NvbnRhaW5lcjoKICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgY8OhYyB2aWV3IHRyb25nIGNvbnRhaW5lcgogICAgICAgICAgICB2aWV3cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLnZpZXcuVmlldyIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB2aWV3IMSR4bqndSB0acOqbiBjw7MgdGV4dCBraMOhYyBudWxsCiAgICAgICAgICAgIHdhcm5pbmdfdGV4dCA9IE5vbmUKICAgICAgICAgICAgZm9yIHZpZXcgaW4gdmlld3M6CiAgICAgICAgICAgICAgICB0ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh2aWV3KQogICAgICAgICAgICAgICAgaWYgdGV4dCBhbmQgdGV4dC5zdHJpcCgpIGFuZCB0ZXh0ICE9ICJudWxsIiBhbmQgdGV4dCAhPSAiICIgYW5kIGxlbih0ZXh0LnN0cmlwKCkpID4gMTA6CiAgICAgICAgICAgICAgICAgICAgd2FybmluZ190ZXh0ID0gdGV4dAogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB3YXJuaW5nX3RleHQ6IAogICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGxvZ291dCB2w6AgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyBCxrDhu5tjIDE6IELhuqVtIHbDoG8gbWVudQogICAgICAgICAgICAgICAgICAgIG1lbnVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9Ik1lbnUiKQogICAgICAgICAgICAgICAgICAgIGlmIG1lbnVfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIobWVudV9idXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBCxrDhu5tjIDI6IMSQ4buNYyBs4bqhaSBYTUwgdsOgIHTDrG0gdGV4dCAixJDEg25nIHh14bqldCBraOG7j2kiCiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVfeG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWVudV94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3cyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChtZW51X3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXciKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dvdXRfdmlldyA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgdmlldyBpbiB2aWV3czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3X3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHZpZXcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdmlld190ZXh0IGFuZCB2aWV3X3RleHQuc3RhcnRzd2l0aCgixJDEg25nIHh14bqldCBraOG7j2kiKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nb3V0X3ZpZXcgPSB2aWV3CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6r3QgYuG7jyAixJDEg25nIHh14bqldCBraOG7j2kiIHbDoCB0cmltIMSR4buDIGzhuqV5IHVzZXJuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gdmlld190ZXh0LnJlcGxhY2UoIsSQxINuZyB4deG6pXQga2jhu49pIiwgIiIpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG9nb3V0X3ZpZXcgYW5kIHVzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQsaw4bubYyAzOiBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSBhY2NvdW50IHRyb25nIGRhdGFiYXNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF90aW1lID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVkLyVtLyV5ICVIOiVNIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmFjdGl2ZV9yZWFzb24gPSBmIlBow6F0IGhp4buHbiB5w6p1IGPhuqd1IHjDoWMgbWluaCBsw7pjOiB7Y3VycmVudF90aW1lfSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gdMOgaSBraG/huqNuIHRoZW8gdW5pcXVlX3VzZXJuYW1lIHbDoCBj4bqtcCBuaOG6rXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD0iaW5zdGFncmFtIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpID09IHVzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJsb2dvdXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9yZWFzb24iOiBpbmFjdGl2ZV9yZWFzb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLEkMOjIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9OiB7aW5hY3RpdmVfcmVhc29ufSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQsaw4bubYyA0OiBC4bqlbSB2w6BvICLEkMSDbmcgeHXhuqV0IGto4buPaSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIobG9nb3V0X3ZpZXcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBCxrDhu5tjIDU6IFjDoWMgbmjhuq1uIMSRxINuZyB4deG6pXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29uZmlybV94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1fYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1feG1sLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dD0ixJDEg25nIHh14bqldCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjb25maXJtX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjb25maXJtX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNSkgICMgQ2jhu50gNSBnacOieSBob8OgbiB04bqldCBsb2dvdXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyDEkcSDbmcgeHXhuqV0IGto4buPaSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBtZW51IMSRxINuZyB4deG6pXQiKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyDEkeG7jWMgWE1MIG1lbnUiKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBNZW51IikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBsb2dvdXQ6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrOiDEkcOzbmcgYXBwIG7hur91IGtow7RuZyBsb2dvdXQgxJHGsOG7o2MKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoc2VsZi5hcHBfcGFja2FnZSkKCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICByZXR1cm4gVHJ1ZQogICAgCiAgICBkZWYgX2hhbmRsZV9kaWFsb2dzX2FuZF9uYXZpZ2F0ZV9ob21lKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIE92ZXJyaWRlIMSR4buDIHjhu60gbMO9IGRpYWxvZyBzcGVjaWZpYyBj4bunYSBJbnN0YWdyYW0gdsOgIG5hdmlnYXRlIHbhu4EgaG9tZQogICAgICAgICIiIgogICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCLEkGFuZyB44butIGzDvSBJbnN0YWdyYW0gZGlhbG9ncyB2w6AgbmF2aWdhdGUgduG7gSBob21lLi4uIikKICAgICAgICAKICAgICAgICAjIFjhu60gbMO9IGPDoWMgZGlhbG9nIEluc3RhZ3JhbSBzcGVjaWZpYwogICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBkaWFsb2cgIlRo4butIGzhuqFpIHNhdSIKICAgICAgICBhbGVydF9jb250YWluZXIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2lnZHNfYWxlcnRfZGlhbG9nX3RleHRfY29udGFpbmVyIgogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiBhbGVydF9jb250YWluZXI6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw7NuZyBkaWFsb2cgSW5zdGFncmFtIGFsZXJ0IikKICAgICAgICAgICAgc2VsZi5fZGlzbWlzc19hbGxfZGlhbG9ncygpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBjb250YWluZXIgYmxva3MgKGPhuqNuaCBiw6FvIGtow6FjKQogICAgICAgIGJsb2tzX2NvbnRhaW5lciA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYmxva3NfY29udGFpbmVyIgogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiBibG9rc19jb250YWluZXI6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw7NuZyBJbnN0YWdyYW0gYmxva3MgZGlhbG9nIikKICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgIAogICAgICAgICMgU2F1IGtoaSB44butIGzDvSBkaWFsb2csIHRo4butIG5hdmlnYXRlIHbhu4EgaG9tZQogICAgICAgIGlmIG5vdCBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICMgVMOsbSBuw7p0ICJUcmFuZyBjaOG7pyIKICAgICAgICAgICAgaG9tZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJUcmFuZyBjaOG7pyIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBob21lX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuqVtIG7DunQgVHJhbmcgY2jhu6ciKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEZhbGxiYWNrOiBuaOG6pW4gYmFjayBt4buZdCB2w6BpIGzhuqduCiAgICAgICAgICAgICAgICBmb3IgXyBpbiByYW5nZSgzKToKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAKICAgIGRlZiBnZXRfYWNjb3VudHNfZnJvbV9kZXZpY2Uoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gSW5zdGFncmFtIHThu6sgdGhp4bq/dCBi4buLIiIiCiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunIEluc3RhZ3JhbQogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVuIHbDoG8gdGFiICJUcmFuZyBjw6EgbmjDom4iCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICBwcm9maWxlX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJUcmFuZyBjw6EgbmjDom4iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHByb2ZpbGVfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSB0YWIgVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVwIHbDoG8gdGFiIFRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocHJvZmlsZV90YWIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIHTDoGkga2hv4bqjbiBoaeG7h24gdOG6oWkgdOG7qyB0cmFuZyBjw6EgbmjDom4KICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gdXNlcm5hbWUgdOG7qyB0acOqdSDEkeG7gSBs4bubbiB0cm9uZyBhY3Rpb24gYmFyCiAgICAgICAgICAgIHVzZXJuYW1lX3RpdGxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX2xhcmdlX3RpdGxlX2F1dG9fc2l6ZSIKICAgICAgICAgICAgKQogICAgICAgICAgICBpZiBub3QgdXNlcm5hbWVfdGl0bGU6CiAgICAgICAgICAgICAgICB1c2VybmFtZV90aXRsZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfdGl0bGUiCiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX3RpdGxlOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICB1c2VybmFtZV90aXRsZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX2xhcmdlX3RpdGxlX2F1dG9fc2l6ZSIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHVzZXJuYW1lX3RpdGxlOgogICAgICAgICAgICAgICAgY3VycmVudF91c2VybmFtZSA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodXNlcm5hbWVfdGl0bGUpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgdXNlcm5hbWUgaGnhu4duIHThuqFpIHThu6sgdGnDqnUgxJHhu4E6IHtjdXJyZW50X3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmjhuqVwIHbDoG8gdGnDqnUgxJHhu4EgdXNlcm5hbWUgxJHhu4MgbeG7nyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHVzZXJuYW1lX3RpdGxlKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gLSDEkeG7jWMgbOG6p24gMQogICAgICAgICAgICAgICAgYWNjb3VudHNfeG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSBWaWV3R3JvdXAgY8OzIGNvbnRlbnQtZGVzYyAobMOgIHVzZXJuYW1lKQogICAgICAgICAgICAgICAgYWNjb3VudF9pdGVtcyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgICAgICAgICBhY2NvdW50c194bWwsCiAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXdHcm91cCIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBY4butIGzDvSB0w6BpIGtob+G6o24gbOG6p24gMQogICAgICAgICAgICAgICAgc2VsZi5fcHJvY2Vzc19hY2NvdW50X2l0ZW1zKGFjY291bnRfaXRlbXMsIGFjY291bnRzX3htbCwgYWNjb3VudHMpCgogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7Mgbmhp4buBdSBoxqFuIDYgdMOgaSBraG/huqNuLCB2deG7kXQgbMOqbiB2w6AgxJHhu41jIHRp4bq/cAogICAgICAgICAgICAgICAgaWYgbGVuKGFjY291bnRzKSA+IDY6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHtsZW4oYWNjb3VudHMpfSB0w6BpIGtob+G6o24sIHZ14buRdCBsw6puIMSR4buDIHTDrG0gdGjDqm0iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIGzhuqduIDIgc2F1IGtoaSB2deG7kXQKICAgICAgICAgICAgICAgICAgICBhY2NvdW50c194bWxfMiA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9pdGVtc18yID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50c194bWxfMiwKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXdHcm91cCIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBY4butIGzDvSB0w6BpIGtob+G6o24gbOG6p24gMgogICAgICAgICAgICAgICAgICAgIGFjY291bnRzX2JlZm9yZV8ybmQgPSBsZW4oYWNjb3VudHMpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcHJvY2Vzc19hY2NvdW50X2l0ZW1zKGFjY291bnRfaXRlbXNfMiwgYWNjb3VudHNfeG1sXzIsIGFjY291bnRzKQogICAgICAgICAgICAgICAgICAgIGFjY291bnRzX2FkZGVkID0gbGVuKGFjY291bnRzKSAtIGFjY291bnRzX2JlZm9yZV8ybmQKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTOG6p24gxJHhu41jIHRo4bupIDIgdMOsbSB0aMOqbSB7YWNjb3VudHNfYWRkZWR9IHTDoGkga2hv4bqjbiIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJDaOG7iSBjw7Mge2xlbihhY2NvdW50cyl9IHTDoGkga2hv4bqjbiwga2jDtG5nIGPhuqduIHZ14buRdCB0aMOqbSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmjhuqVuIGJhY2sgxJHhu4MgxJHDs25nIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBRdWF5IGzhuqFpIHRyYW5nIGNo4bunIGLhurFuZyBwaMawxqFuZyB0aOG7qWMgYmFja190b19ob21lCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gSW5zdGFncmFtIikKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGFjY291bnRzCiAgICAKICAgIGRlZiBfcHJvY2Vzc19hY2NvdW50X2l0ZW1zKHNlbGYsIGFjY291bnRfaXRlbXM6IExpc3QsIGFjY291bnRzX3htbDogc3RyLCBhY2NvdW50czogTGlzdFtEaWN0W3N0ciwgQW55XV0pIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gZGFuaCBzw6FjaCBhY2NvdW50IGl0ZW1zIHbDoCB0aMOqbSB2w6BvIGFjY291bnRzIGxpc3QKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50X2l0ZW1zOiBEYW5oIHPDoWNoIFZpZXdHcm91cCBlbGVtZW50cwogICAgICAgICAgICBhY2NvdW50c194bWw6IFhNTCBj4bunYSBtw6BuIGjDrG5oIGNo4bupYSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICBhY2NvdW50czogTGlzdCDEkeG7gyB0aMOqbSB0w6BpIGtob+G6o24gdsOgbwogICAgICAgICIiIgogICAgICAgICMgVOG6oW8gc2V0IMSR4buDIHRyw6FuaCBkdXBsaWNhdGUgdXNlcm5hbWUKICAgICAgICBleGlzdGluZ191c2VybmFtZXMgPSB7YWNjLmdldCgidW5pcXVlX3VzZXJuYW1lIiwgIiIpLmxvd2VyKCkgZm9yIGFjYyBpbiBhY2NvdW50c30KICAgICAgICAKICAgICAgICAjIEzhu41jIHbDoCB44butIGzDvSBjw6FjIG3hu6VjIHTDoGkga2hv4bqjbgogICAgICAgIGZvciBpdGVtIGluIGFjY291bnRfaXRlbXM6CiAgICAgICAgICAgICMgTOG6pXkgY29udGVudC1kZXNjIGPhu6dhIGl0ZW0KICAgICAgICAgICAgY29udGVudF9kZXNjID0gaXRlbS5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICBpZiBub3QgY29udGVudF9kZXNjIG9yIGNvbnRlbnRfZGVzYyA9PSAibnVsbCI6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDonkgY8OzIHBo4bqjaSBsw6AgbsO6dCAixJBpIMSR4bq/biBUcnVuZyB0w6JtIHTDoGkga2hv4bqjbiIga2jDtG5nCiAgICAgICAgICAgIGlmICJUcnVuZyB0w6JtIHTDoGkga2hv4bqjbiIgaW4gY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIELhu48gcXVhIG7DunQgIlRow6ptIHTDoGkga2hv4bqjbiIgCiAgICAgICAgICAgIGlmICJUaMOqbSB0w6BpIGtob+G6o24iIGluIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFjhu60gbMO9IHRyxrDhu51uZyBo4bujcCBjw7MgdGjDtG5nIGLDoW8gdHJvbmcgY29udGVudC1kZXNjICh2ZDogInVzZXJuYW1lLCAxMCB0aMO0bmcgYsOhbyIpCiAgICAgICAgICAgIHVzZXJuYW1lID0gY29udGVudF9kZXNjCiAgICAgICAgICAgIGlmICIsIiBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGNvbnRlbnRfZGVzYy5zcGxpdCgiLCIpWzBdLnN0cmlwKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUGjGsMahbmcgcGjDoXAgMjogVMOsbSB0cuG7sWMgdGnhur9wIHRyb25nIGPDoWMgdmlldyBjb24KICAgICAgICAgICAgY2hpbGRfdmlld3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICBhY2NvdW50c194bWwsCiAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLnZpZXcuVmlldyIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBib3VuZHMgY+G7p2EgaXRlbSBoaeG7h24gdOG6oWkgxJHhu4MgdMOsbSB2aWV3IGNvbiB0aHXhu5ljIHbhu4EgbsOzCiAgICAgICAgICAgIGl0ZW1fYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKGl0ZW0pCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgdmlldyBpbiBjaGlsZF92aWV3czoKICAgICAgICAgICAgICAgIHZpZXdfYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKHZpZXcpCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHZpZXcgY8OzIG7hurFtIHRyb25nIGl0ZW0ga2jDtG5nCiAgICAgICAgICAgICAgICBpZiAodmlld19ib3VuZHNbMF0gPj0gaXRlbV9ib3VuZHNbMF0gYW5kIAogICAgICAgICAgICAgICAgICAgIHZpZXdfYm91bmRzWzFdID49IGl0ZW1fYm91bmRzWzFdIGFuZCAKICAgICAgICAgICAgICAgICAgICB2aWV3X2JvdW5kc1syXSA8PSBpdGVtX2JvdW5kc1syXSBhbmQgCiAgICAgICAgICAgICAgICAgICAgdmlld19ib3VuZHNbM10gPD0gaXRlbV9ib3VuZHNbM10pOgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHZpZXdfdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodmlldykKICAgICAgICAgICAgICAgICAgICBpZiB2aWV3X3RleHQgYW5kICJ0aMO0bmcgYsOhbyIgbm90IGluIHZpZXdfdGV4dC5sb3dlcigpOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gdGjhuqV5IHZpZXcgY29uIGNo4bupYSB0w6puIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHZpZXdfdGV4dAogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGR1cGxpY2F0ZSB1c2VybmFtZQogICAgICAgICAgICBpZiB1c2VybmFtZS5sb3dlcigpIGluIGV4aXN0aW5nX3VzZXJuYW1lczoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSB0w6BpIGtob+G6o24gbsOgeSBjw7MgxJFhbmcgxJHGsOG7o2MgY2jhu41uIGtow7RuZwogICAgICAgICAgICBpc19zZWxlY3RlZCA9IGl0ZW0uZ2V0KCJzZWxlY3RlZCIpID09ICJ0cnVlIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyB0aMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBhY2NvdW50ID0gewogICAgICAgICAgICAgICAgIm5pY2tuYW1lIjogIiIsCiAgICAgICAgICAgICAgICAidW5pcXVlX3VzZXJuYW1lIjogdXNlcm5hbWUsCiAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogIiIsCiAgICAgICAgICAgICAgICAic3RhdHVzIjogImFjdGl2ZSIsCiAgICAgICAgICAgICAgICAiaXNfbG9naW4iOiBpc19zZWxlY3RlZCwKICAgICAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiAiIiwKICAgICAgICAgICAgICAgICJqb2JfZW5hYmxlIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJsZXZlbCI6IDMsCiAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGFjY291bnRzLmFwcGVuZChhY2NvdW50KQogICAgICAgICAgICBleGlzdGluZ191c2VybmFtZXMuYWRkKHVzZXJuYW1lLmxvd2VyKCkpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiBJbnN0YWdyYW06IHt1c2VybmFtZX0gKHNlbGVjdGVkOiB7aXNfc2VsZWN0ZWR9KSIpCiAgICAKICAgIGRlZiBfZGlzbWlzc19hbGxfZGlhbG9ncyhzZWxmLCBtYXhfYXR0ZW1wdHM6IGludCA9IDUpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgQuG6pW0gbsO6dCBPSyBsacOqbiB04bulYyBjaG8gxJHhur9uIGtoaSBraMO0bmcgY8OybiBkaWFsb2cgbsOgbwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1heF9hdHRlbXB0czogU+G7kSBs4bqnbiB0aOG7rSB04buRaSDEkWEKICAgICAgICAiIiIKICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfYXR0ZW1wdHMpOgogICAgICAgICAgICAjIEzhuqV5IGzhuqFpIFhNTCDEkeG7gyB0w6xtIG7DunQgT0sKICAgICAgICAgICAgY3VycmVudF94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICBpZiBub3QgY3VycmVudF94bWw6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIG9rX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICBjdXJyZW50X3htbCwKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvaWdkc19hbGVydF9kaWFsb2dfcHJpbWFyeV9idXR0b24iCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG9rX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihva19idXR0b24pCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGLhuqVtIE9LIGzhuqduIHthdHRlbXB0ICsgMX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBLaMO0bmcgY8OybiBuw7p0IE9LLCB0aG/DoXQgdsOybmcgbOG6t3AKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgxJHDs25nIGjhur90IGRpYWxvZyIpCiAgICAgICAgICAgICAgICBicmVhawogICAgCiAgICBkZWYgYmFja190b19ob21lKHNlbGYsIG1heF9iYWNrX2NvdW50OiBpbnQgPSA1LCBtYXhfcmV0cmllczogaW50ID0gMSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBRdWF5IGzhuqFpIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgSW5zdGFncmFtCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbWF4X2JhY2tfY291bnQ6IFPhu5EgbOG6p24gbmjhuqVuIEJhY2sgdOG7kWkgxJFhIHRyxrDhu5tjIGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAKICAgICAgICAgICAgbWF4X3JldHJpZXM6IFPhu5EgbOG6p24gdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgYXBwIHThu5FpIMSRYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3Uga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIOG7nyB0cmFuZyBjaOG7pyBjaMawYQogICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJBhbmcgdMOsbSBjw6FjaCBxdWF5IHbhu4EgdHJhbmcgY2jhu6cgSW5zdGFncmFtLi4uIikKICAgICAgICAKICAgICAgICAjIFRo4butIGzhuqFpIHRvw6BuIGLhu5kgcXXDoSB0csOsbmggdOG7kWkgxJFhIG1heF9yZXRyaWVzIGzhuqduCiAgICAgICAgZm9yIHJldHJ5IGluIHJhbmdlKG1heF9yZXRyaWVzKToKICAgICAgICAgICAgIyBUaOG7rSBi4bqlbSBuw7p0IGJhY2sgdOG7kWkgxJFhIG1heF9iYWNrX2NvdW50IGzhuqduCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKG1heF9iYWNrX2NvdW50KToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgc2FmZV9zbGVlcCByZXR1cm4gdmFsdWUgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbQogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgxKToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJOaOG6rW4gxJHGsOG7o2MgecOqdSBj4bqndSBk4burbmcgdHJvbmcgcXXDoSB0csOsbmggYmFja190b19ob21lIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIHbhu4EgdHJhbmcgY2jhu6cgY2jGsGEKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cgc2F1IHtpKzF9IGzhuqduIGLhuqVtIGJhY2sgKGzhuqduIHRo4butIHtyZXRyeSsxfSkiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IHbhuqtuIGtow7RuZyB24buBIMSRxrDhu6NjIHRyYW5nIGNo4bunLCBraWxsIGFwcCB2w6AgbeG7nyBs4bqhaQogICAgICAgICAgICBpZiByZXRyeSA8IG1heF9yZXRyaWVzIC0gMTogICMgQ2jhu4kgbG9nIGPhuqNuaCBiw6FvIG7hur91IGPDsm4gbOG6p24gdGjhu60gdGnhur9wIHRoZW8KICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdGjhu4MgduG7gSB0cmFuZyBjaOG7pyBzYXUge21heF9iYWNrX2NvdW50fSBs4bqnbiBi4bqlbSBiYWNrLCB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAgKGzhuqduIHRo4butIHtyZXRyeSsxfS97bWF4X3JldHJpZXN9KS4uLiIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyB24buBIHRyYW5nIGNo4bunIHNhdSB7bWF4X2JhY2tfY291bnR9IGzhuqduIGLhuqVtIGJhY2sgKGzhuqduIHRo4butIGN14buRaSB7cmV0cnkrMX0ve21heF9yZXRyaWVzfSkuLi4iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcChzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHNhZmVfc2xlZXAgcmV0dXJuIHZhbHVlIMSR4buDIGPDsyB0aOG7gyB0aG/DoXQgc+G7m20KICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCgyKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyBxdcOhIHRyw6xuaCBiYWNrX3RvX2hvbWUiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBzYWZlX3NsZWVwIHJldHVybiB2YWx1ZSDEkeG7gyBjw7MgdGjhu4MgdGhvw6F0IHPhu5ttICAKICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCg1KToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGThu6tuZyB0cm9uZyBxdcOhIHRyw6xuaCBiYWNrX3RvX2hvbWUiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgICAgICBpZiBub3Qgc2VsZi52YWxpZGF0ZV9hcHBfbm90X2Jhbm5lZCgpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgeGVtIGPDsyDhu58gdHJhbmcgY2jhu6cga2jDtG5nCiAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHF1YXkgduG7gSB0cmFuZyBjaOG7pyBzYXUga2hpIGto4bufaSDEkeG7mW5nIGzhuqFpIGFwcCAobOG6p24gdGjhu60ge3JldHJ5KzF9KSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIHbhu4EgdHJhbmcgY2jhu6cgbmdheSBj4bqjIHNhdSB7bWF4X3JldHJpZXN9IGzhuqduIHRo4butIGto4bufaSDEkeG7mW5nIGzhuqFpIGFwcCIpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIAoKICAgIAogICAgZGVmIG1hcF9nb2xpa2VfYWNjb3VudHMoc2VsZiwgZ29saWtlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSwgZGV2aWNlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgw4FuaCB44bqhIHTDoGkga2hv4bqjbiB04burIEdvTGlrZSB2w6BvIHTDoGkga2hv4bqjbiB0csOqbiB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBnb2xpa2VfYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuIHThu6sgR29MaWtlIEFQSQogICAgICAgICAgICBkZXZpY2VfYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHDoyDDoW5oIHjhuqEKICAgICAgICAiIiIKICAgICAgICBtYXBwZWRfYWNjb3VudHMgPSBbXQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaHXhuqluIGjDs2EgZOG7ryBsaeG7h3UgdOG7qyBHb0xpa2UKICAgICAgICAgICAgZ29saWtlX2RhdGEgPSB7fQogICAgICAgICAgICBmb3IgYWNjIGluIGdvbGlrZV9hY2NvdW50czoKICAgICAgICAgICAgICAgICMgVHLDrWNoIHh14bqldCB0aMO0bmcgdGluIHThu6sgdMOgaSBraG/huqNuIEdvTGlrZQogICAgICAgICAgICAgICAgZ29saWtlX2FjY291bnQgPSB7CiAgICAgICAgICAgICAgICAgICAgImdvbGlrZV9pZCI6IGFjYy5nZXQoImlkIiksCiAgICAgICAgICAgICAgICAgICAgIm5pY2tuYW1lIjogYWNjLmdldCgiaW5zdGFncmFtX2Z1bGxfbmFtZSIpIG9yIGFjYy5nZXQoImluc3RhZ3JhbV91c2VybmFtZSIpLAogICAgICAgICAgICAgICAgICAgICJ1bmlxdWVfaWQiOiBhY2MuZ2V0KCJpbnN0YWdyYW1faWQiKSwKICAgICAgICAgICAgICAgICAgICAidW5pcXVlX3VzZXJuYW1lIjogYWNjLmdldCgiaW5zdGFncmFtX3VzZXJuYW1lIiksCiAgICAgICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6IGFjYy5nZXQoInByb2ZpbGVfcGljX3VybCIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU+G7rSBk4bulbmcgdW5pcXVlX3VzZXJuYW1lIGzDoG0ga2jDs2EgxJHhu4MgZOG7hSDDoW5oIHjhuqEKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gZ29saWtlX2FjY291bnRbInVuaXF1ZV91c2VybmFtZSJdCiAgICAgICAgICAgICAgICBpZiB1c2VybmFtZToKICAgICAgICAgICAgICAgICAgICBnb2xpa2VfZGF0YVt1c2VybmFtZS5sb3dlcigpXSA9IGdvbGlrZV9hY2NvdW50CiAgICAgICAgICAgIAogICAgICAgICAgICAjIMOBbmggeOG6oSB24bubaSB0w6BpIGtob+G6o24gdHLDqm4gdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGZvciBkZXZpY2VfYWNjb3VudCBpbiBkZXZpY2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGRldmljZV9hY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUgaW4gZ29saWtlX2RhdGE6CiAgICAgICAgICAgICAgICAgICAgIyDEkMOjIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB0cm9uZyBkYW5oIHPDoWNoIEdvTGlrZQogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdOG7qyBHb0xpa2UgdsOgbyB0w6BpIGtob+G6o24gdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICAgICAgZ29saWtlX2luZm8gPSBnb2xpa2VfZGF0YVt1c2VybmFtZV0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJnb2xpa2VfaWQiOiBnb2xpa2VfaW5mb1siZ29saWtlX2lkIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICJpc19nb2xpa2VfbGlua2VkIjogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6IGdvbGlrZV9pbmZvWyJhdmF0YXJfdGh1bWIiXSBvciBkZXZpY2VfYWNjb3VudC5nZXQoImF2YXRhcl90aHVtYiIsICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV9pZCI6IGdvbGlrZV9pbmZvWyJ1bmlxdWVfaWQiXSBvciBkZXZpY2VfYWNjb3VudC5nZXQoInVuaXF1ZV9pZCIsICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgIm5pY2tuYW1lIjogZ29saWtlX2luZm9bIm5pY2tuYW1lIl0gb3IgZGV2aWNlX2FjY291bnQuZ2V0KCJuaWNrbmFtZSIsICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFTDrG0gSUQgdMOgaSBraG/huqNuIHRyb25nIERCCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9pZCA9IGRldmljZV9hY2NvdW50LmdldCgiaWQiKQogICAgICAgICAgICAgICAgICAgIGlmIGFjY291bnRfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHbDoG8gREIKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdsOgbyBkZXZpY2VfYWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfYWNjb3VudC51cGRhdGUodXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBlZF9hY2NvdW50cy5hcHBlbmQoZGV2aWNlX2FjY291bnQpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyDDoW5oIHjhuqEgdMOgaSBraG/huqNuIEluc3RhZ3JhbToge3VzZXJuYW1lfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gbWFwcGVkX2FjY291bnRzCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMOhbmggeOG6oSB0w6BpIGtob+G6o24gSW5zdGFncmFtIikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICBkZWYgZ2V0X3JlcG9ydF9wYXlsb2FkKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBU4bqhbyBwYXlsb2FkIGNobyB2aeG7h2MgYsOhbyBjw6FvIGhvw6BuIHRow6BuaCBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBQYXlsb2FkIGNobyBBUEkgYsOhbyBjw6FvCiAgICAgICAgIiIiCiAgICAgICAgZ29saWtlX2lkID0gYWNjb3VudC5nZXQoImdvbGlrZV9pZCIpCiAgICAgICAgam9iX2lkID0gam9iLmdldCgiaWQiKQogICAgICAgIAogICAgICAgIGlmIG5vdCBnb2xpa2VfaWQgb3Igbm90IGpvYl9pZDoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIlRoaeG6v3UgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24gaG/hurdjIGpvYiDEkeG7gyB04bqhbyBwYXlsb2FkIGLDoW8gY8OhbyIpCiAgICAgICAgICAgIHJldHVybiB7fQogICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJpbnN0YWdyYW1fdXNlcnNfYWR2ZXJ0aXNpbmdfaWQiOiBqb2JfaWQsCiAgICAgICAgICAgICJpbnN0YWdyYW1fYWNjb3VudF9pZCI6IGdvbGlrZV9pZCwKICAgICAgICAgICAgImFzeW5jIjogVHJ1ZSwKICAgICAgICAgICAgImRhdGEiOiBOb25lCiAgICAgICAgfSAgICAKICAgICAgICAgIAogICAgCiAgICAKICAgIGRlZiBleGVjdXRlX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIGpvYiwgYmFvIGfhu5NtOgogICAgICAgICAgICAgICAgLSBzdGF0dXMgKGludCk6IE3DoyB0cuG6oW5nIHRow6FpIGpvYgogICAgICAgICAgICAgICAgICAgIDA6IENoxrBhIHRo4buxYyBoaeG7h24KICAgICAgICAgICAgICAgICAgICAxOiBUaMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICAyOiBUaOG6pXQgYuG6oWksIGtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcKICAgICAgICAgICAgICAgICAgICAzOiBUaOG6pXQgYuG6oWksIMSRw6MgYuG7iyB1bmZvbGxvdy91bmxpa2UKICAgICAgICAgICAgICAgICAgICA0OiBUaOG6pXQgYuG6oWksIHnDqnUgY+G6p3UgxJFhbmcgY2jhu50KICAgICAgICAgICAgICAgIC0gbWVzc2FnZSAoc3RyKTogVGjDtG5nIGLDoW8ga+G6v3QgcXXhuqMKICAgICAgICAgICAgICAgIC0gc3VjY2VzcyAoYm9vbCk6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGpvYl90eXBlID0gam9iLmdldCgidHlwZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIGpvYl9saW5rID0gam9iLmdldCgibGluayIsICIiKQogICAgICAgICAgICBqb2JfaWQgPSBqb2IuZ2V0KCJpZCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgdGjhu7FjIGhp4buHbiBqb2Ige2pvYl9pZH0gbG/huqFpIHtqb2JfdHlwZX0gduG7m2kgbGluayB7am9iX2xpbmt9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBsb+G6oWkgam9iIMSRxrDhu6NjIGjhu5cgdHLhu6MKICAgICAgICAgICAgaWYgam9iX3R5cGUgbm90IGluIFsiZm9sbG93IiwgImxpa2UiXToKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBmIkxv4bqhaSBqb2Ige2pvYl90eXBlfSBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7oyIKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IDIsCiAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBqb2IgdGhlbyBsb+G6oWkKICAgICAgICAgICAgam9iX3N0YXR1cyA9IDAgICMgTeG6t2MgxJHhu4tuaCBsw6AgY2jGsGEgbMOgbQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgam9iX3R5cGUgPT0gImZvbGxvdyI6CiAgICAgICAgICAgICAgICBqb2Jfc3RhdHVzID0gc2VsZi5fcGVyZm9ybV9mb2xsb3dfam9iKGpvYl9saW5rKQogICAgICAgICAgICBlbGlmIGpvYl90eXBlID09ICJsaWtlIjoKICAgICAgICAgICAgICAgIGpvYl9zdGF0dXMgPSBzZWxmLl9wZXJmb3JtX2xpa2Vfam9iKGpvYl9saW5rKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBr4bq/dCBxdeG6oyB0cuG6oyB24buBIGThu7FhIHRyw6puIGpvYl9zdGF0dXMKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0X2Zyb21fc3RhdHVzKGpvYl9zdGF0dXMsIGpvYl90eXBlKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBtZXNzYWdlID0gZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBqb2I6IHtzdHIoZSl9IgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgbWVzc2FnZSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDIsIG1lc3NhZ2UsIEZhbHNlKQogICAgCiAgICBkZWYgX2NyZWF0ZV9qb2JfcmVzdWx0X2Zyb21fc3RhdHVzKHNlbGYsIGpvYl9zdGF0dXM6IGludCwgam9iX3R5cGU6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVOG6oW8ga+G6v3QgcXXhuqMgam9iIHThu6sgc3RhdHVzIGNvZGUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2Jfc3RhdHVzOiBNw6MgdHLhuqFuZyB0aMOhaSBqb2IgdOG7qyBfcGVyZm9ybV94eHhfam9iCiAgICAgICAgICAgIGpvYl90eXBlOiBMb+G6oWkgam9iIChmb2xsb3csIGxpa2UpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyBqb2IKICAgICAgICAiIiIKICAgICAgICBpZiBqb2Jfc3RhdHVzID09IDE6ICAjIFRow6BuaCBjw7RuZwogICAgICAgICAgICBtZXNzYWdlID0gZiLEkMOjIGhvw6BuIHRow6BuaCBqb2Ige2pvYl90eXBlfSB0aMOgbmggY8O0bmciCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8obWVzc2FnZSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDEsIG1lc3NhZ2UsIFRydWUpCiAgICAgICAgZWxpZiBqb2Jfc3RhdHVzID09IDI6ICAjIEtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcKICAgICAgICAgICAgbWVzc2FnZSA9IGYiS2jDtG5nIHRo4buDIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZyDEkeG7gyB0aOG7sWMgaGnhu4duIGpvYiB7am9iX3R5cGV9IgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCgyLCBtZXNzYWdlLCBGYWxzZSkKICAgICAgICBlbGlmIGpvYl9zdGF0dXMgPT0gMzogICMgQuG7iyB1bmZvbGxvdy91bmxpa2UKICAgICAgICAgICAgbWVzc2FnZSA9IGYixJDDoyBi4buLIHVuZm9sbG93L3VubGlrZSB0cm9uZyBqb2Ige2pvYl90eXBlfSIKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhtZXNzYWdlKQogICAgICAgICAgICAjIMSQw6FuaCBk4bqldSB1bmZvbGxvdyDEkeG7gyBKb2JTZXJ2aWNlIHjhu60gbMO9CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCgzLCBtZXNzYWdlLCBGYWxzZSwgdW5mb2xsb3c9VHJ1ZSkKICAgICAgICBlbGlmIGpvYl9zdGF0dXMgPT0gNDogICMgWcOqdSBj4bqndSDEkWFuZyBjaOG7nQogICAgICAgICAgICBtZXNzYWdlID0gZiJZw6p1IGPhuqd1IMSRYW5nIGNo4budIHRyb25nIGpvYiB7am9iX3R5cGV9IgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCg0LCBtZXNzYWdlLCBGYWxzZSkKICAgICAgICBlbGlmIGpvYl9zdGF0dXMgPT0gNTogICMgR+G7rWkgecOqdSBj4bqndSBjaOG7nSBkdXnhu4d0CiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIkfhu61pIHnDqnUgY+G6p3UgY2jhu50gZHV54buHdCB7am9iX3R5cGV9IgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCg1LCBtZXNzYWdlLCBGYWxzZSkKICAgICAgICBlbGlmIGpvYl9zdGF0dXMgPT0gNjogICMgxJDhuqF0IGdp4bubaSBo4bqhbiBob+G6t2MgYuG7iyBraMOzYQogICAgICAgICAgICBtZXNzYWdlID0gZiJKb2Ige2pvYl90eXBlfSBi4buLIGjhu6d5IGRvIMSR4bqhdCBnaeG7m2kgaOG6oW4gaG/hurdjIHTDoGkga2hv4bqjbiBi4buLIGtow7NhIgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCg2LCBtZXNzYWdlLCBGYWxzZSkKICAgICAgICBlbHNlOiAgIyBUcuG6oW5nIHRow6FpIGtow7RuZyB4w6FjIMSR4buLbmgKICAgICAgICAgICAgbWVzc2FnZSA9IGYiVHLhuqFuZyB0aMOhaSBraMO0bmcgeMOhYyDEkeG7i25oIGtoaSB0aOG7sWMgaGnhu4duIGpvYiB7am9iX3R5cGV9IChzdGF0dXM6IHtqb2Jfc3RhdHVzfSkiCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfam9iX3Jlc3VsdCgwLCBtZXNzYWdlLCBGYWxzZSkKICAgIAogICAgZGVmIF9wZXJmb3JtX2ZvbGxvd19qb2Ioc2VsZiwgcHJvZmlsZV9saW5rOiBzdHIpIC0+IGludDoKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGpvYiBmb2xsb3cgdHLDqm4gSW5zdGFncmFtCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJvZmlsZV9saW5rOiBMaW5rIMSR4bq/biB0cmFuZyBjw6EgbmjDom4gY+G6p24gZm9sbG93CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGludDogVHLhuqFuZyB0aMOhaSBqb2IgKDA6IGNoxrBhIGzDoG0sIDE6IGhvw6BuIHRow6BuaCwgMjogbOG7l2ksIDM6IGLhu4sgdW5mb2xsb3cpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVHLDrWNoIHh14bqldCB1c2VybmFtZSB04burIFVSTAogICAgICAgICAgICBpbXBvcnQgcmUKICAgICAgICAgICAgaW1wb3J0IHJhbmRvbQogICAgICAgICAgICB1c2VybmFtZV9tYXRjaCA9IHJlLnNlYXJjaChyJ2luc3RhZ3JhbVwuY29tLyhbXi9dKyknLCBwcm9maWxlX2xpbmspCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV9tYXRjaDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIHRyw61jaCB4deG6pXQgdXNlcm5hbWUgdOG7qyBsaW5rOiB7cHJvZmlsZV9saW5rfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHVzZXJuYW1lID0gdXNlcm5hbWVfbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmFuZG9tIGNo4buNbiAxIHRyb25nIDIgY8OhY2g6IHTDrG0ga2nhur9tIGhv4bq3YyBt4bufIHRy4buxYyB0aeG6v3AgbGluawogICAgICAgICAgICBpZiByYW5kb20uY2hvaWNlKFtUcnVlLCBGYWxzZV0pOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIk3hu58gdHJhbmcgY8OhIG5ow6JuIGLhurFuZyBjw6FjaCB0w6xtIGtp4bq/bToge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAjIEPDoWNoIDE6IFTDrG0ga2nhur9tIHVzZXJuYW1lIChjw6FjaCBjxakpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyDEkMOzbmcgY8OhYyBkaWFsb2cgbuG6v3UgY8OzCiAgICAgICAgICAgICAgICAgICAgZGlhbG9nID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iRGlhbG9nIikKICAgICAgICAgICAgICAgICAgICBpZiBkaWFsb2c6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVGFwIHbDoG8ga2h1IHbhu7FjIHRy4buRbmcgxJHhu4MgxJHDs25nIGRpYWxvZwogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCwgaGVpZ2h0ID0gc2VsZi5oZWxwZXIuZ2V0X3NjcmVlbl9zaXplKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwKGludCh3aWR0aCowLjIpLCBpbnQoaGVpZ2h0KjAuMikpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMS41cwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTeG7nyB0cmFuZyB0w6xtIGtp4bq/bSAKICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmgsIHRo4butIG3hu58gYuG6sW5nIGxpbmsgdHLhu7FjIHRp4bq/cCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiA0cwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWFyY2hfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3NlYXJjaF90YWIiKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VhcmNoX3RhYjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSB0YWIgVMOsbSBraeG6v20sIHRo4butIG3hu58gYuG6sW5nIGxpbmsgdHLhu7FjIHRp4bq/cCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiA0cwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX3RhYikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiAycwogICAgICAgICAgICAgICAgICAgIHNlYXJjaF90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9zZWFyY2hfdGFiIikKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VhcmNoX3RhYiBvciBub3Qgc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChzZWFyY2hfdGFiKToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF90YWIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpIAoKICAgICAgICAgICAgICAgICAgICAjIE5o4bqlbiB2w6BvIHRoYW5oIHTDrG0ga2nhur9tCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIGtoaSB0w6xtIMO0IG5o4bqtcCwgdGjhu60gbeG7nyBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocHJvZmlsZV9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWFyY2hfaW5wdXQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9zZWFyY2hfZWRpdF90ZXh0IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VhcmNoX2lucHV0OgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX3RhYikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpIAogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hfaW5wdXQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX3NlYXJjaF9lZGl0X3RleHQiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfaW5wdXQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgw7Qgbmjhuq1wIHTDrG0ga2nhur9tLCB0aOG7rSBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBYw7NhIG7hu5lpIGR1bmcgdMOsbSBraeG6v20gaGnhu4duIHThuqFpIG7hur91IGPDswogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWFyY2hfaW5wdXQpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE5o4bqtcCB1c2VybmFtZSBj4bqnbiB0w6xtIHbhu5tpIGvDvSB04buxIEAgcGjDrWEgdHLGsOG7m2MKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5pbnB1dF90ZXh0KGYie3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDUpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gNXMgxJHhu4Mga+G6v3QgcXXhuqMgdMOsbSBraeG6v20gaGnhu4duIMSR4bqneSDEkeG7pwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSBr4bq/dCBxdeG6oyB0aGVvIHJlc291cmNlLWlkIGPhu6UgdGjhu4MKICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpICAjIFRob8OhdCB0w6xtIGtp4bq/bQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmgga+G6v3QgcXXhuqMgdMOsbSBraeG6v20sIHRo4butIG3hu58gYuG6sW5nIGxpbmsgdHLhu7FjIHRp4bq/cCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdXNlcl9yZXN1bHQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcm93X3NlYXJjaF91c2VyX3VzZXJuYW1lIikKICAgICAgICAgICAgICAgICAgICBpZiB1c2VyX3Jlc3VsdDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHVzZXJfcmVzdWx0KQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSB0aGVvIHJlc291cmNlLWlkLCB0aOG7rSB0w6xtIHRoZW8ga+G6v3QgcXXhuqMgdGjDtG5nIHRoxrDhu51uZwogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNjcmVlbl94bWwsIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkxpbmVhckxheW91dCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdF9mb3VuZCA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBmb3IgcmVzdWx0IGluIHJlc3VsdHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRfdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQocmVzdWx0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUubG93ZXIoKSBpbiByZXN1bHRfdGV4dC5sb3dlcigpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihyZXN1bHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0X2ZvdW5kID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZXN1bHRfZm91bmQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSB0cm9uZyBr4bq/dCBxdeG6oyB0w6xtIGtp4bq/bSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocHJvZmlsZV9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHTDrG0ga2nhur9tIHTDoGkga2hv4bqjbjoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIGzhu5dpLCBz4butIGThu6VuZyBwaMawxqFuZyB0aOG7qWMgbeG7nyBsaW5rCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocHJvZmlsZV9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDQpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gNHMKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgQ8OhY2ggMjogTeG7nyB0cuG7sWMgdGnhur9wIFVSTCB0aMO0bmcgcXVhIGhlbHBlci5vcGVuX3VybCgpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTeG7nyB0cmFuZyBjw6EgbmjDom4gYuG6sW5nIGxpbmsgdHLhu7FjIHRp4bq/cDoge3Byb2ZpbGVfbGlua30iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocHJvZmlsZV9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiA0cwogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaOG7nSB0aMOqbSBjaG8gdHJhbmcgaOG7kyBzxqEgdOG6o2kgeG9uZwogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIG7DunQgRm9sbG93IHRoZW8gcmVzb3VyY2UtaWQgY2jDrW5oIHjDoWMKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmgga2hpIHTDrG0gbsO6dCBmb2xsb3ciKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBmb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Byb2ZpbGVfaGVhZGVyX2ZvbGxvd19idXR0b24iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgdGhlbyByZXNvdXJjZS1pZCwgdGjhu60gdMOsbSB0aGVvIHRleHQKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCB0aGVvIGTDtWkgdGhlbyByZXNvdXJjZS1pZCwgdGjhu60gdMOsbSB0aGVvIHRleHQiKQogICAgICAgICAgICAgICAgIyBUw6xtIG7DunQgdGhlbyB0ZXh0CiAgICAgICAgICAgICAgICBmb2xsb3dfdGV4dHMgPSBbIlRoZW8gZMO1aSIsICJGb2xsb3ciLCAixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyIsICLEkMOjIHnDqnUgY+G6p3UiLCAiUmVxdWVzdGVkIl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIHRleHQgaW4gZm9sbG93X3RleHRzOgogICAgICAgICAgICAgICAgICAgIGZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9dGV4dCkKICAgICAgICAgICAgICAgICAgICBpZiBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSBs4bqnbiBu4buvYSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBmb2xsb3cKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCB0aGVvIGTDtWkg4bufIGzhuqduIMSR4bqndSwgdGjhu60gdnXhu5F0IG3DoG4gaMOsbmggdsOgIHTDrG0gbOG6oWkiKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGR1bXAgbcOgbiBow6xuaCBraGkgdMOsbSBs4bqhaSBuw7p0IGZvbGxvdyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcHJvZmlsZV9oZWFkZXJfZm9sbG93X2J1dHRvbiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICMgVMOsbSBuw7p0IHRoZW8gdGV4dAogICAgICAgICAgICAgICAgICAgIGZvbGxvd190ZXh0cyA9IFsiVGhlbyBkw7VpIiwgIkZvbGxvdyIsICLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIiwgIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXQogICAgICAgICAgICAgICAgICAgIGZvciB0ZXh0IGluIGZvbGxvd190ZXh0czoKICAgICAgICAgICAgICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD10ZXh0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IHRoZW8gZMO1aSBzYXUgbmhp4buBdSBs4bqnbiB0aOG7rSIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0ZXh0IGPhu6dhIG7DunQKICAgICAgICAgICAgYnV0dG9uX3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KGZvbGxvd19idXR0b24pCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUZXh0IGPhu6dhIG7DunQgZm9sbG93OiB7YnV0dG9uX3RleHR9IikKICAgICAgICAgICAgIyBO4bq/dSB0ZXh0IGPhu6dhIG7DunQgbMOgIG51bGwsIHRo4butIGzhuqV5IHRleHQgdOG7qyBjw6FjIGVsZW1lbnQgY29uCiAgICAgICAgICAgIGlmIG5vdCBidXR0b25fdGV4dCBvciBidXR0b25fdGV4dCA9PSAibnVsbCIgb3IgYnV0dG9uX3RleHQuc3RyaXAoKSA9PSAiIjoKICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIGPDoWMgZWxlbWVudCBjb24gY8OzIHRleHQKICAgICAgICAgICAgICAgIGNoaWxkX2VsZW1lbnRzID0gc2VsZi5oZWxwZXIuZmluZF9jaGlsZF9lbGVtZW50cyhmb2xsb3dfYnV0dG9uKQogICAgICAgICAgICAgICAgaWYgY2hpbGRfZWxlbWVudHM6CiAgICAgICAgICAgICAgICAgICAgZm9yIGNoaWxkIGluIGNoaWxkX2VsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZF90ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dChjaGlsZCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hpbGRfdGV4dCBhbmQgY2hpbGRfdGV4dCAhPSAibnVsbCIgYW5kIGNoaWxkX3RleHQuc3RyaXAoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbl90ZXh0ID0gY2hpbGRfdGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkzhuqV5IMSRxrDhu6NjIHRleHQgdOG7qyBlbGVtZW50IGNvbjoge2J1dHRvbl90ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IHbhuqtuIGtow7RuZyBjw7MgdGV4dCwgdGjhu60gbOG6pXkgdOG7qyBjb250ZW50LWRlc2MKICAgICAgICAgICAgICAgIGlmIG5vdCBidXR0b25fdGV4dCBvciBidXR0b25fdGV4dCA9PSAibnVsbCIgb3IgYnV0dG9uX3RleHQuc3RyaXAoKSA9PSAiIjoKICAgICAgICAgICAgICAgICAgICBidXR0b25fdGV4dCA9IGZvbGxvd19idXR0b24uZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTOG6pXkgdGV4dCB04burIGNvbnRlbnQtZGVzYzoge2J1dHRvbl90ZXh0fSIpCiAgICAgICAgICAgICMgTuG6v3UgbMOgICLEkGFuZyB0aGVvIGTDtWkiIGhv4bq3YyAiRm9sbG93aW5nIiB0aMOsIMSRw6MgZm9sbG93IHLhu5NpCiAgICAgICAgICAgIGlmIGJ1dHRvbl90ZXh0IGluIFsixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyJdOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgdGhlbyBkw7VpIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IHThu6sgdHLGsOG7m2MiKQogICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgbMOgICLEkMOjIHnDqnUgY+G6p3UiIGhv4bq3YyAiUmVxdWVzdGVkIiB0aMOsIMSRw6MgecOqdSBj4bqndSBmb2xsb3cgcuG7k2kKICAgICAgICAgICAgaWYgYnV0dG9uX3RleHQgaW4gWyLEkMOjIHnDqnUgY+G6p3UiLCAiUmVxdWVzdGVkIl06CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB5w6p1IGPhuqd1IHRoZW8gZMO1aSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSB04burIHRyxrDhu5tjIikKICAgICAgICAgICAgICAgIHJldHVybiA1CiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGzDoCAiVGhlbyBkw7VpIiBob+G6t2MgIkZvbGxvdyIgdGjDrCBjbGljayB2w6BvIG7DunQKICAgICAgICAgICAgaWYgYnV0dG9uX3RleHQgaW4gWyJUaGVvIGTDtWkiLCAiRm9sbG93Il06CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUaOG7sWMgaGnhu4duIGNsaWNrIHbDoG8gbsO6dCB0aGVvIGTDtWkiKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGZvbGxvd19idXR0b24pCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiAycwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBkaWFsb2cgaGnhu4duIGzDqm4ga2jDtG5nCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIHRo4buDIGtp4buDbSB0cmEgZGlhbG9nLCBuaMawbmcgY8OzIHRo4buDIMSRw6MgdGhlbyBkw7VpIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB0cuG6oW5nIHRow6FpIG7DunQKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZGlhbG9nX2NvbnRhaW5lciA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9kaWFsb2dfY29udGFpbmVyIikKICAgICAgICAgICAgICAgIGlmIGRpYWxvZ19jb250YWluZXI6CiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgdGjDtG5nIGLDoW8gIlRo4butIGzhuqFpIHNhdSIga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgcmV0cnlfdGV4dCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iVGjhu60gbOG6oWkgc2F1IikKICAgICAgICAgICAgICAgICAgICBpZiByZXRyeV90ZXh0OgogICAgICAgICAgICAgICAgICAgICAgICAjIELhuqVtIG7DunQgT0sgbGnDqm4gdOG7pWMgY2hvIMSR4bq/biBraGkga2jDtG5nIGPDsm4gZGlhbG9nCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2Rpc21pc3NfYWxsX2RpYWxvZ3MoKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJKb2Iga2jDtG5nIGhvw6BuIHRow6BuaCwgYuG7iyBnaeG7m2kgaOG6oW4gdGhlbyBkw7VpICh0aOG7rSBs4bqhaSBzYXUpIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDMKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgdGjDtG5nIGLDoW8gIlnDqnUgY+G6p3UgY+G7p2EgYuG6oW4gxJFhbmcgY2jhu50iIGtow7RuZwogICAgICAgICAgICAgICAgICAgIHdhaXRpbmdfdGV4dCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iWcOqdSBj4bqndSBj4bunYSBi4bqhbiDEkWFuZyBjaOG7nSIpCiAgICAgICAgICAgICAgICAgICAgaWYgd2FpdGluZ190ZXh0OgogICAgICAgICAgICAgICAgICAgICAgICAjIELhuqVtIG7DunQgT0sgbGnDqm4gdOG7pWMgY2hvIMSR4bq/biBraGkga2jDtG5nIGPDsm4gZGlhbG9nCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2Rpc21pc3NfYWxsX2RpYWxvZ3MoKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJIb8OgbiB0aMOgbmgsIHnDqnUgY+G6p3UgdGhlbyBkw7VpIMSRYW5nIGNo4budIGR1eeG7h3QiKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgbMOgIGRpYWxvZyBraMOhYywgYuG6pW0gT0sgbGnDqm4gdOG7pWMKICAgICAgICAgICAgICAgICAgICBzZWxmLl9kaXNtaXNzX2FsbF9kaWFsb2dzKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgY+G6p24geMOhYyBuaOG6rW4gdGhlbyBkw7VpIGtow7RuZyAodMOgaSBraG/huqNuIHJpw6puZyB0xrApCiAgICAgICAgICAgICAgICBjb25maXJtX2NvbnRhaW5lciA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9sYXlvdXRfY29udGFpbmVyX2JvdHRvbV9zaGVldCIpCiAgICAgICAgICAgICAgICBpZiBjb25maXJtX2NvbnRhaW5lcjoKICAgICAgICAgICAgICAgICAgICAjIFTDrG0gbsO6dCAiVGhlbyBkw7VpIiB0cm9uZyBjb250YWluZXIKICAgICAgICAgICAgICAgICAgICBjb25maXJtX2ZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IlRoZW8gZMO1aSIsY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXciKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjb25maXJtX2ZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1fZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iRm9sbG93IixjbGFzc19uYW1lPSJhbmRyb2lkLnZpZXcuVmlldyIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGNvbmZpcm1fZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGNvbmZpcm1fZm9sbG93X2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB0ZXh0IHNhdSBraGkgbmjhuqVuIHRoZW8gZMO1aQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIHRo4buDIGtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBuw7p0LCBuaMawbmcgY8OzIHRo4buDIMSRw6MgdGhlbyBkw7VpIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHVwZGF0ZWRfZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9wcm9maWxlX2hlYWRlcl9mb2xsb3dfYnV0dG9uIikKICAgICAgICAgICAgICAgIGlmIG5vdCB1cGRhdGVkX2ZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIGzhuqFpIHRoZW8gdGV4dAogICAgICAgICAgICAgICAgICAgIGZvbGxvd190ZXh0cyA9IFsixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyIsICLEkMOjIHnDqnUgY+G6p3UiLCAiUmVxdWVzdGVkIiwgIlRoZW8gZMO1aSIsICJGb2xsb3ciXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGZvciB0ZXh0IGluIGZvbGxvd190ZXh0czoKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF9mb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVwZGF0ZWRfZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHVwZGF0ZWRfZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHVwZGF0ZWRfZm9sbG93X2J1dHRvbikKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVGV4dCBj4bunYSBuw7p0IGZvbGxvdyBzYXUga2hpIGLhuqVtOiB7dXBkYXRlZF90ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB0ZXh0IGPhu6dhIG7DunQgbMOgIG51bGwsIHRo4butIGzhuqV5IHRleHQgdOG7qyBjw6FjIGVsZW1lbnQgY29uCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHVwZGF0ZWRfdGV4dCBvciB1cGRhdGVkX3RleHQgPT0gIm51bGwiIG9yIHVwZGF0ZWRfdGV4dC5zdHJpcCgpID09ICIiOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gdOG6pXQgY+G6oyBjw6FjIGVsZW1lbnQgY29uIGPDsyB0ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkX2VsZW1lbnRzID0gc2VsZi5oZWxwZXIuZmluZF9jaGlsZF9lbGVtZW50cyh1cGRhdGVkX2ZvbGxvd19idXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoaWxkX2VsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGNoaWxkIGluIGNoaWxkX2VsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkX3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KGNoaWxkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoaWxkX3RleHQgYW5kIGNoaWxkX3RleHQgIT0gIm51bGwiIGFuZCBjaGlsZF90ZXh0LnN0cmlwKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfdGV4dCA9IGNoaWxkX3RleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkzhuqV5IMSRxrDhu6NjIHRleHQgdOG7qyBlbGVtZW50IGNvbiBzYXUga2hpIGLhuqVtOiB7dXBkYXRlZF90ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIE7hur91IHbhuqtuIGtow7RuZyBjw7MgdGV4dCwgdGjhu60gbOG6pXkgdOG7qyBjb250ZW50LWRlc2MKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHVwZGF0ZWRfdGV4dCBvciB1cGRhdGVkX3RleHQgPT0gIm51bGwiIG9yIHVwZGF0ZWRfdGV4dC5zdHJpcCgpID09ICIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF90ZXh0ID0gdXBkYXRlZF9mb2xsb3dfYnV0dG9uLmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTOG6pXkgdGV4dCB04burIGNvbnRlbnQtZGVzYyBzYXUga2hpIGLhuqVtOiB7dXBkYXRlZF90ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDoWMgdHLGsOG7nW5nIGjhu6NwIGtow6FjIG5oYXUKICAgICAgICAgICAgICAgICAgICBpZiB1cGRhdGVkX3RleHQgaW4gWyLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIl06CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkZvbGxvdyB0aMOgbmggY8O0bmchIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgICAgICBlbGlmIHVwZGF0ZWRfdGV4dCBpbiBbIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBn4butaSB5w6p1IGPhuqd1IHRoZW8gZMO1aSB0aMOgbmggY8O0bmchIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDUKICAgICAgICAgICAgICAgICAgICBlbGlmIHVwZGF0ZWRfdGV4dCBpbiBbIlRoZW8gZMO1aSIsICJGb2xsb3ciXToKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIHRow7RuZyBiw6FvICJZw6p1IGPhuqd1IGPhu6dhIGLhuqFuIMSRYW5nIGNo4budIiBraMO0bmcKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyB0aOG7gyBraeG7g20gdHJhIHRp4bq/cCwgZ2nhuqMgxJHhu4tuaCBsw6AgxJHDoyBn4butaSB5w6p1IGPhuqd1IHRoZW8gZMO1aQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB3YWl0aW5nX3RleHQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9IlnDqnUgY+G6p3UgY+G7p2EgYuG6oW4gxJFhbmcgY2jhu50iKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB3YWl0aW5nX3RleHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIELhuqVtIG7DunQgT0sgbGnDqm4gdOG7pWMgY2hvIMSR4bq/biBraGkga2jDtG5nIGPDsm4gZGlhbG9nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9kaXNtaXNzX2FsbF9kaWFsb2dzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkhvw6BuIHRow6BuaCwgecOqdSBj4bqndSB0aGVvIGTDtWkgxJFhbmcgY2jhu50gZHV54buHdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgCgogCgogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiRm9sbG93IGtow7RuZyB0aMOgbmggY8O0bmcsIHRleHQgY+G7p2EgbsO6dCBsw6A6IHt1cGRhdGVkX3RleHR9IikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCwgY8OzIHRo4buDIMSRw6MgZm9sbG93IHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGZvbGxvdyBzYXUga2hpIG5o4bqlbiwgZ2nhuqMgxJHhu4tuaCDEkcOjIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiVGV4dCBj4bunYSBuw7p0IGtow7RuZyBraOG7m3AgduG7m2kgJ1RoZW8gZMO1aScgaG/hurdjICdGb2xsb3cnOiB7YnV0dG9uX3RleHR9IikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYiBmb2xsb3c6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIDIKICAgIAogICAgZGVmIF9wZXJmb3JtX2xpa2Vfam9iKHNlbGYsIHBvc3RfbGluazogc3RyKSAtPiBpbnQ6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IgbGlrZSBiw6BpIMSRxINuZyB0csOqbiBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwb3N0X2xpbms6IExpbmsgxJHhur9uIGLDoGkgxJHEg25nIGPhuqduIGxpa2UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgaW50OiBUcuG6oW5nIHRow6FpIGpvYiAoMDogY2jGsGEgbMOgbSwgMTogaG/DoG4gdGjDoG5oLCAyOiBs4buXaSwgMzogYuG7iyB1bmxpa2UpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJN4bufIGLDoGkgxJHEg25nIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3A6IHtwb3N0X2xpbmt9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTeG7nyB0cuG7sWMgdGnhur9wIFVSTCB0aMO0bmcgcXVhIGhlbHBlci5vcGVuX3VybCgpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHBvc3RfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaOG7nSB0cmFuZyBiw6BpIMSRxINuZyB04bqjaSB4b25nIHbhu5tpIHRo4budaSBnaWFuIG5n4bqrdSBuaGnDqm4KICAgICAgICAgICAgd2FpdF90aW1lID0gcmFuZG9tLnJhbmRpbnQoNCwgNikgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiA0LTZzCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkGFuZyBjaOG7nSB7d2FpdF90aW1lfXMgxJHhu4MgdHJhbmcgdOG6o2kgeG9uZy4uLiIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFZ14buRdCBuaOG6uSBsw6puIHRyw6puIGtob+G6o25nIDEgbuG7rWEgbcOgbiBow6xuaCDEkeG7gyBoaeG7g24gdGjhu4sgbsO6dCBsaWtlCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlZ14buRdCBuaOG6uSDEkeG7gyBoaeG7g24gdGjhu4sgbsO6dCBsaWtlIikKICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDEuNXMKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBuw7p0IGxpa2UgdGhlbyByZXNvdXJjZS1pZAogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGR1bXAgbcOgbiBow6xuaCBraGkgdMOsbSBuw7p0IGxpa2UiKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9yb3dfZmVlZF9idXR0b25fbGlrZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSwgdGjhu60gdnXhu5F0IGzhuqduIG7hu69hCiAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGxpa2UsIHRo4butIHZ14buRdCBs4bqnbiBu4buvYSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIGtoaSB0w6xtIGzhuqFpIG7DunQgbGlrZSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Jvd19mZWVkX2J1dHRvbl9saWtlIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IHbhuqtuIGtow7RuZyB0w6xtIHRo4bqleSB0aGVvIHJlc291cmNlLWlkLCB0aOG7rSB0w6xtIHRoZW8gY29udGVudC1kZXNjCiAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRo4butIHTDrG0gbsO6dCBsaWtlIHRoZW8gY29udGVudC1kZXNjIikKICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlRow61jaCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gduG7m2kgdGV4dCB0aeG6v25nIEFuaAogICAgICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9Ikxpa2UiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSB24bqrbiBraMO0bmcgdMOsbSB0aOG6pXksIGLDoW8gbOG7l2kKICAgICAgICAgICAgaWYgbm90IGxpa2VfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGxpa2Ugc2F1IG5oaeG7gXUgbOG6p24gdGjhu60iKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6MgbGlrZSBjaMawYSBi4bqxbmcgdGh14buZYyB0w61uaCBzZWxlY3RlZAogICAgICAgICAgICBpc19zZWxlY3RlZCA9IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b24pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IHNlbGVjdGVkIGtow7RuZyBjw7MgZ2nDoSB0cuG7iywgdGjhu60gdMOsbSBuw7p0ICJC4buPIHRow61jaCIgaG/hurdjICJVbmxpa2UiCiAgICAgICAgICAgIGlmIG5vdCBpc19zZWxlY3RlZDoKICAgICAgICAgICAgICAgIHVubGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iQuG7jyB0aMOtY2giKQogICAgICAgICAgICAgICAgaWYgbm90IHVubGlrZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgdW5saWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJVbmxpa2UiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpc19zZWxlY3RlZCA9IGJvb2wodW5saWtlX2J1dHRvbikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IMSRw6MgbGlrZSBy4buTaSB0aMOsIGhvw6BuIHRow6BuaAogICAgICAgICAgICBpZiBpc19zZWxlY3RlZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgbGlrZSBiw6BpIHZp4bq/dCBuw6B5IHThu6sgdHLGsOG7m2MiKQogICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIExpa2UgYsOgaSB2aeG6v3QKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTmjhuqVuIG7DunQgbGlrZSIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihsaWtlX2J1dHRvbikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMnMKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB4ZW0gxJHDoyBsaWtlIHRow6BuaCBjw7RuZyBjaMawYQogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAjIEtow7RuZyB0aOG7gyBraeG7g20gdHJhLCBnaeG6oyDEkeG7i25oIMSRw6MgbGlrZSB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0aOG7gyBraeG7g20gdHJhIGzhuqFpIHRy4bqhbmcgdGjDoWkgbGlrZSwgZ2nhuqMgxJHhu4tuaCB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBjaGVja191bmxpa2UgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iQuG7jyB0aMOtY2giKQogICAgICAgICAgICBpZiBub3QgY2hlY2tfdW5saWtlOgogICAgICAgICAgICAgICAgY2hlY2tfdW5saWtlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlVubGlrZSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIGLhurFuZyByZXNvdXJjZS1pZCB2w6Agc2VsZWN0ZWQKICAgICAgICAgICAgaWYgbm90IGNoZWNrX3VubGlrZToKICAgICAgICAgICAgICAgIGxpa2VfYnV0dG9uX2FmdGVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Jvd19mZWVkX2J1dHRvbl9saWtlIikKICAgICAgICAgICAgICAgIGlmIGxpa2VfYnV0dG9uX2FmdGVyIGFuZCBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGxpa2VfYnV0dG9uX2FmdGVyKToKICAgICAgICAgICAgICAgICAgICBjaGVja191bmxpa2UgPSBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgY2hlY2tfdW5saWtlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBsaWtlIGLDoGkgdmnhur90IHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB4w6FjIG5o4bqtbiDEkcOjIGxpa2UgYsOgaSB2aeG6v3QiKQogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gam9iIGxpa2U6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgCiAgICBkZWYgX2NhcmVfc3dpcGVfZmVlZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJWdeG7kXQgYuG6o25nIHRpbiBJbnN0YWdyYW0gduG7m2kgdGjhu51pIGdpYW4gMi01IHBow7p0LCBjw7MgdGjhu4MgbGlrZSBiw6BpIG7hur91IGThu6tuZyBsw6J1IiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgIyBSYW5kb20gdGjhu51pIGdpYW4gdnXhu5F0IHThu6sgMzAtMTIwIGdpw6J5CiAgICAgICAgICAgIHRvdGFsX3RpbWUgPSByYW5kb20ucmFuZGludCgzMCwgMTIwKSAgIyAzMC0xMjAgZ2nDonkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSB2deG7kXQgYuG6o25nIHRpbiB0cm9uZyB7dG90YWxfdGltZX0gZ2nDonkiKQogICAgICAgICAgICAKICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIHN3aXBlX2NvdW50ID0gMAogICAgICAgICAgICBsaWtlX2NvdW50ID0gMAogICAgICAgICAgICAKICAgICAgICAgICAgd2hpbGUgKHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSkgPCB0b3RhbF90aW1lOgogICAgICAgICAgICAgICAgc3dpcGVfY291bnQgKz0gMQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgIyBUaOG7nWkgZ2lhbiBk4burbmcgbmfhuqt1IG5oacOqbiB04burIDEtMTUgZ2nDonkKICAgICAgICAgICAgICAgIHBhdXNlX3RpbWUgPSByYW5kb20ucmFuZGludCgxLCAxNSkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYiVnXhu5F0IGzhuqduIHtzd2lwZV9jb3VudH0sIGThu6tuZyB7cGF1c2VfdGltZX1zIikKICAgICAgICAgICAgICAgICMgTuG6v3UgZOG7q25nIGzDonUgaMahbiA4cyB0aMOsIGPDsyAyJSBjaGFuY2UgbGlrZSBiw6BpCiAgICAgICAgICAgICAgICBpZiBwYXVzZV90aW1lID4gOCBhbmQgcmFuZG9tLnJhbmRpbnQoMSwgMTAwKSA8PSAyOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRo4butIGxpa2UgYsOgaSB2aeG6v3QgbsOgeS4uLiIpCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gbsO6dCBsaWtlIHRyb25nIGZlZWQKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9yb3dfZmVlZF9idXR0b25fbGlrZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsaWtlX2J1dHRvbiBhbmQgbm90IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b24pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihsaWtlX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBsaWtlIGLDoGkgdmnhur90ICh04buVbmc6IHtsaWtlX2NvdW50fSBsaWtlcykiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjDqm0gdGjhu51pIGdpYW4gY2jhu50gc2F1IGtoaSBsaWtlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDEsIDIpKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJLaMO0bmcgdGjhu4MgbGlrZSBiw6BpOiB7ZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEThu6tuZyB0aGVvIHRo4budaSBnaWFuIMSRw6MgcmFuZG9tCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKHBhdXNlX3RpbWUpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgZWxhcHNlZCA9IHRpbWUudGltZSgpIC0gc3RhcnRfdGltZQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiSG/DoG4gdGjDoG5oIHZ14buRdCBmZWVkOiB7c3dpcGVfY291bnR9IGzhuqduIHZ14buRdCwge2xpa2VfY291bnR9IGxpa2VzIHRyb25nIHtlbGFwc2VkOi4xZn1zIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUXVheSBs4bqhaSB0cmFuZyBjaOG7pwogICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHZ14buRdCBmZWVkOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2NhcmVfd2F0Y2hfcmVlbHMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiTMaw4bubdCByZWVsIHbhu5tpIHRo4budaSBnaWFuIGThu6tuZyByYW5kb20gdsOgIGPDsyB0aOG7gyBsaWtlIHZpZGVvIG7hur91IGThu6tuZyBsw6J1IiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4bqvdCDEkeG6p3UgbMaw4bubdCByZWVsLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIHbhu4EgdHJhbmcgY2jhu6cgdHLGsOG7m2MKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw7MgdGFiIHJlZWwga2jDtG5nCiAgICAgICAgICAgIHJlZWxfdGFiID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudCh0aW1lb3V0PTUsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvY2xpcHNfdGFiIikKICAgICAgICAgICAgaWYgbm90IHJlZWxfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiBSZWVsIChjbGlwc190YWIpIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihyZWVsX3RhYikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDUpCiAgICAgICAgICAgIAogICAgICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgdG90YWxfd2FpdCA9IHJhbmRvbS5yYW5kaW50KDMwLCAxMjApICAjIDMwLTEyMCBnacOieQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG7lW5nIHRo4budaSBnaWFuIGzGsOG7m3QgcmVlbCBz4bq9IGzDoCB7dG90YWxfd2FpdH0gZ2nDonkiKQogICAgICAgICAgICAKICAgICAgICAgICAgZWxhcHNlZCA9IDAKICAgICAgICAgICAgc3dpcGVfY291bnQgPSAwCiAgICAgICAgICAgIGxpa2VfY291bnQgPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSBlbGFwc2VkIDwgdG90YWxfd2FpdDoKICAgICAgICAgICAgICAgIHN3aXBlX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYixJBhbmcgdnXhu5F0IHJlZWwgbOG6p24gdGjhu6kge3N3aXBlX2NvdW50fSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu51pIGdpYW4geGVtIHZpZGVvIHJhbmRvbSB04burIDItMTBzCiAgICAgICAgICAgICAgICB2aWRlb190aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgMTUpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIlhlbSB2aWRlbyBuw6B5IHt2aWRlb190aW1lfSBnacOieS4uLiIpCiAgICAgICAgICAgICAgICAjIE7hur91IGThu6tuZyBsw6J1IGjGoW4gOHMgdGjDrCBjw7MgNSUgY2hhbmNlIGxpa2UgdmlkZW8KICAgICAgICAgICAgICAgIGlmIHZpZGVvX3RpbWUgPiA4IGFuZCByYW5kb20ucmFuZGludCgxLCAxMDApIDw9IDU6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjIENo4budIG3hu5l0IGNow7p0IMSR4buDIHZpZGVvIGxvYWQKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gbsO6dCBsaWtlIHRyb25nIHJlZWwKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gbsO6dCBsaWtlIHRoZW8gY8OhYyByZXNvdXJjZS1pZCBraMOhYyBuaGF1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9saWtlX2J1dHRvbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbGlrZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVGjDrWNoIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBsaWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJMaWtlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGlrZV9idXR0b24gYW5kIG5vdCBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGxpa2VfYnV0dG9uKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUaOG7rSBsaWtlIHZpZGVvIHJlZWwgbsOgeS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGxpa2VfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpa2VfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGxpa2UgdmlkZW8gcmVlbCAodOG7lW5nOiB7bGlrZV9jb3VudH0gbGlrZXMpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFhlbSB0aMOqbSAyLTEwcyBzYXUga2hpIGxpa2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYV90aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgMTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJYZW0gdGjDqm0ge2V4dHJhX3RpbWV9cyBzYXUga2hpIGxpa2UiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoZXh0cmFfdGltZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgbGlrZSBob+G6t2MgxJHDoyBsaWtlIHLhu5NpIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCJLaMO0bmcgdGjhu4MgZHVtcCBzY3JlZW4gxJHhu4MgdMOsbSBuw7p0IGxpa2UiKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJLaMO0bmcgdGjhu4MgbGlrZSB2aWRlbyByZWVsOiB7ZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEThu6tuZyB0aGVvIHRo4budaSBnaWFuIMSRw6MgcmFuZG9tCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKHZpZGVvX3RpbWUpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGFwc2VkID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBmb3JjZSBzdG9wCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDAuMSk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG7lW5nIHPhu5EgbOG6p24gdnXhu5F0OiB7c3dpcGVfY291bnR9LCB7bGlrZV9jb3VudH0gbGlrZXMiKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIGzGsOG7m3QgeG9uZyBjw6FjIHJlZWwsIHF1YXkgbOG6oWkgdHJhbmcgY2jhu6cuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBRdWF5IGzhuqFpIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciLCB0aW1lb3V0PTUpOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJUcmFuZyBjaOG7pyIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIHF1YXkgbOG6oWkgdHJhbmcgY2jhu6cgc2F1IGtoaSBsxrDhu5t0IHJlZWwuIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIGzGsOG7m3QgcmVlbDoge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2NhcmVfdmlld19zdG9yaWVzKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIlhlbSBzdG9yeSAzLTUgc3RvcnkgduG7m2kgdOG7kWMgxJHhu5kgbmfhuqt1IG5oacOqbiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0aOG7nWkgZ2lhbiB4ZW0gc3RvcnkgY3Xhu5FpIGPDuW5nIHThu6sgYWNjb3VudAogICAgICAgICAgICBsYXN0X3ZpZXdfc3RvcmllcyA9IGFjY291bnQuZ2V0KCJsYXN0X3ZpZXdfc3RvcmllcyIsIDApCiAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgaWYgbGFzdF92aWV3X3N0b3JpZXMgPiAwIGFuZCAoY3VycmVudF90aW1lIC0gbGFzdF92aWV3X3N0b3JpZXMpIDwgMTA4MDA6ICAjIDMgdGnhur9uZyA9IDEwODAwIGdpw6J5CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJDaMawYSDEkeG7pyAzIHRp4bq/bmcga+G7gyB04burIGzhuqduIHhlbSBzdG9yeSBjdeG7kWksIGLhu48gcXVhIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgICAgICAgICAjIFTDrG0gdOG6pXQgY+G6oyBzdG9yeSB0aHVtYm5haWxzIHRoZW8gcmVzb3VyY2UtaWQKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgIHN0b3J5X3RodW1icyA9IFtdCiAgICAgICAgICAgIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICBzdG9yeV90aHVtYnMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hdmF0YXJfaW1hZ2VfdmlldyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgbuG6v3UgY8OzIMOtdCBuaOG6pXQgMiBzdG9yeSB0aMOsIG3hu5tpIGzDoG0KICAgICAgICAgICAgaWYgbGVuKHN0b3J5X3RodW1icykgPCAyOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIktow7RuZyDEkeG7pyBzdG9yeSDEkeG7gyB4ZW0gKGNo4buJIGPDsyB7bGVuKHN0b3J5X3RodW1icyl9IHN0b3J5KSwgYuG7jyBxdWEiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmFuZG9tIGNo4buNbiBzdG9yeSB04burIHRo4bupIDIgxJHhur9uIGN14buRaQogICAgICAgICAgICBzdGFydF9pbmRleCA9IHJhbmRvbS5yYW5kaW50KDEsIGxlbihzdG9yeV90aHVtYnMpIC0gMSkKICAgICAgICAgICAgc2VsZWN0ZWRfc3RvcnkgPSBzdG9yeV90aHVtYnNbc3RhcnRfaW5kZXhdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELhuqVtIHbDoG8gc3RvcnkgxJHGsOG7o2MgY2jhu41uCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWxlY3RlZF9zdG9yeSkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFhlbSAzLTggc3RvcnkgduG7m2kgdOG7kWMgxJHhu5kgbmfhuqt1IG5oacOqbgogICAgICAgICAgICBudW1fc3RvcmllcyA9IHJhbmRvbS5yYW5kaW50KDMsIDgpCiAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKG51bV9zdG9yaWVzKToKICAgICAgICAgICAgICAgICMgVGjhu51pIGdpYW4geGVtIHN0b3J5OiBuZ+G6r24gaG/hurdjIGTDoGkgbmfhuqt1IG5oacOqbgogICAgICAgICAgICAgICAgd2FpdCA9IHJhbmRvbS51bmlmb3JtKDEuMCwgMy4wKSBpZiByYW5kb20uY2hvaWNlKFtUcnVlLCBGYWxzZV0pIGVsc2UgcmFuZG9tLnVuaWZvcm0oMy4wLCA1LjApCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2FpdCkKICAgICAgICAgICAgICAgICMgQ2h1eeG7g24gc2FuZyBzdG9yeSB0aeG6v3AgdGhlbyBi4bqxbmcgY8OhY2ggYuG6pW0gdsOgbyB24buLIHRyw60gbmfhuqt1IG5oacOqbiDhu58gZ2nhu69hIG3DoG4gaMOsbmgKICAgICAgICAgICAgICAgIHdpZHRoLCBoZWlnaHQgPSBzZWxmLmhlbHBlci5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfcmlnaHQoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaG/DoXQgc3Rvcnkgdmlld2VyCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjhu51pIGdpYW4geGVtIHN0b3J5IGN14buRaSBjw7luZyB2w6BvIGFjY291bnQKICAgICAgICAgICAgaWYgYWNjb3VudCBhbmQgImlkIiBpbiBhY2NvdW50OgogICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7Imxhc3Rfdmlld19zdG9yaWVzIjogY3VycmVudF90aW1lLCAiaXNfc3luYyI6IEZhbHNlfSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHhlbSBzdG9yeToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9jYXJlX3ZpZXdfbm90aWZpY2F0aW9ucyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJN4bufIHRhYiB0aMO0bmcgYsOhbyB2w6AgY3Xhu5luIG5o4bq5IiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAxOiBLaeG7g20gdHJhIGPDsyBub3RpZmljYXRpb24gYmFkZ2Uga2jDtG5nCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIG5vdGlmaWNhdGlvbl9iYWRnZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9sZWRfYmFkZ2UiKQogICAgICAgICAgICBpZiBub3Qgbm90aWZpY2F0aW9uX2JhZGdlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIGPDsyBub3RpZmljYXRpb24gYmFkZ2UsIGLhu48gcXVhIHhlbSB0aMO0bmcgYsOhbyIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDI6IELhuqVtIHbDoG8gbm90aWZpY2F0aW9uIHRhYgogICAgICAgICAgICBub3RpZmljYXRpb25fdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL25vdGlmaWNhdGlvbiIpCiAgICAgICAgICAgIGlmIG5vdCBub3RpZmljYXRpb25fdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG5vdGlmaWNhdGlvbiB0YWIiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG5vdGlmaWNhdGlvbl90YWIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgyLCAzKSkgICMgxJDhu41jIDItM3MKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAzOiBSYW5kb20geOG7rSBsw70KICAgICAgICAgICAgaWYgcmFuZG9tLmNob2ljZShbVHJ1ZSwgRmFsc2VdKToKICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgYuG6pW0gdsOgbyBzdG9yeSByb3cKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgaWYgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICBzdG9yeV9yb3dzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJhY3Rpdml0eV9mZWVkX25ld3NmZWVkX3N0b3J5X3JvdyIpCiAgICAgICAgICAgICAgICAgICAgaWYgc3Rvcnlfcm93cyBhbmQgbGVuKHN0b3J5X3Jvd3MpID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBSYW5kb20gY2jhu41uIGluZGV4IHThu6sgMS0zIChob+G6t2Mgw610IGjGoW4gbuG6v3Uga2jDtG5nIMSR4bunKQogICAgICAgICAgICAgICAgICAgICAgICBtYXhfaW5kZXggPSBtaW4oMywgbGVuKHN0b3J5X3Jvd3MpIC0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWF4X2luZGV4ID49IDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9pbmRleCA9IHJhbmRvbS5yYW5kaW50KDEsIG1heF9pbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkX3N0b3J5ID0gc3Rvcnlfcm93c1tzZWxlY3RlZF9pbmRleF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWxlY3RlZF9zdG9yeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgzLCA0KSkgICMgQ2jhu50gMy00cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFZ14buRdCBsw6puIDEtMyBs4bqnbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UocmFuZG9tLnJhbmRpbnQoMSwgMykpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMikpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFJhbmRvbSB2deG7kXQgbMOqbiBob+G6t2Mga2jDtG5nCiAgICAgICAgICAgICAgICBpZiByYW5kb20uY2hvaWNlKFtUcnVlLCBGYWxzZV0pOgogICAgICAgICAgICAgICAgICAgICMgVnXhu5F0IGzDqm4gMS0zIGzhuqduCiAgICAgICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UocmFuZG9tLnJhbmRpbnQoMSwgMykpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgxLCAyKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyA0OiBRdWF5IGzhuqFpIGhvbWUKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgeGVtIHRow7RuZyBiw6FvOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgcGVyZm9ybV9jYXJlKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKToKICAgICAgICAiIiJMZWdhY3kgbWV0aG9kIC0gcmVkaXJlY3RzIHRvIFNtYXJ0IENhcmUgU3lzdGVtIGZvciBjb25zaXN0ZW5jeSIiIgogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJDaHV54buDbiBoxrDhu5tuZyBwZXJmb3JtX2NhcmUgSW5zdGFncmFtIHNhbmcgU21hcnQgQ2FyZSBTeXN0ZW0gY2hvIHTDoGkga2hv4bqjbjoge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSIpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFJhbmRvbSBjaOG7jW4gMSB0cm9uZyAzIFNtYXJ0IENhcmUgbWV0aG9kcyDEkeG7gyB0xrDGoW5nIHRow61jaCB24bubaSBsZWdhY3kKICAgICAgICAgICAgc21hcnRfY2FyZV9hY3Rpb25zID0gWwogICAgICAgICAgICAgICAgc2VsZi5fY2FyZV9zd2lwZV9mZWVkLAogICAgICAgICAgICAgICAgc2VsZi5fY2FyZV93YXRjaF9yZWVscywgCiAgICAgICAgICAgICAgICBzZWxmLl9jYXJlX3ZpZXdfbm90aWZpY2F0aW9ucwogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJhbmRvbSBjaOG7jW4gYWN0aW9uCiAgICAgICAgICAgIHNlbGVjdGVkX2FjdGlvbiA9IHJhbmRvbS5jaG9pY2Uoc21hcnRfY2FyZV9hY3Rpb25zKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIFNtYXJ0IENhcmUgYWN0aW9uCiAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZF9hY3Rpb24oYWNjb3VudCkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIFNtYXJ0IENhcmUgY2hvIEluc3RhZ3JhbToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgcGVyZm9ybV9wb3N0X2FjdGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkMSDbmcg4bqjbmggY2hvIEluc3RhZ3JhbSB24bubaSBraeG7g20gdHJhIHRo4budaSBnaWFuIGRlbGF5CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcgxJHEg25nIOG6o25oIGhv4bq3YyDEkcOjIMSRxINuZyBn4bqnbiDEkcOieQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgYWNjID0gYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICdVbmtub3duJykKICAgICAgICAgICAgYWNjb3VudF9pZCA9IGFjY291bnQuZ2V0KCdpZCcpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgdGjhu51pIGdpYW4gcG9zdCBn4bqnbiBuaOG6pXQKICAgICAgICAgICAgZGVsYXlfbWludXRlcyA9IHNlbGYuZ2V0X2NvbmZpZygiZGVsYXlfcG9zdF92aWRlb19taW51dGUiKQogICAgICAgICAgICBpZiBkZWxheV9taW51dGVzIGFuZCBhY2NvdW50X2lkOgogICAgICAgICAgICAgICAgbGFzdF9wb3N0X3RpbWUgPSBzZWxmLmRiLmdldF9hY2NvdW50X2xhc3RfcG9zdF90aW1lKGFjY291bnRfaWQsIHNlbGYuYXBwX25hbWUpCiAgICAgICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGxhc3RfcG9zdF90aW1lOgogICAgICAgICAgICAgICAgICAgIHRpbWVfZGlmZl9taW51dGVzID0gKGN1cnJlbnRfdGltZSAtIGxhc3RfcG9zdF90aW1lKSAvIDYwCiAgICAgICAgICAgICAgICAgICAgaWYgdGltZV9kaWZmX21pbnV0ZXMgPCBkZWxheV9taW51dGVzOgogICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdfbWludXRlcyA9IGRlbGF5X21pbnV0ZXMgLSB0aW1lX2RpZmZfbWludXRlcwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2N9IMSRw6MgxJHEg25nIOG6o25oIGfhuqduIMSRw6J5LCBj4bqnbiBjaOG7nSB0aMOqbSB7cmVtYWluaW5nX21pbnV0ZXM6LjFmfSBwaMO6dCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlICAjIFRy4bqjIHbhu4EgVHJ1ZSDEkeG7gyBraMO0bmcgY29pIGzDoCBs4buXaQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSDEkcSDbmcg4bqjbmggY2hvIHTDoGkga2hv4bqjbjoge2FjY30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDE6IMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cgSW5zdGFncmFtCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIHbDoG8gdHJhbmcgY2jhu6cgSW5zdGFncmFtIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDI6IFJhbmRvbSBz4buRIGzGsOG7o25nIOG6o25oIHbDoCB04bqjaSB24buBCiAgICAgICAgICAgIGltYWdlX2NvdW50ID0gcmFuZG9tLnJhbmRpbnQoMSwgNSkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlJhbmRvbSB7aW1hZ2VfY291bnR9IOG6o25oIMSR4buDIMSRxINuZyBiw6BpIikKICAgICAgICAgICAgaWYgbm90IHNlbGYuaGVscGVyLmRvd25sb2FkX2ltYWdlKGNvdW50PWltYWdlX2NvdW50KToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIlThuqNpIOG6o25oIHRo4bqldCBi4bqhaSwgYuG7jyBxdWEgxJHEg25nIGLDoGkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAzOiBOaOG6pW4gbsO6dCB04bqhbyBiw6BpIHZp4bq/dCAoY3JlYXRpb25fdGFiIGhv4bq3YyBuw7p0ICspCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuqVtIG7DunQgdOG6oW8gYsOgaSB2aeG6v3QuLi4iKQogICAgICAgICAgICBhZGRfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2NyZWF0aW9uX3RhYiIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgaWYgbm90IGFkZF9idXR0b246CiAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gbsO6dCArIOG7nyB24buLIHRyw60ga2jDoWMKICAgICAgICAgICAgICAgIGFkZF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9idXR0b25zX2NvbnRhaW5lcl9sZWZ0IiwgdGltZW91dD01KQogICAgICAgICAgICAgICAgaWYgbm90IGFkZF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSBjw6FjIGPDoWNoIHTDrG0ga2jDoWMKICAgICAgICAgICAgICAgICAgICBhZGRfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChjb250ZW50X2Rlc2M9Ik5ldyBwb3N0IiwgdGltZW91dD01KQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhZGRfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBhZGRfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChjb250ZW50X2Rlc2M9IkFkZCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFkZF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCB04bqhbyBiw6BpIHZp4bq/dCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICMgQ2jhu50gY2FtZXJhIGRlc3RpbmF0aW9uIGZlZWQKICAgICAgICAgICAgY2FtZXJhX2Rlc3QgPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KHRpbWVvdXQ9NSwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9jYW1fZGVzdF9mZWVkIikKICAgICAgICAgICAgaWYgbm90IGNhbWVyYV9kZXN0OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IGNhbV9kZXN0X2ZlZWQiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhuqV5IHRow6wgY2xpY2sKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjYW1lcmFfZGVzdCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaW1hZ2VfY291bnQgPiAxOgogICAgICAgICAgICAgICAgIyBCxrDhu5tjIDQ6IELhuqVtICJDSOG7jE4gTkhJ4buAVSIgbuG6v3UgY+G6p24gY2jhu41uIG5oaeG7gXUg4bqjbmgKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuqVtICdDSOG7jE4gTkhJ4buAVScuLi4iKQogICAgICAgICAgICAgICAgbXVsdGlfc2VsZWN0X2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQodGV4dD0iQ0jhu4xOIE5ISeG7gFUiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICBpZiBub3QgbXVsdGlfc2VsZWN0X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gdGhlbyBjb250ZW50LWRlc2MKICAgICAgICAgICAgICAgICAgICBtdWx0aV9zZWxlY3RfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChjb250ZW50X2Rlc2M9Ik7DunQgY2jhu41uIG5oaeG7gXUiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG11bHRpX3NlbGVjdF9idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSB0aGVvIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpX3NlbGVjdF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvbXVsdGlfc2VsZWN0X3NsaWRlX2J1dHRvbl9hbHQiLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBtdWx0aV9zZWxlY3RfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgJ0NI4buMTiBOSEnhu4BVJyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIELGsOG7m2MgNTogQ2jhu41uIOG6o25oIHRoZW8gc+G7kSBsxrDhu6NuZyDEkcOjIHJhbmRvbQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkNo4buNbiB7aW1hZ2VfY291bnR9IOG6o25oIHThu6sgdGjGsCB2aeG7h24uLi4iKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIMSR4buDIHTDrG0g4bqjbmgiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2FsbGVyeV9pdGVtcyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2dhbGxlcnlfZ3JpZF9pdGVtX3RodW1ibmFpbCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBnYWxsZXJ5X2l0ZW1zOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSDhuqNuaCBuw6BvIHRyb25nIHRoxrAgdmnhu4duIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDaOG7jW4gc+G7kSBsxrDhu6NuZyDhuqNuaCB0aGVvIHnDqnUgY+G6p3UgKHThu5FpIMSRYSBsw6Agc+G7kSDhuqNuaCBjw7Mgc+G6tW4pCiAgICAgICAgICAgICAgICAjIELhu48gcXVhIOG6o25oIMSR4bqndSB0acOqbiB2w6wgSW5zdGFncmFtIMSRw6MgdOG7sSDEkeG7mW5nIGNo4buNbgogICAgICAgICAgICAgICAgaXRlbXNfdG9fc2VsZWN0ID0gbWluKGltYWdlX2NvdW50LCBsZW4oZ2FsbGVyeV9pdGVtcykpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkge2xlbihnYWxsZXJ5X2l0ZW1zKX0g4bqjbmgsIHPhur0gY2jhu41uIHtpdGVtc190b19zZWxlY3R9IOG6o25oIChi4buPIHF1YSDhuqNuaCDEkeG6p3UgdGnDqm4gxJHDoyDEkcaw4bujYyBjaOG7jW4gdOG7sSDEkeG7mW5nKSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQuG6r3QgxJHhuqd1IHThu6sg4bqjbmggdGjhu6kgMiAoaW5kZXggMSkgdsOsIOG6o25oIMSR4bqndSB0acOqbiDEkcOjIMSRxrDhu6NjIGNo4buNbiB04buxIMSR4buZbmcKICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEsIGl0ZW1zX3RvX3NlbGVjdCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGdhbGxlcnlfaXRlbXNbaV0pCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBjaOG7jW4g4bqjbmgge2krMX0ve2l0ZW1zX3RvX3NlbGVjdH0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG7lW5nIGPhu5luZyDEkcOjIGNo4buNbiB7aXRlbXNfdG9fc2VsZWN0fSDhuqNuaCAoMSDhuqNuaCB04buxIMSR4buZbmcgKyB7aXRlbXNfdG9fc2VsZWN0LTF9IOG6o25oIHRo4bunIGPDtG5nKSIpCgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyDEkOG7kWkgduG7m2kgMSDhuqNuaCwgY2jhu4kgY+G6p24gY2jhu41uIOG6o25oIMSR4bqndSB0acOqbgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiQ2jhu41uIOG6o25oIMSR4bqndSB0acOqbiB0cm9uZyB0aMawIHZp4buHbi4uLiIpCiAgICAgICAgICAgICAgICAjIEtow7RuZyBj4bqnbiB3YWl0X3RvX3RhcF9lbGVtZW50IGNobyB4cGF0aCBwaOG7qWMgdOG6oXAsIGTDuW5nIGZpbmRfZWxlbWVudCB0aMO0bmcgdGjGsOG7nW5nCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmggxJHhu4MgdMOsbSDhuqNuaCIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSDhuqNuaCDEkeG6p3UgdGnDqm4gdHJvbmcgZ2FsbGVyeQogICAgICAgICAgICAgICAgZmlyc3RfaW1hZ2UgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkltYWdlVmlldyIpCiAgICAgICAgICAgICAgICBpZiBub3QgZmlyc3RfaW1hZ2U6CiAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRoZW8gcmVzb3VyY2UtaWQKICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5X2l0ZW1zID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvZ2FsbGVyeV9ncmlkX2l0ZW1fdGh1bWJuYWlsIikKICAgICAgICAgICAgICAgICAgICBpZiBnYWxsZXJ5X2l0ZW1zOgogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdF9pbWFnZSA9IGdhbGxlcnlfaXRlbXNbMF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGZpcnN0X2ltYWdlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSDhuqNuaCB0cm9uZyB0aMawIHZp4buHbiIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGFwIHbDoG8g4bqjbmggxJHhuqd1IHRpw6puCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZmlyc3RfaW1hZ2UpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMikpCgogICAgICAgICAgICAjIELGsOG7m2MgNjogQuG6pW0gbsO6dCBOZXh0CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuqVtIG7DunQgTmV4dC4uLiIpCiAgICAgICAgICAgIG5leHRfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL25leHRfYnV0dG9uX3RleHR2aWV3IiwgdGltZW91dD0xMCkKICAgICAgICAgICAgaWYgbm90IG5leHRfYnV0dG9uOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIG7DunQgTmV4dCBi4bqxbmcgdGV4dAogICAgICAgICAgICAgICAgbmV4dF9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHRleHQ9IlRp4bq/cCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgIGlmIG5vdCBuZXh0X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICBuZXh0X2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJUaeG6v3AiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG5leHRfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBUaeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAjIELGsOG7m2MgNzogTmjhuqVuIFRp4bq/cCBs4bqnbiBu4buvYSAoYuG7jyBxdWEgZWRpdCkKICAgICAgICAgICAgbmV4dF9idXR0b24yID0gc2VsZi5oZWxwZXIud2FpdF90b190YXBfZWxlbWVudCh0ZXh0PSJUaeG6v3AiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgIGlmIG5vdCBuZXh0X2J1dHRvbjI6CiAgICAgICAgICAgICAgICBuZXh0X2J1dHRvbjIgPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVGnhur9wIiwgdGltZW91dD01KQogICAgICAgICAgICBpZiBuZXh0X2J1dHRvbjI6CiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMiwgMykpCiAgICAgICAgICAgIAogICAgICAgICAgICB2YWxpZGF0ZV9uZXh0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IlRp4bq/cCIpCgogICAgICAgICAgICBpZiB2YWxpZGF0ZV9uZXh0OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIHVwIGLDoGkgdmnhur90LCBC4bqlbSBUaeG6v3Aga2jDtG5nIMSRxrDhu6NjIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJI4buneSIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDg6IFRow6ptIGNhcHRpb24gKHTDuXkgY2jhu41uKQogICAgICAgICAgICBjYXB0aW9uX2ZpZWxkID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IldyaXRlIGEgY2FwdGlvbi4uLiIpCiAgICAgICAgICAgIGlmIG5vdCBjYXB0aW9uX2ZpZWxkOgogICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRoZW8gY8OhY2gga2jDoWMKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKSAKICAgICAgICAgICAgICAgIGlmIHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgY2FwdGlvbl9maWVsZCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iV3JpdGUgYSBjYXB0aW9uLi4uIikKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2FwdGlvbl9maWVsZDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGZpZWxkIGNo4bupYSB04burICJjYXB0aW9uIgogICAgICAgICAgICAgICAgICAgICAgICBhbGxfZWxlbWVudHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuRWRpdFRleHQiKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgZWxlbWVudCBpbiBhbGxfZWxlbWVudHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gZWxlbWVudC5nZXQoInRleHQiLCAiIikubG93ZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGludCA9IGVsZW1lbnQuZ2V0KCJoaW50IiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJjYXB0aW9uIiBpbiB0ZXh0IG9yICJjYXB0aW9uIiBpbiBoaW50OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb25fZmllbGQgPSBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgaWYgY2FwdGlvbl9maWVsZDoKICAgICAgICAgICAgICAgICMgUmFuZG9tIHRow6ptIGNhcHRpb24gaG/hurdjIGtow7RuZyAoNzAlIGPGoSBo4buZaSBjw7MgY2FwdGlvbikKICAgICAgICAgICAgICAgIGlmIHJhbmRvbS5jaG9pY2UoW1RydWUsIFRydWUsIFRydWUsIFRydWUsIFRydWUsIFRydWUsIFRydWUsIEZhbHNlLCBGYWxzZSwgRmFsc2VdKToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgxJDhu41jIGNhcHRpb25zIHThu6sgZmlsZSB0ZW1wbGF0ZQogICAgICAgICAgICAgICAgICAgICAgICBjYXB0aW9uX2ZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5kaXJuYW1lKF9fZmlsZV9fKSksICJ0ZW1wbGF0ZSIsICJjYXB0aW9uc19pbnN0YWdyYW0udHh0IikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoY2FwdGlvbl9maWxlX3BhdGgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGNhcHRpb25fZmlsZV9wYXRoLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbnMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGYucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjYXB0aW9uczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9jYXB0aW9uID0gcmFuZG9tLmNob2ljZShjYXB0aW9ucykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoY2FwdGlvbl9maWVsZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50eXBlX3RleHQoc2VsZWN0ZWRfY2FwdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0aMOqbSBjYXB0aW9uOiB7c2VsZWN0ZWRfY2FwdGlvbn0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJGaWxlIGNhcHRpb25zIHRy4buRbmciKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBGYWxsYmFjayB24buBIGVtb2ppIG7hur91IGtow7RuZyB0w6xtIHRo4bqleSBmaWxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxsYmFja19jYXB0aW9ucyA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi8J+MnyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIuKcqCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfmYIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLwn5O4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi8J+SqyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfjLgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLwn46JIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi8J+SnSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihjYXB0aW9uX2ZpZWxkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50eXBlX3RleHQocmFuZG9tLmNob2ljZShmYWxsYmFja19jYXB0aW9ucykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBmaWxlIGNhcHRpb25zLCBz4butIGThu6VuZyBlbW9qaSBmYWxsYmFjayIpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIMSR4buNYyBmaWxlIGNhcHRpb25zOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIHbhu4EgZW1vamkgbuG6v3UgY8OzIGzhu5dpCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbGxiYWNrX2NhcHRpb25zID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfjJ8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIuKcqCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfmYIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIvCfk7giCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGNhcHRpb25fZmllbGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnR5cGVfdGV4dChyYW5kb20uY2hvaWNlKGZhbGxiYWNrX2NhcHRpb25zKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAjIELGsOG7m2MgOTogTmjhuqVuIENoaWEgc+G6uyDEkeG7gyDEkcSDbmcgYsOgaQogICAgICAgICAgICBzaGFyZV9idXR0b24gPSBzZWxmLmhlbHBlci53YWl0X3RvX3RhcF9lbGVtZW50KHRleHQ9IkNoaWEgc+G6uyIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgaWYgbm90IHNoYXJlX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNoYXJlX2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQoY29udGVudF9kZXNjPSJDaGlhIHPhursiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2hhcmVfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IENoaWEgc+G6uyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDMsIDUpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDEwOiBLaeG7g20gdHJhIMSRxINuZyB0aMOgbmggY8O0bmcgdsOgIHF1YXkgduG7gSBob21lCiAgICAgICAgICAgICMgQ8OzIHRo4buDIGPDsyBwb3B1cCAiUG9zdCBzaGFyZWQiIGhv4bq3YyB04buxIMSR4buZbmcgduG7gSBmZWVkCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9rX2J1dHRvbiA9IHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQodGV4dD0iT0siLCB0aW1lb3V0PTMpCiAgICAgICAgICAgICAgICBpZiBub3Qgb2tfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLndhaXRfdG9fdGFwX2VsZW1lbnQodGV4dD0iWG9uZyIsIHRpbWVvdXQ9MykKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgUXVheSB24buBIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSB0aOG7nWkgZ2lhbiDEkcSDbmcg4bqjbmggdGjDoG5oIGPDtG5nIHbDoG8gREIKICAgICAgICAgICAgaWYgYWNjb3VudF9pZDoKICAgICAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0X2FjY291bnRfbGFzdF9wb3N0X3RpbWUoYWNjb3VudF9pZCwgc2VsZi5hcHBfbmFtZSwgY3VycmVudF90aW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQxINuZyDhuqNuaCB0aMOgbmggY8O0bmcgY2hvIHTDoGkga2hv4bqjbjoge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSDEkcSDbmcg4bqjbmg6IHtlfSIpCiAgICAgICAgICAgICMgVGjhu60gcXVheSB24buBIHRyYW5nIGNo4bunIG7hur91IGPDsyBs4buXaQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2goc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGPDoWMgdGhhbyB0w6FjIFVJIMSR4buDIGNodXnhu4NuIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXJnZXRfYWNjb3VudDogVMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuIMSR4bq/bgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogewogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBib29sLAogICAgICAgICAgICAgICAgJ3JlYXNvbic6IHN0ciAobuG6v3UgdGjhuqV0IGLhuqFpKSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJzogc3RyCiAgICAgICAgICAgIH0KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgdGjDtG5nIHRpbiB0YXJnZXQgYWNjb3VudAogICAgICAgICAgICB0YXJnZXRfdXNlcm5hbWUgPSB0YXJnZXRfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRfdXNlcm5hbWU6CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdpbnZhbGlkX2FjY291bnQnLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogJ1RhcmdldCBhY2NvdW50IGtow7RuZyBjw7MgdW5pcXVlX3VzZXJuYW1lJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ25hdmlnYXRpb25fZXJyb3InLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogJ0tow7RuZyB0aOG7gyDEkeG6v24gdHJhbmcgY2jhu6cgSW5zdGFncmFtJwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgI2tp4buDbSB0cmEgxJHDum5nIHVzZXJuYW1lIHLhu5NpIHRow6wgcmV0dXJuIHRydWUKICAgICAgICAgICAgaWYgc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9ZiJAe3RhcmdldF91c2VybmFtZX0iKToKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZiLEkMOjIGNodXnhu4NuIHNhbmcgdMOgaSBraG/huqNuIEluc3RhZ3JhbToge3RhcmdldF91c2VybmFtZX0iCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAjIE5o4bqlbiB2w6BvIHRhYiAiVHJhbmcgY8OhIG5ow6JuIgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgcHJvZmlsZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBwcm9maWxlX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFRyYW5nIGPDoSBuaMOibiIpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAndWlfZXJyb3InLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogJ0tow7RuZyB0w6xtIHRo4bqleSB0YWIgVHJhbmcgY8OhIG5ow6JuJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVwIHbDoG8gdGFiIFRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocHJvZmlsZV90YWIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHVzZXJuYW1lIHThu6sgdGnDqnUgxJHhu4EgbOG7m24gdHJvbmcgYWN0aW9uIGJhcgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfbGFyZ2VfdGl0bGVfYXV0b19zaXplIgogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHVzZXJuYW1lX3RpdGxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl90aXRsZSIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX3RpdGxlOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgICAgICB1c2VybmFtZV90aXRsZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX2xhcmdlX3RpdGxlX2F1dG9fc2l6ZSIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGnDqnUgxJHhu4EgdXNlcm5hbWUiKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ3VpX2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICdLaMO0bmcgdMOsbSB0aOG6pXkgdGnDqnUgxJHhu4EgdXNlcm5hbWUnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6pXAgdsOgbyB0acOqdSDEkeG7gSB1c2VybmFtZSDEkeG7gyBt4bufIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih1c2VybmFtZV90aXRsZSkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHTDqm4gdMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuIMSR4bq/bgogICAgICAgICAgICB0YXJnZXRfdXNlcm5hbWUgPSB0YXJnZXRfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIsICIiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHRy4buxYyB0aeG6v3AgdMOgaSBraG/huqNuIHRoZW8gdGV4dCAoY8OhY2ggxJHGoW4gZ2nhuqNuIG5o4bqldCkKICAgICAgICAgICAgYWNjb3VudHNfeG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgdGFyZ2V0X2l0ZW0gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKGFjY291bnRzX3htbCwgdGV4dD10YXJnZXRfdXNlcm5hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSwgdnXhu5F0IGzDqm4gdsOgIHTDrG0gbOG6oWkKICAgICAgICAgICAgaWYgbm90IHRhcmdldF9pdGVtOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0g4bufIGzhuqduIMSR4bqndSwgdnXhu5F0IGzDqm4gdsOgIHTDrG0gbOG6oWkiKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgbOG6oWkgWE1MIHbDoCB0w6xtIGzhuqFpCiAgICAgICAgICAgICAgICBhY2NvdW50c194bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgdGFyZ2V0X2l0ZW0gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKGFjY291bnRzX3htbCwgdGV4dD10YXJnZXRfdXNlcm5hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgdGFyZ2V0X2l0ZW06CiAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gdGhlbyBjb250ZW50LWRlc2MgKGPDsyB0aOG7gyBjaOG7qWEgdGjDtG5nIGLDoW8pCiAgICAgICAgICAgICAgICB0YXJnZXRfaXRlbXMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoYWNjb3VudHNfeG1sLCBjbGFzc19uYW1lPSJhbmRyb2lkLnZpZXcuVmlld0dyb3VwIikKICAgICAgICAgICAgICAgIGZvciBpdGVtIGluIHRhcmdldF9pdGVtczoKICAgICAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBpdGVtLmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0X3VzZXJuYW1lIGluIGNvbnRlbnRfZGVzYyBhbmQgIlRow6ptIHTDoGkga2hv4bqjbiIgbm90IGluIGNvbnRlbnRfZGVzYyBhbmQgIlRydW5nIHTDom0gdMOgaSBraG/huqNuIiBub3QgaW4gY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfaXRlbSA9IGl0ZW0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRfaXRlbToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSB0cm9uZyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMSQw6FuaCBk4bqldSB0w6BpIGtob+G6o24gbMOgIGLhu4sgdsO0IGhp4buHdSBow7NhIHRyb25nIERCCiAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KHRhcmdldF9hY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJkaXNhYmxlZCIsCiAgICAgICAgICAgICAgICAgICAgImRpc2FibGVfcmVhc29uIjogIlTDoGkga2hv4bqjbiBraMO0bmcgY8OzIHRyw6puIHRoaeG6v3QgYuG7iyIsCiAgICAgICAgICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogaW50KHRpbWUudGltZSgpKSwKICAgICAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5o4bqlbiBCYWNrIMSR4buDIMSRw7NuZyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBRdWF5IHbhu4EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAncmVhc29uJzogJ2FjY291bnRfbm90X2ZvdW5kJywKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IGYnS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSB0cm9uZyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBJbnN0YWdyYW0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6pXAgdsOgbyB0w6BpIGtob+G6o24gbeG7pWMgdGnDqnUKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHRhcmdldF9pdGVtKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHNhZmVfc2xlZXAgcmV0dXJuIHZhbHVlIMSR4buDIGPDsyB0aOG7gyB0aG/DoXQgc+G7m20KICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCg1KTogICMgxJDhu6NpIGNodXnhu4NuIHTDoGkga2hv4bqjbiBob8OgbiB04bqldAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTmjhuq1uIMSRxrDhu6NjIHnDqnUgY+G6p3UgZOG7q25nIHRyb25nIHN3aXRjaF90b19hY2NvdW50IikKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdpbnRlcnJ1cHRlZCcsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnQuG7iyBk4burbmcgdHJvbmcgcXXDoSB0csOsbmggY2h1eeG7g24gdMOgaSBraG/huqNuJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIGNodXnhu4NuIHTDoGkga2hv4bqjbiB0aMOgbmggY8O0bmcgY2jGsGEKICAgICAgICAgICAgY3VycmVudF91c2VybmFtZSA9IHNlbGYuZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGN1cnJlbnRfdXNlcm5hbWUgPT0gdGFyZ2V0X3VzZXJuYW1lOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgY2h1eeG7g24gdMOgaSBraG/huqNuIHRow6BuaCBjw7RuZyBzYW5nIHt0YXJnZXRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLCAKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IGYnxJDDoyBjaHV54buDbiB0w6BpIGtob+G6o24gdGjDoG5oIGPDtG5nIHNhbmcge3RhcmdldF91c2VybmFtZX0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIsSQw6MgYuG6pW0gdsOgbyB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gbmjGsG5nIGtp4buDbSB0cmEgbOG6oWkgdGjhuqV5IMSRYW5nIMSRxINuZyBuaOG6rXAgbMOgIHtjdXJyZW50X3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAnc3dpdGNoX3ZlcmlmaWNhdGlvbl9mYWlsZWQnLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogZifEkMOjIGLhuqVtIHbDoG8gdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IG5oxrBuZyBraeG7g20gdHJhIGzhuqFpIHRo4bqleSDEkWFuZyDEkcSDbmcgbmjhuq1wIGzDoCB7Y3VycmVudF91c2VybmFtZX0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgY2h1eeG7g24gdMOgaSBraG/huqNuIEluc3RhZ3JhbSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdleGNlcHRpb24nLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBmJ0zhu5dpIGtoaSBjaHV54buDbiB0w6BpIGtob+G6o24gSW5zdGFncmFtOiB7c3RyKGUpfScKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgIGRlZiBnZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoc2VsZikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB1c2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0ciBob+G6t2MgTm9uZTogVXNlcm5hbWUgY+G7p2EgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAsIGhv4bq3YyBOb25lIG7hur91IGtow7RuZyBjw7MKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICAjIEPDoWNoIDE6IMSQ4buNYyB04burIGF2YXRhcl9pbWFnZV92aWV3IOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgYXZhdGFyX3ZpZXcgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYXZhdGFyX2ltYWdlX3ZpZXciKQogICAgICAgICAgICBpZiBhdmF0YXJfdmlldzoKICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYyA9IGF2YXRhcl92aWV3LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgICAgICAjIGNvbnRlbnQtZGVzYyBk4bqhbmc6ICJUaW4gY+G7p2EgbmdvdGhpeWVuMjYwMTAwNTksIDAvMSwgQ2jGsGEgeGVtIgogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGFuZCAiVGluIGPhu6dhICIgaW4gY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBjb250ZW50X2Rlc2Muc3BsaXQoIlRpbiBj4bunYSAiLCAxKVsxXS5zcGxpdCgiLCIsIDEpWzBdLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBs4bqleSB1c2VybmFtZSB04burIHRyYW5nIGNo4bunOiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VybmFtZQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBj4bqvdCBjaHXhu5dpIGzhuqV5IHVzZXJuYW1lIHThu6sgY29udGVudC1kZXNjOiB7ZX0iKQoKICAgICAgICAgICAgIyBDw6FjaCAyOiBO4bq/dSBraMO0bmcgdGjDoG5oIGPDtG5nIOG7nyBjw6FjaCAxLCB0aOG7rSB2w6BvIHRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgbOG6pXkgxJHGsOG7o2MgdXNlcm5hbWUgdOG7qyB0cmFuZyBjaOG7pywgdGjhu60gdsOgbyB0cmFuZyBjw6EgbmjDom4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6pW4gdsOgbyB0YWIgIlRyYW5nIGPDoSBuaMOibiIKICAgICAgICAgICAgcHJvZmlsZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgaWYgbm90IHByb2ZpbGVfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSB0YWIgVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocHJvZmlsZV90YWIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQoKICAgICAgICAgICAgIyDEkOG7jWMgdXNlcm5hbWUgdOG7qyB0acOqdSDEkeG7gSBs4bubbiB0cm9uZyBhY3Rpb24gYmFyCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICB1c2VybmFtZV90aXRsZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9sYXJnZV90aXRsZV9hdXRvX3NpemUiCiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX3RpdGxlOgogICAgICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX3RpdGxlIgogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9sYXJnZV90aXRsZV9hdXRvX3NpemUiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh1c2VybmFtZV90aXRsZSkKICAgICAgICAgICAgICAgICMgUXVheSBs4bqhaSB0cmFuZyBjaOG7pwogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgbOG6pXkgdXNlcm5hbWUgdOG7qyB0cmFuZyBjw6EgbmjDom46IHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJuYW1lCgogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSB0acOqdSDEkeG7gSwgdGjhu60gdMOsbSBiaeG7g3UgdMaw4bujbmcgdHJhbmcgY8OhIG5ow6JuIGtow6FjCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSB0acOqdSDEkeG7gSB1c2VybmFtZSwgdGjhu60gdMOsbSB0aGVvIGPDoWNoIGtow6FjIikKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgdXNlcm5hbWUgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAiKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICBkZWYgZ2V0X2pvYl9wYXJhbXMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRoYW0gc+G7kSDEkeG7gyBn4buNaSBBUEkgbOG6pXkgam9iIGNobyBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogVGhhbSBz4buRCiAgICAgICAgIiIiCiAgICAgICAgZ29saWtlX2lkID0gYWNjb3VudC5nZXQoImdvbGlrZV9pZCIpCiAgICAgICAgaWYgbm90IGdvbGlrZV9pZDoKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJpbnN0YWdyYW1fYWNjb3VudF9pZCI6IGdvbGlrZV9pZCwKICAgICAgICAgICAgImRhdGEiOiAibnVsbCIKICAgICAgICB9CiAgICAKICAgICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICMgQ0FSRSBBQ1RJT05TIElNUExFTUVOVEFUSU9OIChBQlNUUkFDVCBNRVRIT0RTIEZST00gQkFTRSkKICAgICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIAogICAgZGVmIHBlcmZvcm1fbmV3c2ZlZWRfYWN0aW9uKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIlRo4buxYyBoaeG7h24gdnXhu5F0IG5ld3NmZWVkIEluc3RhZ3JhbSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBT4butIGThu6VuZyBtZXRob2QgY8OzIHPhurVuIF9jYXJlX3N3aXBlX2ZlZWQKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NhcmVfc3dpcGVfZmVlZChhY2NvdW50KQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kgcGVyZm9ybV9uZXdzZmVlZF9hY3Rpb246IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcGVyZm9ybV9yZWVsc19hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiVGjhu7FjIGhp4buHbiB4ZW0gcmVlbHMgSW5zdGFncmFtIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFPhu60gZOG7pW5nIG1ldGhvZCBjw7Mgc+G6tW4gX2NhcmVfd2F0Y2hfcmVlbHMKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NhcmVfd2F0Y2hfcmVlbHMoYWNjb3VudCkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIHBlcmZvcm1fcmVlbHNfYWN0aW9uOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHBlcmZvcm1fbm90aWZpY2F0aW9uX2FjdGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJUaOG7sWMgaGnhu4duIHhlbSB0aMO0bmcgYsOhbyBJbnN0YWdyYW0iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgU+G7rSBk4bulbmcgbWV0aG9kIGPDsyBz4bq1biBfY2FyZV92aWV3X25vdGlmaWNhdGlvbnMKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NhcmVfdmlld19ub3RpZmljYXRpb25zKGFjY291bnQpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBwZXJmb3JtX25vdGlmaWNhdGlvbl9hY3Rpb246IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcGVyZm9ybV9wcm9maWxlX2FjdGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJUaOG7sWMgaGnhu4duIHhlbSBwcm9maWxlIEluc3RhZ3JhbSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBOYXZpZ2F0ZSDEkeG6v24gcHJvZmlsZSB0YWIKICAgICAgICAgICAgcHJvZmlsZV90YWIgPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9wcm9maWxlX3RhYiIsIHRpbWVvdXQ9NQogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIHByb2ZpbGVfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2ZpbGVfdGFiKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDMsIDcpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFNjcm9sbCB0cm9uZyBwcm9maWxlCiAgICAgICAgICAgICAgICBzY3JvbGxfY291bnQgPSByYW5kb20ucmFuZGludCgyLCA1KQogICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2Uoc2Nyb2xsX2NvdW50KToKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMikpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBwZXJmb3JtX3Byb2ZpbGVfYWN0aW9uOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHBlcmZvcm1fZXhwbG9yZV9hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiVGjhu7FjIGhp4buHbiBraMOhbSBwaMOhIEluc3RhZ3JhbSAoRXhwbG9yZS9TZWFyY2ggdGFiKSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBOYXZpZ2F0ZSDEkeG6v24gc2VhcmNoL2V4cGxvcmUgdGFiCiAgICAgICAgICAgIHNlYXJjaF90YWIgPSBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9zZWFyY2hfdGFiIiwgdGltZW91dD01CiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgc2VhcmNoX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWFyY2hfdGFiKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU2Nyb2xsIHRyb25nIGV4cGxvcmUgZmVlZAogICAgICAgICAgICAgICAgc2Nyb2xsX2NvdW50ID0gcmFuZG9tLnJhbmRpbnQoNSwgMTUpCiAgICAgICAgICAgICAgICBmb3IgXyBpbiByYW5nZShzY3JvbGxfY291bnQpOgogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMykpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBwZXJmb3JtX2V4cGxvcmVfYWN0aW9uOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHBlcmZvcm1fc2VhcmNoX2FjdGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJUaOG7sWMgaGnhu4duIHTDrG0ga2nhur9tIEluc3RhZ3JhbSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBOYXZpZ2F0ZSDEkeG6v24gc2VhcmNoIHRhYgogICAgICAgICAgICBzZWFyY2hfdGFiID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudCgKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvc2VhcmNoX3RhYiIsIHRpbWVvdXQ9NQogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIHNlYXJjaF90YWI6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX3RhYikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gc2VhcmNoIGJveAogICAgICAgICAgICAgICAgc2VhcmNoX2JveCA9IHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX3NlYXJjaF9lZGl0X3RleHQiLCB0aW1lb3V0PTUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIHNlYXJjaF9ib3g6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF9ib3gpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBHaeG6oyBs4bqtcCBzZWFyY2gKICAgICAgICAgICAgICAgICAgICBzZWFyY2hfdGVybXMgPSBbInRyYXZlbCIsICJmb29kIiwgImZhc2hpb24iLCAicGhvdG9ncmFwaHkiLCAiYXJ0Il0KICAgICAgICAgICAgICAgICAgICBzZWFyY2hfdGVybSA9IHJhbmRvbS5jaG9pY2Uoc2VhcmNoX3Rlcm1zKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmlucHV0X3RleHQoc2VhcmNoX3Rlcm0pCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfZW50ZXIoKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgU2Nyb2xsIGvhur90IHF14bqjCiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsX2NvdW50ID0gcmFuZG9tLnJhbmRpbnQoMywgOCkKICAgICAgICAgICAgICAgICAgICBmb3IgXyBpbiByYW5nZShzY3JvbGxfY291bnQpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDEsIDIpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBwZXJmb3JtX3NlYXJjaF9hY3Rpb246IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAKICAgICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICMgQVBQIE1BTkFHRU1FTlQgSU1QTEVNRU5UQVRJT04gKEFCU1RSQUNUIE1FVEhPRFMgRlJPTSBCQVNFKQogICAgIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgCiAgICBkZWYgb3Blbl9hcHAoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiJN4bufIEluc3RhZ3JhbSBhcHAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBhcHAgxJHDoyBt4bufIGNoxrBhCiAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICByZXR1cm4gY3VycmVudF9wYWNrYWdlID09IHNlbGYuYXBwX3BhY2thZ2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIG9wZW5fYXBwIEluc3RhZ3JhbToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBlbnN1cmVfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiLEkOG6o20gYuG6o28gxJFhbmcg4bufIG3DoG4gaMOsbmggaG9tZSBJbnN0YWdyYW0iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQsaw4bubYyAxOiBLaeG7g20gdHJhIGFwcCBjw7MgxJFhbmcgbeG7nyBraMO0bmcKICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkFwcCBJbnN0YWdyYW0gY2jGsGEgbeG7nyAoaGnhu4duIHThuqFpOiB7Y3VycmVudF9wYWNrYWdlfSksIMSRYW5nIG3hu58gYXBwLi4uIikKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLm9wZW5fYXBwKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBt4bufIEluc3RhZ3JhbSBhcHAiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDI6IEtp4buDbSB0cmEgeGVtIMSRw6Mg4bufIGhvbWUgc2NyZWVuIGNoxrBhCiAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCLEkMOjIOG7nyBtw6BuIGjDrG5oIGhvbWUgSW5zdGFncmFtIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIELGsOG7m2MgMzogTuG6v3UgY2jGsGEg4bufIGhvbWUgc2NyZWVuLCBz4butIGThu6VuZyBtZXRob2QgY8OzIHPhurVuIGJhY2tfdG9faG9tZQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJDaMawYSDhu58gbcOgbiBow6xuaCBob21lLCDEkWFuZyBuYXZpZ2F0ZSB24buBIGhvbWUuLi4iKQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdiYWNrX3RvX2hvbWUnKToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEZhbGxiYWNrOiB0w6xtIHbDoCB0YXAgaG9tZSB0YWIKICAgICAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudCgKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2ZlZWRfdGFiIiwgdGltZW91dD01CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiBob21lX3RhYjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaG9tZV90YWIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHhlbSDEkcOjIHbhu4EgaG9tZSBjaMawYQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmlzX2hvbWVfc2NyZWVuKCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IGhvbWUgdGFiIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGVuc3VyZV9ob21lX3NjcmVlbiBJbnN0YWdyYW06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcGVyZm9ybV9zdG9yeV9hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQWN0aW9uIHJpw6puZyBj4bunYSBJbnN0YWdyYW06IFhlbSBzdG9yaWVzCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVzZXJuYW1lID0gYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJYZW0gc3RvcmllcyBJbnN0YWdyYW0gY2hvIHt1c2VybmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28g4bufIGhvbWUgc2NyZWVuCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIMSR4bqjbSBi4bqjbyBob21lIHNjcmVlbiIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBraHUgduG7sWMgc3RvcmllcyDhu58gxJHhuqd1IGZlZWQKICAgICAgICAgICAgc3Rvcnlfc2VsZWN0b3JzID0gWwogICAgICAgICAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiWW91ciBzdG9yeSJ9LAogICAgICAgICAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiU3RvcnkifSwKICAgICAgICAgICAgICAgIHsidGV4dCI6ICJUaW4gY+G7p2EgYuG6oW4ifSwKICAgICAgICAgICAgICAgIHsidGV4dCI6ICJZb3VyIHN0b3J5In0sCiAgICAgICAgICAgICAgICB7InJlc291cmNlX2lkIjogImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9yZWVsX3JpbmdfdmlldyJ9CiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgIHN0b3J5X2ZvdW5kID0gRmFsc2UKICAgICAgICAgICAgZm9yIHNlbGVjdG9yIGluIHN0b3J5X3NlbGVjdG9yczoKICAgICAgICAgICAgICAgIGlmIHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoKipzZWxlY3RvciwgdGltZW91dD0zKToKICAgICAgICAgICAgICAgICAgICAjIFRhcCB2w6BvIHN0b3J5IMSR4bqndSB0acOqbgogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsaWNrX2VsZW1lbnQoKipzZWxlY3RvcikKICAgICAgICAgICAgICAgICAgICBzdG9yeV9mb3VuZCA9IFRydWUKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIGNsaWNrIHbDoG8gc3RvcnkiKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc3RvcnlfZm91bmQ6CiAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSBzdG9yeSBzZWxlY3RvciwgdGjhu60gdGFwIHbDoG8gdsO5bmcgc3RvcnkgdGjDtG5nIHRoxrDhu51uZwogICAgICAgICAgICAgICAgIyBTdG9yaWVzIHRoxrDhu51uZyDhu58gxJHhuqd1IGZlZWQsIHRyb25nIHbDuW5nIG5nYW5nCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgc3Rvcnkgc2VsZWN0b3IsIHRo4butIHRhcCB2w6BvIHbDuW5nIHN0b3J5IikKICAgICAgICAgICAgICAgICMgVGFwIHbDoG8gdsO5bmcgc3RvcnkgKHBo4bqnbiB0csOqbiBj4bunYSBtw6BuIGjDrG5oKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX3NjcmVlbigyMDAsIDIwMCkgICMgVsO5bmcgc3RvcnkgdGjGsOG7nW5nIOG7nyDEkcOieQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIG3hu58gc3Rvcnkga2jDtG5nCiAgICAgICAgICAgICAgICBzdG9yeV9pbmRpY2F0b3JzID0gWwogICAgICAgICAgICAgICAgICAgIHsiY29udGVudF9kZXNjIjogIlBhdXNlIn0sCiAgICAgICAgICAgICAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiTmV4dCBzdG9yeSJ9LAogICAgICAgICAgICAgICAgICAgIHsidGV4dCI6ICJZb3VyIHN0b3J5In0sCiAgICAgICAgICAgICAgICAgICAgeyJyZXNvdXJjZV9pZCI6ICJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcmVlbF92aWV3ZXJfbWVkaWFfbGF5b3V0In0KICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIGluZGljYXRvciBpbiBzdG9yeV9pbmRpY2F0b3JzOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoKippbmRpY2F0b3IsIHRpbWVvdXQ9Mik6CiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3J5X2ZvdW5kID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3RvcnlfZm91bmQ6CiAgICAgICAgICAgICAgICAjIFhlbSBzdG9yaWVzIHRyb25nIG3hu5l0IGtob+G6o25nIHRo4budaSBnaWFuCiAgICAgICAgICAgICAgICBzdG9yeV9jb3VudCA9IHJhbmRvbS5yYW5kaW50KDIsIDUpICAjIFhlbSAyLTUgc3RvcmllcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShzdG9yeV9jb3VudCk6CiAgICAgICAgICAgICAgICAgICAgIyBYZW0gc3RvcnkgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICAgICAgdmlld19kdXJhdGlvbiA9IHJhbmRvbS51bmlmb3JtKDMsIDgpICAjIDMtOCBnacOieSBt4buXaSBzdG9yeQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJYZW0gc3Rvcnkge2krMX0ve3N0b3J5X2NvdW50fSB0cm9uZyB7dmlld19kdXJhdGlvbjouMWZ9IGdpw6J5IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEPDsyB0aOG7gyB0xrDGoW5nIHTDoWMgbmjhurkgduG7m2kgc3RvcnkKICAgICAgICAgICAgICAgICAgICBpZiByYW5kb20ucmFuZG9tKCkgPCAwLjI6ICAjIDIwJSBjxqEgaOG7mWkgdMawxqFuZyB0w6FjCiAgICAgICAgICAgICAgICAgICAgICAgICMgVGFwIG5o4bq5IOG7nyBnaeG7r2EgbcOgbiBow6xuaCAoa2jDtG5nIHBo4bqjaSB2w7luZyBjaHV54buDbiBzdG9yeSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX3NjcmVlbihyYW5kb20ucmFuZGludCgzMDAsIDcwMCksIHJhbmRvbS5yYW5kaW50KDQwMCwgODAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAodmlld19kdXJhdGlvbikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENodXnhu4NuIHNhbmcgc3RvcnkgdGnhur9wIHRoZW8gKHRhcCBiw6puIHBo4bqjaSBtw6BuIGjDrG5oKQogICAgICAgICAgICAgICAgICAgIGlmIGkgPCBzdG9yeV9jb3VudCAtIDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9zY3JlZW4oODAwLCA0MDApICAjIFRhcCBiw6puIHBo4bqjaSDEkeG7gyBuZXh0IHN0b3J5CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFF1YXkgduG7gSBmZWVkIGLhurFuZyBjw6FjaCBuaOG6pW4gYmFjayBob+G6t2Mgc3dpcGUgZG93bgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuZ29fYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkhvw6BuIHRow6BuaCB4ZW0gc3RvcmllcyBJbnN0YWdyYW0gY2hvIHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBzdG9yaWVzIMSR4buDIHhlbSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB4ZW0gc3RvcmllcyBJbnN0YWdyYW06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICByZXR1cm4gRmFsc2U=').decode('utf-8'))
