import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHJlcXVlc3RzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBUdXBsZSwgRGljdCwgTGlzdAppbXBvcnQgY29uZmlnCmltcG9ydCBvcwppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHN5cwppbXBvcnQgdHJhY2ViYWNrCmltcG9ydCBqc29uCmltcG9ydCBsb2dnaW5nCmltcG9ydCBsb2dnaW5nLmhhbmRsZXJzCmltcG9ydCBzdWJwcm9jZXNzCmZyb20gZW51bSBpbXBvcnQgRW51bQoKIyBUaGVvIGTDtWkgdOG6pXQgY+G6oyBjw6FjIGxvZ2dlciDEkcOjIHThuqFvCmFsbF9sb2dnZXJzOiBEaWN0W3N0ciwgJ0xvZ2dlciddID0ge30KCiMgQmnhur9uIHRvw6BuIGPhu6VjIMSR4buDIGzGsHUgdHLhuqFuZyB0aMOhaQpoZWxwZXJfYXZhaWxhYmxlID0gRmFsc2UKbmV0d29ya19hdmFpbGFibGUgPSBGYWxzZQoKIyDEkOG7i25oIG5naMSpYSBjw6FjIGxldmVsIGxvZwpjbGFzcyBMb2dMZXZlbChFbnVtKToKICAgIERFQlVHID0gbG9nZ2luZy5ERUJVRwogICAgSU5GTyA9IGxvZ2dpbmcuSU5GTwogICAgV0FSTklORyA9IGxvZ2dpbmcuV0FSTklORwogICAgRVJST1IgPSBsb2dnaW5nLkVSUk9SCiAgICBDUklUSUNBTCA9IGxvZ2dpbmcuQ1JJVElDQUwKCiMgQ+G6pXUgaMOsbmggbG9nZ2VyIHbhu5tpIFJvdGF0aW5nRmlsZUhhbmRsZXIgxJHhu4MgZ2nhu5tpIGjhuqFuIGvDrWNoIHRoxrDhu5tjIGZpbGUKIyBU4bqhbyBSb3RhdGluZ0ZpbGVIYW5kbGVyIC0gZ2nhu5tpIGjhuqFuIGtob+G6o25nIDIwMDAgZMOybmcgKMaw4bubYyB0w61uaCB+MjAwS0IpCiMgU+G7rSBk4bulbmcgxJHGsOG7nW5nIGThuqtuIHR1eeG7h3QgxJHhu5FpIMSR4buDIHRyw6FuaCB24bqlbiDEkeG7gSB3b3JraW5nIGRpcmVjdG9yeQppbXBvcnQgY29uZmlnCmxvZ19maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oY29uZmlnLkJBU0VfRElSLCAnYXBwLmxvZycpCnJvdGF0aW5nX2hhbmRsZXIgPSBsb2dnaW5nLmhhbmRsZXJzLlJvdGF0aW5nRmlsZUhhbmRsZXIoCiAgICBsb2dfZmlsZV9wYXRoLCAKICAgIG1heEJ5dGVzPTIwMCoxMDI0LCAgIyAyMDBLQiBwZXIgZmlsZSAoa2hv4bqjbmcgMjAwMCBkw7JuZykKICAgIGJhY2t1cENvdW50PTAsICAgICAgIyBLaMO0bmcgZ2nhu68gZmlsZSBiYWNrdXAsIGNo4buJIHjDs2EgcGjhuqduIHRo4burYQogICAgZW5jb2Rpbmc9J3V0Zi04JwopCgpsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgbGV2ZWw9bG9nZ2luZy5JTkZPLAogICAgZm9ybWF0PSclKGFzY3RpbWUpcyAtICUobmFtZSlzIC0gJShsZXZlbG5hbWUpcyAtICUobWVzc2FnZSlzJywKICAgIGRhdGVmbXQ9JyVkLyVtICVIOiVNOiVTJywKICAgIGhhbmRsZXJzPVsKICAgICAgICBsb2dnaW5nLlN0cmVhbUhhbmRsZXIoKSwKICAgICAgICByb3RhdGluZ19oYW5kbGVyCiAgICBdCikKCmNsYXNzIExvZ2dlcjoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBuYW1lKToKICAgICAgICBzZWxmLmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKG5hbWUpCiAgICAgICAgIyDEkOG6o20gYuG6o28gbG9nZ2VyIGtow7RuZyBwcm9wYWdhdGUgxJHhu4MgdHLDoW5oIGR1cGxpY2F0ZSBsb2dzCiAgICAgICAgIyB2w6Agc+G7rSBk4bulbmcgaGFuZGxlcnMgdOG7qyBiYXNpY0NvbmZpZwogICAgICAgIGlmIG5vdCBzZWxmLmxvZ2dlci5oYW5kbGVyczoKICAgICAgICAgICAgIyBMb2dnZXIgc+G6vSBz4butIGThu6VuZyBoYW5kbGVycyB04burIHJvb3QgbG9nZ2VyIHRow7RuZyBxdWEgcHJvcGFnYXRpb24KICAgICAgICAgICAgc2VsZi5sb2dnZXIucHJvcGFnYXRlID0gVHJ1ZQogICAgICAgIAogICAgZGVmIGRlYnVnKHNlbGYsIG1lc3NhZ2UpOgogICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKG1lc3NhZ2UpCiAgICAgICAgCiAgICBkZWYgaW5mbyhzZWxmLCBtZXNzYWdlKToKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKG1lc3NhZ2UpCiAgICAgICAgCiAgICBkZWYgd2FybmluZyhzZWxmLCBtZXNzYWdlKToKICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgCiAgICBkZWYgZXJyb3Ioc2VsZiwgbWVzc2FnZSk6CiAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IobWVzc2FnZSkKICAgICAgICAKICAgIGRlZiBjcml0aWNhbChzZWxmLCBtZXNzYWdlKToKICAgICAgICBzZWxmLmxvZ2dlci5jcml0aWNhbChtZXNzYWdlKQogICAgICAgIAogICAgZGVmIGV4Y2VwdGlvbihzZWxmLCBlLCBtZXNzYWdlPSJFeGNlcHRpb24gb2NjdXJyZWQiKToKICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZiJ7bWVzc2FnZX06IHtzdHIoZSl9IikKCiMgVOG6oW8gbG9nZ2VyIG3hurdjIMSR4buLbmggY2hvIG1vZHVsZSB1dGlscwpsb2dnZXIgPSBMb2dnZXIoIlV0aWxzIikKCmRlZiBzZXRfYWxsX2xvZ2dlcnNfbGV2ZWwobGV2ZWw6IGludCk6CiAgICAiIiIKICAgIEPDoGkgxJHhurd0IGPhuqVwIMSR4buZIGxvZyBjaG8gdOG6pXQgY+G6oyBjw6FjIGxvZ2dlciDEkcOjIHThuqFvCiAgICAKICAgIEFyZ3M6CiAgICAgICAgbGV2ZWw6IEPhuqVwIMSR4buZIGxvZyB04buRaSB0aGnhu4N1IChMb2dMZXZlbC5ERUJVRywgTG9nTGV2ZWwuSU5GTywgTG9nTGV2ZWwuRVJST1IpCiAgICAiIiIKICAgIGZvciBsb2dnZXJfbmFtZSwgbG9nZ2VyX2luc3RhbmNlIGluIGFsbF9sb2dnZXJzLml0ZW1zKCk6CiAgICAgICAgbG9nZ2VyX2luc3RhbmNlLnNldF9sZXZlbChsZXZlbCkKICAgICAgICAKZGVmIHNldHVwX2RlZmF1bHRfbG9nZ2luZyhwcm9kdWN0aW9uOiBib29sID0gRmFsc2UsIGxvZ190b19maWxlOiBib29sID0gRmFsc2UpOgogICAgIiIiCiAgICBUaGnhur90IGzhuq1wIGPhuqV1IGjDrG5oIGxvZyBt4bq3YyDEkeG7i25oIGNobyDhu6luZyBk4bulbmcKICAgIAogICAgQXJnczoKICAgICAgICBwcm9kdWN0aW9uOiBUcnVlIG7hur91IMSRYW5nIGNo4bqheSB0cm9uZyBtw7RpIHRyxrDhu51uZyBwcm9kdWN0aW9uIChjaOG7iSBsb2cgdOG7qyBJTkZPIHRy4bufIGzDqm4pCiAgICAgICAgbG9nX3RvX2ZpbGU6IFRydWUgxJHhu4MgZ2hpIGxvZyByYSBmaWxlCiAgICAiIiIKICAgIGxldmVsID0gTG9nTGV2ZWwuSU5GTyBpZiBwcm9kdWN0aW9uIGVsc2UgTG9nTGV2ZWwuREVCVUcKICAgIAogICAgIyDEkOG6t3QgbGV2ZWwgY2hvIHThuqV0IGPhuqMgY8OhYyBsb2dnZXIgaGnhu4duIGPDswogICAgc2V0X2FsbF9sb2dnZXJzX2xldmVsKGxldmVsKQogICAgCiAgICAjIMSQ4bq3dCBsb2dfdG9fZmlsZSBjaG8gbG9nZ2VyIGhp4buHbiBjw7MKICAgIGlmIGxvZ190b19maWxlOgogICAgICAgIGZvciBsb2dnZXJfbmFtZSwgbG9nZ2VyX2luc3RhbmNlIGluIGFsbF9sb2dnZXJzLml0ZW1zKCk6CiAgICAgICAgICAgICMgVOG6oW8gZmlsZSBsb2cgbeG7m2kgbuG6v3UgY2jGsGEgY8OzCiAgICAgICAgICAgIGlmIG5vdCBsb2dnZXJfaW5zdGFuY2UubG9nX3RvX2ZpbGU6CiAgICAgICAgICAgICAgICBsb2dnZXJfaW5zdGFuY2UubG9nX3RvX2ZpbGUgPSBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVOG6oW8gdGjGsCBt4bulYyBsb2cgbuG6v3UgY+G6p24KICAgICAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhsb2dnZXJfaW5zdGFuY2UubG9nX2Rpcik6CiAgICAgICAgICAgICAgICAgICAgb3MubWFrZWRpcnMobG9nZ2VyX2luc3RhbmNlLmxvZ19kaXIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVOG6oW8gdMOqbiBmaWxlIGxvZyB24bubaSBuZ8OgeSB0aMOhbmcKICAgICAgICAgICAgICAgIHRvZGF5ID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVZLSVtLSVkIikKICAgICAgICAgICAgICAgIGxvZ19maWxlbmFtZSA9IGYie2xvZ2dlcl9uYW1lfV97dG9kYXl9LmxvZyIKICAgICAgICAgICAgICAgIGxvZ2dlcl9pbnN0YW5jZS5sb2dfZmlsZSA9IG9zLnBhdGguam9pbihsb2dnZXJfaW5zdGFuY2UubG9nX2RpciwgbG9nX2ZpbGVuYW1lKQoKZGVmIGdldF9sb2dnZXIobmFtZTogc3RyLCBsZXZlbDogaW50ID0gTG9nTGV2ZWwuREVCVUcsIGxvZ190b19maWxlOiBib29sID0gRmFsc2UpIC0+IExvZ2dlcjoKICAgICIiIgogICAgVOG6oW8gdsOgIHRy4bqjIHbhu4EgbeG7mXQgbG9nZ2VyIHbhu5tpIGPhuqV1IGjDrG5oIGNo4buJIMSR4buLbmgKICAgIAogICAgQXJnczoKICAgICAgICBuYW1lOiBUw6puIGPhu6dhIGxvZ2dlci9tb2R1bGUKICAgICAgICBsZXZlbDogQ+G6pXAgxJHhu5kgbG9nIHThu5FpIHRoaeG7g3UKICAgICAgICBsb2dfdG9fZmlsZTogVHJ1ZSDEkeG7gyBnaGkgbG9nIHJhIGZpbGUKICAgIAogICAgUmV0dXJuczoKICAgICAgICBMb2dnZXI6IMSQ4buRaSB0xrDhu6NuZyBsb2dnZXIgxJHDoyBj4bqldSBow6xuaAogICAgIiIiCiAgICAjIEtp4buDbSB0cmEgeGVtIGxvZ2dlciDEkcOjIHThu5NuIHThuqFpIGNoxrBhCiAgICBpZiBuYW1lIGluIGFsbF9sb2dnZXJzOgogICAgICAgIHJldHVybiBhbGxfbG9nZ2Vyc1tuYW1lXQogICAgICAgIAogICAgIyBU4bqhbyBsb2dnZXIgbeG7m2kKICAgIHJldHVybiBMb2dnZXIobmFtZSkKCmRlZiBjaGVja19oZWxwZXJfc2VydmljZShoZWxwZXJfc2VydmljZSk6CiAgICAiIiIKICAgIEtp4buDbSB0cmEgSGVscGVyU2VydmljZSBjw7MgaG/huqF0IMSR4buZbmcga2jDtG5nCiAgICAKICAgIFJldHVybnM6CiAgICAgICAgVHVwbGVbYm9vbCwgQW55XTogKFRydWUvRmFsc2UsIHJlc3BvbnNlIGRhdGEgbuG6v3UgY8OzKQogICAgIiIiCiAgICBnbG9iYWwgaGVscGVyX2F2YWlsYWJsZQogICAgCiAgICB0cnk6CiAgICAgICAgIyBLaeG7g20gdHJhIGLhurFuZyBjw6FjaCBn4buNaSBnZXRfZGV2aWNlX2luZm8KICAgICAgICByZXNwb25zZSA9IGhlbHBlcl9zZXJ2aWNlLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgCiAgICAgICAgaWYgcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkhlbHBlclNlcnZpY2UgxJFhbmcgaG/huqF0IMSR4buZbmciKQogICAgICAgICAgICBoZWxwZXJfYXZhaWxhYmxlID0gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUcuG6oyB24buBIHRow7RuZyB0aW4gdGhp4bq/dCBi4buLIMSR4buDIGPDsyB0aOG7gyBsxrB1IHbDoG8gREIKICAgICAgICAgICAgaWYgImRhdGEiIGluIHJlc3BvbnNlOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUsIHJlc3BvbnNlCiAgICAgICAgICAgIHJldHVybiBUcnVlLCBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiSGVscGVyU2VydmljZSB0cuG6oyB24buBIGzhu5dpOiB7cmVzcG9uc2UuZ2V0KCdtZXNzYWdlJywgJ0tow7RuZyByw7UgbOG7l2knKX0iKQogICAgICAgICAgICBoZWxwZXJfYXZhaWxhYmxlID0gRmFsc2UKICAgICAgICAgICAgcmV0dXJuIEZhbHNlLCBOb25lCiAgICAgICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBraeG7g20gdHJhIEhlbHBlclNlcnZpY2U6IHtlfSIpCiAgICAgICAgaGVscGVyX2F2YWlsYWJsZSA9IEZhbHNlCiAgICAgICAgcmV0dXJuIEZhbHNlLCBOb25lCgpkZWYgY2hlY2tfbmV0d29ya19jb25uZWN0aW9uKCk6CiAgICAiIiIKICAgIEtp4buDbSB0cmEga+G6v3QgbuG7kWkgbeG6oW5nIHbDoCBjbG91ZCBzZXJ2ZXIKICAgIAogICAgUmV0dXJuczoKICAgICAgICBUdXBsZVtib29sLCBBbnldOiAoVHJ1ZS9GYWxzZSwgcmVzcG9uc2UgZGF0YSBu4bq/dSBjw7MpCiAgICAiIiIKICAgIGdsb2JhbCBuZXR3b3JrX2F2YWlsYWJsZQogICAgCiAgICB0cnk6CiAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IG7hu5FpIMSR4bq/biBjbG91ZCBVUkwgKGtow7RuZyB0aMOqbSAvcGluZyBu4buvYSkKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChjb25maWcuQ0xPVURfVVJMLCB0aW1lb3V0PTUpCiAgICAgICAgCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICBsb2dnZXIuaW5mbygiS+G6v3QgbuG7kWkgbeG6oW5nIOG7lW4gxJHhu4tuaCIpCiAgICAgICAgICAgIG5ldHdvcmtfYXZhaWxhYmxlID0gVHJ1ZQogICAgICAgICAgICByZXR1cm4gVHJ1ZSwgcmVzcG9uc2UuanNvbigpIGlmIHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdjb250ZW50LXR5cGUnKSA9PSAnYXBwbGljYXRpb24vanNvbicgZWxzZSBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIMSR4bq/biBjbG91ZCBzZXJ2ZXI6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICBuZXR3b3JrX2F2YWlsYWJsZSA9IEZhbHNlCiAgICAgICAgICAgIHJldHVybiBGYWxzZSwgTm9uZQogICAgICAgICAgICAKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBr4bq/dCBu4buRaSBt4bqhbmc6IHtlfSIpCiAgICAgICAgbmV0d29ya19hdmFpbGFibGUgPSBGYWxzZQogICAgICAgIHJldHVybiBGYWxzZSwgTm9uZQoKZGVmIGlzX2hlbHBlcl9hdmFpbGFibGUoKSAtPiBib29sOgogICAgIiIiVHLhuqMgduG7gSB0cuG6oW5nIHRow6FpIGhp4buHbiB04bqhaSBj4bunYSBoZWxwZXIgc2VydmljZSIiIgogICAgcmV0dXJuIGhlbHBlcl9hdmFpbGFibGUKCmRlZiBpc19uZXR3b3JrX2F2YWlsYWJsZSgpIC0+IGJvb2w6CiAgICAiIiJUcuG6oyB24buBIHRy4bqhbmcgdGjDoWkgaGnhu4duIHThuqFpIGPhu6dhIGvhur90IG7hu5FpIG3huqFuZyIiIgogICAgcmV0dXJuIG5ldHdvcmtfYXZhaWxhYmxlCgpkZWYgcmV0cnlfdW50aWxfc3VjY2VzcyhmdW5jLCBtYXhfcmV0cmllczogaW50LCBkZWxheTogaW50LCAqYXJncywgKiprd2FyZ3MpIC0+IFR1cGxlW2Jvb2wsIE9wdGlvbmFsW0FueV1dOgogICAgIiIiCiAgICBUaOG7rSB0aOG7sWMgaGnhu4duIG3hu5l0IGjDoG0gbmhp4buBdSBs4bqnbiBjaG8gxJHhur9uIGtoaSB0aMOgbmggY8O0bmcKICAgIAogICAgQXJnczoKICAgICAgICBmdW5jOiBIw6BtIGPhuqduIHRo4buxYyBoaeG7h24KICAgICAgICBtYXhfcmV0cmllczogU+G7kSBs4bqnbiB0aOG7rSB04buRaSDEkWEKICAgICAgICBkZWxheTogVGjhu51pIGdpYW4gY2jhu50gZ2nhu69hIGPDoWMgbOG6p24gdGjhu60gKGdpw6J5KQogICAgICAgICphcmdzLCAqKmt3YXJnczogVGhhbSBz4buRIGNobyBow6BtIGPhuqduIHRo4buxYyBoaeG7h24KICAgICAgICAKICAgIFJldHVybnM6CiAgICAgICAgVHVwbGVbYm9vbCwgQW55XTogKFRow6BuaCBjw7RuZyBoYXkga2jDtG5nLCBL4bq/dCBxdeG6oyB0cuG6oyB24buBIG7hur91IGPDsykKICAgICIiIgogICAgcmV0cnlfY291bnQgPSAwCiAgICBzdWNjZXNzID0gRmFsc2UKICAgIHJlc3VsdCA9IE5vbmUKICAgIAogICAgd2hpbGUgcmV0cnlfY291bnQgPCBtYXhfcmV0cmllcyBhbmQgbm90IHN1Y2Nlc3M6CiAgICAgICAgc3VjY2VzcywgcmVzdWx0ID0gZnVuYygqYXJncywgKiprd2FyZ3MpCiAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgcmV0dXJuIFRydWUsIHJlc3VsdAogICAgICAgICAgICAKICAgICAgICByZXRyeV9jb3VudCArPSAxCiAgICAgICAgaWYgcmV0cnlfY291bnQgPCBtYXhfcmV0cmllczoKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiVGjhu60gbOG6oWkgc2F1IHtkZWxheX0gZ2nDonkuLi4gKGPDsm4ge21heF9yZXRyaWVzIC0gcmV0cnlfY291bnR9IGzhuqduKSIpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoZGVsYXkpCiAgICAKICAgIHJldHVybiBGYWxzZSwgTm9uZSAKCmRlZiBnZXRfZGV2aWNlX2lkX2Zyb21fc3lzdGVtKCkgLT4gc3RyOgogICAgIiIiCiAgICBM4bqleSBkZXZpY2VfaWQgdOG7qyBo4buHIHRo4buRbmcgYuG6sW5nIGzhu4duaCBnZXRwcm9wIHJvLnNlcmlhbG5vIChkw6BuaCBjaG8gQW5kcm9pZC9UZXJtdXgpCiAgICBUcsOqbiBXaW5kb3dzIHPhur0gdHLhuqMgduG7gSBlbXB0eSBzdHJpbmcgbeG7mXQgY8OhY2ggaW0gbOG6t25nLgogICAgCiAgICBSZXR1cm5zOgogICAgICAgIHN0cjogRGV2aWNlIElEIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSBraMO0bmcgbOG6pXkgxJHGsOG7o2MKICAgICIiIgogICAgdHJ5OgogICAgICAgIGltcG9ydCBzdWJwcm9jZXNzCiAgICAgICAgaW1wb3J0IHBsYXRmb3JtCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSDEkWFuZyBjaOG6oXkgdHLDqm4gV2luZG93cywgY2jhuqVwIG5o4bqtbiBs4buXaSBpbSBs4bq3bmcKICAgICAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAiV2luZG93cyI6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygixJBhbmcgY2jhuqF5IHRyw6puIFdpbmRvd3MsIGLhu48gcXVhIGzhu4duaCBnZXRwcm9wIChkw6BuaCBjaG8gQW5kcm9pZC9UZXJtdXgpIikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgCiAgICAgICAgIyBUcsOqbiBBbmRyb2lkL1Rlcm11eCwgdGjhu7FjIGhp4buHbiBs4buHbmggZ2V0cHJvcCByby5zZXJpYWxubwogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbImdldHByb3AiLCAicm8uc2VyaWFsbm8iXSwKICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgKQogICAgICAgIAogICAgICAgICMgTOG6pXkga+G6v3QgcXXhuqMgdsOgIGxv4bqhaSBi4buPIGtob+G6o25nIHRy4bqvbmcgdGjhu6thCiAgICAgICAgZGV2aWNlX2lkID0gcmVzdWx0LnN0ZG91dC5zdHJpcCgpCiAgICAgICAgCiAgICAgICAgaWYgZGV2aWNlX2lkOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgbOG6pXkgxJHGsOG7o2MgZGV2aWNlX2lkIHThu6sgaOG7hyB0aOG7kW5nOiB7ZGV2aWNlX2lkfSIpCiAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaWQKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIGRldmljZV9pZCB04burIGjhu4cgdGjhu5FuZyIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICMgSW0gbOG6t25nIHRyw6puIFdpbmRvd3MsIGNo4buJIGxvZyBkZWJ1ZwogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0IHBsYXRmb3JtCiAgICAgICAgICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICJXaW5kb3dzIjoKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkzhu5dpIGdldHByb3AgdHLDqm4gV2luZG93cyAoYsOsbmggdGjGsOG7nW5nKToge3N0cihlKX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGzhuqV5IGRldmljZV9pZCB04burIGjhu4cgdGjhu5FuZzoge3N0cihlKX0iKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiTOG7l2kga2hpIGzhuqV5IGRldmljZV9pZDoge3N0cihlKX0iKQogICAgICAgIHJldHVybiAiIiAKCiMgSMOgbSBraeG7g20gdHJhIGvhur90IG7hu5FpIG3huqFuZwpkZWYgY2hlY2tfbmV0d29ya19jb25uZWN0aW9uKCkgLT4gVHVwbGVbYm9vbCwgc3RyXToKICAgICIiIgogICAgS2nhu4NtIHRyYSBr4bq/dCBu4buRaSBt4bqhbmcgYuG6sW5nIGPDoWNoIHBpbmcgZ29vZ2xlLmNvbQogICAgCiAgICBSZXR1cm5zOgogICAgICAgIFR1cGxlW2Jvb2wsIHN0cl06IChUcnVlLCAiU3VjY2VzcyIpIG7hur91IHRow6BuaCBjw7RuZywgKEZhbHNlLCBlcnJvcl9tZXNzYWdlKSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICIiIgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL3d3dy5nb29nbGUuY29tIiwgdGltZW91dD01KQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgcmV0dXJuIFRydWUsICJTdWNjZXNzIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBGYWxzZSwgZiJIVFRQIGVycm9yOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IgogICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4gRmFsc2UsIGYiTmV0d29yayBlcnJvcjoge3N0cihlKX0iCgojIEjDoG0ga2nhu4NtIHRyYSBIZWxwZXJTZXJ2aWNlCmRlZiBjaGVja19oZWxwZXJfc2VydmljZShoZWxwZXIpIC0+IFR1cGxlW2Jvb2wsIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXV06CiAgICAiIiIKICAgIEtp4buDbSB0cmEga+G6v3QgbuG7kWkgxJHhur9uIEhlbHBlclNlcnZpY2UKICAgIAogICAgQXJnczoKICAgICAgICBoZWxwZXI6IEhlbHBlclNlcnZpY2UgaW5zdGFuY2UKICAgICAgICAKICAgIFJldHVybnM6CiAgICAgICAgVHVwbGVbYm9vbCwgT3B0aW9uYWxbRGljdF1dOiAoVHJ1ZSwgcmVzcG9uc2VfZGF0YSkgbuG6v3UgdGjDoG5oIGPDtG5nLCAoRmFsc2UsIE5vbmUpIG7hur91IHRo4bqldCBi4bqhaQogICAgIiIiCiAgICB0cnk6CiAgICAgICAgIyBH4buNaSBBUEkga2nhu4NtIHRyYQogICAgICAgIHJlc3BvbnNlID0gaGVscGVyLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IHF14bqjCiAgICAgICAgaWYgcmVzcG9uc2UgYW5kICJzdGF0dXMiIGluIHJlc3BvbnNlIGFuZCByZXNwb25zZVsic3RhdHVzIl0gPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICByZXR1cm4gVHJ1ZSwgcmVzcG9uc2UKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gRmFsc2UsIE5vbmUKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcmV0dXJuIEZhbHNlLCBOb25lCgojIEjDoG0ga+G6v3QgbuG7kWkgQURCCmRlZiBjb25uZWN0X2FkYihob3N0OiBzdHIsIHBvcnQ6IGludCkgLT4gYm9vbDoKICAgICIiIgogICAgS+G6v3QgbuG7kWkgxJHhur9uIHRoaeG6v3QgYuG7iyBBbmRyb2lkIHF1YSBBREIKICAgIAogICAgQXJnczoKICAgICAgICBob3N0OiDEkOG7i2EgY2jhu4kgSVAgY+G7p2EgdGhp4bq/dCBi4buLCiAgICAgICAgcG9ydDogUG9ydCBBREIgKHRoxrDhu51uZyBsw6AgNTU1NSkKICAgICAgICAKICAgIFJldHVybnM6CiAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgIiIiCiAgICBsb2dnZXIgPSBnZXRfbG9nZ2VyKCJBREIiKQogICAgCiAgICB0cnk6CiAgICAgICAgIyBLaeG7g20gdHJhIEFEQiDEkcOjIMSRxrDhu6NjIGPDoGkgxJHhurd0IGNoxrBhCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbImFkYiIsICJ2ZXJzaW9uIl0sIGNoZWNrPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUpCiAgICAgICAgZXhjZXB0IChzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciwgRmlsZU5vdEZvdW5kRXJyb3IpOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkFEQiBraMO0bmcgxJHGsOG7o2MgY8OgaSDEkeG6t3QgaG/hurdjIGtow7RuZyBjw7MgdHJvbmcgUEFUSCIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAjIEto4bufaSDEkeG7mW5nIEFEQiBzZXJ2ZXIgbuG6v3UgY2jGsGEgY2jhuqF5CiAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJhZGIiLCAic3RhcnQtc2VydmVyIl0sIGNoZWNrPUZhbHNlLCBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLCBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFKQogICAgICAgIAogICAgICAgICMgS+G6v3QgbuG7kWkgxJHhur9uIHRoaeG6v3QgYuG7iwogICAgICAgIGNvbm5lY3RfY21kID0gWyJhZGIiLCAiY29ubmVjdCIsIGYie2hvc3R9Ontwb3J0fSJdCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oY29ubmVjdF9jbWQsIGNoZWNrPUZhbHNlLCBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLCBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLCB0ZXh0PVRydWUpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IHF14bqjCiAgICAgICAgb3V0cHV0ID0gcmVzdWx0LnN0ZG91dAogICAgICAgIGlmICJjb25uZWN0ZWQiIGluIG91dHB1dC5sb3dlcigpIGFuZCAidW5hYmxlIiBub3QgaW4gb3V0cHV0Lmxvd2VyKCk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcgxJHhur9uIHtob3N0fTp7cG9ydH0iKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBr4bq/dCBu4buRaSDEkeG6v24ge2hvc3R9Ontwb3J0fToge291dHB1dH0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSBr4bq/dCBu4buRaSBBREIgxJHhur9uIHtob3N0fTp7cG9ydH0iKQogICAgICAgIHJldHVybiBGYWxzZSAKCmRlZiByZWFkX3VzZXJfaWRfZnJvbV9rZXlfZmlsZSgpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAiIiIKICAgIMSQ4buNYyB1c2VyX2lkIHThu6sgZmlsZSAuZG5kdmluYWtleSB0cm9uZyB0aMawIG3hu6VjIGNoYSBj4bunYSBwcm9qZWN0CiAgICAKICAgIFJldHVybnM6CiAgICAgICAgT3B0aW9uYWxbc3RyXTogdXNlcl9pZCDEkcOjIHRyaW0gaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIMSR4buNYyDEkcaw4bujYwogICAgIiIiCiAgICB0cnk6CiAgICAgICAgIyBU4bqhbyDEkcaw4budbmcgZOG6q24gdOG7m2kgZmlsZSAuZG5kdmluYWtleSAodGjGsCBt4bulYyBjaGEgY+G7p2EgcHJvamVjdCkKICAgICAgICBwYXJlbnRfZGlyID0gb3MucGF0aC5kaXJuYW1lKGNvbmZpZy5CQVNFX0RJUikKICAgICAgICBrZXlfZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKHBhcmVudF9kaXIsICcuZG5kdmluYWtleScpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGZpbGUgY8OzIHThu5NuIHThuqFpIGtow7RuZwogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhrZXlfZmlsZV9wYXRoKToKICAgICAgICAgICAgbG9nZ2VyID0gZ2V0X2xvZ2dlcigiVXNlcklkUmVhZGVyIikKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiRmlsZSAuZG5kdmluYWtleSBraMO0bmcgdOG7k24gdOG6oWkgdOG6oWk6IHtrZXlfZmlsZV9wYXRofSIpCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiQ2jGsMahbmcgdHLDrG5oIHPhur0gZOG7q25nIHbDrCBraMO0bmcgY8OzIGZpbGUga2V5ISIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgIyDEkOG7jWMgbuG7mWkgZHVuZyBmaWxlCiAgICAgICAgd2l0aCBvcGVuKGtleV9maWxlX3BhdGgsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgdXNlcl9pZCA9IGYucmVhZCgpLnN0cmlwKCkKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgdXNlcl9pZCBraMO0bmcgcuG7l25nCiAgICAgICAgaWYgbm90IHVzZXJfaWQ6CiAgICAgICAgICAgIGxvZ2dlciA9IGdldF9sb2dnZXIoIlVzZXJJZFJlYWRlciIpCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRmlsZSAuZG5kdmluYWtleSBy4buXbmcgaG/hurdjIGNo4buJIGNo4bupYSBraG/huqNuZyB0cuG6r25nIikKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJDaMawxqFuZyB0csOsbmggc+G6vSBk4burbmcgdsOsIGZpbGUga2V5IGtow7RuZyBo4bujcCBs4buHISIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgbG9nZ2VyID0gZ2V0X2xvZ2dlcigiVXNlcklkUmVhZGVyIikKICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgxJHhu41jIHVzZXJfaWQgdGjDoG5oIGPDtG5nOiB7dXNlcl9pZH0iKQogICAgICAgIHJldHVybiB1c2VyX2lkCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyID0gZ2V0X2xvZ2dlcigiVXNlcklkUmVhZGVyIikKICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgxJHhu41jIGZpbGUgLmRuZHZpbmFrZXk6IHtlfSIpCiAgICAgICAgbG9nZ2VyLmVycm9yKCJDaMawxqFuZyB0csOsbmggc+G6vSBk4burbmcgdsOsIGtow7RuZyB0aOG7gyDEkeG7jWMgZmlsZSBrZXkhIikKICAgICAgICByZXR1cm4gTm9uZQ==').decode('utf-8'))
