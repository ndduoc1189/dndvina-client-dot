import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHJlcXVlc3RzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBUdXBsZSwgRGljdCwgTGlzdAppbXBvcnQgY29uZmlnCmltcG9ydCBvcwppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHN5cwppbXBvcnQgdHJhY2ViYWNrCmltcG9ydCBqc29uCmltcG9ydCBsb2dnaW5nCmltcG9ydCBsb2dnaW5nLmhhbmRsZXJzCmltcG9ydCBzdWJwcm9jZXNzCmZyb20gZW51bSBpbXBvcnQgRW51bQoKIyBUaGVvIGTDtWkgdOG6pXQgY+G6oyBjw6FjIGxvZ2dlciDEkcOjIHThuqFvCmFsbF9sb2dnZXJzOiBEaWN0W3N0ciwgJ0xvZ2dlciddID0ge30KCiMgQmnhur9uIHRvw6BuIGPhu6VjIMSR4buDIGzGsHUgdHLhuqFuZyB0aMOhaQpoZWxwZXJfYXZhaWxhYmxlID0gRmFsc2UKbmV0d29ya19hdmFpbGFibGUgPSBGYWxzZQoKIyDEkOG7i25oIG5naMSpYSBjw6FjIGxldmVsIGxvZwpjbGFzcyBMb2dMZXZlbChFbnVtKToKICAgIERFQlVHID0gbG9nZ2luZy5ERUJVRwogICAgSU5GTyA9IGxvZ2dpbmcuSU5GTwogICAgV0FSTklORyA9IGxvZ2dpbmcuV0FSTklORwogICAgRVJST1IgPSBsb2dnaW5nLkVSUk9SCiAgICBDUklUSUNBTCA9IGxvZ2dpbmcuQ1JJVElDQUwKCiMgQ+G6pXUgaMOsbmggbG9nZ2VyIHbhu5tpIFJvdGF0aW5nRmlsZUhhbmRsZXIgxJHhu4MgZ2nhu5tpIGjhuqFuIGvDrWNoIHRoxrDhu5tjIGZpbGUKIyBU4bqhbyBSb3RhdGluZ0ZpbGVIYW5kbGVyIC0gZ2nhu5tpIGjhuqFuIGtob+G6o25nIDIwMDAgZMOybmcgKMaw4bubYyB0w61uaCB+MjAwS0IpCiMgU+G7rSBk4bulbmcgxJHGsOG7nW5nIGThuqtuIHR1eeG7h3QgxJHhu5FpIMSR4buDIHRyw6FuaCB24bqlbiDEkeG7gSB3b3JraW5nIGRpcmVjdG9yeQppbXBvcnQgY29uZmlnCmxvZ19maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oY29uZmlnLkJBU0VfRElSLCAnYXBwLmxvZycpCnJvdGF0aW5nX2hhbmRsZXIgPSBsb2dnaW5nLmhhbmRsZXJzLlJvdGF0aW5nRmlsZUhhbmRsZXIoCiAgICBsb2dfZmlsZV9wYXRoLCAKICAgIG1heEJ5dGVzPTIwMCoxMDI0LCAgIyAyMDBLQiBwZXIgZmlsZSAoa2hv4bqjbmcgMjAwMCBkw7JuZykKICAgIGJhY2t1cENvdW50PTAsICAgICAgIyBLaMO0bmcgZ2nhu68gZmlsZSBiYWNrdXAsIGNo4buJIHjDs2EgcGjhuqduIHRo4burYQogICAgZW5jb2Rpbmc9J3V0Zi04JwopCgpsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgbGV2ZWw9bG9nZ2luZy5ERUJVRywgICMgU2V0IHbhu4EgREVCVUcgxJHhu4MgY8OzIHRo4buDIMSRaeG7gXUgY2jhu4luaCBxdWEgY29uZmlnCiAgICBmb3JtYXQ9JyUoYXNjdGltZSlzIC0gJShuYW1lKXMgLSAlKGxldmVsbmFtZSlzIC0gJShtZXNzYWdlKXMnLAogICAgZGF0ZWZtdD0nJWQvJW0gJUg6JU06JVMnLAogICAgaGFuZGxlcnM9WwogICAgICAgIGxvZ2dpbmcuU3RyZWFtSGFuZGxlcigpLAogICAgICAgIHJvdGF0aW5nX2hhbmRsZXIKICAgIF0KKQoKY2xhc3MgTG9nZ2VyOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5hbWUpOgogICAgICAgIHNlbGYubG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIobmFtZSkKICAgICAgICAjIMSQ4bqjbSBi4bqjbyBsb2dnZXIga2jDtG5nIHByb3BhZ2F0ZSDEkeG7gyB0csOhbmggZHVwbGljYXRlIGxvZ3MKICAgICAgICAjIHbDoCBz4butIGThu6VuZyBoYW5kbGVycyB04burIGJhc2ljQ29uZmlnCiAgICAgICAgaWYgbm90IHNlbGYubG9nZ2VyLmhhbmRsZXJzOgogICAgICAgICAgICAjIExvZ2dlciBz4bq9IHPhu60gZOG7pW5nIGhhbmRsZXJzIHThu6sgcm9vdCBsb2dnZXIgdGjDtG5nIHF1YSBwcm9wYWdhdGlvbgogICAgICAgICAgICBzZWxmLmxvZ2dlci5wcm9wYWdhdGUgPSBUcnVlCiAgICAgICAgCiAgICBkZWYgZGVidWcoc2VsZiwgbWVzc2FnZSk6CiAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcobWVzc2FnZSkKICAgICAgICAKICAgIGRlZiBpbmZvKHNlbGYsIG1lc3NhZ2UpOgogICAgICAgIHNlbGYubG9nZ2VyLmluZm8obWVzc2FnZSkKICAgICAgICAKICAgIGRlZiB3YXJuaW5nKHNlbGYsIG1lc3NhZ2UpOgogICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAKICAgIGRlZiBlcnJvcihzZWxmLCBtZXNzYWdlKToKICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihtZXNzYWdlKQogICAgICAgIAogICAgZGVmIGNyaXRpY2FsKHNlbGYsIG1lc3NhZ2UpOgogICAgICAgIHNlbGYubG9nZ2VyLmNyaXRpY2FsKG1lc3NhZ2UpCiAgICAgICAgCiAgICBkZWYgZXhjZXB0aW9uKHNlbGYsIGUsIG1lc3NhZ2U9IkV4Y2VwdGlvbiBvY2N1cnJlZCIpOgogICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihmInttZXNzYWdlfToge3N0cihlKX0iKQoKIyBU4bqhbyBsb2dnZXIgbeG6t2MgxJHhu4tuaCBjaG8gbW9kdWxlIHV0aWxzCmxvZ2dlciA9IExvZ2dlcigiVXRpbHMiKQojIEFkZCB2w6BvIGRpY3Rpb25hcnkgxJHhu4MgdGhlbyBkw7VpCmFsbF9sb2dnZXJzWyJVdGlscyJdID0gbG9nZ2VyCgpkZWYgc2V0X2FsbF9sb2dnZXJzX2xldmVsKGxldmVsOiBpbnQpOgogICAgIiIiCiAgICBDw6BpIMSR4bq3dCBj4bqlcCDEkeG7mSBsb2cgY2hvIHThuqV0IGPhuqMgY8OhYyBsb2dnZXIgxJHDoyB04bqhbyB2w6Agcm9vdCBsb2dnZXIKICAgIAogICAgQXJnczoKICAgICAgICBsZXZlbDogQ+G6pXAgxJHhu5kgbG9nIHThu5FpIHRoaeG7g3UgKExvZ0xldmVsLkRFQlVHLCBMb2dMZXZlbC5JTkZPLCBMb2dMZXZlbC5FUlJPUikKICAgICIiIgogICAgIyBTZXQgbGV2ZWwgY2hvIHJvb3QgbG9nZ2VyIHbDoCB04bqldCBj4bqjIGhhbmRsZXJzCiAgICByb290X2xvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKCkKICAgIHJvb3RfbG9nZ2VyLnNldExldmVsKGxldmVsLnZhbHVlKSAgIyBsZXZlbCBpcyBMb2dMZXZlbCBlbnVtCiAgICAKICAgICMgU2V0IGxldmVsIGNobyB04bqldCBj4bqjIGhhbmRsZXJzCiAgICBmb3IgaGFuZGxlciBpbiByb290X2xvZ2dlci5oYW5kbGVyczoKICAgICAgICBoYW5kbGVyLnNldExldmVsKGxldmVsLnZhbHVlKQogICAgCiAgICAjIFNldCBsZXZlbCBjaG8gdOG6pXQgY+G6oyBjdXN0b20gbG9nZ2VycwogICAgZm9yIGxvZ2dlcl9uYW1lLCBsb2dnZXJfaW5zdGFuY2UgaW4gYWxsX2xvZ2dlcnMuaXRlbXMoKToKICAgICAgICBsb2dnZXJfaW5zdGFuY2UubG9nZ2VyLnNldExldmVsKGxldmVsLnZhbHVlKQogICAgICAgIApkZWYgc2V0dXBfZGVmYXVsdF9sb2dnaW5nKHByb2R1Y3Rpb246IGJvb2wgPSBGYWxzZSwgbG9nX3RvX2ZpbGU6IGJvb2wgPSBGYWxzZSk6CiAgICAiIiIKICAgIFRoaeG6v3QgbOG6rXAgY+G6pXUgaMOsbmggbG9nIG3hurdjIMSR4buLbmggY2hvIOG7qW5nIGThu6VuZwogICAgCiAgICBBcmdzOgogICAgICAgIHByb2R1Y3Rpb246IFRydWUgbuG6v3UgxJFhbmcgY2jhuqF5IHRyb25nIG3DtGkgdHLGsOG7nW5nIHByb2R1Y3Rpb24gKGNo4buJIGxvZyB04burIElORk8gdHLhu58gbMOqbikKICAgICAgICBsb2dfdG9fZmlsZTogVHJ1ZSDEkeG7gyBnaGkgbG9nIHJhIGZpbGUKICAgICIiIgogICAgbGV2ZWwgPSBMb2dMZXZlbC5JTkZPIGlmIHByb2R1Y3Rpb24gZWxzZSBMb2dMZXZlbC5ERUJVRwogICAgCiAgICAjIMSQ4bq3dCBsZXZlbCBjaG8gdOG6pXQgY+G6oyBjw6FjIGxvZ2dlciBoaeG7h24gY8OzCiAgICBzZXRfYWxsX2xvZ2dlcnNfbGV2ZWwobGV2ZWwpCiAgICAKICAgICMgxJDhurd0IGxvZ190b19maWxlIGNobyBsb2dnZXIgaGnhu4duIGPDswogICAgaWYgbG9nX3RvX2ZpbGU6CiAgICAgICAgZm9yIGxvZ2dlcl9uYW1lLCBsb2dnZXJfaW5zdGFuY2UgaW4gYWxsX2xvZ2dlcnMuaXRlbXMoKToKICAgICAgICAgICAgIyBU4bqhbyBmaWxlIGxvZyBt4bubaSBu4bq/dSBjaMawYSBjw7MKICAgICAgICAgICAgaWYgbm90IGxvZ2dlcl9pbnN0YW5jZS5sb2dfdG9fZmlsZToKICAgICAgICAgICAgICAgIGxvZ2dlcl9pbnN0YW5jZS5sb2dfdG9fZmlsZSA9IFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBU4bqhbyB0aMawIG3hu6VjIGxvZyBu4bq/dSBj4bqnbgogICAgICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGxvZ2dlcl9pbnN0YW5jZS5sb2dfZGlyKToKICAgICAgICAgICAgICAgICAgICBvcy5tYWtlZGlycyhsb2dnZXJfaW5zdGFuY2UubG9nX2RpcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBU4bqhbyB0w6puIGZpbGUgbG9nIHbhu5tpIG5nw6B5IHRow6FuZwogICAgICAgICAgICAgICAgdG9kYXkgPSBkYXRldGltZS5kYXRldGltZS5ub3coKS5zdHJmdGltZSgiJVktJW0tJWQiKQogICAgICAgICAgICAgICAgbG9nX2ZpbGVuYW1lID0gZiJ7bG9nZ2VyX25hbWV9X3t0b2RheX0ubG9nIgogICAgICAgICAgICAgICAgbG9nZ2VyX2luc3RhbmNlLmxvZ19maWxlID0gb3MucGF0aC5qb2luKGxvZ2dlcl9pbnN0YW5jZS5sb2dfZGlyLCBsb2dfZmlsZW5hbWUpCgpkZWYgZ2V0X2xvZ2dlcihuYW1lOiBzdHIsIGxldmVsOiBpbnQgPSBMb2dMZXZlbC5ERUJVRywgbG9nX3RvX2ZpbGU6IGJvb2wgPSBGYWxzZSkgLT4gTG9nZ2VyOgogICAgIiIiCiAgICBU4bqhbyB2w6AgdHLhuqMgduG7gSBt4buZdCBsb2dnZXIgduG7m2kgY+G6pXUgaMOsbmggY2jhu4kgxJHhu4tuaAogICAgCiAgICBBcmdzOgogICAgICAgIG5hbWU6IFTDqm4gY+G7p2EgbG9nZ2VyL21vZHVsZQogICAgICAgIGxldmVsOiBD4bqlcCDEkeG7mSBsb2cgdOG7kWkgdGhp4buDdQogICAgICAgIGxvZ190b19maWxlOiBUcnVlIMSR4buDIGdoaSBsb2cgcmEgZmlsZQogICAgCiAgICBSZXR1cm5zOgogICAgICAgIExvZ2dlcjogxJDhu5FpIHTGsOG7o25nIGxvZ2dlciDEkcOjIGPhuqV1IGjDrG5oCiAgICAiIiIKICAgICMgS2nhu4NtIHRyYSB4ZW0gbG9nZ2VyIMSRw6MgdOG7k24gdOG6oWkgY2jGsGEKICAgIGlmIG5hbWUgaW4gYWxsX2xvZ2dlcnM6CiAgICAgICAgcmV0dXJuIGFsbF9sb2dnZXJzW25hbWVdCiAgICAgICAgCiAgICAjIFThuqFvIGxvZ2dlciBt4bubaQogICAgbG9nZ2VyX2luc3RhbmNlID0gTG9nZ2VyKG5hbWUpCiAgICAjIFRow6ptIHbDoG8gZGljdGlvbmFyeSDEkeG7gyB0aGVvIGTDtWkKICAgIGFsbF9sb2dnZXJzW25hbWVdID0gbG9nZ2VyX2luc3RhbmNlCiAgICByZXR1cm4gbG9nZ2VyX2luc3RhbmNlCgpkZWYgY2hlY2tfaGVscGVyX3NlcnZpY2UoaGVscGVyX3NlcnZpY2UpOgogICAgIiIiCiAgICBLaeG7g20gdHJhIEhlbHBlclNlcnZpY2UgY8OzIGhv4bqhdCDEkeG7mW5nIGtow7RuZwogICAgCiAgICBSZXR1cm5zOgogICAgICAgIFR1cGxlW2Jvb2wsIEFueV06IChUcnVlL0ZhbHNlLCByZXNwb25zZSBkYXRhIG7hur91IGPDsykKICAgICIiIgogICAgZ2xvYmFsIGhlbHBlcl9hdmFpbGFibGUKICAgIAogICAgdHJ5OgogICAgICAgICMgS2nhu4NtIHRyYSBi4bqxbmcgY8OhY2ggZ+G7jWkgZ2V0X2RldmljZV9pbmZvCiAgICAgICAgcmVzcG9uc2UgPSBoZWxwZXJfc2VydmljZS5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgIAogICAgICAgIGlmIHJlc3BvbnNlWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJIZWxwZXJTZXJ2aWNlIMSRYW5nIGhv4bqhdCDEkeG7mW5nIikKICAgICAgICAgICAgaGVscGVyX2F2YWlsYWJsZSA9IFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVHLhuqMgduG7gSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iyDEkeG7gyBjw7MgdGjhu4MgbMawdSB2w6BvIERCCiAgICAgICAgICAgIGlmICJkYXRhIiBpbiByZXNwb25zZToKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlLCByZXNwb25zZQogICAgICAgICAgICByZXR1cm4gVHJ1ZSwgTm9uZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkhlbHBlclNlcnZpY2UgdHLhuqMgduG7gSBs4buXaToge3Jlc3BvbnNlLmdldCgnbWVzc2FnZScsICdLaMO0bmcgcsO1IGzhu5dpJyl9IikKICAgICAgICAgICAgaGVscGVyX2F2YWlsYWJsZSA9IEZhbHNlCiAgICAgICAgICAgIHJldHVybiBGYWxzZSwgTm9uZQogICAgICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkga2nhu4NtIHRyYSBIZWxwZXJTZXJ2aWNlOiB7ZX0iKQogICAgICAgIGhlbHBlcl9hdmFpbGFibGUgPSBGYWxzZQogICAgICAgIHJldHVybiBGYWxzZSwgTm9uZQoKZGVmIGNoZWNrX25ldHdvcmtfY29ubmVjdGlvbigpOgogICAgIiIiCiAgICBLaeG7g20gdHJhIGvhur90IG7hu5FpIG3huqFuZyB2w6AgY2xvdWQgc2VydmVyCiAgICAKICAgIFJldHVybnM6CiAgICAgICAgVHVwbGVbYm9vbCwgQW55XTogKFRydWUvRmFsc2UsIHJlc3BvbnNlIGRhdGEgbuG6v3UgY8OzKQogICAgIiIiCiAgICBnbG9iYWwgbmV0d29ya19hdmFpbGFibGUKICAgIAogICAgdHJ5OgogICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBu4buRaSDEkeG6v24gY2xvdWQgVVJMIChraMO0bmcgdGjDqm0gL3BpbmcgbuG7r2EpCiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoY29uZmlnLkNMT1VEX1VSTCwgdGltZW91dD01KQogICAgICAgIAogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkvhur90IG7hu5FpIG3huqFuZyDhu5VuIMSR4buLbmgiKQogICAgICAgICAgICBuZXR3b3JrX2F2YWlsYWJsZSA9IFRydWUKICAgICAgICAgICAgcmV0dXJuIFRydWUsIHJlc3BvbnNlLmpzb24oKSBpZiByZXNwb25zZS5oZWFkZXJzLmdldCgnY29udGVudC10eXBlJykgPT0gJ2FwcGxpY2F0aW9uL2pzb24nIGVsc2UgTm9uZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBr4bq/dCBu4buRaSDEkeG6v24gY2xvdWQgc2VydmVyOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgbmV0d29ya19hdmFpbGFibGUgPSBGYWxzZQogICAgICAgICAgICByZXR1cm4gRmFsc2UsIE5vbmUKICAgICAgICAgICAgCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga+G6v3QgbuG7kWkgbeG6oW5nOiB7ZX0iKQogICAgICAgIG5ldHdvcmtfYXZhaWxhYmxlID0gRmFsc2UKICAgICAgICByZXR1cm4gRmFsc2UsIE5vbmUKCmRlZiBpc19oZWxwZXJfYXZhaWxhYmxlKCkgLT4gYm9vbDoKICAgICIiIlRy4bqjIHbhu4EgdHLhuqFuZyB0aMOhaSBoaeG7h24gdOG6oWkgY+G7p2EgaGVscGVyIHNlcnZpY2UiIiIKICAgIHJldHVybiBoZWxwZXJfYXZhaWxhYmxlCgpkZWYgaXNfbmV0d29ya19hdmFpbGFibGUoKSAtPiBib29sOgogICAgIiIiVHLhuqMgduG7gSB0cuG6oW5nIHRow6FpIGhp4buHbiB04bqhaSBj4bunYSBr4bq/dCBu4buRaSBt4bqhbmciIiIKICAgIHJldHVybiBuZXR3b3JrX2F2YWlsYWJsZQoKZGVmIHJldHJ5X3VudGlsX3N1Y2Nlc3MoZnVuYywgbWF4X3JldHJpZXM6IGludCwgZGVsYXk6IGludCwgKmFyZ3MsICoqa3dhcmdzKSAtPiBUdXBsZVtib29sLCBPcHRpb25hbFtBbnldXToKICAgICIiIgogICAgVGjhu60gdGjhu7FjIGhp4buHbiBt4buZdCBow6BtIG5oaeG7gXUgbOG6p24gY2hvIMSR4bq/biBraGkgdGjDoG5oIGPDtG5nCiAgICAKICAgIEFyZ3M6CiAgICAgICAgZnVuYzogSMOgbSBj4bqnbiB0aOG7sWMgaGnhu4duCiAgICAgICAgbWF4X3JldHJpZXM6IFPhu5EgbOG6p24gdGjhu60gdOG7kWkgxJFhCiAgICAgICAgZGVsYXk6IFRo4budaSBnaWFuIGNo4budIGdp4buvYSBjw6FjIGzhuqduIHRo4butIChnacOieSkKICAgICAgICAqYXJncywgKiprd2FyZ3M6IFRoYW0gc+G7kSBjaG8gaMOgbSBj4bqnbiB0aOG7sWMgaGnhu4duCiAgICAgICAgCiAgICBSZXR1cm5zOgogICAgICAgIFR1cGxlW2Jvb2wsIEFueV06IChUaMOgbmggY8O0bmcgaGF5IGtow7RuZywgS+G6v3QgcXXhuqMgdHLhuqMgduG7gSBu4bq/dSBjw7MpCiAgICAiIiIKICAgIHJldHJ5X2NvdW50ID0gMAogICAgc3VjY2VzcyA9IEZhbHNlCiAgICByZXN1bHQgPSBOb25lCiAgICAKICAgIHdoaWxlIHJldHJ5X2NvdW50IDwgbWF4X3JldHJpZXMgYW5kIG5vdCBzdWNjZXNzOgogICAgICAgIHN1Y2Nlc3MsIHJlc3VsdCA9IGZ1bmMoKmFyZ3MsICoqa3dhcmdzKQogICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgIHJldHVybiBUcnVlLCByZXN1bHQKICAgICAgICAgICAgCiAgICAgICAgcmV0cnlfY291bnQgKz0gMQogICAgICAgIGlmIHJldHJ5X2NvdW50IDwgbWF4X3JldHJpZXM6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlRo4butIGzhuqFpIHNhdSB7ZGVsYXl9IGdpw6J5Li4uIChjw7JuIHttYXhfcmV0cmllcyAtIHJldHJ5X2NvdW50fSBs4bqnbikiKQogICAgICAgICAgICB0aW1lLnNsZWVwKGRlbGF5KQogICAgCiAgICByZXR1cm4gRmFsc2UsIE5vbmUgCgpkZWYgZ2V0X2RldmljZV9pZF9mcm9tX3N5c3RlbSgpIC0+IHN0cjoKICAgICIiIgogICAgTOG6pXkgZGV2aWNlX2lkIHThu6sgaOG7hyB0aOG7kW5nIGLhurFuZyBs4buHbmggZ2V0cHJvcCByby5zZXJpYWxubyAoZMOgbmggY2hvIEFuZHJvaWQvVGVybXV4KQogICAgVHLDqm4gV2luZG93cyBz4bq9IHRy4bqjIHbhu4EgZW1wdHkgc3RyaW5nIG3hu5l0IGPDoWNoIGltIGzhurduZy4KICAgIAogICAgUmV0dXJuczoKICAgICAgICBzdHI6IERldmljZSBJRCBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3Uga2jDtG5nIGzhuqV5IMSRxrDhu6NjCiAgICAiIiIKICAgIHRyeToKICAgICAgICBpbXBvcnQgc3VicHJvY2VzcwogICAgICAgIGltcG9ydCBwbGF0Zm9ybQogICAgICAgIAogICAgICAgICMgTuG6v3UgxJFhbmcgY2jhuqF5IHRyw6puIFdpbmRvd3MsIGNo4bqlcCBuaOG6rW4gbOG7l2kgaW0gbOG6t25nCiAgICAgICAgaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gIldpbmRvd3MiOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoIsSQYW5nIGNo4bqheSB0csOqbiBXaW5kb3dzLCBi4buPIHF1YSBs4buHbmggZ2V0cHJvcCAoZMOgbmggY2hvIEFuZHJvaWQvVGVybXV4KSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIAogICAgICAgICMgVHLDqm4gQW5kcm9pZC9UZXJtdXgsIHRo4buxYyBoaeG7h24gbOG7h25oIGdldHByb3Agcm8uc2VyaWFsbm8KICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJnZXRwcm9wIiwgInJvLnNlcmlhbG5vIl0sCiAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICkKICAgICAgICAKICAgICAgICAjIEzhuqV5IGvhur90IHF14bqjIHbDoCBsb+G6oWkgYuG7jyBraG/huqNuZyB0cuG6r25nIHRo4burYQogICAgICAgIGRldmljZV9pZCA9IHJlc3VsdC5zdGRvdXQuc3RyaXAoKQogICAgICAgIAogICAgICAgIGlmIGRldmljZV9pZDoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGzhuqV5IMSRxrDhu6NjIGRldmljZV9pZCB04burIGjhu4cgdGjhu5FuZzoge2RldmljZV9pZH0iKQogICAgICAgICAgICByZXR1cm4gZGV2aWNlX2lkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBs4bqleSDEkcaw4bujYyBkZXZpY2VfaWQgdOG7qyBo4buHIHRo4buRbmciKQogICAgICAgICAgICByZXR1cm4gIiIKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAjIEltIGzhurduZyB0csOqbiBXaW5kb3dzLCBjaOG7iSBsb2cgZGVidWcKICAgICAgICB0cnk6CiAgICAgICAgICAgIGltcG9ydCBwbGF0Zm9ybQogICAgICAgICAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAiV2luZG93cyI6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJM4buXaSBnZXRwcm9wIHRyw6puIFdpbmRvd3MgKGLDrG5oIHRoxrDhu51uZyk6IHtzdHIoZSl9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBs4bqleSBkZXZpY2VfaWQgdOG7qyBo4buHIHRo4buRbmc6IHtzdHIoZSl9IikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkzhu5dpIGtoaSBs4bqleSBkZXZpY2VfaWQ6IHtzdHIoZSl9IikKICAgICAgICByZXR1cm4gIiIgCgojIEjDoG0ga2nhu4NtIHRyYSBr4bq/dCBu4buRaSBt4bqhbmcKZGVmIGNoZWNrX25ldHdvcmtfY29ubmVjdGlvbigpIC0+IFR1cGxlW2Jvb2wsIHN0cl06CiAgICAiIiIKICAgIEtp4buDbSB0cmEga+G6v3QgbuG7kWkgbeG6oW5nIGLhurFuZyBjw6FjaCBwaW5nIGdvb2dsZS5jb20KICAgIAogICAgUmV0dXJuczoKICAgICAgICBUdXBsZVtib29sLCBzdHJdOiAoVHJ1ZSwgIlN1Y2Nlc3MiKSBu4bq/dSB0aMOgbmggY8O0bmcsIChGYWxzZSwgZXJyb3JfbWVzc2FnZSkgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAiIiIKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbSIsIHRpbWVvdXQ9NSkKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgIHJldHVybiBUcnVlLCAiU3VjY2VzcyIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gRmFsc2UsIGYiSFRUUCBlcnJvcjoge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIKICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcmV0dXJuIEZhbHNlLCBmIk5ldHdvcmsgZXJyb3I6IHtzdHIoZSl9IgoKIyBIw6BtIGtp4buDbSB0cmEgSGVscGVyU2VydmljZQpkZWYgY2hlY2tfaGVscGVyX3NlcnZpY2UoaGVscGVyKSAtPiBUdXBsZVtib29sLCBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV1dOgogICAgIiIiCiAgICBLaeG7g20gdHJhIGvhur90IG7hu5FpIMSR4bq/biBIZWxwZXJTZXJ2aWNlCiAgICAKICAgIEFyZ3M6CiAgICAgICAgaGVscGVyOiBIZWxwZXJTZXJ2aWNlIGluc3RhbmNlCiAgICAgICAgCiAgICBSZXR1cm5zOgogICAgICAgIFR1cGxlW2Jvb2wsIE9wdGlvbmFsW0RpY3RdXTogKFRydWUsIHJlc3BvbnNlX2RhdGEpIG7hur91IHRow6BuaCBjw7RuZywgKEZhbHNlLCBOb25lKSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICIiIgogICAgdHJ5OgogICAgICAgICMgR+G7jWkgQVBJIGtp4buDbSB0cmEKICAgICAgICByZXNwb25zZSA9IGhlbHBlci5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6owogICAgICAgIGlmIHJlc3BvbnNlIGFuZCAic3RhdHVzIiBpbiByZXNwb25zZSBhbmQgcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgcmV0dXJuIFRydWUsIHJlc3BvbnNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlLCBOb25lCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHJldHVybiBGYWxzZSwgTm9uZQoKIyBIw6BtIGvhur90IG7hu5FpIEFEQgpkZWYgY29ubmVjdF9hZGIoaG9zdDogc3RyLCBwb3J0OiBpbnQpIC0+IGJvb2w6CiAgICAiIiIKICAgIEvhur90IG7hu5FpIMSR4bq/biB0aGnhur90IGLhu4sgQW5kcm9pZCBxdWEgQURCCiAgICAKICAgIEFyZ3M6CiAgICAgICAgaG9zdDogxJDhu4thIGNo4buJIElQIGPhu6dhIHRoaeG6v3QgYuG7iwogICAgICAgIHBvcnQ6IFBvcnQgQURCICh0aMaw4budbmcgbMOgIDU1NTUpCiAgICAgICAgCiAgICBSZXR1cm5zOgogICAgICAgIGJvb2w6IFRydWUgbuG6v3Uga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICIiIgogICAgbG9nZ2VyID0gZ2V0X2xvZ2dlcigiQURCIikKICAgIAogICAgdHJ5OgogICAgICAgICMgS2nhu4NtIHRyYSBBREIgxJHDoyDEkcaw4bujYyBjw6BpIMSR4bq3dCBjaMawYQogICAgICAgIHRyeToKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJhZGIiLCAidmVyc2lvbiJdLCBjaGVjaz1UcnVlLCBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLCBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFKQogICAgICAgIGV4Y2VwdCAoc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3IsIEZpbGVOb3RGb3VuZEVycm9yKToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJBREIga2jDtG5nIMSRxrDhu6NjIGPDoGkgxJHhurd0IGhv4bq3YyBraMO0bmcgY8OzIHRyb25nIFBBVEgiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgIyBLaOG7n2kgxJHhu5luZyBBREIgc2VydmVyIG7hur91IGNoxrBhIGNo4bqheQogICAgICAgIHN1YnByb2Nlc3MucnVuKFsiYWRiIiwgInN0YXJ0LXNlcnZlciJdLCBjaGVjaz1GYWxzZSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSkKICAgICAgICAKICAgICAgICAjIEvhur90IG7hu5FpIMSR4bq/biB0aGnhur90IGLhu4sKICAgICAgICBjb25uZWN0X2NtZCA9IFsiYWRiIiwgImNvbm5lY3QiLCBmIntob3N0fTp7cG9ydH0iXQogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNvbm5lY3RfY21kLCBjaGVjaz1GYWxzZSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwgdGV4dD1UcnVlKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6owogICAgICAgIG91dHB1dCA9IHJlc3VsdC5zdGRvdXQKICAgICAgICBpZiAiY29ubmVjdGVkIiBpbiBvdXRwdXQubG93ZXIoKSBhbmQgInVuYWJsZSIgbm90IGluIG91dHB1dC5sb3dlcigpOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6Mga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nIMSR4bq/biB7aG9zdH06e3BvcnR9IikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4Mga+G6v3QgbuG7kWkgxJHhur9uIHtob3N0fTp7cG9ydH06IHtvdXRwdXR9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkga+G6v3QgbuG7kWkgQURCIMSR4bq/biB7aG9zdH06e3BvcnR9IikKICAgICAgICByZXR1cm4gRmFsc2UgCgpkZWYgcmVhZF91c2VyX2lkX2Zyb21fa2V5X2ZpbGUoKSAtPiBPcHRpb25hbFtzdHJdOgogICAgIiIiCiAgICDEkOG7jWMgdXNlcl9pZCB04burIGZpbGUgLmRuZHZpbmFrZXkgdHJvbmcgdGjGsCBt4bulYyBjaGEgY+G7p2EgcHJvamVjdAogICAgCiAgICBSZXR1cm5zOgogICAgICAgIE9wdGlvbmFsW3N0cl06IHVzZXJfaWQgxJHDoyB0cmltIGhv4bq3YyBOb25lIG7hur91IGtow7RuZyDEkeG7jWMgxJHGsOG7o2MKICAgICIiIgogICAgdHJ5OgogICAgICAgICMgVOG6oW8gxJHGsOG7nW5nIGThuqtuIHThu5tpIGZpbGUgLmRuZHZpbmFrZXkgKHRoxrAgbeG7pWMgY2hhIGPhu6dhIHByb2plY3QpCiAgICAgICAgcGFyZW50X2RpciA9IG9zLnBhdGguZGlybmFtZShjb25maWcuQkFTRV9ESVIpCiAgICAgICAga2V5X2ZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihwYXJlbnRfZGlyLCAnLmRuZHZpbmFrZXknKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBmaWxlIGPDsyB04buTbiB04bqhaSBraMO0bmcKICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoa2V5X2ZpbGVfcGF0aCk6CiAgICAgICAgICAgIGxvZ2dlciA9IGdldF9sb2dnZXIoIlVzZXJJZFJlYWRlciIpCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkZpbGUgLmRuZHZpbmFrZXkga2jDtG5nIHThu5NuIHThuqFpIHThuqFpOiB7a2V5X2ZpbGVfcGF0aH0iKQogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkNoxrDGoW5nIHRyw6xuaCBz4bq9IGThu6tuZyB2w6wga2jDtG5nIGPDsyBmaWxlIGtleSEiKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIAogICAgICAgICMgxJDhu41jIG7hu5lpIGR1bmcgZmlsZQogICAgICAgIHdpdGggb3BlbihrZXlfZmlsZV9wYXRoLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgIHVzZXJfaWQgPSBmLnJlYWQoKS5zdHJpcCgpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHVzZXJfaWQga2jDtG5nIHLhu5duZwogICAgICAgIGlmIG5vdCB1c2VyX2lkOgogICAgICAgICAgICBsb2dnZXIgPSBnZXRfbG9nZ2VyKCJVc2VySWRSZWFkZXIiKQogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkZpbGUgLmRuZHZpbmFrZXkgcuG7l25nIGhv4bq3YyBjaOG7iSBjaOG7qWEga2hv4bqjbmcgdHLhuq9uZyIpCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiQ2jGsMahbmcgdHLDrG5oIHPhur0gZOG7q25nIHbDrCBmaWxlIGtleSBraMO0bmcgaOG7o3AgbOG7hyEiKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIAogICAgICAgIGxvZ2dlciA9IGdldF9sb2dnZXIoIlVzZXJJZFJlYWRlciIpCiAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMSR4buNYyB1c2VyX2lkIHRow6BuaCBjw7RuZzoge3VzZXJfaWR9IikKICAgICAgICByZXR1cm4gdXNlcl9pZAogICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlciA9IGdldF9sb2dnZXIoIlVzZXJJZFJlYWRlciIpCiAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIMSR4buNYyBmaWxlIC5kbmR2aW5ha2V5OiB7ZX0iKQogICAgICAgIGxvZ2dlci5lcnJvcigiQ2jGsMahbmcgdHLDrG5oIHPhur0gZOG7q25nIHbDrCBraMO0bmcgdGjhu4MgxJHhu41jIGZpbGUga2V5ISIpCiAgICAgICAgcmV0dXJuIE5vbmU=').decode('utf-8'))
