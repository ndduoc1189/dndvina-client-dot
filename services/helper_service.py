import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHJlCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBvcwppbXBvcnQgY29uZmlnCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBUdXBsZSwgTGlzdCwgVW5pb24KdHJ5OgogICAgZnJvbSBseG1sIGltcG9ydCBldHJlZQogICAgTFhNTF9BVkFJTEFCTEUgPSBUcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIExYTUxfQVZBSUxBQkxFID0gRmFsc2UKCmNsYXNzIEhlbHBlclNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgYmFzZV91cmw6IHN0ciA9ICJodHRwOi8vbG9jYWxob3N0OjgwODAiKToKICAgICAgICBzZWxmLmJhc2VfdXJsID0gYmFzZV91cmwKICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHNlbGYuZGV2aWNlX2lwID0gTm9uZQogICAgICAgIAogICAgICAgICMgTuG6v3UgYmFzZV91cmwgY2jhu6lhIMSR4buLYSBjaOG7iSBJUCwgdGjhu60ga+G6v3QgbuG7kWkgQURCCiAgICAgICAgaXBfbWF0Y2ggPSByZS5zZWFyY2gociJodHRwOi8vKFswLTldK1wuWzAtOV0rXC5bMC05XStcLlswLTldKykiLCBiYXNlX3VybCkKICAgICAgICBpZiBpcF9tYXRjaDoKICAgICAgICAgICAgc2VsZi5kZXZpY2VfaXAgPSBpcF9tYXRjaC5ncm91cCgxKQogICAgICAgICAgICBzZWxmLmNoZWNrX2FuZF9jb25uZWN0X2FkYigpCgogICAgZGVmIGNoZWNrX2FuZF9jb25uZWN0X2FkYihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgdsOgIGvhur90IG7hu5FpIEFEQiB04bubaSB0aGnhur90IGLhu4sKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBBREIgY8OzIMSRxrDhu6NjIGPDoGkgxJHhurd0IGtow7RuZwogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbImFkYiIsICItLXZlcnNpb24iXSwgY2hlY2s9VHJ1ZSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS+G6v3QgbuG7kWkgQURCIMSR4bq/biB0aGnhur90IGLhu4sgc+G7rSBk4bulbmcgxJHhu4thIGNo4buJIHThu6sgY29uZmlnCiAgICAgICAgICAgIGFkYl9hZGRyZXNzID0gZiJ7Y29uZmlnLkFEQl9IT1NUfTp7Y29uZmlnLkFEQl9QT1JUfSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu60ga+G6v3QgbuG7kWkgxJHhur9uIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBjb25uZWN0X3Byb2Nlc3MgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgIFsiYWRiIiwgImNvbm5lY3QiLCBhZGJfYWRkcmVzc10sCiAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB0ZXh0PVRydWUKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IHF14bqjIGvhur90IG7hu5FpCiAgICAgICAgICAgIGlmICJjb25uZWN0ZWQiIGluIGNvbm5lY3RfcHJvY2Vzcy5zdGRvdXQubG93ZXIoKToKICAgICAgICAgICAgICAgIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZCA9IFRydWUKICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyBr4bq/dCBu4buRaSBBREIgdGjDoG5oIGPDtG5nIMSR4bq/biB7YWRiX2FkZHJlc3N9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgKHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yLCBGaWxlTm90Rm91bmRFcnJvcikgYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJLaMO0bmcgdGjhu4Mga+G6v3QgbuG7kWkgQURCOiB7ZX0iKQogICAgICAgIAogICAgICAgIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9nZXRfYWRiX2RldmljZV9wYXJhbShzZWxmKSAtPiBMaXN0W3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgVHLhuqMgduG7gSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLIGNobyBs4buHbmggQURCCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtzdHJdOiBEYW5oIHPDoWNoIHRoYW0gc+G7kSBbLXMsIGRldmljZV9pZF0gaG/hurdjIGxpc3QgcuG7l25nIG7hur91IGtow7RuZyBjw7MgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIHJldHVybiBbIi1zIiwgYWRiX2FkZHJlc3NdCiAgICAgICAgcmV0dXJuIFtdCgogICAgZGVmIF9tYWtlX3JlcXVlc3Qoc2VsZiwgZW5kcG9pbnQ6IHN0ciwgcGFyYW1zOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gcmVxdWVzdCBBUEkgdsOgIHRy4bqjIHbhu4Ega+G6v3QgcXXhuqMgZOG6oW5nIEpTT04gaG/hurdjIFhNTAogICAgICAgICIiIgogICAgICAgIHVybCA9IGYie3NlbGYuYmFzZV91cmx9L3tlbmRwb2ludH0iCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRoaeG6v3QgbOG6rXAgdGltZW91dCBjaG8gcmVxdWVzdAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIENvbnRlbnQtVHlwZQogICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICMgVHLhuqMgduG7gSBYTUwgZMaw4bubaSBk4bqhbmcgdGV4dAogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLnRleHR9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgSlNPTgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlRpbWVvdXQ6CiAgICAgICAgICAgIHByaW50KGYiUmVxdWVzdCB0aW1lb3V0IGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCIpCiAgICAgICAgICAgIHNlbGYuX3Jlc3RhcnRfaGVscGVyX2FwcCgpCiAgICAgICAgICAgICMgVGjhu60gbOG6oWkgcmVxdWVzdCBzYXUga2hpIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKSAgIyBDaOG7nSAxIGdpw6J5IMSR4buDIOG7qW5nIGThu6VuZyBraOG7n2kgxJHhu5luZwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJkYXRhIjogcmVzcG9uc2UudGV4dH0KICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIlbhuqtuIGzhu5dpIHNhdSBraGkgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvciBhcyBlOgogICAgICAgICAgICAjIELhuq90IGzhu5dpIGvhur90IG7hu5FpIGLhu4sgdOG7qyBjaOG7kWkgaG/hurdjIGtow7RuZyB0aOG7gyBr4bq/dCBu4buRaQogICAgICAgICAgICBwcmludChmIkzhu5dpIGvhur90IG7hu5FpIGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgc2VsZi5fcmVzdGFydF9oZWxwZXJfYXBwKCkKICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSByZXF1ZXN0IHNhdSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpICAjIENo4budIDIgZ2nDonkgxJHhu4Mg4bupbmcgZOG7pW5nIGto4bufaSDEkeG7mW5nCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29udGVudF90eXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICAgICAgaWYgJ2FwcGxpY2F0aW9uL3htbCcgaW4gY29udGVudF90eXBlIG9yIGVuZHBvaW50ID09ICdkdW1wLXNjcmVlbi14bWwnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgImRhdGEiOiByZXNwb25zZS50ZXh0fQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIHJlcXVlc3Q6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQoKICAgIGRlZiBfcmVzdGFydF9oZWxwZXJfYXBwKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBz4butIGThu6VuZyBBREIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgaGVscGVyIGFwcCBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCAiYW0iLCAic3RhcnQiLCAiLW4iLCAiY29tLmRuZHZpbmEuaGVscGVyLy5NYWluQWN0aXZpdHkiXQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcHJpbnQoIsSQw6Mga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIktow7RuZyB0aOG7gyBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHbDrCBBREIgY2jGsGEgxJHGsOG7o2Mga+G6v3QgbuG7kWkiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgdGFwKHNlbGYsIHg6IGludCwgeTogaW50KSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaOG6oW0gdsOgbyB24buLIHRyw60geCx5IHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJ0YXAiLCBwYXJhbXM9eyJ4IjogeCwgInkiOiB5fSkKCiAgICBkZWYgdGFwX2VsZW1lbnQoc2VsZiwgYm91bmRzOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIG3hu5l0IHBo4bqnbiB04butIGThu7FhIHRyw6puIGJvdW5kcyBj4bunYSBuw7MKICAgICAgICBGb3JtYXQgYm91bmRzOiAiW3gxLHkxXVt4Mix5Ml0iCiAgICAgICAgIiIiCiAgICAgICAgIyBQaMOibiB0w61jaCBib3VuZHMgxJHhu4MgbOG6pXkgdOG7jWEgxJHhu5kKICAgICAgICBtYXRjaCA9IHJlLm1hdGNoKHIiXFsoXGQrKSwoXGQrKVxdXFsoXGQrKSwoXGQrKVxdIiwgYm91bmRzKQogICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IG1hcChpbnQsIG1hdGNoLmdyb3VwcygpKQogICAgICAgICAgICAjIENo4buNbiBt4buZdCDEkWnhu4NtIG5n4bqrdSBuaGnDqm4gdHJvbmcgYm91bmRzCiAgICAgICAgICAgIHggPSByYW5kb20ucmFuZGludCh4MSwgeDIpCiAgICAgICAgICAgIHkgPSByYW5kb20ucmFuZGludCh5MSwgeTIpCiAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcCh4LCB5KQogICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIsSQ4buLbmggZOG6oW5nIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hyJ9CgogICAgZGVmIHN3aXBlX3VwKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCBsw6puIHThu6sgduG7iyB0csOtIG5n4bqrdSBuaGnDqm4gcGjDuSBo4bujcAogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX3VwIikKCiAgICBkZWYgc3dpcGVfZG93bihzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgeHXhu5FuZyB04burIHbhu4sgdHLDrSBuZ+G6q3Ugbmhpw6puIHBow7kgaOG7o3AKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV9kb3duIikKCiAgICBkZWYgaW5wdXRfdGV4dChzZWxmLCB0ZXh0OiBzdHIsIHNwZWVkOiBmbG9hdCA9IDEuMCwgCiAgICAgICAgICAgICAgICAgIGRpcmVjdF9tb2RlOiBib29sID0gRmFsc2UsIHBlcmZlY3RfbW9kZTogYm9vbCA9IFRydWUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3DtCBwaOG7j25nIGfDtSBwaMOtbSB24bubaSB04buRYyDEkeG7mSBuZ+G6q3Ugbmhpw6puIGdp4buRbmcgbmfGsOG7nWkgdGjhuq10CiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAidGV4dCI6IHRleHQsCiAgICAgICAgICAgICJzcGVlZCI6IHNwZWVkLAogICAgICAgICAgICAiZGlyZWN0X21vZGUiOiBzdHIoZGlyZWN0X21vZGUpLmxvd2VyKCksCiAgICAgICAgICAgICJwZXJmZWN0X21vZGUiOiBzdHIocGVyZmVjdF9tb2RlKS5sb3dlcigpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImlucHV0X3RleHQiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBzaG93X3RvYXN0KHNlbGYsIG1lc3NhZ2U6IHN0ciwgdHlwZV86IHN0ciA9ICJpbmZvIiwgCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBzdHIgPSAiYm90dG9tIikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIHRvYXN0CiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICJ0eXBlIjogdHlwZV8sCiAgICAgICAgICAgICJwb3NpdGlvbiI6IHBvc2l0aW9uCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInRvYXN0LW1lc3NhZ2UiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBnZXRfZGV2aWNlX2luZm8oc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGjDtG5nIHRpbiBjaGkgdGnhur90IHbhu4EgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0ID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJkZXZpY2UtaW5mbyIpCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBr4bq/dCBxdeG6oyB0aMOgbmggY8O0bmcsIHRow6ptIHRow7RuZyB0aW4gaW50ZXJuZXQgSVAKICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiByZXN1bHQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgaW50ZXJuZXQgSVAgYuG6sW5nIGN1cmwKICAgICAgICAgICAgICAgIGludGVybmV0X2lwID0gc2VsZi5fZ2V0X2ludGVybmV0X2lwKCkKICAgICAgICAgICAgICAgIGlmIGludGVybmV0X2lwOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJpbnRlcm5ldF9pcCJdID0gaW50ZXJuZXRfaXAKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bImludGVybmV0X2lwIl0gPSAidW5rbm93biIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgaW50ZXJuZXQgSVA6IHtlfSIpCiAgICAgICAgICAgICAgICByZXN1bHRbImRhdGEiXVsiaW50ZXJuZXRfaXAiXSA9ICJlcnJvciIKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAKICAgIGRlZiBfZ2V0X2ludGVybmV0X2lwKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSDEkeG7i2EgY2jhu4kgSVAgY8O0bmcgY+G7mW5nIGLhurFuZyByZXF1ZXN0cwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogxJDhu4thIGNo4buJIElQIGPDtG5nIGPhu5luZyBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIiwgdGltZW91dD0zKQogICAgICAgICAgICBpcCA9IHJlc3BvbnNlLnRleHQuc3RyaXAoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIMSR4buLbmggZOG6oW5nIElQIMSRxqFuIGdp4bqjbgogICAgICAgICAgICBpZiByZS5tYXRjaChyJ15cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9JCcsIGlwKToKICAgICAgICAgICAgICAgIHJldHVybiBpcAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJL4bq/dCBxdeG6oyBraMO0bmcgcGjhuqNpIGzDoCBJUCBo4bujcCBs4buHOiB7aXB9IikKICAgICAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuVGltZW91dDoKICAgICAgICAgICAgcHJpbnQoIlRpbWVvdXQga2hpIGzhuqV5IGludGVybmV0IElQICgzIGdpw6J5KSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgaW50ZXJuZXQgSVA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraMO0bmcgeMOhYyDEkeG7i25oIGtoaSBs4bqleSBpbnRlcm5ldCBJUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIGR1bXBfc2NyZWVuX3htbChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgRHVtcCB0b8OgbiBi4buZIGPhuqV1IHRyw7pjIFhNTCBj4bunYSBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIFRy4bqjIHbhu4EgbuG7mWkgZHVuZyBYTUwgZMaw4bubaSBk4bqhbmcgY2h14buXaQogICAgICAgICIiIgogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJkdW1wLXNjcmVlbi14bWwiKQogICAgICAgIGlmIHJlc3BvbnNlWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdCiAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIG9wZW5fYXBwKHNlbGYsIHBhY2thZ2U6IHN0ciwgYWN0aXZpdHk6IHN0ciA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3hu58gbeG7mXQg4bupbmcgZOG7pW5nIHbhu5tpIHBhY2thZ2UgbmFtZSB2w6AgYWN0aXZpdHkgY+G7pSB0aOG7gwogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsicGFja2FnZSI6IHBhY2thZ2V9CiAgICAgICAgaWYgYWN0aXZpdHk6CiAgICAgICAgICAgIHBhcmFtc1siYWN0aXZpdHkiXSA9IGFjdGl2aXR5CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgib3Blbl9hcHAiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBjbG9zZV9hcHAoc2VsZiwgcGFja2FnZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICDEkMOzbmcgbeG7mXQg4bupbmcgZOG7pW5nIMSRYW5nIGNo4bqheQogICAgICAgIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMSQw7NuZyDhu6luZyBk4bulbmcgYuG6sW5nIEFEQgogICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbInNoZWxsIiwgZiJhbSBmb3JjZS1zdG9wIHtwYWNrYWdlfSJdCiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgIm1lc3NhZ2UiOiBmIsSQw6MgxJHDs25nIHtwYWNrYWdlfSBi4bqxbmcgQURCIn0KICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSDEkcOzbmcg4bupbmcgZOG7pW5nIGLhurFuZyBBREI6IHtlfSIpCiAgICAgICAgICAgICAgICAjIE7hur91IGzhu5dpLCB0aOG7rSBwaMawxqFuZyB0aOG7qWMgSFRUUAogICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgSFRUUCBBUEkgbuG6v3Uga2jDtG5nIGPDsyBBREIgaG/hurdjIEFEQiBi4buLIGzhu5dpCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfaG9tZSIpCgogICAgZGVmIF9zYW5pdGl6ZV94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0cikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwgxJHhu4MgdHLDoW5oIGzhu5dpIGtoaSBwaMOibiB0w61jaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBDaHXhu5dpIFhNTCBj4bqnbiB44butIGzDvQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IENodeG7l2kgWE1MIMSRw6MgxJHGsOG7o2MgeOG7rSBsw70KICAgICAgICAiIiIKICAgICAgICAjIFRoYXkgdGjhur8gY8OhYyBrw70gdOG7sSAmIGtow7RuZyBo4bujcCBs4buHIGLhurFuZyAmYW1wOwogICAgICAgICMgTmjGsG5nIGdp4buvIG5ndXnDqm4gY8OhYyBlbnRpdHkgaOG7o3AgbOG7hyBuaMawICZhbXA7LCAmbHQ7LCAmZ3Q7LCAmcXVvdDssICZhcG9zOwogICAgICAgIHhtbF9jb250ZW50ID0gcmUuc3ViKHInJig/IShhbXB8bHR8Z3R8cXVvdHxhcG9zKTspJywgJyZhbXA7JywgeG1sX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgIyBMb+G6oWkgYuG7jyBjw6FjIGvDvSB04buxIMSRaeG7gXUga2hp4buDbiBraMO0bmcgaOG7o3AgbOG7hyB0cm9uZyBYTUwKICAgICAgICB4bWxfY29udGVudCA9IHJlLnN1YihyJ1tceDAwLVx4MDhceDBCXHgwQ1x4MEUtXHgxRl0nLCAnJywgeG1sX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHhtbF9jb250ZW50CgogICAgZGVmIGZpbmRfZWxlbWVudF9pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gcGjhuqduIHThu60gdHJvbmcgWE1MIGThu7FhIHRyw6puIHRleHQsIGNvbnRlbnQtZGVzYywgcmVzb3VyY2UtaWQgaG/hurdjIGNsYXNzCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IE7hu5lpIGR1bmcgWE1MCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBQaOG6p24gdOG7rSDEkeG6p3UgdGnDqm4gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyBYUGF0aCBxdWVyeSBk4buxYSB0csOqbiBjw6FjIMSRaeG7gXUga2nhu4duCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdGV4dD0ie3RleHR9IicpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2MgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAcmVzb3VyY2UtaWQ9IntyZXNvdXJjZV9pZH0iJykKICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY2xhc3M9IntjbGFzc19uYW1lfSInKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSA9ICIvL25vZGUiCiAgICAgICAgICAgICAgICBpZiBjb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ICs9ICJbIiArICIgYW5kICIuam9pbihjb25kaXRpb25zKSArICJdIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gcGjhuqduIHThu60gxJHhuqd1IHRpw6puIHBow7kgaOG7o3AKICAgICAgICAgICAgICAgIGVsZW1lbnQgPSByb290LnhwYXRoKHhwYXRoX3F1ZXJ5KQogICAgICAgICAgICAgICAgaWYgZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZWxlbWVudF90b19kaWN0KGVsZW1lbnRbMF0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHTDrG0gcGjhuqduIHThu60gduG7m2kgbHhtbDoge2V9IikKICAgICAgICAKICAgICAgICAjIEZhbGxiYWNrOiBUw6xtIGtp4bq/bSBi4bqxbmcgcmVnZXgKICAgICAgICBpZiB0ZXh0OgogICAgICAgICAgICBwYXR0ZXJuID0gZid0ZXh0PSJ7dGV4dH0iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgdGV4dAogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgaWYgY29udGVudF9kZXNjOgogICAgICAgICAgICBwYXR0ZXJuID0gZidjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgaWYgcmVzb3VyY2VfaWQ6CiAgICAgICAgICAgIHBhdHRlcm4gPSBmJ3Jlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBpZiBjbGFzc19uYW1lOgogICAgICAgICAgICBwYXR0ZXJuID0gZidjbGFzcz0ie2NsYXNzX25hbWV9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIGNsYXNzCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSB0cm9uZyBYTUwgcGjDuSBo4bujcCB24bubaSDEkWnhu4F1IGtp4buHbgogICAgICAgICIiIgogICAgICAgIHJlc3VsdHMgPSBbXQogICAgICAgIAogICAgICAgIGlmIG5vdCB4bWxfY29udGVudDoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHMKICAgICAgICAgICAgCiAgICAgICAgaWYgTFhNTF9BVkFJTEFCTEU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTCDEkeG7gyB0csOhbmggbOG7l2kgRW50aXR5UmVmCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyBYUGF0aCBxdWVyeSBk4buxYSB0csOqbiBjw6FjIMSRaeG7gXUga2nhu4duCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdGV4dD0ie3RleHR9IicpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2MgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAcmVzb3VyY2UtaWQ9IntyZXNvdXJjZV9pZH0iJykKICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY2xhc3M9IntjbGFzc19uYW1lfSInKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSA9ICIvL25vZGUiCiAgICAgICAgICAgICAgICBpZiBjb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ICs9ICJbIiArICIgYW5kICIuam9pbihjb25kaXRpb25zKSArICJdIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gdOG6pXQgY+G6oyBwaOG6p24gdOG7rSBwaMO5IGjhu6NwCiAgICAgICAgICAgICAgICBlbGVtZW50cyA9IHJvb3QueHBhdGgoeHBhdGhfcXVlcnkpCiAgICAgICAgICAgICAgICBmb3IgZWxlbWVudCBpbiBlbGVtZW50czoKICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChzZWxmLl9lbGVtZW50X3RvX2RpY3QoZWxlbWVudCkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHTDrG0gcGjhuqduIHThu60gduG7m2kgbHhtbDoge2V9IikKICAgICAgICAgICAgICAgIHByaW50KGYiVGjhu60gdMOsbSBwaOG6p24gdOG7rSBi4bqxbmcgcGjGsMahbmcgdGjhu6ljIHRoYXkgdGjhur8uLi4iKQogICAgICAgIAogICAgICAgICMgRmFsbGJhY2s6IFTDrG0ga2nhur9tIGLhurFuZyByZWdleCAoY2jhu4kgdHLhuqMgduG7gSBr4bq/dCBxdeG6oyDEkcahbiBnaeG6o24pCiAgICAgICAgaWYgbm90IHJlc3VsdHMgYW5kIHRleHQ6CiAgICAgICAgICAgIHBhdHRlcm4gPSBmJ3RleHQ9Int0ZXh0fSInCiAgICAgICAgICAgIGZvciBtYXRjaCBpbiByZS5maW5kaXRlcihwYXR0ZXJuLCB4bWxfY29udGVudCk6CiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KSkKICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgCiAgICBkZWYgX2V4dHJhY3RfYXR0cmlidXRlcyhzZWxmLCBub2RlX2NvbnRlbnQ6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVHLDrWNoIHh14bqldCBjw6FjIHRodeG7mWMgdMOtbmggdOG7qyBu4buZaSBkdW5nIGPhu6dhIG3hu5l0IHRo4bq7IG5vZGUKICAgICAgICAiIiIKICAgICAgICBhdHRyaWJ1dGVzID0ge30KICAgICAgICAKICAgICAgICAjIEPDoWMgdGh14buZYyB0w61uaCBj4bqnbiB0csOtY2ggeHXhuqV0CiAgICAgICAgYXR0cl9wYXR0ZXJucyA9IHsKICAgICAgICAgICAgImNsYXNzIjogcidjbGFzcz0iKFteIl0qKSInLAogICAgICAgICAgICAicGFja2FnZSI6IHIncGFja2FnZT0iKFteIl0qKSInLAogICAgICAgICAgICAicmVzb3VyY2UtaWQiOiByJ3Jlc291cmNlLWlkPSIoW14iXSopIicsCiAgICAgICAgICAgICJ0ZXh0Ijogcid0ZXh0PSIoW14iXSopIicsCiAgICAgICAgICAgICJjb250ZW50LWRlc2MiOiByJ2NvbnRlbnQtZGVzYz0iKFteIl0qKSInLAogICAgICAgICAgICAiYm91bmRzIjogcidib3VuZHM9IihbXiJdKikiJywKICAgICAgICAgICAgImNoZWNrYWJsZSI6IHInY2hlY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJjaGVja2VkIjogcidjaGVja2VkPSIoW14iXSopIicsCiAgICAgICAgICAgICJjbGlja2FibGUiOiByJ2NsaWNrYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAiZW5hYmxlZCI6IHInZW5hYmxlZD0iKFteIl0qKSInLAogICAgICAgICAgICAiZm9jdXNhYmxlIjogcidmb2N1c2FibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImZvY3VzZWQiOiByJ2ZvY3VzZWQ9IihbXiJdKikiJywKICAgICAgICAgICAgInNjcm9sbGFibGUiOiByJ3Njcm9sbGFibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImxvbmctY2xpY2thYmxlIjogcidsb25nLWNsaWNrYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAicGFzc3dvcmQiOiByJ3Bhc3N3b3JkPSIoW14iXSopIicsCiAgICAgICAgICAgICJzZWxlY3RlZCI6IHInc2VsZWN0ZWQ9IihbXiJdKikiJwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgYXR0cl9uYW1lLCBwYXR0ZXJuIGluIGF0dHJfcGF0dGVybnMuaXRlbXMoKToKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgbm9kZV9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXNbYXR0cl9uYW1lXSA9IG1hdGNoLmdyb3VwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gYXR0cmlidXRlcwoKICAgIGRlZiBfZWxlbWVudF90b19kaWN0KHNlbGYsIGVsZW1lbnQpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENodXnhu4NuIMSR4buVaSBt4buZdCBwaOG6p24gdOG7rSBYTUwgdOG7qyBseG1sIHRow6BuaCBkaWN0CiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0ID0ge30KICAgICAgICAKICAgICAgICAjIEzhuqV5IHThuqV0IGPhuqMgdGh14buZYyB0w61uaAogICAgICAgIGZvciBrZXksIHZhbHVlIGluIGVsZW1lbnQuYXR0cmliLml0ZW1zKCk6CiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWUKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdAoKICAgIGRlZiBmaW5kX2VsZW1lbnQoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gcGjhuqduIHThu60gdHLDqm4gbcOgbiBow6xuaCBk4buxYSB0csOqbiB0ZXh0LCBjb250ZW50LWRlc2MsIHJlc291cmNlLWlkIGhv4bq3YyBjbGFzcwogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUpCgogICAgZGVmIGZpbmRfYWxsX2VsZW1lbnRzKHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSB0csOqbiBtw6BuIGjDrG5oIHBow7kgaOG7o3AgduG7m2kgxJFp4buBdSBraeG7h24KICAgICAgICAiIiIKICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICByZXR1cm4gc2VsZi5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoeG1sX2NvbnRlbnQsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUpCgogICAgZGVmIGlzX2VsZW1lbnRfc2VsZWN0ZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGNo4buNbiBoYXkga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJzZWxlY3RlZCIpID09ICJ0cnVlIgoKICAgIGRlZiB3YWl0X2Zvcl9lbGVtZW50KHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCB0aW1lb3V0OiBpbnQgPSAzMCwgCiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG3hu5l0IHBo4bqnbiB04butIHh14bqldCBoaeG7h24gdHLDqm4gbcOgbiBow6xuaAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6CiAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmZpbmRfZWxlbWVudCh0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkKQogICAgICAgICAgICBpZiBlbGVtZW50OgogICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0aW1lLnNsZWVwKGNoZWNrX2ludGVydmFsKQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfdGV4dChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRleHQgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NvbnRlbnRfZGVzYyhzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGNvbnRlbnQtZGVzYyBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9yZXNvdXJjZV9pZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHJlc291cmNlLWlkIGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJyZXNvdXJjZS1pZCIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2xhc3Moc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBjbGFzcyBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2xhc3MiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2VuYWJsZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGvDrWNoIGhv4bqhdCBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImVuYWJsZWQiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NsaWNrYWJsZShzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgdGjhu4MgbmjhuqVwIHbDoG8ga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjbGlja2FibGUiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2ZvY3VzZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGZvY3VzIGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiZm9jdXNlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2hlY2tlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2MgY2jhu41uIGtow7RuZyAoY2hvIGNoZWNrYm94KQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2hlY2tlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfYm91bmRzKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBUdXBsZVtpbnQsIGludCwgaW50LCBpbnRdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHThu41hIMSR4buZIGJvdW5kcyBj4bunYSBwaOG6p24gdOG7rSBkxrDhu5tpIGThuqFuZyB0dXBsZSAoeDEsIHkxLCB4MiwgeTIpCiAgICAgICAgIiIiCiAgICAgICAgYm91bmRzID0gZWxlbWVudC5nZXQoImJvdW5kcyIsICJbMCwwXVswLDBdIikKICAgICAgICBtYXRjaCA9IHJlLm1hdGNoKHIiXFsoXGQrKSwoXGQrKVxdXFsoXGQrKSwoXGQrKVxdIiwgYm91bmRzKQogICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICByZXR1cm4gdHVwbGUobWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpKQogICAgICAgIHJldHVybiAoMCwgMCwgMCwgMCkKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NlbnRlcihzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gVHVwbGVbaW50LCBpbnRdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHThu41hIMSR4buZIHRydW5nIHTDom0gY+G7p2EgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IHNlbGYuZ2V0X2VsZW1lbnRfYm91bmRzKGVsZW1lbnQpCiAgICAgICAgcmV0dXJuICgoeDEgKyB4MikgLy8gMiwgKHkxICsgeTIpIC8vIDIpCiAgICAKICAgIGRlZiB0YXBfZWxlbWVudF9jZW50ZXIoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIHRydW5nIHTDom0gY+G7p2EgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICB4LCB5ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICByZXR1cm4gc2VsZi50YXAoeCwgeSkKICAgIAogICAgZGVmIGxvbmdfcHJlc3Moc2VsZiwgeDogaW50LCB5OiBpbnQsIGR1cmF0aW9uOiBpbnQgPSAxMDAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gZ2nhu68gdOG6oWkgduG7iyB0csOtIHgseSB0cm9uZyBt4buZdCBraG/huqNuZyB0aOG7nWkgZ2lhbgogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgIngiOiB4LAogICAgICAgICAgICAieSI6IHksCiAgICAgICAgICAgICJkdXJhdGlvbiI6IGR1cmF0aW9uCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImxvbmdfcHJlc3MiLCBwYXJhbXM9cGFyYW1zKQogICAgCiAgICBkZWYgbG9uZ19wcmVzc19lbGVtZW50KHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLCBkdXJhdGlvbjogaW50ID0gMTAwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIGdp4buvIHThuqFpIHRydW5nIHTDom0gY+G7p2EgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICB4LCB5ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICByZXR1cm4gc2VsZi5sb25nX3ByZXNzKHgsIHksIGR1cmF0aW9uKQogICAgCiAgICBkZWYgc3dpcGUoc2VsZiwgc3RhcnRfeDogaW50LCBzdGFydF95OiBpbnQsIGVuZF94OiBpbnQsIGVuZF95OiBpbnQsIAogICAgICAgICAgICAgZHVyYXRpb246IGludCA9IDUwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHThu6sgxJFp4buDbSAoc3RhcnRfeCwgc3RhcnRfeSkgxJHhur9uIMSRaeG7g20gKGVuZF94LCBlbmRfeSkKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICJzdGFydF94Ijogc3RhcnRfeCwKICAgICAgICAgICAgInN0YXJ0X3kiOiBzdGFydF95LAogICAgICAgICAgICAiZW5kX3giOiBlbmRfeCwKICAgICAgICAgICAgImVuZF95IjogZW5kX3ksCiAgICAgICAgICAgICJkdXJhdGlvbiI6IGR1cmF0aW9uCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlIiwgcGFyYW1zPXBhcmFtcykKICAgIAogICAgZGVmIHN3aXBlX2JldHdlZW5fZWxlbWVudHMoc2VsZiwgc3RhcnRfZWxlbWVudDogRGljdFtzdHIsIEFueV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRfZWxlbWVudDogRGljdFtzdHIsIEFueV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogaW50ID0gNTAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgdOG7qyBwaOG6p24gdOG7rSBzdGFydF9lbGVtZW50IMSR4bq/biBwaOG6p24gdOG7rSBlbmRfZWxlbWVudAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3gsIHN0YXJ0X3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihzdGFydF9lbGVtZW50KQogICAgICAgIGVuZF94LCBlbmRfeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVuZF9lbGVtZW50KQogICAgICAgIHJldHVybiBzZWxmLnN3aXBlKHN0YXJ0X3gsIHN0YXJ0X3ksIGVuZF94LCBlbmRfeSwgZHVyYXRpb24pCiAgICAKICAgIGRlZiB3YWl0X2Zvcl9lbGVtZW50X3RvX2Rpc2FwcGVhcihzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgdGltZW91dDogaW50ID0gMzAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbDogaW50ID0gMSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgbeG7mXQgcGjhuqduIHThu60gYmnhur9uIG3huqV0IGto4buPaSBtw6BuIGjDrG5oCiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgdGltZW91dDoKICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuZmluZF9lbGVtZW50KHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQpCiAgICAgICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0aW1lLnNsZWVwKGNoZWNrX2ludGVydmFsKQogICAgICAgIAogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgd2FpdF9mb3JfYW55X2VsZW1lbnQoc2VsZiwgZWxlbWVudHNfdG9fZmluZDogTGlzdFtEaWN0W3N0ciwgc3RyXV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiBpbnQgPSAzMCwgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgYuG6pXQga+G7syBwaOG6p24gdOG7rSBuw6BvIHRyb25nIGRhbmggc8OhY2ggeHXhuqV0IGhp4buHbgogICAgICAgIAogICAgICAgIGVsZW1lbnRzX3RvX2ZpbmQgbMOgIGRhbmggc8OhY2ggY8OhYyBkaWN0IHbhu5tpIGPDoWMga2jDs2E6IHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQKICAgICAgICAiIiIKICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICBmb3IgZWxlbWVudF9jcml0ZXJpYSBpbiBlbGVtZW50c190b19maW5kOgogICAgICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuZmluZF9lbGVtZW50KAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfY3JpdGVyaWEuZ2V0KCJ0ZXh0IiksIAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfY3JpdGVyaWEuZ2V0KCJjb250ZW50X2Rlc2MiKSwgCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9jcml0ZXJpYS5nZXQoInJlc291cmNlX2lkIikKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0aW1lLnNsZWVwKGNoZWNrX2ludGVydmFsKQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGRlZiBnZXRfc2NyZWVuX3NpemUoc2VsZikgLT4gVHVwbGVbaW50LCBpbnRdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmggKHdpZHRoLCBoZWlnaHQpCiAgICAgICAgIiIiCiAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgaWYgZGV2aWNlX2luZm9bInN0YXR1cyJdID09ICJzdWNjZXNzIiBhbmQgInNjcmVlbl9zaXplIiBpbiBkZXZpY2VfaW5mb1siZGF0YSJdOgogICAgICAgICAgICBzaXplID0gZGV2aWNlX2luZm9bImRhdGEiXVsic2NyZWVuX3NpemUiXQogICAgICAgICAgICByZXR1cm4gKHNpemVbIndpZHRoIl0sIHNpemVbImhlaWdodCJdKQogICAgICAgIHJldHVybiAoMCwgMCkKICAgIAogICAgZGVmIHRha2Vfc2NyZWVuc2hvdChzZWxmLCBmaWxlX3BhdGg6IHN0ciA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bulcCDhuqNuaCBtw6BuIGjDrG5oIHbDoCBsxrB1IHbDoG8gZmlsZV9wYXRoIChu4bq/dSDEkcaw4bujYyBjdW5nIGPhuqVwKQogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHt9CiAgICAgICAgaWYgZmlsZV9wYXRoOgogICAgICAgICAgICBwYXJhbXNbImZpbGVfcGF0aCJdID0gZmlsZV9wYXRoCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic2NyZWVuc2hvdCIsIHBhcmFtcz1wYXJhbXMpCiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9hY3Rpdml0eShzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdMOqbiBhY3Rpdml0eSBoaeG7h24gdOG6oWkKICAgICAgICAiIiIKICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICBpZiBkZXZpY2VfaW5mb1sic3RhdHVzIl0gPT0gInN1Y2Nlc3MiIGFuZCAiY3VycmVudF9hY3Rpdml0eSIgaW4gZGV2aWNlX2luZm9bImRhdGEiXToKICAgICAgICAgICAgcmV0dXJuIGRldmljZV9pbmZvWyJkYXRhIl1bImN1cnJlbnRfYWN0aXZpdHkiXQogICAgICAgIHJldHVybiAiIgogICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfcGFja2FnZShzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdMOqbiBwYWNrYWdlIGhp4buHbiB04bqhaQogICAgICAgICIiIgogICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgIGlmIGRldmljZV9pbmZvWyJzdGF0dXMiXSA9PSAic3VjY2VzcyIgYW5kICJjdXJyZW50X3BhY2thZ2UiIGluIGRldmljZV9pbmZvWyJkYXRhIl06CiAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaW5mb1siZGF0YSJdWyJjdXJyZW50X3BhY2thZ2UiXQogICAgICAgIHJldHVybiAiIgogICAgCiAgICBkZWYgcHJlc3NfZW50ZXIoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgRW50ZXIKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19lbnRlciIpCiAgICAKICAgIGRlZiBwcmVzc19iYWNrKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IEJhY2sKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19iYWNrIikKICAgIAogICAgZGVmIHByZXNzX2hvbWUoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgSG9tZQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2hvbWUiKQogICAgCiAgICBkZWYgcHJlc3NfcmVjZW50X2FwcHMoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgUmVjZW50IEFwcHMKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19yZWNlbnRfYXBwcyIpCgogICAgZGVmIGlzX2FwcF9pbnN0YWxsZWQoc2VsZiwgcGFja2FnZV9uYW1lOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIMSRw6MgxJHGsOG7o2MgY8OgaSDEkeG6t3QgdHLDqm4gdGhp4bq/dCBi4buLIGNoxrBhCiAgICAgICAgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGFja2FnZV9uYW1lOiBUw6puIHBhY2thZ2UgY+G7p2Eg4bupbmcgZOG7pW5nIGPhuqduIGtp4buDbSB0cmEKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDhu6luZyBk4bulbmcgxJHDoyBjw6BpIMSR4bq3dCwgRmFsc2UgbuG6v3UgY2jGsGEKICAgICAgICAiIiIKICAgICAgICAjIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEg4bupbmcgZOG7pW5nIGLhurFuZyBBREIKICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJzaGVsbCIsIGYicG0gbGlzdCBwYWNrYWdlcyB8IGdyZXAgLXggcGFja2FnZTp7cGFja2FnZV9uYW1lfSJdCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIGvhur90IHF14bqjLCDhu6luZyBk4bulbmcgxJHDoyDEkcaw4bujYyBjw6BpIMSR4bq3dAogICAgICAgICAgICAgICAgcmV0dXJuIHBhY2thZ2VfbmFtZSBpbiByZXN1bHQuc3Rkb3V0CiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvcjoKICAgICAgICAgICAgICAgICMgTuG6v3UgbOG7l2kgQURCLCBz4butIGThu6VuZyBBUEkgSFRUUAogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgSFRUUCBBUEkKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiYXBwLWluc3RhbGxlZCIsIHsicGFja2FnZSI6IHBhY2thZ2VfbmFtZX0pCiAgICAgICAgaWYgcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJkYXRhIl0uZ2V0KCJpbnN0YWxsZWQiLCBGYWxzZSkKICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgIGRlZiBmaW5kX2VsZW1lbnRzKHNlbGYsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsIHRleHQ6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCByZXNvdXJjZV9pZDogc3RyID0gTm9uZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgcGjhuqduIHThu60gdGhlbyBjbGFzc19uYW1lLCB0ZXh0LCBjb250ZW50X2Rlc2MgaG/hurdjIHJlc291cmNlX2lkCiAgICAgICAgxJDDonkgbMOgIG3hu5l0IHBoxrDGoW5nIHRo4bupYyB0aeG7h24gbOG7o2kga+G6v3QgaOG7o3AgZHVtcF9zY3JlZW5feG1sIHbDoCBmaW5kX2FsbF9lbGVtZW50c19pbl94bWwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgcGjhuqduIHThu60gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICAjIEzhuqV5IFhNTCBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIGZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCDEkeG7gyB0w6xtIGPDoWMgcGjhuqduIHThu60KICAgICAgICByZXR1cm4gc2VsZi5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICB0ZXh0PXRleHQsIAogICAgICAgICAgICBjb250ZW50X2Rlc2M9Y29udGVudF9kZXNjLCAKICAgICAgICAgICAgcmVzb3VyY2VfaWQ9cmVzb3VyY2VfaWQsCiAgICAgICAgICAgIGNsYXNzX25hbWU9Y2xhc3NfbmFtZQogICAgICAgICkKCiAgICBkZWYgb3Blbl91cmwoc2VsZiwgdXJsOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3hu58gbeG7mXQgVVJMIHRyw6puIHRoaeG6v3QgYuG7iy4gSOG7r3Ugw61jaCDEkeG7gyBt4bufIGPDoWMgbGluayBt4bqhbmcgeMOjIGjhu5lpIHRy4buxYyB0aeG6v3AuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdXJsOiBVUkwgY+G6p24gbeG7nyAodsOtIGThu6U6IGh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vdXNlcm5hbWUvKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJvcGVuX3VybCIsIHBhcmFtcz17InVybCI6IHVybH0pCgogICAgZGVmIGdldF9jbGlwYm9hcmQoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IG7hu5lpIGR1bmcgY2xpcGJvYXJkIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBO4buZaSBkdW5nIGNsaXBib2FyZCBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3Uga2jDtG5nIGPDsyBu4buZaSBkdW5nCiAgICAgICAgIiIiCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImNsaXBib2FyZCIpCiAgICAgICAgaWYgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kIHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoImhhc19jb250ZW50Iik6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdWyJjbGlwYm9hcmRfdGV4dCJdCiAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIHN3aXBlX2xlZnQoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHNhbmcgdHLDoWkgKHThu5FpIMawdSBjaG8gbmfDs24gY8OhaSB0YXkgcGjhuqNpKQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX2xlZnQiKQoKICAgIGRlZiBzd2lwZV9yaWdodChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgc2FuZyBwaOG6o2kgKHThu5FpIMawdSBjaG8gbmfDs24gY8OhaSB0YXkgcGjhuqNpKQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX3JpZ2h0IikKCiAgICBkZWYgaXNfaW5zdGFsbGVkKHNlbGYsIHBhY2thZ2U6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBoYXkga2jDtG5nIChkw7luZyBBUEkgbeG7m2kpCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGFja2FnZTogVMOqbiBwYWNrYWdlIGPhu6dhIOG7qW5nIGThu6VuZwogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGRpY3Q6IEvhur90IHF14bqjIGtp4buDbSB0cmEKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpc19pbnN0YWxsZWQiLCBwYXJhbXM9eyJwYWNrYWdlIjogcGFja2FnZX0pCgojIFbDrSBk4bulIHPhu60gZOG7pW5nCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBoZWxwZXIgPSBIZWxwZXJTZXJ2aWNlKCkKICAgIAogICAgIyBM4bqleSBrw61jaCB0aMaw4bubYyBtw6BuIGjDrG5oCiAgICB3aWR0aCwgaGVpZ2h0ID0gaGVscGVyLmdldF9zY3JlZW5fc2l6ZSgpCiAgICBwcmludChmIkvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmg6IHt3aWR0aH14e2hlaWdodH0iKQogICAgCiAgICAjIE3hu58gVGlrVG9rCiAgICBoZWxwZXIub3Blbl9hcHAoImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbCIpCiAgICAKICAgICMgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG7DunQgIlRyYW5nIGNo4bunIiBob+G6t2MgbsO6dCAiS2jDoW0gcGjDoSIgeHXhuqV0IGhp4buHbgogICAgZWxlbWVudHNfdG9fZmluZCA9IFsKICAgICAgICB7ImNvbnRlbnRfZGVzYyI6ICJUcmFuZyBjaOG7pyJ9LAogICAgICAgIHsiY29udGVudF9kZXNjIjogIktow6FtIHBow6EifQogICAgXQogICAgCiAgICBlbGVtZW50ID0gaGVscGVyLndhaXRfZm9yX2FueV9lbGVtZW50KGVsZW1lbnRzX3RvX2ZpbmQpCiAgICAKICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgcHJpbnQoZiLEkMOjIHTDrG0gdGjhuqV5IHBo4bqnbiB04butOiB7aGVscGVyLmdldF9lbGVtZW50X2NvbnRlbnRfZGVzYyhlbGVtZW50KX0iKQogICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIktow7RuZyB0w6xtIHRo4bqleSBwaOG6p24gdOG7rSBuw6BvIHNhdSB0aOG7nWkgZ2lhbiBjaOG7nSIpIA==').decode('utf-8'))
