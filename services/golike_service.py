import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBMaXN0CmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCmZyb20gdXRpbHMgaW1wb3J0IExvZ0xldmVsLCBMb2dnZXIKCiMgVOG6oW8gbG9nZ2VyIHJpw6puZyBjaG8gR29MaWtlU2VydmljZQpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJHb0xpa2VTZXJ2aWNlIikKCiMgS2nhu4NtIHRyYSB2w6AgaW1wb3J0IGPDoWMgdGjGsCB2aeG7h24gY+G6p24gdGhp4bq/dAp0cnk6CiAgICBpbXBvcnQgcHljaHJvbWUKICAgIFBZQ0hST01FX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLndhcm5pbmcoIlRoxrAgdmnhu4duIHB5Y2hyb21lIGtow7RuZyBraOG6oyBk4bulbmcuIEjDo3kgY8OgaSDEkeG6t3QgYuG6sW5nIGzhu4duaDogcGlwIGluc3RhbGwgcHljaHJvbWUiKQogICAgUFlDSFJPTUVfQVZBSUxBQkxFID0gRmFsc2UKCnRyeToKICAgIGltcG9ydCBjbG91ZHNjcmFwZXIKICAgIENMT1VEU0NSQVBFUl9BVkFJTEFCTEUgPSBUcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIGxvZ2dlci53YXJuaW5nKCJUaMawIHZp4buHbiBjbG91ZHNjcmFwZXIga2jDtG5nIGto4bqjIGThu6VuZy4gSMOjeSBjw6BpIMSR4bq3dCBi4bqxbmcgbOG7h25oOiBwaXAgaW5zdGFsbCBjbG91ZHNjcmFwZXIiKQogICAgQ0xPVURTQ1JBUEVSX0FWQUlMQUJMRSA9IEZhbHNlCgp0cnk6CiAgICBpbXBvcnQgY3VybF9jZmZpCiAgICBmcm9tIGN1cmxfY2ZmaSBpbXBvcnQgcmVxdWVzdHMgYXMgY3VybF9yZXF1ZXN0cwogICAgQ1VSTF9DRkZJX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLndhcm5pbmcoIlRoxrAgdmnhu4duIGN1cmxfY2ZmaSBraMO0bmcga2jhuqMgZOG7pW5nLiBIw6N5IGPDoGkgxJHhurd0IGLhurFuZyBs4buHbmg6IHBpcCBpbnN0YWxsIGN1cmwtY2ZmaSIpCiAgICBDVVJMX0NGRklfQVZBSUxBQkxFID0gRmFsc2UKCmNsYXNzIEJyb3dzZXI6CiAgICAiIiIKICAgIEzhu5twIGdp4bqjIGzhuq1wIEJyb3dzZXIgY+G7p2EgcHljaHJvbWUgbuG6v3UgdGjGsCB2aeG7h24ga2jDtG5nIGto4bqjIGThu6VuZwogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgdXJsKToKICAgICAgICBzZWxmLnVybCA9IHVybAogICAgICAgIAogICAgZGVmIGxpc3RfdGFiKHNlbGYpOgogICAgICAgIHJldHVybiBbXQogICAgICAgIAogICAgZGVmIG5ld190YWIoc2VsZik6CiAgICAgICAgcmV0dXJuIE5vbmUKCmNsYXNzIEdvTGlrZVNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBHb0xpa2UgU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGRiX3NlcnZpY2U6IERhdGFiYXNlIHNlcnZpY2UgxJHhu4MgbMawdSB0aMO0bmcgdGluCiAgICAgICAgICAgIGhlbHBlcl9zZXJ2aWNlOiBIZWxwZXIgc2VydmljZSDEkeG7gyB0xrDGoW5nIHTDoWMgduG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5kYiA9IGRiX3NlcnZpY2UKICAgICAgICBzZWxmLmhlbHBlciA9IGhlbHBlcl9zZXJ2aWNlCiAgICAgICAgCiAgICAgICAgIyBD4bqldSBow6xuaCBjaG8gQVBJIHJlcXVlc3RzCiAgICAgICAgc2VsZi51c2VyX2FnZW50ID0gIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgSykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzExNC4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiIKICAgICAgICAKICAgICAgICAjIFF1eeG6v3QgxJHhu4tuaCBz4butIGThu6VuZyBjdXJsX2NmZmkgaGF5IGNsb3Vkc2NyYXBlcgogICAgICAgICMgVHLDqm4gVGVybXV4IHRoxrDhu51uZyBz4butIGThu6VuZyBjbG91ZHNjcmFwZXIgZG8gY3VybF9jZmZpIGPDsyB0aOG7gyBraMO0bmcgdMawxqFuZyB0aMOtY2gKICAgICAgICAjIGlzX3Rlcm11eCA9IHNlbGYuX2NoZWNrX2lzX3Rlcm11eCgpCiAgICAgICAgc2VsZi51c2VfY3VybF9jZmZpID0gQ1VSTF9DRkZJX0FWQUlMQUJMRQogICAgICAgIAogICAgICAgICMgS2jhu59pIHThuqFvIGNsaWVudAogICAgICAgIGlmIG5vdCBzZWxmLnVzZV9jdXJsX2NmZmkgYW5kIENMT1VEU0NSQVBFUl9BVkFJTEFCTEU6CiAgICAgICAgICAgIHNlbGYuY2xpZW50ID0gY2xvdWRzY3JhcGVyLmNyZWF0ZV9zY3JhcGVyKAogICAgICAgICAgICAgICAgYnJvd3Nlcj17CiAgICAgICAgICAgICAgICAgICAgJ2Jyb3dzZXInOiAnY2hyb21lJywKICAgICAgICAgICAgICAgICAgICAncGxhdGZvcm0nOiAnYW5kcm9pZCcsCiAgICAgICAgICAgICAgICAgICAgJ2Rlc2t0b3AnOiBGYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBGYWxsYmFjayB0byByZWd1bGFyIHJlcXVlc3RzIGlmIG5laXRoZXIgaXMgYXZhaWxhYmxlCiAgICAgICAgICAgIHNlbGYuY2xpZW50ID0gcmVxdWVzdHMuU2Vzc2lvbigpCiAgICAgICAgICAgIAogICAgICAgICMgQ+G6pXUgaMOsbmggdMO5eSBjaOG7jW4gY2hvIGN1cmxfY2ZmaQogICAgICAgIHNlbGYuaW1wZXJzb25hdGUgPSAiY2hyb21lMTEwIgogICAgICAgIAogICAgICAgICMgQmnhur9uIHRoZW8gZMO1aSB0aHJlYWQgcmVwb3J0CiAgICAgICAgc2VsZi5yZXBvcnRfdGhyZWFkID0gTm9uZQogICAgICAgIAogICAgICAgICMgS2jhu59pIMSR4buZbmcgdGhyZWFkIHJlcG9ydAogICAgICAgIHNlbGYuc3RhcnRfcmVwb3J0X3RocmVhZCgpCgogICAgZGVmIF9jaGVja19pc190ZXJtdXgoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSDhu6luZyBk4bulbmcgY8OzIMSRYW5nIGNo4bqheSB0csOqbiBUZXJtdXgga2jDtG5nCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkWFuZyBjaOG6oXkgdHLDqm4gVGVybXV4CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgYmnhur9uIG3DtGkgdHLGsOG7nW5nIFRFUk1VWF9WRVJTSU9OIGhv4bq3YyDEkcaw4budbmcgZOG6q24gVGVybXV4IHRyb25nIFBBVEgKICAgICAgICAgICAgaW1wb3J0IG9zCiAgICAgICAgICAgIHJldHVybiAnVEVSTVVYX1ZFUlNJT04nIGluIG9zLmVudmlyb24gb3IgJy9kYXRhL2RhdGEvY29tLnRlcm11eCcgaW4gb3MuZW52aXJvbi5nZXQoJ1BBVEgnLCAnJykKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBnZXRfZ29saWtlX2hlYWRlcnMoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgR29MaWtlIGhlYWRlcnMgdOG7qyBnb2xpa2VfY29uZmlnCiAgICAgICAgSGVhZGVycyBuw6B5IMSRxrDhu6NjIMSR4bqpeSB24buBIHThu6sgc2VydmVyLCBraMO0bmcgdOG7sSDEkeG7mW5nIGZldGNoCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdDogR29MaWtlIGhlYWRlcnMKICAgICAgICAiIiIKICAgICAgICBnb2xpa2VfY29uZmlnID0gc2VsZi5kYi5nZXRfZ29saWtlX2NvbmZpZyh7fSkKICAgICAgICByZXR1cm4gZ29saWtlX2NvbmZpZy5nZXQoImhlYWRlcnMiLCB7fSkKICAgICAgICAKICAgIGRlZiBpc19nb2xpa2VfYXV0aGVudGljYXRlZChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIMSRw6MgY8OzIHRow7RuZyB0aW4geMOhYyB0aOG7sWMgR29MaWtlIGjhu6NwIGzhu4cgY2jGsGEKICAgICAgICBWYWxpZGF0ZSBj4bqjIEF1dGhvcml6YXRpb24gdsOgIHQgdG9rZW4KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRw6MgeMOhYyB0aOG7sWMgxJHhuqd5IMSR4bunLCBGYWxzZSBu4bq/dSB0aGnhur91IHRow7RuZyB0aW4KICAgICAgICAiIiIKICAgICAgICBoZWFkZXJzID0gc2VsZi5nZXRfZ29saWtlX2hlYWRlcnMoKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBjw7MgaGVhZGVycyBraMO0bmcKICAgICAgICBpZiBub3QgaGVhZGVyczoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBjw7MgQXV0aG9yaXphdGlvbiB0b2tlbiBraMO0bmcKICAgICAgICBhdXRob3JpemF0aW9uID0gaGVhZGVycy5nZXQoIkF1dGhvcml6YXRpb24iKSBvciBoZWFkZXJzLmdldCgiYXV0aG9yaXphdGlvbiIpCiAgICAgICAgaWYgbm90IGF1dGhvcml6YXRpb24gb3Igbm90IGF1dGhvcml6YXRpb24uc3RhcnRzd2l0aCgiQmVhcmVyICIpOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiR29MaWtlIGhlYWRlcnMgdGhp4bq/dSBBdXRob3JpemF0aW9uIHRva2VuIGjhu6NwIGzhu4ciKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGPDsyB0IHRva2VuIGtow7RuZwogICAgICAgIHRfdG9rZW4gPSBoZWFkZXJzLmdldCgidCIpCiAgICAgICAgaWYgbm90IHRfdG9rZW46CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJHb0xpa2UgaGVhZGVycyB0aGnhur91IHQgdG9rZW4iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJHb0xpa2UgaGVhZGVycyBo4bujcCBs4buHIHbhu5tpIMSR4bunIHRow7RuZyB0aW4gQXV0aG9yaXphdGlvbiB2w6AgdCB0b2tlbiIpCiAgICAgICAgcmV0dXJuIFRydWUKICAgIAogICAgZGVmIGZldGNoX2dvbGlrZV9oZWFkZXJzX3dpdGhfcmV0cnkoc2VsZiwgZm9yY2VfcmVmcmVzaDogYm9vbCA9IEZhbHNlKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IEdvTGlrZSBoZWFkZXJzIHbhu5tpIGPGoSBjaOG6vyB0aOG7rSBs4bqhaS4gTeG6t2MgxJHhu4tuaCBpc19hdXRvX2dldF9oZWFkZXJzID0gdHJ1ZS4KICAgICAgICBUaOG7rSBs4bqhaSB04buRaSDEkWEgMyBs4bqnbiBu4bq/dSB0aOG6pXQgYuG6oWkuCiAgICAgICAgTuG6v3Uga2jDtG5nIGzhuqV5IMSRxrDhu6NjIGhlYWRlcnMgc2F1IHThuqV0IGPhuqMgY8OhYyBs4bqnbiB0aOG7rSwgdOG7sSDEkeG7mW5nIGNodXnhu4NuIGlzX2F1dG9fZ2V0X2hlYWRlcnMgPSBmYWxzZS4KICAgICAgICBDaOG7iSBs4bqleSBs4bqhaSBoZWFkZXJzIDEgbOG6p24gbeG7l2kgbmfDoHkgZOG7sWEgdsOgbyB0aOG7nWkgZ2lhbiBj4bqtcCBuaOG6rXQgY3Xhu5FpIGPDuW5nLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGZvcmNlX3JlZnJlc2g6IE7hur91IFRydWUsIHPhur0gbHXDtG4gbOG6pXkgbOG6oWkgaGVhZGVycyBi4bqldCBr4buDIHRo4budaSBnaWFuIGPhuq1wIG5o4bqtdCBjdeG7kWkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkcOjIGPDsyBoZWFkZXJzIGjhu6NwIGzhu4cgaG/hurdjIGzhuqV5IMSRxrDhu6NjIGhlYWRlcnMgbeG7m2ksIEZhbHNlIG7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYwogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSBjb25maWcgY8OzIGNobyBwaMOpcCB04buxIMSR4buZbmcgbOG6pXkgaGVhZGVycyBraMO0bmcgdOG7qyBnb2xpa2VfY29uZmlnCiAgICAgICAgZ29saWtlX2NvbmZpZyA9IHNlbGYuZGIuZ2V0X2dvbGlrZV9jb25maWcoe30pCiAgICAgICAgaXNfYXV0b19nZXRfaGVhZGVyID0gZ29saWtlX2NvbmZpZy5nZXQoImlzX2F1dG9fZ2V0X2hlYWRlcnMiLCBUcnVlKSAgIyBN4bq3YyDEkeG7i25oIHRydWUKICAgICAgICAKICAgICAgICBpZiBub3QgaXNfYXV0b19nZXRfaGVhZGVyIGFuZCBub3QgZm9yY2VfcmVmcmVzaDoKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJDb25maWcgaXNfYXV0b19nZXRfaGVhZGVycyA9IGZhbHNlLCBi4buPIHF1YSB2aeG7h2MgdOG7sSDEkeG7mW5nIGzhuqV5IGhlYWRlcnMiKQogICAgICAgICAgICAjIENo4buJIGtp4buDbSB0cmEgeGVtIGPDsyBoZWFkZXJzIHThu6sgc2VydmVyIGtow7RuZwogICAgICAgICAgICByZXR1cm4gc2VsZi5pc19nb2xpa2VfYXV0aGVudGljYXRlZCgpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIGPDsyB0aMO0bmcgdGluIHjDoWMgdGjhu7FjIEdvTGlrZSBjaMawYQogICAgICAgIGlmIHNlbGYuaXNfZ29saWtlX2F1dGhlbnRpY2F0ZWQoKSBhbmQgbm90IGZvcmNlX3JlZnJlc2g6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0aOG7nWkgZ2lhbiBj4bqtcCBuaOG6rXQgY3Xhu5FpIHThu6sgZ29saWtlX2NvbmZpZwogICAgICAgICAgICBnb2xpa2VfY29uZmlnID0gc2VsZi5kYi5nZXRfZ29saWtlX2NvbmZpZyh7fSkKICAgICAgICAgICAgbGFzdF91cGRhdGUgPSBnb2xpa2VfY29uZmlnLmdldCgiaGVhZGVyc191cGRhdGVkIiwgMCkKICAgICAgICAgICAgY3VycmVudF90aW1lID0gaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSDEkcOjIGPhuq1wIG5o4bqtdCB0cm9uZyB2w7JuZyAyNCBnaeG7nSBxdWEsIGtow7RuZyBj4bqnbiBs4bqleSBs4bqhaQogICAgICAgICAgICBpZiBjdXJyZW50X3RpbWUgLSBsYXN0X3VwZGF0ZSA8IDg2NDAwOiAgIyAyNCBnaeG7nSA9IDg2NDAwIGdpw6J5CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgcXXDoSAyNCBnaeG7nSB04burIGzhuqduIGPhuq1wIG5o4bqtdCBjdeG7kWksIHPhur0gbMOgbSBt4bubaSBoZWFkZXJzIEdvTGlrZSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgZm9yY2VfcmVmcmVzaDoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJC4bqvdCBideG7mWMgbMOgbSBt4bubaSBoZWFkZXJzIEdvTGlrZSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiQ2jGsGEgY8OzIHRow7RuZyB0aW4geMOhYyB0aOG7sWMgR29MaWtlLCBz4bq9IGzhuqV5IGhlYWRlcnMgbeG7m2kiKQogICAgICAgIAogICAgICAgICMgVGjhu7FjIGhp4buHbiBs4bqleSBoZWFkZXJzIHbhu5tpIGPGoSBjaOG6vyB0aOG7rSBs4bqhaQogICAgICAgIG1heF9hdHRlbXB0cyA9IDMgICMgR2nhuqNtIHPhu5EgbOG6p24gdGjhu60geHXhu5FuZyAzCiAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UoMSwgbWF4X2F0dGVtcHRzICsgMSk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJBhbmcgbOG6pXkgR29MaWtlIGhlYWRlcnMgKGzhuqduIHRo4butIHthdHRlbXB0fS97bWF4X2F0dGVtcHRzfSkuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBUaOG7rSBs4bqleSBoZWFkZXJzCiAgICAgICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5mZXRjaF9nb2xpa2VfaGVhZGVycygpCiAgICAgICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGzhuqV5IHbDoCBsxrB1IGhlYWRlcnMgR29MaWtlIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdGjhu4MgbOG6pXkgaGVhZGVycyBHb0xpa2UgbOG6p24ge2F0dGVtcHR9LCBz4bq9IHRo4butIGzhuqFpLi4uIikKICAgICAgICAgICAgICAgICAgICAjIMSQw7NuZyBDaHJvbWUgbuG6v3UgY8OybiBt4bufCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCBtYXhfYXR0ZW1wdHM6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gdGhlbyBz4buRIGzhuqduIHRo4butICgxMHMsIDIwcykKICAgICAgICAgICAgICAgICAgICAgICAgd2FpdF90aW1lID0gYXR0ZW1wdCAqIDEwCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDhu6NpIHt3YWl0X3RpbWV9IGdpw6J5IHRyxrDhu5tjIGtoaSB0aOG7rSBs4bqhaS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbOG6pXkgaGVhZGVycyBHb0xpa2U6IHtlfSIpCiAgICAgICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBDaHJvbWUgxJHGsOG7o2MgxJHDs25nCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X2F0dGVtcHRzOgogICAgICAgICAgICAgICAgICAgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gdGhlbyBz4buRIGzhuqduIHRo4butICgxMHMsIDIwcykKICAgICAgICAgICAgICAgICAgICB3YWl0X3RpbWUgPSBhdHRlbXB0ICogMTAKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQ4bujaSB7d2FpdF90aW1lfSBnacOieSB0csaw4bubYyBraGkgdGjhu60gbOG6oWkuLi4iKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAod2FpdF90aW1lKQogICAgICAgIAogICAgICAgIGxvZ2dlci5lcnJvcihmIsSQw6MgdGjhu60gbOG6pXkgR29MaWtlIGhlYWRlcnMge21heF9hdHRlbXB0c30gbOG6p24gbmjGsG5nIGtow7RuZyB0aMOgbmggY8O0bmciKQogICAgICAgIAogICAgICAgICMgVOG7sSDEkeG7mW5nIGNodXnhu4NuIGlzX2F1dG9fZ2V0X2hlYWRlcnMgPSBmYWxzZSDEkeG7gyB0csOhbmggdGjhu60gbOG6oWkgbGnDqm4gdOG7pWMKICAgICAgICBsb2dnZXIud2FybmluZygiVOG7sSDEkeG7mW5nIGNodXnhu4NuIGlzX2F1dG9fZ2V0X2hlYWRlcnMgPSBmYWxzZSBkbyBraMO0bmcgdGjhu4MgbOG6pXkgxJHGsOG7o2MgR29MaWtlIGhlYWRlcnMiKQogICAgICAgIHNlbGYuZGIudXBkYXRlX2dvbGlrZV9jb25maWcoewogICAgICAgICAgICAiaXNfYXV0b19nZXRfaGVhZGVycyI6IEZhbHNlCiAgICAgICAgfSkKICAgICAgICAKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgYXBpX3JlcXVlc3Qoc2VsZiwgdXJsLCBtZXRob2Q9IkdFVCIsIHBheWxvYWQ9Tm9uZSk6CiAgICAgICAgIiIiCiAgICAgICAgR+G7jWkgQVBJIGPhu6dhIEdvTGlrZSB24bubaSBoZWFkZXJzIMSRw6MgbMawdQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHVybDogVVJMIGPhu6dhIEFQSQogICAgICAgICAgICBtZXRob2Q6IFBoxrDGoW5nIHRo4bupYyBIVFRQIChHRVQgaG/hurdjIFBPU1QpCiAgICAgICAgICAgIHBheWxvYWQ6IEThu68gbGnhu4d1IGfhu61pIMSRaSAoY2hvIFBPU1QgcmVxdWVzdCkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdCBob+G6t2MgTm9uZTogS+G6v3QgcXXhuqMgQVBJIG7hur91IHRow6BuaCBjw7RuZywgTm9uZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgaGVhZGVycyB04burIGRhdGFiYXNlCiAgICAgICAgICAgIGhlYWRlcnMgPSBzZWxmLmdldF9nb2xpa2VfaGVhZGVycygpCiAgICAgICAgICAgIGlmIG5vdCBoZWFkZXJzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgR29MaWtlIGhlYWRlcnMiKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIGhlYWRlcnMgY8OzIHVzZXItYWdlbnQKICAgICAgICAgICAgaWYgInVzZXItYWdlbnQiIG5vdCBpbiBoZWFkZXJzIGFuZCAiVXNlci1BZ2VudCIgbm90IGluIGhlYWRlcnM6CiAgICAgICAgICAgICAgICBoZWFkZXJzWyJ1c2VyLWFnZW50Il0gPSBzZWxmLnVzZXJfYWdlbnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IEFQSSBiYXNlIFVSTCB04burIGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyBob+G6t2Mgc+G7rSBk4bulbmcgbeG6t2MgxJHhu4tuaCB04burIGNvbmZpZwogICAgICAgICAgICBhcGlfYmFzZSA9IHNlbGYuZGIuZ2V0X2RldmljZV9jb25maWcoImdvbGlrZV9hcGlfYmFzZSIsIGNvbmZpZy5HT0xJS0VfQVBJX0JBU0UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IFVSTCBraMO0bmcgYuG6r3QgxJHhuqd1IGLhurFuZyBodHRwLCB0aMOqbSBhcGlfYmFzZSB2w6BvIHRyxrDhu5tjCiAgICAgICAgICAgIGlmIG5vdCB1cmwuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgICAgICAgICAgdXJsID0gZiJ7YXBpX2Jhc2V9L3t1cmwubHN0cmlwKCcvJyl9IgoKICAgICAgICAgICAgIyBT4butIGThu6VuZyBjdXJsX2NmZmkgaG/hurdjIGNsb3Vkc2NyYXBlciB0w7l5IHRoZW8gbcO0aSB0csaw4budbmcKICAgICAgICAgICAgaWYgc2VsZi51c2VfY3VybF9jZmZpIGFuZCBDVVJMX0NGRklfQVZBSUxBQkxFOgogICAgICAgICAgICAgICAgaWYgbWV0aG9kID09ICJHRVQiOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3VybF9yZXF1ZXN0cy5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICBpbXBlcnNvbmF0ZT1zZWxmLmltcGVyc29uYXRlCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxpZiBtZXRob2QgPT0gIlBPU1QiOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3VybF9yZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb249cGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICBpbXBlcnNvbmF0ZT1zZWxmLmltcGVyc29uYXRlCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJNZXRob2Qga2jDtG5nIGjhu6NwIGzhu4c6IHttZXRob2R9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBT4butIGThu6VuZyBjbG91ZHNjcmFwZXIgaG/hurdjIGZhbGxiYWNrIHRvIHJlcXVlc3RzCiAgICAgICAgICAgICAgICBpZiBtZXRob2QgPT0gIkdFVCI6CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmNsaWVudC5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxpZiBtZXRob2QgPT0gIlBPU1QiOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5jbGllbnQucG9zdCgKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBqc29uPXBheWxvYWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTWV0aG9kIGtow7RuZyBo4bujcCBs4buHOiB7bWV0aG9kfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gaGnhu4NuIHRo4buLIGzhu5dpIGThu4UgxJHhu41jIGjGoW4KICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IHJlc3BvbnNlLnRleHQKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIFBhcnNlIHJlc3BvbnNlIGzDoCBKU09OCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfanNvbiA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAgICAgICAgICMgRm9ybWF0IGxvZyB0aMOgbmggMSBkw7JuZwogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IGVycm9yX2pzb24uZ2V0KCdzdGF0dXMnLCByZXNwb25zZS5zdGF0dXNfY29kZSkKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZXJyb3JfanNvbi5nZXQoJ3N1Y2Nlc3MnLCBGYWxzZSkKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gZXJyb3JfanNvbi5nZXQoJ21lc3NhZ2UnLCAnS2jDtG5nIGPDsyB0aMO0bmcgYsOhbyBs4buXaScpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBH4buZcCB0aMOgbmggMSBkw7JuZwogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkFQSSB0cuG6oyB24buBIGzhu5dpIFt7c3RhdHVzfV0gW3N1Y2Nlc3M6IHtzdWNjZXNzfV0ge21lc3NhZ2V9IikKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyBwaOG6o2kgSlNPTiwgaGnhu4NuIHRo4buLIHRleHQgdGjDtAogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkFQSSB0cuG6oyB24buBIGzhu5dpIHtyZXNwb25zZS5zdGF0dXNfY29kZX06IHtlcnJvcl9tc2d9IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu41pIEFQSSBbe21ldGhvZH0ge3VybH1dOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIF9jdXJsX2NmZmlfcmVxdWVzdChzZWxmLCB1cmw6IHN0ciwgbWV0aG9kOiBzdHIgPSAiZ2V0IiwgaGVhZGVyczogRGljdFtzdHIsIHN0cl0gPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUsIHRpbWVvdXQ6IGludCA9IDMwKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiByZXF1ZXN0IHPhu60gZOG7pW5nIGN1cmxfY2ZmaSAoaGnhu4d1IHF14bqjIGNobyBDbG91ZGZsYXJlKQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbWV0aG9kLmxvd2VyKCkgPT0gImdldCI6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGN1cmxfcmVxdWVzdHMuZ2V0KAogICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgZGF0YT1kYXRhLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dCwKICAgICAgICAgICAgICAgICAgICBpbXBlcnNvbmF0ZT0iY2hyb21lMTEwIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbHNlOiAgIyBQT1NUCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGN1cmxfcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgIGRhdGE9ZGF0YSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQsCiAgICAgICAgICAgICAgICAgICAgaW1wZXJzb25hdGU9ImNocm9tZTExMCIKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHN0YXR1cyBjb2RlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7jWkgQVBJIGN1cmxfY2ZmaSBbe21ldGhvZH0ge3VybH1dOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgZGVmIGZldGNoX2dvbGlrZV9yZXBvcnQoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgdOG7qyBHb0xpa2UgdsOgIHThu5VuZyBo4bujcCBs4bqhaQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBUaMO0bmcgdGluIHJlcG9ydCDEkcOjIHThu5VuZyBo4bujcCBob+G6t2MgZGljdCBy4buXbmcgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgIyBH4buNaSBBUEkgL21lIMSR4buDIGzhuqV5IHRow7RuZyB0aW4gbmfGsOG7nWkgZMO5bmcKICAgICAgICAgICAgdXNlcl9pbmZvID0gc2VsZi5hcGlfcmVxdWVzdCgidXNlcnMvbWUiKQogICAgICAgICAgICB1c2VyX3N1bW1hcnkgPSB7fQogICAgICAgICAgICBpZiB1c2VyX2luZm8gYW5kIHVzZXJfaW5mby5nZXQoInN1Y2Nlc3MiLCBGYWxzZSkgYW5kICJkYXRhIiBpbiB1c2VyX2luZm86CiAgICAgICAgICAgICAgICBkYXRhX3VzZXIgPSB1c2VyX2luZm9bImRhdGEiXQogICAgICAgICAgICAgICAgdXNlcl9zdW1tYXJ5ID0gewogICAgICAgICAgICAgICAgICAgICJnb2xpa2VfdXNlcl9pZCI6IGRhdGFfdXNlci5nZXQoImlkIiksCiAgICAgICAgICAgICAgICAgICAgImdvbGlrZV91c2VyX25hbWUiOiBkYXRhX3VzZXIuZ2V0KCJuYW1lIiksCiAgICAgICAgICAgICAgICAgICAgImdvbGlrZV91c2VyX2VtYWlsIjogZGF0YV91c2VyLmdldCgiZW1haWwiKSwKICAgICAgICAgICAgICAgICAgICAiZ29saWtlX3VzZXJfdXNlcm5hbWUiOiBkYXRhX3VzZXIuZ2V0KCJ1c2VybmFtZSIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJUaMO0bmcgdGluIG5nxrDhu51pIGTDuW5nIEdvTGlrZToge3VzZXJfc3VtbWFyeX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBs4bqleSDEkcaw4bujYyB0aMO0bmcgdGluIC9tZSB04burIEdvTGlrZSBob+G6t2MgcGjhuqNuIGjhu5NpIGtow7RuZyBo4bujcCBs4buHIikKCiAgICAgICAgICAgICMgR+G7jWkgQVBJIHJlcG9ydAogICAgICAgICAgICByZXBvcnRfZGF0YSA9IHNlbGYuYXBpX3JlcXVlc3QoInN0YXRpc3RpY3MvcmVwb3J0IikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCByZXBvcnRfZGF0YSBvciAic3VjY2VzcyIgbm90IGluIHJlcG9ydF9kYXRhIG9yIG5vdCByZXBvcnRfZGF0YVsic3VjY2VzcyJdOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgbOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgdOG7qyBHb0xpa2UiKQogICAgICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBU4buVbmcgaOG7o3AgdGjDtG5nIHRpbgogICAgICAgICAgICBjdXJyZW50X2NvaW4gPSByZXBvcnRfZGF0YS5nZXQoImN1cnJlbnRfY29pbiIsIDApCiAgICAgICAgICAgIG1lc3NhZ2UgPSByZXBvcnRfZGF0YS5nZXQoIm1lc3NhZ2UiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOtbmggdOG7lW5nIHBlbmRpbmdfY29pbiB2w6AgaG9sZF9jb2luIHThu6sgY8OhYyBhcHAgcXVhbiB0w6JtCiAgICAgICAgICAgIGFwcHMgPSBbImluc3RhZ3JhbSIsICJ0aWt0b2siLCAic25hcGNoYXQiXQogICAgICAgICAgICB0b3RhbF9wZW5kaW5nX2NvaW4gPSAwCiAgICAgICAgICAgIHRvdGFsX2hvbGRfY29pbiA9IDAKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBhcHAgaW4gYXBwczoKICAgICAgICAgICAgICAgIGlmIGFwcCBpbiByZXBvcnRfZGF0YToKICAgICAgICAgICAgICAgICAgICBhcHBfZGF0YSA9IHJlcG9ydF9kYXRhW2FwcF0KICAgICAgICAgICAgICAgICAgICB0b3RhbF9wZW5kaW5nX2NvaW4gKz0gYXBwX2RhdGEuZ2V0KCJwZW5kaW5nX2NvaW4iLCAwKQogICAgICAgICAgICAgICAgICAgIHRvdGFsX2hvbGRfY29pbiArPSBhcHBfZGF0YS5nZXQoImhvbGRfY29pbiIsIDApCiAgICAgICAgICAgIAogICAgICAgICAgIAoKICAgICAgICAgICAgIyBU4bqhbyBkaWN0IGvhur90IHF14bqjIHThu5VuZyBo4bujcAogICAgICAgICAgICBzdW1tYXJ5ID0gewogICAgICAgICAgICAgICAgImN1cnJlbnRfY29pbiI6IGN1cnJlbnRfY29pbiwKICAgICAgICAgICAgICAgICJ0b3RhbF9wZW5kaW5nX2NvaW4iOiB0b3RhbF9wZW5kaW5nX2NvaW4sCiAgICAgICAgICAgICAgICAidG90YWxfaG9sZF9jb2luIjogdG90YWxfaG9sZF9jb2luLAogICAgICAgICAgICAgICAgImdvbGlrZV9yZXBvcnRfbWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICAgICAiZ29saWtlX3JlcG9ydF91cGRhdGVkX2F0IjogaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgICMgR2jDqXAgdGjDtG5nIHRpbiBuZ8aw4budaSBkw7luZyB2w6BvIHN1bW1hcnkKICAgICAgICAgICAgc3VtbWFyeS51cGRhdGUodXNlcl9zdW1tYXJ5KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgc2VsZi5kYi5zZXQoImdvbGlrZV9yZXBvcnQiLCBzdW1tYXJ5KQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHRow7RuZyB0aW4gR29MaWtlIHJlcG9ydDogeHUgaGnhu4duIHThuqFpPXtjdXJyZW50X2NvaW59LCB4dSDEkWFuZyBjaOG7nT17dG90YWxfcGVuZGluZ19jb2lufSwgeHUgZ2nhu689e3RvdGFsX2hvbGRfY29pbn0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHN1bW1hcnkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCB04burIEdvTGlrZToge2V9IikKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIAogICAgZGVmIHN0YXJ0X3JlcG9ydF90aHJlYWQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgdGhyZWFkIMSR4buLbmgga+G7syBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCB04burIEdvTGlrZQogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSB0aHJlYWQgxJHDoyBjaOG6oXkgY2jGsGEKICAgICAgICBpZiBzZWxmLnJlcG9ydF90aHJlYWQgaXMgbm90IE5vbmUgYW5kIHNlbGYucmVwb3J0X3RocmVhZC5pc19hbGl2ZSgpOgogICAgICAgICAgICBsb2dnZXIuaW5mbygiVGhyZWFkIHJlcG9ydCBHb0xpa2UgxJHDoyDEkWFuZyBjaOG6oXkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgaW1wb3J0IHRocmVhZGluZwogICAgICAgIAogICAgICAgIGRlZiByZXBvcnRfbG9vcCgpOgogICAgICAgICAgICBsb2dnZXIuaW5mbygiQuG6r3QgxJHhuqd1IHRocmVhZCBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCBHb0xpa2UgxJHhu4tuaCBr4buzIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIGPDsyBoZWFkZXJzIGNoxrBhCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5pc19nb2xpa2VfYXV0aGVudGljYXRlZCgpOgogICAgICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gcmVwb3J0CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZmV0Y2hfZ29saWtlX3JlcG9ydCgpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkNoxrBhIGPDsyBoZWFkZXJzIEdvTGlrZSwga2jDtG5nIHRo4buDIGzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgdHJvbmcgdGhyZWFkIHJlcG9ydCBHb0xpa2U6IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5n4bunIDEwIHBow7p0CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDYwMCkKICAgICAgICAKICAgICAgICAjIFThuqFvIHbDoCBraOG7n2kgxJHhu5luZyB0aHJlYWQKICAgICAgICBzZWxmLnJlcG9ydF90aHJlYWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1yZXBvcnRfbG9vcCwgZGFlbW9uPVRydWUpCiAgICAgICAgc2VsZi5yZXBvcnRfdGhyZWFkLnN0YXJ0KCkKICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBraOG7n2kgxJHhu5luZyB0aHJlYWQgbOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgR29MaWtlIMSR4buLbmgga+G7syIpCgogICAgZGVmIGdldF9nb2xpa2VfcmVwb3J0KHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IEdvTGlrZSDEkcOjIGzGsHUgdHJvbmcgZGF0YWJhc2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogVGjDtG5nIHRpbiByZXBvcnQgaG/hurdjIGRpY3QgcuG7l25nIG7hur91IGtow7RuZyBjw7MKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5kYi5nZXQoImdvbGlrZV9yZXBvcnQiLCB7fSkK').decode('utf-8'))
