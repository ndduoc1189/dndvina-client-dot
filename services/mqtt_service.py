import base64
exec(base64.b64decode('aW1wb3J0IHBhaG8ubXF0dC5jbGllbnQgYXMgbXF0dAppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCB1dWlkCmltcG9ydCBvcwpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBMaXN0LCBPcHRpb25hbCwgQ2FsbGFibGUsIFVuaW9uCmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCmltcG9ydCBzb2NrZXQKaW1wb3J0IHJhbmRvbQppbXBvcnQgc3VicHJvY2VzcwoKIyBMb2dnZXIKbG9nZ2VyID0gdXRpbHMuZ2V0X2xvZ2dlcigiTVFUVFNlcnZpY2UiKQoKY2xhc3MgTVFUVFNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgZGV2aWNlX2lkLCBoZWxwZXJfc2VydmljZT1Ob25lLCBqb2Jfc2VydmljZT1Ob25lLCBtaW5pbmdfc2VydmljZT1Ob25lKToKICAgICAgICAjIEto4bufaSB04bqhbyBjw6FjIHNlcnZpY2UKICAgICAgICBzZWxmLmRiID0gZGJfc2VydmljZQogICAgICAgIHNlbGYuaGVscGVyX3NlcnZpY2UgPSBoZWxwZXJfc2VydmljZQogICAgICAgIHNlbGYuam9iX3NlcnZpY2UgPSBqb2Jfc2VydmljZSAgIyBUaMOqbSByZWZlcmVuY2UgxJHhur9uIEpvYlNlcnZpY2UKICAgICAgICBzZWxmLm1pbmluZ19zZXJ2aWNlID0gbWluaW5nX3NlcnZpY2UgICMgVGjDqm0gcmVmZXJlbmNlIMSR4bq/biBNaW5pbmdTZXJ2aWNlCiAgICAgICAgCiAgICAgICAgIyBD4bqldSBow6xuaCBNUVRUCiAgICAgICAgc2VsZi5jbGllbnRfaWQgPSBmIntjb25maWcuTVFUVF9DTElFTlRfSURfUFJFRklYfV97cmFuZG9tLnJhbmRpbnQoMSwgOTkpfV97ZGV2aWNlX2lkfSIKICAgICAgICBzZWxmLmJyb2tlcl91cmwgPSBjb25maWcuTVFUVF9TRVJWRVJTW2NvbmZpZy5NT0RFXQogICAgICAgIHNlbGYuYnJva2VyX2FkZHJlc3MgPSBzZWxmLmJyb2tlcl91cmwucmVwbGFjZSgibXF0dDovLyIsICIiKS5zcGxpdCgiOiIpWzBdCiAgICAgICAgc2VsZi5icm9rZXJfcG9ydCA9IGludChzZWxmLmJyb2tlcl91cmwuc3BsaXQoIjoiKVstMV0pIGlmICI6IiBpbiBzZWxmLmJyb2tlcl91cmwgZWxzZSAxODgzCiAgICAgICAgc2VsZi51c2VybmFtZSA9IGNvbmZpZy5NUVRUX1VTRVJOQU1FCiAgICAgICAgc2VsZi5wYXNzd29yZCA9IGNvbmZpZy5NUVRUX1BBU1NXT1JECiAgICAgICAgCiAgICAgICAgIyBUcuG6oW5nIHRow6FpIGvhur90IG7hu5FpCiAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHNlbGYuY2xpZW50ID0gTm9uZQogICAgICAgIHNlbGYuZGV2aWNlX2lkID0gZGV2aWNlX2lkCiAgICAgICAgCiAgICAgICAgIyBSZWNvbm5lY3Rpb24gbG9naWMKICAgICAgICBzZWxmLnJlY29ubmVjdF9kZWxheSA9IDEgICMgQuG6r3QgxJHhuqd1IHbhu5tpIDEgZ2nDonkKICAgICAgICBzZWxmLm1heF9yZWNvbm5lY3RfZGVsYXkgPSA2MCAgIyBU4buRaSDEkWEgNjAgZ2nDonkKICAgICAgICBzZWxmLnJlY29ubmVjdF9jb3VudCA9IDAKICAgICAgICBzZWxmLmxhc3RfZGlzY29ubmVjdF90aW1lID0gMAogICAgICAgIHNlbGYubWFudWFsX2Rpc2Nvbm5lY3QgPSBGYWxzZSAgIyBGbGFnIMSR4buDIHBow6JuIGJp4buHdCBkaXNjb25uZWN0IGPDsyBjaOG7pyDDvSB2w6Aga2jDtG5nIGNo4bunIMO9CiAgICAgICAgCiAgICAgICAgIyBUb3BpY3MKICAgICAgICBzZWxmLnRvcGljX2NsaWVudF9zeW5jID0gY29uZmlnLk1RVFRfVE9QSUNfQ0xJRU5UX1NZTkMKICAgICAgICBzZWxmLnRvcGljX3NlcnZlcl90YXNrID0gZiJ7Y29uZmlnLk1RVFRfVE9QSUNfU0VSVkVSX1RBU0tfUFJFRklYfS97c2VsZi5kZXZpY2VfaWR9IgogICAgICAgIAogICAgICAgICMgUXXhuqNuIGzDvSB0YXNrIHbDoCBzeW5jCiAgICAgICAgc2VsZi50YXNrX2hhbmRsZXJzID0ge30KICAgICAgICBzZWxmLnN5bmNfdGhyZWFkID0gTm9uZQogICAgICAgIHNlbGYuc3luY19pbnRlcnZhbCA9IGNvbmZpZy5TWU5DX0lOVEVSVkFMCiAgICAgICAgc2VsZi5zeW5jX3J1bm5pbmcgPSBGYWxzZQogICAgCiAgICBkZWYgc2V0X2pvYl9zZXJ2aWNlKHNlbGYsIGpvYl9zZXJ2aWNlKToKICAgICAgICAiIiIKICAgICAgICDEkOG6t3QgSm9iU2VydmljZSDEkeG7gyB44butIGzDvSBjw6FjIHRow7RuZyBiw6FvIGNvbmZpZyB1cGRhdGUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2Jfc2VydmljZTogSW5zdGFuY2UgY+G7p2EgSm9iU2VydmljZQogICAgICAgICIiIgogICAgICAgIHNlbGYuam9iX3NlcnZpY2UgPSBqb2Jfc2VydmljZQogICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIMSR4bq3dCBKb2JTZXJ2aWNlIGNobyBNUVRUU2VydmljZSIpCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBzZWxmLnN0b3BfZXZlbnQgPSB0aHJlYWRpbmcuRXZlbnQoKQogICAgICAgIHNlbGYuc3luY19pbnRlcnZhbCA9IHNlbGYuZGIuZ2V0X2RldmljZV9jb25maWcoInN5bmNfaW50ZXJ2YWwiLCBjb25maWcuU1lOQ19JTlRFUlZBTCkKICAgICAgICAKICAgICAgICAjIFRoZW8gZMO1aSBSQU0gxJHhu4MgdOG7sSDEkeG7mW5nIHJlYm9vdAogICAgICAgIHNlbGYucmFtX3VzYWdlX2hpc3RvcnkgPSBbXSAgIyBMxrB1IDMgbOG6p24gxJFvIFJBTSBn4bqnbiBuaOG6pXQKICAgICAgICBzZWxmLmhpZ2hfcmFtX3RocmVzaG9sZCA9IDg4ICAjIE5nxrDhu6FuZyBSQU0gY2FvICglKQogICAgICAgIHNlbGYuY29uc2VjdXRpdmVfaGlnaF9yYW1fbGltaXQgPSAzICAjIFPhu5EgbOG6p24gbGnDqm4gdGnhur9wIFJBTSBjYW8gdHLGsOG7m2Mga2hpIHJlYm9vdAogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBtw7RpIHRyxrDhu51uZyBUZXJtdXgKICAgICAgICBzZWxmLmlzX3Rlcm11eCA9ICdURVJNVVhfVkVSU0lPTicgaW4gb3MuZW52aXJvbiBvciAnL2RhdGEvZGF0YS9jb20udGVybXV4JyBpbiBvcy5lbnZpcm9uLmdldCgnUEFUSCcsICcnKQogICAgICAgIGlmIHNlbGYuaXNfdGVybXV4OgogICAgICAgICAgICBsb2dnZXIuaW5mbygixJBhbmcgY2jhuqF5IHRyb25nIG3DtGkgdHLGsOG7nW5nIFRlcm11eCIpCgogICAgZGVmIF9jcmVhdGVfY2xpZW50KHNlbGYpIC0+IG1xdHQuQ2xpZW50OgogICAgICAgICIiIlThuqFvIHbDoCBj4bqldSBow6xuaCBNUVRUIGNsaWVudCIiIgogICAgICAgIGNsaWVudCA9IE5vbmUKCiAgICAgICAgIyBUaOG7rSB04bqhbyB24bubaSBBUEkgdjIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNsaWVudCA9IG1xdHQuQ2xpZW50KAogICAgICAgICAgICAgICAgY2xpZW50X2lkPXNlbGYuY2xpZW50X2lkLAogICAgICAgICAgICAgICAgY2xlYW5fc2Vzc2lvbj1UcnVlLAogICAgICAgICAgICAgICAgcHJvdG9jb2w9bXF0dC5NUVRUdjMxMSwKICAgICAgICAgICAgICAgIGNhbGxiYWNrX2FwaV92ZXJzaW9uPWdldGF0dHIobXF0dC5DYWxsYmFja0FQSVZlcnNpb24sICdWRVJTSU9OMicsIE5vbmUpCiAgICAgICAgICAgICkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlThuqFvIE1RVFQgY2xpZW50IHbhu5tpIEFQSSB2MiIpCiAgICAgICAgZXhjZXB0IChBdHRyaWJ1dGVFcnJvciwgVHlwZUVycm9yKToKICAgICAgICAgICAgIyBGYWxsYmFjayBBUEkgdjEKICAgICAgICAgICAgY2xpZW50ID0gbXF0dC5DbGllbnQoCiAgICAgICAgICAgICAgICBjbGllbnRfaWQ9c2VsZi5jbGllbnRfaWQsCiAgICAgICAgICAgICAgICBjbGVhbl9zZXNzaW9uPVRydWUsCiAgICAgICAgICAgICAgICBwcm90b2NvbD1tcXR0Lk1RVFR2MzExCiAgICAgICAgICAgICkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlThuqFvIE1RVFQgY2xpZW50IHbhu5tpIEFQSSB2MSIpCiAgICAgICAgCiAgICAgICAgIyBD4bqldSBow6xuaCB4w6FjIHRo4buxYyBu4bq/dSBjw7MKICAgICAgICBpZiBzZWxmLnVzZXJuYW1lIGFuZCBzZWxmLnBhc3N3b3JkOgogICAgICAgICAgICBjbGllbnQudXNlcm5hbWVfcHdfc2V0KHNlbGYudXNlcm5hbWUsIHNlbGYucGFzc3dvcmQpCiAgICAgICAgCiAgICAgICAgIyDEkMSDbmcga8O9IGNhbGxiYWNrCiAgICAgICAgY2xpZW50Lm9uX2Nvbm5lY3QgPSBzZWxmLl9vbl9jb25uZWN0CiAgICAgICAgY2xpZW50Lm9uX21lc3NhZ2UgPSBzZWxmLl9vbl9tZXNzYWdlCiAgICAgICAgY2xpZW50Lm9uX2Rpc2Nvbm5lY3QgPSBzZWxmLl9vbl9kaXNjb25uZWN0CiAgICAgICAgCiAgICAgICAgIyBD4bqldSBow6xuaCBrZWVwLWFsaXZlIGTDoGkgaMahbiB2w6AgcmVjb25uZWN0aW9uCiAgICAgICAgY2xpZW50LnJlY29ubmVjdF9kZWxheV9zZXQobWluX2RlbGF5PTEsIG1heF9kZWxheT02MCkKICAgICAgICAKICAgICAgICByZXR1cm4gY2xpZW50CgogICAgZGVmIGNvbm5lY3Qoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiJL4bq/dCBu4buRaSDEkeG6v24gTVFUVCBicm9rZXIgduG7m2kgZXhwb25lbnRpYWwgYmFja29mZiIiIgogICAgICAgIGRlZiBjYW5fY29ubmVjdChob3N0OiBzdHIsIHBvcnQ6IGludCwgdGltZW91dDogZmxvYXQgPSAzLjApIC0+IGJvb2w6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHdpdGggc29ja2V0LmNyZWF0ZV9jb25uZWN0aW9uKChob3N0LCBwb3J0KSwgdGltZW91dD10aW1lb3V0KToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIG1haW5faG9zdCA9IHNlbGYuYnJva2VyX2FkZHJlc3MKICAgICAgICBtYWluX3BvcnQgPSBzZWxmLmJyb2tlcl9wb3J0CiAgICAgICAgZmFsbGJhY2tfaG9zdCA9ICIxMC4wLjAuNiIKICAgICAgICBmYWxsYmFja19wb3J0ID0gOTAyMAoKICAgICAgICAjIEtp4buDbSB0cmEga+G6v3QgbuG7kWkgc29ja2V0IHThu5tpIGPhuqMgMiBJUAogICAgICAgIG1haW5fb2sgPSBjYW5fY29ubmVjdChtYWluX2hvc3QsIG1haW5fcG9ydCkKICAgICAgICBmYWxsYmFja19vayA9IGNhbl9jb25uZWN0KGZhbGxiYWNrX2hvc3QsIGZhbGxiYWNrX3BvcnQpCiAgICAgICAgaWYgbWFpbl9vazoKICAgICAgICAgICAgY29ubmVjdF9ob3N0ID0gbWFpbl9ob3N0CiAgICAgICAgICAgIGNvbm5lY3RfcG9ydCA9IG1haW5fcG9ydAogICAgICAgIGVsaWYgZmFsbGJhY2tfb2s6CiAgICAgICAgICAgIGNvbm5lY3RfaG9zdCA9IGZhbGxiYWNrX2hvc3QKICAgICAgICAgICAgY29ubmVjdF9wb3J0ID0gZmFsbGJhY2tfcG9ydAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyBr4bq/dCBu4buRaSDEkcaw4bujYyBzb2NrZXQgdOG7m2kgY+G6oyB7bWFpbl9ob3N0fTp7bWFpbl9wb3J0fSBs4bqrbiB7ZmFsbGJhY2tfaG9zdH06e2ZhbGxiYWNrX3BvcnR9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBU4bqhbyBjbGllbnQgbeG7m2kgbuG6v3UgY2jGsGEgY8OzIGhv4bq3YyBjbGllbnQgY8WpIGLhu4sgbOG7l2kKICAgICAgICAgICAgaWYgc2VsZi5jbGllbnQgaXMgTm9uZToKICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50ID0gc2VsZi5fY3JlYXRlX2NsaWVudCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IHRy4bqhbmcgdGjDoWkKICAgICAgICAgICAgc2VsZi5zdG9wX2V2ZW50LmNsZWFyKCkKICAgICAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgICAgICBzZWxmLm1hbnVhbF9kaXNjb25uZWN0ID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJBhbmcga+G6v3QgbuG7kWkgdOG7m2kgTVFUVCBicm9rZXIge2Nvbm5lY3RfaG9zdH06e2Nvbm5lY3RfcG9ydH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBT4butIGThu6VuZyBrZWVwYWxpdmUgbOG7m24gaMahbiAoMTIwIGdpw6J5IHRoYXkgdsOsIDYwKSDEkeG7gyBwaMOhdCBoaeG7h24gbeG6pXQga+G6v3QgbuG7kWkKICAgICAgICAgICAgIyBLaGkgbeG6pXQgbeG6oW5nIHLhu5NpIGPDsyBs4bqhaSwgY2xpZW50IHPhur0gdOG7sSDEkeG7mW5nIHJlY29ubmVjdCBxdWEgX29uX2Rpc2Nvbm5lY3QgY2FsbGJhY2sKICAgICAgICAgICAgc2VsZi5jbGllbnQuY29ubmVjdF9hc3luYyhjb25uZWN0X2hvc3QsIGNvbm5lY3RfcG9ydCwga2VlcGFsaXZlPTEyMCkKICAgICAgICAgICAgc2VsZi5jbGllbnQubG9vcF9zdGFydCgpCgogICAgICAgICAgICBkZWYgX3dhaXRfY29ubmVjdGVkKHRpbWVvdXRfc2VjOiBpbnQgPSAxNSkgLT4gYm9vbDoKICAgICAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKHRpbWVvdXRfc2VjKToKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgICAgIGlmIF93YWl0X2Nvbm5lY3RlZCgpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZyDEkeG6v24gTVFUVCBicm9rZXIge2Nvbm5lY3RfaG9zdH06e2Nvbm5lY3RfcG9ydH0iKQogICAgICAgICAgICAgICAgc2VsZi5icm9rZXJfYWRkcmVzcyA9IGNvbm5lY3RfaG9zdAogICAgICAgICAgICAgICAgc2VsZi5icm9rZXJfcG9ydCA9IGNvbm5lY3RfcG9ydAogICAgICAgICAgICAgICAgIyBSZXNldCByZWNvbm5lY3QgZGVsYXkga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgc2VsZi5yZWNvbm5lY3RfZGVsYXkgPSAxCiAgICAgICAgICAgICAgICBzZWxmLnJlY29ubmVjdF9jb3VudCA9IDAKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJL4bq/dCBu4buRaSBNUVRUIHRo4bqldCBi4bqhaSB04bubaSB7Y29ubmVjdF9ob3N0fTp7Y29ubmVjdF9wb3J0fSIpCiAgICAgICAgICAgICAgICBzZWxmLl9jbGVhbnVwX2NsaWVudCgpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBr4bq/dCBu4buRaSBNUVRUOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHNlbGYuX2NsZWFudXBfY2xpZW50KCkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9jbGVhbnVwX2NsaWVudChzZWxmKToKICAgICAgICAiIiJE4buNbiBk4bq5cCBNUVRUIGNsaWVudCIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgc2VsZi5jbGllbnQ6CiAgICAgICAgICAgICAgICBzZWxmLmNsaWVudC5sb29wX3N0b3AoKQogICAgICAgICAgICAgICAgc2VsZi5jbGllbnQuZGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICBzZWxmLmNsaWVudCA9IE5vbmUKICAgICAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgZOG7jW4gZOG6uXAgTVFUVCBjbGllbnQ6IHtlfSIpCgogICAgZGVmIGVuc3VyZV9jb25uZWN0ZWQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiLEkOG6o20gYuG6o28ga+G6v3QgbuG7kWkgTVFUVCB0csaw4bubYyBraGkgdGjhu7FjIGhp4buHbiBjw6FjIHRoYW8gdMOhYyB24bubaSByYXRlIGxpbWl0aW5nIiIiCiAgICAgICAgaWYgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIMSRYW5nIHRyb25nIHF1w6EgdHLDrG5oIHJlY29ubmVjdCBraMO0bmcKICAgICAgICBjdXJyZW50X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIGlmIGN1cnJlbnRfdGltZSAtIHNlbGYubGFzdF9kaXNjb25uZWN0X3RpbWUgPCA1OiAgIyBDaOG7nSDDrXQgbmjhuqV0IDUgZ2nDonkgdOG7qyBs4bqnbiBkaXNjb25uZWN0IGN14buRaQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIsSQYW5nIHRyb25nIHRo4budaSBnaWFuIGNvb2xkb3duIHJlY29ubmVjdCwgY2jhu50uLi4iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk1RVFQgY2jGsGEga+G6v3QgbuG7kWksIMSRYW5nIHRo4butIGvhur90IG7hu5FpIGzhuqFpLi4uIikKICAgICAgICByZXR1cm4gc2VsZi5jb25uZWN0KCkKCiAgICBkZWYgX29uX2Nvbm5lY3Qoc2VsZiwgY2xpZW50LCB1c2VyZGF0YSwgZmxhZ3MsIHJjLCBwcm9wZXJ0aWVzPU5vbmUpOgogICAgICAgICIiIkNhbGxiYWNrIGtoaSBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmciIiIKICAgICAgICBpZiByYyA9PSAwOgogICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IFRydWUKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nIHThu5tpIE1RVFQgYnJva2VyIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDEg25nIGvDvSBuaOG6rW4gdGFzawogICAgICAgICAgICBzZWxmLmNsaWVudC5zdWJzY3JpYmUoc2VsZi50b3BpY19zZXJ2ZXJfdGFzaywgcW9zPTEpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDEkcSDbmcga8O9IG5o4bqtbiB0YXNrIHThuqFpOiB7c2VsZi50b3BpY19zZXJ2ZXJfdGFza30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4butaSB0aMO0bmcgYsOhbyBr4bq/dCBu4buRaQogICAgICAgICAgICBzZWxmLnNlbmRfY29ubmVjdF9ub3RpZmljYXRpb24oKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBSZXNldCByZWNvbm5lY3QgY291bnRlciBraGkga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ID0gMAogICAgICAgICAgICBzZWxmLnJlY29ubmVjdF9kZWxheSA9IDEKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJL4bq/dCBu4buRaSBNUVRUIHRo4bqldCBi4bqhaSB24bubaSBtw6MgbOG7l2k6IHtyY30iKQogICAgICAgICAgICAjIFTEg25nIHJlY29ubmVjdCBjb3VudCBraGkga+G6v3QgbuG7kWkgdGjhuqV0IGLhuqFpCiAgICAgICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ICs9IDEKCiAgICBkZWYgX29uX2Rpc2Nvbm5lY3Qoc2VsZiwgY2xpZW50LCB1c2VyZGF0YSwgcmMsIHByb3BlcnRpZXM9Tm9uZSwgcmVhc29uX2NvZGU9Tm9uZSwgKiprd2FyZ3MpOgogICAgICAgICIiIkNhbGxiYWNrIGtoaSBuZ+G6r3Qga+G6v3QgbuG7kWkgduG7m2kgY8ahIGNo4bq/IHJlY29ubmVjdCB0aMO0bmcgbWluaCIiIgogICAgICAgIHNlbGYuaXNfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICBzZWxmLmxhc3RfZGlzY29ubmVjdF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAKICAgICAgICBpZiBzZWxmLm1hbnVhbF9kaXNjb25uZWN0OgogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBuZ+G6r3Qga+G6v3QgbuG7kWkgTVFUVCB0aGVvIHnDqnUgY+G6p3UiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgaWYgcmMgIT0gMDoKICAgICAgICAgICAgc2VsZi5yZWNvbm5lY3RfY291bnQgKz0gMQogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIk5n4bqvdCBr4bq/dCBu4buRaSBNUVRUIGtow7RuZyBtb25nIG114buRbiBs4bqnbiB7c2VsZi5yZWNvbm5lY3RfY291bnR9IHbhu5tpIG3DoyBs4buXaToge3JjfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4buJIGF1dG8tcmVjb25uZWN0IG7hur91IGtow7RuZyBwaOG6o2kgbWFudWFsIGRpc2Nvbm5lY3QKICAgICAgICAgICAgaWYgbm90IHNlbGYuc3RvcF9ldmVudC5pc19zZXQoKToKICAgICAgICAgICAgICAgIHNlbGYuX3NjaGVkdWxlX3JlY29ubmVjdCgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mgbmfhuq90IGvhur90IG7hu5FpIE1RVFQiKQoKICAgIGRlZiBfc2NoZWR1bGVfcmVjb25uZWN0KHNlbGYpOgogICAgICAgICIiIkzDqm4gbOG7i2NoIGvhur90IG7hu5FpIGzhuqFpIG3hu5dpIDMwIGdpw6J5LCBs4bq3cCB2w7QgaOG6oW4gxJHhur9uIGtoaSBk4burbmcgYXBwIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oIlPhur0gdGjhu60ga+G6v3QgbuG7kWkgbOG6oWkgc2F1IDMwIGdpw6J5Li4uIikKICAgICAgICAKICAgICAgICBkZWYgcmVjb25uZWN0X2xvb3AoKToKICAgICAgICAgICAgd2hpbGUgbm90IHNlbGYuc3RvcF9ldmVudC5pc19zZXQoKSBhbmQgbm90IHNlbGYubWFudWFsX2Rpc2Nvbm5lY3Q6CiAgICAgICAgICAgICAgICAjIENo4budIDMwIGdpw6J5LCBjw7MgdGjhu4MgYuG7iyBuZ+G6r3QgYuG7n2kgc3RvcF9ldmVudAogICAgICAgICAgICAgICAgaWYgc2VsZi5zdG9wX2V2ZW50LndhaXQoMzApOgogICAgICAgICAgICAgICAgICAgIGJyZWFrICAjIELhu4sgZOG7q25nLCB0aG/DoXQgbG9vcAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHRy4bqhbmcgdGjDoWkgdHLGsOG7m2Mga2hpIHRo4butIGvhur90IG7hu5FpCiAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2Nvbm5lY3RlZCBvciBzZWxmLm1hbnVhbF9kaXNjb25uZWN0OgogICAgICAgICAgICAgICAgICAgIGJyZWFrICAjIMSQw6Mga+G6v3QgbuG7kWkgaG/hurdjIGLhu4sgZOG7q25nIHRo4bunIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlRo4butIGvhur90IG7hu5FpIGzhuqFpIE1RVFQgKGzhuqduIHtzZWxmLnJlY29ubmVjdF9jb3VudH0pIikKICAgICAgICAgICAgICAgIGlmIHNlbGYuY29ubmVjdCgpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJL4bq/dCBu4buRaSBs4bqhaSBNUVRUIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsgICMgS+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nLCB0aG/DoXQgbG9vcAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlY29ubmVjdF9jb3VudCArPSAxCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJL4bq/dCBu4buRaSBs4bqhaSBNUVRUIHRo4bqldCBi4bqhaSBs4bqnbiB7c2VsZi5yZWNvbm5lY3RfY291bnR9LCB0aOG7rSBs4bqhaSBzYXUgMzAgZ2nDonkuLi4iKQogICAgICAgIAogICAgICAgICMgQ2jhuqF5IHRyb25nIHRocmVhZCByacOqbmcgxJHhu4Mga2jDtG5nIGJsb2NrCiAgICAgICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9cmVjb25uZWN0X2xvb3AsIGRhZW1vbj1UcnVlKS5zdGFydCgpCgogICAgZGVmIF9zYWZlX3B1Ymxpc2goc2VsZiwgdG9waWM6IHN0ciwgcGF5bG9hZDogc3RyLCBxb3M6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgR+G7rWkgbWVzc2FnZSBhbiB0b8OgbiB24bubaSBraeG7g20gdHJhIGvhur90IG7hu5FpIHRyxrDhu5tjIGtoaSBwdWJsaXNoCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdG9waWM6IE1RVFQgdG9waWMKICAgICAgICAgICAgcGF5bG9hZDogTuG7mWkgZHVuZyBtZXNzYWdlIChzdHJpbmcpCiAgICAgICAgICAgIHFvczogUXVhbGl0eSBvZiBTZXJ2aWNlICgwLCAxLCBob+G6t2MgMikKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBn4butaSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2Nvbm5lY3RlZCgpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGfhu61pIG1lc3NhZ2UgxJHhur9uIHt0b3BpY306IE1RVFQgY2jGsGEga+G6v3QgbuG7kWkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICByZXN1bHQgPSBzZWxmLmNsaWVudC5wdWJsaXNoKHRvcGljLCBwYXlsb2FkLCBxb3M9cW9zKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0LnJjID09IG1xdHQuTVFUVF9FUlJfU1VDQ0VTUzoKICAgICAgICAgICAgICAgICNsb2dnZXIuaW5mbyhmIsSQw6MgZ+G7rWkgbWVzc2FnZSB0aMOgbmggY8O0bmcgxJHhur9uIHt0b3BpY30iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4butaSBtZXNzYWdlIMSR4bq/biB7dG9waWN9OiB7bXF0dC5lcnJvcl9zdHJpbmcocmVzdWx0LnJjKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIG1lc3NhZ2UgxJHhur9uIHt0b3BpY306IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIHNlbmRfdGFza19yZXBvcnQoc2VsZiwgdGFza19pZDogc3RyLCBkZXZpY2VfaWQ6IHN0ciwgc3RhdHVzOiBzdHIsIGNsaWVudF9tZXNzYWdlOiBzdHIgPSAiIik6CiAgICAgICAgIiIiR+G7rWkgYsOhbyBjw6FvIGvhur90IHF14bqjIHRo4buxYyBoaeG7h24gdGFzayIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVwb3J0X2RhdGEgPSB7CiAgICAgICAgICAgICAgICAidGFza19pZCI6IHRhc2tfaWQsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgInN0YXR1cyI6IHN0YXR1cywKICAgICAgICAgICAgICAgICJjbGllbnRfbWVzc2FnZSI6IGNsaWVudF9tZXNzYWdlLAogICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgc2VsZi5fc2FmZV9wdWJsaXNoKCJkbmR2aW5hL2NsaWVudC90YXNrX3JlcG9ydCIsIGpzb24uZHVtcHMocmVwb3J0X2RhdGEpKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBn4butaSBiw6FvIGPDoW8gdGFzayB7dGFza19pZH0gduG7m2kgdHLhuqFuZyB0aMOhaSB7c3RhdHVzfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7rWkgYsOhbyBjw6FvIHRhc2s6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIHNlbmRfY29ubmVjdF9ub3RpZmljYXRpb24oc2VsZik6CiAgICAgICAgIiIiR+G7rWkgdGjDtG5nIGLDoW8ga+G6v3QgbuG7kWkgxJHhur9uIHNlcnZlciIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgY29ubmVjdF9kYXRhID0gewogICAgICAgICAgICAgICAgImRldmljZV9pZCI6IHNlbGYuZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgc2VsZi5fc2FmZV9wdWJsaXNoKCJkbmR2aW5hL2NsaWVudC9jb25uZWN0IiwganNvbi5kdW1wcyhjb25uZWN0X2RhdGEpKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBn4butaSB0aMO0bmcgYsOhbyBr4bq/dCBu4buRaSBjaG8gdGhp4bq/dCBi4buLIHtzZWxmLmRldmljZV9pZH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiByZWdpc3Rlcl90YXNrX2hhbmRsZXIoc2VsZiwgdGFza190eXBlOiBzdHIsIGhhbmRsZXI6IENhbGxhYmxlKToKICAgICAgICAiIiIKICAgICAgICDEkMSDbmcga8O9IGhhbmRsZXIgY2hvIGxv4bqhaSB0YXNrCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza190eXBlOiBMb+G6oWkgdGFzawogICAgICAgICAgICBoYW5kbGVyOiBIw6BtIHjhu60gbMO9IHRhc2sKICAgICAgICAiIiIKICAgICAgICBzZWxmLnRhc2tfaGFuZGxlcnNbdGFza190eXBlXSA9IGhhbmRsZXIKICAgIAogICAgZGVmIF9yZWFkX3JlY2VudF9sb2dzKHNlbGYsIG51bV9saW5lcz0yMDApOgogICAgICAgICIiIgogICAgICAgIMSQ4buNYyBjw6FjIGTDsm5nIGxvZyBn4bqnbiBuaOG6pXQgdOG7qyBmaWxlIGFwcC5sb2cKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBudW1fbGluZXM6IFPhu5EgZMOybmcgbG9nIGPhuqduIMSR4buNYyAobeG6t2MgxJHhu4tuaCAxMDApCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3Rbc3RyXTogRGFuaCBzw6FjaCBjw6FjIGTDsm5nIGxvZyBn4bqnbiBuaOG6pXQgaG/hurdjIHRow7RuZyBiw6FvIGzhu5dpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2dfZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKGNvbmZpZy5CQVNFX0RJUiwgImFwcC5sb2ciKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGxvZ19maWxlX3BhdGgpOgogICAgICAgICAgICAgICAgIyBGaWxlIGNoxrBhIMSRxrDhu6NjIHThuqFvIGLhu59pIGxvZ2dpbmcgc3lzdGVtCiAgICAgICAgICAgICAgICByZXR1cm4gW2YiW0lORk9dIEZpbGUgbG9nIGNoxrBhIMSRxrDhu6NjIHThuqFvLCBjaMawYSBjw7MgbG9nIG7DoG8iXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu60gxJHhu41jIGZpbGUgduG7m2kgcmV0cnkgxJHhu4MgdHLDoW5oIHh1bmcgxJHhu5l0CiAgICAgICAgICAgIG1heF9yZXRyaWVzID0gMwogICAgICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfcmV0cmllcyk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlX3BhdGgsICdyJywgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOgogICAgICAgICAgICAgICAgICAgICAgICBsaW5lcyA9IGYucmVhZGxpbmVzKCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBudW1fbGluZXMgZMOybmcgY3Xhu5FpIGPDuW5nCiAgICAgICAgICAgICAgICAgICAgcmVjZW50X2xpbmVzID0gbGluZXNbLW51bV9saW5lczpdIGlmIGxlbihsaW5lcykgPiBudW1fbGluZXMgZWxzZSBsaW5lcwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTG/huqFpIGLhu48ga8O9IHThu7EgeHXhu5FuZyBkw7JuZyB2w6AgY8OhYyBraG/huqNuZyB0cuG6r25nIHRo4burYQogICAgICAgICAgICAgICAgICAgIHJlY2VudF9sb2dzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiByZWNlbnRfbGluZXMgaWYgbGluZS5zdHJpcCgpXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWNlbnRfbG9ncwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZXhjZXB0IChQZXJtaXNzaW9uRXJyb3IsIElPRXJyb3IsIE9TRXJyb3IpIGFzIGZpbGVfZXJyb3I6CiAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9yZXRyaWVzIC0gMToKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjEpICAjIENo4budIDEwMG1zIHLhu5NpIHRo4butIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtmIltFUlJPUl0gS2jDtG5nIHRo4buDIMSR4buNYyBmaWxlIGxvZzoge3N0cihmaWxlX2Vycm9yKX0iXQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBbZiJbRVJST1JdIEzhu5dpIMSR4buNYyBmaWxlIGxvZzoge3N0cihlKX0iXQoKICAgIGRlZiBzeW5jX2RhdGEoc2VsZik6CiAgICAgICAgIiIixJDhu5NuZyBi4buZIGThu68gbGnhu4d1IHbhu5tpIHNlcnZlciIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBO4bq/dSBjaMawYSBr4bq/dCBu4buRaSBNUVRULCBraMO0bmcgdGjhu4MgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmlzX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJDaMawYSBr4bq/dCBu4buRaSBNUVRULCBraMO0bmcgdGjhu4MgxJHhu5NuZyBi4buZIGThu68gbGnhu4d1IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgaGVscGVyIHNlcnZpY2UKICAgICAgICAgICAgaGVscGVyID0gc2VsZi5oZWxwZXJfc2VydmljZQogICAgICAgICAgICBpZiBub3QgaGVscGVyOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgY8OzIGhlbHBlciBzZXJ2aWNlLCBraMO0bmcgdGjhu4MgxJHhu5NuZyBi4buZIGThu68gbGnhu4d1IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZGV2aWNlX2lkCiAgICAgICAgICAgIGRldmljZV9pZCA9IHNlbGYuZGIuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgICAgICBpZiBub3QgZGV2aWNlX2lkOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgeMOhYyDEkeG7i25oIGRldmljZV9pZCwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGRldmljZV9pbmZvID0gTm9uZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXZpY2VfaW5mb19yZXNwb25zZSA9IGhlbHBlci5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGzhuqV5IHRow6BuaCBjw7RuZywgbMawdSB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgICAgICBpZiBkZXZpY2VfaW5mb19yZXNwb25zZVsic3RhdHVzIl0gPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gZGV2aWNlX2luZm9fcmVzcG9uc2U6CiAgICAgICAgICAgICAgICAgICAgIyBMxrB1IHRow7RuZyB0aW4gdGhp4bq/dCBi4buLIHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNhdmVfZGV2aWNlX2luZm8oZGV2aWNlX2luZm9fcmVzcG9uc2VbImRhdGEiXSkKICAgICAgICAgICAgICAgICAgICBkZXZpY2VfaW5mbyA9IGRldmljZV9pbmZvX3Jlc3BvbnNlWyJkYXRhIl0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRoZW8gZMO1aSBSQU0gxJHhu4MgdOG7sSDEkeG7mW5nIHJlYm9vdAogICAgICAgICAgICAgICAgICAgIHNlbGYuX21vbml0b3JfcmFtX3VzYWdlKGRldmljZV9pbmZvKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbOG6pXkgdGjDtG5nIHRpbiB0aGnhur90IGLhu4s6IHtlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgbOG6pXkgxJHGsOG7o2MgdGjDtG5nIHRpbiB0aGnhur90IGLhu4ssIHPhu60gZOG7pW5nIHRow7RuZyB0aW4gxJHDoyBsxrB1IHRyb25nIGRhdGFiYXNlCiAgICAgICAgICAgIGlmIG5vdCBkZXZpY2VfaW5mbzoKICAgICAgICAgICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5kYi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBkZXZpY2VfaW5mbzoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJLaMO0bmcgY8OzIHRow7RuZyB0aW4gdGhp4bq/dCBi4buLLCDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UgY8OzIHRo4buDIGtow7RuZyDEkeG6p3kgxJHhu6ciKQogICAgICAgICAgICAgICAgZGV2aWNlX2luZm8gPSB7fQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGRldmljZV9jb25maWcgPSBzZWxmLmRiLmdldF9hbGxfZGV2aWNlX2NvbmZpZygpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu5lwIGPDoWMgdHLhuqFuZyB0aMOhaSBydW50aW1lIChwYXVzZV9qb2IsIGRldmljZV9pc193b3JraW5nLCBkZXZpY2VfbWVzc2FnZSkgdsOgbyBkZXZpY2VfaW5mbwogICAgICAgICAgICBmb3IgcnVudGltZV9rZXkgaW4gWyJwYXVzZV9qb2IiLCAiZGV2aWNlX2lzX3dvcmtpbmciLCAiZGV2aWNlX21lc3NhZ2UiXToKICAgICAgICAgICAgICAgIGlmIHJ1bnRpbWVfa2V5IGluIGRldmljZV9jb25maWc6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2luZm9bcnVudGltZV9rZXldID0gZGV2aWNlX2NvbmZpZy5wb3AocnVudGltZV9rZXkpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgR2nDoSB0cuG7iyBt4bq3YyDEkeG7i25oIG7hur91IGNoxrBhIGPhuqV1IGjDrG5oCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2luZm9bcnVudGltZV9rZXldID0gRmFsc2UgaWYgcnVudGltZV9rZXkgIT0gImRldmljZV9tZXNzYWdlIiBlbHNlICIiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIGdvbGlrZV9yZXBvcnQga2jhu49pIGRldmljZV9jb25maWcgxJHhu4MgZ+G7rWkgcmnDqm5nCiAgICAgICAgICAgIGdvbGlrZV9yZXBvcnQgPSBOb25lCiAgICAgICAgICAgIGlmICJnb2xpa2VfcmVwb3J0IiBpbiBkZXZpY2VfY29uZmlnOgogICAgICAgICAgICAgICAgZ29saWtlX3JlcG9ydCA9IGRldmljZV9jb25maWcucG9wKCJnb2xpa2VfcmVwb3J0IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTG/huqFpIGLhu48gZ29saWtlX2FwaV9iYXNlIGto4buPaSBkZXZpY2VfY29uZmlnCiAgICAgICAgICAgIGlmICJnb2xpa2VfYXBpX2Jhc2UiIGluIGRldmljZV9jb25maWc6CiAgICAgICAgICAgICAgICBkZXZpY2VfY29uZmlnLnBvcCgiZ29saWtlX2FwaV9iYXNlIikKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygixJDDoyBsb+G6oWkgYuG7jyBnb2xpa2VfYXBpX2Jhc2Uga2jhu49pIGThu68gbGnhu4d1IMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IG1pbmluZ19pbmZvIHThu6sgbWluaW5nX3NlcnZpY2UgKG7hur91IGPDsykKICAgICAgICAgICAgbWluaW5nX2luZm8gPSBOb25lCiAgICAgICAgICAgIGlmIHNlbGYubWluaW5nX3NlcnZpY2U6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgbWluaW5nX3N1bW1hcnkgPSBzZWxmLm1pbmluZ19zZXJ2aWNlLmdldF9taW5pbmdfc3VtbWFyeSgpCiAgICAgICAgICAgICAgICAgICAgaWYgbWluaW5nX3N1bW1hcnkuZ2V0KCJzdWNjZXNzIik6CiAgICAgICAgICAgICAgICAgICAgICAgIG1pbmluZ19pbmZvID0gbWluaW5nX3N1bW1hcnkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiTOG6pXkgbWluaW5nIGluZm86IHttaW5pbmdfaW5mby5nZXQoJ3J1bm5pbmdfbWluZXJzJywgMCl9L3ttaW5pbmdfaW5mby5nZXQoJ3RvdGFsX21pbmVycycsIDApfSBtaW5lcnMiKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIGzhuqV5IG1pbmluZyBpbmZvOiB7ZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgY8OhYyB0w6BpIGtob+G6o24gY2jGsGEgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIHBlbmRpbmdfYWNjb3VudHMgPSBzZWxmLmRiLmdldF9wZW5kaW5nX3N5bmNfaXRlbXMoImFjY291bnRzIiwgbGltaXQ9NTApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGPDoWMgam9iIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICAgICBwZW5kaW5nX2pvYnMgPSBzZWxmLmRiLmdldF9wZW5kaW5nX3N5bmNfaXRlbXMoImpvYnNfaGlzdG9yeSIsIGxpbWl0PTUwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG7jWMgMjAwIGTDsm5nIGxvZyBn4bqnbiBuaOG6pXQKICAgICAgICAgICAgcmVjZW50X2xvZ3MgPSBzZWxmLl9yZWFkX3JlY2VudF9sb2dzKDIwMCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHBheWxvYWQKICAgICAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiBkZXZpY2VfaWQsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2luZm8iOiBkZXZpY2VfaW5mbywKICAgICAgICAgICAgICAgICJkZXZpY2VfY29uZmlnIjogZGV2aWNlX2NvbmZpZywKICAgICAgICAgICAgICAgICJtZXRhX2RhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgImRldmljZV9sb2dzIjogcmVjZW50X2xvZ3MKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidGltZXN0YW1wIjogaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGdvbGlrZV9yZXBvcnQgbuG6v3UgY8OzCiAgICAgICAgICAgIGlmIGdvbGlrZV9yZXBvcnQ6CiAgICAgICAgICAgICAgICBwYXlsb2FkWyJnb2xpa2VfcmVwb3J0Il0gPSBnb2xpa2VfcmVwb3J0CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIG1pbmluZ19pbmZvIG7hur91IGPDswogICAgICAgICAgICBpZiBtaW5pbmdfaW5mbzoKICAgICAgICAgICAgICAgIHBheWxvYWRbIm1pbmluZ19pbmZvIl0gPSBtaW5pbmdfaW5mbwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mSBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgcGVuZGluZ19hY2NvdW50czoKICAgICAgICAgICAgICAgIHBheWxvYWRbImFjY291bnRzIl0gPSBwZW5kaW5nX2FjY291bnRzCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkOG7k25nIGLhu5kge2xlbihwZW5kaW5nX2FjY291bnRzKX0gdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBqb2IgY2jGsGEgxJHhu5NuZyBi4buZIG7hur91IGPDswogICAgICAgICAgICBpZiBwZW5kaW5nX2pvYnM6CiAgICAgICAgICAgICAgICBwYXlsb2FkWyJqb2JzIl0gPSBwZW5kaW5nX2pvYnMKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIsSQ4buTbmcgYuG7mSB7bGVuKHBlbmRpbmdfam9icyl9IGpvYiBjaMawYSDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7rWkgZOG7ryBsaeG7h3UKICAgICAgICAgICAgc2VsZi5fc2FmZV9wdWJsaXNoKGNvbmZpZy5NUVRUX1RPUElDX0NMSUVOVF9TWU5DLCBqc29uLmR1bXBzKHBheWxvYWQpKQogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgxJHhu5NuZyBi4buZIGThu68gbGnhu4d1IHbhu5tpIHNlcnZlciIpCiAgICAKICAgIGRlZiBzdGFydF9zeW5jX3RocmVhZChzZWxmKToKICAgICAgICAiIiJC4bqvdCDEkeG6p3UgdGhyZWFkIMSR4buTbmcgYuG7mSB04buxIMSR4buZbmciIiIKICAgICAgICBpZiBzZWxmLnN5bmNfdGhyZWFkIGlzIG5vdCBOb25lIGFuZCBzZWxmLnN5bmNfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJUaHJlYWQgxJHhu5NuZyBi4buZIMSRw6MgxJFhbmcgY2jhuqF5IikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgIHNlbGYucnVubmluZyA9IFRydWUKICAgICAgICBzZWxmLnN0b3BfZXZlbnQuY2xlYXIoKQogICAgICAgIHNlbGYuc3luY190aHJlYWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1zZWxmLl9zeW5jX2xvb3AsIGRhZW1vbj1UcnVlKQogICAgICAgIHNlbGYuc3luY190aHJlYWQuc3RhcnQoKQogICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGto4bufaSDEkeG7mW5nIHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIikKICAgIAogICAgZGVmIF9zeW5jX2xvb3Aoc2VsZik6CiAgICAgICAgIiIiTG9vcCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oZiJC4bqvdCDEkeG6p3UgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyBt4buXaSB7c2VsZi5zeW5jX2ludGVydmFsfSBnacOieSIpCgogICAgICAgIHdoaWxlIG5vdCBzZWxmLnN0b3BfZXZlbnQuaXNfc2V0KCkgYW5kIHNlbGYucnVubmluZzoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zeW5jX2RhdGEoKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB0cm9uZyBxdcOhIHRyw6xuaCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOZ2jhu4kgxJHhur9uIGzhuqduIMSR4buTbmcgYuG7mSB0aeG6v3AgdGhlbwogICAgICAgICAgICBmb3IgXyBpbiByYW5nZShzZWxmLnN5bmNfaW50ZXJ2YWwpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpIG9yIG5vdCBzZWxmLnJ1bm5pbmc6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgIAogICAgZGVmIHN0b3Bfc3luY190aHJlYWQoc2VsZik6CiAgICAgICAgIiIiROG7q25nIHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIiIiCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBzZWxmLnN0b3BfZXZlbnQuc2V0KCkKICAgICAgICBpZiBzZWxmLnN5bmNfdGhyZWFkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLnN5bmNfdGhyZWFkLmpvaW4odGltZW91dD0yLjApCiAgICAgICAgICAgIHNlbGYuc3luY190aHJlYWQgPSBOb25lCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgZOG7q25nIHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIikKICAgIAogICAgZGVmIGRpc2Nvbm5lY3Qoc2VsZik6CiAgICAgICAgIiIiTmfhuq90IGvhur90IG7hu5FpIE1RVFQiIiIKICAgICAgICBzZWxmLm1hbnVhbF9kaXNjb25uZWN0ID0gVHJ1ZSAgIyDEkMOhbmggZOG6pXUgxJHDonkgbMOgIGRpc2Nvbm5lY3QgY8OzIGNo4bunIMO9CiAgICAgICAgc2VsZi5zdG9wX3N5bmNfdGhyZWFkKCkKICAgICAgICAKICAgICAgICBpZiBzZWxmLmNsaWVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5jbGllbnQubG9vcF9zdG9wKCkKICAgICAgICAgICAgc2VsZi5jbGllbnQuZGlzY29ubmVjdCgpCiAgICAgICAgICAgIHNlbGYuaXNfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mgbmfhuq90IGvhur90IG7hu5FpIE1RVFQiKQogICAgICAgIAogICAgICAgICMgROG7q25nIHThuqV0IGPhuqMgYXV0by1yZWNvbm5lY3QKICAgICAgICBzZWxmLnN0b3BfZXZlbnQuc2V0KCkKICAgIAogICAgZGVmIHNldHVwX21xdHRfaGFuZGxlcnMoc2VsZik6CiAgICAgICAgIiIiVGhp4bq/dCBs4bqtcCBjw6FjIGhhbmRsZXIgY2hvIE1RVFQgdGFza3MiIiIKICAgICAgICAjIMSQxINuZyBrw70gY8OhYyB0YXNrIGhhbmRsZXIgbeG6t2MgxJHhu4tuaAogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJ1cGRhdGVfY29uZmlnIiwgc2VsZi5faGFuZGxlX3VwZGF0ZV9kZXZpY2VfY29uZmlnKQogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJ1cGRhdGVfc3luY2VkIiwgc2VsZi5faGFuZGxlX3VwZGF0ZV9zeW5jZWQpCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoImFjY291bnRfdXBkYXRlIiwgc2VsZi5faGFuZGxlX2FjY291bnRfdXBkYXRlKQogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJ1cGRhdGVfcHJveHkiLCBzZWxmLl9oYW5kbGVfdXBkYXRlX3Byb3h5KQogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJ1cGRhdGVfbWluaW5nX2NvbmZpZyIsIHNlbGYuX2hhbmRsZV9taW5pbmdfY29uZmlnX3VwZGF0ZSkKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbygixJDDoyB0aGnhur90IGzhuq1wIGPDoWMgTVFUVCB0YXNrIGhhbmRsZXIiKQogICAgCiAgICBkZWYgX2hhbmRsZV9taW5pbmdfY29uZmlnX3VwZGF0ZShzZWxmLCB0YXNrX2RhdGEpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgdXBkYXRlIG1pbmluZyBjb25maWcgdOG7qyBzZXJ2ZXIKICAgICAgICAKICAgICAgICBUYXNrIGZvcm1hdCB04burIHNlcnZlciBNUVRUOgogICAgICAgIHsKICAgICAgICAgICAgInRhc2tfaWQiOiAidGFza18xMjM0NTY3ODkwXzEyMyIsCiAgICAgICAgICAgICJkZXZpY2VfaWQiOiAiZGV2aWNlLTAwMSIsCiAgICAgICAgICAgICJ0YXNrX3R5cGUiOiAidXBkYXRlX21pbmluZ19jb25maWciLAogICAgICAgICAgICAiZGF0YSI6IHsKICAgICAgICAgICAgICAgICJtaW5pbmdfY29uZmlnIjogWwogICAgICAgICAgICAgICAgICAgIHsgImNvaW5fbmFtZSI6ICJWUlNDIiwgIm1pbmluZ190b29sIjogImNjbWluZXIiLCAiY29uZmlnIjogey4uLn0gfSwKICAgICAgICAgICAgICAgICAgICB7ICJjb2luX25hbWUiOiAiREVSTyIsICJtaW5pbmdfdG9vbCI6ICJhc3Ryb21pbmVyIiwgImNvbmZpZyI6IHsuLi59IH0KICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm1lc3NhZ2UiOiAiQ+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIG1pbmluZyIsCiAgICAgICAgICAgICJ0aW1lc3RhbXAiOiAiMjAyNS0xMC0yOFQuLi4iCiAgICAgICAgfQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICBtaW5pbmdfY29uZmlnX2FycmF5ID0gZGF0YS5nZXQoIm1pbmluZ19jb25maWciLCBbXSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIHnDqnUgY+G6p3UgY+G6rXAgbmjhuq10IG1pbmluZyBjb25maWcgdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG1pbmluZ19zZXJ2aWNlIGPDsyB04buTbiB04bqhaSBraMO0bmcKICAgICAgICAgICAgaWYgbm90IHNlbGYubWluaW5nX3NlcnZpY2U6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSAiTWluaW5nIHNlcnZpY2UgY2jGsGEgxJHGsOG7o2Mga2jhu59pIHThuqFvIgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBtaW5pbmdfY29uZmlnX2FycmF5OgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gIk1pbmluZyBjb25maWcgYXJyYXkgcuG7l25nIgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBjb25maWcgb2JqZWN0IMSR4buDIGfhu61pIHNhbmcgbWluaW5nIEFQSQogICAgICAgICAgICAjIGF1dG9fc3RhcnQgbeG6t2MgxJHhu4tuaCB0cnVlCiAgICAgICAgICAgICMgbGFzdF9zeW5jX2NvbmZpZyBsw6AgdGltZXN0YW1wIGhp4buHbiB04bqhaQogICAgICAgICAgICBjb25maWdfdG9fdXBkYXRlID0gewogICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAgICAgImF1dG9fc3RhcnQiOiBUcnVlLAogICAgICAgICAgICAgICAgIm1pbmVycyI6IG1pbmluZ19jb25maWdfYXJyYXkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyB1cGRhdGUge2xlbihtaW5pbmdfY29uZmlnX2FycmF5KX0gbWluZXJzIHbhu5tpIGF1dG9fc3RhcnQ9VHJ1ZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIHRy4buxYyB0aeG6v3AgdXBkYXRlX2NvbmZpZyAoZm9yY2U9VHJ1ZSBt4bq3YyDEkeG7i25oKSDEkeG7gyDEkcOoIGNvbmZpZwogICAgICAgICAgICByZXN1bHQgPSBzZWxmLm1pbmluZ19zZXJ2aWNlLnVwZGF0ZV9jb25maWcoY29uZmlnX3RvX3VwZGF0ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgICMgTOG6pXkgc3VtbWFyeSDEkeG7gyBiw6FvIGPDoW8KICAgICAgICAgICAgICAgIHN1bW1hcnkgPSBzZWxmLm1pbmluZ19zZXJ2aWNlLmdldF9taW5pbmdfc3VtbWFyeSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAoCiAgICAgICAgICAgICAgICAgICAgZiLEkMOjIGPhuq1wIG5o4bqtdCBtaW5pbmcgY29uZmlnOiAiCiAgICAgICAgICAgICAgICAgICAgZiJ7c3VtbWFyeS5nZXQoJ3J1bm5pbmdfbWluZXJzJywgMCl9L3tzdW1tYXJ5LmdldCgndG90YWxfbWluZXJzJywgMCl9IG1pbmVycyBydW5uaW5nIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBtZXNzYWdlKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdGjhu4MgdXBkYXRlIG1pbmluZyBjb25maWc6IHtyZXN1bHQuZ2V0KCdlcnJvcicsICdVbmtub3duIGVycm9yJyl9IgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSB44butIGzDvSBtaW5pbmcgY29uZmlnIHVwZGF0ZSIpCiAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCgKICAgICAgICAgICAgICAgIHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKSwKICAgICAgICAgICAgICAgIHRhc2tfZGF0YS5nZXQoImRldmljZV9pZCIpLAogICAgICAgICAgICAgICAgImZhaWxlZCIsCiAgICAgICAgICAgICAgICBmIkzhu5dpOiB7c3RyKGUpfSIKICAgICAgICAgICAgKQogICAgICAgIAogICAgZGVmIF9oYW5kbGVfdXBkYXRlX2RldmljZV9jb25maWcoc2VsZiwgdGFza19kYXRhKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX2RhdGE6IEThu68gbGnhu4d1IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIHnDqnUgY+G6p3UgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyB04burIHNlcnZlciAodGFza19pZDoge3Rhc2tfaWR9KSIpCiAgICAgICAgICAgIGNvbmZpZ19kYXRhID0gdGFza19kYXRhLmdldCgiY29uZmlnX2RhdGEiLCB7fSkKICAgICAgICAgICAgaWYgbm90IGNvbmZpZ19kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkThu68gbGnhu4d1IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyBy4buXbmciKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsICJE4buvIGxp4buHdSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgcuG7l25nIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IHThu6tuZyBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAgICAgc3VjY2VzcyA9IHNlbGYuZGIuc2F2ZV9kZXZpY2VfY29uZmlnKGNvbmZpZ19kYXRhKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLOiB7JywgJy5qb2luKGNvbmZpZ19kYXRhLmtleXMoKSl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdOG6pXQgY+G6oyB0w6BpIGtob+G6o24gbMOgIGNoxrBhIHN5bmMgxJHhu4MgxJHhuqNtIGLhuqNvIHRow7RuZyB0aW4gbeG7m2kgbmjhuqV0IMSRxrDhu6NjIGfhu61pIGzDqm4gc2VydmVyCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF9hY2NvdW50cyA9IHNlbGYuZGIubWFya19hbGxfYWNjb3VudHNfbm90X3N5bmNlZCgpCiAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9hY2NvdW50cyA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDEkcOhbmggZOG6pXUge3VwZGF0ZWRfYWNjb3VudHN9IHTDoGkga2hv4bqjbiBsw6AgY2jGsGEgc3luYyBzYXUga2hpIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4siKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiS2jDtG5nIGPDsyB0w6BpIGtob+G6o24gbsOgbyBj4bqnbiDEkcOhbmggZOG6pXUgY2jGsGEgc3luYyIpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgxJHDoW5oIGThuqV1IHTDoGkga2hv4bqjbiBjaMawYSBzeW5jOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIGZhaWwgdGFzayB2w6wgdmnhu4djIGPhuq1wIG5o4bqtdCBjb25maWcgxJHDoyB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgc3luY19pbnRlcnZhbCBu4bq/dSBuw7MgdGhheSDEkeG7lWkKICAgICAgICAgICAgICAgIGlmICJzeW5jX2ludGVydmFsIiBpbiBjb25maWdfZGF0YToKICAgICAgICAgICAgICAgICAgICBuZXdfc3luY19pbnRlcnZhbCA9IGNvbmZpZ19kYXRhWyJzeW5jX2ludGVydmFsIl0KICAgICAgICAgICAgICAgICAgICBpZiBuZXdfc3luY19pbnRlcnZhbCAhPSBzZWxmLnN5bmNfaW50ZXJ2YWw6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiQ+G6rXAgbmjhuq10IHN5bmNfaW50ZXJ2YWwgdOG7qyB7c2VsZi5zeW5jX2ludGVydmFsfSB0aMOgbmgge25ld19zeW5jX2ludGVydmFsfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3luY19pbnRlcnZhbCA9IG5ld19zeW5jX2ludGVydmFsCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEto4bufaSDEkeG7mW5nIGzhuqFpIHRocmVhZCDEkeG7k25nIGLhu5kgbuG6v3UgxJFhbmcgY2jhuqF5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuc3luY190aHJlYWQgaXMgbm90IE5vbmUgYW5kIHNlbGYuc3luY190aHJlYWQuaXNfYWxpdmUoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJLaOG7n2kgxJHhu5luZyBs4bqhaSB0aHJlYWQgxJHhu5NuZyBi4buZIHbhu5tpIGtob+G6o25nIHRo4budaSBnaWFuIG3hu5tpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3RvcF9zeW5jX3RocmVhZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0X3N5bmNfdGhyZWFkKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaMO0bmcgYsOhbyBjaG8gSm9iU2VydmljZSB24buBIHThuqV0IGPhuqMgY29uZmlnIHVwZGF0ZQogICAgICAgICAgICAgICAgaWYgc2VsZi5qb2Jfc2VydmljZSBhbmQgaGFzYXR0cihzZWxmLmpvYl9zZXJ2aWNlLCAnaGFuZGxlX21xdHRfY29uZmlnX3VwZGF0ZScpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJUaMO0bmcgYsOhbyBKb2JTZXJ2aWNlIHbhu4EgY29uZmlnIHVwZGF0ZSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5qb2Jfc2VydmljZS5oYW5kbGVfbXF0dF9jb25maWdfdXBkYXRlKGNvbmZpZ19kYXRhKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIExvZyB0aMOqbSB0aMO0bmcgdGluIHbhu4Egam9iLXJlbGF0ZWQgY29uZmlncwogICAgICAgICAgICAgICAgam9iX3JlbGF0ZWRfa2V5cyA9IFsibWF4X2pvYnNfcGVyX2RheSIsICJtYXhfam9ic19wZXJfc2Vzc2lvbiIsICJqb2JfaW50ZXJ2YWxfc2Vjb25kcyIsICJjYXJlX2luX3dvcmtpbmdfam9iIl0KICAgICAgICAgICAgICAgIGlmIGFueShrZXkgaW4gY29uZmlnX2RhdGEgZm9yIGtleSBpbiBqb2JfcmVsYXRlZF9rZXlzKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiQ+G6pXUgaMOsbmggbGnDqm4gcXVhbiDEkeG6v24gSm9iU2VydmljZSDEkcOjIMSRxrDhu6NjIGPhuq1wIG5o4bqtdCIpCiAgICAgICAgICAgICAgICAgICAgIyBKb2JTZXJ2aWNlIHPhur0geOG7rSBsw70gbG9naWMgcmVzdGFydCBzZXNzaW9uIG7hur91IGPhuqduIHRoaeG6v3QKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBH4butaSBiw6FvIGPDoW8gdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAic3VjY2VzcyIsIGYixJDDoyBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLOiB7JywgJy5qb2luKGNvbmZpZ19kYXRhLmtleXMoKSl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gIktow7RuZyB0aOG7gyBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLIgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSB44butIGzDvSBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLOiB7c3RyKGUpfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQoKICAgIGRlZiBfaGFuZGxlX3VwZGF0ZV9zeW5jZWQoc2VsZiwgdGFza19kYXRhKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfZGF0YTogROG7ryBsaeG7h3UgdGFzayB04burIHNlcnZlcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJOaOG6rW4gecOqdSBj4bqndSBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kgdOG7qyBzZXJ2ZXIiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAKICAgICAgICAgICAgYWNjb3VudF9jb3VudCA9IDAKICAgICAgICAgICAgam9iX2NvdW50ID0gMAogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIMSRw6MgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIGlmICJhY2NvdW50cyIgaW4gZGF0YSBhbmQgaXNpbnN0YW5jZShkYXRhWyJhY2NvdW50cyJdLCBsaXN0KToKICAgICAgICAgICAgICAgIGZvciBhY2NvdW50X3V1aWQgaW4gZGF0YVsiYWNjb3VudHMiXToKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLm1hcmtfYXNfc3luY2VkKCJhY2NvdW50cyIsIGFjY291bnRfdXVpZCkKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIMSRw6MgxJHhu5NuZyBi4buZOiB7YWNjb3VudF91dWlkfSIpCiAgICAgICAgICAgICAgICBhY2NvdW50X2NvdW50ID0gbGVuKGRhdGFbImFjY291bnRzIl0pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQw6FuaCBk4bqldSBqb2IgxJHDoyDEkeG7k25nIGLhu5kKICAgICAgICAgICAgaWYgImpvYnMiIGluIGRhdGEgYW5kIGlzaW5zdGFuY2UoZGF0YVsiam9icyJdLCBsaXN0KToKICAgICAgICAgICAgICAgIGZvciBqb2JfdXVpZCBpbiBkYXRhWyJqb2JzIl06CiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5tYXJrX2FzX3N5bmNlZCgiam9ic19oaXN0b3J5Iiwgam9iX3V1aWQpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYixJDDoW5oIGThuqV1IGpvYiDEkcOjIMSR4buTbmcgYuG7mToge2pvYl91dWlkfSIpCiAgICAgICAgICAgICAgICBqb2JfY291bnQgPSBsZW4oZGF0YVsiam9icyJdKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBIaeG7g24gdGjhu4sgdGjDtG5nIGLDoW8gdOG7lW5nIGjhu6NwIGhv4bq3YyB0aMO0bmcgYsOhbyB04burIHNlcnZlcgogICAgICAgICAgICBpZiAibWVzc2FnZSIgaW4gdGFza19kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUaMO0bmcgYsOhbyB04burIHNlcnZlcjoge3Rhc2tfZGF0YVsnbWVzc2FnZSddfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEhp4buDbiB0aOG7iyB0aMO0bmcgYsOhbyB04buVbmcgaOG7o3AgbuG6v3Uga2jDtG5nIGPDsyBtZXNzYWdlIHThu6sgc2VydmVyCiAgICAgICAgICAgICAgICBpZiBhY2NvdW50X2NvdW50ID4gMCBvciBqb2JfY291bnQgPiAwOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDEkeG7k25nIGLhu5kgdGjDoG5oIGPDtG5nOiB7YWNjb3VudF9jb3VudH0gdMOgaSBraG/huqNuLCB7am9iX2NvdW50fSBqb2IiKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB44butIGzDvSBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5k6IHtzdHIoZSl9IikKICAgICAgICAgICAgCiAgICAKICAgIGRlZiBfaGFuZGxlX2FjY291bnRfdXBkYXRlKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayBj4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX2RhdGE6IEThu68gbGnhu4d1IHRhc2sgdOG7qyBzZXJ2ZXIgY8OzIGPhuqV1IHRyw7pjOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAidGFza19pZCI6ICJ0YXNrXzE3NDkzOTk1MzYyNzJfNjQxIiwKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiAiYTEyNWY2MjRmNDFhNGY3YyIsCiAgICAgICAgICAgICAgICAidGFza190eXBlIjogImFjY291bnRfdXBkYXRlIiwKICAgICAgICAgICAgICAgICJkYXRhIjogewogICAgICAgICAgICAgICAgICAgICJhcHAiOiAiaW5zdGFncmFtIiwKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogImluYWN0aXZlIiwKCiAgICAgICAgICAgICAgICAgICAgImpvYl90b2RheSI6IDMwLAogICAgICAgICAgICAgICAgICAgICJqb2JfZW5hYmxlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAiYWNjb3VudF91dWlkIjogIjdlZDk1NTdkLTc2YTQtNDdmNy04ODUwLTdjZWVmMGM2OTBhZiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibWVzc2FnZSI6ICIiLAogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJwZW5kaW5nIgogICAgICAgICAgICB9CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXNrX2lkID0gdGFza19kYXRhLmdldCgidGFza19pZCIpCiAgICAgICAgICAgIGRldmljZV9pZCA9IHRhc2tfZGF0YS5nZXQoImRldmljZV9pZCIpCiAgICAgICAgICAgIGRhdGEgPSB0YXNrX2RhdGEuZ2V0KCJkYXRhIiwge30pCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5o4bqtbiB5w6p1IGPhuqd1IGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24gdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGRhdGEgb3IgImFjY291bnRfdXVpZCIgbm90IGluIGRhdGE6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiROG7ryBsaeG7h3UgdMOgaSBraG/huqNuIGtow7RuZyBo4bujcCBs4buHIikKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCAiROG7ryBsaeG7h3UgdMOgaSBraG/huqNuIGtow7RuZyBo4bujcCBs4buHIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdMOgaSBraG/huqNuIHThu6sgREIKICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnRfYnlfdXVpZChkYXRhWyJhY2NvdW50X3V1aWQiXSkKICAgICAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gduG7m2kgVVVJRDoge2RhdGFbJ2FjY291bnRfdXVpZCddfSIKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICB1cGRhdGVfZGF0YSA9IHt9CiAgICAgICAgICAgIHZhbGlkX2ZpZWxkcyA9IFsic3RhdHVzIiwgImpvYl9lbmFibGUiLCAiam9iX2Rpc2FibGVfdW50aWwiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlzYWJsZV9mb2xsb3ciLCAiZm9sbG93X2Rpc2FibGVfdW50aWwiLCAiZm9sbG93X3RvZGF5IiwgImZvbGxvd19pbl9zZXNzaW9uIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIm1heF9mb2xsb3dfZGF5IiwgIm1heF9mb2xsb3dfc2Vzc2lvbiIsICJpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIl0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSBzdGF0dXMgPSAiZGVsZXRlIiB0aMOsIHjDs2EgdMOgaSBraG/huqNuCiAgICAgICAgICAgIGlmIGRhdGEuZ2V0KCJzdGF0dXMiKSA9PSAiZGVsZXRlIjoKICAgICAgICAgICAgICAgIGFjY291bnRfdXVpZCA9IGRhdGFbImFjY291bnRfdXVpZCJdCiAgICAgICAgICAgICAgICBhY2NvdW50X3VzZXJuYW1lID0gYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIsICJVbmtub3duIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gecOqdSBj4bqndSB4w7NhIHTDoGkga2hv4bqjbiB7YWNjb3VudF91c2VybmFtZX0gKFVVSUQ6IHthY2NvdW50X3V1aWR9KSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgMS4gWMOzYSB04bqldCBj4bqjIGpvYiBoaXN0b3J5IGPhu6dhIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgam9iX2hpc3RvcnlfZGVsZXRlZCA9IHNlbGYuZGIuZGVsZXRlX2pvYl9oaXN0b3J5X2J5X2FjY291bnQoYWNjb3VudF91dWlkKQogICAgICAgICAgICAgICAgaWYgam9iX2hpc3RvcnlfZGVsZXRlZDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgeMOzYSBqb2IgaGlzdG9yeSBj4bunYSB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdGjhu4MgeMOzYSBqb2IgaGlzdG9yeSBj4bunYSB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyAyLiBYw7NhIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgYWNjb3VudF9kZWxldGVkID0gc2VsZi5kYi5kZWxldGVfYWNjb3VudChhY2NvdW50WyJpZCJdKQogICAgICAgICAgICAgICAgaWYgYWNjb3VudF9kZWxldGVkOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyB4w7NhIHTDoGkga2hv4bqjbiB7YWNjb3VudF91c2VybmFtZX0gKElEOiB7YWNjb3VudFsnaWQnXX0pIGto4buPaSBkYXRhYmFzZSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBmIsSQw6MgeMOzYSB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdGjhu4MgeMOzYSB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZGF0YS5pdGVtcygpOgogICAgICAgICAgICAgICAgaWYga2V5IGluIHZhbGlkX2ZpZWxkczoKICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YVtrZXldID0gdmFsdWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHVwZGF0ZV9kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgdGjDtG5nIHRpbiBj4bqnbiBj4bqtcCBuaOG6rXQiKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsICJLaMO0bmcgY8OzIHRow7RuZyB0aW4gY+G6p24gY+G6rXAgbmjhuq10IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgbOG6oWkgdsOgbyBEQgogICAgICAgICAgICB1cGRhdGVfZGF0YVsiaXNfc3luYyJdID0gRmFsc2UKICAgICAgICAgICAgc3VjY2VzcyA9IHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnJyl9IChVVUlEOiB7ZGF0YVsnYWNjb3VudF91dWlkJ119KSB24bubaSBk4buvIGxp4buHdToge3VwZGF0ZV9kYXRhfSIpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAic3VjY2VzcyIsIGYixJDDoyBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJycpfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIktow7RuZyB0aOG7gyBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJycpfSIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIHjhu60gbMO9IGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o246IHtzdHIoZSl9IgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQoKICAgIGRlZiBfaGFuZGxlX3VwZGF0ZV9wcm94eShzZWxmLCB0YXNrX2RhdGEpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza19kYXRhOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyIGPDsyBj4bqldSB0csO6YzoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInRhc2tfaWQiOiAidGFza18xNzQ5Mzk5NTM2MjcyXzY0MSIsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogImExMjVmNjI0ZjQxYTRmN2MiLAogICAgICAgICAgICAgICAgInRhc2tfdHlwZSI6ICJ1cGRhdGVfcHJveHkiLAogICAgICAgICAgICAgICAgImRhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgInByb3h5X2NvbmZpZyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImlkIjogInByb3h5XzQ1NiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJob3N0IjogInByb3h5LmV4YW1wbGUuY29tIiwKICAgICAgICAgICAgICAgICAgICAgICAgInBvcnQiOiA4MDgwLAogICAgICAgICAgICAgICAgICAgICAgICAidXNlcm5hbWUiOiAidXNlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICJwYXNzd29yZCI6ICJwYXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiaHR0cCIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiAiIiwKICAgICAgICAgICAgICAgICJzdGF0dXMiOiAicGVuZGluZyIKICAgICAgICAgICAgfQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gecOqdSBj4bqndSBj4bqtcCBuaOG6rXQgcHJveHkgdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJveHlfY29uZmlnID0gZGF0YQogICAgICAgICAgICBpZiBub3QgcHJveHlfY29uZmlnOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gIlRoaeG6v3UgdGjDtG5nIHRpbiBwcm94eV9jb25maWcgdHJvbmcgZOG7ryBsaeG7h3UgdGFzayIKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSBj4bqldSBow6xuaCBwcm94eSB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJwcm94eV9jb25maWciLCBwcm94eV9jb25maWcpCiAgICAgICAgICAgICAgICAjIFJlc2V0IHRy4bqhbmcgdGjDoWkgecOqdSBj4bqndSBwcm94eSB2w6wgxJHDoyBuaOG6rW4gxJHGsOG7o2MgcHJveHkKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJwcm94eV9yZXF1ZXN0ZWQiLCAwKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCBwcm94eToge3Byb3h5X2NvbmZpZ1snbmFtZSddfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgR+G7rWkgYsOhbyBjw6FvIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgc3VjY2Vzc19tc2cgPSBmIsSQw6MgY+G6rXAgbmjhuq10IHByb3h5OiB7cHJveHlfY29uZmlnWyduYW1lJ119IgogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBzdWNjZXNzX21zZykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIGtoaSBsxrB1IGPhuqV1IGjDrG5oIHByb3h5OiB7c3RyKGUpfSIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIHjhu60gbMO9IGPhuq1wIG5o4bqtdCBwcm94eToge3N0cihlKX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBraOG7n2kgxJHhu5luZyB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUaGnhur90IGzhuq1wIGPDoWMgaGFuZGxlciB0csaw4bubYyBraGkga+G6v3QgbuG7kWkKICAgICAgICAgICAgc2VsZi5zZXR1cF9tcXR0X2hhbmRsZXJzKCkKICAgICAgICAgICAgc2VsZi5jb25uZWN0KCkKICAgICAgICAgICAgIyBLaOG7n2kgxJHhu5luZyBzeW5jIHRocmVhZCBzYXUga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZwogICAgICAgICAgICBzZWxmLnN0YXJ0X3N5bmNfdGhyZWFkKCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlIHbDoCDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraOG7n2kgxJHhu5luZyBNUVRUIHNlcnZpY2UiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX29uX21lc3NhZ2Uoc2VsZiwgY2xpZW50LCB1c2VyZGF0YSwgbXNnLCBwcm9wZXJ0aWVzPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIENhbGxiYWNrIGtoaSBuaOG6rW4gxJHGsOG7o2MgbWVzc2FnZSB04burIE1RVFQgYnJva2VyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY2xpZW50OiBNUVRUIGNsaWVudCBpbnN0YW5jZQogICAgICAgICAgICB1c2VyZGF0YTogVXNlciBkYXRhIMSRxrDhu6NjIHRydXnhu4FuIHbDoG8gY2xpZW50CiAgICAgICAgICAgIG1zZzogTWVzc2FnZSBvYmplY3QgY2jhu6lhIHRvcGljIHbDoCBwYXlsb2FkCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFByb3BlcnRpZXMgY+G7p2EgbWVzc2FnZSAoTVFUVCB2NSkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIk5o4bqtbiBtZXNzYWdlIHThu6sgdG9waWM6IHttc2cudG9waWN9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUGFyc2UgcGF5bG9hZCBKU09OCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBheWxvYWQgPSBqc29uLmxvYWRzKG1zZy5wYXlsb2FkLmRlY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIHBhcnNlIEpTT04gdOG7qyBwYXlsb2FkOiB7bXNnLnBheWxvYWR9IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBY4butIGzDvSBtZXNzYWdlIGThu7FhIHRyw6puIHRvcGljCiAgICAgICAgICAgIGlmIG1zZy50b3BpYyA9PSBzZWxmLnRvcGljX3NlcnZlcl90YXNrOgogICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX3NlcnZlcl90YXNrKHBheWxvYWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIk5o4bqtbiBtZXNzYWdlIHThu6sgdG9waWMga2jDtG5nIHjDoWMgxJHhu4tuaDoge21zZy50b3BpY30iKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB44butIGzDvSBtZXNzYWdlOiB7c3RyKGUpfSIpCgogICAgZGVmIF9oYW5kbGVfc2VydmVyX3Rhc2soc2VsZiwgcGF5bG9hZDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwYXlsb2FkOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXNrX3R5cGUgPSBwYXlsb2FkLmdldCgidGFza190eXBlIikKICAgICAgICAgICAgaWYgbm90IHRhc2tfdHlwZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJOaOG6rW4gdGFzayBraMO0bmcgY8OzIHRhc2tfdHlwZSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIk5o4bqtbiB0YXNrIHThu6sgc2VydmVyOiB7dGFza190eXBlfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIGhhbmRsZXIgdMawxqFuZyDhu6luZyBu4bq/dSDEkcOjIMSRxINuZyBrw70KICAgICAgICAgICAgaWYgdGFza190eXBlIGluIHNlbGYudGFza19oYW5kbGVyczoKICAgICAgICAgICAgICAgIHNlbGYudGFza19oYW5kbGVyc1t0YXNrX3R5cGVdKHBheWxvYWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSBoYW5kbGVyIGNobyB0YXNrX3R5cGU6IHt0YXNrX3R5cGV9IikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB44butIGzDvSB0YXNrIHThu6sgc2VydmVyOiB7c3RyKGUpfSIpCiAgICAKICAgIGRlZiBfbW9uaXRvcl9yYW1fdXNhZ2Uoc2VsZiwgZGV2aWNlX2luZm86IERpY3Rbc3RyLCBBbnldKToKICAgICAgICAiIiIKICAgICAgICBUaGVvIGTDtWkgUkFNIHbDoCB04buxIMSR4buZbmcgcmVib290IG7hur91IFJBTSBjYW8gbGnDqm4gdOG7pWMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBkZXZpY2VfaW5mbzogVGjDtG5nIHRpbiB0aGnhur90IGLhu4sgY2jhu6lhIFJBTSB1c2FnZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUw61uaCBwaOG6p24gdHLEg20gUkFNIHPhu60gZOG7pW5nIHThu6sgcmFtX3RvdGFsIHbDoCByYW1fdXNlZAogICAgICAgICAgICByYW1fdG90YWwgPSBkZXZpY2VfaW5mby5nZXQoInJhbV90b3RhbCIsIDApCiAgICAgICAgICAgIHJhbV91c2VkID0gZGV2aWNlX2luZm8uZ2V0KCJyYW1fdXNlZCIsIDApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByYW1fdG90YWwgPiAwIGFuZCByYW1fdXNlZCA+PSAwOgogICAgICAgICAgICAgICAgcmFtX3VzYWdlX3BlcmNlbnQgPSAocmFtX3VzZWQgLyByYW1fdG90YWwpICogMTAwCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJUw61uaCB0b8OhbiBSQU06IHtyYW1fdXNlZH1NQi97cmFtX3RvdGFsfU1CID0ge3JhbV91c2FnZV9wZXJjZW50Oi4xZn0lIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRmFsbGJhY2s6IHRo4butIGzhuqV5IHRy4buxYyB0aeG6v3AgdOG7qyBkZXZpY2VfaW5mbwogICAgICAgICAgICAgICAgcmFtX3VzYWdlX3BlcmNlbnQgPSBkZXZpY2VfaW5mby5nZXQoInJhbV9wZXJjZW50YWdlIiwgMCkKICAgICAgICAgICAgICAgIGlmIHJhbV91c2FnZV9wZXJjZW50ID09IDA6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJLaMO0bmcgY8OzIHRow7RuZyB0aW4gUkFNIGjhu6NwIGzhu4csIHPhu60gZOG7pW5nIGdpw6EgdHLhu4sgbeG6t2MgxJHhu4tuaCAwIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlPhu60gZOG7pW5nIHJhbV9wZXJjZW50YWdlIHRy4buxYyB0aeG6v3A6IHtyYW1fdXNhZ2VfcGVyY2VudDouMWZ9JSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSB2w6BvIGzhu4tjaCBz4butIChjaOG7iSBnaeG7ryBs4bqhaSAzIGzhuqduIGfhuqduIG5o4bqldCkKICAgICAgICAgICAgc2VsZi5yYW1fdXNhZ2VfaGlzdG9yeS5hcHBlbmQocmFtX3VzYWdlX3BlcmNlbnQpCiAgICAgICAgICAgIGlmIGxlbihzZWxmLnJhbV91c2FnZV9oaXN0b3J5KSA+IHNlbGYuY29uc2VjdXRpdmVfaGlnaF9yYW1fbGltaXQ6CiAgICAgICAgICAgICAgICBzZWxmLnJhbV91c2FnZV9oaXN0b3J5LnBvcCgwKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiUkFNIGhp4buHbiB04bqhaToge3JhbV91c2FnZV9wZXJjZW50Oi4xZn0lIChs4buLY2ggc+G7rToge1tmJ3t4Oi4xZn0lJyBmb3IgeCBpbiBzZWxmLnJhbV91c2FnZV9oaXN0b3J5XX0pIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSBjw7MgxJHhu6cgMyBs4bqnbiDEkW8gdsOgIHThuqV0IGPhuqMgxJHhu4F1ID4gbmfGsOG7oW5nCiAgICAgICAgICAgIGlmIGxlbihzZWxmLnJhbV91c2FnZV9oaXN0b3J5KSA+PSBzZWxmLmNvbnNlY3V0aXZlX2hpZ2hfcmFtX2xpbWl0OgogICAgICAgICAgICAgICAgaWYgYWxsKHVzYWdlID4gc2VsZi5oaWdoX3JhbV90aHJlc2hvbGQgZm9yIHVzYWdlIGluIHNlbGYucmFtX3VzYWdlX2hpc3RvcnkpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiUkFNIGNhbyBsacOqbiB04bulYyB7c2VsZi5jb25zZWN1dGl2ZV9oaWdoX3JhbV9saW1pdH0gbOG6p24gKD57c2VsZi5oaWdoX3JhbV90aHJlc2hvbGR9JSk6IHtbZid7eDouMWZ9JScgZm9yIHggaW4gc2VsZi5yYW1fdXNhZ2VfaGlzdG9yeV19IikKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQuG6r3QgxJHhuqd1IHJlYm9vdCB0aGnhur90IGLhu4sgxJHhu4MgZ2nhuqNpIHBow7NuZyBSQU0uLi4iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiByZWJvb3QKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLl9yZWJvb3RfZGV2aWNlKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGfhu61pIGzhu4duaCByZWJvb3QgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgICAgICAgICAgIyBSZXNldCBs4buLY2ggc+G7rSBzYXUga2hpIHJlYm9vdAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJhbV91c2FnZV9oaXN0b3J5LmNsZWFyKCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB0aOG7sWMgaGnhu4duIHJlYm9vdCB0aGnhur90IGLhu4siKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB0aGVvIGTDtWkgUkFNOiB7ZX0iKQogICAgCiAgICBkZWYgX3JlYm9vdF9kZXZpY2Uoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIHJlYm9vdCB0aGnhur90IGLhu4sgcXVhIEFEQgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgU+G7rSBk4bulbmcgREVWSUNFX0lQIHThu6sgY29uZmlnIHRoYXkgdsOsIEFEQl9IT1NUCiAgICAgICAgICAgIGRldmljZV9hZGRyZXNzID0gZiJ7Y29uZmlnLkRFVklDRV9JUH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhu4duaCByZWJvb3QgcXVhIEFEQgogICAgICAgICAgICBjbWQgPSBbImFkYiIsICItcyIsIGRldmljZV9hZGRyZXNzLCAicmVib290Il0KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVGjhu7FjIGhp4buHbiByZWJvb3QgdGhp4bq/dCBi4buLOiB7JyAnLmpvaW4oY21kKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB0ZXh0PVRydWUsCiAgICAgICAgICAgICAgICB0aW1lb3V0PTEwICAjIFRpbWVvdXQgMTAgZ2nDonkKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJM4buHbmggcmVib290IMSRw6MgxJHGsOG7o2MgZ+G7rWkgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuVGltZW91dEV4cGlyZWQ6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJUaW1lb3V0IGtoaSBn4butaSBs4buHbmggcmVib290ICh0aGnhur90IGLhu4sgY8OzIHRo4buDIMSRYW5nIHJlYm9vdCkiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBDb2kgbmjGsCB0aMOgbmggY8O0bmcgdsOsIGPDsyB0aOG7gyB0aGnhur90IGLhu4sgxJFhbmcgcmVib290CiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIHJlYm9vdDoge2Uuc3RkZXJyfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgbOG7h25oIGFkYiwga2jDtG5nIHRo4buDIHJlYm9vdCB0aGnhur90IGLhu4siKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtow7RuZyB4w6FjIMSR4buLbmgga2hpIHJlYm9vdCB0aGnhur90IGLhu4s6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ==').decode('utf-8'))
