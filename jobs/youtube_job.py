import base64
exec(base64.b64decode('aW1wb3J0IGRhdGV0aW1lCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IHJlCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIExpc3QsIE9wdGlvbmFsCmZyb20gam9icy5qb2JfYmFzZSBpbXBvcnQgQmFzZUpvYgoKY2xhc3MgWW91dHViZUpvYihCYXNlSm9iKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9zZXJ2aWNlLCBoZWxwZXJfc2VydmljZSwgZ29saWtlX3NlcnZpY2U9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhkYl9zZXJ2aWNlLCBoZWxwZXJfc2VydmljZSwgZ29saWtlX3NlcnZpY2UpCiAgICAgICAgc2VsZi5hcHBfcGFja2FnZSA9ICJjb20uZ29vZ2xlLmFuZHJvaWQueW91dHViZSIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gInlvdXR1YmUiCiAgICAgICAgCiAgICAgICAgIyBPdmVycmlkZSBkZWZhdWx0IGNvbmZpZyBjaG8gWW91VHViZQogICAgICAgIHNlbGYuX2RlZmF1bHRfY29uZmlnLnVwZGF0ZSh7CiAgICAgICAgICAgICJhY3Rpb25fd2VpZ2h0cyI6IHsKICAgICAgICAgICAgICAgICJyYW5kb21fdmlld192aWRlb19jaGFuZWwiOiAxMDAsICAjIDEwMCUgeGVtIHZpZGVvL2NoYW5uZWwgcmFuZG9tCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJtaW5fYWN0aW9uc19wZXJfc2Vzc2lvbiI6IDMsCiAgICAgICAgICAgICJtYXhfYWN0aW9uc19wZXJfc2Vzc2lvbiI6IDUwLCAgIyBZb3VUdWJlIGPDsyB0aOG7gyBjw7Mgbmhp4buBdSBhY3Rpb25zIGjGoW4gKDUwIHRoYXkgdsOsIDMwKQogICAgICAgICAgICAibWF4X3Nlc3Npb25fZHVyYXRpb25fbWludXRlcyI6IDE1LAogICAgICAgICAgICAiYWN0aW9uX2RlbGF5X21pbiI6IDUsCiAgICAgICAgICAgICJhY3Rpb25fZGVsYXlfbWF4IjogMTUsCiAgICAgICAgICAgICJrZXlfc2VhcmNoX2lkIjogImRzakVFTXBaay1RLGp1Z0k2VXJVLWZJLGtwUmlFcHE3YXdnLDMzM2Nsa2R6S0JNLHdPUnNhemhJRzM0LGxnWDVROVNQRThFLGN4ZFU2YklrVi1nLDM1dEc2SUZpQk9jLFg3MEVNN041ZEpZLF8xQmw4UDdURVk0LE5GSmx5RUxxZDF3LFBBOWZXV2JIWHRzLEc1by1oRlhwTzFZLDV3ZW45aERjSTRZIiwKICAgICAgICAgICAgIm5hbWVfY2hhbm5lbCI6ICJExaluZyBCw6lvIE9mZmljaWFsIiwKICAgICAgICAgICAgImFkX3dhdGNoX3RpbWVfbWluIjogMTAsICAgICAgIyBUaOG7nWkgZ2lhbiB4ZW0gcXXhuqNuZyBjw6FvIHThu5FpIHRoaeG7g3UgKGdpw6J5KQogICAgICAgICAgICAiYWRfd2F0Y2hfdGltZV9tYXgiOiAzMCwgICAgICMgVGjhu51pIGdpYW4geGVtIHF14bqjbmcgY8OhbyB04buRaSDEkWEgKGdpw6J5KQogICAgICAgICAgICAidmlkZW9fd2F0Y2hfdGltZV9taW4iOiAxMDAsICAjIFRo4budaSBnaWFuIHhlbSB2aWRlbyB04buRaSB0aGnhu4N1IChnacOieSkKICAgICAgICAgICAgInZpZGVvX3dhdGNoX3RpbWVfbWF4IjogMTgwLCAgIyBUaOG7nWkgZ2lhbiB4ZW0gdmlkZW8gdOG7kWkgxJFhIChnacOieSkKICAgICAgICAgICAgInZpZGVvX3Jld2F0Y2hfY29vbGRvd25fbWludXRlcyI6IDMwMCAgIyBUaOG7nWkgZ2lhbiBnacOjbiBjw6FjaCB0csaw4bubYyBraGkgeGVtIGzhuqFpIHZpZGVvIChwaMO6dCkKICAgICAgICB9KQogICAgCiAgICBkZWYgZHVtcF9zY3JlZW4oc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgRmFsbGJhY2sgbWV0aG9kIMSR4buDIHTGsMahbmcgdGjDrWNoIHbhu5tpIGPDoWMgbWV0aG9kIGPDsyB0aOG7gyBn4buNaSBkdW1wX3NjcmVlbigpCiAgICAgICAgdGhheSB2w6wgZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgIAogICAgZGVmIGdldF9zdXBwb3J0ZWRfYWN0aW9ucyhzZWxmKSAtPiBMaXN0W3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgT3ZlcnJpZGUgZGFuaCBzw6FjaCBhY3Rpb25zIMSRxrDhu6NjIFlvdVR1YmUgaOG7lyB0cuG7owogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3Rbc3RyXTogRGFuaCBzw6FjaCBhY3Rpb25zIFlvdVR1YmUgaOG7lyB0cuG7owogICAgICAgICIiIgogICAgICAgIHJldHVybiBsaXN0KHNlbGYuZ2V0X2FjdGlvbl93ZWlnaHRzKCkua2V5cygpKQogICAgICAgIAogICAgZGVmIGdldF9hY2NvdW50c19mcm9tX2RldmljZShzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBZb3VUdWJlIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgWW91VHViZSBsdcO0biByZXR1cm4gMSBhY2NvdW50IHbhu5tpIHVuaXF1ZV91c2VybmFtZSA9ICJuby5hY2NvdW50IgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gWW91VHViZSB04burIHRoaeG6v3QgYuG7iyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFlvdVR1YmUgY2jhu4kgY8OzIDEgYWNjb3VudCBt4bq3YyDEkeG7i25oCiAgICAgICAgICAgIGFjY291bnRzID0gW3sKICAgICAgICAgICAgICAgICJ1bmlxdWVfdXNlcm5hbWUiOiAibm8uYWNjb3VudCIsCiAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogIm5vLmFjY291bnQiLCAKICAgICAgICAgICAgICAgICJuaWNrbmFtZSI6ICJZb3VUdWJlIEFjY291bnQiLAogICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6ICIiLAogICAgICAgICAgICAgICAgImlzX2xvZ2luIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfV0KICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB7bGVuKGFjY291bnRzKX0gdMOgaSBraG/huqNuIFlvdVR1YmUiKQogICAgICAgICAgICByZXR1cm4gYWNjb3VudHMKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBZb3VUdWJlIikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoc2VsZikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB1c2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcAogICAgICAgIFlvdVR1YmUgbHXDtG4gcmV0dXJuICJuby5hY2NvdW50IgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogIm5vLmFjY291bnQiCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuICJuby5hY2NvdW50IgogICAgCiAgICBkZWYgX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2goc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGNodXnhu4NuIHTDoGkga2hv4bqjbgogICAgICAgIFlvdVR1YmUga2jDtG5nIGPhuqduIGNodXnhu4NuIHTDoGkga2hv4bqjbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhcmdldF9hY2NvdW50OiBUw6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24gxJHhur9uCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyBjaHV54buDbiB0w6BpIGtob+G6o24KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAnc3VjY2Vzcyc6IFRydWUsCiAgICAgICAgICAgICdtZXNzYWdlJzogJ1lvdVR1YmUga2jDtG5nIGPhuqduIGNodXnhu4NuIHTDoGkga2hv4bqjbicKICAgICAgICB9CiAgICAKICAgIGRlZiBvcGVuX2FwcChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIE3hu58g4bupbmcgZOG7pW5nIFlvdVR1YmUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiTeG7nyDhu6luZyBk4bulbmcgWW91VHViZSIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBt4bufIFlvdVR1YmU6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgaXNfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcg4bufIG3DoG4gaMOsbmggaG9tZSBZb3VUdWJlIGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJFhbmcg4bufIGhvbWUgc2NyZWVuCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJyZW50X3BhY2thZ2UgPSBzZWxmLmhlbHBlci5nZXRfY3VycmVudF9wYWNrYWdlKCkKICAgICAgICAgICAgaWYgY3VycmVudF9wYWNrYWdlICE9IHNlbGYuYXBwX3BhY2thZ2U6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw7MgY8OhYyBlbGVtZW50IMSR4bq3YyB0csawbmcgY+G7p2EgWW91VHViZSBob21lCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCLEkGFuZyBn4buNaSBoZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkgdHJvbmcgaXNfaG9tZV9zY3JlZW4uLi4iKQogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBjw6FjIGluZGljYXRvciBj4bunYSBZb3VUdWJlIGhvbWUKICAgICAgICAgICAgaG9tZV9pbmRpY2F0b3JzID0gWwogICAgICAgICAgICAgICAgJ2NvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL3lvdXR1YmVfbG9nbycsCiAgICAgICAgICAgICAgICAnVHJhbmcgY2jhu6cnLAogICAgICAgICAgICAgICAgJ1Nob3J0cycKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGluZGljYXRvciBpbiBob21lX2luZGljYXRvcnM6CiAgICAgICAgICAgICAgICBpZiBpbmRpY2F0b3IgaW4gc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraeG7g20gdHJhIGhvbWUgc2NyZWVuOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGdldF9jdXJyZW50X3NjcmVlbihzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgUGjDoXQgaGnhu4duIG3DoG4gaMOsbmggaGnhu4duIHThuqFpIGPhu6dhIFlvdVR1YmUKICAgICAgICDEkOG6o20gYuG6o28gWW91VHViZSDEkWFuZyBt4bufIHRyxrDhu5tjIGtoaSBwaMOhdCBoaeG7h24gc2NyZWVuCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBMb+G6oWkgbcOgbiBow6xuaCBoaeG7h24gdOG6oWkgKCdob21lJywgJ2hvbWVfc2VhcmNoJywgJ3ZpZXdfdmlkZW8nLCAndW5rbm93bicpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBZb3VUdWJlIMSRYW5nIG3hu58KICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIllvdVR1YmUgY2jGsGEgbeG7nyAocGFja2FnZSBoaeG7h24gdOG6oWk6IHtjdXJyZW50X3BhY2thZ2V9KSwgxJFhbmcgbeG7nyBZb3VUdWJlLi4uIikKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLm9wZW5fYXBwKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBt4bufIFlvdVR1YmUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAidW5rbm93biIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkOG7o2kgYXBwIGxvYWQKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgcGFja2FnZQogICAgICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3BhY2thZ2UgIT0gc2VsZi5hcHBfcGFja2FnZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlbhuqtuIGtow7RuZyBwaOG6o2kgWW91VHViZSBhcHA6IHtjdXJyZW50X3BhY2thZ2V9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInVua25vd24iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IFhNTCBj4bunYSBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygixJBhbmcgZ+G7jWkgaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpLi4uIikKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHNjcmVlbiBYTUwiKQogICAgICAgICAgICAgICAgcmV0dXJuICJ1bmtub3duIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHZpZXdfdmlkZW8gc2NyZWVuIHRyxrDhu5tjICjGsHUgdGnDqm4gY2FvIG5o4bqldCkKICAgICAgICAgICAgaWYgImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL3dhdGNoX3BsYXllciIgaW4gc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHJldHVybiAidmlld192aWRlbyIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBob21lX3NlYXJjaCBzY3JlZW4KICAgICAgICAgICAgc2VhcmNoX2luZGljYXRvcnMgPSBbCiAgICAgICAgICAgICAgICAiVGjhu60gdMOsbSBraeG6v20gxJHhu4MgYuG6r3QgxJHhuqd1IiwKICAgICAgICAgICAgICAgICJUw6xtIHRyw6puIFlvdVR1YmUiCiAgICAgICAgICAgIF0KICAgICAgICAgICAgZm9yIGluZGljYXRvciBpbiBzZWFyY2hfaW5kaWNhdG9yczoKICAgICAgICAgICAgICAgIGlmIGluZGljYXRvciBpbiBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiaG9tZV9zZWFyY2giCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgaG9tZSBzY3JlZW4gKGvhur8gdGjhu6thIGxvZ2ljIHThu6sgaXNfaG9tZV9zY3JlZW4pCiAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiAiaG9tZSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2jDtG5nIHjDoWMgxJHhu4tuaCDEkcaw4bujYwogICAgICAgICAgICByZXR1cm4gInVua25vd24iCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBwaMOhdCBoaeG7h24gY3VycmVudCBzY3JlZW46IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAidW5rbm93biIKICAgIAogICAgZGVmIGVuc3VyZV9ob21lX3NjcmVlbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gbcOgbiBow6xuaCBob21lIFlvdVR1YmUKICAgICAgICBL4bq/dCBo4bujcCBnaeG7r2EgbsO6dCBiYWNrIHbDoCBi4bqlbSB2w6BvIFRyYW5nIGNo4bunL0hvbWUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZyB24buBIGhvbWUgc2NyZWVuCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIE7hur91IMSRw6Mg4bufIGhvbWUgdGjDrCBPSwogICAgICAgICAgICBzZWxmLl9oYW5kbGVfY2xvc2VfcG9wdXBzKCkKICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkGFuZyBj4buRIGfhuq9uZyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cgWW91VHViZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIDE6IFTDrG0gdsOgIGLhuqVtIG7DunQgIlRyYW5nIGNo4bunIiBob+G6t2MgIkhvbWUiIHRyxrDhu5tjCiAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IlRyYW5nIGNo4bunIikKICAgICAgICAgICAgaWYgbm90IGhvbWVfdGFiOgogICAgICAgICAgICAgICAgaG9tZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iSG9tZSIpCiAgICAgICAgICAgIGlmIG5vdCBob21lX3RhYjoKICAgICAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciKQogICAgICAgICAgICBpZiBub3QgaG9tZV90YWI6CiAgICAgICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IkhvbWUiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGhvbWVfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgbsO6dCBUcmFuZyBjaOG7py9Ib21lLCDEkWFuZyBi4bqlbS4uLiIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaG9tZV90YWIpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7rSAyOiBC4bqlbSBiYWNrIDEtMiBs4bqnbiBy4buTaSB0w6xtIEhvbWUgYnV0dG9uCiAgICAgICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKDIpOgogICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX2Nsb3NlX3BvcHVwcygpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVGjhu60gYuG6pW0gYmFjayBs4bqnbiB7YXR0ZW1wdCArIDF9IikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSDEkcOjIHbhu4EgaG9tZSBjaMawYQogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBIb21lIGJ1dHRvbiBzYXUga2hpIGJhY2sKICAgICAgICAgICAgICAgIGhvbWVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IlRyYW5nIGNo4bunIikKICAgICAgICAgICAgICAgIGlmIG5vdCBob21lX3RhYjoKICAgICAgICAgICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJIb21lIikKICAgICAgICAgICAgICAgIGlmIG5vdCBob21lX3RhYjoKICAgICAgICAgICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIikKICAgICAgICAgICAgICAgIGlmIG5vdCBob21lX3RhYjoKICAgICAgICAgICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IkhvbWUiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgaG9tZV90YWI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgbsO6dCBUcmFuZyBjaOG7py9Ib21lIHNhdSBiYWNrLCDEkWFuZyBi4bqlbS4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfdGFiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu60gMzogQmFjayBuaGnhu4F1IGzhuqduIGjGoW4gbuG6v3UgduG6q24gY2jGsGEgduG7gSDEkcaw4bujYwogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUaOG7rSBiYWNrIG5oaeG7gXUgbOG6p24gxJHhu4MgduG7gSBob21lIikKICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UoMyk6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIDQ6IEN14buRaSBjw7luZyBt4bufIGzhuqFpIGFwcAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJN4bufIGzhuqFpIOG7qW5nIGThu6VuZyBZb3VUdWJlIikKICAgICAgICAgICAgc2VsZi5vcGVuX2FwcCgpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICByZXR1cm4gc2VsZi5pc19ob21lX3NjcmVlbigpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBlbnN1cmUgaG9tZSBzY3JlZW46IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdmFsaWRhdGVfYXBwX25vdF9iYW5uZWQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIGFwcCBjw7MgYuG7iyBiYW5uZWQga2jDtG5nCiAgICAgICAgWW91VHViZSDDrXQga2hpIGLhu4sgYmFuIG7Dqm4gbHXDtG4gcmV0dXJuIFRydWUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGtow7RuZyBi4buLIGJhbm5lZAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgQXBwIGNoxrBhIG3hu58KICAgICAgICAgICAgCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OhYyBk4bqldSBoaeG7h3UgYuG7iyBiYW4gKG7hur91IGPDsykKICAgICAgICAgICAgYmFuX2luZGljYXRvcnMgPSBbCiAgICAgICAgICAgICAgICAiQWNjb3VudCBzdXNwZW5kZWQiLAogICAgICAgICAgICAgICAgIlRoaXMgYWNjb3VudCBoYXMgYmVlbiB0ZXJtaW5hdGVkIiwKICAgICAgICAgICAgICAgICJDb21tdW5pdHkgR3VpZGVsaW5lcyB2aW9sYXRpb24iCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBpbmRpY2F0b3IgaW4gYmFuX2luZGljYXRvcnM6CiAgICAgICAgICAgICAgICBpZiBpbmRpY2F0b3IubG93ZXIoKSBpbiBzY3JlZW5feG1sLmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIlBow6F0IGhp4buHbiBhcHAgYuG7iyBiYW46IHtpbmRpY2F0b3J9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraeG7g20gdHJhIGFwcCBiYW5uZWQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlICAjIERlZmF1bHQga2jDtG5nIGLhu4sgYmFuCiAgICAKICAgIGRlZiBwZXJmb3JtX3JhbmRvbV92aWV3X3ZpZGVvX2NoYW5lbF9hY3Rpb24oc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBow6BuaCDEkeG7mW5nIHhlbSB2aWRlby9jaGFubmVsIG5n4bqrdSBuaGnDqm4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlRo4buxYyBoaeG7h24gcmFuZG9tIHZpZXcgdmlkZW8vY2hhbm5lbCBjaG8ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0iKQogICAgICAgICAgICBzZWxmLl9oYW5kbGVfY2xvc2VfcG9wdXBzKCkKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgICAgIGN1cnJlbnRfc2NyZWVuID0gc2VsZi5nZXRfY3VycmVudF9zY3JlZW4oKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQ3VycmVudCBzY3JlZW46IHtjdXJyZW50X3NjcmVlbn0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBY4butIGzDvSB0aGVvIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfc2NyZWVuID09ICJ2aWV3X3ZpZGVvIjoKICAgICAgICAgICAgICAgICMgxJDDoyDEkWFuZyB4ZW0gdmlkZW8sIGPDsyB0aOG7gyB0aeG6v3AgdOG7pWMgeGVtIGhv4bq3YyB0aG/DoXQKICAgICAgICAgICAgICAgICMgxJBhbmcgeGVtIHZpZGVvLCBjw7MgdGjhu4MgdMOsbSB2w6AgYuG6pW0gdsOgbyBwbGF5bGlzdCBlbnRyeSBwb2ludAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJBhbmcgeGVtIHZpZGVvLCB0w6xtIHBsYXlsaXN0IGVudHJ5IHBvaW50IikKICAgICAgICAgICAgICAgIHBsYXlsaXN0X2VudHJ5ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uZ29vZ2xlLmFuZHJvaWQueW91dHViZTppZC9wbGF5bGlzdF9lbnRyeV9wb2ludF9jb250YWluZXIiKQogICAgICAgICAgICAgICAgaWYgcGxheWxpc3RfZW50cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgcGxheWxpc3QgZW50cnkgcG9pbnQsIMSRYW5nIGLhuqVtLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocGxheWxpc3RfZW50cnkpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBwbGF5bGlzdCBlbnRyeSBwb2ludCwgVGjhu60gdnXhu5F0IMSR4buBIHh14bqldCIpCgogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX2dldF9maXJzdF92aWRlb190b192aWV3KCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHZpZGVvIG7DoG8gxJHhu4MgeGVtIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpCgogICAgICAgICAgICBlbGlmIGN1cnJlbnRfc2NyZWVuID09ICJob21lX3NlYXJjaCI6CiAgICAgICAgICAgICAgICAjIMSQYW5nIOG7nyBtw6BuIGjDrG5oIHNlYXJjaCwgY8OzIHRo4buDIHTDrG0ga2nhur9tIGhv4bq3YyB24buBIGhvbWUKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQYW5nIOG7nyBtw6BuIGjDrG5oIHNlYXJjaCIpCiAgICAgICAgICAgICAgICBzZWxmLl9wZXJmb3JtX3NlYXJjaF9mcm9tX3NlYXJjaF9zY3JlZW4oKQogICAgICAgICAgICBlbGlmIGN1cnJlbnRfc2NyZWVuID09ICJob21lIjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQYW5nIOG7nyBtw6BuIGjDrG5oIGhvbWUiKQogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX2dldF9maXJzdF92aWRlb190b192aWV3KCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHZpZGVvIG7DoG8gxJHhu4MgeGVtIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICBzZWxmLl9wZXJmb3JtX3NlYXJjaF9mcm9tX3NlYXJjaF9zY3JlZW4oKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIHRo4buxYyBoaeG7h24gcmFuZG9tIHZpZXc6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX3BlcmZvcm1fc2VhcmNoX2Zyb21fc2VhcmNoX3NjcmVlbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gdMOsbSBraeG6v20ga2hpIMSRYW5nIOG7nyBtw6BuIGjDrG5oIHNlYXJjaAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUaOG7sWMgaGnhu4duIHNlYXJjaCB04burIG3DoG4gaMOsbmggc2VhcmNoIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgc2VhcmNoIHRlcm1zIHThu6sgY29uZmlnCiAgICAgICAgICAgIGNvbmZpZyA9IHNlbGYuZ2V0X2FwcF9jb25maWcoKQogICAgICAgICAgICBrZXlfc2VhcmNoX2lkID0gY29uZmlnLmdldCgia2V5X3NlYXJjaF9pZCIsICIiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYga2V5X3NlYXJjaF9pZDoKICAgICAgICAgICAgICAgICMgU3BsaXQgYuG6sW5nIGThuqV1IHBo4bqpeSB2w6AgbOG6pXkgcmFuZG9tCiAgICAgICAgICAgICAgICBzZWFyY2hfaWRzID0gW3Muc3RyaXAoKSBmb3IgcyBpbiBrZXlfc2VhcmNoX2lkLnNwbGl0KCIsIikgaWYgcy5zdHJpcCgpXQogICAgICAgICAgICAgICAgaWYgc2VhcmNoX2lkczoKICAgICAgICAgICAgICAgICAgICB0ZXJtID0gcmFuZG9tLmNob2ljZShzZWFyY2hfaWRzKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIG7hur91IGNvbmZpZyBy4buXbmcKICAgICAgICAgICAgICAgICAgICB0ZXJtID0gcmFuZG9tLmNob2ljZShbIm11c2ljIiwgInR1dG9yaWFsIiwgImdhbWluZyJdKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBGYWxsYmFjayBu4bq/dSBraMO0bmcgY8OzIGNvbmZpZwogICAgICAgICAgICAgICAgdGVybSA9IHJhbmRvbS5jaG9pY2UoWyJtdXNpYyIsICJ0dXRvcmlhbCIsICJnYW1pbmciXSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJTZWFyY2ggdGVybToge3Rlcm19IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBzZWFyY2ggYm94IHbhu5tpIG5oaeG7gXUgdmFyaWFudHMKICAgICAgICAgICAgc2VhcmNoX2JveCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0ic2VhcmNoX2VkaXRfdGV4dCIpCiAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfYm94OgogICAgICAgICAgICAgICAgc2VhcmNoX2JveCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlTDrG0ga2nhur9tIikKICAgICAgICAgICAgaWYgbm90IHNlYXJjaF9ib3g6CiAgICAgICAgICAgICAgICBzZWFyY2hfYm94ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IlTDrG0gdHLDqm4gWW91VHViZSIpCiAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfYm94OgogICAgICAgICAgICAgICAgc2VhcmNoX2JveCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmdvb2dsZS5hbmRyb2lkLnlvdXR1YmU6aWQvc2VhcmNoX2NsZWFyIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNlYXJjaF9ib3g6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX2JveCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5o4bqtcCBzZWFyY2ggdGVybQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuaW5wdXRfdGV4dCh0ZXJtKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmjhuqVuIHNlYXJjaAogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfZW50ZXIoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgeGVtIHZpZGVvIMSR4bqndSB0acOqbiBj4bunYSBrw6puaCDEkcOjIGNvbmZpZwogICAgICAgICAgICAgICAgdmlkZW9fZm91bmQgPSBzZWxmLl9nZXRfZmlyc3RfdmlkZW9fdG9fdmlldygpCiAgICAgICAgICAgICAgICBpZiB2aWRlb19mb3VuZDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSB2aWRlbyBj4bunYSBrw6puaCwgc2Nyb2xsIGvhur90IHF14bqjIHNlYXJjaAogICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UoMik6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFF1YXkgbOG6oWkgaG9tZQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBzZWFyY2ggYm94IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIHNlYXJjaCB04burIHNlYXJjaCBzY3JlZW46IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2dldF9maXJzdF92aWRlb190b192aWV3KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB2w6AgeGVtIHZpZGVvIMSR4bqndSB0acOqbiBj4bunYSBrw6puaCDEkcOjIGNvbmZpZyB0cm9uZyBr4bq/dCBxdeG6oyBzZWFyY2gKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHTDrG0gdGjhuqV5IHbDoCB4ZW0gdmlkZW8gdGjDoG5oIGPDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IHTDqm4ga8OqbmggdOG7qyBjb25maWcKICAgICAgICAgICAgY29uZmlnID0gc2VsZi5nZXRfYXBwX2NvbmZpZygpCiAgICAgICAgICAgIHRhcmdldF9jaGFubmVsID0gY29uZmlnLmdldCgibmFtZV9jaGFubmVsIiwgIkTFqW5nIELDqW8gT2ZmaWNpYWwiKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdmlkZW8gY+G7p2Ega8Oqbmg6IHt0YXJnZXRfY2hhbm5lbH0iKQogICAgICAgICAgICBtYXhfc2Nyb2xscyA9IDE1ICAjIEdp4bubaSBo4bqhbiBz4buRIGzhuqduIHNjcm9sbAogICAgICAgICAgICBmb3Igc2Nyb2xsX2NvdW50IGluIHJhbmdlKG1heF9zY3JvbGxzKToKICAgICAgICAgICAgICAgICMgTOG6pXkgWE1MIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyBlcXVhbGl6ZXIgdGjDrCB2deG7kXQgbMOqbgogICAgICAgICAgICAgICAgZXF1YWxpemVyX2VsZW1lbnQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL2VxdWFsaXplciIpCiAgICAgICAgICAgICAgICBpZiBlcXVhbGl6ZXJfZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIHRo4bqleSBlcXVhbGl6ZXIsIMSRYW5nIHZ14buRdCBsw6puLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICB2aWRlb19idXR0b25zID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50cyhyZXNvdXJjZV9pZD0iY29tLmdvb2dsZS5hbmRyb2lkLnlvdXR1YmU6aWQvY2hhbm5lbCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCB2aWRlb19idXR0b25zOgogICAgICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIHZpZGVvIGJ1dHRvbnMgY8OzIHRow7RuZyB0aW4ga8OqbmggIAogICAgICAgICAgICAgICAgICAgIHZpZGVvX2J1dHRvbnMgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRzKAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGZvciBidXR0b24gaW4gdmlkZW9fYnV0dG9uczoKICAgICAgICAgICAgICAgICAgICBidXR0b25fZGVzYyA9IGJ1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBidXR0b25fZGVzYyBvciBidXR0b25fZGVzYyA9PSAibnVsbCI6ICAjIEZhbGxiYWNrIG7hur91IGNvbnRlbnQtZGVzYyBy4buXbmcKICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uX2Rlc2MgPSBidXR0b24uZ2V0KCJ0ZXh0IiwgIiIpCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGNvbnRlbnQtZGVzYyBjaOG7qWEgdMOqbiBrw6puaCB0YXJnZXQKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0X2NoYW5uZWwgaW4gYnV0dG9uX2Rlc2MgYW5kICJwaMOhdCB2aWRlbyIgaW4gYnV0dG9uX2Rlc2MpIG9yIHRhcmdldF9jaGFubmVsID09IGJ1dHRvbl9kZXNjOgogICAgICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IHZpZGVvIHRpdGxlIMSR4buDIGtp4buDbSB0cmEgbOG7i2NoIHPhu60KICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSB0w6xtIHRpdGxlIHThu6sgcmVzb3VyY2UtaWQgdHLGsOG7m2MKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGVfZWxlbWVudCA9IHNlbGYuaGVscGVyLmdldF9uZXh0X2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGJ1dHRvbiwgcmVzb3VyY2VfaWQ9ImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL3RpdGxlIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGl0bGVfZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlX3RleHQgPSB0aXRsZV9lbGVtZW50LmdldCgidGV4dCIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGl0bGVfdGV4dCBhbmQgdGl0bGVfdGV4dC5zdHJpcCgpIGFuZCB0aXRsZV90ZXh0ICE9ICJudWxsIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb190aXRsZSA9IHRpdGxlX3RleHQuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB2aWRlbyB0aXRsZSB04burIHJlc291cmNlLWlkOiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9fdGl0bGUgPSBzZWxmLl9leHRyYWN0X3ZpZGVvX3RpdGxlX2Zyb21fZWxlbWVudChidXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb190aXRsZSA9IHNlbGYuX2V4dHJhY3RfdmlkZW9fdGl0bGVfZnJvbV9lbGVtZW50KGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdmlkZW8gxJHDoyB4ZW0gZ+G6p24gxJHDonkgY2jGsGEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdmlkZW9fdGl0bGUgYW5kIG5vdCBzZWxmLl9jYW5fd2F0Y2hfdmlkZW8odmlkZW9fdGl0bGUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhu48gcXVhIHZpZGVvIMSRw6MgeGVtIGfhuqduIMSRw6J5OiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgdmlkZW8gY+G7p2Ege3RhcmdldF9jaGFubmVsfToge2J1dHRvbl9kZXNjfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIENsaWNrIHbDoG8gdmlkZW8KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgxJHDoyB2w6BvIHZpZGVvIGNoxrBhCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfc2NyZWVuID0gc2VsZi5nZXRfY3VycmVudF9zY3JlZW4oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3NjcmVlbiA9PSAidmlld192aWRlbyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIGjDoG0gd2F0Y2hfdmlkZW8oKSDEkeG7gyB4ZW0gduG7m2kgeOG7rSBsw70gcXXhuqNuZyBjw6FvIHbDoCBraOG6o28gc8OhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHbDoCDEkcOzbmcgcG9wdXAvZGlhbG9nIG7hur91IGPDswogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX2Nsb3NlX3BvcHVwcygpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYud2F0Y2hfdmlkZW8oKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB2w6BvIMSRxrDhu6NjIHZpZGVvLCB0aOG7rSB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgdmlkZW8gY+G7p2Ega8OqbmggdGFyZ2V0LCBzY3JvbGwgeHXhu5FuZyDEkeG7gyB0w6xtIHRow6ptCiAgICAgICAgICAgICAgICBpZiBzY3JvbGxfY291bnQgPCBtYXhfc2Nyb2xscyAtIDE6ICAjIEtow7RuZyBzY3JvbGwg4bufIGzhuqduIGN14buRaQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJTY3JvbGwge3Njcm9sbF9jb3VudCArIDF9L3ttYXhfc2Nyb2xsc30gxJHhu4MgdMOsbSB2aWRlbyBj4bunYSB7dGFyZ2V0X2NoYW5uZWx9IikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDAuNSwgMS4wKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgdmlkZW8gY+G7p2Ega8Oqbmgge3RhcmdldF9jaGFubmVsfSBzYXUge21heF9zY3JvbGxzfSBs4bqnbiBzY3JvbGwiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIHTDrG0gdmlkZW8gxJHhuqd1IHRpw6puOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHdhdGNoX3ZpZGVvKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgWGVtIHZpZGVvIHbhu5tpIHjhu60gbMO9IHF14bqjbmcgY8OhbyB2w6Aga2jhuqNvIHPDoXQKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHhlbSB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkLhuq90IMSR4bqndSB4ZW0gdmlkZW8iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIHZpZGVvIHRyxrDhu5tjIGtoaSB4ZW0KICAgICAgICAgICAgdmlkZW9fdGl0bGUgPSAiIgogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgY29uZmlnIHRo4budaSBnaWFuIHhlbQogICAgICAgICAgICBjb25maWcgPSBzZWxmLmdldF9hcHBfY29uZmlnKCkKICAgICAgICAgICAgYWRfd2F0Y2hfbWluID0gY29uZmlnLmdldCgiYWRfd2F0Y2hfdGltZV9taW4iLCA1KQogICAgICAgICAgICBhZF93YXRjaF9tYXggPSBjb25maWcuZ2V0KCJhZF93YXRjaF90aW1lX21heCIsIDMwKQogICAgICAgICAgICB2aWRlb193YXRjaF9taW4gPSBjb25maWcuZ2V0KCJ2aWRlb193YXRjaF90aW1lX21pbiIsIDE1KQogICAgICAgICAgICB2aWRlb193YXRjaF9tYXggPSBjb25maWcuZ2V0KCJ2aWRlb193YXRjaF90aW1lX21heCIsIDEwMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhu6NpIHZpZGVvIGxvYWQKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgIHNlbGYuX2hhbmRsZV9jbG9zZV9wb3B1cHMoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAxLiBLaeG7g20gdHJhIHbDoCB44butIGzDvSAiQuG7jyBxdWEga2jhuqNvIHPDoXQiCiAgICAgICAgICAgIHNlbGYuX2hhbmRsZV9za2lwX3N1cnZleSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIDIuIEtp4buDbSB0cmEgdsOgIHjhu60gbMO9IHF14bqjbmcgY8OhbyAtIGzhurdwIGzhuqFpIMSR4bq/biBraGkgaOG6v3QgcXXhuqNuZyBjw6FvLCDDrXQgbmjhuqV0IDIgbOG6p24KICAgICAgICAgICAgYWRfaGFuZGxlZF9jb3VudCA9IDAKICAgICAgICAgICAgbWF4X3NhZmV0eV9saW1pdCA9IDEwICAjIEdp4bubaSBo4bqhbiBhbiB0b8OgbiDEkeG7gyB0csOhbmggdsO0IGjhuqFuCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgYWRfZm91bmQgPSBzZWxmLl9oYW5kbGVfYWR2ZXJ0aXNlbWVudChhZF93YXRjaF9taW4sIGFkX3dhdGNoX21heCkKICAgICAgICAgICAgICAgIGFkX2hhbmRsZWRfY291bnQgKz0gMQogICAgICAgICAgICAgICAgaWYgYWRfZm91bmQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgeOG7rSBsw70gcXXhuqNuZyBjw6FvIGzhuqduIHthZF9oYW5kbGVkX2NvdW50fSIpCiAgICAgICAgICAgICAgICAgICAgIyDEkOG7o2kgbeG7mXQgY2jDunQgdHLGsOG7m2Mga2hpIGtp4buDbSB0cmEgcXXhuqNuZyBjw6FvIHRp4bq/cCB0aGVvCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIHTDrG0gdGjhuqV5IHF14bqjbmcgY8OhbwogICAgICAgICAgICAgICAgICAgIGlmIGFkX2hhbmRsZWRfY291bnQgPj0gMjoKICAgICAgICAgICAgICAgICAgICAgICAgIyDEkMOjIHjhu60gbMO9IMOtdCBuaOG6pXQgMiBs4bqnbiB2w6Aga2jDtG5nIGPDsm4gcXXhuqNuZyBjw6FvIOKGkiBk4burbmcKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkhvw6BuIHRow6BuaCB44butIGzDvSB7YWRfaGFuZGxlZF9jb3VudH0gcXXhuqNuZyBjw6FvIikKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBlbGlmIGFkX2hhbmRsZWRfY291bnQgPT0gMToKICAgICAgICAgICAgICAgICAgICAgICAgIyBDaOG7iSB44butIGzDvSAxIGzhuqduLCB0aOG7rSB0aMOqbSAxIGzhuqduIG7hu69hCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgeOG7rSBsw70gMSBxdeG6o25nIGPDoW8sIGtp4buDbSB0cmEgdGjDqm0gbOG6p24gbuG7r2EuLi4iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyB0w6xtIHRo4bqleSBxdeG6o25nIGPDoW8gbsOgbyDihpIgZOG7q25nCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgR2nhu5tpIGjhuqFuIGFuIHRvw6BuCiAgICAgICAgICAgICAgICBpZiBhZF9oYW5kbGVkX2NvdW50ID49IG1heF9zYWZldHlfbGltaXQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIsSQ4bqhdCBnaeG7m2kgaOG6oW4gYW4gdG/DoG4ge21heF9zYWZldHlfbGltaXR9IHF14bqjbmcgY8OhbywgZOG7q25nIHjhu60gbMO9IikKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgYWRfaGFuZGxlZF9jb3VudCA+IDA6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVOG7lW5nIHPhu5EgcXXhuqNuZyBjw6FvIMSRw6MgeOG7rSBsw706IHthZF9oYW5kbGVkX2NvdW50fSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLl9oYW5kbGVfY2xvc2VfcG9wdXBzKCkKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgdmlkZW8gdGl0bGUgdOG7qyBYTUwgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICB4bWxfc3RyaW5nID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIGlmIHhtbF9zdHJpbmc6CiAgICAgICAgICAgICAgICAgICAgIyBQaMawxqFuZyBwaMOhcCAxOiBUw6xtIFZpZXdHcm91cCBjw7MgdGV4dCB2w6AgY29udGVudC1kZXNjIGdp4buRbmcgbmhhdSAoxJHDonkgbMOgIHRpdGxlIGNow61uaCkKICAgICAgICAgICAgICAgICAgICBhbGxfZWxlbWVudHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoeG1sX3N0cmluZywgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXdHcm91cCIpCiAgICAgICAgICAgICAgICAgICAgZm9yIGVsZW1lbnQgaW4gYWxsX2VsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudF9kZXNjID0gZWxlbWVudC5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICAjIFRpdGxlIHRoxrDhu51uZyBjw7MgdGV4dCB2w6AgY29udGVudC1kZXNjIGdp4buRbmcgbmhhdSB2w6AgZMOgaSA+IDE1IGvDvSB04buxCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0IGFuZCBjb250ZW50X2Rlc2MgYW5kIHRleHQgPT0gY29udGVudF9kZXNjIGFuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbih0ZXh0KSA+IDE1IGFuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsxrDhu6N0IHhlbSIgbm90IGluIHRleHQgYW5kICJwaMO6dCIgbm90IGluIHRleHQgYW5kICJnacOieSIgbm90IGluIHRleHQgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibsSDbSB0csaw4bubYyIgbm90IGluIHRleHQgYW5kICJ0aMOhbmcgdHLGsOG7m2MiIG5vdCBpbiB0ZXh0KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX3RpdGxlID0gdGV4dC5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgdmlkZW8gdGl0bGUgdOG7qyBWaWV3R3JvdXA6IHt2aWRlb190aXRsZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFBoxrDGoW5nIHBow6FwIDI6IFTDrG0gdOG7qyBidXR0b24gY2jhu6lhIHRvw6BuIGLhu5kgdGjDtG5nIHRpbiB2aWRlbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCB2aWRlb190aXRsZToKICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uX2VsZW1lbnRzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHhtbF9zdHJpbmcsIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBidXR0b24gaW4gYnV0dG9uX2VsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudF9kZXNjID0gYnV0dG9uLmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2MgYW5kICJwaMOhdCB2aWRlbyIgaW4gY29udGVudF9kZXNjIGFuZCAiIC0gIiBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBQYXJzZSBjb250ZW50LWRlc2MgxJHhu4MgbOG6pXkgdGl0bGUgKHBo4bqnbiDEkeG6p3UgdHLGsOG7m2MgZOG6pXUgcGjhuql5IMSR4bqndSB0acOqbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0cyA9IGNvbnRlbnRfZGVzYy5zcGxpdCgiIC0gIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFydHMpID49IDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTOG6pXkgcGjhuqduIMSR4bqndSwgYuG7jyBwaOG6p24gY3Xhu5FpIGNo4bupYSBtZXRhZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZV9wYXJ0ID0gcGFydHNbMF0uc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIExv4bqhaSBi4buPIHBo4bqnbiB0aOG7nWkgZ2lhbiBu4bq/dSBjw7MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgInBow7p0IiBub3QgaW4gdGl0bGVfcGFydCBhbmQgImdpw6J5IiBub3QgaW4gdGl0bGVfcGFydDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX3RpdGxlID0gdGl0bGVfcGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHZpZGVvIHRpdGxlIHThu6sgYnV0dG9uOiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBQaMawxqFuZyBwaMOhcCAzOiBGYWxsYmFjayAtIHTDrG0gdGV4dCBkw6BpIG5o4bqldCBjw7Mgw70gbmdoxKlhCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHZpZGVvX3RpdGxlOgogICAgICAgICAgICAgICAgICAgICAgICBhbGxfZWxlbWVudHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoeG1sX3N0cmluZykKICAgICAgICAgICAgICAgICAgICAgICAgbG9uZ2VzdF90ZXh0ID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGVsZW1lbnQgaW4gYWxsX2VsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGVsZW1lbnQuZ2V0KCJ0ZXh0IiwgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGV4dCBhbmQgbGVuKHRleHQpID4gbGVuKGxvbmdlc3RfdGV4dCkgYW5kIGxlbih0ZXh0KSA+IDE1IGFuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibMaw4bujdCB4ZW0iIG5vdCBpbiB0ZXh0IGFuZCAicGjDunQiIG5vdCBpbiB0ZXh0IGFuZCAiZ2nDonkiIG5vdCBpbiB0ZXh0IGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuxINtIHRyxrDhu5tjIiBub3QgaW4gdGV4dCBhbmQgInRow6FuZyB0csaw4bubYyIgbm90IGluIHRleHQgYW5kICJuZ8OgeSB0csaw4bubYyIgbm90IGluIHRleHQpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdlc3RfdGV4dCA9IHRleHQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG9uZ2VzdF90ZXh0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9fdGl0bGUgPSBsb25nZXN0X3RleHQuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHZpZGVvIHRpdGxlIHThu6sgdGV4dCBkw6BpIG5o4bqldDoge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHZpZGVvIHRpdGxlOiB7ZX0iKQoKICAgICAgICAgICAgIyBIaeG7g24gdGjhu4sgdGjDtG5nIGLDoW8gxJFhbmcgeGVtIHZpZGVvCiAgICAgICAgICAgIGlmIHZpZGVvX3RpdGxlOgogICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9tZXNzYWdlIiwgZiLEkGFuZyB4ZW0gdmlkZW8gWW91VHViZToge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgeGVtIHZpZGVvOiB7dmlkZW9fdGl0bGV9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsICLEkGFuZyB4ZW0gdmlkZW8gWW91VHViZSIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkGFuZyB4ZW0gdmlkZW8gWW91VHViZTogKGtow7RuZyBs4bqleSDEkcaw4bujYyB0aXRsZSkiKQoKICAgICAgICAgICAgIyAzLiBYZW0gdmlkZW8gY2jDrW5oCiAgICAgICAgICAgIHdhdGNoX3RpbWUgPSByYW5kb20ucmFuZGludCh2aWRlb193YXRjaF9taW4sIHZpZGVvX3dhdGNoX21heCkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlhlbSB2aWRlbyB0cm9uZyB7d2F0Y2hfdGltZX0gZ2nDonkiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2F0Y2hfdGltZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgNC4gTMawdSB2aWRlbyB2w6BvIGzhu4tjaCBz4butIG7hur91IGzhuqV5IMSRxrDhu6NjIHRpdGxlCiAgICAgICAgICAgIGlmIHZpZGVvX3RpdGxlOgogICAgICAgICAgICAgICAgc2VsZi5fc2F2ZV92aWRlb190b19oaXN0b3J5KHZpZGVvX3RpdGxlKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoIktow7RuZyBs4bqleSDEkcaw4bujYyB2aWRlbyB0aXRsZSDEkeG7gyBsxrB1IHbDoG8gbOG7i2NoIHPhu60iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB4ZW0gdmlkZW86IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2hhbmRsZV9za2lwX3N1cnZleShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IGLhu48gcXVhIGto4bqjbyBzw6F0IG7hur91IGPDswogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdMOsbSB0aOG6pXkgdsOgIGLhu48gcXVhIGto4bqjbyBzw6F0CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFTDrG0gYnV0dG9uICJC4buPIHF1YSBraOG6o28gc8OhdCIgaG/hurdjICJTa2lwIHN1cnZleSIKICAgICAgICAgICAgc2tpcF9zdXJ2ZXlfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IkLhu48gcXVhIGto4bqjbyBzw6F0IiwgY29udGFpbnM9VHJ1ZSkKICAgICAgICAgICAgaWYgbm90IHNraXBfc3VydmV5X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNraXBfc3VydmV5X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJTa2lwIHN1cnZleSIsIGNvbnRhaW5zPVRydWUpCiAgICAgICAgICAgIGlmIG5vdCBza2lwX3N1cnZleV9idXR0b246CiAgICAgICAgICAgICAgICBza2lwX3N1cnZleV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJC4buPIHF1YSBraOG6o28gc8OhdCIsIGNvbnRhaW5zPVRydWUpCiAgICAgICAgICAgIGlmIG5vdCBza2lwX3N1cnZleV9idXR0b246CiAgICAgICAgICAgICAgICBza2lwX3N1cnZleV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJTa2lwIHN1cnZleSIsIGNvbnRhaW5zPVRydWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBza2lwX3N1cnZleV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIHRo4bqleSBraOG6o28gc8OhdCwgxJFhbmcgYuG7jyBxdWEuLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNraXBfc3VydmV5X2J1dHRvbikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHjhu60gbMO9IGto4bqjbyBzw6F0OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9oYW5kbGVfYWR2ZXJ0aXNlbWVudChzZWxmLCBhZF93YXRjaF9taW46IGludCwgYWRfd2F0Y2hfbWF4OiBpbnQpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gcXXhuqNuZyBjw6FvIG7hur91IGPDswogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFkX3dhdGNoX21pbjogVGjhu51pIGdpYW4geGVtIHF14bqjbmcgY8OhbyB04buRaSB0aGnhu4N1CiAgICAgICAgICAgIGFkX3dhdGNoX21heDogVGjhu51pIGdpYW4geGVtIHF14bqjbmcgY8OhbyB04buRaSDEkWEKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0w6xtIHRo4bqleSB2w6AgeGVtIHF14bqjbmcgY8OhbwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDoWMgaW5kaWNhdG9yIGPhu6dhIHF14bqjbmcgY8OhbwogICAgICAgICAgICBhZF9pbmRpY2F0b3JzID0gWwogICAgICAgICAgICAgICAgIyBUZXh0IGluZGljYXRvcnMKICAgICAgICAgICAgICAgICgidGV4dCIsICJRdeG6o25nIGPDoW8iLCBUcnVlKSwKICAgICAgICAgICAgICAgICgidGV4dCIsICJBZHZlcnRpc2VtZW50IiwgVHJ1ZSksCiAgICAgICAgICAgICAgICAjIENvbnRlbnQtZGVzYyBpbmRpY2F0b3JzCiAgICAgICAgICAgICAgICAoImNvbnRlbnRfZGVzYyIsICJRdeG6o25nIGPDoW8iLCBUcnVlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIlNraXAgYWQiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIkLhu48gcXVhIHF14bqjbmcgY8OhbyIsIFRydWUpLAogICAgICAgICAgICAgICAgIyBSZXNvdXJjZS1pZCBpbmRpY2F0b3JzCiAgICAgICAgICAgICAgICAoInJlc291cmNlX2lkIiwgImNvbS5nb29nbGUuYW5kcm9pZC55b3V0dWJlOmlkL2FkX3Byb2dyZXNzX3RleHQiLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoInJlc291cmNlX2lkIiwgInNraXBfYWRfYnV0dG9uIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgKCJyZXNvdXJjZV9pZCIsICJ2aWRlb19hZHMiLCBGYWxzZSksCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBxdeG6o25nIGPDoW8gLSDEkeG7jWMgWE1MIG3hu5l0IGzhuqduCiAgICAgICAgICAgIGFkX2ZvdW5kID0gRmFsc2UKICAgICAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKSAgIyDEkOG7jWMgWE1MIG3hu5l0IGzhuqduIGR1eSBuaOG6pXQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHhtbF9jb250ZW50OgogICAgICAgICAgICAgICAgZm9yIGluZGljYXRvcl90eXBlLCBpbmRpY2F0b3JfdmFsdWUsIHVzZV9jb250YWlucyBpbiBhZF9pbmRpY2F0b3JzOgogICAgICAgICAgICAgICAgICAgIGlmIGluZGljYXRvcl90eXBlID09ICJ0ZXh0IjoKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIHRleHQ9aW5kaWNhdG9yX3ZhbHVlLCBjb250YWlucz11c2VfY29udGFpbnMpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpbmRpY2F0b3JfdHlwZSA9PSAiY29udGVudF9kZXNjIjoKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoeG1sX2NvbnRlbnQsIGNvbnRlbnRfZGVzYz1pbmRpY2F0b3JfdmFsdWUsIGNvbnRhaW5zPXVzZV9jb250YWlucykKICAgICAgICAgICAgICAgICAgICBlbGlmIGluZGljYXRvcl90eXBlID09ICJyZXNvdXJjZV9pZCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHhtbF9jb250ZW50LCByZXNvdXJjZV9pZD1pbmRpY2F0b3JfdmFsdWUsIGNvbnRhaW5zPXVzZV9jb250YWlucykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkX2ZvdW5kID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgYWRfZm91bmQ6CiAgICAgICAgICAgICAgICAjIFhlbSBxdeG6o25nIGPDoW8gdHJvbmcgdGjhu51pIGdpYW4gcmFuZG9tCiAgICAgICAgICAgICAgICBhZF93YXRjaF90aW1lID0gcmFuZG9tLnJhbmRpbnQoYWRfd2F0Y2hfbWluLCBhZF93YXRjaF9tYXgpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOsbSB0aOG6pXkgcXXhuqNuZyBjw6FvLCB4ZW0gdHJvbmcge2FkX3dhdGNoX3RpbWV9IGdpw6J5IikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChhZF93YXRjaF90aW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gdsOgIGLhuqVtICJTa2lwIGFkIiBu4bq/dSBjw7MKICAgICAgICAgICAgICAgIHNlbGYuX3RyeV9za2lwX2FkKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHjhu60gbMO9IHF14bqjbmcgY8Ohbzoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfdHJ5X3NraXBfYWQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaOG7rSBi4buPIHF1YSBxdeG6o25nIGPDoW8gbuG6v3UgY8OzIGJ1dHRvbiBza2lwCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0w6xtIHRo4bqleSB2w6AgYuG6pW0gc2tpcAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUw6xtIGJ1dHRvbiBza2lwIGFkCiAgICAgICAgICAgIHNraXBfYnV0dG9ucyA9IFsKICAgICAgICAgICAgICAgICgidGV4dCIsICJTa2lwIiwgVHJ1ZSksCiAgICAgICAgICAgICAgICAoInRleHQiLCAiU2tpcCBhZCIsIFRydWUpLAogICAgICAgICAgICAgICAgKCJ0ZXh0IiwgIlNraXAgYWRzIiwgVHJ1ZSksCiAgICAgICAgICAgICAgICAoInRleHQiLCAiQuG7jyBxdWEiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgidGV4dCIsICJC4buPIHF1YSBxdeG6o25nIGPDoW8iLCBUcnVlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIlNraXAiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIlNraXAgYWQiLCBUcnVlKSwKICAgICAgICAgICAgICAgICgiY29udGVudF9kZXNjIiwgIkLhu48gcXVhIiwgVHJ1ZSksCiAgICAgICAgICAgICAgICAoInJlc291cmNlX2lkIiwgInNraXBfYWRfYnV0dG9uIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgKCJyZXNvdXJjZV9pZCIsICJza2lwX2J1dHRvbiIsIEZhbHNlKSwKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGJ1dHRvbl90eXBlLCBidXR0b25fdmFsdWUsIHVzZV9jb250YWlucyBpbiBza2lwX2J1dHRvbnM6CiAgICAgICAgICAgICAgICBpZiBidXR0b25fdHlwZSA9PSAidGV4dCI6CiAgICAgICAgICAgICAgICAgICAgc2tpcF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD1idXR0b25fdmFsdWUsIGNvbnRhaW5zPXVzZV9jb250YWlucykKICAgICAgICAgICAgICAgIGVsaWYgYnV0dG9uX3R5cGUgPT0gImNvbnRlbnRfZGVzYyI6CiAgICAgICAgICAgICAgICAgICAgc2tpcF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPWJ1dHRvbl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgZWxpZiBidXR0b25fdHlwZSA9PSAicmVzb3VyY2VfaWQiOgogICAgICAgICAgICAgICAgICAgIHNraXBfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHJlc291cmNlX2lkPWJ1dHRvbl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBza2lwX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJC4buPIHF1YSBxdeG6o25nIGPDoW8iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihza2lwX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgYuG7jyBxdWEgcXXhuqNuZyBjw6FvOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9oYW5kbGVfY2xvc2VfcG9wdXBzKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gxJHDs25nIGPDoWMgcG9wdXAvZGlhbG9nIG7hur91IGPDswogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdMOsbSB0aOG6pXkgdsOgIMSRw7NuZyBwb3B1cAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG7jWMgWE1MIG3hu5l0IGzhuqduIGR1eSBuaOG6pXQKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gYnV0dG9uICLEkMOzbmciIHThu6sgWE1MIMSRw6MgxJHhu41jCiAgICAgICAgICAgIGNsb3NlX2J1dHRvbnMgPSBbCiAgICAgICAgICAgICAgICAoImNvbnRlbnRfZGVzYyIsICLEkMOzbmciLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoImNvbnRlbnRfZGVzYyIsICJDbG9zZSIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICgidGV4dCIsICLEkMOzbmciLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoInRleHQiLCAiQ2xvc2UiLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoInRleHQiLCAiw5ciLCBGYWxzZSksCiAgICAgICAgICAgICAgICAoImNvbnRlbnRfZGVzYyIsICJEaXNtaXNzIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgKCJyZXNvdXJjZV9pZCIsICJjb20uZ29vZ2xlLmFuZHJvaWQueW91dHViZTppZC9tb2Rlcm5fbWluaXBsYXllcl9jbG9zZSIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICgicmVzb3VyY2VfaWQiLCAiY29tLmdvb2dsZS5hbmRyb2lkLnlvdXR1YmU6aWQvY2xvc2VfYnV0dG9uIiwgRmFsc2UpLAogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICBwb3B1cF9jbG9zZWQgPSBGYWxzZQogICAgICAgICAgICBmb3IgYnV0dG9uX3R5cGUsIGJ1dHRvbl92YWx1ZSwgdXNlX2NvbnRhaW5zIGluIGNsb3NlX2J1dHRvbnM6CiAgICAgICAgICAgICAgICBpZiBidXR0b25fdHlwZSA9PSAidGV4dCI6CiAgICAgICAgICAgICAgICAgICAgY2xvc2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PWJ1dHRvbl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgZWxpZiBidXR0b25fdHlwZSA9PSAiY29udGVudF9kZXNjIjoKICAgICAgICAgICAgICAgICAgICBjbG9zZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz1idXR0b25fdmFsdWUsIGNvbnRhaW5zPXVzZV9jb250YWlucykKICAgICAgICAgICAgICAgIGVsaWYgYnV0dG9uX3R5cGUgPT0gInJlc291cmNlX2lkIjoKICAgICAgICAgICAgICAgICAgICBjbG9zZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPWJ1dHRvbl92YWx1ZSwgY29udGFpbnM9dXNlX2NvbnRhaW5zKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBjbG9zZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHBvcHVwIHbhu5tpIHtidXR0b25fdHlwZX09J3tidXR0b25fdmFsdWV9JywgxJFhbmcgxJHDs25nLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoY2xvc2VfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgIHBvcHVwX2Nsb3NlZCA9IFRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHBvcHVwX2Nsb3NlZAogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIMSRw7NuZyBwb3B1cDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgICMgPT09PT0gVklERU8gSElTVE9SWSBNQU5BR0VNRU5UID09PT09CiAgICAKICAgIGRlZiBfc2F2ZV92aWRlb190b19oaXN0b3J5KHNlbGYsIHZpZGVvX3RpdGxlOiBzdHIpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgTMawdSB2aWRlbyB2w6BvIGzhu4tjaCBz4butIMSRw6MgeGVtIHRyb25nIGpvYnNfaGlzdG9yeSB0YWJsZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHZpZGVvX3RpdGxlOiBUw6puIHZpZGVvCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3QgdmlkZW9fdGl0bGUgb3IgdmlkZW9fdGl0bGUuc3RyaXAoKSA9PSAiIjoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgYWNjb3VudCAibm8uYWNjb3VudCIgY2hvIFlvdVR1YmUKICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnRfYnlfdW5pcXVlX3VzZXJuYW1lKHNlbGYuYXBwX25hbWUsICJuby5hY2NvdW50IikKICAgICAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgYWNjb3VudCBuby5hY2NvdW50IGNobyBZb3VUdWJlIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBqb2IgZGF0YSBjaG8gdmlkZW8gaGlzdG9yeQogICAgICAgICAgICBqb2JfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJhY2NvdW50X3V1aWQiOiBhY2NvdW50WyJhY2NvdW50X3V1aWQiXSwKICAgICAgICAgICAgICAgICJhcHAiOiBzZWxmLmFwcF9uYW1lLAogICAgICAgICAgICAgICAgImpvYl90eXBlIjogInZpZXciLAogICAgICAgICAgICAgICAgIm9iamVjdF9pZCI6IHZpZGVvX3RpdGxlLCAgIyBMxrB1IHZpZGVvIHRpdGxlIHbDoG8gb2JqZWN0X2lkCiAgICAgICAgICAgICAgICAibGluayI6ICIiLAogICAgICAgICAgICAgICAgInN0YXR1cyI6IDEsICAjIFN1Y2Nlc3MKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJwcmljZSI6IDAsCiAgICAgICAgICAgICAgICAiZXJyb3JfbWVzc2FnZSI6ICIiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSB2w6BvIGpvYnNfaGlzdG9yeQogICAgICAgICAgICBqb2JfdXVpZCA9IHNlbGYuZGIuYWRkX2pvYl9oaXN0b3J5KGpvYl9kYXRhKQogICAgICAgICAgICBpZiBqb2JfdXVpZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGzGsHUgdmlkZW8gdsOgbyBs4buLY2ggc+G7rToge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHRo4buDIGzGsHUgdmlkZW8gdsOgbyBs4buLY2ggc+G7rToge3ZpZGVvX3RpdGxlfSIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBsxrB1IHZpZGVvIGhpc3Rvcnk6IHtlfSIpCiAgICAKICAgIGRlZiBfY2FuX3dhdGNoX3ZpZGVvKHNlbGYsIHZpZGVvX3RpdGxlOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIHRo4buDIHhlbSB2aWRlbyBraMO0bmcgKHF1ZXJ5IHRy4buxYyB0aeG6v3AgZGF0YWJhc2UpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdmlkZW9fdGl0bGU6IFTDqm4gdmlkZW8KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBjw7MgdGjhu4MgeGVtCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3QgdmlkZW9fdGl0bGUgb3IgdmlkZW9fdGl0bGUuc3RyaXAoKSA9PSAiIjoKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGFjY291bnQgIm5vLmFjY291bnQiIGNobyBZb3VUdWJlCiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50X2J5X3VuaXF1ZV91c2VybmFtZShzZWxmLmFwcF9uYW1lLCAibm8uYWNjb3VudCIpCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgS2jDtG5nIGPDsyBhY2NvdW50IHRow6wgY2hvIHBow6lwIHhlbQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbmZpZyA9IHNlbGYuZ2V0X2FwcF9jb25maWcoKQogICAgICAgICAgICBjb29sZG93bl9taW51dGVzID0gY29uZmlnLmdldCgidmlkZW9fcmV3YXRjaF9jb29sZG93bl9taW51dGVzIiwgMjQwKQogICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIGNvb2xkb3duX3NlY29uZHMgPSBjb29sZG93bl9taW51dGVzICogNjAKICAgICAgICAgICAgY3V0b2ZmX3RpbWUgPSBjdXJyZW50X3RpbWUgLSBjb29sZG93bl9zZWNvbmRzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFF1ZXJ5IHRy4buxYyB0aeG6v3AgZGF0YWJhc2UgxJHhu4Mga2nhu4NtIHRyYSB2aWRlbyDEkcOjIHhlbSBn4bqnbiDEkcOieSBjaMawYQogICAgICAgICAgICBjb25uID0gc2VsZi5kYi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgIAogICAgICAgICAgICBxdWVyeSA9ICIiIgogICAgICAgICAgICAgICAgU0VMRUNUIGNyZWF0ZWRfYXQgRlJPTSBqb2JzX2hpc3RvcnkgCiAgICAgICAgICAgICAgICBXSEVSRSBhY2NvdW50X3V1aWQgPSA/IAogICAgICAgICAgICAgICAgQU5EIGpvYl90eXBlID0gJ3ZpZXcnIAogICAgICAgICAgICAgICAgQU5EIG9iamVjdF9pZCA9ID8gCiAgICAgICAgICAgICAgICBBTkQgY3JlYXRlZF9hdCA+ID8KICAgICAgICAgICAgICAgIE9SREVSIEJZIGNyZWF0ZWRfYXQgREVTQyAKICAgICAgICAgICAgICAgIExJTUlUIDEKICAgICAgICAgICAgIiIiCiAgICAgICAgICAgIAogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZShxdWVyeSwgKGFjY291bnRbImFjY291bnRfdXVpZCJdLCB2aWRlb190aXRsZSwgY3V0b2ZmX3RpbWUpKQogICAgICAgICAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0OgogICAgICAgICAgICAgICAgIyBWaWRlbyDEkcOjIHhlbSB0cm9uZyB0aOG7nWkgZ2lhbiBjb29sZG93bgogICAgICAgICAgICAgICAgbGFzdF93YXRjaGVkID0gcmVzdWx0WzBdCiAgICAgICAgICAgICAgICB0aW1lX2RpZmYgPSBjdXJyZW50X3RpbWUgLSBsYXN0X3dhdGNoZWQKICAgICAgICAgICAgICAgIHJlbWFpbmluZ19ob3VycyA9IChjb29sZG93bl9zZWNvbmRzIC0gdGltZV9kaWZmKSAvIDM2MDAKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJWaWRlbyAne3ZpZGVvX3RpdGxlfScgxJHDoyB4ZW0gZ+G6p24gxJHDonksIGPDsm4ge3JlbWFpbmluZ19ob3VyczouMWZ9aCDEkeG7gyB4ZW0gbOG6oWkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFZpZGVvIGNoxrBhIHhlbSBob+G6t2MgxJHDoyDEkeG7pyB0aOG7nWkgZ2lhbiBjb29sZG93bgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlZpZGVvICd7dmlkZW9fdGl0bGV9JyBjw7MgdGjhu4MgeGVtIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraeG7g20gdHJhIGNhbiB3YXRjaCB2aWRlbzoge2V9IikKICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgRGVmYXVsdCBjaG8gcGjDqXAgeGVtCiAgICAKICAgIGRlZiBfZXh0cmFjdF92aWRlb190aXRsZV9mcm9tX2VsZW1lbnQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBUcsOtY2ggeHXhuqV0IHTDqm4gdmlkZW8gdOG7qyBlbGVtZW50IHbDoCBsw6BtIHPhuqFjaCB0acOqdSDEkeG7gQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGVsZW1lbnQ6IEVsZW1lbnQgY2jhu6lhIHRow7RuZyB0aW4gdmlkZW8KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBUw6puIHZpZGVvIMSRw6MgbMOgbSBz4bqhY2ggaG/hurdjIGNodeG7l2kgcuG7l25nCiAgICAgICAgIiIiCiAgICAgICAgZGVmIGNsZWFuX3RpdGxlKHRpdGxlOiBzdHIpIC0+IHN0cjoKICAgICAgICAgICAgIiIiTMOgbSBz4bqhY2ggdmlkZW8gdGl0bGUsIGxv4bqhaSBi4buPIGPDoWMgdGjDtG5nIHRpbiB0aOG7q2EiIiIKICAgICAgICAgICAgaWYgbm90IHRpdGxlOgogICAgICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIHBo4bqnbiB0aOG7nWkgZ2lhbiDhu58gY3Xhu5FpIG5oxrAgIi0gMiBwaMO6dCIsICItIDEgZ2nhu50iLCAiLSAzMCBnacOieSIKICAgICAgICAgICAgdGl0bGUgPSByZS5zdWIocidccypbLeKAk11ccypcZCtccyoocGjDunR8Z2nDonl8Z2nhu518dGnhur9uZylccyokJywgJycsIHRpdGxlLCBmbGFncz1yZS5JR05PUkVDQVNFKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBwaOG6p24gdGjhu51pIGdpYW4gZm9ybWF0IGtow6FjIG5oxrAgIigyOjMwKSIsICJbMzo0NV0iCiAgICAgICAgICAgIHRpdGxlID0gcmUuc3ViKHInXHMqW1xbXChdXHMqXGQrOlxkK1xzKltcXVwpXVxzKiQnLCAnJywgdGl0bGUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIHRow7RuZyB0aW4gbMaw4bujdCB4ZW0g4bufIGN14buRaSBuaMawICItIDFNIHZpZXdzIiwgIi0gMTAwSyBsxrDhu6N0IHhlbSIKICAgICAgICAgICAgdGl0bGUgPSByZS5zdWIocidccypbLeKAk11ccypcZCtbS01CXT9ccyoodmlld3M/fGzGsOG7o3QgeGVtKVxzKiQnLCAnJywgdGl0bGUsIGZsYWdzPXJlLklHTk9SRUNBU0UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIGtob+G6o25nIHRy4bqvbmcgdGjhu6thIHbDoCB0cuG6oyB24buBCiAgICAgICAgICAgIHJldHVybiB0aXRsZS5zdHJpcCgpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRo4butIGzhuqV5IHThu6sgdGV4dCB0csaw4bubYwogICAgICAgICAgICB0ZXh0ID0gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgICAgICAgICAgaWYgdGV4dCBhbmQgdGV4dCAhPSAibnVsbCIgYW5kIGxlbih0ZXh0KSA+IDU6CiAgICAgICAgICAgICAgICAjIELhu48gcXVhIG5o4buvbmcgdGV4dCBraMO0bmcgcGjhuqNpIHTDqm4gdmlkZW8KICAgICAgICAgICAgICAgIGlmIGFueShrZXl3b3JkIGluIHRleHQubG93ZXIoKSBmb3Iga2V5d29yZCBpbiBbImzGsOG7o3QgeGVtIiwgInBow7p0IiwgImdpw6J5IiwgIm7Eg20gdHLGsOG7m2MiLCAidGjDoW5nIHRyxrDhu5tjIiwgIm5nw6B5IHRyxrDhu5tjIiwgImdp4budIHRyxrDhu5tjIl0pOgogICAgICAgICAgICAgICAgICAgIHBhc3MgICMgS2jDtG5nIHBo4bqjaSB0aXRsZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xlYW5fdGl0bGUodGV4dC5zdHJpcCgpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7rSBs4bqleSB04burIGNvbnRlbnQtZGVzYwogICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBlbGVtZW50LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBhbmQgY29udGVudF9kZXNjICE9ICJudWxsIjoKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gY29udGVudC1kZXNjIGPDsyBmb3JtYXQ6ICJUw6puIHZpZGVvLCBUw6puIGvDqm5oLCBYIGzGsOG7o3QgeGVtLCBZIHRo4budaSBnaWFuLCBwaMOhdCB2aWRlbyIKICAgICAgICAgICAgICAgIGlmICJwaMOhdCB2aWRlbyIgaW4gY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgICAgIHBhcnRzID0gY29udGVudF9kZXNjLnNwbGl0KCIsICIpCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX3RpdGxlID0gcGFydHNbMF0uc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB2aWRlb190aXRsZSBhbmQgbGVuKHZpZGVvX3RpdGxlKSA+IDU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xlYW5fdGl0bGUodmlkZW9fdGl0bGUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgSG/hurdjIGNvbnRlbnQtZGVzYyBjaOG7iSBjaOG7qWEgdGjDtG5nIHRpbiB2aWRlbwogICAgICAgICAgICAgICAgaWYgImzGsOG7o3QgeGVtIiBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHBo4bqnbiB0csaw4bubYyAibMaw4bujdCB4ZW0iIGPDsyB0aOG7gyBsw6AgdGl0bGUKICAgICAgICAgICAgICAgICAgICBwYXJ0cyA9IGNvbnRlbnRfZGVzYy5zcGxpdCgibMaw4bujdCB4ZW0iKVswXS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBwaOG6p24gY3Xhu5FpIGPDsyB0aOG7gyBsw6Agc+G7kQogICAgICAgICAgICAgICAgICAgIHRpdGxlX3BhcnRzID0gcGFydHMuc3BsaXQoKQogICAgICAgICAgICAgICAgICAgIGlmIGxlbih0aXRsZV9wYXJ0cykgPiAzOiAgIyDEkOG6o20gYuG6o28gY8OzIMSR4bunIHThu6sgxJHhu4MgbMOgIHRpdGxlCiAgICAgICAgICAgICAgICAgICAgICAgICMgQuG7jyAxLTIgdOG7qyBjdeG7kWkgY8OzIHRo4buDIGzDoCBz4buRIGzGsOG7o3QgeGVtCiAgICAgICAgICAgICAgICAgICAgICAgIHBvdGVudGlhbF90aXRsZSA9ICIgIi5qb2luKHRpdGxlX3BhcnRzWzotMl0pLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBvdGVudGlhbF90aXRsZSkgPiAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbGVhbl90aXRsZShwb3RlbnRpYWxfdGl0bGUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgRmFsbGJhY2s6IG7hur91IGNvbnRlbnQtZGVzYyBkw6BpIHbDoCBjw7Mgw70gbmdoxKlhCiAgICAgICAgICAgICAgICBpZiBsZW4oY29udGVudF9kZXNjKSA+IDEwIGFuZCBub3QgYW55KGtleXdvcmQgaW4gY29udGVudF9kZXNjLmxvd2VyKCkgZm9yIGtleXdvcmQgaW4gWyJidXR0b24iLCAiaW1hZ2UiLCAidmlldyJdKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xlYW5fdGl0bGUoY29udGVudF9kZXNjLnN0cmlwKCkpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGV4dHJhY3QgdmlkZW8gdGl0bGU6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgCiAgICAjID09PT09IEdPTElLRSBJTlRFR1JBVElPTiAoWU9VVFVCRSBLSMOUTkcgU1VQUE9SVCkgPT09PT0KICAgIAogICAgZGVmIG1hcF9nb2xpa2VfYWNjb3VudHMoc2VsZiwgZ29saWtlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSwgZGV2aWNlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgWW91VHViZSBraMO0bmcgaOG7lyB0cuG7oyBHb0xpa2UKICAgICAgICAiIiIKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJZb3VUdWJlIGtow7RuZyBo4buXIHRy4bujIEdvTGlrZSBpbnRlZ3JhdGlvbiIpCiAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBnZXRfam9iX3BhcmFtcyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiWW91VHViZSBraMO0bmcgaOG7lyB0cuG7oyBqb2IgcGFyYW1zIiIiCiAgICAgICAgcmV0dXJuIHt9CiAgICAKICAgIGRlZiBleGVjdXRlX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgWW91VHViZSBraMO0bmcgdGjhu7FjIGhp4buHbiBqb2JzIHThu6sgR29MaWtlCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDAsICJZb3VUdWJlIGtow7RuZyBo4buXIHRy4bujIGpvYnMiLCBGYWxzZSkK').decode('utf-8'))
