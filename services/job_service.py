import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHRocmVhZGluZwppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHJhbmRvbQppbXBvcnQganNvbgpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBMaXN0LCBPcHRpb25hbAppbXBvcnQgY29uZmlnCmltcG9ydCB1dGlscwpmcm9tIHV0aWxzIGltcG9ydCBMb2dMZXZlbCwgTG9nZ2VyCmZyb20gam9icyBpbXBvcnQgVGlrdG9rSm9iLCBJbnN0YWdyYW1Kb2IKZnJvbSBzZXJ2aWNlcy5wcm94eV9zZXJ2aWNlIGltcG9ydCBQcm94eVNlcnZpY2UKCiMgVOG6oW8gbG9nZ2VyIGNobyBKb2JTZXJ2aWNlCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIkpvYlNlcnZpY2UiKQoKIyBDb25zdGFudHMgZm9yIGJldHRlciBjb2RlIHJlYWRhYmlsaXR5CmNsYXNzIEpvYlNlcnZpY2VDb25zdGFudHM6CiAgICAiIiJDb25zdGFudHMgdXNlZCBpbiBKb2JTZXJ2aWNlIiIiCiAgICBERUZBVUxUX0NIRUNLX0lOVEVSVkFMID0gMC41ICAjIFNsZWVwIGNoZWNrIGludGVydmFsIGluIHNlY29uZHMKICAgIE1BWF9XQVJOSU5HX0xPR1MgPSAyMAogICAgCiAgICAjIFN0YXR1cyBtZXNzYWdlcwogICAgTVNHX0RFVklDRV9QQVVTRURfU0VSVkVSID0gIlThuqFtIGThu6tuZyAoU2V2ZXIgecOqdSBj4bqndSkiCiAgICBNU0dfREVWSUNFX05PX0FDQ09VTlRTID0gIlThuqFtIG5naOG7iSAoS2jDtG5nIGPDsyB0w6BpIGtob+G6o24pIgogICAgTVNHX1dBSVRJTkdfUFJPWFkgPSAixJBhbmcgY2jhu50gcHJveHkiCiAgICBNU0dfV09SS0lOR19TRVNTSU9OID0gIsSQYW5nIHRyb25nIHBoacOqbiBsw6BtIHZp4buHYyIKICAgIE1TR19TRVNTSU9OX0NPT0xET1dOID0gIk5naOG7iSBuZ8ahaSBnaeG7r2EgY8OhYyBwaGnDqm4iCiAgICAKICAgICMgQWNjb3VudCBzdGF0dXMgcmVhc29ucwogICAgUkVBU09OX0RBSUxZX0xJTUlUID0gIsSQw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHkiCiAgICBSRUFTT05fU0VTU0lPTl9MSU1JVCA9ICLEkMOjIGhvw6BuIHRow6BuaCBz4buRIGpvYiB04buRaSDEkWEgdHJvbmcgcGhpw6puIgogICAgUkVBU09OX0ZPTExPV19EQUlMWV9MSU1JVCA9ICLEkMOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIGZvbG93IHRyb25nIHBoacOqbiIKICAgIFJFQVNPTl9GT0xMT1dfU0VTU0lPTl9MSU1JVCA9ICLEkMOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIGZvbGxvdyB0cm9uZyBwaGnDqm4iCgpjbGFzcyBKb2JTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZSwgbXF0dF9zZXJ2aWNlPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBKb2JTZXJ2aWNlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZGJfc2VydmljZTogRGF0YWJhc2VTZXJ2aWNlIMSR4buDIGzGsHUgdHLhu68gZOG7ryBsaeG7h3UKICAgICAgICAgICAgaGVscGVyX3NlcnZpY2U6IEhlbHBlclNlcnZpY2UgxJHhu4MgdMawxqFuZyB0w6FjIHbhu5tpIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBnb2xpa2Vfc2VydmljZTogR29MaWtlU2VydmljZSDEkeG7gyBn4buNaSBBUEkgR29MaWtlCiAgICAgICAgICAgIG1xdHRfc2VydmljZTogTVFUVFNlcnZpY2UgxJHhu4MgZ+G7rWkgdGjDtG5nIGLDoW8gKG9wdGlvbmFsKQogICAgICAgICIiIgogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgc2VsZi5oZWxwZXIgPSBoZWxwZXJfc2VydmljZQogICAgICAgIHNlbGYuZ29saWtlX3NlcnZpY2UgPSBnb2xpa2Vfc2VydmljZQogICAgICAgIHNlbGYubXF0dF9zZXJ2aWNlID0gbXF0dF9zZXJ2aWNlCiAgICAgICAgc2VsZi5ydW5uaW5nID0gVHJ1ZQogICAgICAgIHNlbGYuZm9yY2Vfc3RvcCA9IEZhbHNlCiAgICAgICAgCiAgICAgICAgIyBLaOG7n2kgdOG6oW8gUHJveHlTZXJ2aWNlCiAgICAgICAgc2VsZi5wcm94eV9zZXJ2aWNlID0gUHJveHlTZXJ2aWNlKGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlKQogICAgICAgIAogICAgICAgICMgS2jhu59pIHThuqFvIGPDoWMgam9iIGhhbmRsZXIKICAgICAgICBzZWxmLmpvYl9oYW5kbGVycyA9IHt9CiAgICAgICAgCiAgICAgICAgIyBGbGFnIMSRaeG7gXUga2hp4buDbgogICAgICAgIHNlbGYuaXNfaW5pdGlhbGl6ZWQgPSBGYWxzZQogICAgICAgIAogICAgICAgICMgVGjDtG5nIHRpbiB24buBIGPDoWMgYXBwIMSRxrDhu6NjIGvDrWNoIGhv4bqhdCAtIGzhuqV5IHThu6sgZGF0YWJhc2UgaG/hurdjIGNvbmZpZwogICAgICAgIHNlbGYuZW5hYmxlZF9hcHBzID0gc2VsZi5kYi5nZXQoImVuYWJsZWRfYXBwcyIsIGNvbmZpZy5FTkFCTEVEX0FQUFMpCiAgICAgICAgCiAgICAgICAgIyBMb2NrIMSR4buDIMSR4buTbmcgYuG7mSB0cuG6oW5nIHRow6FpCiAgICAgICAgc2VsZi5fbG9jayA9IHRocmVhZGluZy5Mb2NrKCkKICAgICAgICAKICAgICAgICAjIERpY3Rpb25hcnkgxJHhu4MgbMawdSBz4buRIGzhuqduIHRo4butIGpvYiB0aOG6pXQgYuG6oWkgdGhlbyBhY2NvdW50X2lkCiAgICAgICAgc2VsZi5mYWlsZWRfam9iX2F0dGVtcHRzID0ge30KICAgICAgICAKICAgICAgICAjIMSQ4bq/bSBz4buRIGzhuqduIGxpw6puIHRp4bq/cCBqb2IgZm9sbG93IHRy4bqjIHbhu4Egc3RhdHVzIDQgKHBlbmRpbmcpCiAgICAgICAgc2VsZi5mb2xsb3dfcGVuZGluZ19jb3VudHMgPSB7fQogICAgICAgIAogICAgICAgICMgVGjhu51pIGdpYW4ga+G6v3QgdGjDumMgcGhpw6puIHByb3h5CiAgICAgICAgc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lID0gMAogICAgICAgIAogICAgICAgICMgVHLhuqFuZyB0aMOhaSBj4bqtcCBuaOG6rXQgdOG7qyBzZXJ2ZXIgcXVhIE1RVFQKICAgICAgICBzZWxmLmZvcmNlX3Jlc3RhcnRfc2Vzc2lvbiA9IEZhbHNlICAjIEPhuqduIHJlc3RhcnQgc2Vzc2lvbiBkbyBjb25maWcgdGhheSDEkeG7lWkKICAgICAgICAKICAgIGRlZiBzYWZlX3NsZWVwKHNlbGYsIHNlY29uZHM6IGZsb2F0KSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIE5n4bunIGFuIHRvw6BuLCBjw7MgdGjhu4MgZOG7q25nIGzhuqFpIG5nYXkgbOG6rXAgdOG7qWMga2hpIGZvcmNlX3N0b3AgxJHGsOG7o2MgxJHhurd0IHRow6BuaCBUcnVlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2Vjb25kczogU+G7kSBnacOieSBj4bqnbiBuZ+G7pwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IG5n4bunIMSR4bunIHRo4budaSBnaWFuLCBGYWxzZSBu4bq/dSBi4buLIGThu6tuZyBs4bqhaQogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIGNoZWNrX2ludGVydmFsID0gSm9iU2VydmljZUNvbnN0YW50cy5ERUZBVUxUX0NIRUNLX0lOVEVSVkFMICAjIEtp4buDbSB0cmEgbeG7l2kgMC41IGdpw6J5CiAgICAgICAgCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgc2Vjb25kczoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyB5w6p1IGPhuqd1IGThu6tuZyBob+G6t2MgcmVzdGFydCBzZXNzaW9uCiAgICAgICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgICAgIGlmIHNlbGYuZm9yY2Vfc3RvcCBvciBub3Qgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7MgecOqdSBj4bqndSByZXN0YXJ0IHNlc3Npb24sIHRob8OhdCBraOG7j2kgc2xlZXAgbmdheSBs4bqtcCB04bupYwogICAgICAgICAgICAgICAgaWYgc2VsZi5mb3JjZV9yZXN0YXJ0X3Nlc3Npb246CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE5n4bunIG3hu5l0IGtob+G6o25nIG5n4bqvbgogICAgICAgICAgICBzbGVlcF90aW1lID0gbWluKGNoZWNrX2ludGVydmFsLCBzZWNvbmRzIC0gKHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSkpCiAgICAgICAgICAgIGlmIHNsZWVwX3RpbWUgPiAwOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcChzbGVlcF90aW1lKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICBkZWYgaW5pdGlhbGl6ZShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBKb2JTZXJ2aWNlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBraOG7n2kgdOG6oW8gdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygixJBhbmcga2jhu59pIHThuqFvIEpvYlNlcnZpY2UuLi4iKQogICAgICAgIAogICAgICAgICMgMS4gS2nhu4NtIHRyYSBIZWxwZXJTZXJ2aWNlCiAgICAgICAgaGVscGVyX3N1Y2Nlc3MsIGhlbHBlcl9kYXRhID0gdXRpbHMuY2hlY2tfaGVscGVyX3NlcnZpY2Uoc2VsZi5oZWxwZXIpCiAgICAgICAgaWYgbm90IGhlbHBlcl9zdWNjZXNzOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBr4bq/dCBu4buRaSDEkeG6v24gSGVscGVyU2VydmljZS4gVnVpIGzDsm5nIGtp4buDbSB0cmEgbOG6oWkuIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgTMawdSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iyBu4bq/dSBjw7MKICAgICAgICBpZiBoZWxwZXJfZGF0YSBhbmQgImRhdGEiIGluIGhlbHBlcl9kYXRhOgogICAgICAgICAgICBzZWxmLmRiLnNhdmVfZGV2aWNlX2luZm8oaGVscGVyX2RhdGEpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBsxrB1IHRow7RuZyB0aW4gdGhp4bq/dCBi4buLOiB7aGVscGVyX2RhdGFbJ2RhdGEnXS5nZXQoJ2RldmljZV9tb2RlbCcsICdVbmtub3duJyl9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICMgMy4gTMawdSBjw6FjIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmggdsOgbyBkYXRhYmFzZSBu4bq/dSBjaMawYSBjw7MKICAgICAgICBzZWxmLl9zYXZlX2RlZmF1bHRfY29uZmlncygpCiAgICAgICAgICAgIAogICAgICAgIAogICAgICAgIAogICAgICAgICMgNS4gS2jhu59pIHThuqFvIGPDoWMgam9iIGhhbmRsZXIKICAgICAgICBzZWxmLl9pbml0X2pvYl9oYW5kbGVycygpCiAgICAgICAgCiAgICAgICAgIyA2LiBLaOG7n2kgdOG6oW8gbmfDoHkgY3Xhu5FpIGPDuW5nIMSRw6MgcmVzZXQgbuG6v3UgY2jGsGEgY8OzIHRyb25nIGRhdGFiYXNlCiAgICAgICAgbm93ID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkKICAgICAgICB0b2RheSA9IG5vdy5kYXRlKCkKICAgICAgICBqb2JfaG91ciA9IHNlbGYuZGIuZ2V0KCJqb2JfaG91ciIsIGNvbmZpZy5KT0JfSE9VUikKICAgICAgICByZXNldF90aW1lID0gZGF0ZXRpbWUuZGF0ZXRpbWUuY29tYmluZSh0b2RheSwgZGF0ZXRpbWUudGltZShob3VyPWpvYl9ob3VyLCBtaW51dGU9MCkpCiAgICAgICAgCiAgICAgICAgIyBM4bqleSBuZ8OgeSByZXNldCBjdeG7kWkgY8O5bmcgdOG7qyBkYXRhYmFzZQogICAgICAgIGxhc3RfcmVzZXRfZGF0ZV9zdHIgPSBzZWxmLmRiLmdldCgibGFzdF9yZXNldF9kYXRlIikKICAgICAgICAKICAgICAgICBpZiBub3QgbGFzdF9yZXNldF9kYXRlX3N0cjoKICAgICAgICAgICAgIyBO4bq/dSBoaeG7h24gdOG6oWkgxJHDoyBxdWEgZ2nhu50gcmVzZXQgY+G7p2EgbmfDoHkgaMO0bSBuYXksIMSRw6FuaCBk4bqldSDEkcOjIHJlc2V0CiAgICAgICAgICAgIGlmIG5vdyA+PSByZXNldF90aW1lOgogICAgICAgICAgICAgICAgbGFzdF9yZXNldF9kYXRlID0gdG9kYXkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgTuG6v3UgY2jGsGEgxJHhur9uIGdp4budIHJlc2V0LCDEkcOhbmggZOG6pXUgbMOgIMSRw6MgcmVzZXQgbmfDoHkgaMO0bSBxdWEKICAgICAgICAgICAgICAgIGxhc3RfcmVzZXRfZGF0ZSA9IHRvZGF5IC0gZGF0ZXRpbWUudGltZWRlbHRhKGRheXM9MSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICBzZWxmLmRiLnNldCgibGFzdF9yZXNldF9kYXRlIiwgbGFzdF9yZXNldF9kYXRlLmlzb2Zvcm1hdCgpKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIkto4bufaSB04bqhbyBuZ8OgeSByZXNldDoge2xhc3RfcmVzZXRfZGF0ZX0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyB0w6xtIHRo4bqleSBuZ8OgeSByZXNldCBjdeG7kWkgY8O5bmc6IHtsYXN0X3Jlc2V0X2RhdGVfc3RyfSIpCiAgICAgICAgCiAgICAgICAgc2VsZi5pc19pbml0aWFsaXplZCA9IFRydWUKICAgICAgICBsb2dnZXIuaW5mbygiS2jhu59pIHThuqFvIEpvYlNlcnZpY2UgdGjDoG5oIGPDtG5nLiIpCiAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAKICAgIGRlZiBfY2hlY2tfYWNjb3VudF9zeW5jX3N0YXR1cyhzZWxmLCBhcHBfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIGPhu6dhIG3hu5l0IGFwcAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFwcF9uYW1lOiBUw6puIOG7qW5nIGThu6VuZyBj4bqnbiBraeG7g20gdHJhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY+G6p24gxJHhu5NuZyBi4buZIGzhuqFpLCBGYWxzZSBu4bq/dSBraMO0bmcgY+G6p24KICAgICAgICAiIiIKICAgICAgICAjIEzhuqV5IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZIHThu6sgZGF0YWJhc2UKICAgICAgICBzeW5jX3N0YXR1c19rZXkgPSBmInthcHBfbmFtZX1fc3luY19zdGF0dXMiCiAgICAgICAgc3luY19zdGF0dXMgPSBzZWxmLmRiLmdldChzeW5jX3N0YXR1c19rZXksIEZhbHNlKSAgIyBN4bq3YyDEkeG7i25oIGzDoCBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAKICAgICAgICAjIE7hur91IGNoxrBhIMSR4buTbmcgYuG7mSB0aMOsIGPhuqduIMSR4buTbmcgYuG7mSBs4bqhaQogICAgICAgIHJldHVybiBub3Qgc3luY19zdGF0dXMKICAgICAgICAKICAgIGRlZiBfdXBkYXRlX2FjY291bnRfc3luY19zdGF0dXMoc2VsZiwgYXBwX25hbWU6IHN0ciwgc3RhdHVzOiBib29sID0gVHJ1ZSkgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIGPhu6dhIG3hu5l0IGFwcAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFwcF9uYW1lOiBUw6puIOG7qW5nIGThu6VuZyBj4bqnbiBj4bqtcCBuaOG6rXQKICAgICAgICAgICAgc3RhdHVzOiBUcnVlIG7hur91IMSRw6MgxJHhu5NuZyBi4buZLCBGYWxzZSBu4bq/dSBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAiIiIKICAgICAgICBzeW5jX3N0YXR1c19rZXkgPSBmInthcHBfbmFtZX1fc3luY19zdGF0dXMiCiAgICAgICAgCiAgICAgICAgIyBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kKICAgICAgICBzZWxmLmRiLnNldChzeW5jX3N0YXR1c19rZXksIHN0YXR1cykKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB7YXBwX25hbWV9OiB7c3RhdHVzfSIpCiAgICAgICAgCiAgICBkZWYgX3N5bmNfYWNjb3VudHNfZm9yX2FwcChzZWxmLCBhcHBfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQ4buTbmcgYuG7mSB0w6BpIGtob+G6o24gdsOgIG1hcCB0w6BpIGtob+G6o24gR29MaWtlIGNobyBt4buZdCBhcHAgY+G7pSB0aOG7gwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFwcF9uYW1lOiBUw6puIOG7qW5nIGThu6VuZyBj4bqnbiDEkeG7k25nIGLhu5kKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkeG7k25nIGLhu5kgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBpZiBhcHBfbmFtZSBub3QgaW4gc2VsZi5qb2JfaGFuZGxlcnM6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHTDrG0gdGjhuqV5IGpvYiBoYW5kbGVyIGNobyB7YXBwX25hbWV9LCBi4buPIHF1YSDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgaGFuZGxlciA9IHNlbGYuam9iX2hhbmRsZXJzW2FwcF9uYW1lXQogICAgICAgIAogICAgICAgIHRyeToKCiAgICAgICAgICAgICMgMS4gxJDhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB04burIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIMSR4buTbmcgYuG7mSB0w6BpIGtob+G6o24ge2FwcF9uYW1lfS4uLiIpCiAgICAgICAgICAgIGFjY291bnRzID0gaGFuZGxlci5zeW5jX2FjY291bnRzX3RvX2RiKCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMSR4buTbmcgYuG7mSB7bGVuKGFjY291bnRzKX0gdMOgaSBraG/huqNuIHthcHBfbmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAyLiBNYXAgdMOgaSBraG/huqNuIEdvTGlrZQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQYW5nIGzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIEdvTGlrZSBjaG8ge2FwcF9uYW1lfS4uLiIpCiAgICAgICAgICAgIGdvbGlrZV9hY2NvdW50cyA9IGhhbmRsZXIuZ2V0X2dvbGlrZV9hY2NvdW50cygpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnb2xpa2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgdMOsbSB0aOG6pXkge2xlbihnb2xpa2VfYWNjb3VudHMpfSB0w6BpIGtob+G6o24gR29MaWtlIGNobyB7YXBwX25hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBM4bqleSB0w6BpIGtob+G6o24gdOG7qyB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9hY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1hcHBfbmFtZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDDgW5oIHjhuqEgdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBtYXBwZWRfYWNjb3VudHMgPSBoYW5kbGVyLm1hcF9nb2xpa2VfYWNjb3VudHMoZ29saWtlX2FjY291bnRzLCBkZXZpY2VfYWNjb3VudHMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDDoW5oIHjhuqEge2xlbihtYXBwZWRfYWNjb3VudHMpfSB0w6BpIGtob+G6o24ge2FwcF9uYW1lfSB24bubaSBHb0xpa2UiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIEdvTGlrZSBuw6BvIGNobyB7YXBwX25hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIHNlbGYuX3VwZGF0ZV9hY2NvdW50X3N5bmNfc3RhdHVzKGFwcF9uYW1lLCBUcnVlKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB2w6AgbWFwIEdvTGlrZSBjaG8ge2FwcF9uYW1lfSIpCiAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IGzDoCBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgc2VsZi5fdXBkYXRlX2FjY291bnRfc3luY19zdGF0dXMoYXBwX25hbWUsIEZhbHNlKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgIGRlZiBfc2F2ZV9kZWZhdWx0X2NvbmZpZ3Moc2VsZik6CiAgICAgICAgIiIiTMawdSBjw6FjIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmggdsOgbyBkYXRhYmFzZSBu4bq/dSBjaMawYSBjw7MiIiIKICAgICAgICBkZWZhdWx0X2NvbmZpZ3MgPSB7CiAgICAgICAgICAgICMgQ+G6pXUgaMOsbmggbGnDqm4gcXVhbiDEkeG6v24gdGjhu51pIGdpYW4gbMOgbSBqb2IKICAgICAgICAgICAgImpvYl9ob3VyIjogY29uZmlnLkpPQl9IT1VSLAogICAgICAgICAgICAiam9iX2Nvb2xkb3duX21pbnV0ZXMiOiBjb25maWcuREVGQVVMVF9DT09MRE9XTl9NSU5VVEVTLAogICAgICAgICAgICAiam9iX2NoZWNrX2ludGVydmFsIjogY29uZmlnLkpPQl9DSEVDS19JTlRFUlZBTCwKICAgICAgICAgICAgImNvb2xkb3duX2dldF9qb2JfZ29saWtlIjogMzAsICAjIFRo4budaSBnaWFuIGNo4budIChwaMO6dCkga2hpIGtow7RuZyB0w6xtIHRo4bqleSBqb2IgR29MaWtlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuqV1IGjDrG5oIGxpw6puIHF1YW4gxJHhur9uIHPhu5EgbMaw4bujbmcgam9iCiAgICAgICAgICAgICJtYXhfam9ic19wZXJfZGF5IjogY29uZmlnLk1BWF9KT0JTX1BFUl9EQVksCiAgICAgICAgICAgICJtYXhfam9ic19wZXJfc2Vzc2lvbiI6IGNvbmZpZy5NQVhfSk9CU19QRVJfU0VTU0lPTiwKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVHLhuqFuZyB0aMOhaSB04bqhbSBk4burbmcgdOG7qyBzZXJ2ZXIKICAgICAgICAgICAgInBhdXNlX2pvYiI6IEZhbHNlLAogICAgICAgICAgICAjIFRy4bqhbmcgdGjDoWkgdGhp4bq/dCBi4buLIMSRYW5nIGzDoG0gdmnhu4djCiAgICAgICAgICAgICJkZXZpY2VfaXNfd29ya2luZyI6IEZhbHNlLAogICAgICAgICAgICAiZGV2aWNlX21lc3NhZ2UiOiAiIiwKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRGFuaCBzw6FjaCBjw6FjIGFwcCDEkcaw4bujYyBrw61jaCBob+G6oXQKICAgICAgICAgICAgImVuYWJsZWRfYXBwcyI6IGNvbmZpZy5FTkFCTEVEX0FQUFMsCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRoaeG6v3QgbOG6rXAgY2hvIHBow6lwIGNoxINtIHPDs2Mga2hpIGzDoG0gam9iCiAgICAgICAgICAgICJjYXJlX2luX3dvcmtpbmdfam9iIjogRmFsc2UsCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuqV1IGjDrG5oIGdpw6EgdOG7kWkgdGhp4buDdSBjaG8gam9iIGZvbGxvdwogICAgICAgICAgICAibWluX2ZvbGxvd19wcmljZSI6IDIwLAogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqldSBow6xuaCB44butIGzDvSB1bmZvbGxvdy91bmxpa2UKICAgICAgICAgICAgIm1heF91bmZvbGxvd19hdHRlbXB0cyI6IGNvbmZpZy5NQVhfVU5GT0xMT1dfQVRURU1QVFMsCiAgICAgICAgICAgICJ1bmZvbGxvd19wZW5hbHR5X2hvdXJzIjogY29uZmlnLlVORk9MTE9XX1BFTkFMVFlfSE9VUlMsCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgICAgICJ1c2VfcHJveHkiOiBGYWxzZSwgICMgQ8OzIHPhu60gZOG7pW5nIHByb3h5IGtow7RuZwogICAgICAgICAgICAicHJveHlfc2VydmVyIjogImh0dHA6Ly8xMC4wLjAuNTo5MDMyIiwgICMgU2VydmVyIHByb3h5IG3hurdjIMSR4buLbmgKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZGVmYXVsdF9jb25maWdzLml0ZW1zKCk6CiAgICAgICAgICAgICMgQ2jhu4kgbMawdSBu4bq/dSBjaMawYSBjw7MgdHJvbmcgZGF0YWJhc2UKICAgICAgICAgICAgaWYgc2VsZi5kYi5nZXQoa2V5KSBpcyBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoa2V5LCB2YWx1ZSkKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIsSQw6MgbMawdSBj4bqldSBow6xuaCBt4bq3YyDEkeG7i25oOiB7a2V5fT17dmFsdWV9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkPhuqV1IGjDrG5oIHtrZXl9IMSRw6MgdOG7k24gdOG6oWk6IHtzZWxmLmRiLmdldChrZXkpfSIpCiAgICAgICAgCiAgICBkZWYgX2luaXRfam9iX2hhbmRsZXJzKHNlbGYpOgogICAgICAgICIiIkto4bufaSB04bqhbyBjw6FjIGpvYiBoYW5kbGVyIiIiCiAgICAgICAgIyBpbml0IHRow6wgc+G6vSBpbml0IGhhbmRsZXJzIGNobyB04bqldCBj4bqjIGPDoWMgYXBwLCBsw6BtIGFwcCBuw6BvIHRow6wgc+G6vSB0aGVvIGPhuqV1IGjDrG5oIGzhuqV5IHThu6sgZGF0YWJhc2UKICAgICAgICBmb3IgYXBwX25hbWUgaW4gY29uZmlnLkVOQUJMRURfQVBQUzoKICAgICAgICAgICAgaWYgYXBwX25hbWUgPT0gInRpa3RvayI6CiAgICAgICAgICAgICAgICBzZWxmLmpvYl9oYW5kbGVyc1thcHBfbmFtZV0gPSBUaWt0b2tKb2Ioc2VsZi5kYiwgc2VsZi5oZWxwZXIsIHNlbGYuZ29saWtlX3NlcnZpY2UpCiAgICAgICAgICAgICAgICAjIFRydXnhu4FuIHBoxrDGoW5nIHRo4bupYyBzYWZlX3NsZWVwIHbDoCBwcm94eV9zZXJ2aWNlIHbDoG8gam9iIGhhbmRsZXIKICAgICAgICAgICAgICAgIHNlbGYuam9iX2hhbmRsZXJzW2FwcF9uYW1lXS5zZXRfc2xlZXBfZnVuY3Rpb24oc2VsZi5zYWZlX3NsZWVwKQogICAgICAgICAgICAgICAgc2VsZi5qb2JfaGFuZGxlcnNbYXBwX25hbWVdLnNldF9wcm94eV9zZXJ2aWNlKHNlbGYucHJveHlfc2VydmljZSkKICAgICAgICAgICAgZWxpZiBhcHBfbmFtZSA9PSAiaW5zdGFncmFtIjoKICAgICAgICAgICAgICAgIHNlbGYuam9iX2hhbmRsZXJzW2FwcF9uYW1lXSA9IEluc3RhZ3JhbUpvYihzZWxmLmRiLCBzZWxmLmhlbHBlciwgc2VsZi5nb2xpa2Vfc2VydmljZSkKICAgICAgICAgICAgICAgICMgVHJ1eeG7gW4gcGjGsMahbmcgdGjhu6ljIHNhZmVfc2xlZXAgdsOgIHByb3h5X3NlcnZpY2UgdsOgbyBqb2IgaGFuZGxlcgogICAgICAgICAgICAgICAgc2VsZi5qb2JfaGFuZGxlcnNbYXBwX25hbWVdLnNldF9zbGVlcF9mdW5jdGlvbihzZWxmLnNhZmVfc2xlZXApCiAgICAgICAgICAgICAgICBzZWxmLmpvYl9oYW5kbGVyc1thcHBfbmFtZV0uc2V0X3Byb3h5X3NlcnZpY2Uoc2VsZi5wcm94eV9zZXJ2aWNlKQogICAgICAgICAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGto4bufaSB04bqhbyB7bGVuKHNlbGYuam9iX2hhbmRsZXJzKX0gam9iIGhhbmRsZXI6IHsnLCAnLmpvaW4oc2VsZi5qb2JfaGFuZGxlcnMua2V5cygpKX0iKQogICAgICAgIAogICAgZGVmIF9yZXNldF9kYWlseV9jb3VudGVycyhzZWxmKToKICAgICAgICAiIiJSZXNldCBi4buZIMSR4bq/bSBow6BuZyBuZ8OgeSB2w6BvIGdp4budIMSRxrDhu6NjIGPhuqV1IGjDrG5oIiIiCiAgICAgICAgbm93ID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkKICAgICAgICB0b2RheSA9IG5vdy5kYXRlKCkKICAgICAgICAKICAgICAgICAjIEzhuqV5IGdp4budIHJlc2V0IHThu6sgY+G6pXUgaMOsbmggaG/hurdjIHThu6sgZGF0YWJhc2UgbuG6v3UgY8OzCiAgICAgICAgam9iX2hvdXIgPSBzZWxmLmRiLmdldCgiam9iX2hvdXIiLCBjb25maWcuSk9CX0hPVVIpCiAgICAgICAgCiAgICAgICAgIyBUw61uaCB0aOG7nWkgxJFp4buDbSByZXNldCBj4bunYSBuZ8OgeSBow7RtIG5heQogICAgICAgIHJlc2V0X3RpbWUgPSBkYXRldGltZS5kYXRldGltZS5jb21iaW5lKHRvZGF5LCBkYXRldGltZS50aW1lKGhvdXI9am9iX2hvdXIsIG1pbnV0ZT0wKSkKICAgICAgICAKICAgICAgICAjIEzhuqV5IG5nw6B5IHJlc2V0IGN14buRaSBjw7luZyB04burIGRhdGFiYXNlCiAgICAgICAgbGFzdF9yZXNldF9kYXRlX3N0ciA9IHNlbGYuZGIuZ2V0KCJsYXN0X3Jlc2V0X2RhdGUiKQogICAgICAgIGxhc3RfcmVzZXRfZGF0ZSA9IE5vbmUKICAgICAgICAKICAgICAgICBpZiBsYXN0X3Jlc2V0X2RhdGVfc3RyOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBsYXN0X3Jlc2V0X2RhdGUgPSBkYXRldGltZS5kYXRlLmZyb21pc29mb3JtYXQobGFzdF9yZXNldF9kYXRlX3N0cikKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiLEkOG7i25oIGThuqFuZyBuZ8OgeSByZXNldCBraMO0bmcgaOG7o3AgbOG7hzoge2xhc3RfcmVzZXRfZGF0ZV9zdHJ9IikKICAgICAgICAgICAgICAgIGxhc3RfcmVzZXRfZGF0ZSA9IE5vbmUKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6MgcXVhIGdp4budIHJlc2V0IGPhu6dhIG5nw6B5IGjDtG0gbmF5IGNoxrBhIHbDoCBjaMawYSByZXNldCB0cm9uZyBuZ8OgeSBow7RtIG5heQogICAgICAgIGlmIG5vdyA+PSByZXNldF90aW1lIGFuZCAobGFzdF9yZXNldF9kYXRlIGlzIE5vbmUgb3IgbGFzdF9yZXNldF9kYXRlIDwgdG9kYXkpOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlRo4buxYyBoaeG7h24gcmVzZXQgYuG7mSDEkeG6v20gaMOgbmcgbmfDoHkgKGdp4budIHJlc2V0OiB7am9iX2hvdXJ9OjAwKSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IGPDoWMgYuG7mSDEkeG6v20gY2hvIHThuqV0IGPhuqMgdMOgaSBraG/huqNuCiAgICAgICAgICAgIGZvciBhcHBfbmFtZSBpbiBzZWxmLmVuYWJsZWRfYXBwczoKICAgICAgICAgICAgICAgIGFjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPWFwcF9uYW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50czoKICAgICAgICAgICAgICAgICAgICAjIFJlc2V0IHPhu5Egam9iIGjDtG0gbmF5IHbDoCBz4buRIGpvYiB0cm9uZyBwaGnDqm4KICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl90b2RheSI6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICJqb2JzX2RvbmVfaW5fc2Vzc2lvbiI6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICJmb2xsb3dfdG9kYXkiOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAiZm9sbG93X2luX3Nlc3Npb24iOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAibGFzdF92aWV3X3N0b3JpZXMiOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAiZGlzYWJsZV9mb2xsb3ciOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgImZvbGxvd19kaXNhYmxlX3VudGlsIjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgImluYWN0aXZlX2ZvbGxvd19yZWFzb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB0w6BpIGtob+G6o24gxJFhbmcg4bufIHRy4bqhbmcgdGjDoWkgaW5hY3RpdmUgdsOsIMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHksCiAgICAgICAgICAgICAgICAgICAgIyDEkeG6t3QgbOG6oWkgdHLhuqFuZyB0aMOhaSB0aMOgbmggYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgaWYgYWNjb3VudC5nZXQoInN0YXR1cyIpID09ICJpbmFjdGl2ZSIgYW5kIGFjY291bnQuZ2V0KCJpbmFjdGl2ZV9yZWFzb24iKSA9PSAixJDDoyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGpvYiBow6BuZyBuZ8OgeSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJhY3RpdmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9kaXNhYmxlX3VudGlsIjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMSR4bq3dCBs4bqhaSB0cuG6oW5nIHRow6FpIGFjdGl2ZSBjaG8gdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IHNhdSBraGkgcmVzZXQiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgcmVzZXQgYuG7mSDEkeG6v20gaMOgbmcgbmfDoHkgY2hvIHThuqV0IGPhuqMgdMOgaSBraG/huqNuIHbDoG8ge25vdy5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgbmfDoHkgxJHDoyByZXNldCB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJsYXN0X3Jlc2V0X2RhdGUiLCB0b2RheS5pc29mb3JtYXQoKSkKICAgICAgICAKICAgIGRlZiBfY2FuX3J1bl9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIHRo4buDIGNo4bqheSBqb2IgY2hvIHTDoGkga2hv4bqjbiBraMO0bmcKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGPDsyB0aOG7gyBjaOG6oXkgam9iLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICB1c2VybmFtZSA9IGFjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnVW5rbm93bicpCiAgICAgICAgCiAgICAgICAgIyAxLiBLaeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgY8ahIGLhuqNuCiAgICAgICAgaWYgbm90IHNlbGYuX2NoZWNrX2Jhc2ljX2FjY291bnRfc3RhdHVzKGFjY291bnQpOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgIyAyLiBLaeG7g20gdHJhIMSRaeG7gXUga2nhu4duIGPhuqduIHRoaeG6v3QKICAgICAgICBpZiBub3Qgc2VsZi5fY2hlY2tfYWNjb3VudF9wcmVyZXF1aXNpdGVzKGFjY291bnQpOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgIyAzLiDEkOG6o20gYuG6o28gY8OhYyBnaeG7m2kgaOG6oW4gxJHGsOG7o2MgdGhp4bq/dCBs4bqtcAogICAgICAgIGFjY291bnQgPSBzZWxmLl9lbnN1cmVfYWNjb3VudF9saW1pdHNfc2V0KGFjY291bnQpCiAgICAgICAgCiAgICAgICAgIyA0LiBLaeG7g20gdHJhIGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHkKICAgICAgICBpZiBzZWxmLl9pc19hY2NvdW50X2F0X2RhaWx5X2xpbWl0KGFjY291bnQpOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgdHJvbmcgbmfDoHkiKQogICAgICAgICAgICBzZWxmLmRiLnNldF9hY2NvdW50X2luYWN0aXZlX3VudGlsX25leHRfcmVzZXQoYWNjb3VudFsiaWQiXSwgIsSQw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgaMOgbmcgbmfDoHkiKQogICAgICAgICAgICBzZWxmLl9jbG9zZV9hcHBfZm9yX2FjY291bnQoYWNjb3VudCkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgNS4gS2nhu4NtIHRyYSBnaeG7m2kgaOG6oW4gam9iIHRyb25nIHBoacOqbgogICAgICAgIGlmIHNlbGYuX2lzX2FjY291bnRfYXRfc2Vzc2lvbl9saW1pdChhY2NvdW50KToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge3VzZXJuYW1lfSDEkcOjIGzDoG0gxJHhu6cgam9iIHRyb25nIHBoacOqbiIpCiAgICAgICAgICAgIHNlbGYuZGIuc2V0X2FjY291bnRfaW5hY3RpdmUoYWNjb3VudFsiaWQiXSwgaW5hY3RpdmVfcmVhc29uPSLEkMOjIGhvw6BuIHRow6BuaCBz4buRIGpvYiB04buRaSDEkWEgdHJvbmcgcGhpw6puIikKICAgICAgICAgICAgc2VsZi5fY2xvc2VfYXBwX2Zvcl9hY2NvdW50KGFjY291bnQpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICBkZWYgX2NoZWNrX2Jhc2ljX2FjY291bnRfc3RhdHVzKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIktp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBjxqEgYuG6o24gY+G7p2EgdMOgaSBraG/huqNuIiIiCiAgICAgICAgYWNjb3VudF9zdGF0dXMgPSBhY2NvdW50LmdldCgic3RhdHVzIiwgImFjdGl2ZSIpCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSB0w6BpIGtob+G6o24gYuG7iyBkaXNhYmxlZCwga2jDtG5nIGNobyBjaOG6oXkgam9iCiAgICAgICAgaWYgYWNjb3VudF9zdGF0dXMgPT0gImRpc2FibGVkIjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgTuG6v3UgdMOgaSBraG/huqNuIMSRw6MgbG9nb3V0LCBraMO0bmcgY2hvIGNo4bqheSBqb2IKICAgICAgICBpZiBhY2NvdW50X3N0YXR1cyA9PSAibG9nb3V0IjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgTuG6v3UgdMOgaSBraG/huqNuIMSRYW5nIGluYWN0aXZlLCBraeG7g20gdHJhIHRo4budaSBnaWFuIGNvb2xkb3duCiAgICAgICAgaWYgYWNjb3VudF9zdGF0dXMgPT0gImluYWN0aXZlIjoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2hhbmRsZV9pbmFjdGl2ZV9hY2NvdW50KGFjY291bnQpCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICBkZWYgX2hhbmRsZV9pbmFjdGl2ZV9hY2NvdW50KHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIljhu60gbMO9IHTDoGkga2hv4bqjbiDEkWFuZyDhu58gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZSIiIgogICAgICAgIGpvYl9kaXNhYmxlX3VudGlsID0gYWNjb3VudC5nZXQoImpvYl9kaXNhYmxlX3VudGlsIiwgMCkKICAgICAgICB1c2VybmFtZSA9IGFjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnVW5rbm93bicpCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSDEkcOjIGjhur90IHRo4budaSBnaWFuIGNvb2xkb3duLCBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSB24buBIGFjdGl2ZQogICAgICAgIGlmIGpvYl9kaXNhYmxlX3VudGlsIDw9IHRpbWUudGltZSgpOgogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIHbhu4EgYWN0aXZlCiAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJhY3RpdmUiLAogICAgICAgICAgICAgICAgImxhc3RfY2FyZV90aW1lIjogMCwKICAgICAgICAgICAgICAgICJkaXNhYmxlX2ZvbGxvdyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImZvbGxvd19kaXNhYmxlX3VudGlsIjogMCwKICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIjogIiIKICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHt1c2VybmFtZX0gxJHDoyBo4bq/dCB0aOG7nWkgZ2lhbiBjaOG7nSwgxJHDoyBjaHV54buDbiB24buBIHRy4bqhbmcgdGjDoWkgYWN0aXZlIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIENoxrBhIGjhur90IHRo4budaSBnaWFuIGNo4budCiAgICAgICAgICAgIGNvb2xkb3duX3JlbWFpbiA9IGludCgoam9iX2Rpc2FibGVfdW50aWwgLSB0aW1lLnRpbWUoKSkgLyA2MCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge3VzZXJuYW1lfSDEkWFuZyB0cm9uZyB0aOG7nWkgZ2lhbiBjaOG7nSAoY8OybiB7Y29vbGRvd25fcmVtYWlufSBwaMO6dCkiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX2NoZWNrX2FjY291bnRfcHJlcmVxdWlzaXRlcyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJLaeG7g20gdHJhIGPDoWMgxJFp4buBdSBraeG7h24gdGnDqm4gcXV54bq/dCBj4bunYSB0w6BpIGtob+G6o24iIiIKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiBjw7MgxJHGsOG7o2MgYuG6rXQgam9iIGtow7RuZwogICAgICAgIGlmIG5vdCBhY2NvdW50LmdldCgiam9iX2VuYWJsZSIsIEZhbHNlKToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIMSRw6MgxJHGsOG7o2MgbGnDqm4ga+G6v3QgduG7m2kgR29MaWtlIGNoxrBhCiAgICAgICAgaWYgbm90IGFjY291bnQuZ2V0KCJpc19nb2xpa2VfbGlua2VkIiwgRmFsc2UpOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAKICAgIGRlZiBfZW5zdXJlX2FjY291bnRfbGltaXRzX3NldChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgxJDhuqNtIGLhuqNvIGPDoWMgZ2nhu5tpIGjhuqFuIGPhu6dhIHTDoGkga2hv4bqjbiDEkcaw4bujYyB0aGnhur90IGzhuq1wIHbhu5tpIGdpw6EgdHLhu4sgbeG6t2MgxJHhu4tuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbiDEkcOjIMSRxrDhu6NjIGPhuq1wIG5o4bqtdAogICAgICAgICIiIgogICAgICAgIHVwZGF0ZV9kYXRhID0ge30KICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgdsOgIHRoaeG6v3QgbOG6rXAgbWF4X2pvYnNfcGVyX3Nlc3Npb24KICAgICAgICBpZiBhY2NvdW50LmdldCgibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCAwKSA8PSAwOgogICAgICAgICAgICB1cGRhdGVfZGF0YVsibWF4X2pvYnNfcGVyX3Nlc3Npb24iXSA9IGNvbmZpZy5NQVhfSk9CU19QRVJfU0VTU0lPTgogICAgICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgdsOgIHRoaeG6v3QgbOG6rXAgam9iX21heF9kYXkKICAgICAgICBpZiBhY2NvdW50LmdldCgiam9iX21heF9kYXkiLCAwKSA8PSAwOgogICAgICAgICAgICB1cGRhdGVfZGF0YVsiam9iX21heF9kYXkiXSA9IGNvbmZpZy5NQVhfSk9CU19QRVJfREFZCiAgICAgICAgICAgIAogICAgICAgICMgQ+G6rXAgbmjhuq10IHbDoG8gZGF0YWJhc2UgbuG6v3UgY8OzIHRoYXkgxJHhu5VpCiAgICAgICAgaWYgdXBkYXRlX2RhdGE6CiAgICAgICAgICAgIHVwZGF0ZV9kYXRhWyJpc19zeW5jIl0gPSBGYWxzZQogICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHVwZGF0ZV9kYXRhKQogICAgICAgICAgICBhY2NvdW50LnVwZGF0ZSh1cGRhdGVfZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGFjY291bnQKICAgICAgICAKICAgIGRlZiBfY2xvc2VfYXBwX2Zvcl9hY2NvdW50KHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIMSQw7NuZyBhcHAgdMawxqFuZyDhu6luZyB24bubaSB0w6BpIGtob+G6o24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICIiIgogICAgICAgIGFwcF9uYW1lID0gYWNjb3VudC5nZXQoImFwcCIpCiAgICAgICAgaWYgYXBwX25hbWUgYW5kIGFwcF9uYW1lIGluIGNvbmZpZy5BUFBfUEFDS0FHRVM6CiAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcChjb25maWcuQVBQX1BBQ0tBR0VTW2FwcF9uYW1lXSkKICAgICAgICAgICAgCiAgICBkZWYgX2lzX2FjY291bnRfYXRfZGFpbHlfbGltaXQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIGPDsyDEkeG6oXQgZ2nhu5tpIGjhuqFuIGpvYiBow6BuZyBuZ8OgeSBraMO0bmcKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbgogICAgICAgICIiIgogICAgICAgIGpvYl90b2RheSA9IGFjY291bnQuZ2V0KCJqb2JfdG9kYXkiLCAwKQogICAgICAgIGpvYl9tYXhfZGF5ID0gYWNjb3VudC5nZXQoImpvYl9tYXhfZGF5IiwgMCkgb3IgY29uZmlnLk1BWF9KT0JTX1BFUl9EQVkKICAgICAgICByZXR1cm4gam9iX3RvZGF5ID49IGpvYl9tYXhfZGF5CiAgICAgICAgCiAgICBkZWYgX2lzX2FjY291bnRfYXRfc2Vzc2lvbl9saW1pdChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSB0w6BpIGtob+G6o24gY8OzIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIHRyb25nIHBoacOqbiBraMO0bmcKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbgogICAgICAgICIiIgogICAgICAgIGpvYnNfZG9uZV9pbl9zZXNzaW9uID0gYWNjb3VudC5nZXQoImpvYnNfZG9uZV9pbl9zZXNzaW9uIiwgMCkKICAgICAgICBtYXhfam9ic19wZXJfc2Vzc2lvbiA9IGFjY291bnQuZ2V0KCJtYXhfam9ic19wZXJfc2Vzc2lvbiIsIDApIG9yIGNvbmZpZy5NQVhfSk9CU19QRVJfU0VTU0lPTgogICAgICAgIHJldHVybiBqb2JzX2RvbmVfaW5fc2Vzc2lvbiA+PSBtYXhfam9ic19wZXJfc2Vzc2lvbgogICAgICAgIAogICAgZGVmIF91cGRhdGVfam9iX3N0YXRzKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBzdWNjZXNzOiBib29sID0gVHJ1ZSwgam9iX3R5cGU6IHN0ciA9IE5vbmUpOgogICAgICAgICIiIgogICAgICAgIEPhuq1wIG5o4bqtdCB0aOG7kW5nIGvDqiBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBzdWNjZXNzOiBUcnVlIG7hur91IGpvYiB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICAgICBqb2JfdHlwZTogTG/huqFpIGpvYiAoZm9sbG93LCBsaWtlLCBldGMuKQogICAgICAgICIiIgogICAgICAgIHVzZXJuYW1lID0gYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICdVbmtub3duJykKICAgICAgICAKICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIGpvYiBjxqEgYuG6o24KICAgICAgICBzZWxmLl91cGRhdGVfYmFzaWNfam9iX3N0YXRzKGFjY291bnQsIHN1Y2Nlc3MpCiAgICAgICAgCiAgICAgICAgIyBSZXNldCBz4buRIGzhuqduIHRo4butIGpvYiB0aOG6pXQgYuG6oWkgbuG6v3Ugam9iIHRow6BuaCBjw7RuZwogICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgIHNlbGYuZmFpbGVkX2pvYl9hdHRlbXB0c1thY2NvdW50WyJpZCJdXSA9IDAKICAgICAgICAKICAgICAgICAjIMSQ4bqjbSBi4bqjbyBjw6FjIGdp4bubaSBo4bqhbiDEkcaw4bujYyB0aGnhur90IGzhuq1wCiAgICAgICAgYWNjb3VudCA9IHNlbGYuX2Vuc3VyZV9hY2NvdW50X2xpbWl0c19zZXQoYWNjb3VudCkKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgdsOgIHjhu60gbMO9IGdp4bubaSBo4bqhbiBwaGnDqm4KICAgICAgICBzZWxmLl9jaGVja19zZXNzaW9uX2xpbWl0X2FmdGVyX2pvYihhY2NvdW50KQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB2w6AgeOG7rSBsw70gZ2nhu5tpIGjhuqFuIGjDoG5nIG5nw6B5CiAgICAgICAgc2VsZi5fY2hlY2tfZGFpbHlfbGltaXRfYWZ0ZXJfam9iKGFjY291bnQpCiAgICAgICAgCiAgICAgICAgIyBY4butIGzDvSB0aOG7kW5nIGvDqiByacOqbmcgY2hvIGpvYiBmb2xsb3cKICAgICAgICBpZiBzdWNjZXNzIGFuZCBqb2JfdHlwZSBhbmQgam9iX3R5cGUubG93ZXIoKSA9PSAiZm9sbG93IjoKICAgICAgICAgICAgc2VsZi5fdXBkYXRlX2ZvbGxvd19zdGF0cyhhY2NvdW50KQogICAgICAgICAgICAKICAgIGRlZiBfdXBkYXRlX2Jhc2ljX2pvYl9zdGF0cyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgc3VjY2VzczogYm9vbCk6CiAgICAgICAgIiIiQ+G6rXAgbmjhuq10IHRo4buRbmcga8OqIGpvYiBjxqEgYuG6o24gLSBjaOG7iSDEkeG6v20gam9iIHRow6BuaCBjw7RuZyIiIgogICAgICAgIGpvYl90b2RheSA9IGFjY291bnQuZ2V0KCJqb2JfdG9kYXkiLCAwKQogICAgICAgIGpvYnNfZG9uZV9pbl9zZXNzaW9uID0gYWNjb3VudC5nZXQoImpvYnNfZG9uZV9pbl9zZXNzaW9uIiwgMCkKICAgICAgICAKICAgICAgICB1cGRhdGVfZGF0YSA9IHsKICAgICAgICAgICAgImxhc3Rfam9iX3RpbWUiOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgfQogICAgICAgIAogICAgICAgICMgQ2jhu4kgdMSDbmcgY291bnRlcnMga2hpIGpvYiB0aMOgbmggY8O0bmcKICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICB1cGRhdGVfZGF0YS51cGRhdGUoewogICAgICAgICAgICAgICAgImpvYl90b2RheSI6IGpvYl90b2RheSArIDEsCiAgICAgICAgICAgICAgICAiam9ic19kb25lX2luX3Nlc3Npb24iOiBqb2JzX2RvbmVfaW5fc2Vzc2lvbiArIDEsCiAgICAgICAgICAgICAgICAidG90YWxfam9icyI6IGFjY291bnQuZ2V0KCJ0b3RhbF9qb2JzIiwgMCkgKyAxCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgdXBkYXRlX2RhdGEpCiAgICAgICAgYWNjb3VudC51cGRhdGUodXBkYXRlX2RhdGEpICAjIEPhuq1wIG5o4bqtdCBsb2NhbCBkYXRhCiAgICAgICAgCiAgICBkZWYgX2NoZWNrX3Nlc3Npb25fbGltaXRfYWZ0ZXJfam9iKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKToKICAgICAgICAiIiJLaeG7g20gdHJhIGdp4bubaSBo4bqhbiBwaGnDqm4gc2F1IGtoaSBsw6BtIGpvYiIiIgogICAgICAgIGpvYnNfZG9uZV9pbl9zZXNzaW9uID0gYWNjb3VudC5nZXQoImpvYnNfZG9uZV9pbl9zZXNzaW9uIiwgMCkKICAgICAgICBtYXhfam9ic19wZXJfc2Vzc2lvbiA9IGFjY291bnQuZ2V0KCJtYXhfam9ic19wZXJfc2Vzc2lvbiIsIDApIG9yIGNvbmZpZy5NQVhfSk9CU19QRVJfU0VTU0lPTgogICAgICAgIHVzZXJuYW1lID0gYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICdVbmtub3duJykKICAgICAgICAKICAgICAgICBpZiBqb2JzX2RvbmVfaW5fc2Vzc2lvbiA+PSBtYXhfam9ic19wZXJfc2Vzc2lvbjoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge3VzZXJuYW1lfSDEkcOjIGzDoG0gxJHhu6cge21heF9qb2JzX3Blcl9zZXNzaW9ufSBqb2IgdHJvbmcgcGhpw6puIikKICAgICAgICAgICAgc2VsZi5kYi5zZXRfYWNjb3VudF9pbmFjdGl2ZShhY2NvdW50WyJpZCJdLCBpbmFjdGl2ZV9yZWFzb249IsSQw6MgaG/DoG4gdGjDoG5oIHPhu5Egam9iIHThu5FpIMSRYSB0cm9uZyBwaGnDqm4iKQogICAgICAgICAgICBzZWxmLl9jbG9zZV9hcHBfZm9yX2FjY291bnQoYWNjb3VudCkKICAgICAgICAgICAgCiAgICBkZWYgX2NoZWNrX2RhaWx5X2xpbWl0X2FmdGVyX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSk6CiAgICAgICAgIiIiS2nhu4NtIHRyYSBnaeG7m2kgaOG6oW4gaMOgbmcgbmfDoHkgc2F1IGtoaSBsw6BtIGpvYiIiIgogICAgICAgIGpvYl90b2RheSA9IGFjY291bnQuZ2V0KCJqb2JfdG9kYXkiLCAwKQogICAgICAgIGpvYl9tYXhfZGF5ID0gYWNjb3VudC5nZXQoImpvYl9tYXhfZGF5IiwgMCkgb3IgY29uZmlnLk1BWF9KT0JTX1BFUl9EQVkKICAgICAgICB1c2VybmFtZSA9IGFjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnVW5rbm93bicpCiAgICAgICAgCiAgICAgICAgaWYgam9iX3RvZGF5ID49IGpvYl9tYXhfZGF5OgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBqb2IgdHJvbmcgbmfDoHkgKHtqb2JfdG9kYXl9L3tqb2JfbWF4X2RheX0pIikKICAgICAgICAgICAgc2VsZi5kYi5zZXRfYWNjb3VudF9pbmFjdGl2ZV91bnRpbF9uZXh0X3Jlc2V0KGFjY291bnRbImlkIl0sICLEkMOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIGjDoG5nIG5nw6B5IikKICAgICAgICAgICAgc2VsZi5fY2xvc2VfYXBwX2Zvcl9hY2NvdW50KGFjY291bnQpCiAgICAgICAgICAgIAogICAgZGVmIF9zZXRfYWNjb3VudF9sb2dvdXQoc2VsZiwgYWNjb3VudF9pZDogaW50LCB1c2VybmFtZTogc3RyID0gTm9uZSkgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICDEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIMSRw6MgbG9nb3V0CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudF9pZDogSUQgY+G7p2EgdMOgaSBraG/huqNuCiAgICAgICAgICAgIHVzZXJuYW1lOiBVc2VybmFtZSDEkeG7gyBsb2cgKG9wdGlvbmFsKQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBU4bqhbyBtZXNzYWdlIHbhu5tpIG5nw6B5IGdp4budIGhp4buHbiB04bqhaQogICAgICAgICAgICBpbXBvcnQgZGF0ZXRpbWUKICAgICAgICAgICAgY3VycmVudF90aW1lID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVkLyVtLyVZICVIOiVNOiVTIikKICAgICAgICAgICAgbG9nb3V0X21lc3NhZ2UgPSBmIlBow6F0IGhp4buHbiBsb2dvdXQ6IHtjdXJyZW50X3RpbWV9IgogICAgICAgICAgICAKICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAic3RhdHVzIjogImxvZ291dCIsCiAgICAgICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogbG9nb3V0X21lc3NhZ2UsCiAgICAgICAgICAgICAgICAibGFzdF9qb2JfdGltZSI6IGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRfaWQsIHVwZGF0ZV9kYXRhKQogICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMSRw6FuaCBk4bqldSB0w6BpIGtob+G6o24ge3VzZXJuYW1lIG9yIGFjY291bnRfaWR9IGzDoCBsb2dvdXQiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIGxvZ291dCBjaG8gdMOgaSBraG/huqNuIHt1c2VybmFtZSBvciBhY2NvdW50X2lkfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSDEkcOhbmggZOG6pXUgdMOgaSBraG/huqNuIGxvZ291dDoge2V9IikKICAgICAgICAgICAgCiAgICBkZWYgX3VwZGF0ZV9mb2xsb3dfc3RhdHMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIkPhuq1wIG5o4bqtdCB0aOG7kW5nIGvDqiByacOqbmcgY2hvIGZvbGxvdyBqb2IgdGjDoG5oIGPDtG5nICjEkcOjIGLhu48gZ2nhu5tpIGjhuqFuIGZvbGxvdykiIiIKICAgICAgICB1c2VybmFtZSA9IGFjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnVW5rbm93bicpCiAgICAgICAgZm9sbG93X3RvZGF5ID0gYWNjb3VudC5nZXQoImZvbGxvd190b2RheSIsIDApICsgMQogICAgICAgIGZvbGxvd19pbl9zZXNzaW9uID0gYWNjb3VudC5nZXQoImZvbGxvd19pbl9zZXNzaW9uIiwgMCkgKyAxCiAgICAgICAgCiAgICAgICAgIyBD4bqtcCBuaOG6rXQgc+G7kSBsaeG7h3UgZm9sbG93IHRow6BuaCBjw7RuZwogICAgICAgIHVwZGF0ZV9mb2xsb3cgPSB7CiAgICAgICAgICAgICJmb2xsb3dfdG9kYXkiOiBmb2xsb3dfdG9kYXksCiAgICAgICAgICAgICJmb2xsb3dfaW5fc2Vzc2lvbiI6IGZvbGxvd19pbl9zZXNzaW9uLAogICAgICAgICAgICAibGFzdF9mb2xsb3dfdGltZSI6IGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICJkaXNhYmxlX2ZvbGxvdyI6IEZhbHNlLCAgIyBMdcO0biBsdcO0biDEkeG7gyBGYWxzZSB2w6wgxJHDoyBi4buPIGdp4bubaSBo4bqhbgogICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgfQogICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgdXBkYXRlX2ZvbGxvdykKICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IMSRw6MgdGjhu7FjIGhp4buHbiBmb2xsb3cgdGjDoG5oIGPDtG5nICh7Zm9sbG93X3RvZGF5fSBmb2xsb3cgaMO0bSBuYXkpIikKICAgICAgICAKICAgIGRlZiBzdGFydChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgxJHhu5luZyBKb2JTZXJ2aWNlIHRyb25nIHRocmVhZCByacOqbmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICB0aHJlYWRpbmcuVGhyZWFkOiBUaHJlYWQgxJFhbmcgY2jhuqF5IEpvYlNlcnZpY2UgaG/hurdjIE5vbmUgbuG6v3UgbOG7l2kKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhurd0IHRy4bqhbmcgdGjDoWkgcnVubmluZwogICAgICAgICAgICBzZWxmLnJ1bm5pbmcgPSBUcnVlCiAgICAgICAgICAgIHNlbGYuZm9yY2Vfc3RvcCA9IEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHRocmVhZAogICAgICAgICAgICB0aHJlYWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1zZWxmLnJ1bikKICAgICAgICAgICAgdGhyZWFkLmRhZW1vbiA9IFRydWUKICAgICAgICAgICAgdGhyZWFkLnN0YXJ0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB0aHJlYWQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraOG7n2kgxJHhu5luZyBKb2JTZXJ2aWNlIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICBkZWYgcmVzZXRfaW5hY3RpdmVfYWNjb3VudHMoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6Aga2jDtGkgcGjhu6VjIGPDoWMgdMOgaSBraG/huqNuIGluYWN0aXZlIMSRw6MgaOG6v3QgdGjhu51pIGdpYW4gY2jhu50KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB04bqldCBj4bqjIHTDoGkga2hv4bqjbiDhu58gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZQogICAgICAgICAgICBmb3IgYXBwX25hbWUgaW4gc2VsZi5lbmFibGVkX2FwcHM6CiAgICAgICAgICAgICAgICBpbmFjdGl2ZV9hY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1hcHBfbmFtZSwgc3RhdHVzPSJpbmFjdGl2ZSIpIG9yIFtdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGluYWN0aXZlX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgIGpvYl9kaXNhYmxlX3VudGlsID0gYWNjb3VudC5nZXQoImpvYl9kaXNhYmxlX3VudGlsIiwgMCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE7hur91IMSRw6MgaOG6v3QgdGjhu51pIGdpYW4gY2jhu50sIGNodXnhu4NuIHbhu4EgdHLhuqFuZyB0aMOhaSBhY3RpdmUKICAgICAgICAgICAgICAgICAgICBpZiBqb2JfZGlzYWJsZV91bnRpbCA8PSBjdXJyZW50X3RpbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgeyJzdGF0dXMiOiAiYWN0aXZlIiwgImlzX3N5bmMiOiBGYWxzZX0pCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IChJRDoge2FjY291bnRbJ2lkJ119KSDEkcOjIGjhur90IHRo4budaSBnaWFuIGNo4budLCDEkcOjIGNodXnhu4NuIHbhu4EgdHLhuqFuZyB0aMOhaSBhY3RpdmUiKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ19taW51dGVzID0gaW50KChqb2JfZGlzYWJsZV91bnRpbCAtIGN1cnJlbnRfdGltZSkgLyA2MCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IGPDsm4ge3JlbWFpbmluZ19taW51dGVzfSBwaMO6dCDhu58gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkga2nhu4NtIHRyYSB2w6Aga2jDtGkgcGjhu6VjIHTDoGkga2hv4bqjbiBpbmFjdGl2ZSIpCiAgICAgICAgICAgIAogICAgZGVmIHJlc2V0X2xvZ291dF9hY2NvdW50cyhzZWxmKToKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHbDoCByZXNldCBjw6FjIHTDoGkga2hv4bqjbiBsb2dvdXQgduG7gSBhY3RpdmUga2hpIGPhuqduIHRoaeG6v3QKICAgICAgICBDaOG7iSBuw6puIGfhu41pIG1ldGhvZCBuw6B5IGtoaSBjw7MgecOqdSBj4bqndSDEkeG6t2MgYmnhu4d0IHThu6sgYWRtaW4KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB04bqldCBj4bqjIHTDoGkga2hv4bqjbiDhu58gdHLhuqFuZyB0aMOhaSBsb2dvdXQKICAgICAgICAgICAgZm9yIGFwcF9uYW1lIGluIHNlbGYuZW5hYmxlZF9hcHBzOgogICAgICAgICAgICAgICAgbG9nb3V0X2FjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPWFwcF9uYW1lLCBzdGF0dXM9ImxvZ291dCIpIG9yIFtdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGxvZ291dF9hY2NvdW50czoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlJlc2V0IHTDoGkga2hv4bqjbiBsb2dvdXQge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gduG7gSB0cuG6oW5nIHRow6FpIGFjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiYWN0aXZlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9yZWFzb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgcmVzZXQgdMOgaSBraG/huqNuIGxvZ291dCIpCiAgICAKICAgIGRlZiBpc19hY2NvdW50X2Nhbl9ydW5fam9iKHNlbGYsIGFwcF9uYW1lOnN0ciApIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIGPDsyB0aOG7gyBjaOG6oXkgam9iIGtow7RuZwogICAgICAgICIiIgogICAgICAgIGFjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoYXBwPWFwcF9uYW1lKQogICAgICAgIGZvciBhY2NvdW50IGluIGFjY291bnRzOgogICAgICAgICAgICBpZihzZWxmLl9jYW5fcnVuX2pvYihhY2NvdW50KSk6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcnVuKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIENo4bqheSBKb2JTZXJ2aWNlIHRyb25nIG3hu5l0IHbDsm5nIGzhurdwIHbhu5tpIGxvZ2ljIGzDoG0gdmnhu4djIHRoZW8gcGhpw6puCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuaXNfaW5pdGlhbGl6ZWQ6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmluaXRpYWxpemUoKToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGto4bufaSB04bqhbyBKb2JTZXJ2aWNlLiBLaMO0bmcgdGjhu4MgY2jhuqF5LiIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbygiQuG6r3QgxJHhuqd1IGNo4bqheSBKb2JTZXJ2aWNlIHbhu5tpIGxvZ2ljIGzDoG0gdmnhu4djIHRoZW8gcGhpw6puLi4uIikKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgZGV2aWNlX2lkCiAgICAgICAgZGV2aWNlX2lkID0gc2VsZi5kYi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBkZXZpY2VfaWQ6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdGjhu4MgeMOhYyDEkeG7i25oIGRldmljZV9pZCBoaeG7h24gdOG6oWksIEpvYlNlcnZpY2Uga2jDtG5nIHRo4buDIGNo4bqheSIpCiAgICAgICAgICAgIHJldHVybgogCiAgICAgICAgd2hpbGUgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAjIFJlc2V0IGJp4bq/biBmb3JjZV9zdG9wIG7hur91IGPDswogICAgICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgICAgICBzZWxmLmZvcmNlX3N0b3AgPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHnDqnUgY+G6p3UgdOG6oW0gZOG7q25nIHThu6sgc2VydmVyCiAgICAgICAgICAgIGlmIHNlbGYuZGIuZ2V0KCJwYXVzZV9qb2IiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiQ8OzIHnDqnUgY+G6p3UgdOG6oW0gZOG7q25nIHThu6sgc2VydmVyLCB04bqhbSBk4burbmcgeOG7rSBsw70gam9iIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOaOG6oyBwcm94eSBuZ2F5IGtoaSBi4buLIHThuqFtIGThu6tuZyB04burIHNlcnZlcgogICAgICAgICAgICAgICAgdXNlX3Byb3h5ID0gc2VsZi5kYi5nZXQoInVzZV9wcm94eSIsIEZhbHNlKQogICAgICAgICAgICAgICAgaWYgdXNlX3Byb3h5IGFuZCBzZWxmLnByb3h5X3NlcnZpY2UuaXNfcHJveHlfYWN0aXZlKCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk5o4bqjIHByb3h5IGRvIGLhu4sgdOG6oW0gZOG7q25nIHThu6sgc2VydmVyIikKICAgICAgICAgICAgICAgICAgICBzZWxmLnByb3h5X3NlcnZpY2UudW5yZWdpc3Rlcl9wcm94eSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfaXNfd29ya2luZyIsIEZhbHNlKQogICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9tZXNzYWdlIiwgSm9iU2VydmljZUNvbnN0YW50cy5NU0dfREVWSUNFX1BBVVNFRF9TRVJWRVIpCiAgICAgICAgICAgICAgICBqb2JfY2hlY2tfaW50ZXJ2YWwgPSBzZWxmLmRiLmdldCgiam9iX2NoZWNrX2ludGVydmFsIiwgY29uZmlnLkpPQl9DSEVDS19JTlRFUlZBTCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoam9iX2NoZWNrX2ludGVydmFsKToKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBwaOG6o2kgZG8gZm9yY2VfcmVzdGFydF9zZXNzaW9uIGtow7RuZwogICAgICAgICAgICAgICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5mb3JjZV9yZXN0YXJ0X3Nlc3Npb246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE7hur91IGzDoCByZXN0YXJ0IHNlc3Npb24sIHRp4bq/cCB04bulYyB2w7JuZyBs4bq3cCB0aGF5IHbDrCBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyBwaOG6o2kgcmVzdGFydCBzZXNzaW9uIHRow6wgbeG7m2kgYnJlYWsKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgIyBSZXNldCBi4buZIMSR4bq/bSBow6BuZyBuZ8OgeSBu4bq/dSBj4bqnbgogICAgICAgICAgICBzZWxmLl9yZXNldF9kYWlseV9jb3VudGVycygpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgdsOgIGtow7RpIHBo4bulYyBjw6FjIHTDoGkga2hv4bqjbiBpbmFjdGl2ZSDEkcOjIGjhur90IHRo4budaSBnaWFuIGNo4budCiAgICAgICAgICAgIHNlbGYucmVzZXRfaW5hY3RpdmVfYWNjb3VudHMoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPhuq1wIG5o4bqtdCB04burIHNlcnZlciBxdWEgTVFUVAogICAgICAgICAgICBpZiBub3Qgc2VsZi5jaGVja19hbmRfaGFuZGxlX3NlcnZlcl91cGRhdGVzKCk6CiAgICAgICAgICAgICAgICAjIEPhuqduIHJlc3RhcnQgc2Vzc2lvbiBkbyBjb25maWcgdGhheSDEkeG7lWkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJSZXN0YXJ0IHNlc3Npb24gZG8gY29uZmlnIHRoYXkgxJHhu5VpIHThu6sgc2VydmVyIikKICAgICAgICAgICAgICAgICMgUmVzZXQgdGjhu51pIGdpYW4gY29vbGRvd24gxJHhu4MgYuG6r3QgxJHhuqd1IHNlc3Npb24gbmdheSBs4bqtcCB04bupYwogICAgICAgICAgICAgICAgd2l0aCBzZWxmLl9sb2NrOgogICAgICAgICAgICAgICAgICAgIHNlbGYucHJveHlfc2Vzc2lvbl9lbmRfdGltZSA9IDAKICAgICAgICAgICAgICAgICMgTmjhuqMgcHJveHkgbuG6v3UgxJFhbmcgc+G7rSBk4bulbmcKICAgICAgICAgICAgICAgIHVzZV9wcm94eSA9IHNlbGYuZGIuZ2V0KCJ1c2VfcHJveHkiLCBGYWxzZSkKICAgICAgICAgICAgICAgIGlmIHVzZV9wcm94eSBhbmQgc2VsZi5wcm94eV9zZXJ2aWNlLmlzX3Byb3h5X2FjdGl2ZSgpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJOaOG6oyBwcm94eSBkbyByZXN0YXJ0IHNlc3Npb24iKQogICAgICAgICAgICAgICAgICAgIHNlbGYucHJveHlfc2VydmljZS51bnJlZ2lzdGVyX3Byb3h5KCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlICAjIELhuq90IMSR4bqndSBs4bqhaSB04burIMSR4bqndSB2w7JuZyBs4bq3cAogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcgdHJvbmcgdGjhu51pIGdpYW4gbmdo4buJIGdp4buvYSBjw6FjIHBoacOqbiBraMO0bmcKICAgICAgICAgICAgICAgIGlmIHNlbGYuX2lzX2luX3Nlc3Npb25fY29vbGRvd24oKToKICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdfbWludXRlcyA9IGludCgoc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lIC0gaW50KHRpbWUudGltZSgpKSkgLyA2MCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCBmIntKb2JTZXJ2aWNlQ29uc3RhbnRzLk1TR19TRVNTSU9OX0NPT0xET1dOfSAoY8OybiB7cmVtYWluaW5nX21pbnV0ZXN9IHBow7p0KSIpCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIG3hu5dpIDUgZ2nDonkgxJHhu4MgY8OzIHRo4buDIHRob8OhdCBz4bubbSBraGkgY8OzIHnDqnUgY+G6p3UKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDUpOgogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBwaOG6o2kgZG8gZm9yY2VfcmVzdGFydF9zZXNzaW9uIGtow7RuZwogICAgICAgICAgICAgICAgICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmZvcmNlX3Jlc3RhcnRfc2Vzc2lvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE7hur91IGzDoCByZXN0YXJ0IHNlc3Npb24sIHRp4bq/cCB04bulYyB2w7JuZyBs4bq3cCB0aGF5IHbDrCBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHBo4bqjaSByZXN0YXJ0IHNlc3Npb24gdGjDrCBt4bubaSBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgxJDEg25nIGvDvSBwcm94eSBuZ2F5IG7hur91IMSRxrDhu6NjIGLhuq10IHbDoCBjaMawYSBhY3RpdmUKICAgICAgICAgICAgICAgIHVzZV9wcm94eSA9IHNlbGYuZGIuZ2V0KCJ1c2VfcHJveHkiLCBGYWxzZSkKICAgICAgICAgICAgICAgIGlmIHVzZV9wcm94eToKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5wcm94eV9zZXJ2aWNlLmlzX3Byb3h5X2FjdGl2ZSgpOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDEg25nIGvDvSBwcm94eSB0csaw4bubYyBraGkgYuG6r3QgxJHhuqd1IHBoacOqbiBsw6BtIHZp4buHYyIpCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5X3N1Y2Nlc3MgPSBzZWxmLnByb3h5X3NlcnZpY2UucmVnaXN0ZXJfcHJveHkoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcHJveHlfc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIMSRxINuZyBrw70gcHJveHksIG5naOG7iSAxMHMgdHLGsOG7m2Mga2hpIHRo4butIGzhuqFpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlByb3h5IMSRw6MgxJHGsOG7o2MgxJHEg25nIGvDvSwgdGnhur9wIHThu6VjIHBoacOqbiBsw6BtIHZp4buHYyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgRmV0Y2ggbOG6oWkgR29MaWtlIGhlYWRlcnMgc2F1IGtoaSDEkcOjIGPDsyBt4bqhbmcgKHByb3h5IGhv4bqhdCDEkeG7mW5nKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGdvbGlrZV9oZWFkZXJzID0gc2VsZi5nb2xpa2Vfc2VydmljZS5mZXRjaF9nb2xpa2VfaGVhZGVyc193aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ29saWtlX2hlYWRlcnM6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJHb0xpa2UgaGVhZGVycyBraMO0bmcgaOG7o3AgbOG7hyBob+G6t2Mga2jDtG5nIGZldGNoIMSRxrDhu6NjLCBuZ2jhu4kgNXMgdsOgIHRo4butIGzhuqFpIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCg1KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGZldGNoIEdvTGlrZSBoZWFkZXJzOiB7ZX0sIG5naOG7iSA1cyB2w6AgdGjhu60gbOG6oWkiKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoNSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHbDoCDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIHRyxrDhu5tjIHRpw6puCiAgICAgICAgICAgICAgICBlbmFibGVkX2FwcHMgPSBzZWxmLmRiLmdldCgiZW5hYmxlZF9hcHBzIiwgY29uZmlnLkVOQUJMRURfQVBQUykKICAgICAgICAgICAgICAgIGZvciBhcHBfbmFtZSBpbiBlbmFibGVkX2FwcHM6CiAgICAgICAgICAgICAgICAgICAgaWYgYXBwX25hbWUgaW4gc2VsZi5qb2JfaGFuZGxlcnMgYW5kIHNlbGYuX2NoZWNrX2FjY291bnRfc3luY19zdGF0dXMoYXBwX25hbWUpOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQ4buTbmcgYuG7mSB0w6BpIGtob+G6o24gY2hvIHthcHBfbmFtZX0uLi4iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zeW5jX2FjY291bnRzX2Zvcl9hcHAoYXBwX25hbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgdOG6pXQgY+G6oyB0w6BpIGtob+G6o24gY8OzIHRo4buDIGzDoG0gdmnhu4djIChzYXUga2hpIMSRw6MgxJHhu5NuZyBi4buZKQogICAgICAgICAgICAgICAgYWxsX3dvcmthYmxlX2FjY291bnRzID0gc2VsZi5fZ2V0X2FsbF93b3JrYWJsZV9hY2NvdW50cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBhbGxfd29ya2FibGVfYWNjb3VudHM6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIktow7RuZyBjw7MgdMOgaSBraG/huqNuIG7DoG8gc+G6tW4gc8OgbmcgbMOgbSB2aeG7h2MiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTmjhuqMgcHJveHkgbmdheSBu4bq/dSDEkWFuZyBz4butIGThu6VuZwogICAgICAgICAgICAgICAgICAgIHVzZV9wcm94eSA9IHNlbGYuZGIuZ2V0KCJ1c2VfcHJveHkiLCBGYWxzZSkKICAgICAgICAgICAgICAgICAgICBpZiB1c2VfcHJveHkgYW5kIHNlbGYucHJveHlfc2VydmljZS5pc19wcm94eV9hY3RpdmUoKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk5o4bqjIHByb3h5IGRvIGtow7RuZyBjw7MgdMOgaSBraG/huqNuIHPhurVuIHPDoG5nIGzDoG0gdmnhu4djIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wcm94eV9zZXJ2aWNlLnVucmVnaXN0ZXJfcHJveHkoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfaXNfd29ya2luZyIsIEZhbHNlKQogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsIEpvYlNlcnZpY2VDb25zdGFudHMuTVNHX0RFVklDRV9OT19BQ0NPVU5UUykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIELhuq90IMSR4bqndSBzZXNzaW9uIGNvb2xkb3duIHRoYXkgdsOsIHNsZWVwIG5n4bqvbgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJLaMO0bmcgY8OzIHTDoGkga2hv4bqjbiDEkeG7gyBsw6BtIHZp4buHYywgYuG6r3QgxJHhuqd1IG5naOG7iSBuZ8ahaSBuaMawIHNhdSBwaGnDqm4gbMOgbSB2aeG7h2MiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3N0YXJ0X3Nlc3Npb25fY29vbGRvd24oKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQuG6r3QgxJHhuqd1IHBoacOqbiBsw6BtIHZp4buHYyB24bubaSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiDEkcOjIHPhurVuIHPDoG5nCiAgICAgICAgICAgICAgICBzZWxmLl93b3JrX3Nlc3Npb24oYWxsX3dvcmthYmxlX2FjY291bnRzKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEdp4bqjaSBwaMOzbmcgcHJveHkgdsOgIGLhuq90IMSR4bqndSB0aOG7nWkgZ2lhbiBuZ2jhu4kKICAgICAgICAgICAgICAgIHVzZV9wcm94eSA9IHNlbGYuZGIuZ2V0KCJ1c2VfcHJveHkiLCBGYWxzZSkKICAgICAgICAgICAgICAgIGlmIHVzZV9wcm94eToKICAgICAgICAgICAgICAgICAgICBzZWxmLnByb3h5X3NlcnZpY2UucmVsZWFzZV9wcm94eV9hZnRlcl9zZXNzaW9uKCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuX3N0YXJ0X3Nlc3Npb25fY29vbGRvd24oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIHRyb25nIHbDsm5nIGzhurdwIGNow61uaCIpCiAgICAgICAgICAgICAgICAjIE5naOG7iSBt4buZdCBjaMO6dCB0csaw4bubYyBraGkgdGjhu60gbOG6oWkKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoMzApOgogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIHBo4bqjaSBkbyBmb3JjZV9yZXN0YXJ0X3Nlc3Npb24ga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgd2l0aCBzZWxmLl9sb2NrOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmZvcmNlX3Jlc3RhcnRfc2Vzc2lvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTuG6v3UgbMOgIHJlc3RhcnQgc2Vzc2lvbiwgdGnhur9wIHThu6VjIHbDsm5nIGzhurdwIHRoYXkgdsOsIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHBo4bqjaSByZXN0YXJ0IHNlc3Npb24gdGjDrCBt4bubaSBicmVhawogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgIGxvZ2dlci5lcnJvcigiSm9iU2VydmljZSDEkcOjIGThu6tuZyIpCiAgICAgICAgICAgIAogICAgZGVmIHN0b3Aoc2VsZik6CiAgICAgICAgIiIiROG7q25nIEpvYlNlcnZpY2UiIiIKICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQYW5nIGThu6tuZyBKb2JTZXJ2aWNlLi4uIikKICAgICAgICAKICAgIGRlZiBmb3JjZV9zdG9wX2FsbChzZWxmKToKICAgICAgICAiIiJE4burbmcgbmdheSBs4bqtcCB04bupYyB04bqldCBj4bqjIGPDoWMgaG/huqF0IMSR4buZbmciIiIKICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgIHNlbGYuZm9yY2Vfc3RvcCA9IFRydWUKICAgICAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBsb2dnZXIuaW5mbygiROG7q25nIG5nYXkgbOG6rXAgdOG7qWMgdOG6pXQgY+G6oyBjw6FjIGhv4bqhdCDEkeG7mW5nLi4uIikKCiAgICBkZWYgaGFuZGxlX21xdHRfYWNjb3VudF91cGRhdGUoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gY+G6rXAgbmjhuq10IGFjY291bnQgdOG7qyBNUVRUIHNlcnZlcgogICAgICAgIEFjY291bnQgc+G6vSDEkcaw4bujYyByZWxvYWQgc2F1IG3hu5dpIGpvYiB0cm9uZyBfd29ya19hY2NvdW50X3Nlc3Npb24KICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygiTmjhuq1uIMSRxrDhu6NjIHRow7RuZyBiw6FvIGPhuq1wIG5o4bqtdCBhY2NvdW50IHThu6sgc2VydmVyIHF1YSBNUVRUIikKICAgIAogICAgZGVmIGhhbmRsZV9tcXR0X2ZvcmNlX3N0YXJ0X3Nlc3Npb24oc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gecOqdSBj4bqndSBi4bqvdCDEkeG6p3Ugc2Vzc2lvbiBuZ2F5IGzhuq1wIHThu6ljIHThu6sgTVFUVCBzZXJ2ZXIKICAgICAgICBC4buPIHF1YSB0aOG7nWkgZ2lhbiBuZ2jhu4kgaGnhu4duIHThuqFpCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB5w6p1IGPhuqd1IGLhuq90IMSR4bqndSBzZXNzaW9uIG5nYXkgbOG6rXAgdOG7qWMgdOG7qyBzZXJ2ZXIgcXVhIE1RVFQiKQogICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgaWYgc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lID4gMDoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJC4buPIHF1YSB0aOG7nWkgZ2lhbiBuZ2jhu4kgdsOgIGLhuq90IMSR4bqndSBzZXNzaW9uIG5nYXkiKQogICAgICAgICAgICAgICAgc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lID0gMAogICAgICAgICAgICAKICAgIGRlZiBoYW5kbGVfbXF0dF9jb25maWdfdXBkYXRlKHNlbGYsIGNvbmZpZ19jaGFuZ2VzOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IGPhuq1wIG5o4bqtdCBjb25maWcgdOG7qyBNUVRUIHNlcnZlcgogICAgICAgIEtp4buDbSB0cmEgeGVtIGPDsyBj4bqnbiByZXN0YXJ0IHNlc3Npb24ga2jDtG5nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY29uZmlnX2NoYW5nZXM6IERpY3Rpb25hcnkgY2jhu6lhIGPDoWMgdGhheSDEkeG7lWkgY29uZmlnCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oIk5o4bqtbiDEkcaw4bujYyB0aMO0bmcgYsOhbyBj4bqtcCBuaOG6rXQgY29uZmlnIHThu6sgc2VydmVyIHF1YSBNUVRUIikKICAgICAgICAKICAgICAgICAjIEltcG9ydCBjb25maWcgxJHhu4MgbOG6pXkgZGFuaCBzw6FjaCByZXN0YXJ0IHJlcXVpcmVkIGNvbmZpZ3MKICAgICAgICBpbXBvcnQgY29uZmlnIGFzIGFwcF9jb25maWcKICAgICAgICByZXN0YXJ0X3JlcXVpcmVkX2NvbmZpZ3MgPSBnZXRhdHRyKGFwcF9jb25maWcsICdSRVNUQVJUX1JFUVVJUkVEX0NPTkZJR1MnLCBbCiAgICAgICAgICAgICJlbmFibGVkX2FwcHMiLCAibWF4X2pvYnNfcGVyX2RheSIsICJtYXhfam9ic19wZXJfc2Vzc2lvbiIsIAogICAgICAgICAgICAiam9iX2Nvb2xkb3duX21pbnV0ZXMiLCAidXNlX3Byb3h5IiwgInByb3h5X3NlcnZlciIsICJqb2JfaG91ciIKICAgICAgICBdKQogICAgICAgIAogICAgICAgIG5lZWRfcmVzdGFydCA9IEZhbHNlCiAgICAgICAgCiAgICAgICAgaWYgY29uZmlnX2NoYW5nZXM6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB04burbmcgY29uZmlnIGPDsyBj4bqnbiByZXN0YXJ0IGtow7RuZwogICAgICAgICAgICBmb3IgY29uZmlnX2tleSBpbiBjb25maWdfY2hhbmdlcy5rZXlzKCk6CiAgICAgICAgICAgICAgICBpZiBjb25maWdfa2V5IGluIHJlc3RhcnRfcmVxdWlyZWRfY29uZmlnczoKICAgICAgICAgICAgICAgICAgICBuZWVkX3Jlc3RhcnQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJDb25maWcge2NvbmZpZ19rZXl9IHRoYXkgxJHhu5VpLCBj4bqnbiByZXN0YXJ0IHNlc3Npb24iKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgY8OzIHRow7RuZyB0aW4gY2hpIHRp4bq/dCwgY29pIG5oxrAgY+G6p24gcmVzdGFydAogICAgICAgICAgICBuZWVkX3Jlc3RhcnQgPSBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGlmIG5lZWRfcmVzdGFydDoKICAgICAgICAgICAgd2l0aCBzZWxmLl9sb2NrOgogICAgICAgICAgICAgICAgc2VsZi5mb3JjZV9yZXN0YXJ0X3Nlc3Npb24gPSBUcnVlCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDhurd0IGZsYWcgcmVzdGFydCBzZXNzaW9uIGRvIGNvbmZpZyB0aGF5IMSR4buVaSIpCiAgICAgICAgICAgICAgICAKICAgIGRlZiBjaGVja19hbmRfaGFuZGxlX3NlcnZlcl91cGRhdGVzKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgdsOgIHjhu60gbMO9IGPDoWMgY+G6rXAgbmjhuq10IHThu6sgc2VydmVyCiAgICAgICAgxJDGsOG7o2MgZ+G7jWkgdHJvbmcgdsOybmcgbOG6t3AgY2jDrW5oIHbDoCB0cm9uZyBfd29ya19zZXNzaW9uCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBj4bqnbiB0aeG6v3AgdOG7pWMsIEZhbHNlIG7hur91IGPhuqduIHJlc3RhcnQgc2Vzc2lvbgogICAgICAgICIiIgogICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGZsYWcgcmVzdGFydCBzZXNzaW9uCiAgICAgICAgICAgIGlmIHNlbGYuZm9yY2VfcmVzdGFydF9zZXNzaW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiB5w6p1IGPhuqd1IHJlc3RhcnQgc2Vzc2lvbiBkbyBjb25maWcgdGhheSDEkeG7lWkiKQogICAgICAgICAgICAgICAgc2VsZi5mb3JjZV9yZXN0YXJ0X3Nlc3Npb24gPSBGYWxzZSAgIyBSZXNldCBmbGFnCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UgICMgQsOhbyBoaeG7h3UgY+G6p24gcmVzdGFydCBzZXNzaW9uCiAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gVHJ1ZSAgIyBUaeG6v3AgdOG7pWMgYsOsbmggdGjGsOG7nW5nCgogICAgZGVmIHNodXRkb3duKHNlbGYpOgogICAgICAgICIiIsSQw7NuZyBk4buLY2ggduG7pSwgZOG7q25nIHThuqV0IGPhuqMgd29ya2VyIHRocmVhZHMiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJE4burbmcgbmdheSBs4bqtcCB04bupYyB04bqldCBj4bqjIGPDoWMgaG/huqF0IMSR4buZbmcuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgZOG7q25nCiAgICAgICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYuZm9yY2Vfc3RvcCA9IFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU2h1dGRvd24gUHJveHlTZXJ2aWNlIChz4bq9IHThu7EgxJHhu5luZyB1bnJlZ2lzdGVyIHByb3h5IHbDoCBk4burbmcgdXBkYXRlIHRocmVhZCkKICAgICAgICAgICAgaWYgaGFzYXR0cihzZWxmLCAncHJveHlfc2VydmljZScpIGFuZCBzZWxmLnByb3h5X3NlcnZpY2U6CiAgICAgICAgICAgICAgICBzZWxmLnByb3h5X3NlcnZpY2Uuc2h1dGRvd24oKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOzbmcga+G6v3QgbuG7kWkgZGF0YWJhc2UgxJHhu4MgdHLDoW5oIGzhu5dpIHRocmVhZAogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdkYicpIGFuZCBzZWxmLmRiOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuY2xvc2UoKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSDEkcOzbmcga+G6v3QgbuG7kWkgZGF0YWJhc2U6IHtzdHIoZSl9IikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgc2h1dGRvd24gSm9iU2VydmljZSIpCiAgICAKICAgICMgPT09PT09PT09PT09PT09PT09PT0gUFJPWFkgQ09OVkVOSUVOQ0UgTUVUSE9EUyA9PT09PT09PT09PT09PT09PT09PQogICAgZGVmIHJlc2V0X2N1cnJlbnRfcHJveHlfaXAoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBSZXNldCBJUCBjaG8gcHJveHkgaGnhu4duIHThuqFpIChjw7MgdGjhu4MgZ+G7jWkgdHJvbmcgcXXDoSB0csOsbmggbMOgbSB2aeG7h2MpCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSByZXNldCB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLnByb3h5X3NlcnZpY2UuZm9yY2VfcmVzZXRfY3VycmVudF9pcCgpCiAgICAKICAgIGRlZiBnZXRfcHJveHlfc3RhdHVzKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0cuG6oW5nIHRow6FpIHByb3h5IGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVHLhuqFuZyB0aMOhaSBwcm94eQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLnByb3h5X3NlcnZpY2UuZ2V0X3Byb3h5X3N0YXR1cygpCiAgICAKICAgIGRlZiBnZXRfcHJveHlfaW5mbyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIHByb3h5IGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBUaMO0bmcgdGluIHByb3h5CiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYucHJveHlfc2VydmljZS5nZXRfcHJveHlfaW5mbygpCiAgICAKICAgICMgPT09PT09PT09PT09PT09PT09PT0gRU5EIFBST1hZIENPTlZFTklFTkNFIE1FVEhPRFMgPT09PT09PT09PT09PT09PT09PT0KICAgICAgICAgICAgCiAgICAjIERFUFJFQ0FURUQ6IEtow7RuZyBkw7luZyBu4buvYSwgdGhheSBi4bqxbmcgX2dldF9hbGxfd29ya2FibGVfYWNjb3VudHMoKQogICAgIyBkZWYgX2hhc19hY2NvdW50c19yZWFkeV9mb3Jfd29yayhzZWxmKSAtPiBib29sOgogICAgIyAgICAgIiIiCiAgICAjICAgICBLaeG7g20gdHJhIHhlbSBjw7MgdMOgaSBraG/huqNuIG7DoG8gc+G6tW4gc8OgbmcgbMOgbSB2aeG7h2Mga2jDtG5nCiAgICAjICAgICAKICAgICMgICAgIFJldHVybnM6CiAgICAjICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBjw7MgdMOgaSBraG/huqNuIGPDsyB0aOG7gyBsw6BtIHZp4buHYwogICAgIyAgICAgIiIiCiAgICAjICAgICBlbmFibGVkX2FwcHMgPSBzZWxmLmRiLmdldCgiZW5hYmxlZF9hcHBzIiwgY29uZmlnLkVOQUJMRURfQVBQUykKICAgICMgICAgIAogICAgIyAgICAgZm9yIGFwcF9uYW1lIGluIGVuYWJsZWRfYXBwczoKICAgICMgICAgICAgICBpZiBzZWxmLmlzX2FjY291bnRfY2FuX3J1bl9qb2IoYXBwX25hbWUpOgogICAgIyAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgIyAgICAgICAgICAgICAKICAgICMgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIF9nZXRfYWxsX3dvcmthYmxlX2FjY291bnRzKHNlbGYpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHThuqV0IGPhuqMgdMOgaSBraG/huqNuIGPDsyB0aOG7gyBsw6BtIHZp4buHYyB04burIHThuqV0IGPhuqMgYXBwIHbDoCBz4bqvcCB44bq/cCB0aGVvIGFwcCwgbmfDoHkgdOG6oW8KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHDoyDEkcaw4bujYyBz4bqvcCB44bq/cAogICAgICAgICIiIgogICAgICAgIGVuYWJsZWRfYXBwcyA9IHNlbGYuZGIuZ2V0KCJlbmFibGVkX2FwcHMiLCBjb25maWcuRU5BQkxFRF9BUFBTKQogICAgICAgIGFsbF93b3JrYWJsZV9hY2NvdW50cyA9IFtdCiAgICAgICAgCiAgICAgICAgZm9yIGFwcF9uYW1lIGluIGVuYWJsZWRfYXBwczoKICAgICAgICAgICAgYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9YXBwX25hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bq/bSBz4buRIGzGsOG7o25nIHTDoGkga2hv4bqjbiB0aGVvIHRy4bqhbmcgdGjDoWkKICAgICAgICAgICAgc3RhdHVzX2NvdW50cyA9IHt9CiAgICAgICAgICAgIGZvciBhY2MgaW4gYWNjb3VudHM6CiAgICAgICAgICAgICAgICBzdGF0dXMgPSBhY2MuZ2V0KCdzdGF0dXMnLCAnYWN0aXZlJykKICAgICAgICAgICAgICAgIHN0YXR1c19jb3VudHNbc3RhdHVzXSA9IHN0YXR1c19jb3VudHMuZ2V0KHN0YXR1cywgMCkgKyAxCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExvZyB0aOG7kW5nIGvDqiB0cuG6oW5nIHRow6FpCiAgICAgICAgICAgIHN0YXR1c19pbmZvID0gIiwgIi5qb2luKFtmIntzdGF0dXN9OiB7Y291bnR9IiBmb3Igc3RhdHVzLCBjb3VudCBpbiBzdGF0dXNfY291bnRzLml0ZW1zKCldKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7YXBwX25hbWV9IC0ge3N0YXR1c19pbmZvfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhu41jIGPDoWMgdMOgaSBraG/huqNuIGPDsyB0aOG7gyBsw6BtIHZp4buHYwogICAgICAgICAgICB3b3JrYWJsZV9hY2NvdW50cyA9IFthY2MgZm9yIGFjYyBpbiBhY2NvdW50cyBpZiBzZWxmLl9jYW5fcnVuX2pvYihhY2MpXQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgd29ya2FibGVfYWNjb3VudHM6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHtsZW4od29ya2FibGVfYWNjb3VudHMpfSB0w6BpIGtob+G6o24gY8OzIHRo4buDIGzDoG0gdmnhu4djIGNobyB7YXBwX25hbWV9IikKICAgICAgICAgICAgICAgIGFsbF93b3JrYWJsZV9hY2NvdW50cy5leHRlbmQod29ya2FibGVfYWNjb3VudHMpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIktow7RuZyBjw7MgdMOgaSBraG/huqNuIG7DoG8gY8OzIHRo4buDIGzDoG0gdmnhu4djIGNobyB7YXBwX25hbWV9IikKICAgICAgICAKICAgICAgICAjIFPhuq9wIHjhur9wIHRoZW86CiAgICAgICAgIyAxLiBBcHAgbmFtZSAoxJHhu4MgbmjDs20gY8O5bmcgYXBwIGzhuqFpIHbhu5tpIG5oYXUpCiAgICAgICAgIyAyLiBOZ8OgeSB04bqhbyB0w6BpIGtob+G6o24gKGNyZWF0ZWRfYXQpIC0gY8WpIG5o4bqldCB0csaw4bubYwogICAgICAgICMgMy4gU+G7kSBqb2IgxJHDoyBsw6BtIHRyb25nIHBoacOqbiAow610IG5o4bqldCB0csaw4bubYykKICAgICAgICBhbGxfd29ya2FibGVfYWNjb3VudHMuc29ydChrZXk9bGFtYmRhIHg6ICgKICAgICAgICAgICAgeC5nZXQoImFwcCIsICIiKSwKICAgICAgICAgICAgeC5nZXQoImNyZWF0ZWRfYXQiLCAwKSwKICAgICAgICAgICAgeC5nZXQoImpvYnNfZG9uZV9pbl9zZXNzaW9uIiwgMCkKICAgICAgICApKQogICAgICAgIAogICAgICAgIHJldHVybiBhbGxfd29ya2FibGVfYWNjb3VudHMKICAgICAgICAKICAgIGRlZiBfd29ya19zZXNzaW9uKHNlbGYsIGFsbF93b3JrYWJsZV9hY2NvdW50czogTGlzdFtEaWN0W3N0ciwgQW55XV0gPSBOb25lKToKICAgICAgICAiIiJUaOG7sWMgaGnhu4duIG3hu5l0IHBoacOqbiBsw6BtIHZp4buHYyBob8OgbiBjaOG7iW5oIHbhu5tpIGPGoSBjaOG6vyBt4bubaSIiIgogICAgICAgIGxvZ2dlci5pbmZvKCJC4bqvdCDEkeG6p3UgcGhpw6puIGzDoG0gdmnhu4djIikKICAgICAgICAKICAgICAgICAjIMSQw6FuaCBk4bqldSDEkWFuZyB0cm9uZyBwaGnDqm4gbMOgbSB2aeG7h2MKICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX2lzX3dvcmtpbmciLCBUcnVlKQogICAgICAgIHNlbGYuZGIuc2V0KCJkZXZpY2VfbWVzc2FnZSIsIEpvYlNlcnZpY2VDb25zdGFudHMuTVNHX1dPUktJTkdfU0VTU0lPTikKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHRydXnhu4FuIGRhbmggc8OhY2ggdMOgaSBraG/huqNuLCBs4bqleSBs4bqhaSB04burIGRhdGFiYXNlCiAgICAgICAgICAgIGlmIGFsbF93b3JrYWJsZV9hY2NvdW50cyBpcyBOb25lOgogICAgICAgICAgICAgICAgYWxsX3dvcmthYmxlX2FjY291bnRzID0gc2VsZi5fZ2V0X2FsbF93b3JrYWJsZV9hY2NvdW50cygpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgYWxsX3dvcmthYmxlX2FjY291bnRzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIktow7RuZyBjw7MgdMOgaSBraG/huqNuIG7DoG8gc+G6tW4gc8OgbmcgbMOgbSB2aeG7h2MiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB7bGVuKGFsbF93b3JrYWJsZV9hY2NvdW50cyl9IHTDoGkga2hv4bqjbiBz4bq1biBzw6BuZyBsw6BtIHZp4buHYyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzDoG0gdmnhu4djIHR14bqnbiB04buxIHbhu5tpIHThu6tuZyB0w6BpIGtob+G6o24KICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gYWxsX3dvcmthYmxlX2FjY291bnRzOgogICAgICAgICAgICAgICAgd2l0aCBzZWxmLl9sb2NrOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuZm9yY2Vfc3RvcCBvciBub3Qgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgecOqdSBj4bqndSB04bqhbSBk4burbmcgdOG7qyBzZXJ2ZXIKICAgICAgICAgICAgICAgIGlmIHNlbGYuZGIuZ2V0KCJwYXVzZV9qb2IiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiB5w6p1IGPhuqd1IHThuqFtIGThu6tuZyB04burIHNlcnZlciB0cm9uZyBwaGnDqm4gbMOgbSB2aeG7h2MiKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBj4bqtcCBuaOG6rXQgY29uZmlnIHThu6sgc2VydmVyCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5jaGVja19hbmRfaGFuZGxlX3NlcnZlcl91cGRhdGVzKCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiB5w6p1IGPhuqd1IHJlc3RhcnQgc2Vzc2lvbiBkbyBjb25maWcgdGhheSDEkeG7lWkgdHJvbmcgcGhpw6puIGzDoG0gdmnhu4djIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gICMgVGhvw6F0IGto4buPaSBfd29ya19zZXNzaW9uIMSR4buDIHJlc3RhcnQgdOG7qyBydW4oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gdMOgaSBraG/huqNuIG3hu5tpIG5o4bqldCB04burIGRhdGFiYXNlCiAgICAgICAgICAgICAgICBhY2NvdW50ID0gc2VsZi5kYi5nZXRfYWNjb3VudChhY2NvdW50WyJpZCJdKQogICAgICAgICAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB4ZW0gdMOgaSBraG/huqNuIGPDsyB0aOG7gyBsw6BtIHZp4buHYyBraMO0bmcKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9jYW5fcnVuX2pvYihhY2NvdW50KToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhcHBfbmFtZSA9IGFjY291bnQuZ2V0KCJhcHAiKQogICAgICAgICAgICAgICAgaWYgYXBwX25hbWUgbm90IGluIHNlbGYuam9iX2hhbmRsZXJzOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHTDrG0gdGjhuqV5IGpvYiBoYW5kbGVyIGNobyB7YXBwX25hbWV9LCBi4buPIHF1YSB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0iKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2w6AgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiBu4bq/dSBzZXJ2ZXIgecOqdSBj4bqndQogICAgICAgICAgICAgICAgaWYgc2VsZi5fY2hlY2tfYWNjb3VudF9zeW5jX3N0YXR1cyhhcHBfbmFtZSk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJTZXJ2ZXIgecOqdSBj4bqndSDEkeG7k25nIGLhu5kgbOG6oWkgdMOgaSBraG/huqNuIGNobyB7YXBwX25hbWV9Li4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLl9zeW5jX2FjY291bnRzX2Zvcl9hcHAoYXBwX25hbWUpCiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBs4bqhaSB0aMO0bmcgdGluIHTDoGkga2hv4bqjbiBzYXUga2hpIMSR4buTbmcgYuG7mQogICAgICAgICAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50KGFjY291bnRbImlkIl0pCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFjY291bnQgb3Igbm90IHNlbGYuX2Nhbl9ydW5fam9iKGFjY291bnQpOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzhuqV5IGhhbmRsZXIgdHLGsOG7m2Mga2hpIHPhu60gZOG7pW5nCiAgICAgICAgICAgICAgICBoYW5kbGVyID0gc2VsZi5qb2JfaGFuZGxlcnNbYXBwX25hbWVdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2w6AgxJHhuqNtIGLhuqNvIHByb3h5IGhv4bqhdCDEkeG7mW5nIHRyxrDhu5tjIGtoaSBsw6BtIHZp4buHYyB24bubaSB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIHVzZV9wcm94eSA9IHNlbGYuZGIuZ2V0KCJ1c2VfcHJveHkiLCBGYWxzZSkKICAgICAgICAgICAgICAgIGlmIHVzZV9wcm94eToKICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGFjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnVW5rbm93bicpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaeG7g20gdHJhIHByb3h5IHRyxrDhu5tjIGtoaSBsw6BtIHZp4buHYyB24bubaSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBWw7JuZyBs4bq3cCBjaOG7nSBwcm94eSBob+G6oXQgxJHhu5luZyAodOG7kWkgxJFhIDUgbOG6p24gdGjhu60pCiAgICAgICAgICAgICAgICAgICAgcHJveHlfYXR0ZW1wdHMgPSAwCiAgICAgICAgICAgICAgICAgICAgbWF4X3Byb3h5X2F0dGVtcHRzID0gNTAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB3aGlsZSBwcm94eV9hdHRlbXB0cyA8IG1heF9wcm94eV9hdHRlbXB0czoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5wcm94eV9zZXJ2aWNlLmlzX3Byb3h5X2FjdGl2ZSgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQcm94eSDEkcOjIGhv4bqhdCDEkeG7mW5nIGNobyB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcHJveHlfYXR0ZW1wdHMgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlByb3h5IGNoxrBhIGhv4bqhdCDEkeG7mW5nIGNobyB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSwgdGjhu60gxJHEg25nIGvDvSBs4bqhaSAobOG6p24ge3Byb3h5X2F0dGVtcHRzfS97bWF4X3Byb3h5X2F0dGVtcHRzfSkiKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7rSDEkcSDbmcga8O9IHByb3h5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYucHJveHlfc2VydmljZS5yZWdpc3Rlcl9wcm94eSgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMSDbmcga8O9IHByb3h5IHRow6BuaCBjw7RuZyBjaG8gdMOgaSBraG/huqNuIHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIsSQxINuZyBrw70gcHJveHkgdGjhuqV0IGLhuqFpIGNobyB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSAobOG6p24ge3Byb3h5X2F0dGVtcHRzfSkiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE7hur91IGNoxrBhIMSR4bq/biBs4bqnbiBjdeG7kWksIG5naOG7iSAxMHMgdHLGsOG7m2Mga2hpIHRo4butIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwcm94eV9hdHRlbXB0cyA8IG1heF9wcm94eV9hdHRlbXB0czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5naOG7iSAxMHMgdHLGsOG7m2Mga2hpIHRo4butIMSRxINuZyBrw70gcHJveHkgbOG6oWkgY2hvIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zYWZlX3NsZWVwKDEwKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICAjIFRob8OhdCBu4bq/dSBi4buLIG5n4bqvdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlICAjIFRo4butIGzhuqFpIHbDsm5nIGzhurdwIHByb3h5CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGN14buRaSBjw7luZyB4ZW0gcHJveHkgY8OzIGhv4bqhdCDEkeG7mW5nIGtow7RuZwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnByb3h5X3NlcnZpY2UuaXNfcHJveHlfYWN0aXZlKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyDEkcSDbmcga8O9IHByb3h5IHNhdSB7bWF4X3Byb3h5X2F0dGVtcHRzfSBs4bqnbiB0aOG7rSwgYuG7jyBxdWEgdMOgaSBraG/huqNuIHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgxJHDoyBjw7MgcHJveHkgaG/huqF0IMSR4buZbmcsIMSRw7NuZyBhcHAgdsOgIHJlc2V0IElQCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOzbmcgYXBwIHbDoCByZXNldCBJUCB0csaw4bubYyBraGkgbMOgbSB2aeG7h2MgduG7m2kgdMOgaSBraG/huqNuIHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgxJDDs25nIGFwcCB0csaw4bubYyBraGkgcmVzZXQgSVAKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmNsb3NlX2FwcCgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBSZXNldCBJUAogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYucHJveHlfc2VydmljZS5mb3JjZV9yZXNldF9jdXJyZW50X2lwKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiUmVzZXQgSVAgdGjDoG5oIGPDtG5nIGNobyB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKSAgIyBDaOG7nSBJUCBt4bubaSDhu5VuIMSR4buLbmgKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlJlc2V0IElQIHRo4bqldCBi4bqhaSBjaG8gdMOgaSBraG/huqNuIHt1c2VybmFtZX0sIHRp4bq/cCB04bulYyB24bubaSBJUCBoaeG7h24gdOG6oWkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzDoG0gdmnhu4djIHbhu5tpIHTDoGkga2hv4bqjbiBuw6B5CiAgICAgICAgICAgICAgICBhY2NvdW50X3Jlc3VsdCA9IHNlbGYuX3dvcmtfYWNjb3VudF9zZXNzaW9uKGFjY291bnQsIGhhbmRsZXIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgxJDDs25nIGFwcCBzYXUga2hpIGzDoG0geG9uZyB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIGhhbmRsZXIuY2xvc2VfYXBwKCkKCiAgICAgICAgICAgICAgICAjIE7hur91IGLhu4sgZ2nDoW4gxJFv4bqhbiwgZOG7q25nIHBoacOqbgogICAgICAgICAgICAgICAgaWYgbm90IGFjY291bnRfcmVzdWx0OgogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICAgICAgIyBMw6BtIGNoxINtIHPDs2Mgc2F1IGtoaSBo4bq/dCBqb2IgKG7hur91IMSRxrDhu6NjIGLhuq10KQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNhcmVfaW5fd29ya2luZ19qb2IgPSBzZWxmLmRiLmdldCgiY2FyZV9pbl93b3JraW5nX2pvYiIsIEZhbHNlKQogICAgICAgICAgICAgICAgICAgIGlmIGNhcmVfaW5fd29ya2luZ19qb2IgYW5kIGhhc2F0dHIoaGFuZGxlciwgInBlcmZvcm1fY2FyZSIpIGFuZCBjYWxsYWJsZShoYW5kbGVyLnBlcmZvcm1fY2FyZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVGjhu7FjIGhp4buHbiBjaMSDbSBzw7NjIGNobyB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0iKQogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLnBlcmZvcm1fY2FyZShhY2NvdW50KQogICAgICAgICAgICAgICAgICAgIGVsaWYgbm90IGNhcmVfaW5fd29ya2luZ19qb2I6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkNoxINtIHPDs2MgYuG7iyB04bqvdCwgYuG7jyBxdWEgY2jEg20gc8OzYyBjaG8gdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBjaMSDbSBzw7NjIHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfToge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmdo4buJIG5n4bqvbiBnaeG7r2EgY8OhYyB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIGNvb2xkb3duID0gZ2V0YXR0cihjb25maWcsICJqb2JfY2hlY2tfaW50ZXJ2YWwiLCAyNSkKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoY29vbGRvd24pOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSB0cm9uZyBwaGnDqm4gbMOgbSB2aeG7h2MiKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IGvhur90IHRow7pjIHBoacOqbiBsw6BtIHZp4buHYwogICAgICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX2lzX3dvcmtpbmciLCBGYWxzZSkKICAgICAgICAgIAogICAgZGVmIF93b3JrX2FjY291bnRfc2Vzc2lvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgaGFuZGxlcikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBMw6BtIHZp4buHYyB24bubaSBt4buZdCB0w6BpIGtob+G6o24gdHJvbmcgcGhpw6puCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgaGFuZGxlcjogSm9iIGhhbmRsZXIKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBob8OgbiB0aMOgbmgsIEZhbHNlIG7hur91IGLhu4sgZ2nDoW4gxJFv4bqhbgogICAgICAgICIiIgogICAgICAgIHVzZXJuYW1lID0gYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICdVbmtub3duJykKICAgICAgICBqb2JzX2RvbmUgPSAwCiAgICAgICAgY2FyZV9jb3VudGVyID0gMAogICAgICAgIGNvbmZpZ19yZWxvYWRfY291bnRlciA9IDAgICMgxJDhur9tIMSR4buDIHJlbG9hZCBj4bqldSBow6xuaCDEkeG7i25oIGvhu7MKICAgICAgICBub19qb2JfY291bnQgPSAwICAjIMSQ4bq/bSBz4buRIGzhuqduIGtow7RuZyBs4bqleSDEkcaw4bujYyBqb2IgbGnDqm4gdGnhur9wCiAgICAgICAgbWF4X25vX2pvYl9hdHRlbXB0cyA9IDMgICMgU+G7kSBs4bqnbiB04buRaSDEkWEgdGjhu60gbOG6pXkgam9iIGtoaSBraMO0bmcgY8OzCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiJMw6BtIHZp4buHYyB24bubaSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSIpCiAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiBzYW5nIHTDoGkga2hv4bqjbiBuw6B5CiAgICAgICAgc3dpdGNoX3Jlc3VsdCA9IGhhbmRsZXIuc3dpdGNoX3RvX2FjY291bnQoYWNjb3VudCkKICAgICAgICBpZiBub3Qgc3dpdGNoX3Jlc3VsdDoKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGNodXnhu4NuIHNhbmcgdMOgaSBraG/huqNuIHt1c2VybmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIMSRw6MgbG9nb3V0IGtoaSBraMO0bmcgdGjhu4MgY2h1eeG7g24gxJHGsOG7o2MKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJUw6BpIGtob+G6o24ge3VzZXJuYW1lfSBraMO0bmcgdGjhu4MgY2h1eeG7g24gxJHGsOG7o2MsIMSRw6FuaCBk4bqldSBsb2dvdXQiKQogICAgICAgICAgICAjIFThuqFvIG1lc3NhZ2UgduG7m2kgbmfDoHkgZ2nhu50gaGnhu4duIHThuqFpCiAgICAgICAgICAgIGltcG9ydCBkYXRldGltZQogICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBkYXRldGltZS5kYXRldGltZS5ub3coKS5zdHJmdGltZSgiJWQvJW0vJVkgJUg6JU06JVMiKQogICAgICAgICAgICBsb2dvdXRfbWVzc2FnZSA9IGYiUGjDoXQgaGnhu4duIGxvZ291dDoge2N1cnJlbnRfdGltZX0iCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHsKICAgICAgICAgICAgICAgICJzdGF0dXMiOiAibG9nb3V0IiwKICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9yZWFzb24iOiBsb2dvdXRfbWVzc2FnZSwKICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmV0dXJuIFRydWUgICMgUmV0dXJuIFRydWUgxJHhu4MgdGnhur9wIHThu6VjIHbhu5tpIHTDoGkga2hv4bqjbiB0aeG6v3AgdGhlbwogICAgICAgIAogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHdpdGggc2VsZi5fbG9jazoKICAgICAgICAgICAgICAgIGlmIHNlbGYuZm9yY2Vfc3RvcCBvciBub3Qgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMdcO0biByZWxvYWQgYWNjb3VudCDhu58gxJHhuqd1IHbDsm5nIGzhurdwIMSR4buDIMSR4bqjbSBi4bqjbyBk4buvIGxp4buHdSBt4bubaSBuaOG6pXQgdOG7qyBzZXJ2ZXIKICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnQoYWNjb3VudFsiaWQiXSkKICAgICAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSBzYXUga2hpIHJlbG9hZCwgZOG7q25nIHNlc3Npb24iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB4ZW0gdMOgaSBraG/huqNuIGPDsyB0aOG7gyBjaOG6oXkgam9iIGtow7RuZyBzYXUga2hpIHJlbG9hZAogICAgICAgICAgICBpZiBub3Qgc2VsZi5fY2FuX3J1bl9qb2IoYWNjb3VudCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IGtow7RuZyB0aOG7gyBjaOG6oXkgam9iIG7hu69hIHNhdSBraGkgcmVsb2FkIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB5w6p1IGPhuqd1IHThuqFtIGThu6tuZyB04burIHNlcnZlcgogICAgICAgICAgICBpZiBzZWxmLmRiLmdldCgicGF1c2Vfam9iIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQaMOhdCBoaeG7h24gecOqdSBj4bqndSB04bqhbSBk4burbmcgdOG7qyBzZXJ2ZXIga2hpIGzDoG0gdmnhu4djIHbhu5tpIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBj4bqtcCBuaOG6rXQgY29uZmlnIHThu6sgc2VydmVyCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmNoZWNrX2FuZF9oYW5kbGVfc2VydmVyX3VwZGF0ZXMoKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiUGjDoXQgaGnhu4duIHnDqnUgY+G6p3UgcmVzdGFydCBzZXNzaW9uIGRvIGNvbmZpZyB0aGF5IMSR4buVaSBraGkgbMOgbSB2aeG7h2MgduG7m2kgdMOgaSBraG/huqNuIHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlICAjIFRob8OhdCDEkeG7gyByZXN0YXJ0IHNlc3Npb24gICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGdp4bubaSBo4bqhbiBwaGnDqm4gaGnhu4duIHThuqFpCiAgICAgICAgICAgIG1heF9qb2JzX3Blcl9zZXNzaW9uID0gYWNjb3VudC5nZXQoIm1heF9qb2JzX3Blcl9zZXNzaW9uIiwgMCkgb3IgY29uZmlnLk1BWF9KT0JTX1BFUl9TRVNTSU9OCiAgICAgICAgICAgIGpvYnNfZG9uZV9pbl9zZXNzaW9uID0gYWNjb3VudC5nZXQoImpvYnNfZG9uZV9pbl9zZXNzaW9uIiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGpvYnNfZG9uZV9pbl9zZXNzaW9uID49IG1heF9qb2JzX3Blcl9zZXNzaW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge3VzZXJuYW1lfSDEkcOjIGhvw6BuIHRow6BuaCDEkeG7pyBqb2IgdHJvbmcgcGhpw6puICh7am9ic19kb25lX2luX3Nlc3Npb259L3ttYXhfam9ic19wZXJfc2Vzc2lvbn0pIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSBqb2IKICAgICAgICAgICAgICAgIGpvYiA9IGhhbmRsZXIuZmV0Y2hfam9iKGFjY291bnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBqb2I6CiAgICAgICAgICAgICAgICAgICAgbm9fam9iX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIktow7RuZyBjw7Mgam9iIGNobyB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSAobOG6p24ge25vX2pvYl9jb3VudH0ve21heF9ub19qb2JfYXR0ZW1wdHN9KSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgbOG6pXkgxJHGsOG7o2Mgam9iIHF1w6Egbmhp4buBdSBs4bqnbiwgZOG7q25nIHBoacOqbiBsw6BtIHZp4buHYwogICAgICAgICAgICAgICAgICAgIGlmIG5vX2pvYl9jb3VudCA+PSBtYXhfbm9fam9iX2F0dGVtcHRzOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IGtow7RuZyBs4bqleSDEkcaw4bujYyBqb2Igc2F1IHttYXhfbm9fam9iX2F0dGVtcHRzfSBs4bqnbiB0aOG7rSwgZOG7q25nIHBoacOqbiBsw6BtIHZp4buHYyIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBOZ2jhu4kgbeG7mXQgY2jDunQgdHLGsOG7m2Mga2hpIHRo4butIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcChyYW5kb20ucmFuZGludCgxMCwgMjApKToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBSZXNldCBjb3VudGVyIGtoaSBs4bqleSDEkcaw4bujYyBqb2IKICAgICAgICAgICAgICAgIG5vX2pvYl9jb3VudCA9IDAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGRldmljZSBtZXNzYWdlCiAgICAgICAgICAgICAgICBsaW5rID0gam9iLmdldCgnbGluaycsICcnKQogICAgICAgICAgICAgICAgaWYgbGluay5zdGFydHN3aXRoKCdodHRwczovL3d3dy5pbnN0YWdyYW0uY29tLycpOgogICAgICAgICAgICAgICAgICAgIGxpbmsgPSBsaW5rLnJlcGxhY2UoJ2h0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vJywgJycpCiAgICAgICAgICAgICAgICBlbGlmIGxpbmsuc3RhcnRzd2l0aCgnaHR0cHM6Ly93d3cudGlrdG9rLmNvbS8nKToKICAgICAgICAgICAgICAgICAgICBsaW5rID0gbGluay5yZXBsYWNlKCdodHRwczovL3d3dy50aWt0b2suY29tLycsICcnKQogICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImRldmljZV9tZXNzYWdlIiwgZiJbe2FjY291bnQuZ2V0KCdhcHAnKX1dW3t1c2VybmFtZX1dW3tqb2IuZ2V0KCd0eXBlJyl9XVt7bGlua31dIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBWYWxpZGF0ZSBqb2IKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fcmVzdWx0ID0gaGFuZGxlci52YWxpZGF0ZV9qb2JfYmVmb3JlX2V4ZWN1dGlvbihhY2NvdW50LCBqb2IpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCB2YWxpZGF0aW9uX3Jlc3VsdC5nZXQoInZhbGlkIiwgVHJ1ZSk6CiAgICAgICAgICAgICAgICAgICAgaWYgdmFsaWRhdGlvbl9yZXN1bHQuZ2V0KCJzaG91bGRfc2tpcCIsIEZhbHNlKToKICAgICAgICAgICAgICAgICAgICAgICAgIyBTa2lwIGpvYgogICAgICAgICAgICAgICAgICAgICAgICBza2lwX21lc3NhZ2UgPSB2YWxpZGF0aW9uX3Jlc3VsdC5nZXQoIm1lc3NhZ2UiLCAiSm9iIGtow7RuZyBo4bujcCBs4buHIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJTa2lwIGpvYjoge3NraXBfbWVzc2FnZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5yZWNvcmRfam9iX2hpc3RvcnkoYWNjb3VudCwgam9iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IDIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIjogc2tpcF9tZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5za2lwX2pvYihhY2NvdW50LCBqb2IpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiU2tpcCBqb2IgbOG7l2k6IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEdpw6NuIHRo4budaSBnaWFuIHNhdSBraGkgc2tpcCBqb2IgxJHhu4MgdHLDoW5oIHNwYW0gbOG6pXkvaOG7p3kgam9iIGxpw6puIHThu6VjCiAgICAgICAgICAgICAgICAgICAgICAgIHNraXBfc2xlZXBfdGltZSA9IHJhbmRvbS5yYW5kaW50KDMsIDEwKQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5naOG7iSB7c2tpcF9zbGVlcF90aW1lfXMgc2F1IGtoaSBza2lwIGpvYiDEkeG7gyB0csOhbmggc3BhbSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoc2tpcF9zbGVlcF90aW1lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiSm9iIGtow7RuZyBo4bujcCBs4buHOiB7dmFsaWRhdGlvbl9yZXN1bHQuZ2V0KCdtZXNzYWdlJywgJ1Vua25vd24gZXJyb3InKX0iKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBqb2IKICAgICAgICAgICAgICAgIGpvYl9yZXN1bHQgPSBoYW5kbGVyLmV4ZWN1dGVfam9iKGFjY291bnQsIGpvYikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBY4butIGzDvSBr4bq/dCBxdeG6owogICAgICAgICAgICAgICAgam9iX3N0YXR1cyA9IGpvYl9yZXN1bHRbInN0YXR1cyJdCiAgICAgICAgICAgICAgICBqb2Jfc3VjY2VzcyA9IGpvYl9yZXN1bHRbInN1Y2Nlc3MiXQogICAgICAgICAgICAgICAgam9iX21lc3NhZ2UgPSBqb2JfcmVzdWx0WyJtZXNzYWdlIl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBY4butIGzDvSBs4buXaSBmb2xsb3cgcGVuZGluZwogICAgICAgICAgICAgICAgaWYgam9iX3N0YXR1cyA9PSA0IGFuZCBqb2IuZ2V0KCJ0eXBlIiwgIiIpLmxvd2VyKCkgPT0gImZvbGxvdyI6CiAgICAgICAgICAgICAgICAgICAgY250ID0gc2VsZi5mb2xsb3dfcGVuZGluZ19jb3VudHMuZ2V0KGFjY291bnRbImlkIl0sIDApICsgMQogICAgICAgICAgICAgICAgICAgIHNlbGYuZm9sbG93X3BlbmRpbmdfY291bnRzW2FjY291bnRbImlkIl1dID0gY250CiAgICAgICAgICAgICAgICAgICAgaWYgY250ID49IDU6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiVMOgaSBraG/huqNuIHt1c2VybmFtZX0gxJHDoyA1IGzhuqduIGxpw6puIHRp4bq/cCBmb2xsb3cgcGVuZGluZywgdOG6oW0gZOG7q25nIHTDoGkga2hv4bqjbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0X2FjY291bnRfaW5hY3RpdmUoYWNjb3VudFsiaWQiXSwgaW5hY3RpdmVfcmVhc29uPSJMacOqbiB0aeG6v3AgbOG7l2kgZm9sbG93IHBlbmRpbmciKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZvbGxvd19wZW5kaW5nX2NvdW50c1thY2NvdW50WyJpZCJdXSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsaWYgam9iLmdldCgidHlwZSIsICIiKS5sb3dlcigpID09ICJmb2xsb3ciOgogICAgICAgICAgICAgICAgICAgIHNlbGYuZm9sbG93X3BlbmRpbmdfY291bnRzW2FjY291bnRbImlkIl1dID0gMAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBCw6FvIGPDoW8ga+G6v3QgcXXhuqMKICAgICAgICAgICAgICAgIGhhbmRsZXIucmVwb3J0X2pvYihhY2NvdW50LCBqb2IsIGpvYl9yZXN1bHQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRo4buRbmcga8OqCiAgICAgICAgICAgICAgICBzZWxmLl91cGRhdGVfam9iX3N0YXRzKGFjY291bnQsIGpvYl9zdWNjZXNzLCBqb2IuZ2V0KCJ0eXBlIiwgIiIpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFJlbG9hZCBhY2NvdW50IHNhdSBraGkgdXBkYXRlIMSR4buDIGPDsyBk4buvIGxp4buHdSBt4bubaSBuaOG6pXQKICAgICAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50KGFjY291bnRbImlkIl0pCiAgICAgICAgICAgICAgICBqb2JzX2RvbmVfaW5fc2Vzc2lvbiA9IGFjY291bnQuZ2V0KCJqb2JzX2RvbmVfaW5fc2Vzc2lvbiIsIDApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiS+G6v3QgcXXhuqMgam9iIHtqb2JzX2RvbmVfaW5fc2Vzc2lvbn0ve21heF9qb2JzX3Blcl9zZXNzaW9ufToge2pvYl9tZXNzYWdlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ2jhu4kgdMSDbmcgY2FyZV9jb3VudGVyIGtoaSBqb2IgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICBpZiBqb2Jfc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICBqb2JzX2RvbmUgKz0gMQogICAgICAgICAgICAgICAgICAgIGNhcmVfY291bnRlciArPSAxCiAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQ2jEg20gc8OzYyBzYXUgbeG7l2kgMy01IGpvYiB0aMOgbmggY8O0bmcgKHJhbmRvbSkKICAgICAgICAgICAgICAgICAgICAjIGlmIGNhcmVfY291bnRlciA+PSByYW5kb20ucmFuZGludCgzLCA1KToKICAgICAgICAgICAgICAgICAgICAjICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyAgICAgICAgIGlmIGhhc2F0dHIoaGFuZGxlciwgInBlcmZvcm1fY2FyZSIpIGFuZCBjYWxsYWJsZShoYW5kbGVyLnBlcmZvcm1fY2FyZSk6CiAgICAgICAgICAgICAgICAgICAgIyAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlRo4buxYyBoaeG7h24gY2jEg20gc8OzYyBuaOG6uSBjaG8gdMOgaSBraG/huqNuIHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgaGFuZGxlci5wZXJmb3JtX2NhcmUoYWNjb3VudCkKICAgICAgICAgICAgICAgICAgICAjICAgICAgICAgICAgIGNhcmVfY291bnRlciA9IDAKICAgICAgICAgICAgICAgICAgICAjICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgIyAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIGNoxINtIHPDs2Mgbmjhurk6IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmdo4buJIG5n4bqvbiBnaeG7r2EgY8OhYyBqb2IKICAgICAgICAgICAgICAgIGNvb2xkb3duID0gZ2V0YXR0cihjb25maWcsICJqb2JfY2hlY2tfaW50ZXJ2YWwiLCAyNSkKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNhZmVfc2xlZXAoY29vbGRvd24pOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gam9iIGNobyB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAjIE5naOG7iSBt4buZdCBjaMO6dCBzYXUga2hpIGzhu5dpIHRyxrDhu5tjIGtoaSB0aOG7rSBs4bqhaQogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuc2FmZV9zbGVlcCg1KToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAjIFbDsm5nIGzhurdwIHdoaWxlIFRydWUgxJHDoyBr4bq/dCB0aMO6YywgcmV0dXJuIFRydWUKICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIAogICAgZGVmIF9zdGFydF9zZXNzaW9uX2Nvb2xkb3duKHNlbGYpOgogICAgICAgICIiIkLhuq90IMSR4bqndSB0aOG7nWkgZ2lhbiBuZ2jhu4kgZ2nhu69hIGPDoWMgcGhpw6puIiIiCiAgICAgICAgY29vbGRvd25fbWludXRlcyA9IHNlbGYuZGIuZ2V0KCJqb2JfY29vbGRvd25fbWludXRlcyIsIDYwKQogICAgICAgIHNlbGYucHJveHlfc2Vzc2lvbl9lbmRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkgKyAoY29vbGRvd25fbWludXRlcyAqIDYwKQogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYiQuG6r3QgxJHhuqd1IG5naOG7iSBuZ8ahaSB7Y29vbGRvd25fbWludXRlc30gcGjDunQgZ2nhu69hIGPDoWMgcGhpw6puIikKICAgICAgICBzZWxmLmRiLnNldCgiZGV2aWNlX21lc3NhZ2UiLCBmIntKb2JTZXJ2aWNlQ29uc3RhbnRzLk1TR19TRVNTSU9OX0NPT0xET1dOfSAoe2Nvb2xkb3duX21pbnV0ZXN9IHBow7p0KSIpCiAgICAgICAgCiAgICAgICAgIyBC4bqlbSBuw7p0IEhvbWUgdsOgIG3hu58gVGVybXV4IGtoaSBi4bqvdCDEkeG6p3Ugbmdo4buJIG5nxqFpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2dnZXIuaW5mbygiQuG6pW0gbsO6dCBIb21lIHbDoCBt4bufIFRlcm11eCDEkeG7gyBuZ2jhu4kgbmfGoWkiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBC4bqlbSBuw7p0IEhvbWUKICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfaG9tZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4budIG3hu5l0IGNow7p0IHLhu5NpIG3hu58gVGVybXV4CiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoImNvbS50ZXJtdXgiKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIGLhuqVtIEhvbWUgdsOgIG3hu58gVGVybXV4OiB7ZX0iKQogICAgICAgIAogICAgZGVmIF9pc19pbl9zZXNzaW9uX2Nvb2xkb3duKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIMSRYW5nIHRyb25nIHRo4budaSBnaWFuIG5naOG7iSBnaeG7r2EgY8OhYyBwaGnDqm4ga2jDtG5nCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkWFuZyB0cm9uZyB0aOG7nWkgZ2lhbiBuZ2jhu4kKICAgICAgICAiIiIKICAgICAgICAjIE7hur91IGPDsyB5w6p1IGPhuqd1IHJlc3RhcnQgc2Vzc2lvbiwgYuG7jyBxdWEgY291bnRkb3duCiAgICAgICAgd2l0aCBzZWxmLl9sb2NrOgogICAgICAgICAgICBpZiBzZWxmLmZvcmNlX3Jlc3RhcnRfc2Vzc2lvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJDw7MgecOqdSBj4bqndSByZXN0YXJ0IHNlc3Npb24sIGLhu48gcXVhIHRo4budaSBnaWFuIG5naOG7iSIpCiAgICAgICAgICAgICAgICBzZWxmLnByb3h5X3Nlc3Npb25fZW5kX3RpbWUgPSAwCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICBpZiBzZWxmLnByb3h5X3Nlc3Npb25fZW5kX3RpbWUgPD0gMDoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHRo4budaSBnaWFuIGNvb2xkb3duIGhp4buHbiB04bqhaQogICAgICAgIGN1cnJlbnRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICBpZiBjdXJyZW50X3RpbWUgPCBzZWxmLnByb3h5X3Nlc3Npb25fZW5kX3RpbWU6CiAgICAgICAgICAgIHJlbWFpbmluZ19taW51dGVzID0gaW50KChzZWxmLnByb3h5X3Nlc3Npb25fZW5kX3RpbWUgLSBjdXJyZW50X3RpbWUpIC8gNjApCiAgICAgICAgICAgIHJlbWFpbmluZ19zZWNvbmRzID0gKHNlbGYucHJveHlfc2Vzc2lvbl9lbmRfdGltZSAtIGN1cnJlbnRfdGltZSkgJSA2MAogICAgICAgICAgICBpZiByZW1haW5pbmdfbWludXRlcyA+IDA6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJDw7JuIHtyZW1haW5pbmdfbWludXRlc30gcGjDunQge3JlbWFpbmluZ19zZWNvbmRzfSBnacOieSBuZ2jhu4kgbmfGoWkiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiQ8OybiB7cmVtYWluaW5nX3NlY29uZHN9IGdpw6J5IG5naOG7iSBuZ8ahaSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgaOG6v3QgdGjhu51pIGdpYW4gbmdo4buJIG5nxqFpLCBi4bqvdCDEkeG6p3UgcGhpw6puIGzDoG0gdmnhu4djIG3hu5tpIikKICAgICAgICAgICAgc2VsZi5wcm94eV9zZXNzaW9uX2VuZF90aW1lID0gMAogICAgICAgICAgICByZXR1cm4gRmFsc2U=').decode('utf-8'))
