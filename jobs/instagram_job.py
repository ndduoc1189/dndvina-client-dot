import base64
exec(base64.b64decode('aW1wb3J0IGRhdGV0aW1lCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgTGlzdCwgT3B0aW9uYWwKZnJvbSBqb2JzLmpvYl9iYXNlIGltcG9ydCBCYXNlSm9iCgpjbGFzcyBJbnN0YWdyYW1Kb2IoQmFzZUpvYik6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UsIGdvbGlrZV9zZXJ2aWNlPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UsIGdvbGlrZV9zZXJ2aWNlKQogICAgICAgIHNlbGYuYXBwX3BhY2thZ2UgPSAiY29tLmluc3RhZ3JhbS5hbmRyb2lkIgogICAgICAgIHNlbGYuYXBwX25hbWUgPSAiaW5zdGFncmFtIgogICAgICAgIAogICAgZGVmIGR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoc2VsZiwgbWF4X3JldHJpZXM9Mywgd2FpdF9iZXR3ZWVuX3JldHJpZXM9MC41KToKICAgICAgICAiIiIKICAgICAgICBEdW1wIG3DoG4gaMOsbmggWE1MIHbhu5tpIGPGoSBjaOG6vyB0aOG7rSBs4bqhaSBu4bq/dSBn4bq3cCBs4buXaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1heF9yZXRyaWVzOiBT4buRIGzhuqduIHRo4butIHThu5FpIMSRYQogICAgICAgICAgICB3YWl0X2JldHdlZW5fcmV0cmllczogVGjhu51pIGdpYW4gY2jhu50gZ2nhu69hIGPDoWMgbOG6p24gdGjhu60gKGdpw6J5KQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFhNTCBj4bunYSBtw6BuIGjDrG5oIGhv4bq3YyBOb25lIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKG1heF9yZXRyaWVzKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyDEkOG7o2kgVUkg4buVbiDEkeG7i25oCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2FpdF9iZXR3ZWVuX3JldHJpZXMpCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIHJldHVybiBzY3JlZW5feG1sCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgZHVtcCBYTUwgKGzhuqduIHthdHRlbXB0KzF9L3ttYXhfcmV0cmllc30pOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGNobyBs4bqnbiB0aOG7rSB0aeG6v3AgdGhlbwogICAgICAgICAgICAgICAgd2FpdF9iZXR3ZWVuX3JldHJpZXMgKz0gMC41CiAgICAgICAgICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBkdW1wIFhNTCBzYXUge21heF9yZXRyaWVzfSBs4bqnbiB0aOG7rSIpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgIGRlZiBpc19ob21lX3NjcmVlbihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIGPDsyDEkWFuZyDhu58gbcOgbiBow6xuaCB0cmFuZyBjaOG7pyBJbnN0YWdyYW0gaGF5IGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJFhbmcg4bufIHRyYW5nIGNo4bunLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgWE1MIG3DoG4gaMOsbmggaGnhu4duIHThuqFpIHbhu5tpIGPGoSBjaOG6vyB0aOG7rSBs4bqhaQogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSAxOiBDw7MgbsO6dCAiVHJhbmcgY2jhu6ciIMSRxrDhu6NjIGNo4buNbiAoc2VsZWN0ZWQ9dHJ1ZSkgdHJvbmcgdGhhbmggdGFiIGtow7RuZwogICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciCiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgaG9tZV90YWI6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGhvbWVfdGFiKToKICAgICAgICAgICAgICAgICAgICBsb2dvX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3RpdGxlX2xvZ29fY2hldnJvbl9jb250YWluZXIiCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICBpZiBsb2dvX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG9nb19idXR0b24uZ2V0KCJ2aXNpYmxlLXRvLXVzZXIiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgdMOsbSB0aOG6pXkgdGFiICJUcmFuZyBjaOG7pyIgbmjGsG5nIGNoxrBhIMSRxrDhu6NjIGNo4buNbiwgY2xpY2sgdsOgbyDEkcOzCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfdGFiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMS41cwogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgdMOsbSB0aOG6pXkgdGFiICJUcmFuZyBjaOG7pyIgbmjGsG5nIGNoxrBhIMSRxrDhu6NjIGNo4buNbiwgY2xpY2sgdsOgbyDEkcOzCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfdGFiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMS41cwogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICMgS2jDtG5nIHTDrG0gdGjhuqV5IGPDoWMgeeG6v3UgdOG7kSBj4bunYSB0cmFuZyBjaOG7pwogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraeG7g20gdHJhIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgSW5zdGFncmFtIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIGVuc3VyZV9ob21lX3NjcmVlbihzZWxmLCBtYXhfcmV0cmllczogaW50ID0gMykgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28gxJFhbmcg4bufIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgSW5zdGFncmFtLCBu4bq/dSBraMO0bmcgdGjDrCBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtYXhfcmV0cmllczogU+G7kSBs4bqnbiB0aOG7rSB04buRaSDEkWEKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHJ5X2NvdW50ID0gMAogICAgICAgIAogICAgICAgIHdoaWxlIHJldHJ5X2NvdW50IDwgbWF4X3JldHJpZXM6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIMSRYW5nIOG7nyB0cmFuZyBjaOG7pyBraMO0bmcKICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyDhu58gdHJhbmcgY2jhu6csIMSRw7NuZyB2w6AgbeG7nyBs4bqhaSBhcHAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIHBo4bqjaSB0cmFuZyBjaOG7pyBJbnN0YWdyYW0sIGto4bufaSDEkeG7mW5nIGzhuqFpIGFwcC4uLiIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcChzZWxmLmFwcF9wYWNrYWdlKQoKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg1KQogICAgICAgICAgICBpZiBub3Qgc2VsZi52YWxpZGF0ZV9hcHBfbm90X2Jhbm5lZCgpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIHJldHJ5X2NvdW50ICs9IDEKICAgICAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgbeG7nyB0cmFuZyBjaOG7pyBJbnN0YWdyYW0gc2F1IHttYXhfcmV0cmllc30gbOG6p24gdGjhu60iKQogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdmFsaWRhdGVfYXBwX25vdF9iYW5uZWQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgxJDhuqNtIGLhuqNvIGtow7RuZyBjw7MgdMOgaSBraG/huqNuIG7DoG8gYuG7iyBiYW5uZWQKICAgICAgICAiIiIKICAgICAgICAjIEtp4buDbSB0cmEgZGlhbG9nIGPhuqNuaCBiw6FvCiAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgYWxlcnRfY29udGFpbmVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9pZ2RzX2FsZXJ0X2RpYWxvZ190ZXh0X2NvbnRhaW5lciIKICAgICAgICApCiAgICAgICAgCiAgICAgICAgI0tp4buDbSB0cmEgY8OzIHRow7RuZyBiw6FvIHRo4bupIGzhuqFpIHNhdS4KICAgICAgICBpZiBhbGVydF9jb250YWluZXI6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0acOqdSDEkeG7gSBkaWFsb2cKICAgICAgICAgICAgaGVhZGxpbmUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvaWdkc19hbGVydF9kaWFsb2dfaGVhZGxpbmUiCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGhlYWRsaW5lIGFuZCBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KGhlYWRsaW5lKSA9PSAiVGjhu60gbOG6oWkgc2F1IjoKICAgICAgICAgICAgICAgICMgTOG6pXkgbuG7mWkgZHVuZyBj4bqjbmggYsOhbwogICAgICAgICAgICAgICAgc3VidGV4dCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2lnZHNfYWxlcnRfZGlhbG9nX3N1YnRleHQiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHN1YnRleHQ6CiAgICAgICAgICAgICAgICAgICAgd2FybmluZ19tZXNzYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dChzdWJ0ZXh0KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCBj4bqjbmggYsOhbyBoaeG7h24gdOG6oWkgdOG7qyBkYgogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfd2FybmluZ3MgPSBzZWxmLmRiLmdldCgibG9ncy13YXJuaW5nLW1lc3NhZ2UiLCBbXSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRow6ptIGPhuqNuaCBiw6FvIG3hu5tpCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF93YXJuaW5ncy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAidGltZSI6IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLmlzb2Zvcm1hdCgpLAogICAgICAgICAgICAgICAgICAgICAgICAibWVzcyI6IHdhcm5pbmdfbWVzc2FnZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBDaOG7iSBnaeG7ryBs4bqhaSB04buRaSDEkWEgMjAgbG9nIGfhuqduIG5o4bqldAogICAgICAgICAgICAgICAgICAgIGlmIGxlbihjdXJyZW50X3dhcm5pbmdzKSA+IDIwOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dhcm5pbmdzID0gY3VycmVudF93YXJuaW5nc1stMjA6XQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTMawdSBs4bqhaSB2w6BvIGRiCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zZXQoImxvZ3Mtd2FybmluZy1tZXNzYWdlIiwgY3VycmVudF93YXJuaW5ncykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYixJDDoyBsxrB1IGPhuqNuaCBiw6FvOiB7d2FybmluZ19tZXNzYWdlfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBDbGljayBuw7p0IE9LIMSR4buDIMSRw7NuZyBkaWFsb2cKICAgICAgICAgICAgICAgICAgICBva19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2lnZHNfYWxlcnRfZGlhbG9nX2J1dHRvbiIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgaWYgb2tfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIob2tfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAKICAgICAgICAjS2nhu4NtIHRyYSB4ZW0gY8OzIHRow7RuZyBiw6FvIHBo4bqjaSDEkcSDbmcgbmjhuq1wIGtow7RuZwogICAgICAgICMgS2nhu4NtIHRyYSBjb250YWluZXIgYmxva3MKICAgICAgICBibG9rc19jb250YWluZXIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2Jsb2tzX2NvbnRhaW5lciIKICAgICAgICApCiAgICAgICAgCiAgICAgICAgaWYgYmxva3NfY29udGFpbmVyOgogICAgICAgICAgICAjIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHZpZXcgdHJvbmcgY29udGFpbmVyCiAgICAgICAgICAgIHZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3IgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHZpZXcgxJHhuqd1IHRpw6puIGPDsyB0ZXh0IGtow6FjIG51bGwKICAgICAgICAgICAgd2FybmluZ190ZXh0ID0gTm9uZQogICAgICAgICAgICBmb3IgdmlldyBpbiB2aWV3czoKICAgICAgICAgICAgICAgIHRleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHZpZXcpCiAgICAgICAgICAgICAgICBpZiB0ZXh0IGFuZCB0ZXh0LnN0cmlwKCkgYW5kIHRleHQgIT0gIm51bGwiIGFuZCB0ZXh0ICE9ICIgIiBhbmQgbGVuKHRleHQuc3RyaXAoKSkgPiAxMDoKICAgICAgICAgICAgICAgICAgICB3YXJuaW5nX3RleHQgPSB0ZXh0CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHdhcm5pbmdfdGV4dDoKICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCBj4bqjbmggYsOhbyBoaeG7h24gdOG6oWkgdOG7qyBkYgogICAgICAgICAgICAgICAgY3VycmVudF93YXJuaW5ncyA9IHNlbGYuZGIuZ2V0KCJsb2dzLXdhcm5pbmctbWVzc2FnZSIsIFtdKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFRow6ptIGPhuqNuaCBiw6FvIG3hu5tpCiAgICAgICAgICAgICAgICBjdXJyZW50X3dhcm5pbmdzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgInRpbWUiOiBkYXRldGltZS5kYXRldGltZS5ub3coKS5pc29mb3JtYXQoKSwKICAgICAgICAgICAgICAgICAgICAibWVzcyI6IHdhcm5pbmdfdGV4dAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDaOG7iSBnaeG7ryBs4bqhaSB04buRaSDEkWEgMjAgbG9nIGfhuqduIG5o4bqldAogICAgICAgICAgICAgICAgaWYgbGVuKGN1cnJlbnRfd2FybmluZ3MpID4gMjA6CiAgICAgICAgICAgICAgICAgICAgY3VycmVudF93YXJuaW5ncyA9IGN1cnJlbnRfd2FybmluZ3NbLTIwOl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMxrB1IGzhuqFpIHbDoG8gZGIKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJsb2dzLXdhcm5pbmctbWVzc2FnZSIsIGN1cnJlbnRfd2FybmluZ3MpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLEkMOjIGzGsHUgY+G6o25oIGLDoW86IHt3YXJuaW5nX3RleHR9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBM4bqleSBkYW5oIHPDoWNoIGFwcCDEkWFuZyDEkcaw4bujYyBrw61jaCBob+G6oXQKICAgICAgICAgICAgICAgIGVuYWJsZWRfYXBwcyA9IHNlbGYuZGIuZ2V0KCJlbmFibGVkX2FwcHMiLCBbXSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBJbnN0YWdyYW0ga2jhu49pIGRhbmggc8OhY2gKICAgICAgICAgICAgICAgIGlmICJpbnN0YWdyYW0iIGluIGVuYWJsZWRfYXBwczoKICAgICAgICAgICAgICAgICAgICBlbmFibGVkX2FwcHMucmVtb3ZlKCJpbnN0YWdyYW0iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJlbmFibGVkX2FwcHMiLCBlbmFibGVkX2FwcHMpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygixJDDoyB2w7QgaGnhu4d1IGjDs2EgSW5zdGFncmFtIGto4buPaSBkYW5oIHPDoWNoIGFwcCDEkcaw4bujYyBrw61jaCBob+G6oXQiKQoKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcChzZWxmLmFwcF9wYWNrYWdlKQoKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIHJldHVybiBUcnVlCiAgICBkZWYgZ2V0X2FjY291bnRzX2Zyb21fZGV2aWNlKHNlbGYpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIkzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIEluc3RhZ3JhbSB04burIHRoaeG6v3QgYuG7iyIiIgogICAgICAgIGFjY291bnRzID0gW10KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pyBJbnN0YWdyYW0KICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE5o4bqlbiB2w6BvIHRhYiAiVHJhbmcgY8OhIG5ow6JuIgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgcHJvZmlsZV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBwcm9maWxlX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFRyYW5nIGPDoSBuaMOibiIpCiAgICAgICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE5o4bqlcCB2w6BvIHRhYiBUcmFuZyBjw6EgbmjDom4KICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2ZpbGVfdGFiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24gaGnhu4duIHThuqFpIHThu6sgdHJhbmcgY8OhIG5ow6JuCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHVzZXJuYW1lIHThu6sgdGnDqnUgxJHhu4EgbOG7m24gdHJvbmcgYWN0aW9uIGJhcgogICAgICAgICAgICB1c2VybmFtZV90aXRsZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9sYXJnZV90aXRsZV9hdXRvX3NpemUiCiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX3RpdGxlOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV9kb3duKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIHVzZXJuYW1lX3RpdGxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX2xhcmdlX3RpdGxlX2F1dG9fc2l6ZSIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgdXNlcm5hbWVfdGl0bGU6CiAgICAgICAgICAgICAgICBjdXJyZW50X3VzZXJuYW1lID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh1c2VybmFtZV90aXRsZSkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB1c2VybmFtZSBoaeG7h24gdOG6oWkgdOG7qyB0acOqdSDEkeG7gToge2N1cnJlbnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOaOG6pXAgdsOgbyB0acOqdSDEkeG7gSB1c2VybmFtZSDEkeG7gyBt4bufIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIodXNlcm5hbWVfdGl0bGUpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgYWNjb3VudHNfeG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSBWaWV3R3JvdXAgY8OzIGNvbnRlbnQtZGVzYyAobMOgIHVzZXJuYW1lKQogICAgICAgICAgICAgICAgYWNjb3VudF9pdGVtcyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgICAgICAgICBhY2NvdW50c194bWwsCiAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC52aWV3LlZpZXdHcm91cCIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBM4buNYyB2w6AgeOG7rSBsw70gY8OhYyBt4bulYyB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIGZvciBpdGVtIGluIGFjY291bnRfaXRlbXM6CiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBjb250ZW50LWRlc2MgY+G7p2EgaXRlbQogICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYyA9IGl0ZW0uZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY29udGVudF9kZXNjIG9yIGNvbnRlbnRfZGVzYyA9PSAibnVsbCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDonkgY8OzIHBo4bqjaSBsw6AgbsO6dCAixJBpIMSR4bq/biBUcnVuZyB0w6JtIHTDoGkga2hv4bqjbiIga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgaWYgIlRydW5nIHTDom0gdMOgaSBraG/huqNuIiBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQuG7jyBxdWEgbsO6dCAiVGjDqm0gdMOgaSBraG/huqNuIiAKICAgICAgICAgICAgICAgICAgICBpZiAiVGjDqm0gdMOgaSBraG/huqNuIiBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBY4butIGzDvSB0csaw4budbmcgaOG7o3AgY8OzIHRow7RuZyBiw6FvIHRyb25nIGNvbnRlbnQtZGVzYyAodmQ6ICJ1c2VybmFtZSwgMTAgdGjDtG5nIGLDoW8iKQogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gY29udGVudF9kZXNjCiAgICAgICAgICAgICAgICAgICAgaWYgIiwiIGluIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBjb250ZW50X2Rlc2Muc3BsaXQoIiwiKVswXS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBQaMawxqFuZyBwaMOhcCAyOiBUw6xtIHRy4buxYyB0aeG6v3AgdHJvbmcgY8OhYyB2aWV3IGNvbgogICAgICAgICAgICAgICAgICAgIGNoaWxkX3ZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50c194bWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3IgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IGJvdW5kcyBj4bunYSBpdGVtIGhp4buHbiB04bqhaSDEkeG7gyB0w6xtIHZpZXcgY29uIHRodeG7mWMgduG7gSBuw7MKICAgICAgICAgICAgICAgICAgICBpdGVtX2JvdW5kcyA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X2JvdW5kcyhpdGVtKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGZvciB2aWV3IGluIGNoaWxkX3ZpZXdzOgogICAgICAgICAgICAgICAgICAgICAgICB2aWV3X2JvdW5kcyA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X2JvdW5kcyh2aWV3KQogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHZpZXcgY8OzIG7hurFtIHRyb25nIGl0ZW0ga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2aWV3X2JvdW5kc1swXSA+PSBpdGVtX2JvdW5kc1swXSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3X2JvdW5kc1sxXSA+PSBpdGVtX2JvdW5kc1sxXSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3X2JvdW5kc1syXSA8PSBpdGVtX2JvdW5kc1syXSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3X2JvdW5kc1szXSA8PSBpdGVtX2JvdW5kc1szXSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdfdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodmlldykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHZpZXdfdGV4dCBhbmQgInRow7RuZyBiw6FvIiBub3QgaW4gdmlld190ZXh0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHRo4bqleSB2aWV3IGNvbiBjaOG7qWEgdMOqbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHZpZXdfdGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIG7DoHkgY8OzIMSRYW5nIMSRxrDhu6NjIGNo4buNbiBraMO0bmcKICAgICAgICAgICAgICAgICAgICBpc19zZWxlY3RlZCA9IGl0ZW0uZ2V0KCJzZWxlY3RlZCIpID09ICJ0cnVlIgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVOG6oW8gdGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgICAgICBhY2NvdW50ID0gewogICAgICAgICAgICAgICAgICAgICAgICAibmlja25hbWUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV91c2VybmFtZSI6IHVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiYWN0aXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImlzX2xvZ2luIjogaXNfc2VsZWN0ZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgImpvYl9lbmFibGUiOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAibGV2ZWwiOiAzLAogICAgICAgICAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGFjY291bnRzLmFwcGVuZChhY2NvdW50KQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiBJbnN0YWdyYW06IHt1c2VybmFtZX0gKHNlbGVjdGVkOiB7aXNfc2VsZWN0ZWR9KSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmjhuqVuIGJhY2sgxJHhu4MgxJHDs25nIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBRdWF5IGzhuqFpIHRyYW5nIGNo4bunIGLhurFuZyBwaMawxqFuZyB0aOG7qWMgYmFja190b19ob21lCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gSW5zdGFncmFtIikKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGFjY291bnRzCiAgICAKICAgIGRlZiBiYWNrX3RvX2hvbWUoc2VsZiwgbWF4X2JhY2tfY291bnQ6IGludCA9IDUsIG1heF9yZXRyaWVzOiBpbnQgPSAxKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFF1YXkgbOG6oWkgbcOgbiBow6xuaCB0cmFuZyBjaOG7pyBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtYXhfYmFja19jb3VudDogU+G7kSBs4bqnbiBuaOG6pW4gQmFjayB04buRaSDEkWEgdHLGsOG7m2Mga2hpIHRo4butIGto4bufaSDEkeG7mW5nIGzhuqFpIGFwcAogICAgICAgICAgICBtYXhfcmV0cmllczogU+G7kSBs4bqnbiB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAgdOG7kWkgxJFhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6Mg4bufIHRyYW5nIGNo4bunIGNoxrBhCiAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkGFuZyB0w6xtIGPDoWNoIHF1YXkgduG7gSB0cmFuZyBjaOG7pyBJbnN0YWdyYW0uLi4iKQogICAgICAgIAogICAgICAgICMgVGjhu60gbOG6oWkgdG/DoG4gYuG7mSBxdcOhIHRyw6xuaCB04buRaSDEkWEgbWF4X3JldHJpZXMgbOG6p24KICAgICAgICBmb3IgcmV0cnkgaW4gcmFuZ2UobWF4X3JldHJpZXMpOgogICAgICAgICAgICAjIFRo4butIGLhuqVtIG7DunQgYmFjayB04buRaSDEkWEgbWF4X2JhY2tfY291bnQgbOG6p24KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobWF4X2JhY2tfY291bnQpOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIHbhu4EgdHJhbmcgY2jhu6cgY2jGsGEKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cgc2F1IHtpKzF9IGzhuqduIGLhuqVtIGJhY2sgKGzhuqduIHRo4butIHtyZXRyeSsxfSkiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IHbhuqtuIGtow7RuZyB24buBIMSRxrDhu6NjIHRyYW5nIGNo4bunLCBraWxsIGFwcCB2w6AgbeG7nyBs4bqhaQogICAgICAgICAgICBpZiByZXRyeSA8IG1heF9yZXRyaWVzIC0gMTogICMgQ2jhu4kgbG9nIGPhuqNuaCBiw6FvIG7hur91IGPDsm4gbOG6p24gdGjhu60gdGnhur9wIHRoZW8KICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdGjhu4MgduG7gSB0cmFuZyBjaOG7pyBzYXUge21heF9iYWNrX2NvdW50fSBs4bqnbiBi4bqlbSBiYWNrLCB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAgKGzhuqduIHRo4butIHtyZXRyeSsxfS97bWF4X3JldHJpZXN9KS4uLiIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyB24buBIHRyYW5nIGNo4bunIHNhdSB7bWF4X2JhY2tfY291bnR9IGzhuqduIGLhuqVtIGJhY2sgKGzhuqduIHRo4butIGN14buRaSB7cmV0cnkrMX0ve21heF9yZXRyaWVzfSkuLi4iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcChzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDUpICAjIMSQ4bujaSBhcHAgbeG7nwoKICAgICAgICAgICAgaWYgbm90IHNlbGYudmFsaWRhdGVfYXBwX25vdF9iYW5uZWQoKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHhlbSBjw7Mg4bufIHRyYW5nIGNo4bunIGtow7RuZwogICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cgc2F1IGtoaSBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAgKGzhuqduIHRo4butIHtyZXRyeSsxfSkiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyB24buBIHRyYW5nIGNo4bunIG5nYXkgY+G6oyBzYXUge21heF9yZXRyaWVzfSBs4bqnbiB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBhcHAiKQogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICAKCiAgICAKICAgIGRlZiBtYXBfZ29saWtlX2FjY291bnRzKHNlbGYsIGdvbGlrZV9hY2NvdW50czogTGlzdFtEaWN0W3N0ciwgQW55XV0sIGRldmljZV9hY2NvdW50czogTGlzdFtEaWN0W3N0ciwgQW55XV0pIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIMOBbmggeOG6oSB0w6BpIGtob+G6o24gdOG7qyBHb0xpa2UgdsOgbyB0w6BpIGtob+G6o24gdHLDqm4gdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZ29saWtlX2FjY291bnRzOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiB04burIEdvTGlrZSBBUEkKICAgICAgICAgICAgZGV2aWNlX2FjY291bnRzOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiB0csOqbiB0aGnhur90IGLhu4sKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggdMOgaSBraG/huqNuIMSRw6Mgw6FuaCB44bqhCiAgICAgICAgIiIiCiAgICAgICAgbWFwcGVkX2FjY291bnRzID0gW10KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ2h14bqpbiBow7NhIGThu68gbGnhu4d1IHThu6sgR29MaWtlCiAgICAgICAgICAgIGdvbGlrZV9kYXRhID0ge30KICAgICAgICAgICAgZm9yIGFjYyBpbiBnb2xpa2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICAjIFRyw61jaCB4deG6pXQgdGjDtG5nIHRpbiB04burIHTDoGkga2hv4bqjbiBHb0xpa2UKICAgICAgICAgICAgICAgIGdvbGlrZV9hY2NvdW50ID0gewogICAgICAgICAgICAgICAgICAgICJnb2xpa2VfaWQiOiBhY2MuZ2V0KCJpZCIpLAogICAgICAgICAgICAgICAgICAgICJuaWNrbmFtZSI6IGFjYy5nZXQoImluc3RhZ3JhbV9mdWxsX25hbWUiKSBvciBhY2MuZ2V0KCJpbnN0YWdyYW1fdXNlcm5hbWUiKSwKICAgICAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogYWNjLmdldCgiaW5zdGFncmFtX2lkIiksCiAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV91c2VybmFtZSI6IGFjYy5nZXQoImluc3RhZ3JhbV91c2VybmFtZSIpLAogICAgICAgICAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiBhY2MuZ2V0KCJwcm9maWxlX3BpY191cmwiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIHVuaXF1ZV91c2VybmFtZSBsw6BtIGtow7NhIMSR4buDIGThu4Ugw6FuaCB44bqhCiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGdvbGlrZV9hY2NvdW50WyJ1bmlxdWVfdXNlcm5hbWUiXQogICAgICAgICAgICAgICAgaWYgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgZ29saWtlX2RhdGFbdXNlcm5hbWUubG93ZXIoKV0gPSBnb2xpa2VfYWNjb3VudAogICAgICAgICAgICAKICAgICAgICAgICAgIyDDgW5oIHjhuqEgduG7m2kgdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBmb3IgZGV2aWNlX2FjY291bnQgaW4gZGV2aWNlX2FjY291bnRzOgogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBkZXZpY2VfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lIGluIGdvbGlrZV9kYXRhOgogICAgICAgICAgICAgICAgICAgICMgxJDDoyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gdHJvbmcgZGFuaCBzw6FjaCBHb0xpa2UKICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHThu6sgR29MaWtlIHbDoG8gdMOgaSBraG/huqNuIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgICAgIGdvbGlrZV9pbmZvID0gZ29saWtlX2RhdGFbdXNlcm5hbWVdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAiZ29saWtlX2lkIjogZ29saWtlX2luZm9bImdvbGlrZV9pZCJdLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNfZ29saWtlX2xpbmtlZCI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiBnb2xpa2VfaW5mb1siYXZhdGFyX3RodW1iIl0gb3IgZGV2aWNlX2FjY291bnQuZ2V0KCJhdmF0YXJfdGh1bWIiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJ1bmlxdWVfaWQiOiBnb2xpa2VfaW5mb1sidW5pcXVlX2lkIl0gb3IgZGV2aWNlX2FjY291bnQuZ2V0KCJ1bmlxdWVfaWQiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJuaWNrbmFtZSI6IGdvbGlrZV9pbmZvWyJuaWNrbmFtZSJdIG9yIGRldmljZV9hY2NvdW50LmdldCgibmlja25hbWUiLCAiIikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIElEIHTDoGkga2hv4bqjbiB0cm9uZyBEQgogICAgICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBkZXZpY2VfYWNjb3VudC5nZXQoImlkIikKICAgICAgICAgICAgICAgICAgICBpZiBhY2NvdW50X2lkOgogICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB2w6BvIERCCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudF9pZCwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHbDoG8gZGV2aWNlX2FjY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2FjY291bnQudXBkYXRlKHVwZGF0ZV9kYXRhKQogICAgICAgICAgICAgICAgICAgICAgICBtYXBwZWRfYWNjb3VudHMuYXBwZW5kKGRldmljZV9hY2NvdW50KQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6Mgw6FuaCB44bqhIHTDoGkga2hv4bqjbiBJbnN0YWdyYW06IHt1c2VybmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIG1hcHBlZF9hY2NvdW50cwogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSDDoW5oIHjhuqEgdMOgaSBraG/huqNuIEluc3RhZ3JhbSIpCiAgICAgICAgICAgIHJldHVybiBbXQogICAgZGVmIGdldF9yZXBvcnRfcGF5bG9hZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVOG6oW8gcGF5bG9hZCBjaG8gdmnhu4djIGLDoW8gY8OhbyBob8OgbiB0aMOgbmggam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogUGF5bG9hZCBjaG8gQVBJIGLDoW8gY8OhbwogICAgICAgICIiIgogICAgICAgIGdvbGlrZV9pZCA9IGFjY291bnQuZ2V0KCJnb2xpa2VfaWQiKQogICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICAKICAgICAgICBpZiBub3QgZ29saWtlX2lkIG9yIG5vdCBqb2JfaWQ6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJUaGnhur91IHRow7RuZyB0aW4gdMOgaSBraG/huqNuIGhv4bq3YyBqb2IgxJHhu4MgdOG6oW8gcGF5bG9hZCBiw6FvIGPDoW8iKQogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiaW5zdGFncmFtX3VzZXJzX2FkdmVydGlzaW5nX2lkIjogam9iX2lkLAogICAgICAgICAgICAiaW5zdGFncmFtX2FjY291bnRfaWQiOiBnb2xpa2VfaWQsCiAgICAgICAgICAgICJhc3luYyI6IFRydWUsCiAgICAgICAgICAgICJkYXRhIjogTm9uZQogICAgICAgIH0gICAgCiAgICAgICAgICAKICAgIAogICAgCiAgICBkZWYgZXhlY3V0ZV9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgdGjhu7FjIGhp4buHbiBqb2IsIGJhbyBn4buTbToKICAgICAgICAgICAgICAgIC0gc3RhdHVzIChpbnQpOiBNw6MgdHLhuqFuZyB0aMOhaSBqb2IKICAgICAgICAgICAgICAgICAgICAwOiBDaMawYSB0aOG7sWMgaGnhu4duCiAgICAgICAgICAgICAgICAgICAgMTogVGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgMjogVGjhuqV0IGLhuqFpLCBraMO0bmcgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nCiAgICAgICAgICAgICAgICAgICAgMzogVGjhuqV0IGLhuqFpLCDEkcOjIGLhu4sgdW5mb2xsb3cvdW5saWtlCiAgICAgICAgICAgICAgICAgICAgNDogVGjhuqV0IGLhuqFpLCB5w6p1IGPhuqd1IMSRYW5nIGNo4budCiAgICAgICAgICAgICAgICAtIG1lc3NhZ2UgKHN0cik6IFRow7RuZyBiw6FvIGvhur90IHF14bqjCiAgICAgICAgICAgICAgICAtIHN1Y2Nlc3MgKGJvb2wpOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBqb2JfdHlwZSA9IGpvYi5nZXQoInR5cGUiLCAiIikubG93ZXIoKQogICAgICAgICAgICBqb2JfbGluayA9IGpvYi5nZXQoImxpbmsiLCAiIikKICAgICAgICAgICAgam9iX2lkID0gam9iLmdldCgiaWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQYW5nIHRo4buxYyBoaeG7h24gam9iIHtqb2JfaWR9IGxv4bqhaSB7am9iX3R5cGV9IHbhu5tpIGxpbmsge2pvYl9saW5rfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgbG/huqFpIGpvYiDEkcaw4bujYyBo4buXIHRy4bujCiAgICAgICAgICAgIGlmIGpvYl90eXBlIG5vdCBpbiBbImZvbGxvdyIsICJsaWtlIl06CiAgICAgICAgICAgICAgICBtZXNzYWdlID0gZiJMb+G6oWkgam9iIHtqb2JfdHlwZX0ga2jDtG5nIMSRxrDhu6NjIGjhu5cgdHLhu6MiCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAyLAogICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAjIFRo4buxYyBoaeG7h24gam9iIHRoZW8gbG/huqFpCiAgICAgICAgICAgIGpvYl9zdGF0dXMgPSAwICAjIE3hurdjIMSR4buLbmggbMOgIGNoxrBhIGzDoG0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGpvYl90eXBlID09ICJmb2xsb3ciOgogICAgICAgICAgICAgICAgam9iX3N0YXR1cyA9IHNlbGYuX3BlcmZvcm1fZm9sbG93X2pvYihqb2JfbGluaykKICAgICAgICAgICAgZWxpZiBqb2JfdHlwZSA9PSAibGlrZSI6CiAgICAgICAgICAgICAgICBqb2Jfc3RhdHVzID0gc2VsZi5fcGVyZm9ybV9saWtlX2pvYihqb2JfbGluaykKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6oW8ga+G6v3QgcXXhuqMgdHLhuqMgduG7gSBk4buxYSB0csOqbiBqb2Jfc3RhdHVzCiAgICAgICAgICAgIGlmIGpvYl9zdGF0dXMgPT0gMTogICMgVGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICBtZXNzYWdlID0gZiLEkMOjIGhvw6BuIHRow6BuaCBqb2Ige2pvYl90eXBlfSB0aMOgbmggY8O0bmciCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKG1lc3NhZ2UpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiBqb2Jfc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyI6IFRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxpZiBqb2Jfc3RhdHVzID09IDI6ICAjIEtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBmIktow7RuZyB0aOG7gyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcgxJHhu4MgdGjhu7FjIGhp4buHbiBqb2Ige2pvYl90eXBlfSIKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKG1lc3NhZ2UpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiBqb2Jfc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSAzOiAgIyBC4buLIHVuZm9sbG93L3VubGlrZQogICAgICAgICAgICAgICAgbWVzc2FnZSA9IGYixJDDoyBi4buLIHVuZm9sbG93L3VubGlrZSB0cm9uZyBqb2Ige2pvYl90eXBlfSIKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IGpvYl9zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxpZiBqb2Jfc3RhdHVzID09IDQ6ICAjIFnDqnUgY+G6p3UgxJFhbmcgY2jhu50KICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBmIlnDqnUgY+G6p3UgxJFhbmcgY2jhu50gdHJvbmcgam9iIHtqb2JfdHlwZX0iCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiBqb2Jfc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSA1OiAgIyBH4butaSB5w6p1IGPhuqd1CiAgICAgICAgICAgICAgICBtZXNzYWdlID0gZiJH4butaSB5w6p1IGPhuqd1IGNo4budIGR1eeG7h3Qge2pvYl90eXBlfSIKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcobWVzc2FnZSkKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IGpvYl9zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZTogICMgVHLhuqFuZyB0aMOhaSBraMO0bmcgeMOhYyDEkeG7i25oCiAgICAgICAgICAgICAgICBtZXNzYWdlID0gZiJUcuG6oW5nIHRow6FpIGtow7RuZyB4w6FjIMSR4buLbmgga2hpIHRo4buxYyBoaeG7h24gam9iIHtqb2JfdHlwZX0gc3RhdHVzOntqb2Jfc3RhdHVzfSIKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKG1lc3NhZ2UpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAwLAogICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIG1lc3NhZ2UgPSBmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYjoge3N0cihlKX0iCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBtZXNzYWdlKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN0YXR1cyI6IDIsCiAgICAgICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIF9wZXJmb3JtX2ZvbGxvd19qb2Ioc2VsZiwgcHJvZmlsZV9saW5rOiBzdHIpIC0+IGludDoKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGpvYiBmb2xsb3cgdHLDqm4gSW5zdGFncmFtCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJvZmlsZV9saW5rOiBMaW5rIMSR4bq/biB0cmFuZyBjw6EgbmjDom4gY+G6p24gZm9sbG93CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGludDogVHLhuqFuZyB0aMOhaSBqb2IgKDA6IGNoxrBhIGzDoG0sIDE6IGhvw6BuIHRow6BuaCwgMjogbOG7l2ksIDM6IGLhu4sgdW5mb2xsb3cpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVHLDrWNoIHh14bqldCB1c2VybmFtZSB04burIFVSTAogICAgICAgICAgICBpbXBvcnQgcmUKICAgICAgICAgICAgaW1wb3J0IHJhbmRvbQogICAgICAgICAgICB1c2VybmFtZV9tYXRjaCA9IHJlLnNlYXJjaChyJ2luc3RhZ3JhbVwuY29tLyhbXi9dKyknLCBwcm9maWxlX2xpbmspCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV9tYXRjaDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIHRyw61jaCB4deG6pXQgdXNlcm5hbWUgdOG7qyBsaW5rOiB7cHJvZmlsZV9saW5rfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHVzZXJuYW1lID0gdXNlcm5hbWVfbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmFuZG9tIGNo4buNbiAxIHRyb25nIDIgY8OhY2g6IHTDrG0ga2nhur9tIGhv4bq3YyBt4bufIHRy4buxYyB0aeG6v3AgbGluawogICAgICAgICAgICBpZiByYW5kb20uY2hvaWNlKFtUcnVlLCBGYWxzZV0pOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIk3hu58gdHJhbmcgY8OhIG5ow6JuIGLhurFuZyBjw6FjaCB0w6xtIGtp4bq/bToge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAjIEPDoWNoIDE6IFTDrG0ga2nhur9tIHVzZXJuYW1lIChjw6FjaCBjxakpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyDEkMOzbmcgY8OhYyBkaWFsb2cgbuG6v3UgY8OzCiAgICAgICAgICAgICAgICAgICAgZGlhbG9nID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iRGlhbG9nIikKICAgICAgICAgICAgICAgICAgICBpZiBkaWFsb2c6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVGFwIHbDoG8ga2h1IHbhu7FjIHRy4buRbmcgxJHhu4MgxJHDs25nIGRpYWxvZwogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCwgaGVpZ2h0ID0gc2VsZi5oZWxwZXIuZ2V0X3NjcmVlbl9zaXplKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwKGludCh3aWR0aCowLjIpLCBpbnQoaGVpZ2h0KjAuMikpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMS41cwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTeG7nyB0cmFuZyB0w6xtIGtp4bq/bSAKICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmgsIHRo4butIG3hu58gYuG6sW5nIGxpbmsgdHLhu7FjIHRp4bq/cCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluaykKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDQpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gNHMKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9zZWFyY2hfdGFiIikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlYXJjaF90YWI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFTDrG0ga2nhur9tLCB0aOG7rSBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmspCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDRzCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWFyY2hfdGFiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDJzCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3NlYXJjaF90YWIiKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfdGFiIG9yIG5vdCBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKHNlYXJjaF90YWIpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX3RhYikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkgCgogICAgICAgICAgICAgICAgICAgICMgTmjhuqVuIHbDoG8gdGhhbmggdMOsbSBraeG6v20KICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmgga2hpIHTDrG0gw7Qgbmjhuq1wLCB0aOG7rSBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmspCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWFyY2hfaW5wdXQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9zZWFyY2hfZWRpdF90ZXh0IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VhcmNoX2lucHV0OgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX3RhYikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpIAogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hfaW5wdXQgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX3NlYXJjaF9lZGl0X3RleHQiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfaW5wdXQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgw7Qgbmjhuq1wIHTDrG0ga2nhur9tLCB0aOG7rSBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmspCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgWMOzYSBu4buZaSBkdW5nIHTDrG0ga2nhur9tIGhp4buHbiB04bqhaSBu4bq/dSBjw7MKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX2lucHV0KQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBOaOG6rXAgdXNlcm5hbWUgY+G6p24gdMOsbSB24bubaSBrw70gdOG7sSBAIHBow61hIHRyxrDhu5tjCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuaW5wdXRfdGV4dChmInt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg1KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDVzIMSR4buDIGvhur90IHF14bqjIHTDrG0ga2nhur9tIGhp4buHbiDEkeG6p3kgxJHhu6cKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFTDrG0ga+G6v3QgcXXhuqMgdGhlbyByZXNvdXJjZS1pZCBj4bulIHRo4buDCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKSAgIyBUaG/DoXQgdMOsbSBraeG6v20KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIGvhur90IHF14bqjIHTDrG0ga2nhur9tLCB0aOG7rSBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmspCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB1c2VyX3Jlc3VsdCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9yb3dfc2VhcmNoX3VzZXJfdXNlcm5hbWUiKQogICAgICAgICAgICAgICAgICAgIGlmIHVzZXJfcmVzdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIodXNlcl9yZXN1bHQpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5IHRoZW8gcmVzb3VyY2UtaWQsIHRo4butIHTDrG0gdGhlbyBr4bq/dCBxdeG6oyB0aMO0bmcgdGjGsOG7nW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuTGluZWFyTGF5b3V0IikKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0X2ZvdW5kID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciByZXN1bHQgaW4gcmVzdWx0czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdF90ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dChyZXN1bHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB1c2VybmFtZS5sb3dlcigpIGluIHJlc3VsdF90ZXh0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHJlc3VsdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRfZm91bmQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlc3VsdF9mb3VuZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IHRyb25nIGvhur90IHF14bqjIHTDrG0ga2nhur9tIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHTDrG0ga2nhur9tIHTDoGkga2hv4bqjbjoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIGzhu5dpLCBz4butIGThu6VuZyBwaMawxqFuZyB0aOG7qWMgbeG7nyBsaW5rCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocHJvZmlsZV9saW5rKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDRzCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEPDoWNoIDI6IE3hu58gdHLhu7FjIHRp4bq/cCBVUkwgdGjDtG5nIHF1YSBoZWxwZXIub3Blbl91cmwoKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIk3hu58gdHJhbmcgY8OhIG5ow6JuIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3A6IHtwcm9maWxlX2xpbmt9IikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluaykKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDRzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4budIHRow6ptIGNobyB0cmFuZyBo4buTIHPGoSB04bqjaSB4b25nCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gbsO6dCBGb2xsb3cgdGhlbyByZXNvdXJjZS1pZCBjaMOtbmggeMOhYwogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIGR1bXAgbcOgbiBow6xuaCBraGkgdMOsbSBuw7p0IGZvbGxvdyIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcHJvZmlsZV9oZWFkZXJfZm9sbG93X2J1dHRvbiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSB0aGVvIHJlc291cmNlLWlkLCB0aOG7rSB0w6xtIHRoZW8gdGV4dAogICAgICAgICAgICBpZiBub3QgZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IHRoZW8gZMO1aSB0aGVvIHJlc291cmNlLWlkLCB0aOG7rSB0w6xtIHRoZW8gdGV4dCIpCiAgICAgICAgICAgICAgICAjIFTDrG0gbsO6dCB0aGVvIHRleHQKICAgICAgICAgICAgICAgIGZvbGxvd190ZXh0cyA9IFsiVGhlbyBkw7VpIiwgIkZvbGxvdyIsICLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIiwgIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgdGV4dCBpbiBmb2xsb3dfdGV4dHM6CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD10ZXh0KQogICAgICAgICAgICAgICAgICAgIGlmIGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGzhuqFpIGzhuqduIG7hu69hIG7hur91IGtow7RuZyB0w6xtIHRo4bqleSBuw7p0IGZvbGxvdwogICAgICAgICAgICBpZiBub3QgZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IHRoZW8gZMO1aSDhu58gbOG6p24gxJHhuqd1LCB0aOG7rSB2deG7kXQgbcOgbiBow6xuaCB2w6AgdMOsbSBs4bqhaSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIGtoaSB0w6xtIGzhuqFpIG7DunQgZm9sbG93IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9wcm9maWxlX2hlYWRlcl9mb2xsb3dfYnV0dG9uIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIG7DunQgdGhlbyB0ZXh0CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X3RleHRzID0gWyJUaGVvIGTDtWkiLCAiRm9sbG93IiwgIsSQYW5nIHRoZW8gZMO1aSIsICJGb2xsb3dpbmciLCAixJDDoyB5w6p1IGPhuqd1IiwgIlJlcXVlc3RlZCJdCiAgICAgICAgICAgICAgICAgICAgZm9yIHRleHQgaW4gZm9sbG93X3RleHRzOgogICAgICAgICAgICAgICAgICAgICAgICBmb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgdGhlbyBkw7VpIHNhdSBuaGnhu4F1IGzhuqduIHRo4butIikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHRleHQgY+G7p2EgbsO6dAogICAgICAgICAgICBidXR0b25fdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoZm9sbG93X2J1dHRvbikKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlRleHQgY+G7p2EgbsO6dCBmb2xsb3c6IHtidXR0b25fdGV4dH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBsw6AgIsSQYW5nIHRoZW8gZMO1aSIgaG/hurdjICJGb2xsb3dpbmciIHRow6wgxJHDoyBmb2xsb3cgcuG7k2kKICAgICAgICAgICAgaWYgYnV0dG9uX3RleHQgaW4gWyLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIl06CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0aGVvIGTDtWkgdMOgaSBraG/huqNuIHt1c2VybmFtZX0gdOG7qyB0csaw4bubYyIpCiAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBsw6AgIsSQw6MgecOqdSBj4bqndSIgaG/hurdjICJSZXF1ZXN0ZWQiIHRow6wgxJHDoyB5w6p1IGPhuqd1IGZvbGxvdyBy4buTaQogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHnDqnUgY+G6p3UgdGhlbyBkw7VpIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IHThu6sgdHLGsOG7m2MiKQogICAgICAgICAgICAgICAgcmV0dXJuIDUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgbMOgICJUaGVvIGTDtWkiIGhv4bq3YyAiRm9sbG93IiB0aMOsIGNsaWNrIHbDoG8gbsO6dAogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIlRoZW8gZMO1aSIsICJGb2xsb3ciXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRo4buxYyBoaeG7h24gY2xpY2sgdsOgbyBuw7p0IHRoZW8gZMO1aSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZm9sbG93X2J1dHRvbikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDJzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIGRpYWxvZyBoaeG7h24gbMOqbiBraMO0bmcKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdGjhu4Mga2nhu4NtIHRyYSBkaWFsb2csIG5oxrBuZyBjw7MgdGjhu4MgxJHDoyB0aGVvIGTDtWkgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHRy4bqhbmcgdGjDoWkgbsO6dAogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkaWFsb2dfY29udGFpbmVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2RpYWxvZ19jb250YWluZXIiKQogICAgICAgICAgICAgICAgaWYgZGlhbG9nX2NvbnRhaW5lcjoKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyB0aMO0bmcgYsOhbyAiVGjhu60gbOG6oWkgc2F1IiBraMO0bmcKICAgICAgICAgICAgICAgICAgICByZXRyeV90ZXh0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJUaOG7rSBs4bqhaSBzYXUiKQogICAgICAgICAgICAgICAgICAgIGlmIHJldHJ5X3RleHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgbmjhuqVuIG7DunQgIk9LIgogICAgICAgICAgICAgICAgICAgICAgICBva19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvaWdkc19hbGVydF9kaWFsb2dfcHJpbWFyeV9idXR0b24iKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBva19idXR0b246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIob2tfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJKb2Iga2jDtG5nIGhvw6BuIHRow6BuaCwgYuG7iyBnaeG7m2kgaOG6oW4gdGhlbyBkw7VpICh0aOG7rSBs4bqhaSBzYXUpIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDMKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgdGjDtG5nIGLDoW8gIlnDqnUgY+G6p3UgY+G7p2EgYuG6oW4gxJFhbmcgY2jhu50iIGtow7RuZwogICAgICAgICAgICAgICAgICAgIHdhaXRpbmdfdGV4dCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iWcOqdSBj4bqndSBj4bunYSBi4bqhbiDEkWFuZyBjaOG7nSIpCiAgICAgICAgICAgICAgICAgICAgaWYgd2FpdGluZ190ZXh0OgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gdsOgIG5o4bqlbiBuw7p0ICJPSyIKICAgICAgICAgICAgICAgICAgICAgICAgb2tfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2lnZHNfYWxlcnRfZGlhbG9nX3ByaW1hcnlfYnV0dG9uIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgb2tfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG9rX2J1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiSG/DoG4gdGjDoG5oLCB5w6p1IGPhuqd1IHRoZW8gZMO1aSDEkWFuZyBjaOG7nSBkdXnhu4d0IikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGzDoCBkaWFsb2cga2jDoWMsIG5o4bqlbiBPSwogICAgICAgICAgICAgICAgICAgIG9rX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9pZ2RzX2FsZXJ0X2RpYWxvZ19wcmltYXJ5X2J1dHRvbiIpCiAgICAgICAgICAgICAgICAgICAgaWYgb2tfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIob2tfYnV0dG9uKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBj4bqnbiB4w6FjIG5o4bqtbiB0aGVvIGTDtWkga2jDtG5nICh0w6BpIGtob+G6o24gcmnDqm5nIHTGsCkKICAgICAgICAgICAgICAgIGNvbmZpcm1fY29udGFpbmVyID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2xheW91dF9jb250YWluZXJfYm90dG9tX3NoZWV0IikKICAgICAgICAgICAgICAgIGlmIGNvbmZpcm1fY29udGFpbmVyOgogICAgICAgICAgICAgICAgICAgICMgVMOsbSBuw7p0ICJUaGVvIGTDtWkiIHRyb25nIGNvbnRhaW5lcgogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1fZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgdGV4dD0iVGhlbyBkw7VpIixjbGFzc19uYW1lPSJhbmRyb2lkLnZpZXcuVmlldyIpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNvbmZpcm1fZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybV9mb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJGb2xsb3ciLGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3IikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgY29uZmlybV9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoY29uZmlybV9mb2xsb3dfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHRleHQgc2F1IGtoaSBuaOG6pW4gdGhlbyBkw7VpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdGjhu4Mga2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIG7DunQsIG5oxrBuZyBjw7MgdGjhu4MgxJHDoyB0aGVvIGTDtWkgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdXBkYXRlZF9mb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Byb2ZpbGVfaGVhZGVyX2ZvbGxvd19idXR0b24iKQogICAgICAgICAgICAgICAgaWYgbm90IHVwZGF0ZWRfZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gbOG6oWkgdGhlbyB0ZXh0CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X3RleHRzID0gWyLEkGFuZyB0aGVvIGTDtWkiLCAiRm9sbG93aW5nIiwgIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiLCAiVGhlbyBkw7VpIiwgIkZvbGxvdyJdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yIHRleHQgaW4gZm9sbG93X3RleHRzOgogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2ZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHRleHQ9dGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodXBkYXRlZF9mb2xsb3dfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw6FjIHRyxrDhu51uZyBo4bujcCBraMOhYyBuaGF1CiAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF90ZXh0IGluIFsixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyJdOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJGb2xsb3cgdGjDoG5oIGPDtG5nISIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgICAgICAgICAgZWxpZiB1cGRhdGVkX3RleHQgaW4gWyLEkMOjIHnDqnUgY+G6p3UiLCAiUmVxdWVzdGVkIl06CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgZ+G7rWkgecOqdSBj4bqndSB0aGVvIGTDtWkgdGjDoG5oIGPDtG5nISIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA1CiAgICAgICAgICAgICAgICAgICAgZWxpZiB1cGRhdGVkX3RleHQgaW4gWyJUaGVvIGTDtWkiLCAiRm9sbG93Il06CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyB0aMO0bmcgYsOhbyAiWcOqdSBj4bqndSBj4bunYSBi4bqhbiDEkWFuZyBjaOG7nSIga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5fd2l0aF9yZXRyeSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdGjhu4Mga2nhu4NtIHRyYSB0aeG6v3AsIGdp4bqjIMSR4buLbmggbMOgIMSRw6MgZ+G7rWkgecOqdSBj4bqndSB0aGVvIGTDtWkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgd2FpdGluZ190ZXh0ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCB0ZXh0PSJZw6p1IGPhuqd1IGPhu6dhIGLhuqFuIMSRYW5nIGNo4budIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgd2FpdGluZ190ZXh0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHbDoCBuaOG6pW4gbsO6dCAiT0siCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBva19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvaWdkc19hbGVydF9kaWFsb2dfcHJpbWFyeV9idXR0b24iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb2tfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihva19idXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJIb8OgbiB0aMOgbmgsIHnDqnUgY+G6p3UgdGhlbyBkw7VpIMSRYW5nIGNo4budIGR1eeG7h3QiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIAoKIAoKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkZvbGxvdyBraMO0bmcgdGjDoG5oIGPDtG5nLCB0ZXh0IGPhu6dhIG7DunQgbMOgOiB7dXBkYXRlZF90ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQsIGPDsyB0aOG7gyDEkcOjIGZvbGxvdyB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBmb2xsb3cgc2F1IGtoaSBuaOG6pW4sIGdp4bqjIMSR4buLbmggxJHDoyB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlRleHQgY+G7p2EgbsO6dCBraMO0bmcga2jhu5twIHbhu5tpICdUaGVvIGTDtWknIGhv4bq3YyAnRm9sbG93Jzoge2J1dHRvbl90ZXh0fSIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBqb2IgZm9sbG93OiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiAyCiAgICAKICAgIGRlZiBfcGVyZm9ybV9saWtlX2pvYihzZWxmLCBwb3N0X2xpbms6IHN0cikgLT4gaW50OgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gam9iIGxpa2UgYsOgaSDEkcSDbmcgdHLDqm4gSW5zdGFncmFtCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcG9zdF9saW5rOiBMaW5rIMSR4bq/biBiw6BpIMSRxINuZyBj4bqnbiBsaWtlCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGludDogVHLhuqFuZyB0aMOhaSBqb2IgKDA6IGNoxrBhIGzDoG0sIDE6IGhvw6BuIHRow6BuaCwgMjogbOG7l2ksIDM6IGLhu4sgdW5saWtlKQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTeG7nyBiw6BpIMSRxINuZyBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wOiB7cG9zdF9saW5rfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE3hu58gdHLhu7FjIHRp4bq/cCBVUkwgdGjDtG5nIHF1YSBoZWxwZXIub3Blbl91cmwoKQogICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwb3N0X2xpbmspCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4budIHRyYW5nIGLDoGkgxJHEg25nIHThuqNpIHhvbmcgduG7m2kgdGjhu51pIGdpYW4gbmfhuqt1IG5oacOqbgogICAgICAgICAgICB3YWl0X3RpbWUgPSByYW5kb20ucmFuZGludCg0LCA2KSAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSBsw6puIDQtNnMKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQYW5nIGNo4budIHt3YWl0X3RpbWV9cyDEkeG7gyB0cmFuZyB04bqjaSB4b25nLi4uIikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhaXRfdGltZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVnXhu5F0IG5o4bq5IGzDqm4gdHLDqm4ga2hv4bqjbmcgMSBu4butYSBtw6BuIGjDrG5oIMSR4buDIGhp4buDbiB0aOG7iyBuw7p0IGxpa2UKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVnXhu5F0IG5o4bq5IMSR4buDIGhp4buDbiB0aOG7iyBuw7p0IGxpa2UiKQogICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpICAjIFTEg25nIHRo4budaSBnaWFuIGNo4budIGzDqm4gMS41cwogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIG7DunQgbGlrZSB0aGVvIHJlc291cmNlLWlkCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgZHVtcCBtw6BuIGjDrG5oIGtoaSB0w6xtIG7DunQgbGlrZSIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL3Jvd19mZWVkX2J1dHRvbl9saWtlIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5LCB0aOG7rSB2deG7kXQgbOG6p24gbuG7r2EKICAgICAgICAgICAgaWYgbm90IGxpa2VfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgbGlrZSwgdGjhu60gdnXhu5F0IGzhuqduIG7hu69hIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxLjUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBkdW1wIG3DoG4gaMOsbmgga2hpIHTDrG0gbOG6oWkgbsO6dCBsaWtlIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcm93X2ZlZWRfYnV0dG9uX2xpa2UiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgduG6q24ga2jDtG5nIHTDrG0gdGjhuqV5IHRoZW8gcmVzb3VyY2UtaWQsIHRo4butIHTDrG0gdGhlbyBjb250ZW50LWRlc2MKICAgICAgICAgICAgaWYgbm90IGxpa2VfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVGjhu60gdMOsbSBuw7p0IGxpa2UgdGhlbyBjb250ZW50LWRlc2MiKQogICAgICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVGjDrWNoIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGxpa2VfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSB24bubaSB0ZXh0IHRp4bq/bmcgQW5oCiAgICAgICAgICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iTGlrZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IHbhuqtuIGtow7RuZyB0w6xtIHRo4bqleSwgYsOhbyBs4buXaQogICAgICAgICAgICBpZiBub3QgbGlrZV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgbGlrZSBzYXUgbmhp4buBdSBs4bqnbiB0aOG7rSIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyBsaWtlIGNoxrBhIGLhurFuZyB0aHXhu5ljIHTDrW5oIHNlbGVjdGVkCiAgICAgICAgICAgIGlzX3NlbGVjdGVkID0gc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChsaWtlX2J1dHRvbikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Ugc2VsZWN0ZWQga2jDtG5nIGPDsyBnacOhIHRy4buLLCB0aOG7rSB0w6xtIG7DunQgIkLhu48gdGjDrWNoIiBob+G6t2MgIlVubGlrZSIKICAgICAgICAgICAgaWYgbm90IGlzX3NlbGVjdGVkOgogICAgICAgICAgICAgICAgdW5saWtlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJC4buPIHRow61jaCIpCiAgICAgICAgICAgICAgICBpZiBub3QgdW5saWtlX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICB1bmxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlVubGlrZSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlzX3NlbGVjdGVkID0gYm9vbCh1bmxpa2VfYnV0dG9uKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgxJHDoyBsaWtlIHLhu5NpIHRow6wgaG/DoG4gdGjDoG5oCiAgICAgICAgICAgIGlmIGlzX3NlbGVjdGVkOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBsaWtlIGLDoGkgdmnhur90IG7DoHkgdOG7qyB0csaw4bubYyIpCiAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTGlrZSBiw6BpIHZp4bq/dAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJOaOG6pW4gbsO6dCBsaWtlIikKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGxpa2VfYnV0dG9uKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gbMOqbiAycwogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHhlbSDEkcOjIGxpa2UgdGjDoG5oIGPDtG5nIGNoxrBhCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICMgS2jDtG5nIHRo4buDIGtp4buDbSB0cmEsIGdp4bqjIMSR4buLbmggxJHDoyBsaWtlIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIHRo4buDIGtp4buDbSB0cmEgbOG6oWkgdHLhuqFuZyB0aMOhaSBsaWtlLCBnaeG6oyDEkeG7i25oIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGNoZWNrX3VubGlrZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJC4buPIHRow61jaCIpCiAgICAgICAgICAgIGlmIG5vdCBjaGVja191bmxpa2U6CiAgICAgICAgICAgICAgICBjaGVja191bmxpa2UgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVW5saWtlIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgYuG6sW5nIHJlc291cmNlLWlkIHbDoCBzZWxlY3RlZAogICAgICAgICAgICBpZiBub3QgY2hlY2tfdW5saWtlOgogICAgICAgICAgICAgICAgbGlrZV9idXR0b25fYWZ0ZXIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvcm93X2ZlZWRfYnV0dG9uX2xpa2UiKQogICAgICAgICAgICAgICAgaWYgbGlrZV9idXR0b25fYWZ0ZXIgYW5kIHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b25fYWZ0ZXIpOgogICAgICAgICAgICAgICAgICAgIGNoZWNrX3VubGlrZSA9IFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiBjaGVja191bmxpa2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIGxpa2UgYsOgaSB2aeG6v3QgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIHjDoWMgbmjhuq1uIMSRw6MgbGlrZSBiw6BpIHZp4bq/dCIpCiAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBqb2IgbGlrZToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAKICAgIGRlZiBfY2FyZV9zd2lwZV9mZWVkKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIlZ14buRdCBi4bqjbmcgdGluIEluc3RhZ3JhbSAzLTUgYsOgaSBuaMawIG5nxrDhu51pIGTDuW5nIHRow7RuZyB0aMaw4budbmciIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIG51bV9zd2lwZXMgPSByYW5kb20ucmFuZGludCgzLCAxMCkKICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UobnVtX3N3aXBlcyk6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAjIFRo4budaSBnaWFuIGThu6tuZyBuZ+G6q3Ugbmhpw6puIDEuNSDigJMgMy41IGdpw6J5IGdp4buvYSBjw6FjIGzhuqduIHZ14buRdAogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHJhbmRvbS51bmlmb3JtKDEuNSwgMy41KSkKICAgICAgICAgICAgIyBRdWF5IGzhuqFpIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgdnXhu5F0IGZlZWQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfY2FyZV92aWV3X3N0b3JpZXMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiWGVtIHN0b3J5IDMtNSBzdG9yeSB24bubaSB04buRYyDEkeG7mSBuZ+G6q3Ugbmhpw6puIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHRo4budaSBnaWFuIHhlbSBzdG9yeSBjdeG7kWkgY8O5bmcgdOG7qyBhY2NvdW50CiAgICAgICAgICAgIGxhc3Rfdmlld19zdG9yaWVzID0gYWNjb3VudC5nZXQoImxhc3Rfdmlld19zdG9yaWVzIiwgMCkKICAgICAgICAgICAgY3VycmVudF90aW1lID0gaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICBpZiBsYXN0X3ZpZXdfc3RvcmllcyA+IDAgYW5kIChjdXJyZW50X3RpbWUgLSBsYXN0X3ZpZXdfc3RvcmllcykgPCAxMDgwMDogICMgMyB0aeG6v25nID0gMTA4MDAgZ2nDonkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkNoxrBhIMSR4bunIDMgdGnhur9uZyBr4buDIHThu6sgbOG6p24geGVtIHN0b3J5IGN14buRaSwgYuG7jyBxdWEiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKCiAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIHN0b3J5IHRodW1ibmFpbHMgdGhlbyByZXNvdXJjZS1pZAogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl93aXRoX3JldHJ5KCkKICAgICAgICAgICAgc3RvcnlfdGh1bWJzID0gW10KICAgICAgICAgICAgaWYgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHN0b3J5X3RodW1icyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2F2YXRhcl9pbWFnZV92aWV3IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSBjw7Mgw610IG5o4bqldCAyIHN0b3J5IHRow6wgbeG7m2kgbMOgbQogICAgICAgICAgICBpZiBsZW4oc3RvcnlfdGh1bWJzKSA8IDI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiS2jDtG5nIMSR4bunIHN0b3J5IMSR4buDIHhlbSAoY2jhu4kgY8OzIHtsZW4oc3RvcnlfdGh1bWJzKX0gc3RvcnkpLCBi4buPIHF1YSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBSYW5kb20gY2jhu41uIHN0b3J5IHThu6sgdGjhu6kgMiDEkeG6v24gY3Xhu5FpCiAgICAgICAgICAgIHN0YXJ0X2luZGV4ID0gcmFuZG9tLnJhbmRpbnQoMSwgbGVuKHN0b3J5X3RodW1icykgLSAxKQogICAgICAgICAgICBzZWxlY3RlZF9zdG9yeSA9IHN0b3J5X3RodW1ic1tzdGFydF9pbmRleF0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgQuG6pW0gdsOgbyBzdG9yeSDEkcaw4bujYyBjaOG7jW4KICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlbGVjdGVkX3N0b3J5KQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgWGVtIDMtOCBzdG9yeSB24bubaSB04buRYyDEkeG7mSBuZ+G6q3Ugbmhpw6puCiAgICAgICAgICAgIG51bV9zdG9yaWVzID0gcmFuZG9tLnJhbmRpbnQoMywgOCkKICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UobnVtX3N0b3JpZXMpOgogICAgICAgICAgICAgICAgIyBUaOG7nWkgZ2lhbiB4ZW0gc3Rvcnk6IG5n4bqvbiBob+G6t2MgZMOgaSBuZ+G6q3Ugbmhpw6puCiAgICAgICAgICAgICAgICB3YWl0ID0gcmFuZG9tLnVuaWZvcm0oMS4wLCAzLjApIGlmIHJhbmRvbS5jaG9pY2UoW1RydWUsIEZhbHNlXSkgZWxzZSByYW5kb20udW5pZm9ybSgzLjAsIDUuMCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YWl0KQogICAgICAgICAgICAgICAgIyBDaHV54buDbiBzYW5nIHN0b3J5IHRp4bq/cCB0aGVvIGLhurFuZyBjw6FjaCBi4bqlbSB2w6BvIHbhu4sgdHLDrSBuZ+G6q3Ugbmhpw6puIOG7nyBnaeG7r2EgbcOgbiBow6xuaAogICAgICAgICAgICAgICAgd2lkdGgsIGhlaWdodCA9IHNlbGYuaGVscGVyLmdldF9zY3JlZW5fc2l6ZSgpCiAgICAgICAgICAgICAgICAjIFbhu4sgdHLDrSBuZ+G6q3Ugbmhpw6puIOG7nyBnaeG7r2EgbcOgbiBow6xuaCAoNDAtNjAlIHdpZHRoLCA0MC02MCUgaGVpZ2h0KQogICAgICAgICAgICAgICAgcmFuZG9tX3ggPSBpbnQod2lkdGggKiByYW5kb20udW5pZm9ybSgwLjQsIDAuNikpCiAgICAgICAgICAgICAgICByYW5kb21feSA9IGludChoZWlnaHQgKiByYW5kb20udW5pZm9ybSgwLjQsIDAuNikpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXAocmFuZG9tX3gsIHJhbmRvbV95KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaG/DoXQgc3Rvcnkgdmlld2VyCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjhu51pIGdpYW4geGVtIHN0b3J5IGN14buRaSBjw7luZyB2w6BvIGFjY291bnQKICAgICAgICAgICAgaWYgYWNjb3VudCBhbmQgImlkIiBpbiBhY2NvdW50OgogICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7Imxhc3Rfdmlld19zdG9yaWVzIjogY3VycmVudF90aW1lfSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHhlbSBzdG9yeToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9jYXJlX3ZpZXdfbm90aWZpY2F0aW9ucyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJN4bufIHRhYiB0aMO0bmcgYsOhbyB2w6AgY3Xhu5luIG5o4bq5IiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAxOiBLaeG7g20gdHJhIGPDsyBub3RpZmljYXRpb24gYmFkZ2Uga2jDtG5nCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIG5vdGlmaWNhdGlvbl9iYWRnZSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9sZWRfYmFkZ2UiKQogICAgICAgICAgICBpZiBub3Qgbm90aWZpY2F0aW9uX2JhZGdlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIGPDsyBub3RpZmljYXRpb24gYmFkZ2UsIGLhu48gcXVhIHhlbSB0aMO0bmcgYsOhbyIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBCxrDhu5tjIDI6IELhuqVtIHbDoG8gbm90aWZpY2F0aW9uIHRhYgogICAgICAgICAgICBub3RpZmljYXRpb25fdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL25vdGlmaWNhdGlvbiIpCiAgICAgICAgICAgIGlmIG5vdCBub3RpZmljYXRpb25fdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG5vdGlmaWNhdGlvbiB0YWIiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG5vdGlmaWNhdGlvbl90YWIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgyLCAzKSkgICMgxJDhu41jIDItM3MKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyAzOiBSYW5kb20geOG7rSBsw70KICAgICAgICAgICAgaWYgcmFuZG9tLmNob2ljZShbVHJ1ZSwgRmFsc2VdKToKICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgYuG6pW0gdsOgbyBzdG9yeSByb3cKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgaWYgc2NyZWVuX3htbDoKICAgICAgICAgICAgICAgICAgICBzdG9yeV9yb3dzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNjcmVlbl94bWwsIHJlc291cmNlX2lkPSJhY3Rpdml0eV9mZWVkX25ld3NmZWVkX3N0b3J5X3JvdyIpCiAgICAgICAgICAgICAgICAgICAgaWYgc3Rvcnlfcm93cyBhbmQgbGVuKHN0b3J5X3Jvd3MpID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBSYW5kb20gY2jhu41uIGluZGV4IHThu6sgMS0zIChob+G6t2Mgw610IGjGoW4gbuG6v3Uga2jDtG5nIMSR4bunKQogICAgICAgICAgICAgICAgICAgICAgICBtYXhfaW5kZXggPSBtaW4oMywgbGVuKHN0b3J5X3Jvd3MpIC0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWF4X2luZGV4ID49IDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9pbmRleCA9IHJhbmRvbS5yYW5kaW50KDEsIG1heF9pbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkX3N0b3J5ID0gc3Rvcnlfcm93c1tzZWxlY3RlZF9pbmRleF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWxlY3RlZF9zdG9yeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgzLCA0KSkgICMgQ2jhu50gMy00cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFZ14buRdCBsw6puIDEtMyBs4bqnbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UocmFuZG9tLnJhbmRpbnQoMSwgMykpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwgMikpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFJhbmRvbSB2deG7kXQgbMOqbiBob+G6t2Mga2jDtG5nCiAgICAgICAgICAgICAgICBpZiByYW5kb20uY2hvaWNlKFtUcnVlLCBGYWxzZV0pOgogICAgICAgICAgICAgICAgICAgICMgVnXhu5F0IGzDqm4gMS0zIGzhuqduCiAgICAgICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UocmFuZG9tLnJhbmRpbnQoMSwgMykpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcChyYW5kb20udW5pZm9ybSgxLCAyKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQsaw4bubYyA0OiBRdWF5IGzhuqFpIGhvbWUKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgeGVtIHRow7RuZyBiw6FvOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgcGVyZm9ybV9jYXJlKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldKToKICAgICAgICAiIiJDaMSDbSBzw7NjIG5o4bq5IChtaW5pIGNhcmUpIGNobyB0w6BpIGtob+G6o24gSW5zdGFncmFtIiIiCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkLhuq90IMSR4bqndSBtaW5pIGNhcmUgY2hvIHTDoGkga2hv4bqjbiBJbnN0YWdyYW06IHthY2NvdW50Wyd1bmlxdWVfdXNlcm5hbWUnXX0iKQoKICAgICAgICAjIERhbmggc8OhY2ggY8OhYyBow6BuaCDEkeG7mW5nIGNoxINtIHPDs2MKICAgICAgICBhY3Rpb25zID0gW3NlbGYuX2NhcmVfc3dpcGVfZmVlZCwgc2VsZi5fY2FyZV92aWV3X3N0b3JpZXMsIHNlbGYuX2NhcmVfdmlld19ub3RpZmljYXRpb25zXQogICAgICAgIHJhbmRvbS5zaHVmZmxlKGFjdGlvbnMpCgogICAgICAgIGZvciBhY3Rpb24gaW4gYWN0aW9uczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWN0aW9uKGFjY291bnQpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBow6BuaCDEkeG7mW5nIHthY3Rpb24uX19uYW1lX199OiB7ZX0iKQoKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiSG/DoG4gdGjDoG5oIG1pbmkgY2FyZSBjaG8gdMOgaSBraG/huqNuIEluc3RhZ3JhbToge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSIpCiAgICAgICAgCiAgICBkZWYgX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2goc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gY8OhYyB0aGFvIHTDoWMgVUkgxJHhu4MgY2h1eeG7g24gdMOgaSBraG/huqNuIEluc3RhZ3JhbQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhcmdldF9hY2NvdW50OiBUw6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24gxJHhur9uCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVuIHbDoG8gdGFiICJUcmFuZyBjw6EgbmjDom4iCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICBwcm9maWxlX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJUcmFuZyBjw6EgbmjDom4iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHByb2ZpbGVfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSB0YWIgVHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVwIHbDoG8gdGFiIFRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocHJvZmlsZV90YWIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHVzZXJuYW1lIHThu6sgdGnDqnUgxJHhu4EgbOG7m24gdHJvbmcgYWN0aW9uIGJhcgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfbGFyZ2VfdGl0bGVfYXV0b19zaXplIgogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIHVzZXJuYW1lX3RpdGxlID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbCgKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ9ImNvbS5pbnN0YWdyYW0uYW5kcm9pZDppZC9hY3Rpb25fYmFyX2xhcmdlX3RpdGxlX2F1dG9fc2l6ZSIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX3RpdGxlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSB0acOqdSDEkeG7gSB1c2VybmFtZSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE5o4bqlcCB2w6BvIHRpw6p1IMSR4buBIHVzZXJuYW1lIMSR4buDIG3hu58gZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHVzZXJuYW1lX3RpdGxlKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdMOqbiB0w6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24gxJHhur9uCiAgICAgICAgICAgIHRhcmdldF91c2VybmFtZSA9IHRhcmdldF9hY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIiwgIiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gdHLhu7FjIHRp4bq/cCB0w6BpIGtob+G6o24gdGhlbyB0ZXh0IChjw6FjaCDEkcahbiBnaeG6o24gbmjhuqV0KQogICAgICAgICAgICBhY2NvdW50c194bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICB0YXJnZXRfaXRlbSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoYWNjb3VudHNfeG1sLCB0ZXh0PXRhcmdldF91c2VybmFtZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRfaXRlbToKICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSB0aGVvIGNvbnRlbnQtZGVzYyAoY8OzIHRo4buDIGNo4bupYSB0aMO0bmcgYsOhbykKICAgICAgICAgICAgICAgIHRhcmdldF9pdGVtcyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChhY2NvdW50c194bWwsIGNsYXNzX25hbWU9ImFuZHJvaWQudmlldy5WaWV3R3JvdXAiKQogICAgICAgICAgICAgICAgZm9yIGl0ZW0gaW4gdGFyZ2V0X2l0ZW1zOgogICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYyA9IGl0ZW0uZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXRfdXNlcm5hbWUgaW4gY29udGVudF9kZXNjIGFuZCAiVGjDqm0gdMOgaSBraG/huqNuIiBub3QgaW4gY29udGVudF9kZXNjIGFuZCAiVHJ1bmcgdMOibSB0w6BpIGtob+G6o24iIG5vdCBpbiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9pdGVtID0gaXRlbQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHRhcmdldF9pdGVtOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IHRyb25nIGRhbmggc8OhY2ggdMOgaSBraG/huqNuIEluc3RhZ3JhbSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IHTDoGkga2hv4bqjbiBsw6AgYuG7iyB2w7QgaGnhu4d1IGjDs2EgdHJvbmcgREIKICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQodGFyZ2V0X2FjY291bnRbImlkIl0sIHsKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogImRpc2FibGVkIiwKICAgICAgICAgICAgICAgICAgICAiZGlzYWJsZV9yZWFzb24iOiAiVMOgaSBraG/huqNuIGtow7RuZyBjw7MgdHLDqm4gdGhp4bq/dCBi4buLIiwKICAgICAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5o4bqlbiBCYWNrIMSR4buDIMSRw7NuZyBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBRdWF5IHbhu4EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOaOG6pXAgdsOgbyB0w6BpIGtob+G6o24gbeG7pWMgdGnDqnUKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHRhcmdldF9pdGVtKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNSkgICMgxJDhu6NpIGNodXnhu4NuIHTDoGkga2hv4bqjbiBob8OgbiB04bqldAogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIGNodXnhu4NuIHTDoGkga2hv4bqjbiB0aMOgbmggY8O0bmcgY2jGsGEKICAgICAgICAgICAgY3VycmVudF91c2VybmFtZSA9IHNlbGYuZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGN1cnJlbnRfdXNlcm5hbWUgPT0gdGFyZ2V0X3VzZXJuYW1lOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgY2h1eeG7g24gdMOgaSBraG/huqNuIHRow6BuaCBjw7RuZyBzYW5nIHt0YXJnZXRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIsSQw6MgYuG6pW0gdsOgbyB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gbmjGsG5nIGtp4buDbSB0cmEgbOG6oWkgdGjhuqV5IMSRYW5nIMSRxINuZyBuaOG6rXAgbMOgIHtjdXJyZW50X3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBjaHV54buDbiB0w6BpIGtob+G6o24gSW5zdGFncmFtIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIHF1YXkgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKHNlbGYpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdXNlcm5hbWUgY+G7p2EgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHIgaG/hurdjIE5vbmU6IFVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wLCBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgIyBDw6FjaCAxOiDEkOG7jWMgdOG7qyBhdmF0YXJfaW1hZ2VfdmlldyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIGF2YXRhcl92aWV3ID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2F2YXRhcl9pbWFnZV92aWV3IikKICAgICAgICAgICAgaWYgYXZhdGFyX3ZpZXc6CiAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2MgPSBhdmF0YXJfdmlldy5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgIyBjb250ZW50LWRlc2MgZOG6oW5nOiAiVGluIGPhu6dhIG5nb3RoaXllbjI2MDEwMDU5LCAwLzEsIENoxrBhIHhlbSIKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBhbmQgIlRpbiBj4bunYSAiIGluIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gY29udGVudF9kZXNjLnNwbGl0KCJUaW4gY+G7p2EgIiwgMSlbMV0uc3BsaXQoIiwiLCAxKVswXS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgbOG6pXkgdXNlcm5hbWUgdOG7qyB0cmFuZyBjaOG7pzoge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlcm5hbWUKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgY+G6r3QgY2h14buXaSBs4bqleSB1c2VybmFtZSB04burIGNvbnRlbnQtZGVzYzoge2V9IikKCiAgICAgICAgICAgICMgQ8OhY2ggMjogTuG6v3Uga2jDtG5nIHRow6BuaCBjw7RuZyDhu58gY8OhY2ggMSwgdGjhu60gdsOgbyB0cmFuZyBjw6EgbmjDom4KICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHVzZXJuYW1lIHThu6sgdHJhbmcgY2jhu6csIHRo4butIHbDoG8gdHJhbmcgY8OhIG5ow6JuIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuqVuIHbDoG8gdGFiICJUcmFuZyBjw6EgbmjDom4iCiAgICAgICAgICAgIHByb2ZpbGVfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50X2luX3htbChzY3JlZW5feG1sLCBjb250ZW50X2Rlc2M9IlRyYW5nIGPDoSBuaMOibiIpCiAgICAgICAgICAgIGlmIG5vdCBwcm9maWxlX3RhYjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIFRyYW5nIGPDoSBuaMOibiIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2ZpbGVfdGFiKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKCiAgICAgICAgICAgICMgxJDhu41jIHVzZXJuYW1lIHThu6sgdGnDqnUgxJHhu4EgbOG7m24gdHJvbmcgYWN0aW9uIGJhcgogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICByZXNvdXJjZV9pZD0iY29tLmluc3RhZ3JhbS5hbmRyb2lkOmlkL2FjdGlvbl9iYXJfbGFyZ2VfdGl0bGVfYXV0b19zaXplIgogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgdXNlcm5hbWVfdGl0bGUgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKAogICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPSJjb20uaW5zdGFncmFtLmFuZHJvaWQ6aWQvYWN0aW9uX2Jhcl9sYXJnZV90aXRsZV9hdXRvX3NpemUiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB1c2VybmFtZV90aXRsZToKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh1c2VybmFtZV90aXRsZSkKICAgICAgICAgICAgICAgICMgUXVheSBs4bqhaSB0cmFuZyBjaOG7pwogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgbOG6pXkgdXNlcm5hbWUgdOG7qyB0cmFuZyBjw6EgbmjDom46IHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJuYW1lCgogICAgICAgICAgICAjIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSB0acOqdSDEkeG7gSwgdGjhu60gdMOsbSBiaeG7g3UgdMaw4bujbmcgdHJhbmcgY8OhIG5ow6JuIGtow6FjCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSB0acOqdSDEkeG7gSB1c2VybmFtZSwgdGjhu60gdMOsbSB0aGVvIGPDoWNoIGtow6FjIikKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgdXNlcm5hbWUgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAiKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICBkZWYgZ2V0X2pvYl9wYXJhbXMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRoYW0gc+G7kSDEkeG7gyBn4buNaSBBUEkgbOG6pXkgam9iIGNobyBJbnN0YWdyYW0KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogVGhhbSBz4buRCiAgICAgICAgIiIiCiAgICAgICAgZ29saWtlX2lkID0gYWNjb3VudC5nZXQoImdvbGlrZV9pZCIpCiAgICAgICAgaWYgbm90IGdvbGlrZV9pZDoKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJpbnN0YWdyYW1fYWNjb3VudF9pZCI6IGdvbGlrZV9pZCwKICAgICAgICAgICAgImRhdGEiOiAibnVsbCIKICAgICAgICB9IA==').decode('utf-8'))
