import base64
exec(base64.b64decode('IiIiCk1pbmluZyBNYW5hZ2VtZW50IFNlcnZpY2UKUXXhuqNuIGzDvSBtaW5pbmcgdGjDtG5nIHF1YSBBUEkKIiIiCgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHRpbWUKaW1wb3J0IGpzb24KZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIExpc3QsIEFueSwgT3B0aW9uYWwKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IGNvbmZpZwppbXBvcnQgdXRpbHMKCiMgTG9nZ2VyCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIk1pbmluZ1NlcnZpY2UiKQoKCmNsYXNzIE1pbmluZ1NlcnZpY2U6CiAgICAiIiIKICAgIFNlcnZpY2UgcXXhuqNuIGzDvSBtaW5pbmcgdGjDtG5nIHF1YSBBUEkKICAgIC0gU3luYyBjb25maWcgdOG7qyBzZXJ2ZXIgduG7gSBjbGllbnQgcXVhIE1RVFQKICAgIC0gQXV0by1zdGFydCBtaW5lcnMga2hpIGJvb3QKICAgIC0gTW9uaXRvciBoYXNoIHJhdGUgdsOgIHN0YXR1cwogICAgIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9zZXJ2aWNlLCBiYXNlX3VybDogT3B0aW9uYWxbc3RyXSA9IE5vbmUpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBNaW5pbmcgU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGRiX3NlcnZpY2U6IERhdGFiYXNlIHNlcnZpY2UgxJHhu4MgbMawdSB0aMO0bmcgdGluCiAgICAgICAgICAgIGJhc2VfdXJsOiBVUkwgY+G7p2EgbWluaW5nIEFQSSBzZXJ2ZXIgKG3hurdjIMSR4buLbmggbOG6pXkgdOG7qyBjb25maWcuREVWSUNFX0lQKQogICAgICAgICIiIgogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgIyBT4butIGThu6VuZyBERVZJQ0VfSVAgdOG7qyBjb25maWcgbuG6v3Uga2jDtG5nIHRydXnhu4FuIGJhc2VfdXJsCiAgICAgICAgaWYgYmFzZV91cmwgaXMgTm9uZToKICAgICAgICAgICAgYmFzZV91cmwgPSBmImh0dHA6Ly97Y29uZmlnLkRFVklDRV9JUH06OTA5OCIKICAgICAgICBzZWxmLmJhc2VfdXJsID0gYmFzZV91cmwKICAgICAgICAKICAgICAgICAjIExvYWQgbWluaW5nIGluZm8gdOG7qyBEQgogICAgICAgIHNlbGYuX2xvYWRfbWluaW5nX2luZm8oKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB2w6Agc3luYyBjb25maWcga2hpIGto4bufaSDEkeG7mW5nCiAgICAgICAgc2VsZi5fY2hlY2tfYW5kX3N5bmNfb25fc3RhcnR1cCgpCiAgICAgICAgCiAgICBkZWYgX2xvYWRfbWluaW5nX2luZm8oc2VsZik6CiAgICAgICAgIiIiTG9hZCBtaW5pbmcgaW5mbyB2w6AgY29uZmlnIHThu6sgZGF0YWJhc2UiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTWluaW5nIGNvbmZpZzogQ+G6pXUgaMOsbmggdOG7qyBNUVRULCBjaOG7iSB1cGRhdGUga2hpIGPDsyBNUVRUCiAgICAgICAgICAgIHNlbGYubWluaW5nX2NvbmZpZyA9IHNlbGYuZGIuZ2V0KCJtaW5pbmctY29uZmlnIiwgewogICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiAwLAogICAgICAgICAgICAgICAgImF1dG9fc3RhcnQiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJtaW5lcnMiOiBbXQogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBNaW5pbmcgaW5mbzogVHLhuqFuZyB0aMOhaSB0aOG7sWMgdOG6vyB04burIEFQSSwgc3luYyDEkeG7i25oIGvhu7MKICAgICAgICAgICAgc2VsZi5taW5pbmdfaW5mbyA9IHNlbGYuZGIuZ2V0KCJtaW5pbmctaW5mbyIsIHsKICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IDAsCiAgICAgICAgICAgICAgICAidG90YWxfbWluZXJzIjogMCwKICAgICAgICAgICAgICAgICJydW5uaW5nX21pbmVycyI6IDAsCiAgICAgICAgICAgICAgICAic3RvcHBlZF9taW5lcnMiOiAwLAogICAgICAgICAgICAgICAgIm1pbmVycyI6IFtdLAogICAgICAgICAgICAgICAgImVycm9yX21lc3NhZ2UiOiAiIgogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiTG9hZGVkIG1pbmluZyBjb25maWc6IHtsZW4oc2VsZi5taW5pbmdfY29uZmlnLmdldCgnbWluZXJzJywgW10pKX0gbWluZXJzIikKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiTG9hZGVkIG1pbmluZyBpbmZvOiB7c2VsZi5taW5pbmdfaW5mby5nZXQoJ3J1bm5pbmdfbWluZXJzJywgMCl9L3tzZWxmLm1pbmluZ19pbmZvLmdldCgndG90YWxfbWluZXJzJywgMCl9IHJ1bm5pbmciKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGxvYWQgbWluaW5nIGRhdGE6IHtlfSIpCiAgICAgICAgICAgIHNlbGYubWluaW5nX2NvbmZpZyA9IHsKICAgICAgICAgICAgICAgICJsYXN0X3N5bmNfY29uZmlnIjogMCwKICAgICAgICAgICAgICAgICJhdXRvX3N0YXJ0IjogRmFsc2UsCiAgICAgICAgICAgICAgICAibWluZXJzIjogW10KICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLm1pbmluZ19pbmZvID0gewogICAgICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogMCwKICAgICAgICAgICAgICAgICJ0b3RhbF9taW5lcnMiOiAwLAogICAgICAgICAgICAgICAgInJ1bm5pbmdfbWluZXJzIjogMCwKICAgICAgICAgICAgICAgICJzdG9wcGVkX21pbmVycyI6IDAsCiAgICAgICAgICAgICAgICAibWluZXJzIjogW10sCiAgICAgICAgICAgICAgICAiZXJyb3JfbWVzc2FnZSI6IHN0cihlKQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBfc2F2ZV9taW5pbmdfY29uZmlnKHNlbGYpOgogICAgICAgICIiIkzGsHUgbWluaW5nIGNvbmZpZyB2w6BvIGRhdGFiYXNlIChjaOG7iSBraGkgY8OzIE1RVFQgdXBkYXRlKSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5kYi5zZXQoIm1pbmluZy1jb25maWciLCBzZWxmLm1pbmluZ19jb25maWcpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiU2F2ZWQgbWluaW5nIGNvbmZpZyB0byBkYXRhYmFzZSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbMawdSBtaW5pbmcgY29uZmlnOiB7ZX0iKQogICAgCiAgICBkZWYgX3NhdmVfbWluaW5nX2luZm8oc2VsZik6CiAgICAgICAgIiIiTMawdSBtaW5pbmcgaW5mbyB2w6BvIGRhdGFiYXNlIChzeW5jIMSR4buLbmgga+G7syB04burIEFQSSBzdGF0dXMpIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmRiLnNldCgibWluaW5nLWluZm8iLCBzZWxmLm1pbmluZ19pbmZvKQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIlNhdmVkIG1pbmluZyBpbmZvIHRvIGRhdGFiYXNlIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBsxrB1IG1pbmluZyBpbmZvOiB7ZX0iKQogICAgCiAgICBkZWYgX2NoZWNrX2FuZF9zeW5jX29uX3N0YXJ0dXAoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6Agc3luYyBtaW5pbmcgY29uZmlnIGtoaSBraOG7n2kgxJHhu5luZyDhu6luZyBk4bulbmcKICAgICAgICAKICAgICAgICBMb2dpYzoKICAgICAgICAxLiBLaeG7g20gdHJhIGPDsyBtaW5pbmctY29uZmlnIGtow7RuZwogICAgICAgIDIuIEtp4buDbSB0cmEgbWluaW5nIEFQSSBjw7MgY2jhuqF5IGtow7RuZwogICAgICAgIDMuIE7hur91IEFQSSBraMO0bmcgY2jhuqF5IOKGkiBTdGFydCBtaW5pbmcgc2VydmVyIGLhurFuZyB0bXV4CiAgICAgICAgNC4gxJDhu6NpIDIwcyDihpIgQ2hlY2sgbOG6oWkKICAgICAgICA1LiBO4bq/dSBr4bq/dCBu4buRaSDEkcaw4bujYyBuaMawbmcga2jDtG5nIGPDsyBtaW5lciBydW5uaW5nIOKGkiBVcGRhdGUgY29uZmlnCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OzIGNvbmZpZyBraMO0bmcKICAgICAgICAgICAgaWYgbm90IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoIm1pbmVycyIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkNoxrBhIGPDsyBtaW5pbmcgY29uZmlnLCBi4buPIHF1YSBzeW5jIGzDumMgc3RhcnR1cCIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsX3ZlcnNpb24gPSBzZWxmLm1pbmluZ19jb25maWcuZ2V0KCJsYXN0X3N5bmNfY29uZmlnIiwgMCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaeG7g20gdHJhIG1pbmluZyBjb25maWcgbMO6YyBzdGFydHVwIChsb2NhbCB2ZXJzaW9uOiB7bG9jYWxfdmVyc2lvbn0pLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBtaW5pbmcgQVBJIGPDsyBob+G6oXQgxJHhu5luZyBraMO0bmcKICAgICAgICAgICAgaWYgbm90IHNlbGYuY2hlY2tfbWluaW5nX2FwaV9oZWFsdGgoKToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJNaW5pbmcgQVBJIGNoxrBhIGNo4bqheSwgxJFhbmcga2jhu59pIMSR4buZbmcgbWluaW5nIHNlcnZlci4uLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU3RhcnQgbWluaW5nIHNlcnZlciBi4bqxbmcgdG11eAogICAgICAgICAgICAgICAgaWYgc2VsZi5fc3RhcnRfbWluaW5nX3NlcnZlcigpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGfhu61pIGzhu4duaCBraOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyLCDEkeG7o2kgMjBzLi4uIikKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIwKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgbOG6oWkgc2F1IDIwcwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmNoZWNrX21pbmluZ19hcGlfaGVhbHRoKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiTWluaW5nIEFQSSB24bqrbiBjaMawYSBz4bq1biBzw6BuZyBzYXUgMjBzLCBi4buPIHF1YSBzeW5jIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk1pbmluZyBBUEkgxJHDoyBz4bq1biBzw6BuZyBzYXUga2hpIGto4bufaSDEkeG7mW5nIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4Mga2jhu59pIMSR4buZbmcgbWluaW5nIHNlcnZlciwgYuG7jyBxdWEgc3luYyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHN0YXR1cyB04burIEFQSQogICAgICAgICAgICBzdGF0dXMgPSBzZWxmLmdldF9zdGF0dXMoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHN0YXR1cy5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIHN0YXR1cyB04burIG1pbmluZyBBUEk6IHtzdGF0dXMuZ2V0KCdlcnJvcicpfSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIG1pbmVycyA9IHN0YXR1cy5nZXQoIm1pbmVycyIsIFtdKQogICAgICAgICAgICBydW5uaW5nX21pbmVycyA9IFttIGZvciBtIGluIG1pbmVycyBpZiBtLmdldCgic3RhdHVzIikgPT0gInJ1bm5pbmciXQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgY8OzIG1pbmVycyDEkWFuZyBjaOG6oXkg4oaSIFVwZGF0ZSBjb25maWcKICAgICAgICAgICAgaWYgbm90IHJ1bm5pbmdfbWluZXJzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJNaW5pbmcgQVBJIGPDsyB7bGVuKG1pbmVycyl9IG1pbmVycyBuaMawbmcga2jDtG5nIGPDsyBtaW5lciBuw6BvIMSRYW5nIGNo4bqheSwgxJFhbmcgdXBkYXRlIGNvbmZpZy4uLiIpCiAgICAgICAgICAgICAgICBzZWxmLl9mb3JjZV91cGRhdGVfY29uZmlnKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTWluaW5nIEFQSSDEkWFuZyBjaOG6oXkge2xlbihydW5uaW5nX21pbmVycyl9L3tsZW4obWluZXJzKX0gbWluZXJzLCBraMO0bmcgY+G6p24gdXBkYXRlIikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgY2hlY2sgdsOgIHN5bmMgbMO6YyBzdGFydHVwOiB7ZX0iKQogICAgCiAgICBkZWYgX3N0YXJ0X21pbmluZ19zZXJ2ZXIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyIGLhurFuZyB0bXV4IHRyb25nIFRlcm11eAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgZ+G7rWkgbOG7h25oIHRow6BuaCBjw7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0IHN1YnByb2Nlc3MKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG7h25oIHRtdXggxJHhu4Mgc3RhcnQgbWluaW5nIHNlcnZlcgogICAgICAgICAgICBjbWQgPSBbCiAgICAgICAgICAgICAgICAidG11eCIsICJuZXctc2Vzc2lvbiIsICItZCIsICItcyIsICJtaW5pbmciLAogICAgICAgICAgICAgICAgIi9kYXRhL2RhdGEvY29tLnRlcm11eC9maWxlcy9ob21lL3VidW50dS9zdGFydHVidW50dS5zaCIKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyOiB7JyAnLmpvaW4oY21kKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB0ZXh0PVRydWUsCiAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGfhu61pIGzhu4duaCBraOG7n2kgxJHhu5luZyBtaW5pbmcgc2VydmVyIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLkNhbGxlZFByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkga2jhu59pIMSR4buZbmcgbWluaW5nIHNlcnZlcjoge2Uuc3RkZXJyfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgbOG7h25oIHRtdXgiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtow7RuZyB4w6FjIMSR4buLbmgga2hpIGto4bufaSDEkeG7mW5nIG1pbmluZyBzZXJ2ZXI6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2ZvcmNlX3VwZGF0ZV9jb25maWcoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgw4lwIGJ14buZYyB1cGRhdGUgY29uZmlnIGzDqm4gbWluaW5nIEFQSQogICAgICAgIETDuW5nIGtoaSBraOG7n2kgxJHhu5luZyBob+G6t2Mga2hpIHBow6F0IGhp4buHbiBjb25maWcga2jDtG5nIGto4bubcAogICAgICAgIELhu48gcXVhIGtp4buDbSB0cmEgdGltZXN0YW1wCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5taW5pbmdfY29uZmlnLmdldCgibWluZXJzIik6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIGPDsyBtaW5pbmcgY29uZmlnIMSR4buDIHVwZGF0ZSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgRm9yY2U9VHJ1ZSDEkeG7gyBi4buPIHF1YSBraeG7g20gdHJhIHRpbWVzdGFtcAogICAgICAgICAgICByZXN1bHQgPSBzZWxmLnVwZGF0ZV9jb25maWcoc2VsZi5taW5pbmdfY29uZmlnLCBmb3JjZT1UcnVlKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0LmdldCgic3VjY2VzcyIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIuKchSDEkMOjIGZvcmNlIHVwZGF0ZSBtaW5pbmcgY29uZmlnIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIuKdjCBM4buXaSBraGkgZm9yY2UgdXBkYXRlIGNvbmZpZzoge3Jlc3VsdC5nZXQoJ2Vycm9yJyl9IikKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGZvcmNlIHVwZGF0ZSBjb25maWc6IHtlfSIpCiAgICAKICAgIGRlZiBnZXRfc3RhdHVzKHNlbGYsIHNhdmVfdG9fZGI6IGJvb2wgPSBGYWxzZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdHLhuqFuZyB0aMOhaSBtaW5pbmcgdOG7qyBBUEkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBzYXZlX3RvX2RiOiBERVBSRUNBVEVEIC0ga2jDtG5nIGPDsm4gc+G7rSBk4bulbmcgbuG7r2EKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0OiBTdGF0dXMgY+G7p2EgdOG6pXQgY+G6oyBtaW5lcnMKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGYie3NlbGYuYmFzZV91cmx9L2FwaS9zdGF0dXMiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kga2hpIGzhuqV5IHN0YXR1czoge2V9IgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZXJyb3IiOiBzdHIoZSksCiAgICAgICAgICAgICAgICAibWluZXJzIjogW10KICAgICAgICAgICAgfQogICAgCiAgICBkZWYgZ2V0X21pbmVyX3N0YXR1cyhzZWxmLCBuYW1lOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRy4bqhbmcgdGjDoWkgY+G7p2EgbeG7mXQgbWluZXIgY+G7pSB0aOG7gwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG5hbWU6IFTDqm4gbWluZXIKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdDogU3RhdHVzIGPhu6dhIG1pbmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgKICAgICAgICAgICAgICAgIGYie3NlbGYuYmFzZV91cmx9L2FwaS9zdGF0dXMiLAogICAgICAgICAgICAgICAgcGFyYW1zPXsibmFtZSI6IG5hbWV9LAogICAgICAgICAgICAgICAgdGltZW91dD01CiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSBraGkgbOG6pXkgc3RhdHVzIG1pbmVyIHtuYW1lfToge2V9IgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZXJyb3IiOiBzdHIoZSkKICAgICAgICAgICAgfQogICAgCiAgICBkZWYgdXBkYXRlX2NvbmZpZyhzZWxmLCBtcXR0X21pbmluZ19jb25maWc6IERpY3Rbc3RyLCBBbnldLCBmb3JjZTogYm9vbCA9IEZhbHNlKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBVcGRhdGUgbWluaW5nIGNvbmZpZyB04burIE1RVFQgc2VydmVyCiAgICAgICAgQ29uZmlnIG7DoHkgQ0jhu4ggdXBkYXRlIGtoaSBjw7MgTVFUVCB1cGRhdGUsIEtIw5RORyBzeW5jIMSR4buLbmgga+G7swogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1xdHRfbWluaW5nX2NvbmZpZzogewogICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiB0aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAiYXV0b19zdGFydCI6IGJvb2wsCiAgICAgICAgICAgICAgICAibWluZXJzIjogWy4uLl0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JjZTogVHJ1ZSDEkeG7gyBi4buPIHF1YSBraeG7g20gdHJhIHRpbWVzdGFtcCAoZMO5bmcga2hpIHN0YXJ0dXApCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IEvhur90IHF14bqjIHVwZGF0ZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBWYWxpZGF0ZSBjb25maWcKICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UobXF0dF9taW5pbmdfY29uZmlnLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZXJyb3IiOiAiSW52YWxpZCBjb25maWcgZm9ybWF0IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aW1lc3RhbXAgbeG7m2kKICAgICAgICAgICAgbmV3X3RpbWVzdGFtcCA9IG1xdHRfbWluaW5nX2NvbmZpZy5nZXQoImxhc3Rfc3luY19jb25maWciLCAwKQogICAgICAgICAgICBjdXJyZW50X3RpbWVzdGFtcCA9IHNlbGYubWluaW5nX2NvbmZpZy5nZXQoImxhc3Rfc3luY19jb25maWciLCAwKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJVcGRhdGUgY29uZmlnOiBuZXdfdGltZXN0YW1wPXtuZXdfdGltZXN0YW1wfSwgY3VycmVudD17Y3VycmVudF90aW1lc3RhbXB9LCBmb3JjZT17Zm9yY2V9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2jhu4kgdXBkYXRlIG7hur91IGNvbmZpZyBt4bubaSBoxqFuIEhP4bq2QyBmb3JjZT1UcnVlCiAgICAgICAgICAgIGlmIG5vdCBmb3JjZSBhbmQgbmV3X3RpbWVzdGFtcCA8PSBjdXJyZW50X3RpbWVzdGFtcDoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJDb25maWcga2jDtG5nIG3hu5tpIGjGoW4sIHNraXAgdXBkYXRlIikKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIjogIkNvbmZpZyBpcyB1cC10by1kYXRlIiwKICAgICAgICAgICAgICAgICAgICAidXBkYXRlZCI6IEZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu61pIGNvbmZpZyDEkeG6v24gbWluaW5nIEFQSQogICAgICAgICAgICBtaW5lcnNfZGF0YSA9IG1xdHRfbWluaW5nX2NvbmZpZy5nZXQoIm1pbmVycyIsIFtdKQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgZiJ7c2VsZi5iYXNlX3VybH0vYXBpL3VwZGF0ZS1jb25maWciLAogICAgICAgICAgICAgICAganNvbj1taW5lcnNfZGF0YSwKICAgICAgICAgICAgICAgIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9LAogICAgICAgICAgICAgICAgdGltZW91dD0zMAogICAgICAgICAgICApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgdXBkYXRlIEFQSSB0aMOgbmggY8O0bmcsIGzGsHUgY29uZmlnIHbDoG8gbWluaW5nLWNvbmZpZwogICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdWNjZXNzIik6CiAgICAgICAgICAgICAgICAjIEzGsHUgdsOgbyBtaW5pbmctY29uZmlnIChjaOG7iSB1cGRhdGUga2hpIGPDsyBNUVRUKQogICAgICAgICAgICAgICAgc2VsZi5taW5pbmdfY29uZmlnID0gbXF0dF9taW5pbmdfY29uZmlnCiAgICAgICAgICAgICAgICBzZWxmLl9zYXZlX21pbmluZ19jb25maWcoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBVcGRhdGVkIG1pbmluZyBjb25maWc6IHtyZXN1bHQuZ2V0KCd1cGRhdGVkJywgMCl9L3tyZXN1bHQuZ2V0KCd0b3RhbCcsIDApfSBtaW5lcnMiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIExvZyBhdXRvLXN0YXJ0IHJlc3VsdCBu4bq/dSBjw7MKICAgICAgICAgICAgICAgIGF1dG9fc3RhcnRfcmVzdWx0ID0gcmVzdWx0LmdldCgiYXV0b19zdGFydF9yZXN1bHQiKQogICAgICAgICAgICAgICAgaWYgYXV0b19zdGFydF9yZXN1bHQ6CiAgICAgICAgICAgICAgICAgICAgc3RvcHBlZCA9IGF1dG9fc3RhcnRfcmVzdWx0LmdldCgic3RvcHBlZCIsIFtdKQogICAgICAgICAgICAgICAgICAgIHN0YXJ0ZWQgPSBhdXRvX3N0YXJ0X3Jlc3VsdC5nZXQoInN0YXJ0ZWQiLCBbXSkKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIkF1dG8tcmVzdGFydDogc3RvcHBlZD17bGVuKHN0b3BwZWQpfSwgc3RhcnRlZD17bGVuKHN0YXJ0ZWQpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTWluaW5nIEFQSSDEkcOjIHThu7EgxJHhu5luZyBzdG9wL3N0YXJ0IGtoaSBhdXRvX3N0YXJ0PXRydWUKICAgICAgICAgICAgICAgICMgU3RhdHVzIHPhur0gxJHGsOG7o2Mgc3luYyDEkeG7i25oIGvhu7MgYuG7n2kgc3luY19zdGF0dXNfZnJvbV9hcGkoKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICAKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kga2hpIHVwZGF0ZSBjb25maWc6IHtlfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpCiAgICAgICAgICAgIH0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kga2jDtG5nIG1vbmcgxJHhu6NpIGtoaSB1cGRhdGUgY29uZmlnOiB7ZX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJlcnJvciI6IHN0cihlKQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBzdGFydF9taW5lcihzZWxmLCBuYW1lOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFN0YXJ0IG3hu5l0IG1pbmVyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbmFtZTogVMOqbiBtaW5lcgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0OiBL4bq/dCBxdeG6oyBzdGFydAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgZiJ7c2VsZi5iYXNlX3VybH0vYXBpL3N0YXJ0IiwKICAgICAgICAgICAgICAgIGpzb249eyJuYW1lIjogbmFtZX0sCiAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgcmVzdWx0ID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdWNjZXNzIik6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBTdGFydGVkIG1pbmVyOiB7bmFtZX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiLinYwgRmFpbGVkIHRvIHN0YXJ0IG1pbmVyIHtuYW1lfToge3Jlc3VsdC5nZXQoJ21lc3NhZ2UnKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICAKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBzdGFydCBtaW5lciB7bmFtZX06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIHN0b3BfbWluZXIoc2VsZiwgbmFtZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBTdG9wIG3hu5l0IG1pbmVyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbmFtZTogVMOqbiBtaW5lcgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0OiBL4bq/dCBxdeG6oyBzdG9wCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICBmIntzZWxmLmJhc2VfdXJsfS9hcGkvc3RvcCIsCiAgICAgICAgICAgICAgICBqc29uPXsibmFtZSI6IG5hbWV9LAogICAgICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sCiAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0LmdldCgic3VjY2VzcyIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLinIUgU3RvcHBlZCBtaW5lcjoge25hbWV9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYi4p2MIEZhaWxlZCB0byBzdG9wIG1pbmVyIHtuYW1lfToge3Jlc3VsdC5nZXQoJ21lc3NhZ2UnKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICAKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBzdG9wIG1pbmVyIHtuYW1lfToge2V9IikKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZXJyb3IiOiBzdHIoZSkKICAgICAgICAgICAgfQogICAgCiAgICBkZWYgc3RvcF9taW5lcnMoc2VsZiwgbmFtZXM6IExpc3Rbc3RyXSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgU3RvcCBuaGnhu4F1IG1pbmVycwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG5hbWVzOiBEYW5oIHPDoWNoIHTDqm4gbWluZXJzCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Q6IEvhur90IHF14bqjIHN0b3AKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgIGYie3NlbGYuYmFzZV91cmx9L2FwaS9zdG9wIiwKICAgICAgICAgICAgICAgIGpzb249eyJuYW1lcyI6IG5hbWVzfSwKICAgICAgICAgICAgICAgIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9LAogICAgICAgICAgICAgICAgdGltZW91dD0zMAogICAgICAgICAgICApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgIHN0b3BwZWQgPSByZXN1bHQuZ2V0KCJzdG9wcGVkIiwgW10pCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBTdG9wcGVkIHtsZW4oc3RvcHBlZCl9IG1pbmVycyIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHN0b3AgbWluZXJzOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJlcnJvciI6IHN0cihlKQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBmb3JjZV9zdG9wX2FsbChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBFbWVyZ2VuY3kgc3RvcCB04bqldCBj4bqjIG1pbmluZyBwcm9jZXNzZXMKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0OiBL4bq/dCBxdeG6oyBmb3JjZSBzdG9wCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICBmIntzZWxmLmJhc2VfdXJsfS9hcGkvZm9yY2Utc3RvcC1hbGwiLAogICAgICAgICAgICAgICAgdGltZW91dD0zMAogICAgICAgICAgICApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgIGtpbGxlZF9jb3VudCA9IHJlc3VsdC5nZXQoImtpbGxlZF9jb3VudCIsIDApCiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKaoO+4jyBGb3JjZSBraWxsZWQge2tpbGxlZF9jb3VudH0gbWluaW5nIHByb2Nlc3NlcyIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGZvcmNlIHN0b3AgYWxsOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJlcnJvciI6IHN0cihlKQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBmb3JtYXRfaGFzaF9yYXRlKHNlbGYsIGhhc2hfcmF0ZV9oczogZmxvYXQpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBGb3JtYXQgaGFzaCByYXRlIHThu6sgSC9zIHNhbmcgS0gvcywgTUgvcywgR0gvcwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGhhc2hfcmF0ZV9oczogSGFzaCByYXRlIHRyb25nIEgvcwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IEZvcm1hdHRlZCBoYXNoIHJhdGUKICAgICAgICAiIiIKICAgICAgICBpZiBoYXNoX3JhdGVfaHMgPj0gMWU5OgogICAgICAgICAgICByZXR1cm4gZiJ7aGFzaF9yYXRlX2hzLzFlOTouMmZ9IEdIL3MiCiAgICAgICAgZWxpZiBoYXNoX3JhdGVfaHMgPj0gMWU2OgogICAgICAgICAgICByZXR1cm4gZiJ7aGFzaF9yYXRlX2hzLzFlNjouMmZ9IE1IL3MiCiAgICAgICAgZWxpZiBoYXNoX3JhdGVfaHMgPj0gMWUzOgogICAgICAgICAgICByZXR1cm4gZiJ7aGFzaF9yYXRlX2hzLzFlMzouMmZ9IEtIL3MiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIGYie2hhc2hfcmF0ZV9oczouMmZ9IEgvcyIKICAgIAogICAgZGVmIHN5bmNfY29uZmlnX2Zyb21fbXF0dChzZWxmLCBtcXR0X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgU3luYyBjb25maWcgdOG7qyBNUVRUIHNlcnZlciB24buBIGNsaWVudAogICAgICAgIENI4buIIGfhu41pIGtoaSBjw7MgTVFUVCB1cGRhdGUsIEtIw5RORyBn4buNaSDEkeG7i25oIGvhu7MKICAgICAgICAKICAgICAgICBMb2dpYzoKICAgICAgICAxLiBM4bqleSBsYXN0X3N5bmNfY29uZmlnIHThu6sgbWluaW5nLWNvbmZpZwogICAgICAgIDIuIFNvIHPDoW5oIHbhu5tpIHRpbWVzdGFtcCB04burIE1RVFQKICAgICAgICAzLiBO4bq/dSBNUVRUIG3hu5tpIGjGoW46CiAgICAgICAgICAgLSBLaeG7g20gdHJhIG1pbmluZyBBUEkgY8OzIMSRYW5nIGNo4bqheSBraMO0bmcKICAgICAgICAgICAtIE7hur91IMSRYW5nIGNo4bqheTogS2nhu4NtIHRyYSB2ZXJzaW9uIOKGkiBVcGRhdGUgbuG6v3UgY+G6p24KICAgICAgICAgICAtIE7hur91IGtow7RuZyBjaOG6oXk6IFVwZGF0ZSBsdcO0bgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1xdHRfY29uZmlnOiBDb25maWcgbmjhuq1uIHThu6sgTVFUVCBzZXJ2ZXIgduG7m2kgY+G6pXUgdHLDumM6CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiB0aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgImF1dG9fc3RhcnQiOiBib29sLAogICAgICAgICAgICAgICAgICAgICJtaW5lcnMiOiBbLi4uXQogICAgICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Ugc3luYyB0aMOgbmggY8O0bmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIG1xdHRfdGltZXN0YW1wID0gbXF0dF9jb25maWcuZ2V0KCJsYXN0X3N5bmNfY29uZmlnIiwgMCkKICAgICAgICAgICAgbG9jYWxfdGltZXN0YW1wID0gc2VsZi5taW5pbmdfY29uZmlnLmdldCgibGFzdF9zeW5jX2NvbmZpZyIsIDApCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlN5bmMgY29uZmlnIGZyb20gTVFUVDogTVFUVCB0aW1lc3RhbXA9e21xdHRfdGltZXN0YW1wfSwgTG9jYWwgdGltZXN0YW1wPXtsb2NhbF90aW1lc3RhbXB9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG1xdHRfdGltZXN0YW1wID4gbG9jYWxfdGltZXN0YW1wOgogICAgICAgICAgICAgICAgIyBNUVRUIGNvbmZpZyBt4bubaSBoxqFuCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiTVFUVCBjb25maWcgbeG7m2kgaMahbiwgxJFhbmcga2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIG1pbmluZyBBUEkuLi4iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbWluaW5nIEFQSSBjw7MgaG/huqF0IMSR4buZbmcga2jDtG5nCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5jaGVja19taW5pbmdfYXBpX2hlYWx0aCgpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJNaW5pbmcgQVBJIGNoxrBhIHPhurVuIHPDoG5nLCBsxrB1IGNvbmZpZyBuaMawbmcgY2jGsGEgdXBkYXRlIikKICAgICAgICAgICAgICAgICAgICAjIEzGsHUgY29uZmlnIMSR4buDIGzhuqduIHNhdSBjaGVjayBs4bqhaQogICAgICAgICAgICAgICAgICAgIHNlbGYubWluaW5nX2NvbmZpZyA9IG1xdHRfY29uZmlnCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2F2ZV9taW5pbmdfY29uZmlnKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBM4bqleSBzdGF0dXMgdOG7qyBBUEkKICAgICAgICAgICAgICAgIHN0YXR1cyA9IHNlbGYuZ2V0X3N0YXR1cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBzdGF0dXMuZ2V0KCJzdWNjZXNzIik6CiAgICAgICAgICAgICAgICAgICAgIyBBUEkgbOG7l2kg4oaSIFVwZGF0ZSBsdcO0bgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJNaW5pbmcgQVBJIGzhu5dpLCDEkWFuZyB1cGRhdGUgY29uZmlnLi4uIikKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBzZWxmLnVwZGF0ZV9jb25maWcobXF0dF9jb25maWcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXQoInN1Y2Nlc3MiLCBGYWxzZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbWluZXJzID0gc3RhdHVzLmdldCgibWluZXJzIiwgW10pCiAgICAgICAgICAgICAgICBhcGlfdmVyc2lvbiA9IHN0YXR1cy5nZXQoImNvbmZpZ192ZXJzaW9uIiwgMCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgY8OzIG1pbmVycyDihpIgVXBkYXRlIGx1w7RuCiAgICAgICAgICAgICAgICBpZiBub3QgbWluZXJzOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJNaW5pbmcgQVBJIGNoxrBhIGPDsyBtaW5lcnMsIMSRYW5nIHVwZGF0ZSBjb25maWcuLi4iKQogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYudXBkYXRlX2NvbmZpZyhtcXR0X2NvbmZpZykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmdldCgic3VjY2VzcyIsIEZhbHNlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGPDsyBtaW5lcnMg4oaSIEtp4buDbSB0cmEgdmVyc2lvbgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJNaW5pbmcgQVBJIMSRYW5nIGNo4bqheSB7bGVuKG1pbmVycyl9IG1pbmVycyAodmVyc2lvbjoge2FwaV92ZXJzaW9ufSkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBhcGlfdmVyc2lvbiAhPSBtcXR0X3RpbWVzdGFtcDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlZlcnNpb24ga2jDoWMgbmhhdSwgxJFhbmcgdXBkYXRlIGNvbmZpZy4uLiIpCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi51cGRhdGVfY29uZmlnKG1xdHRfY29uZmlnKQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgVmVyc2lvbiDEkcOjIGto4bubcCwgY2jhu4kgY+G6p24gbMawdSB2w6BvIERCCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk1pbmluZyBBUEkgxJHDoyBjw7MgY29uZmlnIHZlcnNpb24gbeG7m2kgbmjhuqV0IikKICAgICAgICAgICAgICAgICAgICBzZWxmLm1pbmluZ19jb25maWcgPSBtcXR0X2NvbmZpZwogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NhdmVfbWluaW5nX2NvbmZpZygpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgQ29uZmlnIMSRw6Mgc3luYyBob+G6t2MgTVFUVCBjxakgaMahbiwgYuG7jyBxdWEKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJDb25maWcgxJHDoyDEkcaw4bujYyBzeW5jLCBraMO0bmcgY+G6p24gdXBkYXRlIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBzeW5jIGNvbmZpZyB04burIE1RVFQ6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgZ2V0X21pbmluZ19zdW1tYXJ5KHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHThu5VuZyBo4bujcCB0aMO0bmcgdGluIG1pbmluZwogICAgICAgIEfhu4xJIFRS4buwQyBUSeG6vlAgQVBJIMSR4buDIGzhuqV5IHN0YXR1cyByZWFsLXRpbWUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0OiBTdW1tYXJ5IGJhbyBn4buTbToKICAgICAgICAgICAgICAgIC0gQ29uZmlnIHThu6sgbWluaW5nLWNvbmZpZyAobGFzdF9zeW5jX2NvbmZpZywgYXV0b19zdGFydCkKICAgICAgICAgICAgICAgIC0gU3RhdHVzIHJlYWwtdGltZSB04burIG1pbmluZyBBUEkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgR+G7jWkgQVBJIMSR4buDIGzhuqV5IHN0YXR1cyByZWFsLXRpbWUKICAgICAgICAgICAgc3RhdHVzID0gc2VsZi5nZXRfc3RhdHVzKHNhdmVfdG9fZGI9RmFsc2UpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc3RhdHVzLmdldCgic3VjY2VzcyIpOgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJlcnJvciI6IHN0YXR1cy5nZXQoImVycm9yIiwgIlVua25vd24gZXJyb3IiKSwKICAgICAgICAgICAgICAgICAgICAiZXJyb3JfbWVzc2FnZSI6IHN0YXR1cy5nZXQoImVycm9yIiwgIiIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IG1pbmVycyB04burIEFQSSByZXNwb25zZQogICAgICAgICAgICBtaW5lcnMgPSBzdGF0dXMuZ2V0KCJtaW5lcnMiLCBbXSkKICAgICAgICAgICAgcnVubmluZ19jb3VudCA9IHN1bSgxIGZvciBtIGluIG1pbmVycyBpZiBtLmdldCgic3RhdHVzIikgPT0gInJ1bm5pbmciKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBGb3JtYXQgaGFzaCByYXRlIGNobyBt4buXaSBtaW5lcgogICAgICAgICAgICBtaW5lcnNfZGV0YWlsID0gW10KICAgICAgICAgICAgZm9yIG1pbmVyIGluIG1pbmVyczoKICAgICAgICAgICAgICAgIGhhc2hfcmF0ZV9ocyA9IG1pbmVyLmdldCgiaGFzaF9yYXRlIiwgMCkKICAgICAgICAgICAgICAgIG1pbmVyc19kZXRhaWwuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6IG1pbmVyLmdldCgibmFtZSIpLAogICAgICAgICAgICAgICAgICAgICJjb2luX25hbWUiOiBtaW5lci5nZXQoImNvaW5fbmFtZSIpLAogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiBtaW5lci5nZXQoInN0YXR1cyIpLAogICAgICAgICAgICAgICAgICAgICJoYXNoX3JhdGVfaHMiOiBoYXNoX3JhdGVfaHMsCiAgICAgICAgICAgICAgICAgICAgImhhc2hfcmF0ZV9mb3JtYXR0ZWQiOiBzZWxmLmZvcm1hdF9oYXNoX3JhdGUoaGFzaF9yYXRlX2hzKSwKICAgICAgICAgICAgICAgICAgICAibWluaW5nX3Rvb2wiOiBtaW5lci5nZXQoIm1pbmluZ190b29sIiksCiAgICAgICAgICAgICAgICAgICAgInBpZCI6IG1pbmVyLmdldCgicGlkIikKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBUcnVlLAogICAgICAgICAgICAgICAgIyBUaMO0bmcgdGluIGNvbmZpZyB04burIG1pbmluZy1jb25maWcKICAgICAgICAgICAgICAgICJhdXRvX3N0YXJ0Ijogc2VsZi5taW5pbmdfY29uZmlnLmdldCgiYXV0b19zdGFydCIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICJsYXN0X3N5bmNfY29uZmlnIjogc2VsZi5taW5pbmdfY29uZmlnLmdldCgibGFzdF9zeW5jX2NvbmZpZyIsIDApLAogICAgICAgICAgICAgICAgIyBUaMO0bmcgdGluIHN0YXR1cyByZWFsLXRpbWUgdOG7qyBBUEkKICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICAgICAidG90YWxfbWluZXJzIjogbGVuKG1pbmVycyksCiAgICAgICAgICAgICAgICAicnVubmluZ19taW5lcnMiOiBydW5uaW5nX2NvdW50LAogICAgICAgICAgICAgICAgInN0b3BwZWRfbWluZXJzIjogbGVuKG1pbmVycykgLSBydW5uaW5nX2NvdW50LAogICAgICAgICAgICAgICAgImVycm9yX21lc3NhZ2UiOiAiIiwKICAgICAgICAgICAgICAgICJtaW5lcnMiOiBtaW5lcnNfZGV0YWlsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIGtoaSBs4bqleSBtaW5pbmcgc3VtbWFyeToge2V9IgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZXJyb3IiOiBzdHIoZSksCiAgICAgICAgICAgICAgICAiZXJyb3JfbWVzc2FnZSI6IGVycm9yX21zZwogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBjaGVja19taW5pbmdfYXBpX2hlYWx0aChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgbWluaW5nIEFQSSBzZXJ2ZXIgY8OzIGhv4bqhdCDEkeG7mW5nIGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Ugc2VydmVyIGhv4bqhdCDEkeG7mW5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChmIntzZWxmLmJhc2VfdXJsfS9hcGkvc3RhdHVzIiwgdGltZW91dD0zKQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gRmFsc2UK').decode('utf-8'))
