import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHJlCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBvcwppbXBvcnQgY29uZmlnCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCBxdW90ZSwgdW5xdW90ZQpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBPcHRpb25hbCwgVHVwbGUsIExpc3QsIFVuaW9uCnRyeToKICAgIGZyb20gbHhtbCBpbXBvcnQgZXRyZWUKICAgIExYTUxfQVZBSUxBQkxFID0gVHJ1ZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBMWE1MX0FWQUlMQUJMRSA9IEZhbHNlCgpjbGFzcyBIZWxwZXJTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGJhc2VfdXJsOiBzdHIgPSBOb25lLCBkYl9zZXJ2aWNlPU5vbmUpOgogICAgICAgICMgU+G7rSBk4bulbmcgY29uZmlnIG7hur91IGJhc2VfdXJsIGtow7RuZyDEkcaw4bujYyBjdW5nIGPhuqVwCiAgICAgICAgaWYgYmFzZV91cmwgaXMgTm9uZToKICAgICAgICAgICAgYmFzZV91cmwgPSBjb25maWcuSEVMUEVSX1NFUlZJQ0VfVVJMCiAgICAgICAgCiAgICAgICAgc2VsZi5iYXNlX3VybCA9IGJhc2VfdXJsCiAgICAgICAgc2VsZi5pc19hZGJfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICBzZWxmLmRldmljZV9pcCA9IGNvbmZpZy5ERVZJQ0VfSVAgICMgU+G7rSBk4bulbmcgREVWSUNFX0lQIHThu6sgY29uZmlnCiAgICAgICAgc2VsZi5kYl9zZXJ2aWNlID0gZGJfc2VydmljZQogICAgICAgIAogICAgICAgICMgTHXDtG4gdGjhu60ga+G6v3QgbuG7kWkgQURCIHbhu5tpIElQIHThu6sgY29uZmlnCiAgICAgICAgc2VsZi5jaGVja19hbmRfY29ubmVjdF9hZGIoKQoKICAgIGRlZiBjaGVja19hbmRfY29ubmVjdF9hZGIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHbDoCBr4bq/dCBu4buRaSBBREIgdOG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgQURCIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBraMO0bmcKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJhZGIiLCAiLS12ZXJzaW9uIl0sIGNoZWNrPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEvhur90IG7hu5FpIEFEQiDEkeG6v24gdGhp4bq/dCBi4buLIHPhu60gZOG7pW5nIMSR4buLYSBjaOG7iSB04burIGNvbmZpZwogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIMSR4bq/biB0aGnhur90IGLhu4sKICAgICAgICAgICAgY29ubmVjdF9wcm9jZXNzID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbImFkYiIsICJjb25uZWN0IiwgYWRiX2FkZHJlc3NdLAogICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyBr4bq/dCBu4buRaQogICAgICAgICAgICBpZiAiY29ubmVjdGVkIiBpbiBjb25uZWN0X3Byb2Nlc3Muc3Rkb3V0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBUcnVlCiAgICAgICAgICAgICAgICBwcmludChmIsSQw6Mga+G6v3QgbuG7kWkgQURCIHRow6BuaCBjw7RuZyDEkeG6v24ge2FkYl9hZGRyZXNzfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IChzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciwgRmlsZU5vdEZvdW5kRXJyb3IpIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIEFEQjoge2V9IikKICAgICAgICAKICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfZ2V0X2FkYl9kZXZpY2VfcGFyYW0oc2VsZikgLT4gTGlzdFtzdHJdOgogICAgICAgICIiIgogICAgICAgIFRy4bqjIHbhu4EgdGhhbSBz4buRIHRoaeG6v3QgYuG7iyBjaG8gbOG7h25oIEFEQgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3Rbc3RyXTogRGFuaCBzw6FjaCBbLXMsIGRldmljZV9pZF0gaG/hurdjIGxpc3QgcuG7l25nIG7hur91IGtow7RuZyBjw7MgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIHJldHVybiBbIi1zIiwgYWRiX2FkZHJlc3NdCiAgICAgICAgcmV0dXJuIFtdCgogICAgZGVmIF9tYWtlX3JlcXVlc3Qoc2VsZiwgZW5kcG9pbnQ6IHN0ciwgcGFyYW1zOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gcmVxdWVzdCBBUEkgdsOgIHRy4bqjIHbhu4Ega+G6v3QgcXXhuqMgZOG6oW5nIEpTT04gaG/hurdjIFhNTAogICAgICAgICIiIgogICAgICAgIHVybCA9IGYie3NlbGYuYmFzZV91cmx9L3tlbmRwb2ludH0iCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRoaeG6v3QgbOG6rXAgdGltZW91dCBjaG8gcmVxdWVzdAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIENvbnRlbnQtVHlwZQogICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICMgVHLhuqMgduG7gSBYTUwgZMaw4bubaSBk4bqhbmcgdGV4dAogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLnRleHR9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgSlNPTgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlRpbWVvdXQ6CiAgICAgICAgICAgIHByaW50KGYiUmVxdWVzdCB0aW1lb3V0IGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCIpCiAgICAgICAgICAgIHNlbGYuX3Jlc3RhcnRfaGVscGVyX2FwcCgpCiAgICAgICAgICAgICMgVGjhu60gbOG6oWkgcmVxdWVzdCBzYXUga2hpIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKSAgIyBDaOG7nSAxIGdpw6J5IMSR4buDIOG7qW5nIGThu6VuZyBraOG7n2kgxJHhu5luZwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJkYXRhIjogcmVzcG9uc2UudGV4dH0KICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIlbhuqtuIGzhu5dpIHNhdSBraGkgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvciBhcyBlOgogICAgICAgICAgICAjIELhuq90IGzhu5dpIGvhur90IG7hu5FpIGLhu4sgdOG7qyBjaOG7kWkgaG/hurdjIGtow7RuZyB0aOG7gyBr4bq/dCBu4buRaQogICAgICAgICAgICBwcmludChmIkzhu5dpIGvhur90IG7hu5FpIGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgc2VsZi5fcmVzdGFydF9oZWxwZXJfYXBwKCkKICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSByZXF1ZXN0IHNhdSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpICAjIENo4budIDIgZ2nDonkgxJHhu4Mg4bupbmcgZOG7pW5nIGto4bufaSDEkeG7mW5nCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29udGVudF90eXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICAgICAgaWYgJ2FwcGxpY2F0aW9uL3htbCcgaW4gY29udGVudF90eXBlIG9yIGVuZHBvaW50ID09ICdkdW1wLXNjcmVlbi14bWwnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgImRhdGEiOiByZXNwb25zZS50ZXh0fQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIHJlcXVlc3Q6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQoKICAgIGRlZiBfcmVzdGFydF9oZWxwZXJfYXBwKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBz4butIGThu6VuZyBBREIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgaGVscGVyIGFwcCBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCAiYW0iLCAic3RhcnQiLCAiLW4iLCAiY29tLmRuZHZpbmEuaGVscGVyLy5NYWluQWN0aXZpdHkiXQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcHJpbnQoIsSQw6Mga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIktow7RuZyB0aOG7gyBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHbDrCBBREIgY2jGsGEgxJHGsOG7o2Mga+G6v3QgbuG7kWkiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgdGFwKHNlbGYsIHg6IGludCwgeTogaW50KSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaOG6oW0gdsOgbyB24buLIHRyw60geCx5IHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJ0YXAiLCBwYXJhbXM9eyJ4IjogeCwgInkiOiB5fSkKCiAgICBkZWYgdGFwX2VsZW1lbnQoc2VsZiwgYm91bmRzOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIG3hu5l0IHBo4bqnbiB04butIGThu7FhIHRyw6puIGJvdW5kcyBj4bunYSBuw7MKICAgICAgICBGb3JtYXQgYm91bmRzOiAiW3gxLHkxXVt4Mix5Ml0iIGhv4bq3YyBlbGVtZW50IGRpY3QKICAgICAgICAiIiIKICAgICAgICAjIE7hur91IGJvdW5kcyBsw6AgbeG7mXQgZGljdCAoZWxlbWVudCksIGzhuqV5IGJvdW5kcyBzdHJpbmcgdOG7qyDEkcOzCiAgICAgICAgaWYgaXNpbnN0YW5jZShib3VuZHMsIGRpY3QpOgogICAgICAgICAgICBib3VuZHMgPSBib3VuZHMuZ2V0KCJib3VuZHMiLCAiWzAsMF1bMCwwXSIpCiAgICAgICAgICAgIAogICAgICAgICMgVGjhu60gY8OhYyBwYXR0ZXJuIGtow6FjIG5oYXUgxJHhu4MgcGFyc2UgYm91bmRzLCBjaG8gcGjDqXAgc+G7kSDDom0KICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgciJcWygtP1xkKyksKC0/XGQrKVxdXFsoLT9cZCspLCgtP1xkKylcXSIsICAjIFt4MSx5MV1beDIseTJdIHbhu5tpIHPhu5Egw6JtCiAgICAgICAgICAgIHIiKC0/XGQrKSwoLT9cZCspLCgtP1xkKyksKC0/XGQrKSIsICAgICAgICAgIyB4MSx5MSx4Mix5MgogICAgICAgICAgICByIlxbKC0/XGQrKTsoLT9cZCspXF1cWygtP1xkKyk7KC0/XGQrKVxdIiAgICMgW3gxO3kxXVt4Mjt5Ml0KICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUubWF0Y2gocGF0dGVybiwgYm91bmRzKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIHgxLCB5MSwgeDIsIHkyID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgcHJpbnQoZiJPcmlnaW5hbCBib3VuZHM6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpICAjIELhu48gbG9nIG7DoHkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBT4butYSBjaOG7r2EgYm91bmRzIGtow7RuZyBo4bujcCBs4buHCiAgICAgICAgICAgICAgICBpZiB5MSA8IDAgb3IgeTIgPCAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiRml4aW5nIG5lZ2F0aXZlIFkgY29vcmRpbmF0ZXMuLi4iKQogICAgICAgICAgICAgICAgICAgIGlmIHkyIDwgMDoKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gYWJzKHkyIC0geTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gbWF4KDAsIHkxKQogICAgICAgICAgICAgICAgICAgICAgICB5MiA9IHkxICsgaGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiQWRqdXN0ZWQgWTogeTE9e3kxfSwgeTI9e3kyfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHgxIDwgMCBvciB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJGaXhpbmcgbmVnYXRpdmUgWCBjb29yZGluYXRlcy4uLiIpCiAgICAgICAgICAgICAgICAgICAgaWYgeDIgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGFicyh4MiAtIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MSA9IG1heCgwLCB4MSkKICAgICAgICAgICAgICAgICAgICAgICAgeDIgPSB4MSArIHdpZHRoCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiQWRqdXN0ZWQgWDogeDE9e3gxfSwgeDI9e3gyfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBib3VuZHMgaOG7o3AgbOG7hyBzYXUga2hpIMSRaeG7gXUgY2jhu4luaAogICAgICAgICAgICAgICAgaWYgeDEgPj0geDIgb3IgeTEgPj0geTI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJJbnZhbGlkIGJvdW5kcyBhZnRlciBhZGp1c3RtZW50OiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIENo4buNbiBt4buZdCDEkWnhu4NtIHRyb25nIGJvdW5kcyB24bubaSBtYXJnaW4gYW4gdG/DoG4KICAgICAgICAgICAgICAgIG1hcmdpbiA9IG1pbigzLCAoeDIgLSB4MSkgLy8gNCwgKHkyIC0geTEpIC8vIDQpICAjIER5bmFtaWMgbWFyZ2luCiAgICAgICAgICAgICAgICBtYXJnaW4gPSBtYXgoMSwgbWFyZ2luKSAgIyDDjXQgbmjhuqV0IDFweCBtYXJnaW4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgeCA9IHJhbmRvbS5yYW5kaW50KHgxICsgbWFyZ2luLCBtYXgoeDEgKyBtYXJnaW4gKyAxLCB4MiAtIG1hcmdpbikpCiAgICAgICAgICAgICAgICB5ID0gcmFuZG9tLnJhbmRpbnQoeTEgKyBtYXJnaW4sIG1heCh5MSArIG1hcmdpbiArIDEsIHkyIC0gbWFyZ2luKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBwcmludChmIkZpbmFsIHRhcCBjb29yZGluYXRlczogKHt4fSwge3l9KSB3aXRoIG1hcmdpbiB7bWFyZ2lufSIpICAjIELhu48gbG9nIG7DoHkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudGFwKHgsIHkpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBmIsSQ4buLbmggZOG6oW5nIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hzoge2JvdW5kc30ifQoKICAgIGRlZiBzd2lwZV91cChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgbMOqbiB04burIHbhu4sgdHLDrSBuZ+G6q3Ugbmhpw6puIHBow7kgaOG7o3AKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV91cCIpCgogICAgZGVmIHN3aXBlX2Rvd24oc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHh14buRbmcgdOG7qyB24buLIHRyw60gbmfhuqt1IG5oacOqbiBwaMO5IGjhu6NwCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGVfZG93biIpCgogICAgZGVmIGlucHV0X3RleHQoc2VsZiwgdGV4dDogc3RyLCBzcGVlZDogZmxvYXQgPSAxLjAsIAogICAgICAgICAgICAgICAgICBkaXJlY3RfbW9kZTogYm9vbCA9IEZhbHNlLCBwZXJmZWN0X21vZGU6IGJvb2wgPSBUcnVlKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBNw7QgcGjhu49uZyBnw7UgcGjDrW0gduG7m2kgdOG7kWMgxJHhu5kgbmfhuqt1IG5oacOqbiBnaeG7kW5nIG5nxrDhu51pIHRo4bqtdAogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgInRleHQiOiB0ZXh0LAogICAgICAgICAgICAic3BlZWQiOiBzcGVlZCwKICAgICAgICAgICAgImRpcmVjdF9tb2RlIjogc3RyKGRpcmVjdF9tb2RlKS5sb3dlcigpLAogICAgICAgICAgICAicGVyZmVjdF9tb2RlIjogc3RyKHBlcmZlY3RfbW9kZSkubG93ZXIoKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpbnB1dF90ZXh0IiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgc2hvd190b2FzdChzZWxmLCBtZXNzYWdlOiBzdHIsIHR5cGVfOiBzdHIgPSAiaW5mbyIsIAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogc3RyID0gImJvdHRvbSIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEhp4buDbiB0aOG7iyB0aMO0bmcgYsOhbyB0b2FzdAogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgIm1lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAidHlwZSI6IHR5cGVfLAogICAgICAgICAgICAicG9zaXRpb24iOiBwb3NpdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJ0b2FzdC1tZXNzYWdlIiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgZ2V0X2RldmljZV9pbmZvKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRow7RuZyB0aW4gY2hpIHRp4bq/dCB24buBIHRoaeG6v3QgYuG7iwogICAgICAgICIiIgogICAgICAgIHJlc3VsdCA9IHNlbGYuX21ha2VfcmVxdWVzdCgiZGV2aWNlLWluZm8iKQogICAgICAgIAogICAgICAgICMgTuG6v3Uga+G6v3QgcXXhuqMgdGjDoG5oIGPDtG5nLCB0aMOqbSB0aMO0bmcgdGluIGludGVybmV0IElQCiAgICAgICAgaWYgcmVzdWx0LmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gcmVzdWx0OgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IGludGVybmV0IElQIGLhurFuZyByZXF1ZXN0cwogICAgICAgICAgICAgICAgaW50ZXJuZXRfaXAgPSBzZWxmLl9nZXRfaW50ZXJuZXRfaXAoKQogICAgICAgICAgICAgICAgaWYgaW50ZXJuZXRfaXA6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bImludGVybmV0X2lwIl0gPSBpbnRlcm5ldF9pcAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXN1bHRbImRhdGEiXVsiaW50ZXJuZXRfaXAiXSA9ICJ1bmtub3duIgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBs4bqleSBpbnRlcm5ldCBJUDoge2V9IikKICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJpbnRlcm5ldF9pcCJdID0gImVycm9yIgogICAgICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgIAogICAgZGVmIF9nZXRfaW50ZXJuZXRfaXAoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IMSR4buLYSBjaOG7iSBJUCBjw7RuZyBj4buZbmcgYuG6sW5nIHJlcXVlc3RzCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiDEkOG7i2EgY2jhu4kgSVAgY8O0bmcgY+G7mW5nIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5pcGlmeS5vcmciLCB0aW1lb3V0PTMpCiAgICAgICAgICAgIGlwID0gcmVzcG9uc2UudGV4dC5zdHJpcCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgxJHhu4tuaCBk4bqhbmcgSVAgxJHGoW4gZ2nhuqNuCiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHInXlxkezEsM31cLlxkezEsM31cLlxkezEsM31cLlxkezEsM30kJywgaXApOgogICAgICAgICAgICAgICAgcmV0dXJuIGlwCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIkvhur90IHF14bqjIGtow7RuZyBwaOG6o2kgbMOgIElQIGjhu6NwIGzhu4c6IHtpcH0iKQogICAgICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5UaW1lb3V0OgogICAgICAgICAgICBwcmludCgiVGltZW91dCBraGkgbOG6pXkgaW50ZXJuZXQgSVAgKDMgZ2nDonkpIikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBs4bqleSBpbnRlcm5ldCBJUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtow7RuZyB4w6FjIMSR4buLbmgga2hpIGzhuqV5IGludGVybmV0IElQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgY2hlY2tfaW50ZXJuZXQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIGvhur90IG7hu5FpIGludGVybmV0CiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBjw7Mga+G6v3QgbuG7kWkgaW50ZXJuZXQsIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUaOG7rSBr4bq/dCBu4buRaSDEkeG6v24gR29vZ2xlIEROUyB24bubaSB0aW1lb3V0IG5n4bqvbgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly84LjguOC44IiwgdGltZW91dD01KQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb246CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgVGjhu60gduG7m2kgbeG7mXQgZG9tYWluIGtow6FjCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbSIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb246CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZ2V0X2xvY2FsX2lwKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSDEkeG7i2EgY2jhu4kgSVAgbG9jYWwgY+G7p2EgdGhp4bq/dCBi4buLIHThu6sgZGV2aWNlIGluZm8KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IMSQ4buLYSBjaOG7iSBJUCBsb2NhbCBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgaWYgZGV2aWNlX2luZm8uZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiBkZXZpY2VfaW5mbzoKICAgICAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaW5mb1siZGF0YSJdLmdldCgibG9jYWxfaXAiLCAiIikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBs4bqleSBsb2NhbCBJUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIGR1bXBfc2NyZWVuX3htbChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgRHVtcCB0b8OgbiBi4buZIGPhuqV1IHRyw7pjIFhNTCBj4bunYSBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIFRy4bqjIHbhu4EgbuG7mWkgZHVuZyBYTUwgZMaw4bubaSBk4bqhbmcgY2h14buXaQogICAgICAgICIiIgogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJkdW1wLXNjcmVlbi14bWwiKQogICAgICAgIGlmIHJlc3BvbnNlWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdCiAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIG9wZW5fYXBwKHNlbGYsIHBhY2thZ2U6IHN0ciwgYWN0aXZpdHk6IHN0ciA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3hu58gbeG7mXQg4bupbmcgZOG7pW5nIHbhu5tpIHBhY2thZ2UgbmFtZSB2w6AgYWN0aXZpdHkgY+G7pSB0aOG7gwogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsicGFja2FnZSI6IHBhY2thZ2V9CiAgICAgICAgaWYgYWN0aXZpdHk6CiAgICAgICAgICAgIHBhcmFtc1siYWN0aXZpdHkiXSA9IGFjdGl2aXR5CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgib3Blbl9hcHAiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBjbG9zZV9hcHAoc2VsZiwgcGFja2FnZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICDEkMOzbmcgbeG7mXQg4bupbmcgZOG7pW5nIMSRYW5nIGNo4bqheQogICAgICAgIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMSQw7NuZyDhu6luZyBk4bulbmcgYuG6sW5nIEFEQgogICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbInNoZWxsIiwgZiJhbSBmb3JjZS1zdG9wIHtwYWNrYWdlfSJdCiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgIm1lc3NhZ2UiOiBmIsSQw6MgxJHDs25nIHtwYWNrYWdlfSBi4bqxbmcgQURCIn0KICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSDEkcOzbmcg4bupbmcgZOG7pW5nIGLhurFuZyBBREI6IHtlfSIpCiAgICAgICAgICAgICAgICAjIE7hur91IGzhu5dpLCB0aOG7rSBwaMawxqFuZyB0aOG7qWMgSFRUUAogICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgSFRUUCBBUEkgbuG6v3Uga2jDtG5nIGPDsyBBREIgaG/hurdjIEFEQiBi4buLIGzhu5dpCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfaG9tZSIpCgogICAgZGVmIF9zYW5pdGl6ZV94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0cikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwgxJHhu4MgdHLDoW5oIGzhu5dpIGtoaSBwaMOibiB0w61jaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBDaHXhu5dpIFhNTCBj4bqnbiB44butIGzDvQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IENodeG7l2kgWE1MIMSRw6MgxJHGsOG7o2MgeOG7rSBsw70KICAgICAgICAiIiIKICAgICAgICAjIFRoYXkgdGjhur8gY8OhYyBrw70gdOG7sSAmIGtow7RuZyBo4bujcCBs4buHIGLhurFuZyAmYW1wOwogICAgICAgICMgTmjGsG5nIGdp4buvIG5ndXnDqm4gY8OhYyBlbnRpdHkgaOG7o3AgbOG7hyBuaMawICZhbXA7LCAmbHQ7LCAmZ3Q7LCAmcXVvdDssICZhcG9zOwogICAgICAgIHhtbF9jb250ZW50ID0gcmUuc3ViKHInJig/IShhbXB8bHR8Z3R8cXVvdHxhcG9zKTspJywgJyZhbXA7JywgeG1sX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgIyBMb+G6oWkgYuG7jyBjw6FjIGvDvSB04buxIMSRaeG7gXUga2hp4buDbiBraMO0bmcgaOG7o3AgbOG7hyB0cm9uZyBYTUwKICAgICAgICB4bWxfY29udGVudCA9IHJlLnN1YihyJ1tceDAwLVx4MDhceDBCXHgwQ1x4MEUtXHgxRl0nLCAnJywgeG1sX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHhtbF9jb250ZW50CgogICAgZGVmIGZpbmRfZWxlbWVudF9pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSBwaOG6p24gdOG7rSB0cm9uZyBYTUwgZOG7sWEgdHLDqm4gdGV4dCwgY29udGVudC1kZXNjLCByZXNvdXJjZS1pZCwgY2xhc3MgaG/hurdjIHZpc2libGUtdG8tdXNlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogUGjhuqduIHThu60gxJHhuqd1IHRpw6puIHTDrG0gdGjhuqV5IGhv4bq3YyBOb25lIG7hur91IGtow7RuZyB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIGlmIG5vdCB4bWxfY29udGVudDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgaWYgTFhNTF9BVkFJTEFCTEU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTAogICAgICAgICAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLl9zYW5pdGl6ZV94bWwoeG1sX2NvbnRlbnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUGFyc2UgWE1MIHbhu5tpIHTDuXkgY2jhu41uIHJlY292ZXIgxJHhu4MgeOG7rSBsw70gbOG7l2kKICAgICAgICAgICAgICAgIHBhcnNlciA9IGV0cmVlLlhNTFBhcnNlcihyZWNvdmVyPVRydWUpCiAgICAgICAgICAgICAgICByb290ID0gZXRyZWUuZnJvbXN0cmluZyh4bWxfY29udGVudC5lbmNvZGUoJ3V0Zi04JyksIHBhcnNlcj1wYXJzZXIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgWMOieSBk4buxbmcgWFBhdGggcXVlcnkgZOG7sWEgdHLDqm4gY8OhYyDEkWnhu4F1IGtp4buHbgogICAgICAgICAgICAgICAgY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICBpZiB0ZXh0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQGNvbnRlbnQtZGVzYz0ie2NvbnRlbnRfZGVzY30iJykKICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHJlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicpCiAgICAgICAgICAgICAgICBpZiBjbGFzc19uYW1lIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQGNsYXNzPSJ7Y2xhc3NfbmFtZX0iJykKICAgICAgICAgICAgICAgIGlmIHZpc2libGVfdG9fdXNlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3ZhbHVlID0gInRydWUiIGlmIHZpc2libGVfdG9fdXNlciBlbHNlICJmYWxzZSIKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0B2aXNpYmxlLXRvLXVzZXI9Int2aXNpYmxlX3ZhbHVlfSInKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSA9ICIvL25vZGUiCiAgICAgICAgICAgICAgICBpZiBjb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ICs9ICJbIiArICIgYW5kICIuam9pbihjb25kaXRpb25zKSArICJdIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gcGjhuqduIHThu60gxJHhuqd1IHRpw6puIHBow7kgaOG7o3AKICAgICAgICAgICAgICAgIGVsZW1lbnQgPSByb290LnhwYXRoKHhwYXRoX3F1ZXJ5KQogICAgICAgICAgICAgICAgaWYgZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZWxlbWVudF90b19kaWN0KGVsZW1lbnRbMF0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHTDrG0gcGjhuqduIHThu60gduG7m2kgbHhtbDoge2V9IikKICAgICAgICAKICAgICAgICAjIEZhbGxiYWNrOiBUw6xtIGtp4bq/bSBi4bqxbmcgcmVnZXgKICAgICAgICBpZiB0ZXh0OgogICAgICAgICAgICBwYXR0ZXJuID0gZid0ZXh0PSJ7dGV4dH0iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgdGV4dAogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgaWYgY29udGVudF9kZXNjOgogICAgICAgICAgICBwYXR0ZXJuID0gZidjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgaWYgcmVzb3VyY2VfaWQ6CiAgICAgICAgICAgIHBhdHRlcm4gPSBmJ3Jlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBpZiBjbGFzc19uYW1lOgogICAgICAgICAgICBwYXR0ZXJuID0gZidjbGFzcz0ie2NsYXNzX25hbWV9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIGNsYXNzCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZmluZF9wYXJlbnRfZWxlbWVudF9pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgY2hpbGRfZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgY2hhIGPhu6dhIG3hu5l0IGVsZW1lbnQgY29uIHRyb25nIFhNTAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICBjaGlsZF9lbGVtZW50OiBFbGVtZW50IGNvbiAoZGljdCB24bubaSBjw6FjIHRodeG7mWMgdMOtbmggbmjGsCBib3VuZHMsIHRleHQsIGV0Yy4pCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogRWxlbWVudCBjaGEgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50IG9yIG5vdCBjaGlsZF9lbGVtZW50OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyDEkWnhu4F1IGtp4buHbiDEkeG7gyB0w6xtIGVsZW1lbnQgY29uIGNow61uaCB4w6FjCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGNoaWxkX2VsZW1lbnQuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBpZiBrZXkgaW4gWyd0ZXh0JywgJ2NvbnRlbnQtZGVzYycsICdyZXNvdXJjZS1pZCcsICdjbGFzcycsICdib3VuZHMnLCAndmlzaWJsZS10by11c2VyJ106CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHtrZXl9PSJ7dmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBjb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ID0gIi8vbm9kZVsiICsgIiBhbmQgIi5qb2luKGNvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBlbGVtZW50IGNvbgogICAgICAgICAgICAgICAgY2hpbGRfbm9kZXMgPSByb290LnhwYXRoKHhwYXRoX3F1ZXJ5KQogICAgICAgICAgICAgICAgaWYgY2hpbGRfbm9kZXM6CiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBlbGVtZW50IGNoYSBj4bunYSBlbGVtZW50IGNvbiDEkeG6p3UgdGnDqm4gdMOsbSDEkcaw4bujYwogICAgICAgICAgICAgICAgICAgIHBhcmVudF9ub2RlID0gY2hpbGRfbm9kZXNbMF0uZ2V0cGFyZW50KCkKICAgICAgICAgICAgICAgICAgICBpZiBwYXJlbnRfbm9kZSBpcyBub3QgTm9uZSBhbmQgcGFyZW50X25vZGUudGFnID09ICdub2RlJzoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VsZW1lbnRfdG9fZGljdChwYXJlbnRfbm9kZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IGNoYSB24bubaSBseG1sOiB7ZX0iKQogICAgICAgIAogICAgICAgICMgRmFsbGJhY2s6IFTDrG0ga2nhur9tIGLhurFuZyByZWdleCAocGjhu6ljIHThuqFwIGjGoW4gbmjGsG5nIGPhuqduIHRoaeG6v3QpCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFTDrG0gYm91bmRzIGPhu6dhIGVsZW1lbnQgY29uIMSR4buDIHjDoWMgxJHhu4tuaCB24buLIHRyw60KICAgICAgICAgICAgY2hpbGRfYm91bmRzID0gY2hpbGRfZWxlbWVudC5nZXQoJ2JvdW5kcycsICcnKQogICAgICAgICAgICBpZiBub3QgY2hpbGRfYm91bmRzOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBwYXR0ZXJuIGPhu6dhIGVsZW1lbnQgY29uIHRyb25nIFhNTAogICAgICAgICAgICBjaGlsZF9wYXR0ZXJuID0gTm9uZQogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBjaGlsZF9lbGVtZW50Lml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiBrZXkgaW4gWyd0ZXh0JywgJ2NvbnRlbnQtZGVzYycsICdyZXNvdXJjZS1pZCcsICdjbGFzcyddIGFuZCB2YWx1ZToKICAgICAgICAgICAgICAgICAgICBlc2NhcGVkX3ZhbHVlID0gcmUuZXNjYXBlKHN0cih2YWx1ZSkpCiAgICAgICAgICAgICAgICAgICAgcGF0dGVybiA9IGYne2tleX09Intlc2NhcGVkX3ZhbHVlfSInCiAgICAgICAgICAgICAgICAgICAgaWYgcGF0dGVybiBpbiB4bWxfY29udGVudDoKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfcGF0dGVybiA9IHBhdHRlcm4KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBjaGlsZF9wYXR0ZXJuOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB24buLIHRyw60gY+G7p2EgZWxlbWVudCBjb24gdHJvbmcgWE1MCiAgICAgICAgICAgIGNoaWxkX21hdGNoID0gcmUuc2VhcmNoKGNoaWxkX3BhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBub3QgY2hpbGRfbWF0Y2g6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIHBhdHRlcm4gbsOgeQogICAgICAgICAgICBjaGlsZF9zdGFydCA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIGNoaWxkX21hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgIGlmIGNoaWxkX3N0YXJ0ID09IC0xOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNoYSBi4bqxbmcgY8OhY2ggxJHhur9tIGxldmVsCiAgICAgICAgICAgICMgVMOsbSBuZ8aw4bujYyBs4bqhaSDEkeG7gyB0w6xtIHRo4bq7IG5vZGUgY2hhIGfhuqduIG5o4bqldAogICAgICAgICAgICBwYXJlbnRfc3RhcnQgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBjaGlsZF9zdGFydCkKICAgICAgICAgICAgaWYgcGFyZW50X3N0YXJ0ID09IC0xOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIHBhcmVudF9lbmQgPSB4bWxfY29udGVudC5maW5kKCc+JywgcGFyZW50X3N0YXJ0KSArIDEKICAgICAgICAgICAgcGFyZW50X2NvbnRlbnQgPSB4bWxfY29udGVudFtwYXJlbnRfc3RhcnQ6cGFyZW50X2VuZF0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMocGFyZW50X2NvbnRlbnQpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IGNoYSB24bubaSByZWdleDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIGZpbmRfY2hpbGRfZWxlbWVudHNfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIHBhcmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIGVsZW1lbnQgY29uIGPhu6dhIG3hu5l0IGVsZW1lbnQgY2hhIHRyb25nIFhNTAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICBwYXJlbnRfZWxlbWVudDogRWxlbWVudCBjaGEgKGRpY3QgduG7m2kgY8OhYyB0aHXhu5ljIHTDrW5oIG5oxrAgYm91bmRzLCB0ZXh0LCBldGMuKQogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgZWxlbWVudCBjb24gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICByZXN1bHRzID0gW10KICAgICAgICAKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQgb3Igbm90IHBhcmVudF9lbGVtZW50OgogICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIGVsZW1lbnQgY2hhIHRyxrDhu5tjCiAgICAgICAgICAgICAgICBwYXJlbnRfY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBwYXJlbnRfZWxlbWVudC5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgIGlmIGtleSBpbiBbJ3RleHQnLCAnY29udGVudC1kZXNjJywgJ3Jlc291cmNlLWlkJywgJ2NsYXNzJywgJ2JvdW5kcycsICd2aXNpYmxlLXRvLXVzZXInXToKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X2NvbmRpdGlvbnMuYXBwZW5kKGYnQHtrZXl9PSJ7dmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBwYXJlbnRfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwYXJlbnRfeHBhdGggPSAiLy9ub2RlWyIgKyAiIGFuZCAiLmpvaW4ocGFyZW50X2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICBwYXJlbnRfbm9kZXMgPSByb290LnhwYXRoKHBhcmVudF94cGF0aCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHBhcmVudF9ub2RlczoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gdOG6pXQgY+G6oyBlbGVtZW50IGNvbiBj4bunYSBlbGVtZW50IGNoYQogICAgICAgICAgICAgICAgZm9yIHBhcmVudF9ub2RlIGluIHBhcmVudF9ub2RlczoKICAgICAgICAgICAgICAgICAgICAjIFjDonkgZOG7sW5nIMSRaeG7gXUga2nhu4duIHTDrG0ga2nhur9tIGNobyBlbGVtZW50IGNvbgogICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZF9jb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkX2NvbmRpdGlvbnMuYXBwZW5kKGYnQGNsYXNzPSJ7Y2xhc3NfbmFtZX0iJykKICAgICAgICAgICAgICAgICAgICBpZiB2aXNpYmxlX3RvX3VzZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdmFsdWUgPSAidHJ1ZSIgaWYgdmlzaWJsZV90b191c2VyIGVsc2UgImZhbHNlIgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZF9jb25kaXRpb25zLmFwcGVuZChmJ0B2aXNpYmxlLXRvLXVzZXI9Int2aXNpYmxlX3ZhbHVlfSInKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSBlbGVtZW50IGNvbiB0cm9uZyBwYXJlbnQgbm9kZQogICAgICAgICAgICAgICAgICAgIGNoaWxkX3hwYXRoID0gIi4vL25vZGUiCiAgICAgICAgICAgICAgICAgICAgaWYgY2hpbGRfY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfeHBhdGggKz0gIlsiICsgIiBhbmQgIi5qb2luKGNoaWxkX2NvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY2hpbGRfbm9kZXMgPSBwYXJlbnRfbm9kZS54cGF0aChjaGlsZF94cGF0aCkKICAgICAgICAgICAgICAgICAgICBmb3IgY2hpbGRfbm9kZSBpbiBjaGlsZF9ub2RlczoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoc2VsZi5fZWxlbWVudF90b19kaWN0KGNoaWxkX25vZGUpKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBlbGVtZW50IGNvbiB24bubaSBseG1sOiB7ZX0iKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzCiAgICAKICAgIGRlZiBmaW5kX2NoaWxkX2VsZW1lbnRfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIHBhcmVudF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIGVsZW1lbnQgY29uIMSR4bqndSB0acOqbiBj4bunYSBt4buZdCBlbGVtZW50IGNoYSB0cm9uZyBYTUwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgcGFyZW50X2VsZW1lbnQ6IEVsZW1lbnQgY2hhIChkaWN0IHbhu5tpIGPDoWMgdGh14buZYyB0w61uaCBuaMawIGJvdW5kcywgdGV4dCwgZXRjLikKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IEVsZW1lbnQgY29uIMSR4bqndSB0acOqbiB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICBjaGlsZF9lbGVtZW50cyA9IHNlbGYuZmluZF9jaGlsZF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgIHhtbF9jb250ZW50LCBwYXJlbnRfZWxlbWVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyCiAgICAgICAgKQogICAgICAgIHJldHVybiBjaGlsZF9lbGVtZW50c1swXSBpZiBjaGlsZF9lbGVtZW50cyBlbHNlIE5vbmUKICAgIAogICAgZGVmIGZpbmRfYWxsX2VsZW1lbnRzX2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHBo4bqnbiB04butIHRyb25nIFhNTCBwaMO5IGjhu6NwIHbhu5tpIMSRaeG7gXUga2nhu4duCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IE7hu5lpIGR1bmcgWE1MCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggY8OhYyBwaOG6p24gdOG7rSB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIHJlc3VsdHMgPSBbXQogICAgICAgIAogICAgICAgIGlmIG5vdCB4bWxfY29udGVudDoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHMKICAgICAgICAgICAgCiAgICAgICAgaWYgTFhNTF9BVkFJTEFCTEU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTCDEkeG7gyB0csOhbmggbOG7l2kgRW50aXR5UmVmCiAgICAgICAgICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuX3Nhbml0aXplX3htbCh4bWxfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBYTUwgduG7m2kgdMO5eSBjaOG7jW4gcmVjb3ZlciDEkeG7gyB44butIGzDvSBs4buXaQogICAgICAgICAgICAgICAgcGFyc2VyID0gZXRyZWUuWE1MUGFyc2VyKHJlY292ZXI9VHJ1ZSkKICAgICAgICAgICAgICAgIHJvb3QgPSBldHJlZS5mcm9tc3RyaW5nKHhtbF9jb250ZW50LmVuY29kZSgndXRmLTgnKSwgcGFyc2VyPXBhcnNlcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBYw6J5IGThu7FuZyBYUGF0aCBxdWVyeSBk4buxYSB0csOqbiBjw6FjIMSRaeG7gXUga2nhu4duCiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICAgICAgICAgIGlmIHRleHQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdGV4dD0ie3RleHR9IicpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2MgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY29udGVudC1kZXNjPSJ7Y29udGVudF9kZXNjfSInKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAcmVzb3VyY2UtaWQ9IntyZXNvdXJjZV9pZH0iJykKICAgICAgICAgICAgICAgIGlmIGNsYXNzX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAY2xhc3M9IntjbGFzc19uYW1lfSInKQogICAgICAgICAgICAgICAgaWYgdmlzaWJsZV90b191c2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdmFsdWUgPSAidHJ1ZSIgaWYgdmlzaWJsZV90b191c2VyIGVsc2UgImZhbHNlIgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHZpc2libGUtdG8tdXNlcj0ie3Zpc2libGVfdmFsdWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ID0gIi8vbm9kZSIKICAgICAgICAgICAgICAgIGlmIGNvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgKz0gIlsiICsgIiBhbmQgIi5qb2luKGNvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIHBo4bqnbiB04butIHBow7kgaOG7o3AKICAgICAgICAgICAgICAgIGVsZW1lbnRzID0gcm9vdC54cGF0aCh4cGF0aF9xdWVyeSkKICAgICAgICAgICAgICAgIGZvciBlbGVtZW50IGluIGVsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2VsZW1lbnRfdG9fZGljdChlbGVtZW50KSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBwaOG6p24gdOG7rSB24bubaSBseG1sOiB7ZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiJUaOG7rSB0w6xtIHBo4bqnbiB04butIGLhurFuZyBwaMawxqFuZyB0aOG7qWMgdGhheSB0aOG6vy4uLiIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4IChjaOG7iSB0cuG6oyB24buBIGvhur90IHF14bqjIMSRxqFuIGdp4bqjbikKICAgICAgICBpZiBub3QgcmVzdWx0cyBhbmQgdGV4dDoKICAgICAgICAgICAgcGF0dGVybiA9IGYndGV4dD0ie3RleHR9IicKICAgICAgICAgICAgZm9yIG1hdGNoIGluIHJlLmZpbmRpdGVyKHBhdHRlcm4sIHhtbF9jb250ZW50KToKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzCiAgICAKICAgIGRlZiBfZXh0cmFjdF9hdHRyaWJ1dGVzKHNlbGYsIG5vZGVfY29udGVudDogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUcsOtY2ggeHXhuqV0IGPDoWMgdGh14buZYyB0w61uaCB04burIG7hu5lpIGR1bmcgY+G7p2EgbeG7mXQgdGjhursgbm9kZQogICAgICAgICIiIgogICAgICAgIGF0dHJpYnV0ZXMgPSB7fQogICAgICAgIAogICAgICAgICMgQ8OhYyB0aHXhu5ljIHTDrW5oIGPhuqduIHRyw61jaCB4deG6pXQKICAgICAgICBhdHRyX3BhdHRlcm5zID0gewogICAgICAgICAgICAiY2xhc3MiOiByJ2NsYXNzPSIoW14iXSopIicsCiAgICAgICAgICAgICJwYWNrYWdlIjogcidwYWNrYWdlPSIoW14iXSopIicsCiAgICAgICAgICAgICJyZXNvdXJjZS1pZCI6IHIncmVzb3VyY2UtaWQ9IihbXiJdKikiJywKICAgICAgICAgICAgInRleHQiOiByJ3RleHQ9IihbXiJdKikiJywKICAgICAgICAgICAgImNvbnRlbnQtZGVzYyI6IHInY29udGVudC1kZXNjPSIoW14iXSopIicsCiAgICAgICAgICAgICJib3VuZHMiOiByJ2JvdW5kcz0iKFteIl0qKSInLAogICAgICAgICAgICAiY2hlY2thYmxlIjogcidjaGVja2FibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImNoZWNrZWQiOiByJ2NoZWNrZWQ9IihbXiJdKikiJywKICAgICAgICAgICAgImNsaWNrYWJsZSI6IHInY2xpY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJlbmFibGVkIjogcidlbmFibGVkPSIoW14iXSopIicsCiAgICAgICAgICAgICJmb2N1c2FibGUiOiByJ2ZvY3VzYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAiZm9jdXNlZCI6IHInZm9jdXNlZD0iKFteIl0qKSInLAogICAgICAgICAgICAic2Nyb2xsYWJsZSI6IHInc2Nyb2xsYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAibG9uZy1jbGlja2FibGUiOiByJ2xvbmctY2xpY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJwYXNzd29yZCI6IHIncGFzc3dvcmQ9IihbXiJdKikiJywKICAgICAgICAgICAgInNlbGVjdGVkIjogcidzZWxlY3RlZD0iKFteIl0qKSInCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciBhdHRyX25hbWUsIHBhdHRlcm4gaW4gYXR0cl9wYXR0ZXJucy5pdGVtcygpOgogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCBub2RlX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgYXR0cmlidXRlc1thdHRyX25hbWVdID0gbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhdHRyaWJ1dGVzCgogICAgZGVmIF9lbGVtZW50X3RvX2RpY3Qoc2VsZiwgZWxlbWVudCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2h1eeG7g24gxJHhu5VpIG3hu5l0IHBo4bqnbiB04butIFhNTCB04burIGx4bWwgdGjDoG5oIGRpY3QKICAgICAgICAiIiIKICAgICAgICByZXN1bHQgPSB7fQogICAgICAgIAogICAgICAgICMgTOG6pXkgdOG6pXQgY+G6oyB0aHXhu5ljIHTDrW5oCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZWxlbWVudC5hdHRyaWIuaXRlbXMoKToKICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0CgogICAgZGVmIGZpbmRfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHBo4bqnbiB04butIHRyw6puIG3DoG4gaMOsbmggZOG7sWEgdHLDqm4gdGV4dCwgY29udGVudC1kZXNjLCByZXNvdXJjZS1pZCwgY2xhc3MgaG/hurdjIHZpc2libGUtdG8tdXNlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOiBQaOG6p24gdOG7rSDEkeG6p3UgdGnDqm4gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyKQoKICAgIGRlZiBmaW5kX2FsbF9lbGVtZW50cyhzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgcGjhuqduIHThu60gdHLDqm4gbcOgbiBow6xuaCBwaMO5IGjhu6NwIHbhu5tpIMSRaeG7gXUga2nhu4duCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCBjw6FjIHBo4bqnbiB04butIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHhtbF9jb250ZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIpCgogICAgZGVmIGZpbmRfY2hpbGRfZWxlbWVudHMoc2VsZiwgcGFyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgZWxlbWVudCBjb24gY+G7p2EgbeG7mXQgZWxlbWVudCBjaGEgdHLDqm4gbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwYXJlbnRfZWxlbWVudDogRWxlbWVudCBjaGEgKGRpY3QgduG7m2kgY8OhYyB0aHXhu5ljIHTDrW5oIG5oxrAgYm91bmRzLCB0ZXh0LCBldGMuKQogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIGVsZW1lbnQgY29uIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgZWxlbWVudCBjb24gdMOsbSB0aOG6pXkKICAgICAgICAgICAgCiAgICAgICAgRXhhbXBsZToKICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgR3JpZFZpZXcgdHJvbmcgbeG7mXQgVmlld0dyb3VwCiAgICAgICAgICAgIHBhcmVudCA9IGhlbHBlci5maW5kX2VsZW1lbnQoY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuVmlld0dyb3VwIikKICAgICAgICAgICAgZ3JpZF92aWV3cyA9IGhlbHBlci5maW5kX2NoaWxkX2VsZW1lbnRzKHBhcmVudCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuR3JpZFZpZXciKQogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfY2hpbGRfZWxlbWVudHNfaW5feG1sKHhtbF9jb250ZW50LCBwYXJlbnRfZWxlbWVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSwgdmlzaWJsZV90b191c2VyKQoKICAgIGRlZiBmaW5kX2NoaWxkX2VsZW1lbnQoc2VsZiwgcGFyZW50X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLAogICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gZWxlbWVudCBjb24gxJHhuqd1IHRpw6puIGPhu6dhIG3hu5l0IGVsZW1lbnQgY2hhIHRyw6puIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGFyZW50X2VsZW1lbnQ6IEVsZW1lbnQgY2hhIChkaWN0IHbhu5tpIGPDoWMgdGh14buZYyB0w61uaCBuaMawIGJvdW5kcywgdGV4dCwgZXRjLikKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBlbGVtZW50IGNvbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgZWxlbWVudCBjb24gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IEVsZW1lbnQgY29uIMSR4bqndSB0acOqbiB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAgICAgCiAgICAgICAgRXhhbXBsZToKICAgICAgICAgICAgIyBUw6xtIG3hu5l0IFRleHRWaWV3IHRyb25nIG3hu5l0IExpbmVhckxheW91dCBj4bulIHRo4buDCiAgICAgICAgICAgIHBhcmVudCA9IGhlbHBlci5maW5kX2VsZW1lbnQoY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuTGluZWFyTGF5b3V0IiwgcmVzb3VyY2VfaWQ9ImNvbS5leGFtcGxlOmlkL2NvbnRhaW5lciIpCiAgICAgICAgICAgIHRleHRfdmlldyA9IGhlbHBlci5maW5kX2NoaWxkX2VsZW1lbnQocGFyZW50LCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5UZXh0VmlldyIpCiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9jaGlsZF9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgcGFyZW50X2VsZW1lbnQsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUsIHZpc2libGVfdG9fdXNlcikKCiAgICBkZWYgaXNfZWxlbWVudF9zZWxlY3RlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2MgY2jhu41uIGhheSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoInNlbGVjdGVkIikgPT0gInRydWUiCgogICAgZGVmIHdhaXRfZm9yX2VsZW1lbnQoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIHRpbWVvdXQ6IGludCA9IDMwLCAKICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgbeG7mXQgcGjhuqduIHThu60geHXhuqV0IGhp4buHbiB0csOqbiBtw6BuIGjDrG5oCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICB0aW1lb3V0OiBUaOG7nWkgZ2lhbiBjaOG7nSB04buRaSDEkWEgKGdpw6J5KQogICAgICAgICAgICBjaGVja19pbnRlcnZhbDogS2hv4bqjbmcgdGjhu51pIGdpYW4gZ2nhu69hIGPDoWMgbOG6p24ga2nhu4NtIHRyYSAoZ2nDonkpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogUGjhuqduIHThu60gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3UgdGltZW91dAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6CiAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmZpbmRfZWxlbWVudCh0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIpCiAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgd2FpdF90b190YXBfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgdGltZW91dDogaW50ID0gMzAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbDogaW50ID0gMSwgZGVsYXlfYmVmb3JlX3RhcDogaW50ID0gMSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgZWxlbWVudCB4deG6pXQgaGnhu4duLCBkZWxheSBt4buZdCBraG/huqNuZyB0aOG7nWkgZ2lhbiwgcuG7k2kgdGFwIHbDoG8gZWxlbWVudAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgdGltZW91dDogVGjhu51pIGdpYW4gY2jhu50gdOG7kWkgxJFhIMSR4buDIHTDrG0gZWxlbWVudCAoZ2nDonkpCiAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBLaG/huqNuZyB0aOG7nWkgZ2lhbiBnaeG7r2EgY8OhYyBs4bqnbiBraeG7g20gdHJhIChnacOieSkKICAgICAgICAgICAgZGVsYXlfYmVmb3JlX3RhcDogVGjhu51pIGdpYW4gZGVsYXkgdHLGsOG7m2Mga2hpIHRhcCAoZ2nDonksIG3hurdjIMSR4buLbmggMSBnacOieSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaOG7nSBlbGVtZW50IHh14bqldCBoaeG7h24KICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYud2FpdF9mb3JfZWxlbWVudCgKICAgICAgICAgICAgICAgIHRleHQ9dGV4dCwgCiAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2M9Y29udGVudF9kZXNjLCAKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPXJlc291cmNlX2lkLCAKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9Y2xhc3NfbmFtZSwKICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcj12aXNpYmxlX3RvX3VzZXIsIAogICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0LCAKICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsPWNoZWNrX2ludGVydmFsCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICAgICAgIyBU4bqhbyB0aMO0bmcgYsOhbyBs4buXaSBjaGkgdGnhur90CiAgICAgICAgICAgICAgICBjcml0ZXJpYSA9IFtdCiAgICAgICAgICAgICAgICBpZiB0ZXh0OgogICAgICAgICAgICAgICAgICAgIGNyaXRlcmlhLmFwcGVuZChmInRleHQ9J3t0ZXh0fSciKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgICAgIGNyaXRlcmlhLmFwcGVuZChmImNvbnRlbnRfZGVzYz0ne2NvbnRlbnRfZGVzY30nIikKICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkOgogICAgICAgICAgICAgICAgICAgIGNyaXRlcmlhLmFwcGVuZChmInJlc291cmNlX2lkPSd7cmVzb3VyY2VfaWR9JyIpCiAgICAgICAgICAgICAgICBpZiBjbGFzc19uYW1lOgogICAgICAgICAgICAgICAgICAgIGNyaXRlcmlhLmFwcGVuZChmImNsYXNzX25hbWU9J3tjbGFzc19uYW1lfSciKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjcml0ZXJpYV9zdHIgPSAiLCAiLmpvaW4oY3JpdGVyaWEpIGlmIGNyaXRlcmlhIGVsc2UgImtow7RuZyB4w6FjIMSR4buLbmgiCiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIktow7RuZyB0w6xtIHRo4bqleSBlbGVtZW50IHNhdSB7dGltZW91dH1zIHbhu5tpIHRpw6p1IGNow606IHtjcml0ZXJpYV9zdHJ9IgogICAgICAgICAgICAgICAgcHJpbnQoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRGVsYXkgdHLGsOG7m2Mga2hpIHRhcAogICAgICAgICAgICBpZiBkZWxheV9iZWZvcmVfdGFwID4gMDoKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoZGVsYXlfYmVmb3JlX3RhcCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGFwIHbDoG8gZWxlbWVudAogICAgICAgICAgICByZXN1bHQgPSBzZWxmLnRhcF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IHF14bqjIHRhcAogICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8gPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8uYXBwZW5kKGYidGV4dD0ne3RleHR9JyIpCiAgICAgICAgICAgICAgICBpZiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9pbmZvLmFwcGVuZChmImNvbnRlbnRfZGVzYz0ne2NvbnRlbnRfZGVzY30nIikKICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkOgogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mby5hcHBlbmQoZiJyZXNvdXJjZV9pZD0ne3Jlc291cmNlX2lkfSciKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZToKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8uYXBwZW5kKGYiY2xhc3NfbmFtZT0ne2NsYXNzX25hbWV9JyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsZW1lbnRfc3RyID0gIiwgIi5qb2luKGVsZW1lbnRfaW5mbykgaWYgZWxlbWVudF9pbmZvIGVsc2UgImVsZW1lbnQiCiAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgdGFwIHRow6BuaCBjw7RuZyB2w6BvIHtlbGVtZW50X3N0cn0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7cmVzdWx0LmdldCgnbWVzc2FnZScsICdLaMO0bmcgeMOhYyDEkeG7i25oJyl9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kgdHJvbmcgd2FpdF90b190YXBfZWxlbWVudDoge3N0cihlKX0iCiAgICAgICAgICAgIHByaW50KGVycm9yX21zZykKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIGdldF9lbGVtZW50X3RleHQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0ZXh0IGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJ0ZXh0IiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jb250ZW50X2Rlc2Moc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBjb250ZW50LWRlc2MgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfcmVzb3VyY2VfaWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSByZXNvdXJjZS1pZCBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgicmVzb3VyY2UtaWQiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NsYXNzKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgY2xhc3MgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImNsYXNzIiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9lbmFibGVkKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyDEkcaw4bujYyBrw61jaCBob+G6oXQga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJlbmFibGVkIikgPT0gInRydWUiCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jbGlja2FibGUoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIHRo4buDIG5o4bqlcCB2w6BvIGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2xpY2thYmxlIikgPT0gInRydWUiCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9mb2N1c2VkKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyDEkcaw4bujYyBmb2N1cyBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImZvY3VzZWQiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NoZWNrZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGNo4buNbiBraMO0bmcgKGNobyBjaGVja2JveCkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImNoZWNrZWQiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2JvdW5kcyhzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gVHVwbGVbaW50LCBpbnQsIGludCwgaW50XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB04buNYSDEkeG7mSBib3VuZHMgY+G7p2EgcGjhuqduIHThu60gZMaw4bubaSBk4bqhbmcgdHVwbGUgKHgxLCB5MSwgeDIsIHkyKQogICAgICAgIFjhu60gbMO9IGPDoWMgdHLGsOG7nW5nIGjhu6NwIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hyAow6JtLCAwLCBob+G6t2MgZm9ybWF0IHNhaSkKICAgICAgICAiIiIKICAgICAgICBib3VuZHMgPSBlbGVtZW50LmdldCgiYm91bmRzIiwgIlswLDBdWzAsMF0iKQogICAgICAgIAogICAgICAgICMgVGjhu60gY8OhYyBwYXR0ZXJuIGtow6FjIG5oYXUgxJHhu4MgcGFyc2UgYm91bmRzCiAgICAgICAgcGF0dGVybnMgPSBbCiAgICAgICAgICAgIHIiXFsoLT9cZCspLCgtP1xkKylcXVxbKC0/XGQrKSwoLT9cZCspXF0iLCAgIyBQYXR0ZXJuIGhp4buHbiB04bqhaSwgY2hvIHBow6lwIHPhu5Egw6JtCiAgICAgICAgICAgIHIiKC0/XGQrKSwoLT9cZCspLCgtP1xkKyksKC0/XGQrKSIsICAgICAgICAgIyBQYXR0ZXJuOiB4MSx5MSx4Mix5MgogICAgICAgICAgICByIlxbKC0/XGQrKTsoLT9cZCspXF1cWygtP1xkKyk7KC0/XGQrKVxdIiAgICMgUGF0dGVybiB24bubaSBk4bqldSA7CiAgICAgICAgXQogICAgICAgIAogICAgICAgIGZvciBwYXR0ZXJuIGluIHBhdHRlcm5zOgogICAgICAgICAgICBtYXRjaCA9IHJlLm1hdGNoKHBhdHRlcm4sIGJvdW5kcykKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IG1hcChpbnQsIG1hdGNoLmdyb3VwcygpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFPhu61hIGNo4buvYSBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4cKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIHThu41hIMSR4buZIMOibSwgxJFp4buBdSBjaOG7iW5oCiAgICAgICAgICAgICAgICBpZiB5MSA8IDAgb3IgeTIgPCAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW86IEJvdW5kcyBjw7MgdOG7jWEgxJHhu5kgeSDDom06ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB5MiDDom0sIGPDsyB0aOG7gyBlbGVtZW50IG7hurFtIHRyw6puIHRoYW5oIHN0YXR1cyBiYXIKICAgICAgICAgICAgICAgICAgICBpZiB5MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICMgxJBp4buBdSBjaOG7iW5oIMSR4buDIGVsZW1lbnQgY8OzIHRo4buDIHRhcCDEkcaw4bujYwogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBhYnMoeTIgLSB5MSkgICMgQ2hp4buBdSBjYW8gZWxlbWVudAogICAgICAgICAgICAgICAgICAgICAgICB5MSA9IG1heCgwLCB5MSkgICMgxJDhuqNtIGLhuqNvIHkxID49IDAKICAgICAgICAgICAgICAgICAgICAgICAgeTIgPSB5MSArIGhlaWdodCAgIyDEkOG6t3QgeTIgZMawxqFuZwogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgxJFp4buBdSBjaOG7iW5oIGJvdW5kcyB0aMOgbmg6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHgxIDwgMCBvciB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogQm91bmRzIGPDsyB04buNYSDEkeG7mSB4IMOibTogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgICAgICAjIFTGsMahbmcgdOG7sSB24bubaSB4CiAgICAgICAgICAgICAgICAgICAgaWYgeDIgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGFicyh4MiAtIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MSA9IG1heCgwLCB4MSkKICAgICAgICAgICAgICAgICAgICAgICAgeDIgPSB4MSArIHdpZHRoCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyDEkWnhu4F1IGNo4buJbmggYm91bmRzIHRow6BuaDogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGJvdW5kcyBo4bujcCBs4buHIHNhdSBraGkgxJFp4buBdSBjaOG7iW5oCiAgICAgICAgICAgICAgICBpZiB4MSA8IHgyIGFuZCB5MSA8IHkyIGFuZCBub3QgKHgxID09IDAgYW5kIHkxID09IDAgYW5kIHgyID09IDAgYW5kIHkyID09IDApOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAoeDEsIHkxLCB4MiwgeTIpCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBraMO0bmcgcGFyc2UgxJHGsOG7o2MgaG/hurdjIHThuqV0IGPhuqMgbMOgIDAsIHRo4butIGzhuqV5IHThu6sgdGh14buZYyB0w61uaCBraMOhYwogICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW86IEtow7RuZyB0aOG7gyBwYXJzZSBib3VuZHMgJ3tib3VuZHN9JyBj4bunYSBlbGVtZW50LCB0aOG7rSBwaMawxqFuZyBwaMOhcCBraMOhYy4uLiIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7rSBs4bqleSB04burIGPDoWMgdGh14buZYyB0w61uaCBraMOhYyBu4bq/dSBjw7MKICAgICAgICB4ID0gZWxlbWVudC5nZXQoIngiLCAwKQogICAgICAgIHkgPSBlbGVtZW50LmdldCgieSIsIDApCiAgICAgICAgd2lkdGggPSBlbGVtZW50LmdldCgid2lkdGgiLCAxMDApICAjIERlZmF1bHQgd2lkdGgKICAgICAgICBoZWlnaHQgPSBlbGVtZW50LmdldCgiaGVpZ2h0IiwgNTApICAjIERlZmF1bHQgaGVpZ2h0CiAgICAgICAgCiAgICAgICAgaWYgeCBvciB5IG9yIHdpZHRoICE9IDEwMCBvciBoZWlnaHQgIT0gNTA6ICAjIEPDsyDDrXQgbmjhuqV0IG3hu5l0IHRodeG7mWMgdMOtbmgga2jDoWMgMC9kZWZhdWx0CiAgICAgICAgICAgIHJldHVybiAoeCwgeSwgeCArIHdpZHRoLCB5ICsgaGVpZ2h0KQogICAgICAgIAogICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW86IEVsZW1lbnQgYm91bmRzIGtow7RuZyBo4bujcCBs4buHLCBz4butIGThu6VuZyB04buNYSDEkeG7mSBt4bq3YyDEkeG7i25oIikKICAgICAgICByZXR1cm4gKDAsIDAsIDEwMCwgNTApICAjIEZhbGxiYWNrIGJvdW5kcyBuaOG7jwogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2VudGVyKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBUdXBsZVtpbnQsIGludF06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdOG7jWEgxJHhu5kgdHJ1bmcgdMOibSBj4bunYSBwaOG6p24gdOG7rSB24bubaSB44butIGzDvSBs4buXaSBuw6JuZyBjYW8KICAgICAgICAiIiIKICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgcHJpbnQoIkPhuqNuaCBiw6FvOiBFbGVtZW50IGzDoCBOb25lIGhv4bq3YyBy4buXbmciKQogICAgICAgICAgICByZXR1cm4gKDAsIDApCiAgICAgICAgICAgIAogICAgICAgIHgxLCB5MSwgeDIsIHkyID0gc2VsZi5nZXRfZWxlbWVudF9ib3VuZHMoZWxlbWVudCkKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgYm91bmRzIGjhu6NwIGzhu4cKICAgICAgICBpZiB4MSA+PSB4MiBvciB5MSA+PSB5MjoKICAgICAgICAgICAgYm91bmRzX3N0ciA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiIikKICAgICAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogQm91bmRzIGtow7RuZyBo4bujcCBs4buHICd7Ym91bmRzX3N0cn0nOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4csIHRy4bqjIHbhu4EgdOG7jWEgxJHhu5kgYW4gdG/DoG4g4bufIGdp4buvYSBtw6BuIGjDrG5oCiAgICAgICAgICAgIHNjcmVlbl93aWR0aCwgc2NyZWVuX2hlaWdodCA9IHNlbGYuZ2V0X3NjcmVlbl9zaXplKCkKICAgICAgICAgICAgaWYgc2NyZWVuX3dpZHRoID4gMCBhbmQgc2NyZWVuX2hlaWdodCA+IDA6CiAgICAgICAgICAgICAgICBjZW50ZXJfeCA9IHNjcmVlbl93aWR0aCAvLyAyCiAgICAgICAgICAgICAgICBjZW50ZXJfeSA9IHNjcmVlbl9oZWlnaHQgLy8gMgogICAgICAgICAgICAgICAgcmV0dXJuIChjZW50ZXJfeCwgY2VudGVyX3kpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gKDU0MCwgOTYwKSAgIyBU4buNYSDEkeG7mSBt4bq3YyDEkeG7i25oIGNobyBtw6BuIGjDrG5oIDEwODB4MTkyMAogICAgICAgIAogICAgICAgIGNlbnRlcl94ID0gKHgxICsgeDIpIC8vIDIKICAgICAgICBjZW50ZXJfeSA9ICh5MSArIHkyKSAvLyAyCiAgICAgICAgCiAgICAgICAgIyBUaMOqbSBt4buZdCBjaMO6dCByYW5kb20gxJHhu4MgdHLDoW5oIGRldGVjdGlvbiAowrEzIHBpeGVscykKICAgICAgICBjZW50ZXJfeCArPSByYW5kb20ucmFuZGludCgtMywgMykKICAgICAgICBjZW50ZXJfeSArPSByYW5kb20ucmFuZGludCgtMywgMykKICAgICAgICAKICAgICAgICAjIMSQ4bqjbSBi4bqjbyB04buNYSDEkeG7mSB0cm9uZyBwaOG6oW0gdmkgbcOgbiBow6xuaAogICAgICAgIHNjcmVlbl93aWR0aCwgc2NyZWVuX2hlaWdodCA9IHNlbGYuZ2V0X3NjcmVlbl9zaXplKCkKICAgICAgICBpZiBzY3JlZW5fd2lkdGggPiAwIGFuZCBzY3JlZW5faGVpZ2h0ID4gMDoKICAgICAgICAgICAgY2VudGVyX3ggPSBtYXgoMTAsIG1pbihjZW50ZXJfeCwgc2NyZWVuX3dpZHRoIC0gMTApKSAgIyBNYXJnaW4gMTBweCB04burIGJpw6puCiAgICAgICAgICAgIGNlbnRlcl95ID0gbWF4KDEwLCBtaW4oY2VudGVyX3ksIHNjcmVlbl9oZWlnaHQgLSAxMCkpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIChjZW50ZXJfeCwgY2VudGVyX3kpCiAgICAKICAgIGRlZiB0YXBfZWxlbWVudF9jZW50ZXIoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIHBo4bqnbiB04butIHbhu5tpIHTDrW5oIHJhbmRvbSAoc+G7rSBk4bulbmcgdGFwX2VsZW1lbnQgYsOqbiB0cm9uZykKICAgICAgICBO4bq/dSBlbGVtZW50IHF1w6Egbmjhu48gdGjDrCBt4bubaSBkw7luZyBjZW50ZXIsIG5nxrDhu6NjIGzhuqFpIHPhur0gdGFwIHJhbmRvbQogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6ICJFbGVtZW50IGzDoCBOb25lIGhv4bq3YyBy4buXbmcifQogICAgICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2aXNpYmxlLXRvLXVzZXIgdHLGsOG7m2MKICAgICAgICAgICAgdmlzaWJsZSA9IGVsZW1lbnQuZ2V0KCJ2aXNpYmxlLXRvLXVzZXIiLCAidHJ1ZSIpCiAgICAgICAgICAgIGlmIHZpc2libGUgPT0gImZhbHNlIjoKICAgICAgICAgICAgICAgIHByaW50KCJD4bqjbmggYsOhbzogRWxlbWVudCBjw7MgdmlzaWJsZS10by11c2VyPSdmYWxzZScsIHbhuqtuIHRo4butIHRhcC4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGJvdW5kcyBj4bunYSBlbGVtZW50IMSR4buDIGtp4buDbSB0cmEga8OtY2ggdGjGsOG7m2MKICAgICAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyhlbGVtZW50KQogICAgICAgICAgICB3aWR0aCA9IHgyIC0geDEKICAgICAgICAgICAgaGVpZ2h0ID0geTIgLSB5MQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBlbGVtZW50IHF1w6Egbmjhu48gKDwgMjBweCB3aWR0aCBob+G6t2MgaGVpZ2h0KSwgZMO5bmcgY2VudGVyCiAgICAgICAgICAgIGlmIHdpZHRoIDwgMjAgb3IgaGVpZ2h0IDwgMjA6CiAgICAgICAgICAgICAgICBwcmludChmIkVsZW1lbnQgbmjhu48gKHt3aWR0aH14e2hlaWdodH1weCksIHPhu60gZOG7pW5nIHRhcCBjZW50ZXIiKQogICAgICAgICAgICAgICAgeCwgeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB04buNYSDEkeG7mSBo4bujcCBs4buHCiAgICAgICAgICAgICAgICBpZiB4IDw9IDAgYW5kIHkgPD0gMDoKICAgICAgICAgICAgICAgICAgICBib3VuZHNfc3RyID0gZWxlbWVudC5nZXQoImJvdW5kcyIsICIiKQogICAgICAgICAgICAgICAgICAgIGlmIGJvdW5kc19zdHIgYW5kIGJvdW5kc19zdHIgIT0gIlswLDBdWzAsMF0iOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi50YXBfZWxlbWVudChib3VuZHNfc3RyKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIktow7RuZyB0aOG7gyB4w6FjIMSR4buLbmggdOG7jWEgxJHhu5kgxJHhu4MgdGFwIn0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudGFwKHgsIHkpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEVsZW1lbnQgxJHhu6cgbOG7m24sIHPhu60gZOG7pW5nIHRhcF9lbGVtZW50IMSR4buDIHRhcCByYW5kb20KICAgICAgICAgICAgICAgICMgcHJpbnQoZiJFbGVtZW50IMSR4bunIGzhu5tuICh7d2lkdGh9eHtoZWlnaHR9cHgpLCBz4butIGThu6VuZyB0YXAgcmFuZG9tIikgICMgQuG7jyBsb2cgbsOgeQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudGFwX2VsZW1lbnQoZWxlbWVudCkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0YXAgZWxlbWVudDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBmIkzhu5dpIGtoaSB0YXAgZWxlbWVudDoge3N0cihlKX0ifQogICAgCiAgICBkZWYgbG9uZ19wcmVzcyhzZWxmLCB4OiBpbnQsIHk6IGludCwgZHVyYXRpb246IGludCA9IDEwMDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBnaeG7ryB04bqhaSB24buLIHRyw60geCx5IHRyb25nIG3hu5l0IGtob+G6o25nIHRo4budaSBnaWFuCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAieCI6IHgsCiAgICAgICAgICAgICJ5IjogeSwKICAgICAgICAgICAgImR1cmF0aW9uIjogZHVyYXRpb24KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgibG9uZ19wcmVzcyIsIHBhcmFtcz1wYXJhbXMpCiAgICAKICAgIGRlZiBsb25nX3ByZXNzX2VsZW1lbnQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0sIGR1cmF0aW9uOiBpbnQgPSAxMDAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gZ2nhu68gdOG6oWkgdHJ1bmcgdMOibSBj4bunYSBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHgsIHkgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgICAgIHJldHVybiBzZWxmLmxvbmdfcHJlc3MoeCwgeSwgZHVyYXRpb24pCiAgICAKICAgIGRlZiBzd2lwZShzZWxmLCBzdGFydF94OiBpbnQsIHN0YXJ0X3k6IGludCwgZW5kX3g6IGludCwgZW5kX3k6IGludCwgCiAgICAgICAgICAgICBkdXJhdGlvbjogaW50ID0gNTAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgdOG7qyDEkWnhu4NtIChzdGFydF94LCBzdGFydF95KSDEkeG6v24gxJFp4buDbSAoZW5kX3gsIGVuZF95KQogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgInN0YXJ0X3giOiBzdGFydF94LAogICAgICAgICAgICAic3RhcnRfeSI6IHN0YXJ0X3ksCiAgICAgICAgICAgICJlbmRfeCI6IGVuZF94LAogICAgICAgICAgICAiZW5kX3kiOiBlbmRfeSwKICAgICAgICAgICAgImR1cmF0aW9uIjogZHVyYXRpb24KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGUiLCBwYXJhbXM9cGFyYW1zKQogICAgCiAgICBkZWYgc3dpcGVfYmV0d2Vlbl9lbGVtZW50cyhzZWxmLCBzdGFydF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBpbnQgPSA1MDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCB04burIHBo4bqnbiB04butIHN0YXJ0X2VsZW1lbnQgxJHhur9uIHBo4bqnbiB04butIGVuZF9lbGVtZW50CiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfeCwgc3RhcnRfeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKHN0YXJ0X2VsZW1lbnQpCiAgICAgICAgZW5kX3gsIGVuZF95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZW5kX2VsZW1lbnQpCiAgICAgICAgcmV0dXJuIHNlbGYuc3dpcGUoc3RhcnRfeCwgc3RhcnRfeSwgZW5kX3gsIGVuZF95LCBkdXJhdGlvbikKICAgIAogICAgZGVmIHdhaXRfZm9yX2VsZW1lbnRfdG9fZGlzYXBwZWFyKHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCB0aW1lb3V0OiBpbnQgPSAzMCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIENo4budIMSR4bujaSBjaG8gxJHhur9uIGtoaSBt4buZdCBwaOG6p24gdOG7rSBiaeG6v24gbeG6pXQga2jhu49pIG3DoG4gaMOsbmgKICAgICAgICAiIiIKICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5maW5kX2VsZW1lbnQodGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCkKICAgICAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB3YWl0X2Zvcl9hbnlfZWxlbWVudChzZWxmLCBlbGVtZW50c190b19maW5kOiBMaXN0W0RpY3Rbc3RyLCBzdHJdXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IGludCA9IDMwLCBjaGVja19pbnRlcnZhbDogaW50ID0gMSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIENo4budIMSR4bujaSBjaG8gxJHhur9uIGtoaSBi4bqldCBr4buzIHBo4bqnbiB04butIG7DoG8gdHJvbmcgZGFuaCBzw6FjaCB4deG6pXQgaGnhu4duCiAgICAgICAgCiAgICAgICAgZWxlbWVudHNfdG9fZmluZCBsw6AgZGFuaCBzw6FjaCBjw6FjIGRpY3QgduG7m2kgY8OhYyBraMOzYTogdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6CiAgICAgICAgICAgIGZvciBlbGVtZW50X2NyaXRlcmlhIGluIGVsZW1lbnRzX3RvX2ZpbmQ6CiAgICAgICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5maW5kX2VsZW1lbnQoCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9jcml0ZXJpYS5nZXQoInRleHQiKSwgCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9jcml0ZXJpYS5nZXQoImNvbnRlbnRfZGVzYyIpLCAKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2NyaXRlcmlhLmdldCgicmVzb3VyY2VfaWQiKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIGdldF9zY3JlZW5fc2l6ZShzZWxmKSAtPiBUdXBsZVtpbnQsIGludF06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkga8OtY2ggdGjGsOG7m2MgbcOgbiBow6xuaCAod2lkdGgsIGhlaWdodCkKICAgICAgICAiIiIKICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICBpZiBkZXZpY2VfaW5mb1sic3RhdHVzIl0gPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICByZXR1cm4gKGRldmljZV9pbmZvWyJkYXRhIl1bInNjcmVlbl93aWR0aCJdLCBkZXZpY2VfaW5mb1siZGF0YSJdWyJzY3JlZW5faGVpZ2h0Il0pCiAgICAgICAgcmV0dXJuICgwLCAwKQogICAgCiAgICBkZWYgdGFrZV9zY3JlZW5zaG90KHNlbGYsIGZpbGVfcGF0aDogc3RyID0gTm9uZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu6VwIOG6o25oIG3DoG4gaMOsbmggdsOgIGzGsHUgdsOgbyBmaWxlX3BhdGggKG7hur91IMSRxrDhu6NjIGN1bmcgY+G6pXApCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0ge30KICAgICAgICBpZiBmaWxlX3BhdGg6CiAgICAgICAgICAgIHBhcmFtc1siZmlsZV9wYXRoIl0gPSBmaWxlX3BhdGgKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzY3JlZW5zaG90IiwgcGFyYW1zPXBhcmFtcykKICAgIAogICAgZGVmIGdldF9jdXJyZW50X2FjdGl2aXR5KHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0w6puIGFjdGl2aXR5IGhp4buHbiB04bqhaQogICAgICAgICIiIgogICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgIGlmIGRldmljZV9pbmZvWyJzdGF0dXMiXSA9PSAic3VjY2VzcyIgYW5kICJjdXJyZW50X2FjdGl2aXR5IiBpbiBkZXZpY2VfaW5mb1siZGF0YSJdOgogICAgICAgICAgICByZXR1cm4gZGV2aWNlX2luZm9bImRhdGEiXVsiY3VycmVudF9hY3Rpdml0eSJdCiAgICAgICAgcmV0dXJuICIiCiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9wYWNrYWdlKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0w6puIHBhY2thZ2UgaGnhu4duIHThuqFpCiAgICAgICAgIiIiCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImN1cnJlbnQtcGFja2FnZSIpCiAgICAgICAgaWYgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiByZXNwb25zZToKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJkYXRhIl0uZ2V0KCJwYWNrYWdlIiwgIiIpCiAgICAgICAgcmV0dXJuICIiCiAgICAKICAgIGRlZiBwcmVzc19lbnRlcihzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gbsO6dCBFbnRlcgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2VudGVyIikKICAgIAogICAgZGVmIHByZXNzX2JhY2soc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgQmFjawogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2JhY2siKQogICAgCiAgICBkZWYgcHJlc3NfaG9tZShzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gbsO6dCBIb21lCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfaG9tZSIpCiAgICAKICAgIGRlZiBwcmVzc19yZWNlbnRfYXBwcyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gbsO6dCBSZWNlbnQgQXBwcwogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX3JlY2VudF9hcHBzIikKCiAgICBkZWYgaXNfYXBwX2luc3RhbGxlZChzZWxmLCBwYWNrYWdlX25hbWU6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSDhu6luZyBk4bulbmcgxJHDoyDEkcaw4bujYyBjw6BpIMSR4bq3dCB0csOqbiB0aGnhur90IGLhu4sgY2jGsGEKICAgICAgICDGr3UgdGnDqm4gc+G7rSBk4bulbmcgQURCIG7hur91IMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwYWNrYWdlX25hbWU6IFTDqm4gcGFja2FnZSBj4bunYSDhu6luZyBk4bulbmcgY+G6p24ga2nhu4NtIHRyYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IOG7qW5nIGThu6VuZyDEkcOjIGPDoGkgxJHhurd0LCBGYWxzZSBu4bq/dSBjaMawYQogICAgICAgICIiIgogICAgICAgICMgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSDhu6luZyBk4bulbmcgYuG6sW5nIEFEQgogICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbInNoZWxsIiwgZiJwbSBsaXN0IHBhY2thZ2VzIHwgZ3JlcCAteCBwYWNrYWdlOntwYWNrYWdlX25hbWV9Il0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICB0ZXh0PVRydWUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7Mga+G6v3QgcXXhuqMsIOG7qW5nIGThu6VuZyDEkcOjIMSRxrDhu6NjIGPDoGkgxJHhurd0CiAgICAgICAgICAgICAgICByZXR1cm4gcGFja2FnZV9uYW1lIGluIHJlc3VsdC5zdGRvdXQKICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yOgogICAgICAgICAgICAgICAgIyBO4bq/dSBs4buXaSBBREIsIHPhu60gZOG7pW5nIEFQSSBIVFRQCiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgCiAgICAgICAgIyBT4butIGThu6VuZyBIVFRQIEFQSQogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJhcHAtaW5zdGFsbGVkIiwgeyJwYWNrYWdlIjogcGFja2FnZV9uYW1lfSkKICAgICAgICBpZiByZXNwb25zZVsic3RhdHVzIl0gPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXS5nZXQoImluc3RhbGxlZCIsIEZhbHNlKQogICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIGZpbmRfZWxlbWVudHMoc2VsZiwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwgdGV4dDogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgcGjhuqduIHThu60gdGhlbyBjbGFzc19uYW1lLCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkIGhv4bq3YyB2aXNpYmxlLXRvLXVzZXIKICAgICAgICDEkMOieSBsw6AgbeG7mXQgcGjGsMahbmcgdGjhu6ljIHRp4buHbiBs4bujaSBr4bq/dCBo4bujcCBkdW1wX3NjcmVlbl94bWwgdsOgIGZpbmRfYWxsX2VsZW1lbnRzX2luX3htbAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggY8OhYyBwaOG6p24gdOG7rSB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgICMgTOG6pXkgWE1MIG3DoG4gaMOsbmggaGnhu4duIHThuqFpCiAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICBpZiBub3Qgc2NyZWVuX3htbDoKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgZmluZF9hbGxfZWxlbWVudHNfaW5feG1sIMSR4buDIHTDrG0gY8OhYyBwaOG6p24gdOG7rQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgIHRleHQ9dGV4dCwgCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYz1jb250ZW50X2Rlc2MsIAogICAgICAgICAgICByZXNvdXJjZV9pZD1yZXNvdXJjZV9pZCwKICAgICAgICAgICAgY2xhc3NfbmFtZT1jbGFzc19uYW1lLAogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI9dmlzaWJsZV90b191c2VyCiAgICAgICAgKQoKICAgIGRlZiBvcGVuX3VybChzZWxmLCB1cmw6IHN0ciwgcGFja2FnZTogc3RyID0gTm9uZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTeG7nyBt4buZdCBVUkwgdHLDqm4gdGhp4bq/dCBi4buLLiBI4buvdSDDrWNoIMSR4buDIG3hu58gY8OhYyBsaW5rIG3huqFuZyB4w6MgaOG7mWkgdHLhu7FjIHRp4bq/cC4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB1cmw6IFVSTCBj4bqnbiBt4bufICh2w60gZOG7pTogaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS91c2VybmFtZS8pCiAgICAgICAgICAgIHBhY2thZ2U6IFBhY2thZ2UgbmFtZSBj4bunYSDhu6luZyBk4bulbmcgxJHhu4MgbeG7nyBVUkwgKHTDuXkgY2jhu41uKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVVJMIGVuY29kZSDEkeG7gyB0csOhbmggbOG7l2kgduG7m2kgY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0CiAgICAgICAgICAgICMgQ2jhu4kgZW5jb2RlIHBo4bqnbiBzYXUgZG9tYWluIMSR4buDIGdp4buvIG5ndXnDqm4gcHJvdG9jb2wgdsOgIGRvbWFpbgogICAgICAgICAgICBpZiAnOi8vJyBpbiB1cmw6CiAgICAgICAgICAgICAgICBwYXJ0cyA9IHVybC5zcGxpdCgnOi8vJywgMSkKICAgICAgICAgICAgICAgIGlmIGxlbihwYXJ0cykgPT0gMjoKICAgICAgICAgICAgICAgICAgICBwcm90b2NvbCA9IHBhcnRzWzBdCiAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nID0gcGFydHNbMV0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAnLycgaW4gcmVtYWluaW5nOgogICAgICAgICAgICAgICAgICAgICAgICBkb21haW5fcGFydHMgPSByZW1haW5pbmcuc3BsaXQoJy8nLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBkb21haW5fcGFydHNbMF0KICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IGRvbWFpbl9wYXJ0c1sxXQogICAgICAgICAgICAgICAgICAgICAgICAjIEVuY29kZSBwYXRoIHBhcnQsIG5oxrBuZyBnaeG7ryBuZ3V5w6puIGPDoWMga8O9IHThu7EgYW4gdG/DoG4KICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlZF9wYXRoID0gcXVvdGUocGF0aCwgc2FmZT0nL0A6PyNbXSEkJlwnKCkqKyw7PScpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZWRfdXJsID0gZiJ7cHJvdG9jb2x9Oi8ve2RvbWFpbn0ve2VuY29kZWRfcGF0aH0iCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlZF91cmwgPSB1cmwgICMgQ2jhu4kgY8OzIGRvbWFpbiwga2jDtG5nIGPhuqduIGVuY29kZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3VybCA9IHVybAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBLaMO0bmcgY8OzIHByb3RvY29sLCBlbmNvZGUgdG/DoG4gYuG7mQogICAgICAgICAgICAgICAgZW5jb2RlZF91cmwgPSBxdW90ZSh1cmwsIHNhZmU9Jy9AOj8jW10hJCZcJygpKissOz0nKQogICAgICAgICAgICAKICAgICAgICAgICAgcGFyYW1zID0geyJ1cmwiOiBlbmNvZGVkX3VybH0KICAgICAgICAgICAgaWYgcGFja2FnZToKICAgICAgICAgICAgICAgIHBhcmFtc1sicGFja2FnZSJdID0gcGFja2FnZQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJvcGVuX3VybCIsIHBhcmFtcz1wYXJhbXMpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgZW5jb2RlIFVSTDoge2V9IikKICAgICAgICAgICAgIyBGYWxsYmFjazogZ+G7rWkgVVJMIGfhu5FjIG7hur91IGPDsyBs4buXaSBlbmNvZGUKICAgICAgICAgICAgcGFyYW1zID0geyJ1cmwiOiB1cmx9CiAgICAgICAgICAgIGlmIHBhY2thZ2U6CiAgICAgICAgICAgICAgICBwYXJhbXNbInBhY2thZ2UiXSA9IHBhY2thZ2UKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgib3Blbl91cmwiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBnZXRfY2xpcGJvYXJkKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBu4buZaSBkdW5nIGNsaXBib2FyZCB04burIHRoaeG6v3QgYuG7iwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogTuG7mWkgZHVuZyBjbGlwYm9hcmQgaG/hurdjIGNodeG7l2kgcuG7l25nIG7hur91IGtow7RuZyBjw7MgbuG7mWkgZHVuZwogICAgICAgICIiIgogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJjbGlwYm9hcmQiKQogICAgICAgIGlmIHJlc3BvbnNlLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCByZXNwb25zZS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJoYXNfY29udGVudCIpOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXVsiY2xpcGJvYXJkX3RleHQiXQogICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBzd2lwZV9sZWZ0KHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCBzYW5nIHRyw6FpICh04buRaSDGsHUgY2hvIG5nw7NuIGPDoWkgdGF5IHBo4bqjaSkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV9sZWZ0IikKCiAgICBkZWYgc3dpcGVfcmlnaHQoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHNhbmcgcGjhuqNpICh04buRaSDGsHUgY2hvIG5nw7NuIGPDoWkgdGF5IHBo4bqjaSkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV9yaWdodCIpCgogICAgZGVmIGlzX2luc3RhbGxlZChzZWxmLCBwYWNrYWdlOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIOG7qW5nIGThu6VuZyBjw7MgxJHGsOG7o2MgY8OgaSDEkeG6t3QgaGF5IGtow7RuZyAoZMO5bmcgQVBJIG3hu5tpKQogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBhY2thZ2U6IFTDqm4gcGFja2FnZSBj4bunYSDhu6luZyBk4bulbmcKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBkaWN0OiBL4bq/dCBxdeG6oyBraeG7g20gdHJhCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgiaXNfaW5zdGFsbGVkIiwgcGFyYW1zPXsicGFja2FnZSI6IHBhY2thZ2V9KQoKICAgIGRlZiBzZXR1cF9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgY2hvIHBoacOqbiBsw6BtIHZp4buHYwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgduG7m2kgY8OhYyB0csaw4budbmc6CiAgICAgICAgICAgICAgICAtIGlkOiBJRCBj4bunYSBwcm94eQogICAgICAgICAgICAgICAgLSB0eXBlOiBMb+G6oWkgcHJveHkgKHBwb2UsIGh0dHAsIHNvY2tzNSwgZXRjLikKICAgICAgICAgICAgICAgIC0gaG9zdDogxJDhu4thIGNo4buJIHNlcnZlciBwcm94eQogICAgICAgICAgICAgICAgLSBwb3J0OiBQb3J0IGPhu6dhIHByb3h5CiAgICAgICAgICAgICAgICAtIHVzZXJuYW1lOiBVc2VybmFtZSAobuG6v3UgY8OzKQogICAgICAgICAgICAgICAgLSBwYXNzd29yZDogUGFzc3dvcmQgKG7hur91IGPDsykKICAgICAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGhp4bq/dCBs4bqtcCB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJveHlfdHlwZSA9IHByb3h5X2NvbmZpZy5nZXQoInR5cGUiLCAiIikubG93ZXIoKQogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHByb3h5X3R5cGUgPT0gInBwb2UiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NldHVwX3Bwb2VfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbGlmIHByb3h5X3R5cGUgaW4gWyJodHRwIiwgImh0dHBzIl06CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fc2V0dXBfaHR0cF9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSA9PSAic29ja3M1IjoKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZXR1cF9zb2NrczVfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJMb+G6oWkgcHJveHkga2jDtG5nIMSRxrDhu6NjIGjhu5cgdHLhu6M6IHtwcm94eV90eXBlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9zZXR1cF9wcG9lX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBQUFBvRQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgUFBQb0UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaG9zdCA9IHByb3h5X2NvbmZpZy5nZXQoInNlcnZlcl9pcCIpCiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgicHJveHlfaWQiKQogICAgICAgICAgICBwcm94eV9uYW1lID0gcHJveHlfY29uZmlnLmdldCgibmFtZSIpCiAgICAgICAgICAgIGlmIG5vdCBob3N0OgogICAgICAgICAgICAgICAgcHJpbnQoIlRoaeG6v3UgdGjDtG5nIHRpbiBob3N0IGNobyBwcm94eSBQUFBvRSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSSByZWdpc3RlciB0csaw4bubYwogICAgICAgICAgICByZWdpc3Rlcl91cmwgPSBmImh0dHA6Ly97aG9zdH0vcmVnaXN0ZXIiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgZGV2aWNlIGluZm8KICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgIGxvY2FsX2lwID0gIiIKICAgICAgICAgICAgaWYgZGV2aWNlX2luZm8uZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiBkZXZpY2VfaW5mbzoKICAgICAgICAgICAgICAgIGxvY2FsX2lwID0gZGV2aWNlX2luZm9bImRhdGEiXS5nZXQoImxvY2FsX2lwIiwgIiIpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZWdpc3Rlcl9kYXRhID0geyJuYW1lIjogcHJveHlfbmFtZX0KICAgICAgICAgICAgICAgIGlmIGxvY2FsX2lwOgogICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyX2RhdGFbImxvY2FsX2lwIl0gPSBsb2NhbF9pcAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVnaXN0ZXJfcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyX3VybCwgCiAgICAgICAgICAgICAgICAgICAganNvbj1yZWdpc3Rlcl9kYXRhLCAKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwgCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgcmVnaXN0ZXJfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyDEkcSDbmcga8O9IHRow6BuaCBjw7RuZyB24bubaSBwcm94eSBQUFBvRSBzZXJ2ZXI6IHtob3N0fSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIMSRxINuZyBrw70gduG7m2kgcHJveHkgUFBQb0Ugc2VydmVyOiB7cmVnaXN0ZXJfcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIMSR4bq/biBwcm94eSBQUFBvRSBzZXJ2ZXIge2hvc3R9OiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBSZXNldCBJUCBwcm94eQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRoaeG6v3QgbOG6rXAgcHJveHkgUFBQb0U6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfc2V0dXBfaHR0cF9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgSFRUUC9IVFRQUwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgSFRUUAogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4buRaSB24bubaSBIVFRQIHByb3h5LCBjaOG7iSBj4bqnbiByZXNldCBJUAogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRoaeG6v3QgbOG6rXAgcHJveHkgSFRUUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9zZXR1cF9zb2NrczVfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaGnhur90IGzhuq1wIHByb3h5IFNPQ0tTNQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgU09DS1M1CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhu5FpIHbhu5tpIFNPQ0tTNSBwcm94eSwgY2jhu4kgY+G6p24gcmVzZXQgSVAKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Jlc2V0X3Byb3h5X2lwKHByb3h5X2NvbmZpZykKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aGnhur90IGzhuq1wIHByb3h5IFNPQ0tTNToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9yZXNldF9wcm94eV9pcChzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFJlc2V0IElQIHByb3h5IChsb2dpYyBjxakgxJHGsOG7o2MgY2h1eeG7g24gdsOgbyDEkcOieSkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTG9naWMgcmVzZXQgSVAgcHJveHkgc+G6vSDEkcaw4bujYyBpbXBsZW1lbnQgdMO5eSB0aGVvIGxv4bqhaSBwcm94eQogICAgICAgICAgICAjIEhp4buHbiB04bqhaSByZXR1cm4gVHJ1ZSDEkeG7gyBraMO0bmcgYmxvY2sgd29ya2Zsb3cKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJpZCIpCiAgICAgICAgICAgIHByb3h5X3R5cGUgPSBwcm94eV9jb25maWcuZ2V0KCJ0eXBlIiwgInVua25vd24iKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoZiJSZXNldCBJUCBjaG8gcHJveHkge3Byb3h5X2lkfSAodHlwZToge3Byb3h5X3R5cGV9KSIpCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSBjw7MgdGjDtG5nIHRpbiByZXNldCBJUAogICAgICAgICAgICByZXNldF9pcF9saW5rID0gcHJveHlfY29uZmlnLmdldCgibGlua19yZXNldF9pcCIpCiAgICAgICAgICAgIHBwb2VfbmFtZSA9IHByb3h5X2NvbmZpZy5nZXQoInBwb2VfbmFtZSIpCgogICAgICAgICAgICBpZiByZXNldF9pcF9saW5rIGFuZCBwcG9lX25hbWU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyBH4butaSBQT1NUIHJlcXVlc3QgxJHhu4MgcmVzZXQgSVAKICAgICAgICAgICAgICAgICAgICByZXNldF9kYXRhID0geyJwcG9lX25hbWUiOiBwcG9lX25hbWV9CiAgICAgICAgICAgICAgICAgICAgcmVzZXRfcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgICAgICByZXNldF9pcF9saW5rLCAKICAgICAgICAgICAgICAgICAgICAgICAganNvbj1yZXNldF9kYXRhLCAKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sIAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIHJlc2V0X3Jlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIHJlc2V0IElQIHRow6BuaCBjw7RuZyBjaG8gcHJveHkge3Bwb2VfbmFtZX0iKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHJlc2V0IElQOiBIVFRQIHtyZXNldF9yZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGfhu61pIHJlcXVlc3QgcmVzZXQgSVA6IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludCgiVGhp4bq/dSB0aMO0bmcgdGluIGxpbmtfcmVzZXRfaXAgaG/hurdjIHByb3h5X25hbWUiKQogICAgICAgICAgICAjIFRPRE86IEltcGxlbWVudCBsb2dpYyByZXNldCBJUCBj4bulIHRo4buDIGNobyB04burbmcgbG/huqFpIHByb3h5CiAgICAgICAgICAgICMgVsOtIGThu6U6IGfhu41pIEFQSSByZXNldCBJUCwgaG/hurdjIHRo4buxYyBoaeG7h24gY8OhYyBs4buHbmggY+G6p24gdGhp4bq/dAogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSByZXNldCBJUCBwcm94eToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIHJlc2V0X3Byb3h5X2lwKHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUGjGsMahbmcgdGjhu6ljIHB1YmxpYyDEkeG7gyByZXNldCBJUCBwcm94eSAoxJHhu4MgdMawxqFuZyB0aMOtY2ggduG7m2kgY29kZSBjxakpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX3Jlc2V0X3Byb3h5X2lwKHByb3h5X2NvbmZpZykKCiAgICBkZWYgdW5yZWdpc3Rlcl9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IHNhdSBraGkgc+G7rSBk4bulbmcgeG9uZwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgKHTDuXkgY2jhu41uLCBjw7MgdGjhu4MgbOG6pXkgdOG7qyBkYXRhYmFzZSBu4bq/dSBraMO0bmcgdHJ1eeG7gW4pCiAgICAgICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGjhu6d5IMSRxINuZyBrw70gdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHRydXnhu4FuIHByb3h5X2NvbmZpZywgY8OzIHRo4buDIGzhuqV5IHThu6sgZGF0YWJhc2UgaG/hurdjIGNvbnRleHQgaGnhu4duIHThuqFpCiAgICAgICAgICAgIGlmIG5vdCBwcm94eV9jb25maWc6CiAgICAgICAgICAgICAgICBwcmludCgiS2jDtG5nIGPDsyBwcm94eSBjb25maWcgxJHhu4MgdW5yZWdpc3RlciIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBDb2kgbmjGsCB0aMOgbmggY8O0bmcgbuG6v3Uga2jDtG5nIGPDsyBnw6wgxJHhu4MgdW5yZWdpc3RlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHByb3h5X3R5cGUgPSBwcm94eV9jb25maWcuZ2V0KCJ0eXBlIiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJpZCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwcm94eV90eXBlID09ICJwcG9lIjoKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl91bnJlZ2lzdGVyX3Bwb2VfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbGlmIHByb3h5X3R5cGUgaW4gWyJodHRwIiwgImh0dHBzIl06CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdW5yZWdpc3Rlcl9odHRwX3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxpZiBwcm94eV90eXBlID09ICJzb2NrczUiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3VucmVnaXN0ZXJfc29ja3M1X3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiTG/huqFpIHByb3h5IGtow7RuZyBj4bqnbiB1bnJlZ2lzdGVyIGhv4bq3YyBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7ozoge3Byb3h5X3R5cGV9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGjhu6d5IMSRxINuZyBrw70gcHJveHk6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfdW5yZWdpc3Rlcl9wcG9lX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgSOG7p3kgxJHEg25nIGvDvSBwcm94eSBQUFBvRQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgUFBQb0UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaG9zdCA9IHByb3h5X2NvbmZpZy5nZXQoInNlcnZlcl9pcCIpCiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgicHJveHlfaWQiKQogICAgICAgICAgICBwcm94eV9uYW1lID0gcHJveHlfY29uZmlnLmdldCgibmFtZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgaG9zdDoKICAgICAgICAgICAgICAgIHByaW50KCJUaGnhur91IHRow7RuZyB0aW4gaG9zdCBjaG8gcHJveHkgUFBQb0UsIGLhu48gcXVhIHVucmVnaXN0ZXIiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSSB1bnJlZ2lzdGVyCiAgICAgICAgICAgIHVucmVnaXN0ZXJfdXJsID0gZiJodHRwOi8ve2hvc3R9L3VucmVnaXN0ZXIiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGxvY2FsIElQIHThu6sgZGV2aWNlIGluZm8KICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgIGxvY2FsX2lwID0gIiIKICAgICAgICAgICAgaWYgZGV2aWNlX2luZm8uZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiBkZXZpY2VfaW5mbzoKICAgICAgICAgICAgICAgIGxvY2FsX2lwID0gZGV2aWNlX2luZm9bImRhdGEiXS5nZXQoImxvY2FsX2lwIiwgIiIpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyX2RhdGEgPSB7Im5hbWUiOiBwcm94eV9uYW1lfQogICAgICAgICAgICAgICAgaWYgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl9kYXRhWyJsb2NhbF9pcCJdID0gbG9jYWxfaXAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJfcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJfdXJsLCAKICAgICAgICAgICAgICAgICAgICBqc29uPXVucmVnaXN0ZXJfZGF0YSwgCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sIAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIHVucmVnaXN0ZXJfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyBo4buneSDEkcSDbmcga8O9IHRow6BuaCBjw7RuZyB24bubaSBwcm94eSBQUFBvRSBzZXJ2ZXI6IHtob3N0fSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSB24bubaSBwcm94eSBQUFBvRSBzZXJ2ZXI6IHt1bnJlZ2lzdGVyX3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIktow7RuZyB0aOG7gyBr4bq/dCBu4buRaSDEkeG6v24gcHJveHkgUFBQb0Ugc2VydmVyIHtob3N0fSDEkeG7gyB1bnJlZ2lzdGVyOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGjhu6d5IMSRxINuZyBrw70gcHJveHkgUFBQb0U6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfdW5yZWdpc3Rlcl9odHRwX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgSOG7p3kgxJHEg25nIGvDvSBwcm94eSBIVFRQL0hUVFBTCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBIVFRQCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgSFRUUCBwcm94eSB0aMaw4budbmcga2jDtG5nIGPhuqduIHVucmVnaXN0ZXIgxJHhurdjIGJp4buHdAogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgcHJpbnQoZiJI4buneSDEkcSDbmcga8O9IHByb3h5IEhUVFAge3Byb3h5X2lkfSAoa2jDtG5nIGPhuqduIHRoYW8gdMOhYyDEkeG6t2MgYmnhu4d0KSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eSBIVFRQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3VucmVnaXN0ZXJfc29ja3M1X3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgSOG7p3kgxJHEg25nIGvDvSBwcm94eSBTT0NLUzUKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IFNPQ0tTNQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFNPQ0tTNSBwcm94eSB0aMaw4budbmcga2jDtG5nIGPhuqduIHVucmVnaXN0ZXIgxJHhurdjIGJp4buHdAogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgcHJpbnQoZiJI4buneSDEkcSDbmcga8O9IHByb3h5IFNPQ0tTNSB7cHJveHlfaWR9IChraMO0bmcgY+G6p24gdGhhbyB0w6FjIMSR4bq3YyBiaeG7h3QpIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHByb3h5IFNPQ0tTNToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGRlYnVnX2VsZW1lbnRfYm91bmRzKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIERlYnVnIHRow7RuZyB0aW4gYm91bmRzIGPhu6dhIGVsZW1lbnQgxJHhu4Mga2nhu4NtIHRyYSB4ZW0gY8OzIHRhcCDEkcaw4bujYyBraMO0bmcKICAgICAgICAiIiIKICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgcHJpbnQoIkRFQlVHOiBFbGVtZW50IGlzIE5vbmUgb3IgZW1wdHkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgcHJpbnQoIj09PSBERUJVRyBFTEVNRU5UIEJPVU5EUyA9PT0iKQogICAgICAgIGJvdW5kc19zdHIgPSBlbGVtZW50LmdldCgiYm91bmRzIiwgIiIpCiAgICAgICAgcHJpbnQoZiJPcmlnaW5hbCBib3VuZHMgc3RyaW5nOiAne2JvdW5kc19zdHJ9JyIpCiAgICAgICAgCiAgICAgICAgIyBUZXN0IGdldF9lbGVtZW50X2JvdW5kcwogICAgICAgIHgxLCB5MSwgeDIsIHkyID0gc2VsZi5nZXRfZWxlbWVudF9ib3VuZHMoZWxlbWVudCkKICAgICAgICBwcmludChmIlBhcnNlZCBib3VuZHM6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgCiAgICAgICAgIyBUZXN0IGdldF9lbGVtZW50X2NlbnRlcgogICAgICAgIGNlbnRlcl94LCBjZW50ZXJfeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgcHJpbnQoZiJDYWxjdWxhdGVkIGNlbnRlcjogKHtjZW50ZXJfeH0sIHtjZW50ZXJfeX0pIikKICAgICAgICAKICAgICAgICAjIFRlc3QgduG7m2kgdsOtIGThu6UgY+G7pSB0aOG7gwogICAgICAgIHByaW50KCJcbi0tLSBUZXN0aW5nIHdpdGggZXhhbXBsZSBib3VuZHMgWzM2LDBdWzg0LC0zMF0gLS0tIikKICAgICAgICB0ZXN0X2VsZW1lbnQgPSB7ImJvdW5kcyI6ICJbMzYsMF1bODQsLTMwXSIsICJjb250ZW50LWRlc2MiOiAiVMOsbSBraeG6v20ifQogICAgICAgIAogICAgICAgIHRlc3RfeDEsIHRlc3RfeTEsIHRlc3RfeDIsIHRlc3RfeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyh0ZXN0X2VsZW1lbnQpCiAgICAgICAgcHJpbnQoZiJUZXN0IHBhcnNlZCBib3VuZHM6ICh7dGVzdF94MX0sIHt0ZXN0X3kxfSwge3Rlc3RfeDJ9LCB7dGVzdF95Mn0pIikKICAgICAgICAKICAgICAgICB0ZXN0X2NlbnRlcl94LCB0ZXN0X2NlbnRlcl95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIodGVzdF9lbGVtZW50KQogICAgICAgIHByaW50KGYiVGVzdCBjYWxjdWxhdGVkIGNlbnRlcjogKHt0ZXN0X2NlbnRlcl94fSwge3Rlc3RfY2VudGVyX3l9KSIpCiAgICAgICAgCiAgICAgICAgIyBUZXN0IHRhcF9lbGVtZW50CiAgICAgICAgcHJpbnQoIlxuLS0tIFRlc3RpbmcgdGFwX2VsZW1lbnQgLS0tIikKICAgICAgICByZXN1bHQgPSBzZWxmLnRhcF9lbGVtZW50KHRlc3RfZWxlbWVudCkKICAgICAgICBwcmludChmIlRhcCByZXN1bHQ6IHtyZXN1bHR9IikKICAgICAgICAKICAgICAgICBwcmludCgiPT09IEVORCBERUJVRyA9PT0iKQoKICAgIGRlZiBkb3dubG9hZF9pbWFnZShzZWxmLCBzZXJ2ZXI6IHN0ciA9ICJodHRwOi8vMTAuMC4wLjU6NTAwMCIsIGNvdW50OiBpbnQgPSAxKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFThuqNpIOG6o25oIHThu6sgc2VydmVyIHbhu4EgdGhp4bq/dCBi4buLIHRow7RuZyBxdWEgaGVscGVyIHNlcnZpY2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBzZXJ2ZXI6IFNlcnZlciDEkeG7i2EgY2jhu4kgKG7hur91IE5vbmUgdGjDrCDEkeG7jWMgdOG7qyBjb25maWcgZGIsIG3hurdjIMSR4buLbmggImh0dHA6Ly8xMC4wLjAuNTo1MDAwIikKICAgICAgICAgICAgY291bnQ6IFPhu5EgbMaw4bujbmcg4bqjbmggY+G6p24gdOG6o2kgKG3hurdjIMSR4buLbmggMSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB04bqjaSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBzZXJ2ZXIgdOG7qyBkYXRhYmFzZSBu4bq/dSBraMO0bmcgdHJ1eeG7gW4gdsOgbwogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gc2VydmVyIGPDsyBwcm90b2NvbAogICAgICAgICAgICBpZiBub3Qgc2VydmVyLnN0YXJ0c3dpdGgoKCJodHRwOi8vIiwgImh0dHBzOi8vIikpOgogICAgICAgICAgICAgICAgc2VydmVyID0gZiJodHRwOi8ve3NlcnZlcn0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDonkgZOG7sW5nIFVSTCBk4buxYSB0csOqbiBz4buRIGzGsOG7o25nIOG6o25oCiAgICAgICAgICAgIGlmIGNvdW50ID09IDE6CiAgICAgICAgICAgICAgICAjIFRyxrDhu51uZyBo4bujcCB04bqjaSAxIOG6o25oIC0gc+G7rSBk4bulbmcgZW5kcG9pbnQgcmFuZG9tLWF2YXRhcgogICAgICAgICAgICAgICAgaW1hZ2VfdXJsID0gZiJ7c2VydmVyfS9yYW5kb20tYXZhdGFyIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUcsaw4budbmcgaOG7o3AgdOG6o2kgbmhp4buBdSDhuqNuaCAtIHPhu60gZOG7pW5nIGVuZHBvaW50IGdldC1zaW1pbGFyLWltYWdlcwogICAgICAgICAgICAgICAgaW1hZ2VfdXJsID0gZiJ7c2VydmVyfS9nZXQtc2ltaWxhci1pbWFnZXM/Y291bnQ9e2NvdW50fSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU+G7rSBk4bulbmcgX21ha2VfcmVxdWVzdCDEkeG7gyB04bqtbiBk4bulbmcgY8ahIGNo4bq/IHJldHJ5IHbDoCBlcnJvciBoYW5kbGluZyBjw7Mgc+G6tW4KICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJkb3dubG9hZC1pbWFnZSIsIHBhcmFtcz17InVybCI6IGltYWdlX3VybH0pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFjhu60gbMO9IHJlc3BvbnNlIGZvcm1hdCB0aOG7sWMgdOG6vwogICAgICAgICAgICAjIFJlc3BvbnNlOiB7ImRhdGEiOiB7InN1Y2Nlc3MiOiB0cnVlLCAibWVzc2FnZSI6ICIuLi4iLCAiZGF0YSI6IHsuLi59fSwgIm1lc3NhZ2UiOiAiLi4uIiwgInN0YXR1cyI6ICJzdWNjZXNzIn0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXN1bHQsIGRpY3QpIGFuZCByZXN1bHQuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgZGF0YS5zdWNjZXNzIHbDoCBkYXRhLm1lc3NhZ2UKICAgICAgICAgICAgICAgIGRhdGFfc2VjdGlvbiA9IHJlc3VsdC5nZXQoImRhdGEiLCB7fSkKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBkYXRhX3NlY3Rpb24uZ2V0KCJzdWNjZXNzIiwgRmFsc2UpCiAgICAgICAgICAgICAgICBtZXNzYWdlID0gZGF0YV9zZWN0aW9uLmdldCgibWVzc2FnZSIsICIiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyBhbmQgInRow6BuaCBjw7RuZyIgaW4gbWVzc2FnZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdOG6o2kg4bqjbmg6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKIyBUZXN0IGZ1bmN0aW9uIGZvciB0aGUgcHJvYmxlbWF0aWMgZWxlbWVudApkZWYgdGVzdF9wcm9ibGVtYXRpY19lbGVtZW50KCk6CiAgICAiIiIKICAgIFRlc3QgZnVuY3Rpb24gxJHhu4Mga2nhu4NtIHRyYSBlbGVtZW50IGPDsyBib3VuZHMgw6JtCiAgICAiIiIKICAgIGhlbHBlciA9IEhlbHBlclNlcnZpY2UoKQogICAgCiAgICAjIEVsZW1lbnQgdOG7qyB2w60gZOG7pSBj4bunYSB1c2VyCiAgICBwcm9ibGVtYXRpY19lbGVtZW50ID0gewogICAgICAgICJjbGFzcyI6ICJhbmRyb2lkLndpZGdldC5JbWFnZVZpZXciLAogICAgICAgICJwYWNrYWdlIjogImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbCIsIAogICAgICAgICJyZXNvdXJjZS1pZCI6ICJjb20uc3MuYW5kcm9pZC51Z2MudHJpbGw6aWQvZGVsIiwKICAgICAgICAidGV4dCI6ICJudWxsIiwKICAgICAgICAiY29udGVudC1kZXNjIjogIlTDrG0ga2nhur9tIiwKICAgICAgICAiYm91bmRzIjogIlszNiwwXVs4NCwtMzBdIiwKICAgICAgICAiY2xpY2thYmxlIjogImZhbHNlIiwKICAgICAgICAiZW5hYmxlZCI6ICJ0cnVlIiwKICAgICAgICAidmlzaWJsZS10by11c2VyIjogImZhbHNlIgogICAgfQogICAgCiAgICBwcmludCgiVGVzdGluZyBwcm9ibGVtYXRpYyBlbGVtZW50IHdpdGggYm91bmRzIFszNiwwXVs4NCwtMzBdIikKICAgIGhlbHBlci5kZWJ1Z19lbGVtZW50X2JvdW5kcyhwcm9ibGVtYXRpY19lbGVtZW50KQogICAgCiAgICBwcmludCgiXG5UcnlpbmcgdG8gdGFwIHRoZSBlbGVtZW50Li4uIikKICAgIHJlc3VsdCA9IGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIocHJvYmxlbWF0aWNfZWxlbWVudCkKICAgIHByaW50KGYiRmluYWwgdGFwIHJlc3VsdDoge3Jlc3VsdH0iKQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHRlc3RfcHJvYmxlbWF0aWNfZWxlbWVudCgpCiAgICAKICAgICMgVsOtIGThu6Ugc+G7rSBk4bulbmcKICAgIGhlbHBlciA9IEhlbHBlclNlcnZpY2UoKQogICAgCiAgICAjIEzhuqV5IGvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmgKICAgIHdpZHRoLCBoZWlnaHQgPSBoZWxwZXIuZ2V0X3NjcmVlbl9zaXplKCkKICAgIHByaW50KGYiS8OtY2ggdGjGsOG7m2MgbcOgbiBow6xuaDoge3dpZHRofXh7aGVpZ2h0fSIpCiAgICAKICAgICMgTeG7nyBUaWtUb2sKICAgIGhlbHBlci5vcGVuX2FwcCgiY29tLnNzLmFuZHJvaWQudWdjLnRyaWxsIikKICAgIAogICAgIyBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgbsO6dCAiVHJhbmcgY2jhu6ciIGhv4bq3YyBuw7p0ICJLaMOhbSBwaMOhIiB4deG6pXQgaGnhu4duCiAgICBlbGVtZW50c190b19maW5kID0gWwogICAgICAgIHsiY29udGVudF9kZXNjIjogIlRyYW5nIGNo4bunIn0sCiAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiS2jDoW0gcGjDoSJ9CiAgICBdCiAgICAKICAgIGVsZW1lbnQgPSBoZWxwZXIud2FpdF9mb3JfYW55X2VsZW1lbnQoZWxlbWVudHNfdG9fZmluZCkKICAgIAogICAgaWYgZWxlbWVudDoKICAgICAgICBwcmludChmIsSQw6MgdMOsbSB0aOG6pXkgcGjhuqduIHThu606IHtoZWxwZXIuZ2V0X2VsZW1lbnRfY29udGVudF9kZXNjKGVsZW1lbnQpfSIpCiAgICAgICAgaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgZWxzZToKICAgICAgICBwcmludCgiS2jDtG5nIHTDrG0gdGjhuqV5IHBo4bqnbiB04butIG7DoG8gc2F1IHRo4budaSBnaWFuIGNo4budIik=').decode('utf-8'))
