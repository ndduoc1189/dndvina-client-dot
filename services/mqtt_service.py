import base64
exec(base64.b64decode('aW1wb3J0IHBhaG8ubXF0dC5jbGllbnQgYXMgbXF0dAppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCB1dWlkCmltcG9ydCBvcwppbXBvcnQgYmFzZTY0CmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIExpc3QsIE9wdGlvbmFsLCBDYWxsYWJsZSwgVW5pb24KaW1wb3J0IGNvbmZpZwppbXBvcnQgdXRpbHMKaW1wb3J0IHNvY2tldAppbXBvcnQgcmFuZG9tCmltcG9ydCBzdWJwcm9jZXNzCgojIExvZ2dlcgpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJNUVRUU2VydmljZSIpCgpjbGFzcyBNUVRUU2VydmljZToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9zZXJ2aWNlLCBkZXZpY2VfaWQsIGhlbHBlcl9zZXJ2aWNlPU5vbmUsIGpvYl9zZXJ2aWNlPU5vbmUsIG1pbmluZ19zZXJ2aWNlPU5vbmUpOgogICAgICAgICMgS2jhu59pIHThuqFvIGPDoWMgc2VydmljZQogICAgICAgIHNlbGYuZGIgPSBkYl9zZXJ2aWNlCiAgICAgICAgc2VsZi5oZWxwZXJfc2VydmljZSA9IGhlbHBlcl9zZXJ2aWNlCiAgICAgICAgc2VsZi5qb2Jfc2VydmljZSA9IGpvYl9zZXJ2aWNlICAjIFRow6ptIHJlZmVyZW5jZSDEkeG6v24gSm9iU2VydmljZQogICAgICAgIHNlbGYubWluaW5nX3NlcnZpY2UgPSBtaW5pbmdfc2VydmljZSAgIyBUaMOqbSByZWZlcmVuY2UgxJHhur9uIE1pbmluZ1NlcnZpY2UKICAgICAgICAKICAgICAgICAjIFN0cmVhbSBsb2cgc3RhdGUKICAgICAgICBzZWxmLnN0cmVhbV9hY3RpdmUgPSBGYWxzZQogICAgICAgIHNlbGYuc3RyZWFtX3RocmVhZCA9IE5vbmUKICAgICAgICBzZWxmLnN0cmVhbV9zdG9wX2V2ZW50ID0gdGhyZWFkaW5nLkV2ZW50KCkKICAgICAgICBzZWxmLnN0cmVhbV90aW1lb3V0ID0gNjAgICMgNjAgc2Vjb25kcyBkZWZhdWx0CiAgICAgICAgc2VsZi5zdHJlYW1fbGFzdF9hY3Rpdml0eSA9IDAKICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIE1RVFQKICAgICAgICBzZWxmLmNsaWVudF9pZCA9IGYie2NvbmZpZy5NUVRUX0NMSUVOVF9JRF9QUkVGSVh9X3tyYW5kb20ucmFuZGludCgxLCA5OSl9X3tkZXZpY2VfaWR9IgogICAgICAgIHNlbGYuYnJva2VyX3VybCA9IGNvbmZpZy5NUVRUX1NFUlZFUlNbY29uZmlnLk1PREVdCiAgICAgICAgc2VsZi5icm9rZXJfYWRkcmVzcyA9IHNlbGYuYnJva2VyX3VybC5yZXBsYWNlKCJtcXR0Oi8vIiwgIiIpLnNwbGl0KCI6IilbMF0KICAgICAgICBzZWxmLmJyb2tlcl9wb3J0ID0gaW50KHNlbGYuYnJva2VyX3VybC5zcGxpdCgiOiIpWy0xXSkgaWYgIjoiIGluIHNlbGYuYnJva2VyX3VybCBlbHNlIDE4ODMKICAgICAgICBzZWxmLnVzZXJuYW1lID0gY29uZmlnLk1RVFRfVVNFUk5BTUUKICAgICAgICBzZWxmLnBhc3N3b3JkID0gY29uZmlnLk1RVFRfUEFTU1dPUkQKICAgICAgICAKICAgICAgICAjIFRy4bqhbmcgdGjDoWkga+G6v3QgbuG7kWkKICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5jbGllbnQgPSBOb25lCiAgICAgICAgc2VsZi5kZXZpY2VfaWQgPSBkZXZpY2VfaWQKICAgICAgICAKICAgICAgICAjIFJlY29ubmVjdGlvbiBsb2dpYwogICAgICAgIHNlbGYucmVjb25uZWN0X2RlbGF5ID0gMSAgIyBC4bqvdCDEkeG6p3UgduG7m2kgMSBnacOieQogICAgICAgIHNlbGYubWF4X3JlY29ubmVjdF9kZWxheSA9IDYwICAjIFThu5FpIMSRYSA2MCBnacOieQogICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ID0gMAogICAgICAgIHNlbGYubGFzdF9kaXNjb25uZWN0X3RpbWUgPSAwCiAgICAgICAgc2VsZi5tYW51YWxfZGlzY29ubmVjdCA9IEZhbHNlICAjIEZsYWcgxJHhu4MgcGjDom4gYmnhu4d0IGRpc2Nvbm5lY3QgY8OzIGNo4bunIMO9IHbDoCBraMO0bmcgY2jhu6cgw70KICAgICAgICAKICAgICAgICAjIFRvcGljcwogICAgICAgIHNlbGYudG9waWNfY2xpZW50X3N5bmMgPSBjb25maWcuTVFUVF9UT1BJQ19DTElFTlRfU1lOQwogICAgICAgIHNlbGYudG9waWNfc2VydmVyX3Rhc2sgPSBmIntjb25maWcuTVFUVF9UT1BJQ19TRVJWRVJfVEFTS19QUkVGSVh9L3tzZWxmLmRldmljZV9pZH0iCiAgICAgICAgCiAgICAgICAgIyBRdeG6o24gbMO9IHRhc2sgdsOgIHN5bmMKICAgICAgICBzZWxmLnRhc2tfaGFuZGxlcnMgPSB7fQogICAgICAgIHNlbGYuc3luY190aHJlYWQgPSBOb25lCiAgICAgICAgc2VsZi5zeW5jX2ludGVydmFsID0gY29uZmlnLlNZTkNfSU5URVJWQUwKICAgICAgICBzZWxmLnN5bmNfcnVubmluZyA9IEZhbHNlCiAgICAKICAgIGRlZiBzZXRfam9iX3NlcnZpY2Uoc2VsZiwgam9iX3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIMSQ4bq3dCBKb2JTZXJ2aWNlIMSR4buDIHjhu60gbMO9IGPDoWMgdGjDtG5nIGLDoW8gY29uZmlnIHVwZGF0ZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl9zZXJ2aWNlOiBJbnN0YW5jZSBj4bunYSBKb2JTZXJ2aWNlCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5qb2Jfc2VydmljZSA9IGpvYl9zZXJ2aWNlCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgxJHhurd0IEpvYlNlcnZpY2UgY2hvIE1RVFRTZXJ2aWNlIikKICAgICAgICBzZWxmLnJ1bm5pbmcgPSBGYWxzZQogICAgICAgIHNlbGYuc3RvcF9ldmVudCA9IHRocmVhZGluZy5FdmVudCgpCiAgICAgICAgc2VsZi5zeW5jX2ludGVydmFsID0gc2VsZi5kYi5nZXRfZGV2aWNlX2NvbmZpZygic3luY19pbnRlcnZhbCIsIGNvbmZpZy5TWU5DX0lOVEVSVkFMKQogICAgICAgIAogICAgICAgICMgVGhlbyBkw7VpIFJBTSDEkeG7gyB04buxIMSR4buZbmcgcmVib290CiAgICAgICAgc2VsZi5yYW1fdXNhZ2VfaGlzdG9yeSA9IFtdICAjIEzGsHUgMyBs4bqnbiDEkW8gUkFNIGfhuqduIG5o4bqldAogICAgICAgIHNlbGYuaGlnaF9yYW1fdGhyZXNob2xkID0gODggICMgTmfGsOG7oW5nIFJBTSBjYW8gKCUpCiAgICAgICAgc2VsZi5jb25zZWN1dGl2ZV9oaWdoX3JhbV9saW1pdCA9IDMgICMgU+G7kSBs4bqnbiBsacOqbiB0aeG6v3AgUkFNIGNhbyB0csaw4bubYyBraGkgcmVib290CiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIG3DtGkgdHLGsOG7nW5nIFRlcm11eAogICAgICAgIHNlbGYuaXNfdGVybXV4ID0gJ1RFUk1VWF9WRVJTSU9OJyBpbiBvcy5lbnZpcm9uIG9yICcvZGF0YS9kYXRhL2NvbS50ZXJtdXgnIGluIG9zLmVudmlyb24uZ2V0KCdQQVRIJywgJycpCiAgICAgICAgaWYgc2VsZi5pc190ZXJtdXg6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkGFuZyBjaOG6oXkgdHJvbmcgbcO0aSB0csaw4budbmcgVGVybXV4IikKCiAgICBkZWYgX2NyZWF0ZV9jbGllbnQoc2VsZikgLT4gbXF0dC5DbGllbnQ6CiAgICAgICAgIiIiVOG6oW8gdsOgIGPhuqV1IGjDrG5oIE1RVFQgY2xpZW50IiIiCiAgICAgICAgY2xpZW50ID0gTm9uZQoKICAgICAgICAjIFRo4butIHThuqFvIHbhu5tpIEFQSSB2MgogICAgICAgIHRyeToKICAgICAgICAgICAgY2xpZW50ID0gbXF0dC5DbGllbnQoCiAgICAgICAgICAgICAgICBjbGllbnRfaWQ9c2VsZi5jbGllbnRfaWQsCiAgICAgICAgICAgICAgICBjbGVhbl9zZXNzaW9uPVRydWUsCiAgICAgICAgICAgICAgICBwcm90b2NvbD1tcXR0Lk1RVFR2MzExLAogICAgICAgICAgICAgICAgY2FsbGJhY2tfYXBpX3ZlcnNpb249Z2V0YXR0cihtcXR0LkNhbGxiYWNrQVBJVmVyc2lvbiwgJ1ZFUlNJT04yJywgTm9uZSkKICAgICAgICAgICAgKQogICAgICAgICAgICBsb2dnZXIuaW5mbygiVOG6oW8gTVFUVCBjbGllbnQgduG7m2kgQVBJIHYyIikKICAgICAgICBleGNlcHQgKEF0dHJpYnV0ZUVycm9yLCBUeXBlRXJyb3IpOgogICAgICAgICAgICAjIEZhbGxiYWNrIEFQSSB2MQogICAgICAgICAgICBjbGllbnQgPSBtcXR0LkNsaWVudCgKICAgICAgICAgICAgICAgIGNsaWVudF9pZD1zZWxmLmNsaWVudF9pZCwKICAgICAgICAgICAgICAgIGNsZWFuX3Nlc3Npb249VHJ1ZSwKICAgICAgICAgICAgICAgIHByb3RvY29sPW1xdHQuTVFUVHYzMTEKICAgICAgICAgICAgKQogICAgICAgICAgICBsb2dnZXIuaW5mbygiVOG6oW8gTVFUVCBjbGllbnQgduG7m2kgQVBJIHYxIikKICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIHjDoWMgdGjhu7FjIG7hur91IGPDswogICAgICAgIGlmIHNlbGYudXNlcm5hbWUgYW5kIHNlbGYucGFzc3dvcmQ6CiAgICAgICAgICAgIGNsaWVudC51c2VybmFtZV9wd19zZXQoc2VsZi51c2VybmFtZSwgc2VsZi5wYXNzd29yZCkKICAgICAgICAKICAgICAgICAjIMSQxINuZyBrw70gY2FsbGJhY2sKICAgICAgICBjbGllbnQub25fY29ubmVjdCA9IHNlbGYuX29uX2Nvbm5lY3QKICAgICAgICBjbGllbnQub25fbWVzc2FnZSA9IHNlbGYuX29uX21lc3NhZ2UKICAgICAgICBjbGllbnQub25fZGlzY29ubmVjdCA9IHNlbGYuX29uX2Rpc2Nvbm5lY3QKICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIGtlZXAtYWxpdmUgZMOgaSBoxqFuIHbDoCByZWNvbm5lY3Rpb24KICAgICAgICBjbGllbnQucmVjb25uZWN0X2RlbGF5X3NldChtaW5fZGVsYXk9MSwgbWF4X2RlbGF5PTYwKQogICAgICAgIAogICAgICAgIHJldHVybiBjbGllbnQKCiAgICBkZWYgY29ubmVjdChzZWxmKSAtPiBib29sOgogICAgICAgICIiIkvhur90IG7hu5FpIMSR4bq/biBNUVRUIGJyb2tlciB24bubaSBleHBvbmVudGlhbCBiYWNrb2ZmIiIiCiAgICAgICAgZGVmIGNhbl9jb25uZWN0KGhvc3Q6IHN0ciwgcG9ydDogaW50LCB0aW1lb3V0OiBmbG9hdCA9IDMuMCkgLT4gYm9vbDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgd2l0aCBzb2NrZXQuY3JlYXRlX2Nvbm5lY3Rpb24oKGhvc3QsIHBvcnQpLCB0aW1lb3V0PXRpbWVvdXQpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgbWFpbl9ob3N0ID0gc2VsZi5icm9rZXJfYWRkcmVzcwogICAgICAgIG1haW5fcG9ydCA9IHNlbGYuYnJva2VyX3BvcnQKICAgICAgICBmYWxsYmFja19ob3N0ID0gIjEwLjAuMC42IgogICAgICAgIGZhbGxiYWNrX3BvcnQgPSA5MDIwCgogICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBu4buRaSBzb2NrZXQgdOG7m2kgY+G6oyAyIElQCiAgICAgICAgbWFpbl9vayA9IGNhbl9jb25uZWN0KG1haW5faG9zdCwgbWFpbl9wb3J0KQogICAgICAgIGZhbGxiYWNrX29rID0gY2FuX2Nvbm5lY3QoZmFsbGJhY2tfaG9zdCwgZmFsbGJhY2tfcG9ydCkKICAgICAgICBpZiBtYWluX29rOgogICAgICAgICAgICBjb25uZWN0X2hvc3QgPSBtYWluX2hvc3QKICAgICAgICAgICAgY29ubmVjdF9wb3J0ID0gbWFpbl9wb3J0CiAgICAgICAgZWxpZiBmYWxsYmFja19vazoKICAgICAgICAgICAgY29ubmVjdF9ob3N0ID0gZmFsbGJhY2tfaG9zdAogICAgICAgICAgICBjb25uZWN0X3BvcnQgPSBmYWxsYmFja19wb3J0CiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIGvhur90IG7hu5FpIMSRxrDhu6NjIHNvY2tldCB04bubaSBj4bqjIHttYWluX2hvc3R9OnttYWluX3BvcnR9IGzhuqtuIHtmYWxsYmFja19ob3N0fTp7ZmFsbGJhY2tfcG9ydH0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFThuqFvIGNsaWVudCBt4bubaSBu4bq/dSBjaMawYSBjw7MgaG/hurdjIGNsaWVudCBjxakgYuG7iyBs4buXaQogICAgICAgICAgICBpZiBzZWxmLmNsaWVudCBpcyBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5jbGllbnQgPSBzZWxmLl9jcmVhdGVfY2xpZW50KCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVzZXQgdHLhuqFuZyB0aMOhaQogICAgICAgICAgICBzZWxmLnN0b3BfZXZlbnQuY2xlYXIoKQogICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYubWFudWFsX2Rpc2Nvbm5lY3QgPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyBr4bq/dCBu4buRaSB04bubaSBNUVRUIGJyb2tlciB7Y29ubmVjdF9ob3N0fTp7Y29ubmVjdF9wb3J0fSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFPhu60gZOG7pW5nIGtlZXBhbGl2ZSBs4bubbiBoxqFuICgxMjAgZ2nDonkgdGhheSB2w6wgNjApIMSR4buDIHBow6F0IGhp4buHbiBt4bqldCBr4bq/dCBu4buRaQogICAgICAgICAgICAjIEtoaSBt4bqldCBt4bqhbmcgcuG7k2kgY8OzIGzhuqFpLCBjbGllbnQgc+G6vSB04buxIMSR4buZbmcgcmVjb25uZWN0IHF1YSBfb25fZGlzY29ubmVjdCBjYWxsYmFjawogICAgICAgICAgICBzZWxmLmNsaWVudC5jb25uZWN0X2FzeW5jKGNvbm5lY3RfaG9zdCwgY29ubmVjdF9wb3J0LCBrZWVwYWxpdmU9MTIwKQogICAgICAgICAgICBzZWxmLmNsaWVudC5sb29wX3N0YXJ0KCkKCiAgICAgICAgICAgIGRlZiBfd2FpdF9jb25uZWN0ZWQodGltZW91dF9zZWM6IGludCA9IDE1KSAtPiBib29sOgogICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UodGltZW91dF9zZWMpOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgaWYgX3dhaXRfY29ubmVjdGVkKCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6Mga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nIMSR4bq/biBNUVRUIGJyb2tlciB7Y29ubmVjdF9ob3N0fTp7Y29ubmVjdF9wb3J0fSIpCiAgICAgICAgICAgICAgICBzZWxmLmJyb2tlcl9hZGRyZXNzID0gY29ubmVjdF9ob3N0CiAgICAgICAgICAgICAgICBzZWxmLmJyb2tlcl9wb3J0ID0gY29ubmVjdF9wb3J0CiAgICAgICAgICAgICAgICAjIFJlc2V0IHJlY29ubmVjdCBkZWxheSBraGkga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICBzZWxmLnJlY29ubmVjdF9kZWxheSA9IDEKICAgICAgICAgICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ID0gMAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkvhur90IG7hu5FpIE1RVFQgdGjhuqV0IGLhuqFpIHThu5tpIHtjb25uZWN0X2hvc3R9Ontjb25uZWN0X3BvcnR9IikKICAgICAgICAgICAgICAgIHNlbGYuX2NsZWFudXBfY2xpZW50KCkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGvhur90IG7hu5FpIE1RVFQ6IHtzdHIoZSl9IikKICAgICAgICAgICAgc2VsZi5fY2xlYW51cF9jbGllbnQoKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2NsZWFudXBfY2xpZW50KHNlbGYpOgogICAgICAgICIiIkThu41uIGThurlwIE1RVFQgY2xpZW50IiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBzZWxmLmNsaWVudDoKICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50Lmxvb3Bfc3RvcCgpCiAgICAgICAgICAgICAgICBzZWxmLmNsaWVudC5kaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50ID0gTm9uZQogICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBk4buNbiBk4bq5cCBNUVRUIGNsaWVudDoge2V9IikKCiAgICBkZWYgZW5zdXJlX2Nvbm5lY3RlZChzZWxmKSAtPiBib29sOgogICAgICAgICIiIsSQ4bqjbSBi4bqjbyBr4bq/dCBu4buRaSBNUVRUIHRyxrDhu5tjIGtoaSB0aOG7sWMgaGnhu4duIGPDoWMgdGhhbyB0w6FjIHbhu5tpIHJhdGUgbGltaXRpbmciIiIKICAgICAgICBpZiBzZWxmLmlzX2Nvbm5lY3RlZDoKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcgdHJvbmcgcXXDoSB0csOsbmggcmVjb25uZWN0IGtow7RuZwogICAgICAgIGN1cnJlbnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgaWYgY3VycmVudF90aW1lIC0gc2VsZi5sYXN0X2Rpc2Nvbm5lY3RfdGltZSA8IDU6ICAjIENo4budIMOtdCBuaOG6pXQgNSBnacOieSB04burIGzhuqduIGRpc2Nvbm5lY3QgY3Xhu5FpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygixJBhbmcgdHJvbmcgdGjhu51pIGdpYW4gY29vbGRvd24gcmVjb25uZWN0LCBjaOG7nS4uLiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBsb2dnZXIud2FybmluZygiTVFUVCBjaMawYSBr4bq/dCBu4buRaSwgxJFhbmcgdGjhu60ga+G6v3QgbuG7kWkgbOG6oWkuLi4iKQogICAgICAgIHJldHVybiBzZWxmLmNvbm5lY3QoKQoKICAgIGRlZiBfb25fY29ubmVjdChzZWxmLCBjbGllbnQsIHVzZXJkYXRhLCBmbGFncywgcmMsIHByb3BlcnRpZXM9Tm9uZSk6CiAgICAgICAgIiIiQ2FsbGJhY2sga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZyIiIgogICAgICAgIGlmIHJjID09IDA6CiAgICAgICAgICAgIHNlbGYuaXNfY29ubmVjdGVkID0gVHJ1ZQogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcgdOG7m2kgTVFUVCBicm9rZXIiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMSDbmcga8O9IG5o4bqtbiB0YXNrCiAgICAgICAgICAgIHNlbGYuY2xpZW50LnN1YnNjcmliZShzZWxmLnRvcGljX3NlcnZlcl90YXNrLCBxb3M9MSkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMSRxINuZyBrw70gbmjhuq1uIHRhc2sgdOG6oWk6IHtzZWxmLnRvcGljX3NlcnZlcl90YXNrfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpCiAgICAgICAgICAgIHNlbGYuc2VuZF9jb25uZWN0X25vdGlmaWNhdGlvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IHJlY29ubmVjdCBjb3VudGVyIGtoaSBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcKICAgICAgICAgICAgc2VsZi5yZWNvbm5lY3RfY291bnQgPSAwCiAgICAgICAgICAgIHNlbGYucmVjb25uZWN0X2RlbGF5ID0gMQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkvhur90IG7hu5FpIE1RVFQgdGjhuqV0IGLhuqFpIHbhu5tpIG3DoyBs4buXaToge3JjfSIpCiAgICAgICAgICAgICMgVMSDbmcgcmVjb25uZWN0IGNvdW50IGtoaSBr4bq/dCBu4buRaSB0aOG6pXQgYuG6oWkKICAgICAgICAgICAgc2VsZi5yZWNvbm5lY3RfY291bnQgKz0gMQoKICAgIGRlZiBfb25fZGlzY29ubmVjdChzZWxmLCBjbGllbnQsIHVzZXJkYXRhLCByYywgcHJvcGVydGllcz1Ob25lLCByZWFzb25fY29kZT1Ob25lLCAqKmt3YXJncyk6CiAgICAgICAgIiIiQ2FsbGJhY2sga2hpIG5n4bqvdCBr4bq/dCBu4buRaSB24bubaSBjxqEgY2jhur8gcmVjb25uZWN0IHRow7RuZyBtaW5oIiIiCiAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHNlbGYubGFzdF9kaXNjb25uZWN0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIAogICAgICAgIGlmIHNlbGYubWFudWFsX2Rpc2Nvbm5lY3Q6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIG5n4bqvdCBr4bq/dCBu4buRaSBNUVRUIHRoZW8gecOqdSBj4bqndSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBpZiByYyAhPSAwOgogICAgICAgICAgICBzZWxmLnJlY29ubmVjdF9jb3VudCArPSAxCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTmfhuq90IGvhur90IG7hu5FpIE1RVFQga2jDtG5nIG1vbmcgbXXhu5FuIGzhuqduIHtzZWxmLnJlY29ubmVjdF9jb3VudH0gduG7m2kgbcOjIGzhu5dpOiB7cmN9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2jhu4kgYXV0by1yZWNvbm5lY3QgbuG6v3Uga2jDtG5nIHBo4bqjaSBtYW51YWwgZGlzY29ubmVjdAogICAgICAgICAgICBpZiBub3Qgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpOgogICAgICAgICAgICAgICAgc2VsZi5fc2NoZWR1bGVfcmVjb25uZWN0KCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBuZ+G6r3Qga+G6v3QgbuG7kWkgTVFUVCIpCgogICAgZGVmIF9zY2hlZHVsZV9yZWNvbm5lY3Qoc2VsZik6CiAgICAgICAgIiIiTMOqbiBs4buLY2gga+G6v3QgbuG7kWkgbOG6oWkgbeG7l2kgMzAgZ2nDonksIGzhurdwIHbDtCBo4bqhbiDEkeG6v24ga2hpIGThu6tuZyBhcHAiIiIKICAgICAgICBsb2dnZXIuaW5mbygiU+G6vSB0aOG7rSBr4bq/dCBu4buRaSBs4bqhaSBzYXUgMzAgZ2nDonkuLi4iKQogICAgICAgIAogICAgICAgIGRlZiByZWNvbm5lY3RfbG9vcCgpOgogICAgICAgICAgICB3aGlsZSBub3Qgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpIGFuZCBub3Qgc2VsZi5tYW51YWxfZGlzY29ubmVjdDoKICAgICAgICAgICAgICAgICMgQ2jhu50gMzAgZ2nDonksIGPDsyB0aOG7gyBi4buLIG5n4bqvdCBi4bufaSBzdG9wX2V2ZW50CiAgICAgICAgICAgICAgICBpZiBzZWxmLnN0b3BfZXZlbnQud2FpdCgzMCk6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgICMgQuG7iyBk4burbmcsIHRob8OhdCBsb29wCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgdHLhuqFuZyB0aMOhaSB0csaw4bubYyBraGkgdGjhu60ga+G6v3QgbuG7kWkKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfY29ubmVjdGVkIG9yIHNlbGYubWFudWFsX2Rpc2Nvbm5lY3Q6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgICMgxJDDoyBr4bq/dCBu4buRaSBob+G6t2MgYuG7iyBk4burbmcgdGjhu6cgY8O0bmcKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVGjhu60ga+G6v3QgbuG7kWkgbOG6oWkgTVFUVCAobOG6p24ge3NlbGYucmVjb25uZWN0X2NvdW50fSkiKQogICAgICAgICAgICAgICAgaWYgc2VsZi5jb25uZWN0KCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkvhur90IG7hu5FpIGzhuqFpIE1RVFQgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgICAgICBicmVhayAgIyBL4bq/dCBu4buRaSB0aMOgbmggY8O0bmcsIHRob8OhdCBsb29wCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkvhur90IG7hu5FpIGzhuqFpIE1RVFQgdGjhuqV0IGLhuqFpIGzhuqduIHtzZWxmLnJlY29ubmVjdF9jb3VudH0sIHRo4butIGzhuqFpIHNhdSAzMCBnacOieS4uLiIpCiAgICAgICAgCiAgICAgICAgIyBDaOG6oXkgdHJvbmcgdGhyZWFkIHJpw6puZyDEkeG7gyBraMO0bmcgYmxvY2sKICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1yZWNvbm5lY3RfbG9vcCwgZGFlbW9uPVRydWUpLnN0YXJ0KCkKCiAgICBkZWYgX3NhZmVfcHVibGlzaChzZWxmLCB0b3BpYzogc3RyLCBwYXlsb2FkOiBzdHIsIHFvczogaW50ID0gMSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBH4butaSBtZXNzYWdlIGFuIHRvw6BuIHbhu5tpIGtp4buDbSB0cmEga+G6v3QgbuG7kWkgdHLGsOG7m2Mga2hpIHB1Ymxpc2gKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0b3BpYzogTVFUVCB0b3BpYwogICAgICAgICAgICBwYXlsb2FkOiBO4buZaSBkdW5nIG1lc3NhZ2UgKHN0cmluZykKICAgICAgICAgICAgcW9zOiBRdWFsaXR5IG9mIFNlcnZpY2UgKDAsIDEsIGhv4bq3YyAyKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGfhu61pIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfY29ubmVjdGVkKCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgZ+G7rWkgbWVzc2FnZSDEkeG6v24ge3RvcGljfTogTVFUVCBjaMawYSBr4bq/dCBu4buRaSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuY2xpZW50LnB1Ymxpc2godG9waWMsIHBheWxvYWQsIHFvcz1xb3MpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXN1bHQucmMgPT0gbXF0dC5NUVRUX0VSUl9TVUNDRVNTOgogICAgICAgICAgICAgICAgI2xvZ2dlci5pbmZvKGYixJDDoyBn4butaSBtZXNzYWdlIHRow6BuaCBjw7RuZyDEkeG6v24ge3RvcGljfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIG1lc3NhZ2UgxJHhur9uIHt0b3BpY306IHttcXR0LmVycm9yX3N0cmluZyhyZXN1bHQucmMpfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7rWkgbWVzc2FnZSDEkeG6v24ge3RvcGljfToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgc2VuZF90YXNrX3JlcG9ydChzZWxmLCB0YXNrX2lkOiBzdHIsIGRldmljZV9pZDogc3RyLCBzdGF0dXM6IHN0ciwgY2xpZW50X21lc3NhZ2U6IHN0ciA9ICIiLCBkYXRhOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpOgogICAgICAgICIiIgogICAgICAgIEfhu61pIGLDoW8gY8OhbyBr4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIHRhc2sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX2lkOiBJRCBj4bunYSB0YXNrCiAgICAgICAgICAgIGRldmljZV9pZDogSUQgY+G7p2EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgIHN0YXR1czogVHLhuqFuZyB0aMOhaSAoc3VjY2Vzcy9mYWlsZWQpCiAgICAgICAgICAgIGNsaWVudF9tZXNzYWdlOiBUaMO0bmcgxJFp4buHcCB04burIGNsaWVudAogICAgICAgICAgICBkYXRhOiBE4buvIGxp4buHdSBi4buVIHN1bmcgKG9wdGlvbmFsKQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVwb3J0X2RhdGEgPSB7CiAgICAgICAgICAgICAgICAidGFza19pZCI6IHRhc2tfaWQsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgInN0YXR1cyI6IHN0YXR1cywKICAgICAgICAgICAgICAgICJjbGllbnRfbWVzc2FnZSI6IGNsaWVudF9tZXNzYWdlLAogICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBkYXRhIG7hur91IGPDswogICAgICAgICAgICBpZiBkYXRhOgogICAgICAgICAgICAgICAgcmVwb3J0X2RhdGFbImRhdGEiXSA9IGRhdGEKCiAgICAgICAgICAgIGlmIHNlbGYuX3NhZmVfcHVibGlzaCgiZG5kdmluYS9jbGllbnQvdGFza19yZXBvcnQiLCBqc29uLmR1bXBzKHJlcG9ydF9kYXRhKSk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgZ+G7rWkgYsOhbyBjw6FvIHRhc2sge3Rhc2tfaWR9IHbhu5tpIHRy4bqhbmcgdGjDoWkge3N0YXR1c30iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIGLDoW8gY8OhbyB0YXNrOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBzZW5kX2Nvbm5lY3Rfbm90aWZpY2F0aW9uKHNlbGYpOgogICAgICAgICIiIkfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpIMSR4bq/biBzZXJ2ZXIiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbm5lY3RfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiBzZWxmLmRldmljZV9pZCwKICAgICAgICAgICAgICAgICJ0aW1lc3RhbXAiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIHNlbGYuX3NhZmVfcHVibGlzaCgiZG5kdmluYS9jbGllbnQvY29ubmVjdCIsIGpzb24uZHVtcHMoY29ubmVjdF9kYXRhKSk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgZ+G7rWkgdGjDtG5nIGLDoW8ga+G6v3QgbuG7kWkgY2hvIHRoaeG6v3QgYuG7iyB7c2VsZi5kZXZpY2VfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4butaSB0aMO0bmcgYsOhbyBr4bq/dCBu4buRaToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgcmVnaXN0ZXJfdGFza19oYW5kbGVyKHNlbGYsIHRhc2tfdHlwZTogc3RyLCBoYW5kbGVyOiBDYWxsYWJsZSk6CiAgICAgICAgIiIiCiAgICAgICAgxJDEg25nIGvDvSBoYW5kbGVyIGNobyBsb+G6oWkgdGFzawogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfdHlwZTogTG/huqFpIHRhc2sKICAgICAgICAgICAgaGFuZGxlcjogSMOgbSB44butIGzDvSB0YXNrCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi50YXNrX2hhbmRsZXJzW3Rhc2tfdHlwZV0gPSBoYW5kbGVyCiAgICAKICAgIGRlZiBfcmVhZF9yZWNlbnRfbG9ncyhzZWxmLCBudW1fbGluZXM9MjAwKToKICAgICAgICAiIiIKICAgICAgICDEkOG7jWMgY8OhYyBkw7JuZyBsb2cgZ+G6p24gbmjhuqV0IHThu6sgZmlsZSBhcHAubG9nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbnVtX2xpbmVzOiBT4buRIGTDsm5nIGxvZyBj4bqnbiDEkeG7jWMgKG3hurdjIMSR4buLbmggMTAwKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W3N0cl06IERhbmggc8OhY2ggY8OhYyBkw7JuZyBsb2cgZ+G6p24gbmjhuqV0IGhv4bq3YyB0aMO0bmcgYsOhbyBs4buXaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgbG9nX2ZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihjb25maWcuQkFTRV9ESVIsICJhcHAubG9nIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZV9wYXRoKToKICAgICAgICAgICAgICAgICMgRmlsZSBjaMawYSDEkcaw4bujYyB04bqhbyBi4bufaSBsb2dnaW5nIHN5c3RlbQogICAgICAgICAgICAgICAgcmV0dXJuIFtmIltJTkZPXSBGaWxlIGxvZyBjaMawYSDEkcaw4bujYyB04bqhbywgY2jGsGEgY8OzIGxvZyBuw6BvIl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIMSR4buNYyBmaWxlIHbhu5tpIHJldHJ5IMSR4buDIHRyw6FuaCB4dW5nIMSR4buZdAogICAgICAgICAgICBtYXhfcmV0cmllcyA9IDMKICAgICAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UobWF4X3JldHJpZXMpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihsb2dfZmlsZV9wYXRoLCAncicsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0naWdub3JlJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgbGluZXMgPSBmLnJlYWRsaW5lcygpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgbnVtX2xpbmVzIGTDsm5nIGN14buRaSBjw7luZwogICAgICAgICAgICAgICAgICAgIHJlY2VudF9saW5lcyA9IGxpbmVzWy1udW1fbGluZXM6XSBpZiBsZW4obGluZXMpID4gbnVtX2xpbmVzIGVsc2UgbGluZXMKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIExv4bqhaSBi4buPIGvDvSB04buxIHh14buRbmcgZMOybmcgdsOgIGPDoWMga2hv4bqjbmcgdHLhuq9uZyB0aOG7q2EKICAgICAgICAgICAgICAgICAgICByZWNlbnRfbG9ncyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gcmVjZW50X2xpbmVzIGlmIGxpbmUuc3RyaXAoKV0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVjZW50X2xvZ3MKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGV4Y2VwdCAoUGVybWlzc2lvbkVycm9yLCBJT0Vycm9yLCBPU0Vycm9yKSBhcyBmaWxlX2Vycm9yOgogICAgICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCBtYXhfcmV0cmllcyAtIDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC4xKSAgIyBDaOG7nSAxMDBtcyBy4buTaSB0aOG7rSBs4bqhaQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbZiJbRVJST1JdIEtow7RuZyB0aOG7gyDEkeG7jWMgZmlsZSBsb2c6IHtzdHIoZmlsZV9lcnJvcil9Il0KICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gW2YiW0VSUk9SXSBM4buXaSDEkeG7jWMgZmlsZSBsb2c6IHtzdHIoZSl9Il0KCiAgICBkZWYgc3luY19kYXRhKHNlbGYpOgogICAgICAgICIiIsSQ4buTbmcgYuG7mSBk4buvIGxp4buHdSB24bubaSBzZXJ2ZXIiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTuG6v3UgY2jGsGEga+G6v3QgbuG7kWkgTVFUVCwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mQogICAgICAgICAgICBpZiBub3Qgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ2jGsGEga+G6v3QgbuG7kWkgTVFUVCwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGhlbHBlciBzZXJ2aWNlCiAgICAgICAgICAgIGhlbHBlciA9IHNlbGYuaGVscGVyX3NlcnZpY2UKICAgICAgICAgICAgaWYgbm90IGhlbHBlcjoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIGPDsyBoZWxwZXIgc2VydmljZSwga2jDtG5nIHRo4buDIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZAogICAgICAgICAgICBkZXZpY2VfaWQgPSBzZWxmLmRiLmdldF9vcl9jcmVhdGVfZGV2aWNlX2lkKCkKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pZDoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCBkZXZpY2VfaWQsIGtow7RuZyB0aOG7gyDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IE5vbmUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGV2aWNlX2luZm9fcmVzcG9uc2UgPSBoZWxwZXIuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBs4bqleSB0aMOgbmggY8O0bmcsIGzGsHUgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICAgICAgaWYgZGV2aWNlX2luZm9fcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvX3Jlc3BvbnNlOgogICAgICAgICAgICAgICAgICAgICMgTMawdSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iyB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5zYXZlX2RldmljZV9pbmZvKGRldmljZV9pbmZvX3Jlc3BvbnNlWyJkYXRhIl0pCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBkZXZpY2VfaW5mb19yZXNwb25zZVsiZGF0YSJdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUaGVvIGTDtWkgUkFNIMSR4buDIHThu7EgxJHhu5luZyByZWJvb3QKICAgICAgICAgICAgICAgICAgICBzZWxmLl9tb25pdG9yX3JhbV91c2FnZShkZXZpY2VfaW5mbykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGzhuqV5IHRow7RuZyB0aW4gdGhp4bq/dCBi4buLOiB7ZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIGzhuqV5IMSRxrDhu6NjIHRow7RuZyB0aW4gdGhp4bq/dCBi4buLLCBz4butIGThu6VuZyB0aMO0bmcgdGluIMSRw6MgbMawdSB0cm9uZyBkYXRhYmFzZQogICAgICAgICAgICBpZiBub3QgZGV2aWNlX2luZm86CiAgICAgICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZGIuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgZGV2aWNlX2luZm86CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIGPDsyB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iywgxJHhu5NuZyBi4buZIGThu68gbGnhu4d1IGPDsyB0aOG7gyBraMO0bmcgxJHhuqd5IMSR4bunIikKICAgICAgICAgICAgICAgIGRldmljZV9pbmZvID0ge30KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBkZXZpY2VfY29uZmlnID0gc2VsZi5kYi5nZXRfYWxsX2RldmljZV9jb25maWcoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buZcCBjw6FjIHRy4bqhbmcgdGjDoWkgcnVudGltZSAocGF1c2Vfam9iLCBkZXZpY2VfaXNfd29ya2luZywgZGV2aWNlX21lc3NhZ2UpIHbDoG8gZGV2aWNlX2luZm8KICAgICAgICAgICAgZm9yIHJ1bnRpbWVfa2V5IGluIFsicGF1c2Vfam9iIiwgImRldmljZV9pc193b3JraW5nIiwgImRldmljZV9tZXNzYWdlIl06CiAgICAgICAgICAgICAgICBpZiBydW50aW1lX2tleSBpbiBkZXZpY2VfY29uZmlnOgogICAgICAgICAgICAgICAgICAgIGRldmljZV9pbmZvW3J1bnRpbWVfa2V5XSA9IGRldmljZV9jb25maWcucG9wKHJ1bnRpbWVfa2V5KQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIEdpw6EgdHLhu4sgbeG6t2MgxJHhu4tuaCBu4bq/dSBjaMawYSBj4bqldSBow6xuaAogICAgICAgICAgICAgICAgICAgIGRldmljZV9pbmZvW3J1bnRpbWVfa2V5XSA9IEZhbHNlIGlmIHJ1bnRpbWVfa2V5ICE9ICJkZXZpY2VfbWVzc2FnZSIgZWxzZSAiIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBnb2xpa2VfcmVwb3J0IGto4buPaSBkZXZpY2VfY29uZmlnIMSR4buDIGfhu61pIHJpw6puZwogICAgICAgICAgICBnb2xpa2VfcmVwb3J0ID0gTm9uZQogICAgICAgICAgICBpZiAiZ29saWtlX3JlcG9ydCIgaW4gZGV2aWNlX2NvbmZpZzoKICAgICAgICAgICAgICAgIGdvbGlrZV9yZXBvcnQgPSBkZXZpY2VfY29uZmlnLnBvcCgiZ29saWtlX3JlcG9ydCIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExv4bqhaSBi4buPIGdvbGlrZV9hcGlfYmFzZSBraOG7j2kgZGV2aWNlX2NvbmZpZwogICAgICAgICAgICBpZiAiZ29saWtlX2FwaV9iYXNlIiBpbiBkZXZpY2VfY29uZmlnOgogICAgICAgICAgICAgICAgZGV2aWNlX2NvbmZpZy5wb3AoImdvbGlrZV9hcGlfYmFzZSIpCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIsSQw6MgbG/huqFpIGLhu48gZ29saWtlX2FwaV9iYXNlIGto4buPaSBk4buvIGxp4buHdSDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBtaW5pbmdfaW5mbyB04burIG1pbmluZ19zZXJ2aWNlIChu4bq/dSBjw7MpCiAgICAgICAgICAgIG1pbmluZ19pbmZvID0gTm9uZQogICAgICAgICAgICBpZiBzZWxmLm1pbmluZ19zZXJ2aWNlOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG1pbmluZ19zdW1tYXJ5ID0gc2VsZi5taW5pbmdfc2VydmljZS5nZXRfbWluaW5nX3N1bW1hcnkoKQogICAgICAgICAgICAgICAgICAgIGlmIG1pbmluZ19zdW1tYXJ5LmdldCgic3VjY2VzcyIpOgogICAgICAgICAgICAgICAgICAgICAgICBtaW5pbmdfaW5mbyA9IG1pbmluZ19zdW1tYXJ5CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkzhuqV5IG1pbmluZyBpbmZvOiB7bWluaW5nX2luZm8uZ2V0KCdydW5uaW5nX21pbmVycycsIDApfS97bWluaW5nX2luZm8uZ2V0KCd0b3RhbF9taW5lcnMnLCAwKX0gbWluZXJzIikKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBs4bqleSBtaW5pbmcgaW5mbzoge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGPDoWMgdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICAgICBwZW5kaW5nX2FjY291bnRzID0gc2VsZi5kYi5nZXRfcGVuZGluZ19zeW5jX2l0ZW1zKCJhY2NvdW50cyIsIGxpbWl0PTUwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBjw6FjIGpvYiBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgcGVuZGluZ19qb2JzID0gc2VsZi5kYi5nZXRfcGVuZGluZ19zeW5jX2l0ZW1zKCJqb2JzX2hpc3RvcnkiLCBsaW1pdD01MCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhu41jIDIwMCBkw7JuZyBsb2cgZ+G6p24gbmjhuqV0CiAgICAgICAgICAgIHJlY2VudF9sb2dzID0gc2VsZi5fcmVhZF9yZWNlbnRfbG9ncygyMDApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBwYXlsb2FkCiAgICAgICAgICAgIHBheWxvYWQgPSB7CiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgImRldmljZV9pbmZvIjogZGV2aWNlX2luZm8sCiAgICAgICAgICAgICAgICAiZGV2aWNlX2NvbmZpZyI6IGRldmljZV9jb25maWcsCiAgICAgICAgICAgICAgICAibWV0YV9kYXRhIjogewogICAgICAgICAgICAgICAgICAgICJkZXZpY2VfbG9ncyI6IHJlY2VudF9sb2dzCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBnb2xpa2VfcmVwb3J0IG7hur91IGPDswogICAgICAgICAgICBpZiBnb2xpa2VfcmVwb3J0OgogICAgICAgICAgICAgICAgcGF5bG9hZFsiZ29saWtlX3JlcG9ydCJdID0gZ29saWtlX3JlcG9ydAogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBtaW5pbmdfaW5mbyBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgbWluaW5nX2luZm86CiAgICAgICAgICAgICAgICBwYXlsb2FkWyJtaW5pbmdfaW5mbyJdID0gbWluaW5nX2luZm8KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIHTDoGkga2hv4bqjbiBjaMawYSDEkeG7k25nIGLhu5kgbuG6v3UgY8OzCiAgICAgICAgICAgIGlmIHBlbmRpbmdfYWNjb3VudHM6CiAgICAgICAgICAgICAgICBwYXlsb2FkWyJhY2NvdW50cyJdID0gcGVuZGluZ19hY2NvdW50cwogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYixJDhu5NuZyBi4buZIHtsZW4ocGVuZGluZ19hY2NvdW50cyl9IHTDoGkga2hv4bqjbiBjaMawYSDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gam9iIGNoxrBhIMSR4buTbmcgYuG7mSBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgcGVuZGluZ19qb2JzOgogICAgICAgICAgICAgICAgcGF5bG9hZFsiam9icyJdID0gcGVuZGluZ19qb2JzCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkOG7k25nIGLhu5kge2xlbihwZW5kaW5nX2pvYnMpfSBqb2IgY2jGsGEgxJHhu5NuZyBi4buZIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu61pIGThu68gbGnhu4d1CiAgICAgICAgICAgIHNlbGYuX3NhZmVfcHVibGlzaChjb25maWcuTVFUVF9UT1BJQ19DTElFTlRfU1lOQywganNvbi5kdW1wcyhwYXlsb2FkKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSB24bubaSBzZXJ2ZXIiKQogICAgCiAgICBkZWYgc3RhcnRfc3luY190aHJlYWQoc2VsZik6CiAgICAgICAgIiIiQuG6r3QgxJHhuqd1IHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIiIiCiAgICAgICAgaWYgc2VsZi5zeW5jX3RocmVhZCBpcyBub3QgTm9uZSBhbmQgc2VsZi5zeW5jX3RocmVhZC5pc19hbGl2ZSgpOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiVGhyZWFkIMSR4buTbmcgYuG7mSDEkcOjIMSRYW5nIGNo4bqheSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBzZWxmLnJ1bm5pbmcgPSBUcnVlCiAgICAgICAgc2VsZi5zdG9wX2V2ZW50LmNsZWFyKCkKICAgICAgICBzZWxmLnN5bmNfdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5fc3luY19sb29wLCBkYWVtb249VHJ1ZSkKICAgICAgICBzZWxmLnN5bmNfdGhyZWFkLnN0YXJ0KCkKICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBraOG7n2kgxJHhu5luZyB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIpCiAgICAKICAgIGRlZiBfc3luY19sb29wKHNlbGYpOgogICAgICAgICIiIkxvb3AgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIiIgogICAgICAgIGxvZ2dlci5pbmZvKGYiQuG6r3QgxJHhuqd1IMSR4buTbmcgYuG7mSB04buxIMSR4buZbmcgbeG7l2kge3NlbGYuc3luY19pbnRlcnZhbH0gZ2nDonkiKQoKICAgICAgICB3aGlsZSBub3Qgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpIGFuZCBzZWxmLnJ1bm5pbmc6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc3luY19kYXRhKCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgdHJvbmcgcXXDoSB0csOsbmggxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZzoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmdo4buJIMSR4bq/biBs4bqnbiDEkeG7k25nIGLhu5kgdGnhur9wIHRoZW8KICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2Uoc2VsZi5zeW5jX2ludGVydmFsKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuc3RvcF9ldmVudC5pc19zZXQoKSBvciBub3Qgc2VsZi5ydW5uaW5nOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAKICAgIGRlZiBzdG9wX3N5bmNfdGhyZWFkKHNlbGYpOgogICAgICAgICIiIkThu6tuZyB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIiIgogICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgc2VsZi5zdG9wX2V2ZW50LnNldCgpCiAgICAgICAgaWYgc2VsZi5zeW5jX3RocmVhZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5zeW5jX3RocmVhZC5qb2luKHRpbWVvdXQ9Mi4wKQogICAgICAgICAgICBzZWxmLnN5bmNfdGhyZWFkID0gTm9uZQogICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGThu6tuZyB0aHJlYWQgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyIpCiAgICAKICAgIGRlZiBkaXNjb25uZWN0KHNlbGYpOgogICAgICAgICIiIk5n4bqvdCBr4bq/dCBu4buRaSBNUVRUIiIiCiAgICAgICAgc2VsZi5tYW51YWxfZGlzY29ubmVjdCA9IFRydWUgICMgxJDDoW5oIGThuqV1IMSRw6J5IGzDoCBkaXNjb25uZWN0IGPDsyBjaOG7pyDDvQogICAgICAgIHNlbGYuc3RvcF9zeW5jX3RocmVhZCgpCiAgICAgICAgCiAgICAgICAgIyBE4burbmcgc3RyZWFtIG7hur91IMSRYW5nIGNo4bqheQogICAgICAgIHNlbGYuc3RvcF9zdHJlYW0oKQogICAgICAgIAogICAgICAgIGlmIHNlbGYuY2xpZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLmNsaWVudC5sb29wX3N0b3AoKQogICAgICAgICAgICBzZWxmLmNsaWVudC5kaXNjb25uZWN0KCkKICAgICAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBuZ+G6r3Qga+G6v3QgbuG7kWkgTVFUVCIpCiAgICAgICAgCiAgICAgICAgIyBE4burbmcgdOG6pXQgY+G6oyBhdXRvLXJlY29ubmVjdAogICAgICAgIHNlbGYuc3RvcF9ldmVudC5zZXQoKQogICAgCiAgICBkZWYgc2V0dXBfbXF0dF9oYW5kbGVycyhzZWxmKToKICAgICAgICAiIiJUaGnhur90IGzhuq1wIGPDoWMgaGFuZGxlciBjaG8gTVFUVCB0YXNrcyIiIgogICAgICAgICMgxJDEg25nIGvDvSBjw6FjIHRhc2sgaGFuZGxlciBt4bq3YyDEkeG7i25oCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoInVwZGF0ZV9jb25maWciLCBzZWxmLl9oYW5kbGVfdXBkYXRlX2RldmljZV9jb25maWcpCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoInVwZGF0ZV9zeW5jZWQiLCBzZWxmLl9oYW5kbGVfdXBkYXRlX3N5bmNlZCkKICAgICAgICBzZWxmLnJlZ2lzdGVyX3Rhc2tfaGFuZGxlcigiYWNjb3VudF91cGRhdGUiLCBzZWxmLl9oYW5kbGVfYWNjb3VudF91cGRhdGUpCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoInVwZGF0ZV9wcm94eSIsIHNlbGYuX2hhbmRsZV91cGRhdGVfcHJveHkpCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoInVwZGF0ZV9taW5pbmdfY29uZmlnIiwgc2VsZi5faGFuZGxlX21pbmluZ19jb25maWdfdXBkYXRlKQogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJzdHJlYW1fbG9nIiwgc2VsZi5faGFuZGxlX3N0cmVhbV9sb2cpCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoInJ1bl9jbWQiLCBzZWxmLl9oYW5kbGVfcnVuX2NtZCkKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbygixJDDoyB0aGnhur90IGzhuq1wIGPDoWMgTVFUVCB0YXNrIGhhbmRsZXIiKQogICAgCiAgICBkZWYgX2hhbmRsZV9taW5pbmdfY29uZmlnX3VwZGF0ZShzZWxmLCB0YXNrX2RhdGEpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgdXBkYXRlIG1pbmluZyBjb25maWcgdOG7qyBzZXJ2ZXIKICAgICAgICAKICAgICAgICBUYXNrIGZvcm1hdCB04burIHNlcnZlciBNUVRUOgogICAgICAgIHsKICAgICAgICAgICAgInRhc2tfaWQiOiAidGFza18xMjM0NTY3ODkwXzEyMyIsCiAgICAgICAgICAgICJkZXZpY2VfaWQiOiAiZGV2aWNlLTAwMSIsCiAgICAgICAgICAgICJ0YXNrX3R5cGUiOiAidXBkYXRlX21pbmluZ19jb25maWciLAogICAgICAgICAgICAiZGF0YSI6IHsKICAgICAgICAgICAgICAgICJtaW5pbmdfY29uZmlnIjogWwogICAgICAgICAgICAgICAgICAgIHsgImNvaW5fbmFtZSI6ICJWUlNDIiwgIm1pbmluZ190b29sIjogImNjbWluZXIiLCAiY29uZmlnIjogey4uLn0gfSwKICAgICAgICAgICAgICAgICAgICB7ICJjb2luX25hbWUiOiAiREVSTyIsICJtaW5pbmdfdG9vbCI6ICJhc3Ryb21pbmVyIiwgImNvbmZpZyI6IHsuLi59IH0KICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm1lc3NhZ2UiOiAiQ+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIG1pbmluZyIsCiAgICAgICAgICAgICJ0aW1lc3RhbXAiOiAiMjAyNS0xMC0yOFQuLi4iCiAgICAgICAgfQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICBtaW5pbmdfY29uZmlnX2FycmF5ID0gZGF0YS5nZXQoIm1pbmluZ19jb25maWciLCBbXSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIHnDqnUgY+G6p3UgY+G6rXAgbmjhuq10IG1pbmluZyBjb25maWcgdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk1pbmluZyBjb25maWcgdOG7qyBNUVRUIGPDsyB7bGVuKG1pbmluZ19jb25maWdfYXJyYXkpfSBtaW5lcnM6IikKICAgICAgICAgICAgZm9yIG1pbmVyIGluIG1pbmluZ19jb25maWdfYXJyYXk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIiAgLSB7bWluZXIuZ2V0KCdjb2luX25hbWUnLCAnVW5rbm93bicpfSAoe21pbmVyLmdldCgnbWluaW5nX3Rvb2wnLCAnVW5rbm93bicpfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG1pbmluZ19zZXJ2aWNlIGPDsyB04buTbiB04bqhaSBraMO0bmcKICAgICAgICAgICAgaWYgbm90IHNlbGYubWluaW5nX3NlcnZpY2U6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSAiTWluaW5nIHNlcnZpY2UgY2jGsGEgxJHGsOG7o2Mga2jhu59pIHThuqFvIgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBtaW5pbmdfY29uZmlnX2FycmF5OgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gIk1pbmluZyBjb25maWcgYXJyYXkgcuG7l25nIgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBjb25maWcgb2JqZWN0IMSR4buDIGfhu61pIHNhbmcgbWluaW5nIEFQSQogICAgICAgICAgICAjIGF1dG9fc3RhcnQgbeG6t2MgxJHhu4tuaCB0cnVlCiAgICAgICAgICAgICMgbGFzdF9zeW5jX2NvbmZpZyBsw6AgdGltZXN0YW1wIGhp4buHbiB04bqhaQogICAgICAgICAgICBjb25maWdfdG9fdXBkYXRlID0gewogICAgICAgICAgICAgICAgImxhc3Rfc3luY19jb25maWciOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAgICAgImF1dG9fc3RhcnQiOiBUcnVlLAogICAgICAgICAgICAgICAgIm1pbmVycyI6IG1pbmluZ19jb25maWdfYXJyYXkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyB1cGRhdGUge2xlbihtaW5pbmdfY29uZmlnX2FycmF5KX0gbWluZXJzIHbhu5tpIGF1dG9fc3RhcnQ9VHJ1ZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIHRy4buxYyB0aeG6v3AgdXBkYXRlX2NvbmZpZyAoZm9yY2U9VHJ1ZSBt4bq3YyDEkeG7i25oKSDEkeG7gyDEkcOoIGNvbmZpZwogICAgICAgICAgICByZXN1bHQgPSBzZWxmLm1pbmluZ19zZXJ2aWNlLnVwZGF0ZV9jb25maWcoY29uZmlnX3RvX3VwZGF0ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN1Y2Nlc3MiKToKICAgICAgICAgICAgICAgICMgTOG6pXkgc3VtbWFyeSDEkeG7gyBiw6FvIGPDoW8KICAgICAgICAgICAgICAgIHN1bW1hcnkgPSBzZWxmLm1pbmluZ19zZXJ2aWNlLmdldF9taW5pbmdfc3VtbWFyeSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAoCiAgICAgICAgICAgICAgICAgICAgZiLEkMOjIGPhuq1wIG5o4bqtdCBtaW5pbmcgY29uZmlnOiAiCiAgICAgICAgICAgICAgICAgICAgZiJ7c3VtbWFyeS5nZXQoJ3J1bm5pbmdfbWluZXJzJywgMCl9L3tzdW1tYXJ5LmdldCgndG90YWxfbWluZXJzJywgMCl9IG1pbmVycyBydW5uaW5nIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBtZXNzYWdlKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdGjhu4MgdXBkYXRlIG1pbmluZyBjb25maWc6IHtyZXN1bHQuZ2V0KCdlcnJvcicsICdVbmtub3duIGVycm9yJyl9IgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSB44butIGzDvSBtaW5pbmcgY29uZmlnIHVwZGF0ZSIpCiAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCgKICAgICAgICAgICAgICAgIHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKSwKICAgICAgICAgICAgICAgIHRhc2tfZGF0YS5nZXQoImRldmljZV9pZCIpLAogICAgICAgICAgICAgICAgImZhaWxlZCIsCiAgICAgICAgICAgICAgICBmIkzhu5dpOiB7c3RyKGUpfSIKICAgICAgICAgICAgKQogICAgICAgIAogICAgZGVmIF9oYW5kbGVfdXBkYXRlX2RldmljZV9jb25maWcoc2VsZiwgdGFza19kYXRhKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX2RhdGE6IEThu68gbGnhu4d1IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIHnDqnUgY+G6p3UgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyB04burIHNlcnZlciAodGFza19pZDoge3Rhc2tfaWR9KSIpCiAgICAgICAgICAgIGNvbmZpZ19kYXRhID0gdGFza19kYXRhLmdldCgiY29uZmlnX2RhdGEiLCB7fSkKICAgICAgICAgICAgaWYgbm90IGNvbmZpZ19kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkThu68gbGnhu4d1IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyBy4buXbmciKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsICJE4buvIGxp4buHdSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgcuG7l25nIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IHThu6tuZyBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAgICAgc3VjY2VzcyA9IHNlbGYuZGIuc2F2ZV9kZXZpY2VfY29uZmlnKGNvbmZpZ19kYXRhKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLOiB7JywgJy5qb2luKGNvbmZpZ19kYXRhLmtleXMoKSl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdOG6pXQgY+G6oyB0w6BpIGtob+G6o24gbMOgIGNoxrBhIHN5bmMgxJHhu4MgxJHhuqNtIGLhuqNvIHRow7RuZyB0aW4gbeG7m2kgbmjhuqV0IMSRxrDhu6NjIGfhu61pIGzDqm4gc2VydmVyCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF9hY2NvdW50cyA9IHNlbGYuZGIubWFya19hbGxfYWNjb3VudHNfbm90X3N5bmNlZCgpCiAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9hY2NvdW50cyA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDEkcOhbmggZOG6pXUge3VwZGF0ZWRfYWNjb3VudHN9IHTDoGkga2hv4bqjbiBsw6AgY2jGsGEgc3luYyBzYXUga2hpIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4siKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiS2jDtG5nIGPDsyB0w6BpIGtob+G6o24gbsOgbyBj4bqnbiDEkcOhbmggZOG6pXUgY2jGsGEgc3luYyIpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgxJHDoW5oIGThuqV1IHTDoGkga2hv4bqjbiBjaMawYSBzeW5jOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIGZhaWwgdGFzayB2w6wgdmnhu4djIGPhuq1wIG5o4bqtdCBjb25maWcgxJHDoyB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgc3luY19pbnRlcnZhbCBu4bq/dSBuw7MgdGhheSDEkeG7lWkKICAgICAgICAgICAgICAgIGlmICJzeW5jX2ludGVydmFsIiBpbiBjb25maWdfZGF0YToKICAgICAgICAgICAgICAgICAgICBuZXdfc3luY19pbnRlcnZhbCA9IGNvbmZpZ19kYXRhWyJzeW5jX2ludGVydmFsIl0KICAgICAgICAgICAgICAgICAgICBpZiBuZXdfc3luY19pbnRlcnZhbCAhPSBzZWxmLnN5bmNfaW50ZXJ2YWw6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiQ+G6rXAgbmjhuq10IHN5bmNfaW50ZXJ2YWwgdOG7qyB7c2VsZi5zeW5jX2ludGVydmFsfSB0aMOgbmgge25ld19zeW5jX2ludGVydmFsfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3luY19pbnRlcnZhbCA9IG5ld19zeW5jX2ludGVydmFsCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEto4bufaSDEkeG7mW5nIGzhuqFpIHRocmVhZCDEkeG7k25nIGLhu5kgbuG6v3UgxJFhbmcgY2jhuqF5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuc3luY190aHJlYWQgaXMgbm90IE5vbmUgYW5kIHNlbGYuc3luY190aHJlYWQuaXNfYWxpdmUoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJLaOG7n2kgxJHhu5luZyBs4bqhaSB0aHJlYWQgxJHhu5NuZyBi4buZIHbhu5tpIGtob+G6o25nIHRo4budaSBnaWFuIG3hu5tpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3RvcF9zeW5jX3RocmVhZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0X3N5bmNfdGhyZWFkKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaMO0bmcgYsOhbyBjaG8gSm9iU2VydmljZSB24buBIHThuqV0IGPhuqMgY29uZmlnIHVwZGF0ZQogICAgICAgICAgICAgICAgaWYgc2VsZi5qb2Jfc2VydmljZSBhbmQgaGFzYXR0cihzZWxmLmpvYl9zZXJ2aWNlLCAnaGFuZGxlX21xdHRfY29uZmlnX3VwZGF0ZScpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJUaMO0bmcgYsOhbyBKb2JTZXJ2aWNlIHbhu4EgY29uZmlnIHVwZGF0ZSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5qb2Jfc2VydmljZS5oYW5kbGVfbXF0dF9jb25maWdfdXBkYXRlKGNvbmZpZ19kYXRhKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIExvZyB0aMOqbSB0aMO0bmcgdGluIHbhu4Egam9iLXJlbGF0ZWQgY29uZmlncwogICAgICAgICAgICAgICAgam9iX3JlbGF0ZWRfa2V5cyA9IFsibWF4X2pvYnNfcGVyX2RheSIsICJtYXhfam9ic19wZXJfc2Vzc2lvbiIsICJqb2JfaW50ZXJ2YWxfc2Vjb25kcyIsICJjYXJlX2luX3dvcmtpbmdfam9iIl0KICAgICAgICAgICAgICAgIGlmIGFueShrZXkgaW4gY29uZmlnX2RhdGEgZm9yIGtleSBpbiBqb2JfcmVsYXRlZF9rZXlzKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiQ+G6pXUgaMOsbmggbGnDqm4gcXVhbiDEkeG6v24gSm9iU2VydmljZSDEkcOjIMSRxrDhu6NjIGPhuq1wIG5o4bqtdCIpCiAgICAgICAgICAgICAgICAgICAgIyBKb2JTZXJ2aWNlIHPhur0geOG7rSBsw70gbG9naWMgcmVzdGFydCBzZXNzaW9uIG7hur91IGPhuqduIHRoaeG6v3QKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBH4butaSBiw6FvIGPDoW8gdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAic3VjY2VzcyIsIGYixJDDoyBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLOiB7JywgJy5qb2luKGNvbmZpZ19kYXRhLmtleXMoKSl9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gIktow7RuZyB0aOG7gyBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLIgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSB44butIGzDvSBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLOiB7c3RyKGUpfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQoKICAgIGRlZiBfaGFuZGxlX3VwZGF0ZV9zeW5jZWQoc2VsZiwgdGFza19kYXRhKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIMSR4buTbmcgYuG7mQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfZGF0YTogROG7ryBsaeG7h3UgdGFzayB04burIHNlcnZlcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJOaOG6rW4gecOqdSBj4bqndSBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kgdOG7qyBzZXJ2ZXIiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAKICAgICAgICAgICAgYWNjb3VudF9jb3VudCA9IDAKICAgICAgICAgICAgam9iX2NvdW50ID0gMAogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIMSRw6MgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIGlmICJhY2NvdW50cyIgaW4gZGF0YSBhbmQgaXNpbnN0YW5jZShkYXRhWyJhY2NvdW50cyJdLCBsaXN0KToKICAgICAgICAgICAgICAgIGZvciBhY2NvdW50X3V1aWQgaW4gZGF0YVsiYWNjb3VudHMiXToKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLm1hcmtfYXNfc3luY2VkKCJhY2NvdW50cyIsIGFjY291bnRfdXVpZCkKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIMSRw6MgxJHhu5NuZyBi4buZOiB7YWNjb3VudF91dWlkfSIpCiAgICAgICAgICAgICAgICBhY2NvdW50X2NvdW50ID0gbGVuKGRhdGFbImFjY291bnRzIl0pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQw6FuaCBk4bqldSBqb2IgxJHDoyDEkeG7k25nIGLhu5kKICAgICAgICAgICAgaWYgImpvYnMiIGluIGRhdGEgYW5kIGlzaW5zdGFuY2UoZGF0YVsiam9icyJdLCBsaXN0KToKICAgICAgICAgICAgICAgIGZvciBqb2JfdXVpZCBpbiBkYXRhWyJqb2JzIl06CiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5tYXJrX2FzX3N5bmNlZCgiam9ic19oaXN0b3J5Iiwgam9iX3V1aWQpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYixJDDoW5oIGThuqV1IGpvYiDEkcOjIMSR4buTbmcgYuG7mToge2pvYl91dWlkfSIpCiAgICAgICAgICAgICAgICBqb2JfY291bnQgPSBsZW4oZGF0YVsiam9icyJdKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBIaeG7g24gdGjhu4sgdGjDtG5nIGLDoW8gdOG7lW5nIGjhu6NwIGhv4bq3YyB0aMO0bmcgYsOhbyB04burIHNlcnZlcgogICAgICAgICAgICBpZiAibWVzc2FnZSIgaW4gdGFza19kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUaMO0bmcgYsOhbyB04burIHNlcnZlcjoge3Rhc2tfZGF0YVsnbWVzc2FnZSddfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEhp4buDbiB0aOG7iyB0aMO0bmcgYsOhbyB04buVbmcgaOG7o3AgbuG6v3Uga2jDtG5nIGPDsyBtZXNzYWdlIHThu6sgc2VydmVyCiAgICAgICAgICAgICAgICBpZiBhY2NvdW50X2NvdW50ID4gMCBvciBqb2JfY291bnQgPiAwOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyDEkeG7k25nIGLhu5kgdGjDoG5oIGPDtG5nOiB7YWNjb3VudF9jb3VudH0gdMOgaSBraG/huqNuLCB7am9iX2NvdW50fSBqb2IiKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB44butIGzDvSBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5k6IHtzdHIoZSl9IikKICAgICAgICAgICAgCiAgICAKICAgIGRlZiBfaGFuZGxlX2FjY291bnRfdXBkYXRlKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayBj4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX2RhdGE6IEThu68gbGnhu4d1IHRhc2sgdOG7qyBzZXJ2ZXIgY8OzIGPhuqV1IHRyw7pjOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAidGFza19pZCI6ICJ0YXNrXzE3NDkzOTk1MzYyNzJfNjQxIiwKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiAiYTEyNWY2MjRmNDFhNGY3YyIsCiAgICAgICAgICAgICAgICAidGFza190eXBlIjogImFjY291bnRfdXBkYXRlIiwKICAgICAgICAgICAgICAgICJkYXRhIjogewogICAgICAgICAgICAgICAgICAgICJhcHAiOiAiaW5zdGFncmFtIiwKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogImluYWN0aXZlIiwKCiAgICAgICAgICAgICAgICAgICAgImpvYl90b2RheSI6IDMwLAogICAgICAgICAgICAgICAgICAgICJqb2JfZW5hYmxlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAiYWNjb3VudF91dWlkIjogIjdlZDk1NTdkLTc2YTQtNDdmNy04ODUwLTdjZWVmMGM2OTBhZiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibWVzc2FnZSI6ICIiLAogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJwZW5kaW5nIgogICAgICAgICAgICB9CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXNrX2lkID0gdGFza19kYXRhLmdldCgidGFza19pZCIpCiAgICAgICAgICAgIGRldmljZV9pZCA9IHRhc2tfZGF0YS5nZXQoImRldmljZV9pZCIpCiAgICAgICAgICAgIGRhdGEgPSB0YXNrX2RhdGEuZ2V0KCJkYXRhIiwge30pCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5o4bqtbiB5w6p1IGPhuqd1IGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24gdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGRhdGEgb3IgImFjY291bnRfdXVpZCIgbm90IGluIGRhdGE6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiROG7ryBsaeG7h3UgdMOgaSBraG/huqNuIGtow7RuZyBo4bujcCBs4buHIikKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCAiROG7ryBsaeG7h3UgdMOgaSBraG/huqNuIGtow7RuZyBo4bujcCBs4buHIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdMOgaSBraG/huqNuIHThu6sgREIKICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZGIuZ2V0X2FjY291bnRfYnlfdXVpZChkYXRhWyJhY2NvdW50X3V1aWQiXSkKICAgICAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gduG7m2kgVVVJRDoge2RhdGFbJ2FjY291bnRfdXVpZCddfSIKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICB1cGRhdGVfZGF0YSA9IHt9CiAgICAgICAgICAgIHZhbGlkX2ZpZWxkcyA9IFsic3RhdHVzIiwgImpvYl9lbmFibGUiLCAiam9iX2Rpc2FibGVfdW50aWwiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlzYWJsZV9mb2xsb3ciLCAiZm9sbG93X2Rpc2FibGVfdW50aWwiLCAiZm9sbG93X3RvZGF5IiwgImZvbGxvd19pbl9zZXNzaW9uIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIm1heF9mb2xsb3dfZGF5IiwgIm1heF9mb2xsb3dfc2Vzc2lvbiIsICJpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIl0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSBzdGF0dXMgPSAiZGVsZXRlIiB0aMOsIHjDs2EgdMOgaSBraG/huqNuCiAgICAgICAgICAgIGlmIGRhdGEuZ2V0KCJzdGF0dXMiKSA9PSAiZGVsZXRlIjoKICAgICAgICAgICAgICAgIGFjY291bnRfdXVpZCA9IGRhdGFbImFjY291bnRfdXVpZCJdCiAgICAgICAgICAgICAgICBhY2NvdW50X3VzZXJuYW1lID0gYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIsICJVbmtub3duIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gecOqdSBj4bqndSB4w7NhIHTDoGkga2hv4bqjbiB7YWNjb3VudF91c2VybmFtZX0gKFVVSUQ6IHthY2NvdW50X3V1aWR9KSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgMS4gWMOzYSB04bqldCBj4bqjIGpvYiBoaXN0b3J5IGPhu6dhIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgam9iX2hpc3RvcnlfZGVsZXRlZCA9IHNlbGYuZGIuZGVsZXRlX2pvYl9oaXN0b3J5X2J5X2FjY291bnQoYWNjb3VudF91dWlkKQogICAgICAgICAgICAgICAgaWYgam9iX2hpc3RvcnlfZGVsZXRlZDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgeMOzYSBqb2IgaGlzdG9yeSBj4bunYSB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdGjhu4MgeMOzYSBqb2IgaGlzdG9yeSBj4bunYSB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyAyLiBYw7NhIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgYWNjb3VudF9kZWxldGVkID0gc2VsZi5kYi5kZWxldGVfYWNjb3VudChhY2NvdW50WyJpZCJdKQogICAgICAgICAgICAgICAgaWYgYWNjb3VudF9kZWxldGVkOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyB4w7NhIHTDoGkga2hv4bqjbiB7YWNjb3VudF91c2VybmFtZX0gKElEOiB7YWNjb3VudFsnaWQnXX0pIGto4buPaSBkYXRhYmFzZSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBmIsSQw6MgeMOzYSB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdGjhu4MgeMOzYSB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZGF0YS5pdGVtcygpOgogICAgICAgICAgICAgICAgaWYga2V5IGluIHZhbGlkX2ZpZWxkczoKICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YVtrZXldID0gdmFsdWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHVwZGF0ZV9kYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgdGjDtG5nIHRpbiBj4bqnbiBj4bqtcCBuaOG6rXQiKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsICJLaMO0bmcgY8OzIHRow7RuZyB0aW4gY+G6p24gY+G6rXAgbmjhuq10IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgbOG6oWkgdsOgbyBEQgogICAgICAgICAgICB1cGRhdGVfZGF0YVsiaXNfc3luYyJdID0gRmFsc2UKICAgICAgICAgICAgc3VjY2VzcyA9IHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAnJyl9IChVVUlEOiB7ZGF0YVsnYWNjb3VudF91dWlkJ119KSB24bubaSBk4buvIGxp4buHdToge3VwZGF0ZV9kYXRhfSIpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAic3VjY2VzcyIsIGYixJDDoyBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJycpfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIktow7RuZyB0aOG7gyBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJycpfSIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIHjhu60gbMO9IGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o246IHtzdHIoZSl9IgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQoKICAgIGRlZiBfaGFuZGxlX3VwZGF0ZV9wcm94eShzZWxmLCB0YXNrX2RhdGEpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza19kYXRhOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyIGPDsyBj4bqldSB0csO6YzoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInRhc2tfaWQiOiAidGFza18xNzQ5Mzk5NTM2MjcyXzY0MSIsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogImExMjVmNjI0ZjQxYTRmN2MiLAogICAgICAgICAgICAgICAgInRhc2tfdHlwZSI6ICJ1cGRhdGVfcHJveHkiLAogICAgICAgICAgICAgICAgImRhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgInByb3h5X2NvbmZpZyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImlkIjogInByb3h5XzQ1NiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJob3N0IjogInByb3h5LmV4YW1wbGUuY29tIiwKICAgICAgICAgICAgICAgICAgICAgICAgInBvcnQiOiA4MDgwLAogICAgICAgICAgICAgICAgICAgICAgICAidXNlcm5hbWUiOiAidXNlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICJwYXNzd29yZCI6ICJwYXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiaHR0cCIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiAiIiwKICAgICAgICAgICAgICAgICJzdGF0dXMiOiAicGVuZGluZyIKICAgICAgICAgICAgfQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gecOqdSBj4bqndSBj4bqtcCBuaOG6rXQgcHJveHkgdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJveHlfY29uZmlnID0gZGF0YQogICAgICAgICAgICBpZiBub3QgcHJveHlfY29uZmlnOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gIlRoaeG6v3UgdGjDtG5nIHRpbiBwcm94eV9jb25maWcgdHJvbmcgZOG7ryBsaeG7h3UgdGFzayIKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSBj4bqldSBow6xuaCBwcm94eSB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJwcm94eV9jb25maWciLCBwcm94eV9jb25maWcpCiAgICAgICAgICAgICAgICAjIFJlc2V0IHRy4bqhbmcgdGjDoWkgecOqdSBj4bqndSBwcm94eSB2w6wgxJHDoyBuaOG6rW4gxJHGsOG7o2MgcHJveHkKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJwcm94eV9yZXF1ZXN0ZWQiLCAwKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCBwcm94eToge3Byb3h5X2NvbmZpZ1snbmFtZSddfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgR+G7rWkgYsOhbyBjw6FvIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgc3VjY2Vzc19tc2cgPSBmIsSQw6MgY+G6rXAgbmjhuq10IHByb3h5OiB7cHJveHlfY29uZmlnWyduYW1lJ119IgogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBzdWNjZXNzX21zZykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIGtoaSBsxrB1IGPhuqV1IGjDrG5oIHByb3h5OiB7c3RyKGUpfSIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIHjhu60gbMO9IGPhuq1wIG5o4bqtdCBwcm94eToge3N0cihlKX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKCiAgICBkZWYgX2hhbmRsZV9zdHJlYW1fbG9nKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayBzdHJlYW0gbG9nIHJlYWx0aW1lCiAgICAgICAgCiAgICAgICAgVGFzayBmb3JtYXQ6CiAgICAgICAgewogICAgICAgICAgICAidGFza19pZCI6ICJ0YXNrXzEyMzQ1Njc4OTBfMTIzIiwKICAgICAgICAgICAgImRldmljZV9pZCI6ICJkZXZpY2UtMDAxIiwKICAgICAgICAgICAgInRhc2tfdHlwZSI6ICJzdHJlYW1fbG9nIiwKICAgICAgICAgICAgIm1lc3NhZ2UiOiAiQuG6r3QgxJHhuqd1IHN0cmVhbSBsb2ciLAogICAgICAgICAgICAidGltZXN0YW1wIjogIjIwMjUtMTAtMzFULi4uIgogICAgICAgIH0KICAgICAgICAKICAgICAgICBMb2dpYzoKICAgICAgICAtIENhcHR1cmUgdOG6pXQgY+G6oyBsb2cgbWVzc2FnZXMgcmVhbHRpbWUKICAgICAgICAtIFB1Ymxpc2ggbMOqbiB0b3BpYzogZG5kdmluYS9jbGllbnQvbG9nL3tkZXZpY2VfaWR9CiAgICAgICAgLSBUaW1lb3V0IDYwcywgcmVzZXQgbuG6v3Ugbmjhuq1uIHRhc2sgbeG7m2kKICAgICAgICAtIFThu7EgxJHhu5luZyBk4burbmcgc2F1IDYwcyBraMO0bmcgaG/huqF0IMSR4buZbmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIHnDqnUgY+G6p3Ugc3RyZWFtIGxvZyB04burIHNlcnZlciAodGFza19pZDoge3Rhc2tfaWR9KSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IHRpbWVvdXQgbuG6v3UgxJFhbmcgc3RyZWFtCiAgICAgICAgICAgIGlmIHNlbGYuc3RyZWFtX2FjdGl2ZToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJMb2cgc3RyZWFtIMSRYW5nIGNo4bqheSwgcmVzZXQgdGltZW91dCB24buBIDYwcyIpCiAgICAgICAgICAgICAgICBzZWxmLnN0cmVhbV9sYXN0X2FjdGl2aXR5ID0gdGltZS50aW1lKCkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJzdWNjZXNzIiwgIsSQw6MgcmVzZXQgbG9nIHN0cmVhbSB0aW1lb3V0IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBC4bqvdCDEkeG6p3UgbG9nIHN0cmVhbSBt4bubaQogICAgICAgICAgICBsb2dnZXIuaW5mbygiQuG6r3QgxJHhuqd1IGxvZyBzdHJlYW0gbeG7m2kiKQogICAgICAgICAgICBzZWxmLnN0cmVhbV9hY3RpdmUgPSBUcnVlCiAgICAgICAgICAgIHNlbGYuc3RyZWFtX2xhc3RfYWN0aXZpdHkgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICBzZWxmLnN0cmVhbV9zdG9wX2V2ZW50LmNsZWFyKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU3RhcnQgbG9nIHN0cmVhbWluZwogICAgICAgICAgICB1dGlscy5zdGFydF9sb2dfc3RyZWFtKHNlbGYpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFN0YXJ0IHN0cmVhbSB0aHJlYWQKICAgICAgICAgICAgc2VsZi5zdHJlYW1fdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCgKICAgICAgICAgICAgICAgIHRhcmdldD1zZWxmLl9zdHJlYW1fbG9nX2xvb3AsCiAgICAgICAgICAgICAgICBhcmdzPShkZXZpY2VfaWQsKSwKICAgICAgICAgICAgICAgIGRhZW1vbj1UcnVlCiAgICAgICAgICAgICkKICAgICAgICAgICAgc2VsZi5zdHJlYW1fdGhyZWFkLnN0YXJ0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJzdWNjZXNzIiwgIsSQw6MgYuG6r3QgxJHhuqd1IHN0cmVhbSBsb2ciKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kgeOG7rSBsw70gc3RyZWFtIGxvZzoge3N0cihlKX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCgKICAgICAgICAgICAgICAgIHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKSwKICAgICAgICAgICAgICAgIHRhc2tfZGF0YS5nZXQoImRldmljZV9pZCIpLAogICAgICAgICAgICAgICAgImZhaWxlZCIsCiAgICAgICAgICAgICAgICBlcnJvcl9tc2cKICAgICAgICAgICAgKQogICAgCiAgICBkZWYgX3N0cmVhbV9sb2dfbG9vcChzZWxmLCBkZXZpY2VfaWQ6IHN0cik6CiAgICAgICAgIiIiCiAgICAgICAgTG9vcCBzdHJlYW0gbG9nIHJlYWx0aW1lCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZGV2aWNlX2lkOiBEZXZpY2UgSUQgxJHhu4MgcHVibGlzaCBsw6puIHRvcGljCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzdHJlYW1fdG9waWMgPSBmImRuZHZpbmEvY2xpZW50L2xvZy97ZGV2aWNlX2lkfSIKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJMb2cgc3RyZWFtIGxvb3Agc3RhcnRlZCwgcHVibGlzaGluZyB0bzoge3N0cmVhbV90b3BpY30iKQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc2VjdXRpdmVfZXJyb3JzID0gMAogICAgICAgICAgICBtYXhfY29uc2VjdXRpdmVfZXJyb3JzID0gNQogICAgICAgICAgICAKICAgICAgICAgICAgd2hpbGUgc2VsZi5zdHJlYW1fYWN0aXZlIGFuZCBub3Qgc2VsZi5zdHJlYW1fc3RvcF9ldmVudC5pc19zZXQoKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdGltZW91dCAoNjBzKQogICAgICAgICAgICAgICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHNlbGYuc3RyZWFtX2xhc3RfYWN0aXZpdHkKICAgICAgICAgICAgICAgICAgICBpZiBlbGFwc2VkID49IHNlbGYuc3RyZWFtX3RpbWVvdXQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTG9nIHN0cmVhbSB0aW1lb3V0IHNhdSB7c2VsZi5zdHJlYW1fdGltZW91dH1zLCDEkWFuZyBk4burbmcuLi4iKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIHF1w6Egbmhp4buBdSBs4buXaSBsacOqbiB0aeG6v3AsIGThu6tuZyBzdHJlYW0KICAgICAgICAgICAgICAgICAgICBpZiBjb25zZWN1dGl2ZV9lcnJvcnMgPj0gbWF4X2NvbnNlY3V0aXZlX2Vycm9yczoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiUXXDoSBuaGnhu4F1IGzhu5dpIGxpw6puIHRp4bq/cCAoe2NvbnNlY3V0aXZlX2Vycm9yc30pLCBk4burbmcgbG9nIHN0cmVhbSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBsb2cgZW50cmllcyB04burIHF1ZXVlCiAgICAgICAgICAgICAgICAgICAgcGVuZGluZ19sb2dzID0gdXRpbHMuZ2V0X3BlbmRpbmdfbG9ncygpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcGVuZGluZ19sb2dzOgogICAgICAgICAgICAgICAgICAgICAgICAjIFJlc2V0IGVycm9yIGNvdW50ZXIga2hpIGPDsyBsb2cKICAgICAgICAgICAgICAgICAgICAgICAgY29uc2VjdXRpdmVfZXJyb3JzID0gMAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBU4bqhbyBwYXlsb2FkIMSR4buDIHB1Ymxpc2gKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtX3BheWxvYWQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibG9ncyI6IHBlbmRpbmdfbG9ncywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0aW1lb3V0X3JlbWFpbmluZyI6IGludChzZWxmLnN0cmVhbV90aW1lb3V0IC0gZWxhcHNlZCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBQdWJsaXNoIGzDqm4gTVFUVAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zYWZlX3B1Ymxpc2goc3RyZWFtX3RvcGljLCBqc29uLmR1bXBzKHN0cmVhbV9wYXlsb2FkKSwgcW9zPTApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBTbGVlcCAwLjVzIHRyxrDhu5tjIGtoaSBjaGVjayB0aeG6v3AKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBjb25zZWN1dGl2ZV9lcnJvcnMgKz0gMQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIHRyb25nIGxvZyBzdHJlYW0gbG9vcCAoe2NvbnNlY3V0aXZlX2Vycm9yc30ve21heF9jb25zZWN1dGl2ZV9lcnJvcnN9KToge2V9IikKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2xlYW51cAogICAgICAgICAgICBzZWxmLnN0cmVhbV9hY3RpdmUgPSBGYWxzZQogICAgICAgICAgICBsb2dnZXIuaW5mbygiTG9nIHN0cmVhbSDEkcOjIGThu6tuZyIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgbG9nIHN0cmVhbSBsb29wOiB7ZX0iKQogICAgICAgICAgICBzZWxmLnN0cmVhbV9hY3RpdmUgPSBGYWxzZQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICMgQWx3YXlzIHN0b3AgbG9nIHN0cmVhbWluZyBraGkgbG9vcCBr4bq/dCB0aMO6YwogICAgICAgICAgICB1dGlscy5zdG9wX2xvZ19zdHJlYW0oKQoKICAgIGRlZiBfaGFuZGxlX3J1bl9jbWQoc2VsZiwgdGFza19kYXRhKToKICAgICAgICAiIiIKICAgICAgICBY4butIGzDvSB0YXNrIHJ1biBjb21tYW5kIHThu6sgc2VydmVyCiAgICAgICAgCiAgICAgICAgVGFzayBmb3JtYXQgdOG7qyBzZXJ2ZXIgTVFUVDoKICAgICAgICB7CiAgICAgICAgICAgICJ0YXNrX2lkIjogInRhc2tfMTIzNDU2Nzg5MF8xMjMiLAogICAgICAgICAgICAiZGV2aWNlX2lkIjogImRldmljZS0wMDEiLCAKICAgICAgICAgICAgInRhc2tfdHlwZSI6ICJydW5fY21kIiwKICAgICAgICAgICAgImRhdGEiOiB7CiAgICAgICAgICAgICAgICAiY29tbWFuZCI6ICJscyAtbGEiLAogICAgICAgICAgICAgICAgInRpbWVvdXQiOiAzMCwKICAgICAgICAgICAgICAgICJzaGVsbCI6IHRydWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgZGF0YSA9IHRhc2tfZGF0YS5nZXQoImRhdGEiLCB7fSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbW1hbmQgPSBkYXRhLmdldCgiY29tbWFuZCIpCiAgICAgICAgICAgIHRpbWVvdXQgPSBkYXRhLmdldCgidGltZW91dCIsIDMwKSAgIyBEZWZhdWx0IDMwcyB0aW1lb3V0CiAgICAgICAgICAgIHVzZV9zaGVsbCA9IGRhdGEuZ2V0KCJzaGVsbCIsIFRydWUpICAjIERlZmF1bHQgdXNlIHNoZWxsCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgY29tbWFuZDoKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9ICJLaMO0bmcgY8OzIGNvbW1hbmQgxJHhu4MgdGjhu7FjIHRoaSIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5o4bqtbiB5w6p1IGPhuqd1IGNo4bqheSBjb21tYW5kOiB7Y29tbWFuZH0gKHRpbWVvdXQ6IHt0aW1lb3V0fXMpIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu7FjIHRoaSBjb21tYW5kCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuX2V4ZWN1dGVfY29tbWFuZChjb21tYW5kLCB0aW1lb3V0LCB1c2Vfc2hlbGwpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu61pIGLDoW8gY8OhbyBr4bq/dCBxdeG6owogICAgICAgICAgICBpZiByZXN1bHRbInN1Y2Nlc3MiXToKICAgICAgICAgICAgICAgICMgVOG6oW8gcmVzcG9uc2UgduG7m2kgc3Rkb3V0L3N0ZGVycgogICAgICAgICAgICAgICAgcmVzcG9uc2VfZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAiY29tbWFuZCI6IGNvbW1hbmQsCiAgICAgICAgICAgICAgICAgICAgImV4aXRfY29kZSI6IHJlc3VsdFsiZXhpdF9jb2RlIl0sCiAgICAgICAgICAgICAgICAgICAgInN0ZG91dCI6IHJlc3VsdFsic3Rkb3V0Il0sCiAgICAgICAgICAgICAgICAgICAgInN0ZGVyciI6IHJlc3VsdFsic3RkZXJyIl0sCiAgICAgICAgICAgICAgICAgICAgImV4ZWN1dGlvbl90aW1lIjogcmVzdWx0WyJleGVjdXRpb25fdGltZSJdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCgKICAgICAgICAgICAgICAgICAgICB0YXNrX2lkLCAKICAgICAgICAgICAgICAgICAgICBkZXZpY2VfaWQsIAogICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIiwgCiAgICAgICAgICAgICAgICAgICAgZiJDb21tYW5kIGV4ZWN1dGVkIHN1Y2Nlc3NmdWxseSAoZXhpdCBjb2RlOiB7cmVzdWx0WydleGl0X2NvZGUnXX0pIiwKICAgICAgICAgICAgICAgICAgICByZXNwb25zZV9kYXRhCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTG9nIGvhur90IHF14bqjIGNoaSB0aeG6v3QKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiQ29tbWFuZCBleGVjdXRlZCBzdWNjZXNzZnVsbHk6IHtjb21tYW5kfSAoZXhpdF9jb2RlOiB7cmVzdWx0WydleGl0X2NvZGUnXX0sIHRpbWU6IHtyZXN1bHRbJ2V4ZWN1dGlvbl90aW1lJ119cykiKQogICAgICAgICAgICAgICAgaWYgcmVzdWx0WyJzdGRvdXQiXS5zdHJpcCgpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiU1RET1VUOlxue3Jlc3VsdFsnc3Rkb3V0J10uc3RyaXAoKX0iKQogICAgICAgICAgICAgICAgaWYgcmVzdWx0WyJzdGRlcnIiXS5zdHJpcCgpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiU1RERVJSOlxue3Jlc3VsdFsnc3RkZXJyJ10uc3RyaXAoKX0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBM4buXaSB0aOG7sWMgdGhpCiAgICAgICAgICAgICAgICBlcnJvcl9kYXRhID0gewogICAgICAgICAgICAgICAgICAgICJjb21tYW5kIjogY29tbWFuZCwKICAgICAgICAgICAgICAgICAgICAiZXJyb3IiOiByZXN1bHRbImVycm9yIl0sCiAgICAgICAgICAgICAgICAgICAgInN0ZG91dCI6IHJlc3VsdC5nZXQoInN0ZG91dCIsICIiKSwKICAgICAgICAgICAgICAgICAgICAic3RkZXJyIjogcmVzdWx0LmdldCgic3RkZXJyIiwgIiIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCgKICAgICAgICAgICAgICAgICAgICB0YXNrX2lkLAogICAgICAgICAgICAgICAgICAgIGRldmljZV9pZCwgCiAgICAgICAgICAgICAgICAgICAgImZhaWxlZCIsCiAgICAgICAgICAgICAgICAgICAgZiJDb21tYW5kIGV4ZWN1dGlvbiBmYWlsZWQ6IHtyZXN1bHRbJ2Vycm9yJ119IiwKICAgICAgICAgICAgICAgICAgICBlcnJvcl9kYXRhCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTG9nIGzhu5dpIGNoaSB0aeG6v3QKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkNvbW1hbmQgZXhlY3V0aW9uIGZhaWxlZDoge2NvbW1hbmR9IC0ge3Jlc3VsdFsnZXJyb3InXX0iKQogICAgICAgICAgICAgICAgaWYgcmVzdWx0LmdldCgic3Rkb3V0IiwgIiIpLnN0cmlwKCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJTVERPVVQ6XG57cmVzdWx0WydzdGRvdXQnXS5zdHJpcCgpfSIpCiAgICAgICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdGRlcnIiLCAiIikuc3RyaXAoKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJTVERFUlI6XG57cmVzdWx0WydzdGRlcnInXS5zdHJpcCgpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kgeOG7rSBsw70gcnVuX2NtZCB0YXNrOiB7c3RyKGUpfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KAogICAgICAgICAgICAgICAgdGFza19kYXRhLmdldCgidGFza19pZCIpLAogICAgICAgICAgICAgICAgdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIiksCiAgICAgICAgICAgICAgICAiZmFpbGVkIiwgCiAgICAgICAgICAgICAgICBlcnJvcl9tc2cKICAgICAgICAgICAgKQoKICAgIGRlZiBfZXhlY3V0ZV9jb21tYW5kKHNlbGYsIGNvbW1hbmQ6IHN0ciwgdGltZW91dDogaW50ID0gMzAsIHVzZV9zaGVsbDogYm9vbCA9IFRydWUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyB0aGkgY29tbWFuZCB2w6AgdHLhuqMgduG7gSBr4bq/dCBxdeG6owogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGNvbW1hbmQ6IENvbW1hbmQgc3RyaW5nIMSR4buDIHRo4buxYyB0aGkKICAgICAgICAgICAgdGltZW91dDogVGltZW91dCB0cm9uZyBnacOieSAKICAgICAgICAgICAgdXNlX3NoZWxsOiBUcnVlIMSR4buDIGNo4bqheSB0cm9uZyBzaGVsbCwgRmFsc2UgxJHhu4MgY2jhuqF5IHRy4buxYyB0aeG6v3AKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdCB24bubaSB0aMO0bmcgdGluIGvhur90IHF14bqjOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IGJvb2wsCiAgICAgICAgICAgICAgICAiZXhpdF9jb2RlIjogaW50LAogICAgICAgICAgICAgICAgInN0ZG91dCI6IHN0ciwKICAgICAgICAgICAgICAgICJzdGRlcnIiOiBzdHIsIAogICAgICAgICAgICAgICAgImV4ZWN1dGlvbl90aW1lIjogZmxvYXQsCiAgICAgICAgICAgICAgICAiZXJyb3IiOiBzdHIgICMgbuG6v3UgY8OzIGzhu5dpCiAgICAgICAgICAgIH0KICAgICAgICAiIiIKICAgICAgICBpbXBvcnQgdGltZQogICAgICAgIAogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaHXhuqluIGLhu4sgY29tbWFuZAogICAgICAgICAgICBpZiB1c2Vfc2hlbGw6CiAgICAgICAgICAgICAgICBpZiBvcy5uYW1lID09ICdudCc6ICAjIFdpbmRvd3MKICAgICAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIGNtZC5leGUgY2hvIFdpbmRvd3MKICAgICAgICAgICAgICAgICAgICBjbWRfYXJncyA9IFsnY21kJywgJy9jJywgY29tbWFuZF0KICAgICAgICAgICAgICAgIGVsc2U6ICAjIExpbnV4L1VuaXgKICAgICAgICAgICAgICAgICAgICBjbWRfYXJncyA9IFsnL2Jpbi9iYXNoJywgJy1jJywgY29tbWFuZF0KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgU3BsaXQgY29tbWFuZCB0aMOgbmggbGlzdCBhcmd1bWVudHMKICAgICAgICAgICAgICAgIGNtZF9hcmdzID0gY29tbWFuZC5zcGxpdCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJFeGVjdXRpbmcgY29tbWFuZDoge2NtZF9hcmdzfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4buxYyB0aGkgY29tbWFuZAogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgIGNtZF9hcmdzLAogICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB0ZXh0PVRydWUsCiAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQsCiAgICAgICAgICAgICAgICBzaGVsbD1GYWxzZSAgIyDEkMOjIGhhbmRsZSBzaGVsbCDhu58gdHLDqm4KICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgZXhlY3V0aW9uX3RpbWUgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3VjY2VzcyI6IFRydWUsCiAgICAgICAgICAgICAgICAiZXhpdF9jb2RlIjogcmVzdWx0LnJldHVybmNvZGUsCiAgICAgICAgICAgICAgICAic3Rkb3V0IjogcmVzdWx0LnN0ZG91dCwKICAgICAgICAgICAgICAgICJzdGRlcnIiOiByZXN1bHQuc3RkZXJyLAogICAgICAgICAgICAgICAgImV4ZWN1dGlvbl90aW1lIjogcm91bmQoZXhlY3V0aW9uX3RpbWUsIDMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuVGltZW91dEV4cGlyZWQgYXMgZToKICAgICAgICAgICAgZXhlY3V0aW9uX3RpbWUgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZXhpdF9jb2RlIjogLTEsCiAgICAgICAgICAgICAgICAic3Rkb3V0IjogZS5zdGRvdXQuZGVjb2RlKCd1dGYtOCcpIGlmIGUuc3Rkb3V0IGVsc2UgIiIsCiAgICAgICAgICAgICAgICAic3RkZXJyIjogZS5zdGRlcnIuZGVjb2RlKCd1dGYtOCcpIGlmIGUuc3RkZXJyIGVsc2UgIiIsCiAgICAgICAgICAgICAgICAiZXhlY3V0aW9uX3RpbWUiOiByb3VuZChleGVjdXRpb25fdGltZSwgMyksCiAgICAgICAgICAgICAgICAiZXJyb3IiOiBmIkNvbW1hbmQgdGltZW91dCBhZnRlciB7dGltZW91dH1zIgogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLkNhbGxlZFByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICBleGVjdXRpb25fdGltZSA9IHRpbWUudGltZSgpIC0gc3RhcnRfdGltZQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJleGl0X2NvZGUiOiBlLnJldHVybmNvZGUsCiAgICAgICAgICAgICAgICAic3Rkb3V0IjogZS5zdGRvdXQgaWYgZS5zdGRvdXQgZWxzZSAiIiwKICAgICAgICAgICAgICAgICJzdGRlcnIiOiBlLnN0ZGVyciBpZiBlLnN0ZGVyciBlbHNlICIiLAogICAgICAgICAgICAgICAgImV4ZWN1dGlvbl90aW1lIjogcm91bmQoZXhlY3V0aW9uX3RpbWUsIDMpLAogICAgICAgICAgICAgICAgImVycm9yIjogZiJDb21tYW5kIGZhaWxlZCB3aXRoIGV4aXQgY29kZSB7ZS5yZXR1cm5jb2RlfSIKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3IgYXMgZToKICAgICAgICAgICAgZXhlY3V0aW9uX3RpbWUgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZXhpdF9jb2RlIjogLTEsCiAgICAgICAgICAgICAgICAic3Rkb3V0IjogIiIsCiAgICAgICAgICAgICAgICAic3RkZXJyIjogIiIsCiAgICAgICAgICAgICAgICAiZXhlY3V0aW9uX3RpbWUiOiByb3VuZChleGVjdXRpb25fdGltZSwgMyksCiAgICAgICAgICAgICAgICAiZXJyb3IiOiBmIkNvbW1hbmQgbm90IGZvdW5kOiB7ZX0iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBleGVjdXRpb25fdGltZSA9IHRpbWUudGltZSgpIC0gc3RhcnRfdGltZQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJleGl0X2NvZGUiOiAtMSwKICAgICAgICAgICAgICAgICJzdGRvdXQiOiAiIiwKICAgICAgICAgICAgICAgICJzdGRlcnIiOiAiIiwKICAgICAgICAgICAgICAgICJleGVjdXRpb25fdGltZSI6IHJvdW5kKGV4ZWN1dGlvbl90aW1lLCAzKSwKICAgICAgICAgICAgICAgICJlcnJvciI6IGYiVW5leHBlY3RlZCBlcnJvcjoge3N0cihlKX0iCiAgICAgICAgICAgIH0KCiAgICBkZWYgc3RvcF9zdHJlYW0oc2VsZik6CiAgICAgICAgIiIiROG7q25nIGxvZyBzdHJlYW0iIiIKICAgICAgICBpZiBzZWxmLnN0cmVhbV9hY3RpdmU6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkGFuZyBk4burbmcgbG9nIHN0cmVhbS4uLiIpCiAgICAgICAgICAgIHNlbGYuc3RyZWFtX2FjdGl2ZSA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYuc3RyZWFtX3N0b3BfZXZlbnQuc2V0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU3RvcCBsb2cgc3RyZWFtaW5nCiAgICAgICAgICAgIHV0aWxzLnN0b3BfbG9nX3N0cmVhbSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzZWxmLnN0cmVhbV90aHJlYWQ6CiAgICAgICAgICAgICAgICBzZWxmLnN0cmVhbV90aHJlYWQuam9pbih0aW1lb3V0PTIuMCkKICAgICAgICAgICAgICAgIHNlbGYuc3RyZWFtX3RocmVhZCA9IE5vbmUKCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBraOG7n2kgxJHhu5luZyB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUaGnhur90IGzhuq1wIGPDoWMgaGFuZGxlciB0csaw4bubYyBraGkga+G6v3QgbuG7kWkKICAgICAgICAgICAgc2VsZi5zZXR1cF9tcXR0X2hhbmRsZXJzKCkKICAgICAgICAgICAgc2VsZi5jb25uZWN0KCkKICAgICAgICAgICAgIyBLaOG7n2kgxJHhu5luZyBzeW5jIHRocmVhZCBzYXUga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZwogICAgICAgICAgICBzZWxmLnN0YXJ0X3N5bmNfdGhyZWFkKCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlIHbDoCDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraOG7n2kgxJHhu5luZyBNUVRUIHNlcnZpY2UiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX29uX21lc3NhZ2Uoc2VsZiwgY2xpZW50LCB1c2VyZGF0YSwgbXNnLCBwcm9wZXJ0aWVzPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIENhbGxiYWNrIGtoaSBuaOG6rW4gxJHGsOG7o2MgbWVzc2FnZSB04burIE1RVFQgYnJva2VyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY2xpZW50OiBNUVRUIGNsaWVudCBpbnN0YW5jZQogICAgICAgICAgICB1c2VyZGF0YTogVXNlciBkYXRhIMSRxrDhu6NjIHRydXnhu4FuIHbDoG8gY2xpZW50CiAgICAgICAgICAgIG1zZzogTWVzc2FnZSBvYmplY3QgY2jhu6lhIHRvcGljIHbDoCBwYXlsb2FkCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFByb3BlcnRpZXMgY+G7p2EgbWVzc2FnZSAoTVFUVCB2NSkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIk5o4bqtbiBtZXNzYWdlIHThu6sgdG9waWM6IHttc2cudG9waWN9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUGFyc2UgcGF5bG9hZCBKU09OCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBheWxvYWQgPSBqc29uLmxvYWRzKG1zZy5wYXlsb2FkLmRlY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIHBhcnNlIEpTT04gdOG7qyBwYXlsb2FkOiB7bXNnLnBheWxvYWR9IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBY4butIGzDvSBtZXNzYWdlIGThu7FhIHRyw6puIHRvcGljCiAgICAgICAgICAgIGlmIG1zZy50b3BpYyA9PSBzZWxmLnRvcGljX3NlcnZlcl90YXNrOgogICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX3NlcnZlcl90YXNrKHBheWxvYWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIk5o4bqtbiBtZXNzYWdlIHThu6sgdG9waWMga2jDtG5nIHjDoWMgxJHhu4tuaDoge21zZy50b3BpY30iKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB44butIGzDvSBtZXNzYWdlOiB7c3RyKGUpfSIpCgogICAgZGVmIF9oYW5kbGVfc2VydmVyX3Rhc2soc2VsZiwgcGF5bG9hZDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwYXlsb2FkOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXNrX3R5cGUgPSBwYXlsb2FkLmdldCgidGFza190eXBlIikKICAgICAgICAgICAgaWYgbm90IHRhc2tfdHlwZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJOaOG6rW4gdGFzayBraMO0bmcgY8OzIHRhc2tfdHlwZSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIk5o4bqtbiB0YXNrIHThu6sgc2VydmVyOiB7dGFza190eXBlfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIGhhbmRsZXIgdMawxqFuZyDhu6luZyBu4bq/dSDEkcOjIMSRxINuZyBrw70KICAgICAgICAgICAgaWYgdGFza190eXBlIGluIHNlbGYudGFza19oYW5kbGVyczoKICAgICAgICAgICAgICAgIHNlbGYudGFza19oYW5kbGVyc1t0YXNrX3R5cGVdKHBheWxvYWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSBoYW5kbGVyIGNobyB0YXNrX3R5cGU6IHt0YXNrX3R5cGV9IikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB44butIGzDvSB0YXNrIHThu6sgc2VydmVyOiB7c3RyKGUpfSIpCiAgICAKICAgIGRlZiBfbW9uaXRvcl9yYW1fdXNhZ2Uoc2VsZiwgZGV2aWNlX2luZm86IERpY3Rbc3RyLCBBbnldKToKICAgICAgICAiIiIKICAgICAgICBUaGVvIGTDtWkgUkFNIHbDoCB04buxIMSR4buZbmcgcmVib290IG7hur91IFJBTSBjYW8gbGnDqm4gdOG7pWMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBkZXZpY2VfaW5mbzogVGjDtG5nIHRpbiB0aGnhur90IGLhu4sgY2jhu6lhIFJBTSB1c2FnZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUw61uaCBwaOG6p24gdHLEg20gUkFNIHPhu60gZOG7pW5nIHThu6sgcmFtX3RvdGFsIHbDoCByYW1fdXNlZAogICAgICAgICAgICByYW1fdG90YWwgPSBkZXZpY2VfaW5mby5nZXQoInJhbV90b3RhbCIsIDApCiAgICAgICAgICAgIHJhbV91c2VkID0gZGV2aWNlX2luZm8uZ2V0KCJyYW1fdXNlZCIsIDApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByYW1fdG90YWwgPiAwIGFuZCByYW1fdXNlZCA+PSAwOgogICAgICAgICAgICAgICAgcmFtX3VzYWdlX3BlcmNlbnQgPSAocmFtX3VzZWQgLyByYW1fdG90YWwpICogMTAwCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJUw61uaCB0b8OhbiBSQU06IHtyYW1fdXNlZH1NQi97cmFtX3RvdGFsfU1CID0ge3JhbV91c2FnZV9wZXJjZW50Oi4xZn0lIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRmFsbGJhY2s6IHRo4butIGzhuqV5IHRy4buxYyB0aeG6v3AgdOG7qyBkZXZpY2VfaW5mbwogICAgICAgICAgICAgICAgcmFtX3VzYWdlX3BlcmNlbnQgPSBkZXZpY2VfaW5mby5nZXQoInJhbV9wZXJjZW50YWdlIiwgMCkKICAgICAgICAgICAgICAgIGlmIHJhbV91c2FnZV9wZXJjZW50ID09IDA6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJLaMO0bmcgY8OzIHRow7RuZyB0aW4gUkFNIGjhu6NwIGzhu4csIHPhu60gZOG7pW5nIGdpw6EgdHLhu4sgbeG6t2MgxJHhu4tuaCAwIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlPhu60gZOG7pW5nIHJhbV9wZXJjZW50YWdlIHRy4buxYyB0aeG6v3A6IHtyYW1fdXNhZ2VfcGVyY2VudDouMWZ9JSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSB2w6BvIGzhu4tjaCBz4butIChjaOG7iSBnaeG7ryBs4bqhaSAzIGzhuqduIGfhuqduIG5o4bqldCkKICAgICAgICAgICAgc2VsZi5yYW1fdXNhZ2VfaGlzdG9yeS5hcHBlbmQocmFtX3VzYWdlX3BlcmNlbnQpCiAgICAgICAgICAgIGlmIGxlbihzZWxmLnJhbV91c2FnZV9oaXN0b3J5KSA+IHNlbGYuY29uc2VjdXRpdmVfaGlnaF9yYW1fbGltaXQ6CiAgICAgICAgICAgICAgICBzZWxmLnJhbV91c2FnZV9oaXN0b3J5LnBvcCgwKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiUkFNIGhp4buHbiB04bqhaToge3JhbV91c2FnZV9wZXJjZW50Oi4xZn0lIChs4buLY2ggc+G7rToge1tmJ3t4Oi4xZn0lJyBmb3IgeCBpbiBzZWxmLnJhbV91c2FnZV9oaXN0b3J5XX0pIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSBjw7MgxJHhu6cgMyBs4bqnbiDEkW8gdsOgIHThuqV0IGPhuqMgxJHhu4F1ID4gbmfGsOG7oW5nCiAgICAgICAgICAgIGlmIGxlbihzZWxmLnJhbV91c2FnZV9oaXN0b3J5KSA+PSBzZWxmLmNvbnNlY3V0aXZlX2hpZ2hfcmFtX2xpbWl0OgogICAgICAgICAgICAgICAgaWYgYWxsKHVzYWdlID4gc2VsZi5oaWdoX3JhbV90aHJlc2hvbGQgZm9yIHVzYWdlIGluIHNlbGYucmFtX3VzYWdlX2hpc3RvcnkpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiUkFNIGNhbyBsacOqbiB04bulYyB7c2VsZi5jb25zZWN1dGl2ZV9oaWdoX3JhbV9saW1pdH0gbOG6p24gKD57c2VsZi5oaWdoX3JhbV90aHJlc2hvbGR9JSk6IHtbZid7eDouMWZ9JScgZm9yIHggaW4gc2VsZi5yYW1fdXNhZ2VfaGlzdG9yeV19IikKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQuG6r3QgxJHhuqd1IHJlYm9vdCB0aGnhur90IGLhu4sgxJHhu4MgZ2nhuqNpIHBow7NuZyBSQU0uLi4iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiByZWJvb3QKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLl9yZWJvb3RfZGV2aWNlKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGfhu61pIGzhu4duaCByZWJvb3QgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgICAgICAgICAgIyBSZXNldCBs4buLY2ggc+G7rSBzYXUga2hpIHJlYm9vdAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJhbV91c2FnZV9oaXN0b3J5LmNsZWFyKCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB0aOG7sWMgaGnhu4duIHJlYm9vdCB0aGnhur90IGLhu4siKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB0aGVvIGTDtWkgUkFNOiB7ZX0iKQogICAgCiAgICBkZWYgX3JlYm9vdF9kZXZpY2Uoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIHJlYm9vdCB0aGnhur90IGLhu4sgcXVhIEFEQgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgU+G7rSBk4bulbmcgREVWSUNFX0lQIHThu6sgY29uZmlnIHRoYXkgdsOsIEFEQl9IT1NUCiAgICAgICAgICAgIGRldmljZV9hZGRyZXNzID0gZiJ7Y29uZmlnLkRFVklDRV9JUH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhu4duaCByZWJvb3QgcXVhIEFEQgogICAgICAgICAgICBjbWQgPSBbImFkYiIsICItcyIsIGRldmljZV9hZGRyZXNzLCAicmVib290Il0KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVGjhu7FjIGhp4buHbiByZWJvb3QgdGhp4bq/dCBi4buLOiB7JyAnLmpvaW4oY21kKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB0ZXh0PVRydWUsCiAgICAgICAgICAgICAgICB0aW1lb3V0PTEwICAjIFRpbWVvdXQgMTAgZ2nDonkKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJM4buHbmggcmVib290IMSRw6MgxJHGsOG7o2MgZ+G7rWkgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuVGltZW91dEV4cGlyZWQ6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJUaW1lb3V0IGtoaSBn4butaSBs4buHbmggcmVib290ICh0aGnhur90IGLhu4sgY8OzIHRo4buDIMSRYW5nIHJlYm9vdCkiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZSAgIyBDb2kgbmjGsCB0aMOgbmggY8O0bmcgdsOsIGPDsyB0aOG7gyB0aGnhur90IGLhu4sgxJFhbmcgcmVib290CiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIHJlYm9vdDoge2Uuc3RkZXJyfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgbOG7h25oIGFkYiwga2jDtG5nIHRo4buDIHJlYm9vdCB0aGnhur90IGLhu4siKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtow7RuZyB4w6FjIMSR4buLbmgga2hpIHJlYm9vdCB0aGnhur90IGLhu4s6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ==').decode('utf-8'))
