import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgTGlzdCwgT3B0aW9uYWwsIENhbGxhYmxlCmZyb20gYWJjIGltcG9ydCBBQkMsIGFic3RyYWN0bWV0aG9kCmltcG9ydCB1dGlscwpmcm9tIHV0aWxzIGltcG9ydCBMb2dMZXZlbCwgTG9nZ2VyCmltcG9ydCB1cmxsaWIucGFyc2UKaW1wb3J0IHJhbmRvbQppbXBvcnQgY29uZmlnCiMgVOG6oW8gbG9nZ2VyIGNobyBCYXNlSm9iCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIkJhc2VKb2IiKQoKY2xhc3MgQmFzZUpvYihBQkMpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZT1Ob25lKToKICAgICAgICBzZWxmLmRiID0gZGJfc2VydmljZQogICAgICAgIHNlbGYuaGVscGVyID0gaGVscGVyX3NlcnZpY2UKICAgICAgICBzZWxmLmdvbGlrZV9zZXJ2aWNlID0gZ29saWtlX3NlcnZpY2UKICAgICAgICBzZWxmLmFwcF9wYWNrYWdlID0gIiIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gIiIKICAgICAgICAjIEjDoG0gc2xlZXAgbeG6t2MgxJHhu4tuaCBsw6AgdGltZS5zbGVlcAogICAgICAgIHNlbGYuX3NsZWVwX2Z1bmMgPSB0aW1lLnNsZWVwCiAgICAgICAgIyBU4bqhbyBsb2dnZXIgY2hvIGluc3RhbmNlIGPhu6UgdGjhu4MKICAgICAgICBzZWxmLmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoZiJKb2Iue3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpCiAgICAgICAgCiAgICAgICAgIyBQcm94eSBzZXJ2aWNlIHPhur0gxJHGsOG7o2Mgc2V0IHNhdSBraGkga2jhu59pIHThuqFvCiAgICAgICAgc2VsZi5wcm94eV9zZXJ2aWNlID0gTm9uZQogICAgICAgIAogICAgZGVmIHNldF9wcm94eV9zZXJ2aWNlKHNlbGYsIHByb3h5X3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgc2VydmljZSBjaG8gam9iIGhhbmRsZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9zZXJ2aWNlOiBQcm94eVNlcnZpY2UgaW5zdGFuY2UKICAgICAgICAiIiIKICAgICAgICBzZWxmLnByb3h5X3NlcnZpY2UgPSBwcm94eV9zZXJ2aWNlCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgdGhp4bq/dCBs4bqtcCBwcm94eSBzZXJ2aWNlIGNobyB7c2VsZi5fX2NsYXNzX18uX19uYW1lX199IikKICAgICAgICAKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIGdldF9hY2NvdW50c19mcm9tX2RldmljZShzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiJM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiB04burIHRoaeG6v3QgYuG7iyIiIgogICAgICAgIHBhc3MKCiAgICAgICAgCiAgICBkZWYgc3luY19hY2NvdW50c190b19kYihzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICDEkOG7k25nIGLhu5kgdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLIHbDoG8gZGF0YWJhc2UgdsOgIG1hcCB24bubaSB0w6BpIGtob+G6o24gR29MaWtlCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGRldmljZV9hY2NvdW50cyA9IHNlbGYuZ2V0X2FjY291bnRzX2Zyb21fZGV2aWNlKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZGV2aWNlX2lkIHThu6sgZGF0YWJhc2UKICAgICAgICAgICAgYW5kcm9pZF9pZCA9IHNlbGYuZGIuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBoaeG7h24gY8OzIHRyb25nIERCIGNobyBhcHAgbsOgeQogICAgICAgICAgICBleGlzdGluZ19hY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1zZWxmLmFwcF9uYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBzZXQgY8OhYyB1bmlxdWVfdXNlcm5hbWUgdOG7qyB0aGnhur90IGLhu4sgxJHhu4MgZOG7hSBzbyBzw6FuaAogICAgICAgICAgICBkZXZpY2VfdXNlcm5hbWVzID0gc2V0KCkKICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gZGV2aWNlX2FjY291bnRzOgogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBhY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIikKICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgIGRldmljZV91c2VybmFtZXMuYWRkKHVzZXJuYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHTDoGkga2hv4bqjbiB0cm9uZyBEQiBtw6Aga2jDtG5nIGPDsm4gdHLDqm4gdGhp4bq/dCBi4buLIC0+IMSRw6FuaCBk4bqldSBsb2dvdXQKICAgICAgICAgICAgZm9yIGV4aXN0aW5nX2FjY291bnQgaW4gZXhpc3RpbmdfYWNjb3VudHM6CiAgICAgICAgICAgICAgICBleGlzdGluZ191c2VybmFtZSA9IGV4aXN0aW5nX2FjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKQogICAgICAgICAgICAgICAgaWYgZXhpc3RpbmdfdXNlcm5hbWUgYW5kIGV4aXN0aW5nX3VzZXJuYW1lIG5vdCBpbiBkZXZpY2VfdXNlcm5hbWVzOgogICAgICAgICAgICAgICAgICAgICMgVMOgaSBraG/huqNuIGPDsyB0cm9uZyBEQiBuaMawbmcga2jDtG5nIGPDsyB0csOqbiB0aGnhur90IGLhu4sgLT4gbG9nb3V0CiAgICAgICAgICAgICAgICAgICAgaWYgZXhpc3RpbmdfYWNjb3VudC5nZXQoInN0YXR1cyIpICE9ICJsb2dvdXQiOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHtleGlzdGluZ191c2VybmFtZX0ga2jDtG5nIGPDsm4gdHLDqm4gdGhp4bq/dCBi4buLLCDEkcOhbmggZOG6pXUgbG9nb3V0IikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChleGlzdGluZ19hY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogImxvZ291dCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogIlTDoGkga2hv4bqjbiBraMO0bmcgY8OybiB0csOqbiB0aGnhur90IGLhu4siLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgaG/hurdjIHRow6ptIG3hu5tpIHbDoG8gREIKICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gZGV2aWNlX2FjY291bnRzOgogICAgICAgICAgICAgICAgIyBUaMOqbSB0aMO0bmcgdGluIGFwcCB2w6AgZGV2aWNlX2lkCiAgICAgICAgICAgICAgICBhY2NvdW50WyJhcHAiXSA9IHNlbGYuYXBwX25hbWUKICAgICAgICAgICAgICAgIGFjY291bnRbImRldmljZV9pZCJdID0gYW5kcm9pZF9pZAogICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgbMOgIGNoxrBhIMSR4buTbmcgYuG7mSDEkeG7gyBn4butaSBsw6puIHNlcnZlcgogICAgICAgICAgICAgICAgYWNjb3VudFsiaXNfc3luYyJdID0gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHTDoGkga2hv4bqjbiDEkcOjIHThu5NuIHThuqFpIGNoxrBhIGThu7FhIHbDoG8gdW5pcXVlX3VzZXJuYW1lICsgYXBwCiAgICAgICAgICAgICAgICBleGlzdGluZ19hY2NvdW50ID0gc2VsZi5kYi5nZXRfYWNjb3VudF9ieV91bmlxdWVfdXNlcm5hbWUoc2VsZi5hcHBfbmFtZSwgYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBleGlzdGluZ19hY2NvdW50OgogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiBoaeG7h24gY8OzCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9pZCA9IGV4aXN0aW5nX2FjY291bnRbImlkIl0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbuG6v3UgdMOgaSBraG/huqNuIHRyb25nIERCIMSRYW5nIOG7nyB0cuG6oW5nIHRow6FpIGxvZ291dCBuaMawbmcgeHXhuqV0IGhp4buHbiBs4bqhaSB0csOqbiB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgICAgICBpZiBleGlzdGluZ19hY2NvdW50LmdldCgic3RhdHVzIikgPT0gImxvZ291dCI6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQ2jhu4kgY+G6rXAgbmjhuq10IG5o4buvbmcgdHLGsOG7nW5nIGPhuqduIHRoaeG6v3QsIGtow7RuZyBnaGkgxJHDqCB0b8OgbiBi4buZIHJlY29yZAogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiYWN0aXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9yZWFzb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc19sb2dpbiI6IGFjY291bnQuZ2V0KCJpc19sb2dpbiIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGFjY291bnQuZ2V0KCJsYXN0X3VwZGF0ZSIsIGludCh0aW1lLnRpbWUoKSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQoYWNjb3VudF9pZCwgdXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gxJHDoyB4deG6pXQgaGnhu4duIGzhuqFpIHRyw6puIHRoaeG6v3QgYuG7iywgcmVzZXQgdOG7qyBsb2dvdXQgduG7gSBhY3RpdmUiKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQ2jhu4kgY+G6rXAgbmjhuq10IHRow7RuZyB0aW4gY8ahIGLhuqNuLCBnaeG7ryBuZ3V5w6puIGPDoWMgY291bnRlciB2w6AgdGjhu5FuZyBrw6oKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXNfbG9naW4iOiBhY2NvdW50LmdldCgiaXNfbG9naW4iLCBGYWxzZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibGFzdF91cGRhdGUiOiBhY2NvdW50LmdldCgibGFzdF91cGRhdGUiLCBpbnQodGltZS50aW1lKCkpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAjIENo4buJIGPhuq1wIG5o4bqtdCBzdGF0dXMgbuG6v3UgdMOgaSBraG/huqNuIGhp4buHbiB04bqhaSBraMO0bmcgcGjhuqNpIGFjdGl2ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBleGlzdGluZ19hY2NvdW50LmdldCgic3RhdHVzIikgIT0gImFjdGl2ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YVsic3RhdHVzIl0gPSBleGlzdGluZ19hY2NvdW50LmdldCgic3RhdHVzIiwgImFjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRfaWQsIHVwZGF0ZV9kYXRhKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gY2hvIHtzZWxmLmFwcF9uYW1lfSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgVGjDqm0gdMOgaSBraG/huqNuIG3hu5tpIHbhu5tpIHRy4bqhbmcgdGjDoWkgYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudFsic3RhdHVzIl0gPSAiYWN0aXZlIgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuYWRkX2FjY291bnQoYWNjb3VudCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB0aMOqbSB0w6BpIGtob+G6o24gbeG7m2kge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gY2hvIHtzZWxmLmFwcF9uYW1lfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFNhdSBraGkgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB04burIHRoaeG6v3QgYuG7iywgdGjhu7FjIGhp4buHbiBtYXBwaW5nIHbhu5tpIEdvTGlrZQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQuG6r3QgxJHhuqd1IG1hcHBpbmcgdMOgaSBraG/huqNuIHtzZWxmLmFwcF9uYW1lfSB24bubaSBHb0xpa2UuLi4iKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIEdvTGlrZQogICAgICAgICAgICAgICAgZ29saWtlX2FjY291bnRzID0gc2VsZi5nZXRfZ29saWtlX2FjY291bnRzKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgZ29saWtlX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB7bGVuKGdvbGlrZV9hY2NvdW50cyl9IHTDoGkga2hv4bqjbiBHb0xpa2UgY2hvIHtzZWxmLmFwcF9uYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiDEkcOjIGPhuq1wIG5o4bqtdCB04burIERCCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF9kZXZpY2VfYWNjb3VudHMgPSBzZWxmLmRiLmdldF9hY2NvdW50cyhhcHA9c2VsZi5hcHBfbmFtZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRo4buxYyBoaeG7h24gbWFwcGluZwogICAgICAgICAgICAgICAgICAgIG1hcHBlZF9jb3VudCA9IHNlbGYubWFwX2dvbGlrZV9hY2NvdW50cyhnb2xpa2VfYWNjb3VudHMsIHVwZGF0ZWRfZGV2aWNlX2FjY291bnRzKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UobWFwcGVkX2NvdW50LCBpbnQpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBtYXBwaW5nIHttYXBwZWRfY291bnR9IHTDoGkga2hv4bqjbiB7c2VsZi5hcHBfbmFtZX0gduG7m2kgR29MaWtlIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiSG/DoG4gdGjDoG5oIG1hcHBpbmcgdMOgaSBraG/huqNuIHtzZWxmLmFwcF9uYW1lfSB24bubaSBHb0xpa2UiKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiBHb0xpa2UgbsOgbyBjaG8ge3NlbGYuYXBwX25hbWV9IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBtYXBwaW5nIHbhu5tpIEdvTGlrZToge2V9IikKICAgICAgICAgICAgICAgICMgS2jDtG5nIHRocm93IGV4Y2VwdGlvbiB2w6wgc3luYyB0w6BpIGtob+G6o24gdOG7qyB0aGnhur90IGLhu4sgxJHDoyB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZGV2aWNlX2FjY291bnRzCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB7c2VsZi5hcHBfbmFtZX0iKQogICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgCiAgICBkZWYgaXNfZ29saWtlX2F1dGhlbnRpY2F0ZWQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSDEkcOjIGPDsyB0aMO0bmcgdGluIHjDoWMgdGjhu7FjIEdvTGlrZSBjaMawYQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJHDoyB4w6FjIHRo4buxYywgRmFsc2UgbuG6v3UgY2jGsGEKICAgICAgICAiIiIKICAgICAgICBnb2xpa2VfaGVhZGVycyA9IHNlbGYuZGIuZ2V0KCJnb2xpa2VfaGVhZGVycyIsIHt9KQogICAgICAgIHJldHVybiBib29sKGdvbGlrZV9oZWFkZXJzIGFuZCAiYXV0aG9yaXphdGlvbiIgaW4gZ29saWtlX2hlYWRlcnMpCiAgICAKICAgIGRlZiBhcGlfcmVxdWVzdChzZWxmLCB1cmw6IHN0ciwgbWV0aG9kOiBzdHIgPSAiR0VUIiwgcGF5bG9hZDogRGljdFtzdHIsIEFueV0gPSBOb25lKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgR+G7jWkgQVBJIEdvTGlrZSB0aMO0bmcgcXVhIEdvTGlrZVNlcnZpY2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB1cmw6IFVSTCBj4bunYSBBUEkKICAgICAgICAgICAgbWV0aG9kOiBQaMawxqFuZyB0aOG7qWMgSFRUUCAoR0VUIGhv4bq3YyBQT1NUKQogICAgICAgICAgICBwYXlsb2FkOiBE4buvIGxp4buHdSBn4butaSDEkWkgKGNobyBQT1NUIHJlcXVlc3QpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgaG/hurdjIE5vbmU6IEvhur90IHF14bqjIEFQSSBu4bq/dSB0aMOgbmggY8O0bmcsIE5vbmUgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuZ29saWtlX3NlcnZpY2U6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGfhu41pIEFQSTogR29MaWtlU2VydmljZSBjaMawYSDEkcaw4bujYyBjdW5nIGPhuqVwIGNobyB7c2VsZi5hcHBfbmFtZX0gam9iIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgIyBY4butIGzDvSBwYXlsb2FkIGNobyBHRVQgcmVxdWVzdCAtIHRow6ptIHbDoG8gVVJMCiAgICAgICAgaWYgbWV0aG9kLnVwcGVyKCkgPT0gIkdFVCIgYW5kIHBheWxvYWQ6CiAgICAgICAgICAgICMgVOG6oW8gcXVlcnkgc3RyaW5nIHThu6sgcGF5bG9hZAogICAgICAgICAgICBxdWVyeV9wYXJhbXMgPSBbXQogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBwYXlsb2FkLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiB2YWx1ZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBxdWVyeV9wYXJhbXMuYXBwZW5kKGYie3VybGxpYi5wYXJzZS5xdW90ZShrZXkpfT17dXJsbGliLnBhcnNlLnF1b3RlKHN0cih2YWx1ZSkpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIHF1ZXJ5IHN0cmluZyB2w6BvIFVSTAogICAgICAgICAgICBpZiBxdWVyeV9wYXJhbXM6CiAgICAgICAgICAgICAgICBzZXBhcmF0b3IgPSAiJiIgaWYgIj8iIGluIHVybCBlbHNlICI/IgogICAgICAgICAgICAgICAgdXJsID0gZiJ7dXJsfXtzZXBhcmF0b3J9eycmJy5qb2luKHF1ZXJ5X3BhcmFtcyl9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6t3QgcGF5bG9hZCB24buBIE5vbmUgdsOsIMSRw6MgxJHGsGEgdsOgbyBVUkwKICAgICAgICAgICAgcGF5bG9hZCA9IE5vbmUKICAgICAgICAKICAgICAgICByZXR1cm4gc2VsZi5nb2xpa2Vfc2VydmljZS5hcGlfcmVxdWVzdCh1cmwsIG1ldGhvZCwgcGF5bG9hZCkKICAgIAogICAgZGVmIGdldF9nb2xpa2VfYWNjb3VudHMoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHDoyDEkcSDbmcga8O9IHbhu5tpIEdvTGlrZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBHb0xpa2UKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDGsOG7nW5nIGThuqtuIEFQSSBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbgogICAgICAgICAgICB1cmwgPSBmIntzZWxmLmdldF9hY2NvdW50X3VybCgpfSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJCiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5hcGlfcmVxdWVzdCh1cmwpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgYWNjb3VudHMgPSByZXNwb25zZS5nZXQoImRhdGEiLCBbXSkKICAgICAgICAgICAgICAgIHJldHVybiBhY2NvdW50cwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBHb0xpa2UiKQogICAgICAgICAgICByZXR1cm4gW10KICAgIAogICAgZGVmIG1hcF9nb2xpa2VfYWNjb3VudHMoc2VsZiwgZ29saWtlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSwgZGV2aWNlX2FjY291bnRzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgw4FuaCB44bqhIHTDoGkga2hv4bqjbiB04burIEdvTGlrZSB2w6BvIHTDoGkga2hv4bqjbiB0csOqbiB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBnb2xpa2VfYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuIHThu6sgR29MaWtlIEFQSQogICAgICAgICAgICBkZXZpY2VfYWNjb3VudHM6IERhbmggc8OhY2ggdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gxJHDoyDDoW5oIHjhuqEKICAgICAgICAiIiIKICAgICAgICAjIFBoxrDGoW5nIHRo4bupYyBt4bq3YyDEkeG7i25oLCBj4bqnbiBvdmVycmlkZSDhu58gbOG7m3AgY29uCiAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBmZXRjaF9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIGpvYiB04burIEdvTGlrZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgaG/hurdjIE5vbmU6IFRow7RuZyB0aW4gam9iIG7hur91IGPDsywgTm9uZSBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQxrDhu51uZyBk4bqrbiBBUEkgbOG6pXkgam9iCiAgICAgICAgICAgIHVybCA9IGYie3NlbGYuZ2V0X2pvYnNfdXJsKCl9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaGFtIHPhu5EgdMO5eSB0aGVvIGxv4bqhaSBhcHAKICAgICAgICAgICAgcGFyYW1zID0gc2VsZi5nZXRfam9iX3BhcmFtcyhhY2NvdW50KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBBUEkKICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmFwaV9yZXF1ZXN0KHVybCwgIkdFVCIsIHBhcmFtcykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN1Y2Nlc3MiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBqb2IgPSByZXNwb25zZS5nZXQoImRhdGEiLCBOb25lKQogICAgICAgICAgICAgICAgaWYgam9iOgogICAgICAgICAgICAgICAgICAgICMgQ2h14bqpbiBow7NhIGThu68gbGnhu4d1IGpvYgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLm1hcF9qb2JfZGF0YShqb2IpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgam9iIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIG1hcF9qb2JfZGF0YShzZWxmLCBqb2JfZGF0YTogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENodeG6qW4gaMOzYSBk4buvIGxp4buHdSBqb2IgdOG7qyBBUEkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2JfZGF0YTogROG7ryBsaeG7h3Ugam9iIHThu6sgQVBJCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBE4buvIGxp4buHdSBqb2IgxJHDoyBjaHXhuqluIGjDs2EKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiYXBwIjogc2VsZi5hcHBfbmFtZSwKICAgICAgICAgICAgImlkIjogam9iX2RhdGEuZ2V0KCJpZCIpLAogICAgICAgICAgICAibGluayI6IGpvYl9kYXRhLmdldCgibGluayIpLAogICAgICAgICAgICAidHlwZSI6IGpvYl9kYXRhLmdldCgidHlwZSIpLAogICAgICAgICAgICAib2JqZWN0X2lkIjogam9iX2RhdGEuZ2V0KCJvYmplY3RfaWQiKSwKICAgICAgICAgICAgInByaWNlX2FmdGVyX2Nvc3QiOiBqb2JfZGF0YS5nZXQoInByaWNlX2FmdGVyX2Nvc3QiKSwKICAgICAgICAgICAgInN0YXR1cyI6ICJpZGxlIiwgICMgU3RhdHVzIG3hurdjIMSR4buLbmggbMOgIGlkbGUKICAgICAgICAgICAgInJhd19kYXRhIjogam9iX2RhdGEgICMgTMawdSBs4bqhaSBk4buvIGxp4buHdSBn4buRYyDEkeG7gyB0aGFtIGto4bqjbyBraGkgY+G6p24KICAgICAgICB9CiAgICAKICAgIGRlZiB2YWxpZGF0ZV9qb2JfYmVmb3JlX2V4ZWN1dGlvbihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB2w6AgdmFsaWRhdGUgam9iIHRyxrDhu5tjIGtoaSB0aOG7sWMgaGnhu4duCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgdmFsaWRhdGlvbjoKICAgICAgICAgICAgICAgIC0gdmFsaWQgKGJvb2wpOiBUcnVlIG7hur91IGpvYiBo4bujcCBs4buHLCBGYWxzZSBu4bq/dSBraMO0bmcKICAgICAgICAgICAgICAgIC0gc2hvdWxkX3NraXAgKGJvb2wpOiBUcnVlIG7hur91IG7Dqm4gc2tpcCBqb2IsIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICAgICAgICAgLSByZWFzb24gKHN0cik6IEzDvSBkbyBraMO0bmcgaOG7o3AgbOG7hyBob+G6t2Mgc2tpcAogICAgICAgICAgICAgICAgLSBtZXNzYWdlIChzdHIpOiBUaMO0bmcgYsOhbyBjaGkgdGnhur90CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBqb2JfdHlwZSA9IGpvYi5nZXQoInR5cGUiLCAiIikubG93ZXIoKQogICAgICAgICAgICBqb2JfcHJpY2UgPSBqb2IuZ2V0KCJwcmljZV9hZnRlcl9jb3N0IiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBqb2IgZm9sbG93CiAgICAgICAgICAgIGlmIGpvYl90eXBlID09ICJmb2xsb3ciOgogICAgICAgICAgICAgICAgIyAxLiBLaeG7g20gdHJhIGdpw6EgdGnhu4FuIGPhu6dhIGpvYiBmb2xsb3cKICAgICAgICAgICAgICAgIG1pbl9mb2xsb3dfcHJpY2UgPSBzZWxmLmRiLmdldCgibWluX2ZvbGxvd19wcmljZSIsIDMwKSAgIyBN4bq3YyDEkeG7i25oIDMwCiAgICAgICAgICAgICAgICBpZiBqb2JfcHJpY2UgPCBtaW5fZm9sbG93X3ByaWNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWxpZCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAic2hvdWxkX3NraXAiOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAibWVzc2FnZSI6IGYiSm9iIGZvbGxvdyBjw7MgZ2nDoSB7am9iX3ByaWNlfSA8IHttaW5fZm9sbG93X3ByaWNlfSwgc2tpcCBqb2IuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkMOjIGLhu48ga2nhu4NtIHRyYSBraMOzYSBmb2xsb3cgdsOsIGtow7RuZyBjw7JuIGdp4bubaSBo4bqhbiBmb2xsb3cKICAgICAgICAgICAgCiAgICAgICAgICAgICMgSm9iIGjhu6NwIGzhu4cKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ2YWxpZCI6IFRydWUsCiAgICAgICAgICAgICAgICAic2hvdWxkX3NraXAiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJtZXNzYWdlIjogIkpvYiBo4bujcCBs4buHIgogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIGYiTOG7l2kga2hpIHZhbGlkYXRlIGpvYjoge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInZhbGlkIjogRmFsc2UsCiAgICAgICAgICAgICAgICAic2hvdWxkX3NraXAiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJyZWFzb24iOiAidmFsaWRhdGlvbl9lcnJvciIsCiAgICAgICAgICAgICAgICAibWVzc2FnZSI6IGYiTOG7l2kga2hpIHZhbGlkYXRlIGpvYjoge3N0cihlKX0iCiAgICAgICAgICAgIH0KICAgIAogICAgZGVmIGV4ZWN1dGVfam9iKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGpvYgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIHRo4buxYyBoaeG7h24gam9iLCBiYW8gZ+G7k206CiAgICAgICAgICAgICAgICAtIHN0YXR1cyAoaW50KTogTcOjIHRy4bqhbmcgdGjDoWkgam9iCiAgICAgICAgICAgICAgICAgICAgMDogQ2jGsGEgdGjhu7FjIGhp4buHbgogICAgICAgICAgICAgICAgICAgIDE6IFRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIDI6IFRo4bqldCBi4bqhaSwga2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZwogICAgICAgICAgICAgICAgICAgIDM6IFRo4bqldCBi4bqhaSwgxJHDoyBi4buLIHVuZm9sbG93L3VubGlrZQogICAgICAgICAgICAgICAgLSBtZXNzYWdlIChzdHIpOiBUaMO0bmcgYsOhbyBr4bq/dCBxdeG6owogICAgICAgICAgICAgICAgLSBzdWNjZXNzIChib29sKTogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgICMgTeG6t2MgxJHhu4tuaCBraMO0bmcgbMOgbSBnw6wsIGPhuqduIG92ZXJyaWRlIOG7nyBs4bubcCBjb24KICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVGjhu7FjIGhp4buHbiBqb2IgY2hvIHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSIpCiAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9qb2JfcmVzdWx0KDAsICJDaMawYSB0aOG7sWMgaGnhu4duIGpvYiIsIEZhbHNlKQogICAgCiAgICBkZWYgX2NyZWF0ZV9qb2JfcmVzdWx0KHNlbGYsIHN0YXR1czogaW50LCBtZXNzYWdlOiBzdHIsIHN1Y2Nlc3M6IGJvb2wsICoqa3dhcmdzKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBU4bqhbyBr4bq/dCBxdeG6oyBqb2IgY2h14bqpbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHN0YXR1cyAoaW50KTogTcOjIHRy4bqhbmcgdGjDoWkgam9iCiAgICAgICAgICAgICAgICAwOiBDaMawYSB0aOG7sWMgaGnhu4duCiAgICAgICAgICAgICAgICAxOiBUaMOgbmggY8O0bmcKICAgICAgICAgICAgICAgIDI6IFRo4bqldCBi4bqhaSwga2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZwogICAgICAgICAgICAgICAgMzogVGjhuqV0IGLhuqFpLCDEkcOjIGLhu4sgdW5mb2xsb3cvdW5saWtlCiAgICAgICAgICAgICAgICA0OiBUaOG6pXQgYuG6oWksIHnDqnUgY+G6p3UgxJFhbmcgY2jhu50KICAgICAgICAgICAgICAgIDU6IEfhu61pIHnDqnUgY+G6p3UgY2jhu50gZHV54buHdCAoSW5zdGFncmFtKQogICAgICAgICAgICBtZXNzYWdlIChzdHIpOiBUaMO0bmcgYsOhbyBr4bq/dCBxdeG6owogICAgICAgICAgICBzdWNjZXNzIChib29sKTogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICAgICAqKmt3YXJnczogQ8OhYyB0aMO0bmcgdGluIGLhu5Ugc3VuZwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgam9iIMSRw6MgY2h14bqpbiBow7NhCiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0ID0gewogICAgICAgICAgICAic3RhdHVzIjogc3RhdHVzLAogICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICJzdWNjZXNzIjogc3VjY2VzcwogICAgICAgIH0KICAgICAgICAKICAgICAgICAjIFRow6ptIHRow7RuZyB0aW4gYuG7lSBzdW5nIG7hur91IGPDswogICAgICAgIHJlc3VsdC51cGRhdGUoa3dhcmdzKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHQKICAgIAogICAgZGVmIHJlcG9ydF9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0sIHJlc3VsdDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQsOhbyBjw6FvIGvhur90IHF14bqjIGpvYgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgcmVzdWx0OiBL4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIGpvYiBiYW8gZ+G7k206CiAgICAgICAgICAgICAgICAtIHN0YXR1cyAoaW50KTogTcOjIHRy4bqhbmcgdGjDoWkgam9iCiAgICAgICAgICAgICAgICAgICAgMTogVGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgMjogVGjhuqV0IGLhuqFpLCBraMO0bmcgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nCiAgICAgICAgICAgICAgICAgICAgMzogVGjhuqV0IGLhuqFpLCDEkcOjIGLhu4sgdW5mb2xsb3cvdW5saWtlCiAgICAgICAgICAgICAgICAtIG1lc3NhZ2UgKHN0cik6IFRow7RuZyBiw6FvIGvhur90IHF14bqjCiAgICAgICAgICAgICAgICAtIHN1Y2Nlc3MgKGJvb2wpOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgYsOhbyBjw6FvIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBqb2JfaWQgPSBqb2IuZ2V0KCJpZCIpCiAgICAgICAgICAgIGpvYl90eXBlID0gam9iLmdldCgidHlwZSIsICIiKQogICAgICAgICAgICBqb2Jfc3RhdHVzID0gcmVzdWx0LmdldCgic3RhdHVzIiwgMCkKICAgICAgICAgICAgam9iX3N1Y2Nlc3MgPSByZXN1bHQuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEdoaSBs4bqhaSBs4buLY2ggc+G7rSBqb2IKICAgICAgICAgICAgc2VsZi5yZWNvcmRfam9iX2hpc3RvcnkoYWNjb3VudCwgam9iLCByZXN1bHQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgam9iX2lkOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyBjw7MgSUQgam9iIMSR4buDIGLDoW8gY8OhbyIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBqb2IgdsOgIHjhu60gbMO9IHTGsMahbmcg4bupbmcKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Ugc3RhdHVzIGzDoCAyIChs4buXaSBraMO0bmcgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nKSwgaOG7p3kgam9iIHbDoCBiw6FvIGPDoW8gdGjhuqV0IGLhuqFpCiAgICAgICAgICAgIGlmIGpvYl9zdGF0dXMgPT0gMjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBqb2Ige2pvYl9pZH0sIGtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcsIGjhu6d5IGpvYiIpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5za2lwX2pvYihhY2NvdW50LCBqb2IpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IHN0YXR1cyBsw6AgMyAoxJHDoyBi4buLIHVuZm9sbG93L3VubGlrZSksIMSRw6FuaCBk4bqldSB0cm9uZyByZXN1bHQgxJHhu4MgSm9iU2VydmljZSB44butIGzDvQogICAgICAgICAgICBpZiBqb2Jfc3RhdHVzID09IDM6CiAgICAgICAgICAgICAgICBhY2NvdW50X3VzZXJuYW1lID0gYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiUGjDoXQgaGnhu4duIGLhu4sgdW5mb2xsb3cvdW5saWtlLCB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBI4buneSBqb2IgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICBzZWxmLnNraXBfam9iKGFjY291bnQsIGpvYikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdW5mb2xsb3cgdHJvbmcgcmVzdWx0IMSR4buDIEpvYlNlcnZpY2UgeOG7rSBsw70gdOG6rXAgdHJ1bmcKICAgICAgICAgICAgICAgIHJlc3VsdFsidW5mb2xsb3ciXSA9IFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBqb2Jfc3RhdHVzID09IDQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiWcOqdSBj4bqndSDEkWFuZyBjaOG7nSB0cm9uZyBqb2Ige2pvYl90eXBlfSwgaOG7p3kgam9iIikKICAgICAgICAgICAgICAgIHNlbGYuc2tpcF9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGpvYiB0aMOgbmggY8O0bmcsIGLDoW8gY8OhbyBr4bq/dCBxdeG6owogICAgICAgICAgICBpZiBqb2Jfc3VjY2VzczoKICAgICAgICAgICAgICAgICMgVVJMIEFQSSBiw6FvIGPDoW8gam9iCiAgICAgICAgICAgICAgICB1cmwgPSBmImFkdmVydGlzaW5nL3B1Ymxpc2hlcnMve3NlbGYuYXBwX25hbWV9L2NvbXBsZXRlLWpvYnMiCiAgICAgICAgICAgICAgICB1cmwgPSBmImFkdmVydGlzaW5nL3B1Ymxpc2hlcnMve3NlbGYuYXBwX25hbWV9L2NvbXBsZXRlLWpvYnMiCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVOG6oW8gcGF5bG9hZCBjaG8gYsOhbyBjw6FvIGpvYgogICAgICAgICAgICAgICAgcGF5bG9hZCA9IHNlbGYuZ2V0X3JlcG9ydF9wYXlsb2FkKGFjY291bnQsIGpvYikKICAgICAgICAgICAgICAgIGlmIG5vdCBwYXlsb2FkOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgdOG6oW8gcGF5bG9hZCBjaG8gYsOhbyBjw6FvIGpvYiIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjhu60gZ+G7jWkgQVBJIHThu5FpIMSRYSAzIGzhuqduCiAgICAgICAgICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZSgzKToKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuYXBpX3JlcXVlc3QodXJsLCAiUE9TVCIsIHBheWxvYWQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2UgYW5kIHJlc3BvbnNlLmdldCgic3VjY2VzcyIsIEZhbHNlKToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgYsOhbyBjw6FvIGpvYiB7am9iX2lkfSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsaWYgcmVzcG9uc2UgYW5kIHJlc3BvbnNlLmdldCgic3RhdHVzIikgPT0gNDAwOgogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSByZXNwb25zZS5nZXQoJ21lc3NhZ2UnLCAnJykKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJbe2F0dGVtcHQgKyAxfV0gQsOhbyBjw6FvIGpvYiBs4buXaToge2Vycm9yX21zZ30sIHRo4butIGzhuqFpIHNhdSA1cy4uLiIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJQaOG6o24gaOG7k2kga2jDtG5nIG1vbmcgxJHhu6NpIGtoaSBiw6FvIGPDoW8gam9iOiB7cmVzcG9uc2V9IikKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoNSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdGjDoG5oIGPDtG5nIHNhdSAzIGzhuqduIHRo4butLCBo4buneSBqb2IKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGLDoW8gY8OhbyBqb2Ige2pvYl9pZH0gc2F1IDMgbOG6p24gdGjhu60iKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuc2tpcF9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBKb2Iga2jDtG5nIHRow6BuaCBjw7RuZywgaOG7p3kgam9iCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiSm9iIHtqb2JfaWR9IGtow7RuZyB0aMOgbmggY8O0bmcsIGjhu6d5IGpvYiIpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5za2lwX2pvYihhY2NvdW50LCBqb2IpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGLDoW8gY8OhbyBqb2IiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGdldF9yZXBvcnRfcGF5bG9hZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVOG6oW8gcGF5bG9hZCBjaG8gdmnhu4djIGLDoW8gY8OhbyBob8OgbiB0aMOgbmggam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogUGF5bG9hZCBjaG8gQVBJIGLDoW8gY8OhbwogICAgICAgICIiIgogICAgICAgIGdvbGlrZV9pZCA9IGFjY291bnQuZ2V0KCJnb2xpa2VfaWQiKQogICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICAKICAgICAgICBpZiBub3QgZ29saWtlX2lkIG9yIG5vdCBqb2JfaWQ6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJUaGnhur91IHRow7RuZyB0aW4gdMOgaSBraG/huqNuIGhv4bq3YyBqb2IgxJHhu4MgdOG6oW8gcGF5bG9hZCBiw6FvIGPDoW8iKQogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImFkc19pZCI6IGpvYl9pZCwKICAgICAgICAgICAgImFjY291bnRfaWQiOiBnb2xpa2VfaWQsCiAgICAgICAgICAgICJhc3luYyI6IFRydWUsCiAgICAgICAgICAgICJkYXRhIjogTm9uZQogICAgICAgIH0KICAgIAogICAgZGVmIGdldF9za2lwX3BheWxvYWQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFThuqFvIHBheWxvYWQgY2hvIHZp4buHYyBi4buPIHF1YS9o4buneSBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBQYXlsb2FkIGNobyBBUEkgc2tpcCBqb2IKICAgICAgICAiIiIKICAgICAgICBnb2xpa2VfaWQgPSBhY2NvdW50LmdldCgiZ29saWtlX2lkIikKICAgICAgICBqb2JfaWQgPSBqb2IuZ2V0KCJpZCIpCiAgICAgICAgam9iX3R5cGUgPSBqb2IuZ2V0KCJ0eXBlIikKICAgICAgICBvYmplY3RfaWQgPSBqb2IuZ2V0KCJvYmplY3RfaWQiKQogICAgICAgIAogICAgICAgIGlmIG5vdCBnb2xpa2VfaWQgb3Igbm90IGpvYl9pZDoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIlRoaeG6v3UgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24gaG/hurdjIGpvYiDEkeG7gyB04bqhbyBwYXlsb2FkIGjhu6d5IikKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJhZHNfaWQiOiBqb2JfaWQsCiAgICAgICAgICAgICJhY2NvdW50X2lkIjogZ29saWtlX2lkLAogICAgICAgICAgICAib2JqZWN0X2lkIjogb2JqZWN0X2lkLAogICAgICAgICAgICAidHlwZSI6IGpvYl90eXBlCiAgICAgICAgfQogICAgICAgIAogICAgZGVmIHNraXBfam9iKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIELhu48gcXVhL2jhu6d5IGpvYiBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgaOG7p3kgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBpbXBvcnQgY29uZmlnCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFVSTCBBUEkgxJHhu4Mgc2tpcCBqb2IKICAgICAgICAgICAgdXJsID0gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0vYWR2ZXJ0aXNpbmcvcHVibGlzaGVycy97c2VsZi5hcHBfbmFtZX0vc2tpcC1qb2JzIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBwYXlsb2FkIGNobyB2aeG7h2Mgc2tpcCBqb2IKICAgICAgICAgICAgcGF5bG9hZCA9IHNlbGYuZ2V0X3NraXBfcGF5bG9hZChhY2NvdW50LCBqb2IpCiAgICAgICAgICAgIGlmIG5vdCBwYXlsb2FkOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB04bqhbyBwYXlsb2FkIGNobyBza2lwIGpvYiIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJCiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5hcGlfcmVxdWVzdCh1cmwsICJQT1NUIiwgcGF5bG9hZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN1Y2Nlc3MiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBo4buneSBqb2Ige2pvYi5nZXQoJ2lkJyl9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkjhu6d5IGpvYiB7am9iLmdldCgnaWQnKX0gdGjhuqV0IGLhuqFpOiB7cmVzcG9uc2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBo4buneSBqb2IiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIGRlZiBjbG9zZV9hcHAoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgxJDDs25nIGFwcAogICAgICAgICIiIgogICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcChzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgZGVmIGdldF9hcGlfYmFzZV91cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBn4buRYyBj4bunYSBBUEkgR29MaWtlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVUkwgZ+G7kWMKICAgICAgICAiIiIKICAgICAgICBpbXBvcnQgY29uZmlnCiAgICAgICAgcmV0dXJuIGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L3tzZWxmLmFwcF9uYW1lfSIKICAgIAogICAgZGVmIGdldF9hY2NvdW50X3VybChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgVVJMIEFQSSB0w6BpIGtob+G6o24gY+G7p2EgR29MaWtlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVUkwgQVBJIHTDoGkga2hv4bqjbgogICAgICAgICIiIgogICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9LWFjY291bnQiCiAgICAKICAgIGRlZiBnZXRfam9ic191cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgam9icyBj4bunYSBHb0xpa2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgam9icwogICAgICAgICIiIgogICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0vYWR2ZXJ0aXNpbmcvcHVibGlzaGVycy97c2VsZi5hcHBfbmFtZX0vam9icyIKICAgIAogICAgZGVmIGdldF9qb2JfcmVwb3J0X3VybChzZWxmLCBqb2JfaWQ6IHN0cikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgYsOhbyBjw6FvIGpvYiBj4bunYSBHb0xpa2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2JfaWQ6IElEIGPhu6dhIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgYsOhbyBjw6FvIGpvYgogICAgICAgICIiIgogICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9L2pvYnMve2pvYl9pZH0vcmVwb3J0IgogICAgCiAgICBkZWYgZ2V0X2pvYl9wYXJhbXMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRoYW0gc+G7kSDEkeG7gyBn4buNaSBBUEkgbOG6pXkgam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IFRoYW0gc+G7kQogICAgICAgICIiIgogICAgICAgICMgTeG6t2MgxJHhu4tuaCBraMO0bmcgY8OzIHRoYW0gc+G7kSwgY+G6p24gb3ZlcnJpZGUg4bufIGzhu5twIGNvbgogICAgICAgIHJldHVybiB7fQogICAgCiAgICBkZWYgZ2V0X2FjY291bnRzX2Zyb21fZGV2aWNlKHNlbGYpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIlBoxrDGoW5nIHRo4bupYyBjxqEgc+G7nyDEkeG7gyBs4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiwgY+G6p24gb3ZlcnJpZGUg4bufIGNsYXNzIGNvbiIiIgogICAgICAgIHJldHVybiBbXQogICAgCiAgICBkZWYgc2V0X3NsZWVwX2Z1bmN0aW9uKHNlbGYsIHNsZWVwX2Z1bmM6IENhbGxhYmxlW1tmbG9hdF0sIGJvb2xdKToKICAgICAgICAiIiIKICAgICAgICDEkOG6t3QgaMOgbSBzbGVlcCB0w7l5IGNo4buJbmgKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBzbGVlcF9mdW5jOiBIw6BtIHNsZWVwIG5o4bqtbiBt4buZdCB0aGFtIHPhu5EgbMOgIHPhu5EgZ2nDonkgdsOgIHRy4bqjIHbhu4EgVHJ1ZSBu4bq/dSBzbGVlcCDEkeG7pyB0aOG7nWkgZ2lhbiwKICAgICAgICAgICAgICAgICAgICAgICAgRmFsc2UgbuG6v3UgYuG7iyBk4burbmcgbOG6oWkKICAgICAgICAiIiIKICAgICAgICBzZWxmLl9zbGVlcF9mdW5jID0gc2xlZXBfZnVuYwogICAgICAgIAogICAgZGVmIHNhZmVfc2xlZXAoc2VsZiwgc2Vjb25kczogZmxvYXQpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgTmfhu6cgYW4gdG/DoG4sIGPDsyB0aOG7gyBk4burbmcgbOG6oWkgbmdheSBs4bqtcCB04bupYwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHNlY29uZHM6IFPhu5EgZ2nDonkgY+G6p24gbmfhu6cKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBuZ+G7pyDEkeG7pyB0aOG7nWkgZ2lhbiwgRmFsc2UgbuG6v3UgYuG7iyBk4burbmcgbOG6oWkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fc2xlZXBfZnVuYyhzZWNvbmRzKQogICAgCiAgICBkZWYgc3dpdGNoX3RvX2FjY291bnQoc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIENodXnhu4NuIMSR4buVaSBzYW5nIHTDoGkga2hv4bqjbiBt4bulYyB0acOqdQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhcmdldF9hY2NvdW50OiBUw6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24gxJHhur9uCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY2h1eeG7g24gxJHhu5VpIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgY2h1eeG7g24gxJHhu5VpIHNhbmcgdMOgaSBraG/huqNuIHt0YXJnZXRfYWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICd1bmtub3duJyl9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhurd0IHRo4budaSBnaWFuIGNo4budIHThu5FpIMSRYSAoZ2nDonkpCiAgICAgICAgICAgIHRpbWVvdXQgPSA2MAogICAgICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdXNlcm5hbWUgY+G7p2EgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAKICAgICAgICAgICAgY3VycmVudF91c2VybmFtZSA9IHNlbGYuZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKCkKICAgICAgICAgICAgdGFyZ2V0X3VzZXJuYW1lID0gdGFyZ2V0X2FjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSDEkcOjIMSRxINuZyBuaOG6rXAgxJHDum5nIHTDoGkga2hv4bqjbiBy4buTaSwga2jDtG5nIGPhuqduIGNodXnhu4NuIMSR4buVaQogICAgICAgICAgICBpZiBjdXJyZW50X3VzZXJuYW1lIGFuZCBjdXJyZW50X3VzZXJuYW1lID09IHRhcmdldF91c2VybmFtZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIMSRxINuZyBuaOG6rXAgdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IHLhu5NpIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGNoxrBhIMSRxINuZyBuaOG6rXAgxJHDum5nIHTDoGkga2hv4bqjbiwgdGjhu7FjIGhp4buHbiBjaHV54buDbiDEkeG7lWkKICAgICAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgdGltZW91dDoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIFBoxrDGoW5nIHRo4bupYyBuw6B5IHPhur0gxJHGsOG7o2MgZ2hpIMSRw6ggYuG7n2kgbOG7m3AgY29uIHTDuXkgdGhlbyDhu6luZyBk4bulbmcKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5fcGVyZm9ybV9hY2NvdW50X3N3aXRjaCh0YXJnZXRfYWNjb3VudCkKICAgICAgICAgICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgICAgICAgICAjIMSQ4bujaSBt4buZdCBjaMO6dCDEkeG7gyDhu6luZyBk4bulbmcgbG9hZCB4b25nCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGzhuqFpIHhlbSDEkcOjIGNodXnhu4NuIMSRw7puZyB0w6BpIGtob+G6o24gY2jGsGEKICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3VzZXJuYW1lID0gc2VsZi5nZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmV3X3VzZXJuYW1lIGFuZCBuZXdfdXNlcm5hbWUgPT0gdGFyZ2V0X3VzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgY2h1eeG7g24gc2FuZyB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkcSDbmcgbmjhuq1wIHRyb25nIERCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnJlc2V0X2xvZ2luX3N0YXR1c19ieV9hcHAoc2VsZi5hcHBfbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGIudXBkYXRlX2FjY291bnQodGFyZ2V0X2FjY291bnRbImlkIl0sIHsiaXNfbG9naW4iOiBUcnVlLCAiaXNfc3luYyI6IEZhbHNlfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGNoxrBhIHRow6BuaCBjw7RuZywgxJHhu6NpIG3hu5l0IGNow7p0IHLhu5NpIHRo4butIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgY2h1eeG7g24gdMOgaSBraG/huqNuOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBjaHV54buDbiBzYW5nIHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSBzYXUge3RpbWVvdXR9IGdpw6J5IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgY2h1eeG7g24gdMOgaSBraG/huqNuIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfcGVyZm9ybV9hY2NvdW50X3N3aXRjaChzZWxmLCB0YXJnZXRfYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBjw6FjIHRoYW8gdMOhYyBVSSDEkeG7gyBjaHV54buDbiB0w6BpIGtob+G6o24KICAgICAgICBQaMawxqFuZyB0aOG7qWMgbsOgeSBj4bqnbiDEkcaw4bujYyBnaGkgxJHDqCBi4bufaSBs4bubcCBjb24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXJnZXRfYWNjb3VudDogVMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuIMSR4bq/bgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgIyBQaMawxqFuZyB0aOG7qWMgY8ahIHPhu58gY2jhu4kgbG9nIGPhuqNuaCBiw6FvCiAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIlBoxrDGoW5nIHRo4bupYyBfcGVyZm9ybV9hY2NvdW50X3N3aXRjaCBjaMawYSDEkcaw4bujYyB0cmnhu4NuIGtoYWkgY2hvIHtzZWxmLl9fY2xhc3NfXy5fX25hbWVfX30iKQogICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgZGVmIGdldF9jdXJyZW50X2xvZ2dlZF9pbl91c2VybmFtZShzZWxmKSAtPiBPcHRpb25hbFtzdHJdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyIGhv4bq3YyBOb25lOiBVc2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gxJFhbmcgxJHEg25nIG5o4bqtcCwgaG/hurdjIE5vbmUgbuG6v3Uga2jDtG5nIGPDswogICAgICAgICIiIgogICAgICAgICMgUGjGsMahbmcgdGjhu6ljIGPGoSBz4bufIGNo4buJIGxvZyBj4bqjbmggYsOhbwogICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJQaMawxqFuZyB0aOG7qWMgZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lIGNoxrBhIMSRxrDhu6NjIHRyaeG7g24ga2hhaSBjaG8ge3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIHJlY29yZF9qb2JfaGlzdG9yeShzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSwgcmVzdWx0OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEdoaSBs4bqhaSBs4buLY2ggc+G7rSBqb2IgdsOgbyBkYXRhYmFzZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgcmVzdWx0OiBL4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVVSUQgY+G7p2EgYuG6o24gZ2hpIGzhu4tjaCBz4butIGpvYiBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZAogICAgICAgICAgICBkZXZpY2VfaWQgPSBzZWxmLmRiLmdldF9vcl9jcmVhdGVfZGV2aWNlX2lkKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2h14bqpbiBi4buLIGThu68gbGnhu4d1IGpvYiBoaXN0b3J5CiAgICAgICAgICAgIGpvYl9kYXRhID0gewogICAgICAgICAgICAgICAgImFjY291bnRfdXVpZCI6IGFjY291bnQuZ2V0KCJhY2NvdW50X3V1aWQiLCAiIiksCiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgImFwcCI6IHNlbGYuYXBwX25hbWUsCiAgICAgICAgICAgICAgICAiam9iX2lkIjogam9iLmdldCgiaWQiLCAiIiksCiAgICAgICAgICAgICAgICAiam9iX3R5cGUiOiBqb2IuZ2V0KCJ0eXBlIiwgIiIpLAogICAgICAgICAgICAgICAgIm9iamVjdF9pZCI6IGpvYi5nZXQoIm9iamVjdF9pZCIsICIiKSwKICAgICAgICAgICAgICAgICJsaW5rIjogam9iLmdldCgibGluayIsICIiKSwKICAgICAgICAgICAgICAgICJzdGF0dXMiOiByZXN1bHQuZ2V0KCJzdGF0dXMiLCAwKSwKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogcmVzdWx0LmdldCgic3VjY2VzcyIsIEZhbHNlKSwKICAgICAgICAgICAgICAgICJwcmljZSI6IGpvYi5nZXQoInByaWNlX2FmdGVyX2Nvc3QiLCAwKSwKICAgICAgICAgICAgICAgICJlcnJvcl9tZXNzYWdlIjogcmVzdWx0LmdldCgibWVzc2FnZSIsICIiKSBpZiBub3QgcmVzdWx0LmdldCgic3VjY2VzcyIsIEZhbHNlKSBlbHNlICIiLAogICAgICAgICAgICAgICAgImNyZWF0ZWRfYXQiOiBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZSAgIyDEkOG6o20gYuG6o28gdHLhuqFuZyB0aMOhaSBsw6AgY2jGsGEgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgIGpvYl91dWlkID0gc2VsZi5kYi5hZGRfam9iX2hpc3Rvcnkoam9iX2RhdGEpCiAgICAgICAgICAgIGlmIGpvYl91dWlkOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiLEkMOjIGzGsHUgbOG7i2NoIHPhu60gam9iIHtqb2IuZ2V0KCdpZCcpfSB2w6BvIGRhdGFiYXNlIHbhu5tpIFVVSUQ6IHtqb2JfdXVpZH0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIktow7RuZyB0aOG7gyBsxrB1IGzhu4tjaCBz4butIGpvYiB7am9iLmdldCgnaWQnKX0gdsOgbyBkYXRhYmFzZSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gam9iX3V1aWQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGdoaSBs4buLY2ggc+G7rSBqb2IiKQogICAgICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgcmVwb3J0X2pvYl9jb21wbGV0ZWQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0sIHJlcG9ydF9kYXRhOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgcmVwb3J0X2RhdGE6IEThu68gbGnhu4d1IGLDoW8gY8OhbwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgYsOhbyBjw6FvIHThu6sgQVBJCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGpvYl9pZCB04burIGpvYgogICAgICAgICAgICBqb2JfaWQgPSBqb2IuZ2V0KCJpZCIpCiAgICAgICAgICAgIGlmIG5vdCBqb2JfaWQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IGpvYl9pZCB0cm9uZyBqb2IiKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiAiS2jDtG5nIHTDrG0gdGjhuqV5IGpvYl9pZCB0cm9uZyBqb2IifQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2h14bqpbiBi4buLIGThu68gbGnhu4d1IGLDoW8gY8OhbwogICAgICAgICAgICBwYXlsb2FkID0gewogICAgICAgICAgICAgICAgImlkIjogam9iX2lkLAogICAgICAgICAgICAgICAgInN0YXR1cyI6IFRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBiw6FvIGPDoW8gbuG6v3UgY8OzCiAgICAgICAgICAgIGlmIHJlcG9ydF9kYXRhOgogICAgICAgICAgICAgICAgcGF5bG9hZC51cGRhdGUocmVwb3J0X2RhdGEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBBUEkgYsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaAogICAgICAgICAgICB1cmwgPSBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS9hZHZlcnRpc2luZy9wdWJsaXNoZXJzL3tzZWxmLmFwcF9uYW1lfS9jb21wbGV0ZS1qb2JzIgogICAgICAgICAgICByZXN1bHQgPSBzZWxmLmdvbGlrZV9zZXJ2aWNlLmFwaV9yZXF1ZXN0KHVybCwgbWV0aG9kPSJQT1NUIiwgcGF5bG9hZD1wYXlsb2FkKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHJlc3VsdDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgYsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaCIpCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6ICJLaMO0bmcgdGjhu4MgYsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaCJ9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgYsOhbyBjw6FvIGpvYiB7am9iX2lkfSBob8OgbiB0aMOgbmggdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAibWVzc2FnZSI6ICLEkMOjIGLDoW8gY8OhbyBqb2IgaG/DoG4gdGjDoG5oIHRow6BuaCBjw7RuZyIsICJkYXRhIjogcmVzdWx0fQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGLDoW8gY8OhbyBqb2IgxJHDoyBob8OgbiB0aMOgbmgiKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6IGYiTOG7l2kga2hpIGLDoW8gY8OhbyBqb2IgxJHDoyBob8OgbiB0aMOgbmg6IHtzdHIoZSl9In0KICAgICAgICAgICAgCiAgICBkZWYgcmVwb3J0X2pvYl9za2lwcGVkKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldLCByZWFzb246IHN0ciA9ICIiKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBCw6FvIGPDoW8gam9iIMSRw6MgYuG7iyBi4buPIHF1YQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgcmVhc29uOiBMw70gZG8gYuG7jyBxdWEgam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyBiw6FvIGPDoW8gdOG7qyBBUEkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgam9iX2lkIHThu6sgam9iCiAgICAgICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICAgICAgaWYgbm90IGpvYl9pZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgam9iX2lkIHRyb25nIGpvYiIpCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6ICJLaMO0bmcgdMOsbSB0aOG6pXkgam9iX2lkIHRyb25nIGpvYiJ9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHXhuqluIGLhu4sgZOG7ryBsaeG7h3UgYsOhbyBjw6FvCiAgICAgICAgICAgIHBheWxvYWQgPSB7CiAgICAgICAgICAgICAgICAiaWQiOiBqb2JfaWQKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBsw70gZG8gbuG6v3UgY8OzCiAgICAgICAgICAgIGlmIHJlYXNvbjoKICAgICAgICAgICAgICAgIHBheWxvYWRbInJlYXNvbiJdID0gcmVhc29uCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBBUEkgYsOhbyBjw6FvIGpvYiDEkcOjIGLhu4sgYuG7jyBxdWEKICAgICAgICAgICAgdXJsID0gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0vYWR2ZXJ0aXNpbmcvcHVibGlzaGVycy97c2VsZi5hcHBfbmFtZX0vc2tpcC1qb2JzIgogICAgICAgICAgICByZXN1bHQgPSBzZWxmLmdvbGlrZV9zZXJ2aWNlLmFwaV9yZXF1ZXN0KHVybCwgbWV0aG9kPSJQT1NUIiwgcGF5bG9hZD1wYXlsb2FkKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHJlc3VsdDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgYsOhbyBjw6FvIGpvYiDEkcOjIGLhu4sgYuG7jyBxdWEiKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiAiS2jDtG5nIHRo4buDIGLDoW8gY8OhbyBqb2IgxJHDoyBi4buLIGLhu48gcXVhIn0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBiw6FvIGPDoW8gam9iIHtqb2JfaWR9IGLhu4sgYuG7jyBxdWEgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAibWVzc2FnZSI6ICLEkMOjIGLDoW8gY8OhbyBqb2IgYuG7iyBi4buPIHF1YSB0aMOgbmggY8O0bmciLCAiZGF0YSI6IHJlc3VsdH0KICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBiw6FvIGPDoW8gam9iIMSRw6MgYuG7iyBi4buPIHF1YSIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogZiJM4buXaSBraGkgYsOhbyBjw6FvIGpvYiDEkcOjIGLhu4sgYuG7jyBxdWE6IHtzdHIoZSl9In0KICAgIAogICAgZGVmIGdldF9hY2NvdW50X2xpc3RfdXJsKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBVUkwgQVBJIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVUkwgQVBJIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L3tzZWxmLmFwcF9uYW1lfSIKICAgICAgICAKICAgIGRlZiBnZXRfYWNjb3VudF9kZXRhaWxfdXJsKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBVUkwgQVBJIGNoaSB0aeG6v3QgdMOgaSBraG/huqNuCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVUkwgQVBJIGNoaSB0aeG6v3QgdMOgaSBraG/huqNuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L3tzZWxmLmFwcF9uYW1lfS1hY2NvdW50IgogICAgICAgIAogICAgZGVmIGdldF9qb2JfbGlzdF91cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgZGFuaCBzw6FjaCBqb2IKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgZGFuaCBzw6FjaCBqb2IKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0vYWR2ZXJ0aXNpbmcvcHVibGlzaGVycy97c2VsZi5hcHBfbmFtZX0vam9icyIKICAgICAgICAKICAgIGRlZiBnZXRfam9iX3JlcG9ydF91cmwoc2VsZiwgam9iX2lkOiBzdHIpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBVUkwgQVBJIGLDoW8gY8OhbyBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2JfaWQ6IElEIGPhu6dhIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgYsOhbyBjw6FvIGpvYgogICAgICAgICIiIgogICAgICAgIHJldHVybiBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS97c2VsZi5hcHBfbmFtZX0vam9icy97am9iX2lkfS9yZXBvcnQi').decode('utf-8'))
