import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBMaXN0CmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCmZyb20gdXRpbHMgaW1wb3J0IExvZ0xldmVsLCBMb2dnZXIKCiMgVOG6oW8gbG9nZ2VyIHJpw6puZyBjaG8gR29MaWtlU2VydmljZQpsb2dnZXIgPSB1dGlscy5nZXRfbG9nZ2VyKCJHb0xpa2VTZXJ2aWNlIikKCiMgS2nhu4NtIHRyYSB2w6AgaW1wb3J0IGPDoWMgdGjGsCB2aeG7h24gY+G6p24gdGhp4bq/dAp0cnk6CiAgICBpbXBvcnQgcHljaHJvbWUKICAgIFBZQ0hST01FX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLndhcm5pbmcoIlRoxrAgdmnhu4duIHB5Y2hyb21lIGtow7RuZyBraOG6oyBk4bulbmcuIEjDo3kgY8OgaSDEkeG6t3QgYuG6sW5nIGzhu4duaDogcGlwIGluc3RhbGwgcHljaHJvbWUiKQogICAgUFlDSFJPTUVfQVZBSUxBQkxFID0gRmFsc2UKCnRyeToKICAgIGltcG9ydCBjbG91ZHNjcmFwZXIKICAgIENMT1VEU0NSQVBFUl9BVkFJTEFCTEUgPSBUcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIGxvZ2dlci53YXJuaW5nKCJUaMawIHZp4buHbiBjbG91ZHNjcmFwZXIga2jDtG5nIGto4bqjIGThu6VuZy4gSMOjeSBjw6BpIMSR4bq3dCBi4bqxbmcgbOG7h25oOiBwaXAgaW5zdGFsbCBjbG91ZHNjcmFwZXIiKQogICAgQ0xPVURTQ1JBUEVSX0FWQUlMQUJMRSA9IEZhbHNlCgp0cnk6CiAgICBpbXBvcnQgY3VybF9jZmZpCiAgICBmcm9tIGN1cmxfY2ZmaSBpbXBvcnQgcmVxdWVzdHMgYXMgY3VybF9yZXF1ZXN0cwogICAgQ1VSTF9DRkZJX0FWQUlMQUJMRSA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLndhcm5pbmcoIlRoxrAgdmnhu4duIGN1cmxfY2ZmaSBraMO0bmcga2jhuqMgZOG7pW5nLiBIw6N5IGPDoGkgxJHhurd0IGLhurFuZyBs4buHbmg6IHBpcCBpbnN0YWxsIGN1cmwtY2ZmaSIpCiAgICBDVVJMX0NGRklfQVZBSUxBQkxFID0gRmFsc2UKCmNsYXNzIEJyb3dzZXI6CiAgICAiIiIKICAgIEzhu5twIGdp4bqjIGzhuq1wIEJyb3dzZXIgY+G7p2EgcHljaHJvbWUgbuG6v3UgdGjGsCB2aeG7h24ga2jDtG5nIGto4bqjIGThu6VuZwogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgdXJsKToKICAgICAgICBzZWxmLnVybCA9IHVybAogICAgICAgIAogICAgZGVmIGxpc3RfdGFiKHNlbGYpOgogICAgICAgIHJldHVybiBbXQogICAgICAgIAogICAgZGVmIG5ld190YWIoc2VsZik6CiAgICAgICAgcmV0dXJuIE5vbmUKCmNsYXNzIEdvTGlrZVNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgaGVscGVyX3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIEto4bufaSB04bqhbyBHb0xpa2UgU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGRiX3NlcnZpY2U6IERhdGFiYXNlIHNlcnZpY2UgxJHhu4MgbMawdSB0aMO0bmcgdGluCiAgICAgICAgICAgIGhlbHBlcl9zZXJ2aWNlOiBIZWxwZXIgc2VydmljZSDEkeG7gyB0xrDGoW5nIHTDoWMgduG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5kYiA9IGRiX3NlcnZpY2UKICAgICAgICBzZWxmLmhlbHBlciA9IGhlbHBlcl9zZXJ2aWNlCiAgICAgICAgCiAgICAgICAgIyBD4bqldSBow6xuaCBjaG8gQVBJIHJlcXVlc3RzCiAgICAgICAgc2VsZi51c2VyX2FnZW50ID0gIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgSykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzExNC4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiIKICAgICAgICAKICAgICAgICAjIFF1eeG6v3QgxJHhu4tuaCBz4butIGThu6VuZyBjdXJsX2NmZmkgaGF5IGNsb3Vkc2NyYXBlcgogICAgICAgICMgVHLDqm4gVGVybXV4IHRoxrDhu51uZyBz4butIGThu6VuZyBjbG91ZHNjcmFwZXIgZG8gY3VybF9jZmZpIGPDsyB0aOG7gyBraMO0bmcgdMawxqFuZyB0aMOtY2gKICAgICAgICBpc190ZXJtdXggPSBzZWxmLl9jaGVja19pc190ZXJtdXgoKQogICAgICAgIHNlbGYudXNlX2N1cmxfY2ZmaSA9IG5vdCBpc190ZXJtdXggYW5kIENVUkxfQ0ZGSV9BVkFJTEFCTEUKICAgICAgICAKICAgICAgICAjIEto4bufaSB04bqhbyBjbGllbnQKICAgICAgICBpZiBub3Qgc2VsZi51c2VfY3VybF9jZmZpIGFuZCBDTE9VRFNDUkFQRVJfQVZBSUxBQkxFOgogICAgICAgICAgICBzZWxmLmNsaWVudCA9IGNsb3Vkc2NyYXBlci5jcmVhdGVfc2NyYXBlcigKICAgICAgICAgICAgICAgIGJyb3dzZXI9ewogICAgICAgICAgICAgICAgICAgICdicm93c2VyJzogJ2Nocm9tZScsCiAgICAgICAgICAgICAgICAgICAgJ3BsYXRmb3JtJzogJ2FuZHJvaWQnLAogICAgICAgICAgICAgICAgICAgICdkZXNrdG9wJzogRmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgRmFsbGJhY2sgdG8gcmVndWxhciByZXF1ZXN0cyBpZiBuZWl0aGVyIGlzIGF2YWlsYWJsZQogICAgICAgICAgICBzZWxmLmNsaWVudCA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIHTDuXkgY2jhu41uIGNobyBjdXJsX2NmZmkKICAgICAgICBzZWxmLmltcGVyc29uYXRlID0gImNocm9tZTExMCIKICAgICAgICAKICAgICAgICAjIEJp4bq/biB0aGVvIGTDtWkgdGhyZWFkIHJlcG9ydAogICAgICAgIHNlbGYucmVwb3J0X3RocmVhZCA9IE5vbmUKICAgICAgICAKICAgICAgICAjIEto4bufaSDEkeG7mW5nIHRocmVhZCByZXBvcnQKICAgICAgICBzZWxmLnN0YXJ0X3JlcG9ydF90aHJlYWQoKQoKICAgIGRlZiBfY2hlY2tfaXNfdGVybXV4KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIGPDsyDEkWFuZyBjaOG6oXkgdHLDqm4gVGVybXV4IGtow7RuZwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgxJFhbmcgY2jhuqF5IHRyw6puIFRlcm11eAogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGJp4bq/biBtw7RpIHRyxrDhu51uZyBURVJNVVhfVkVSU0lPTiBob+G6t2MgxJHGsOG7nW5nIGThuqtuIFRlcm11eCB0cm9uZyBQQVRICiAgICAgICAgICAgIGltcG9ydCBvcwogICAgICAgICAgICByZXR1cm4gJ1RFUk1VWF9WRVJTSU9OJyBpbiBvcy5lbnZpcm9uIG9yICcvZGF0YS9kYXRhL2NvbS50ZXJtdXgnIGluIG9zLmVudmlyb24uZ2V0KCdQQVRIJywgJycpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZmV0Y2hfZ29saWtlX2hlYWRlcnMoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBoZWFkZXJzIHThu6sgQ2hyb21lIHbDoCBsxrB1IHbDoG8gZGF0YWJhc2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IFBZQ0hST01FX0FWQUlMQUJMRToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgbOG6pXkgR29MaWtlIGhlYWRlcnM6IHRoxrAgdmnhu4duIHB5Y2hyb21lIGtow7RuZyBraOG6oyBk4bulbmciKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICBmcm9tIHB5Y2hyb21lIGltcG9ydCBCcm93c2VyCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgQ2hyb21lIMSRw6MgY8OgaSDEkeG6t3QgY2jGsGEKICAgICAgICAgICAgaWYgbm90IHNlbGYuaGVscGVyLmlzX2FwcF9pbnN0YWxsZWQoImNvbS5hbmRyb2lkLmNocm9tZSIpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJDaHJvbWUgY2jGsGEgxJHGsOG7o2MgY8OgaSDEkeG6t3QgdHLDqm4gdGhp4bq/dCBi4buLIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTeG7nyBDaHJvbWUKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk3hu58g4bupbmcgZOG7pW5nIENocm9tZS4uLiIpCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuaGVscGVyLm9wZW5fYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiLCAiY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4iKQogICAgICAgICAgICBpZiByZXN1bHRbInN0YXR1cyJdICE9ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIG3hu58gQ2hyb21lIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmhlbHBlci53YWl0X2Zvcl9lbGVtZW50KHJlc291cmNlX2lkPSJjb20uYW5kcm9pZC5jaHJvbWU6aWQvbWVudV9idXR0b25fd3JhcHBlciIsdGltZW91dD0zMCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyBt4bufIMSRxrDhu6NjIGNocm9tZSB0cm9uZyAzMHMiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIENocm9tZSBkZWJ1ZyBwb3J0IGLhurFuZyBBREIKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBT4butIGThu6VuZyBBREIgxJHDoyBr4bq/dCBu4buRaQogICAgICAgICAgICAgICAgaWYgc2VsZi5oZWxwZXIuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sgdOG7qyBoZWxwZXIKICAgICAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5oZWxwZXIuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRo4buxYyBoaeG7h24gbOG7h25oIGZvcndhcmQgduG7m2kgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJmb3J3YXJkIiwgInRjcDo5MjIyIiwgImxvY2FsYWJzdHJhY3Q6Y2hyb21lX2RldnRvb2xzX3JlbW90ZSJdCiAgICAgICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJBREIga2jDtG5nIMSRxrDhu6NjIGvhur90IG7hu5FpLCBraMO0bmcgdGjhu4MgbeG7nyBDaHJvbWUgZGVidWcgcG9ydCIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIG3hu58gQ2hyb21lIGRlYnVnIHBvcnQ6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEvhur90IG7hu5FpIMSR4bq/biBDaHJvbWUgYuG6sW5nIHB5Y2hyb21lCiAgICAgICAgICAgIGJyb3dzZXIgPSBCcm93c2VyKCJodHRwOi8vbG9jYWxob3N0OjkyMjIiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDoWMgdGFiIMSRYW5nIG3hu58KICAgICAgICAgICAgZ29saWtlX3RhYiA9IE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gY8OzIHNlYXJjaCBib3gga2jDtG5nCiAgICAgICAgICAgIHNlYXJjaF9ib3ggPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5hbmRyb2lkLmNocm9tZTppZC9zZWFyY2hfYm94IikKICAgICAgICAgICAgaWYgc2VhcmNoX2JveDoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJU4bqhbyB0YWIgbeG7m2kuLi4iKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgVGjhu60gdOG6oW8gdGFiIG3hu5tpIHbhu5tpIHjhu60gbMO9IGzhu5dpIEpTT05EZWNvZGVFcnJvcgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgZ29saWtlX3RhYiA9IGJyb3dzZXIubmV3X3RhYigpCiAgICAgICAgICAgICAgICAgICAgICAgIGdvbGlrZV90YWIuc3RhcnQoKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoanNvbi5KU09ORGVjb2RlRXJyb3IsIHJlcXVlc3RzLmV4Y2VwdGlvbnMuSlNPTkRlY29kZUVycm9yKSBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBKU09OIGtoaSB04bqhbyB0YWIgbeG7m2k6IHtlfS4gVGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgQ2hyb21lLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIiwgImNvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGzhuqFpIGzhu4duaCBmb3J3YXJkCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLmhlbHBlci5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsiZm9yd2FyZCIsICJ0Y3A6OTIyMiIsICJsb2NhbGFic3RyYWN0OmNocm9tZV9kZXZ0b29sc19yZW1vdGUiXQogICAgICAgICAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyb3dzZXIgPSBCcm93c2VyKCJodHRwOi8vbG9jYWxob3N0OjkyMjIiKQogICAgICAgICAgICAgICAgICAgICAgICBnb2xpa2VfdGFiID0gYnJvd3Nlci5uZXdfdGFiKCkKICAgICAgICAgICAgICAgICAgICAgICAgZ29saWtlX3RhYi5zdGFydCgpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgaWYgIldlYlNvY2tldENvbm5lY3Rpb25DbG9zZWRFeGNlcHRpb24iIGluIHN0cihlKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJL4bq/dCBu4buRaSBXZWJTb2NrZXQgxJHDoyDEkcOzbmcga2hpIHThuqFvIHRhYiBt4bubaS4gVGjhu60gxJHDs25nIHbDoCBt4bufIGzhuqFpIENocm9tZS4iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIsICJjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMykKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIHThuqFvIHRhYiBt4bubaSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGPDoWMgdGFiIMSRYW5nIG3hu58KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYnMgPSBicm93c2VyLmxpc3RfdGFiKCkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgKGpzb24uSlNPTkRlY29kZUVycm9yLCByZXF1ZXN0cy5leGNlcHRpb25zLkpTT05EZWNvZGVFcnJvcikgYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgSlNPTiBraGkgbGnhu4d0IGvDqiB0YWI6IHtlfS4gVGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgQ2hyb21lLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIiwgImNvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGzhuqFpIGzhu4duaCBmb3J3YXJkCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLmhlbHBlci5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsiZm9yd2FyZCIsICJ0Y3A6OTIyMiIsICJsb2NhbGFic3RyYWN0OmNocm9tZV9kZXZ0b29sc19yZW1vdGUiXQogICAgICAgICAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyb3dzZXIgPSBCcm93c2VyKCJodHRwOi8vbG9jYWxob3N0OjkyMjIiKQogICAgICAgICAgICAgICAgICAgICAgICB0YWJzID0gYnJvd3Nlci5saXN0X3RhYigpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHRhYiBnb2xpa2UKICAgICAgICAgICAgICAgICAgICBmb3IgdGFiIGluIHRhYnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYi5zdGFydCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJfaW5mbyA9IHRhYi5jYWxsX21ldGhvZCgiUnVudGltZS5ldmFsdWF0ZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb249IndpbmRvdy5sb2NhdGlvbi5ocmVmIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGFiX2luZm8gYW5kICJyZXN1bHQiIGluIHRhYl9pbmZvIGFuZCAidmFsdWUiIGluIHRhYl9pbmZvWyJyZXN1bHQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3VybCA9IHRhYl9pbmZvWyJyZXN1bHQiXVsidmFsdWUiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJhcHAuZ29saWtlLm5ldCIgaW4gY3VycmVudF91cmw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIHTDrG0gdGjhuqV5IHRhYiBHb0xpa2UiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb2xpa2VfdGFiID0gdGFiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJXZWJTb2NrZXRDb25uZWN0aW9uQ2xvc2VkRXhjZXB0aW9uIiBpbiBzdHIoZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJL4bq/dCBu4buRaSBXZWJTb2NrZXQgxJHDoyDEkcOzbmcga2hpIGtp4buDbSB0cmEgdGFiOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGtp4buDbSB0cmEgdGFiOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ29saWtlX3RhYjoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSB0YWIgR29MaWtlLCB04bqhbyB0YWIgbeG7m2kuLi4iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29saWtlX3RhYiA9IGJyb3dzZXIubmV3X3RhYigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29saWtlX3RhYi5zdGFydCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgKGpzb24uSlNPTkRlY29kZUVycm9yLCByZXF1ZXN0cy5leGNlcHRpb25zLkpTT05EZWNvZGVFcnJvcikgYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBKU09OIGtoaSB04bqhbyB0YWIgbeG7m2k6IHtlfS4gVGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgQ2hyb21lLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIiwgImNvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGzhuqFpIGzhu4duaCBmb3J3YXJkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuaGVscGVyLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbImZvcndhcmQiLCAidGNwOjkyMjIiLCAibG9jYWxhYnN0cmFjdDpjaHJvbWVfZGV2dG9vbHNfcmVtb3RlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjhu60ga+G6v3QgbuG7kWkgbOG6oWkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyID0gQnJvd3NlcigiaHR0cDovL2xvY2FsaG9zdDo5MjIyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb2xpa2VfdGFiID0gYnJvd3Nlci5uZXdfdGFiKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb2xpa2VfdGFiLnN0YXJ0KCkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIldlYlNvY2tldENvbm5lY3Rpb25DbG9zZWRFeGNlcHRpb24iIGluIHN0cihlKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkvhur90IG7hu5FpIFdlYlNvY2tldCDEkcOjIMSRw7NuZyBraGkgdOG6oW8gdGFiIG3hu5tpLiBUaOG7rSDEkcOzbmcgdsOgIG3hu58gbOG6oWkgQ2hyb21lLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKCJjb20uYW5kcm9pZC5jaHJvbWUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIiwgImNvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSB04bqhbyB0YWIgbeG7m2kiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGlmICJXZWJTb2NrZXRDb25uZWN0aW9uQ2xvc2VkRXhjZXB0aW9uIiBpbiBzdHIoZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS+G6v3QgbuG7kWkgV2ViU29ja2V0IMSRw6MgxJHDs25nIGtoaSBsaeG7h3Qga8OqIHRhYi4gVGjhu60gxJHDs25nIHbDoCBt4bufIGzhuqFpIENocm9tZS4iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIsICJjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMykKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGtp4buDbSB0cmEgY8OhYyB0YWIiKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQuG6rXQgdGhlbyBkw7VpIG3huqFuZwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBnb2xpa2VfdGFiLk5ldHdvcmsuZW5hYmxlKCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgaWYgIldlYlNvY2tldENvbm5lY3Rpb25DbG9zZWRFeGNlcHRpb24iIGluIHN0cihlKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkvhur90IG7hu5FpIFdlYlNvY2tldCDEkcOjIMSRw7NuZyBraGkgYuG6rXQgdGhlbyBkw7VpIG3huqFuZy4gVGjhu60gxJHDs25nIHbDoCBt4bufIGzhuqFpIENocm9tZS4iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBi4bqtdCB0aGVvIGTDtWkgbeG6oW5nIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQmnhur9uIMSR4buDIGtp4buDbSB0cmEgeGVtIHJlcXVlc3QgxJHDoyDEkcaw4bujYyBnaGkgbmjhuq1uIGNoxrBhCiAgICAgICAgICAgIHJlcXVlc3RfY2FwdHVyZWQgPSBGYWxzZQogICAgICAgICAgICBoZWFkZXJzID0gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMSDbmcga8O9IHPhu7Ega2nhu4duIHJlcXVlc3RXaWxsQmVTZW50CiAgICAgICAgICAgIGRlZiByZXF1ZXN0X2NhbGxiYWNrKCoqa3dhcmdzKToKICAgICAgICAgICAgICAgIG5vbmxvY2FsIHJlcXVlc3RfY2FwdHVyZWQsIGhlYWRlcnMKICAgICAgICAgICAgICAgIGlmIHJlcXVlc3RfY2FwdHVyZWQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBrd2FyZ3MuZ2V0KCJyZXF1ZXN0Iiwge30pCiAgICAgICAgICAgICAgICB1cmwgPSByZXF1ZXN0LmdldCgidXJsIiwgIiIpCiAgICAgICAgICAgICAgICBtZXRob2QgPSByZXF1ZXN0LmdldCgibWV0aG9kIiwgIiIpCiAgICAgICAgICAgICAgICBpZiAiaHR0cHM6Ly9nYXRld2F5LmdvbGlrZS5uZXQvYXBpL3N0YXRpc3RpY3MvcmVwb3J0IiBpbiB1cmwgYW5kIG1ldGhvZCA9PSAiR0VUIjoKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzID0gcmVxdWVzdC5nZXQoImhlYWRlcnMiLCB7fSkKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBnaGkgbmjhuq1uIGhlYWRlcnMgR29MaWtlIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdF9jYXB0dXJlZCA9IFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIGdvbGlrZV90YWIuTmV0d29yay5yZXF1ZXN0V2lsbEJlU2VudCA9IHJlcXVlc3RfY2FsbGJhY2sKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6o2kgbOG6oWkgdHJhbmcgxJHhu4MgZ2hpIG5o4bqtbiByZXF1ZXN0CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGdvbGlrZV90YWIuY2FsbF9tZXRob2QoIlBhZ2UubmF2aWdhdGUiLCB1cmw9Imh0dHBzOi8vYXBwLmdvbGlrZS5uZXQiKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBpZiAiV2ViU29ja2V0Q29ubmVjdGlvbkNsb3NlZEV4Y2VwdGlvbiIgaW4gc3RyKGUpOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS+G6v3QgbuG7kWkgV2ViU29ja2V0IMSRw6MgxJHDs25nIGtoaSB04bqjaSBs4bqhaSB0cmFuZy4gVGjhu60gxJHDs25nIHbDoCBt4bufIGzhuqFpIENocm9tZS4iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLmNsb3NlX2FwcCgiY29tLmFuZHJvaWQuY2hyb21lIikKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSB04bqjaSBs4bqhaSB0cmFuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bujaSAxMCBnacOieSDEkeG7gyBnaGkgbmjhuq1uIHJlcXVlc3QKICAgICAgICAgICAgdGltZS5zbGVlcCgxMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6r3QgdGhlbyBkw7VpIG3huqFuZyB2w6AgeMOzYSBsaXN0ZW5lcgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBnb2xpa2VfdGFiLk5ldHdvcmsuZGlzYWJsZSgpCiAgICAgICAgICAgICAgICBnb2xpa2VfdGFiLk5ldHdvcmsucmVxdWVzdFdpbGxCZVNlbnQgPSBOb25lCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGlmICJXZWJTb2NrZXRDb25uZWN0aW9uQ2xvc2VkRXhjZXB0aW9uIiBpbiBzdHIoZSk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkvhur90IG7hu5FpIFdlYlNvY2tldCDEkcOjIMSRw7NuZyBraGkgdOG6r3QgdGhlbyBkw7VpIG3huqFuZy4gVGnhur9wIHThu6VjIHjhu60gbMO9LiIpCiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgcmV0dXJuIHbDrCDEkcOjIGPDsyB0aOG7gyBs4bqleSDEkcaw4bujYyBoZWFkZXJzCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIHThuq90IHRoZW8gZMO1aSBt4bqhbmc6IHtzdHIoZSl9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGhlYWRlcnM6CiAgICAgICAgICAgICAgICAjIEzGsHUgaGVhZGVycyB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgICAgICBzZWxmLnNhdmVfZ29saWtlX2hlYWRlcnMoaGVhZGVycykKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGzGsHUgaGVhZGVycyB2w6BvIGRhdGFiYXNlIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIGzhuqV5IHRow7RuZyB0aW4geMOhYyB0aOG7sWMgR29MaWtlLCB2dWkgbMOybmcga2nhu4NtIHRyYSBs4bqhaSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgaWYgIldlYlNvY2tldENvbm5lY3Rpb25DbG9zZWRFeGNlcHRpb24iIGluIHN0cihlKToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS+G6v3QgbuG7kWkgV2ViU29ja2V0IMSRw6MgxJHDs25nLiBUaOG7rSDEkcOzbmcgdsOgIG3hu58gbOG6oWkgQ2hyb21lLiIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBt4bufIENocm9tZSB2w6Aga+G6v3QgbuG7kWkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBzYXZlX2dvbGlrZV9oZWFkZXJzKHNlbGYsIGhlYWRlcnM6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEzGsHUgR29MaWtlIGhlYWRlcnMgdsOgbyBkYXRhYmFzZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGhlYWRlcnM6IEhlYWRlcnMgdOG7qyByZXF1ZXN0IEdvTGlrZQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIENo4buJIGzGsHUgdsOgbyBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgxJHhu4MgxJHhu5NuZyBi4buZIHbhu5tpIHNlcnZlcgogICAgICAgICAgICBzZWxmLmRiLnNldF9kZXZpY2VfY29uZmlnKCJnb2xpa2VfaGVhZGVycyIsIGhlYWRlcnMpCiAgICAgICAgICAgIHNlbGYuZGIuc2V0X2RldmljZV9jb25maWcoImdvbGlrZV9oZWFkZXJzX3VwZGF0ZWQiLCBpbnQodGltZS50aW1lKCkpKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBsxrB1IEdvTGlrZSBoZWFkZXJzOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGdldF9nb2xpa2VfaGVhZGVycyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBHb0xpa2UgaGVhZGVycyB04burIGRhdGFiYXNlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEhlYWRlcnMgaG/hurdjIGRpY3Rpb25hcnkgcuG7l25nIG7hur91IGtow7RuZyBjw7MKICAgICAgICAiIiIKICAgICAgICAjIENo4buJIGzhuqV5IHThu6sgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLCiAgICAgICAgcmV0dXJuIHNlbGYuZGIuZ2V0X2RldmljZV9jb25maWcoImdvbGlrZV9oZWFkZXJzIiwge30pCiAgICAgICAgCiAgICBkZWYgaXNfZ29saWtlX2F1dGhlbnRpY2F0ZWQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiJ+CiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gxJHDoyBjw7MgdGjDtG5nIHRpbiB4w6FjIHRo4buxYyBHb0xpa2UgY2jGsGEKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRw6MgeMOhYyB0aOG7sWMsIEZhbHNlIG7hur91IGNoxrBhCiAgICAgICAgIiIiCiAgICAgICAgaGVhZGVycyA9IHNlbGYuZ2V0X2dvbGlrZV9oZWFkZXJzKCkKICAgICAgICAjIEtp4buDbSB0cmEgY8OzIGF1dGhvcml6YXRpb24gdHJvbmcgaGVhZGVycwogICAgICAgIHJldHVybiBib29sKGhlYWRlcnMpCiAgICAKICAgIGRlZiBmZXRjaF9nb2xpa2VfaGVhZGVyc193aXRoX3JldHJ5KHNlbGYsIGZvcmNlX3JlZnJlc2g6IGJvb2wgPSBGYWxzZSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBHb0xpa2UgaGVhZGVycyB24bubaSBjxqEgY2jhur8gdGjhu60gbOG6oWkuIFRo4butIGzhuqFpIHThu5FpIMSRYSA1IGzhuqduIG7hur91IHRo4bqldCBi4bqhaS4KICAgICAgICBDaOG7iSBs4bqleSBs4bqhaSBoZWFkZXJzIDEgbOG6p24gbeG7l2kgbmfDoHkgZOG7sWEgdsOgbyB0aOG7nWkgZ2lhbiBj4bqtcCBuaOG6rXQgY3Xhu5FpIGPDuW5nLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGZvcmNlX3JlZnJlc2g6IE7hur91IFRydWUsIHPhur0gbHXDtG4gbOG6pXkgbOG6oWkgaGVhZGVycyBi4bqldCBr4buDIHRo4budaSBnaWFuIGPhuq1wIG5o4bqtdCBjdeG7kWkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkcOjIGPDsyBoZWFkZXJzIGjhu6NwIGzhu4cgaG/hurdjIGzhuqV5IMSRxrDhu6NjIGhlYWRlcnMgbeG7m2ksIEZhbHNlIG7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYwogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyBjw7MgdGjDtG5nIHRpbiB4w6FjIHRo4buxYyBHb0xpa2UgY2jGsGEKICAgICAgICBpZiBzZWxmLmlzX2dvbGlrZV9hdXRoZW50aWNhdGVkKCkgYW5kIG5vdCBmb3JjZV9yZWZyZXNoOgogICAgICAgICAgICAjIEtp4buDbSB0cmEgdGjhu51pIGdpYW4gY+G6rXAgbmjhuq10IGN14buRaQogICAgICAgICAgICBsYXN0X3VwZGF0ZSA9IHNlbGYuZGIuZ2V0KCJnb2xpa2VfaGVhZGVyc191cGRhdGVkIiwgMCkKICAgICAgICAgICAgY3VycmVudF90aW1lID0gaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSDEkcOjIGPhuq1wIG5o4bqtdCB0cm9uZyB2w7JuZyAyNCBnaeG7nSBxdWEsIGtow7RuZyBj4bqnbiBs4bqleSBs4bqhaQogICAgICAgICAgICBpZiBjdXJyZW50X3RpbWUgLSBsYXN0X3VwZGF0ZSA8IDg2NDAwOiAgIyAyNCBnaeG7nSA9IDg2NDAwIGdpw6J5CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBjw7MgdGjDtG5nIHRpbiB4w6FjIHRo4buxYyBHb0xpa2UgdsOgIGNoxrBhIHF1w6EgMjQgZ2nhu50gdOG7qyBs4bqnbiBj4bqtcCBuaOG6rXQgY3Xhu5FpIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBxdcOhIDI0IGdp4budIHThu6sgbOG6p24gY+G6rXAgbmjhuq10IGN14buRaSwgc+G6vSBsw6BtIG3hu5tpIGhlYWRlcnMgR29MaWtlIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBmb3JjZV9yZWZyZXNoOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkLhuq90IGJ14buZYyBsw6BtIG3hu5tpIGhlYWRlcnMgR29MaWtlIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJDaMawYSBjw7MgdGjDtG5nIHRpbiB4w6FjIHRo4buxYyBHb0xpa2UsIHPhur0gbOG6pXkgaGVhZGVycyBt4bubaSIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7sWMgaGnhu4duIGzhuqV5IGhlYWRlcnMgduG7m2kgY8ahIGNo4bq/IHRo4butIGzhuqFpCiAgICAgICAgbWF4X2F0dGVtcHRzID0gNSAgIyBUxINuZyBz4buRIGzhuqduIHRo4butIHThu6sgMyBsw6puIDUKICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZSgxLCBtYXhfYXR0ZW1wdHMgKyAxKToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkGFuZyBs4bqleSBHb0xpa2UgaGVhZGVycyAobOG6p24gdGjhu60ge2F0dGVtcHR9L3ttYXhfYXR0ZW1wdHN9KS4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFRo4butIGzhuqV5IGhlYWRlcnMKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLmZldGNoX2dvbGlrZV9oZWFkZXJzKCkKICAgICAgICAgICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgbOG6pXkgdsOgIGzGsHUgaGVhZGVycyBHb0xpa2UgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0aOG7gyBs4bqleSBoZWFkZXJzIEdvTGlrZSBs4bqnbiB7YXR0ZW1wdH0sIHPhur0gdGjhu60gbOG6oWkuLi4iKQogICAgICAgICAgICAgICAgICAgICMgxJDDs25nIENocm9tZSBu4bq/dSBjw7JuIG3hu58KICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9hdHRlbXB0czoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUxINuZyB0aOG7nWkgZ2lhbiBjaOG7nSB0aGVvIHPhu5EgbOG6p24gdGjhu60gKDEwcywgMjBzLCAzMHMsIDQwcykKICAgICAgICAgICAgICAgICAgICAgICAgd2FpdF90aW1lID0gYXR0ZW1wdCAqIDEwCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDhu6NpIHt3YWl0X3RpbWV9IGdpw6J5IHRyxrDhu5tjIGtoaSB0aOG7rSBs4bqhaS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgbOG6pXkgaGVhZGVycyBHb0xpa2U6IHtlfSIpCiAgICAgICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBDaHJvbWUgxJHGsOG7o2MgxJHDs25nCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5jbG9zZV9hcHAoImNvbS5hbmRyb2lkLmNocm9tZSIpCiAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X2F0dGVtcHRzOgogICAgICAgICAgICAgICAgICAgICMgVMSDbmcgdGjhu51pIGdpYW4gY2jhu50gdGhlbyBz4buRIGzhuqduIHRo4butICgxMHMsIDIwcywgMzBzLCA0MHMpCiAgICAgICAgICAgICAgICAgICAgd2FpdF90aW1lID0gYXR0ZW1wdCAqIDEwCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkOG7o2kge3dhaXRfdGltZX0gZ2nDonkgdHLGsOG7m2Mga2hpIHRo4butIGzhuqFpLi4uIikKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHdhaXRfdGltZSkKICAgICAgICAKICAgICAgICBsb2dnZXIuZXJyb3IoZiLEkMOjIHRo4butIGzhuqV5IEdvTGlrZSBoZWFkZXJzIHttYXhfYXR0ZW1wdHN9IGzhuqduIG5oxrBuZyBraMO0bmcgdGjDoG5oIGPDtG5nIikKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgYXBpX3JlcXVlc3Qoc2VsZiwgdXJsLCBtZXRob2Q9IkdFVCIsIHBheWxvYWQ9Tm9uZSk6CiAgICAgICAgIiIiCiAgICAgICAgR+G7jWkgQVBJIGPhu6dhIEdvTGlrZSB24bubaSBoZWFkZXJzIMSRw6MgbMawdQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHVybDogVVJMIGPhu6dhIEFQSQogICAgICAgICAgICBtZXRob2Q6IFBoxrDGoW5nIHRo4bupYyBIVFRQIChHRVQgaG/hurdjIFBPU1QpCiAgICAgICAgICAgIHBheWxvYWQ6IEThu68gbGnhu4d1IGfhu61pIMSRaSAoY2hvIFBPU1QgcmVxdWVzdCkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdCBob+G6t2MgTm9uZTogS+G6v3QgcXXhuqMgQVBJIG7hur91IHRow6BuaCBjw7RuZywgTm9uZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgaGVhZGVycyB04burIGRhdGFiYXNlCiAgICAgICAgICAgIGhlYWRlcnMgPSBzZWxmLmdldF9nb2xpa2VfaGVhZGVycygpCiAgICAgICAgICAgIGlmIG5vdCBoZWFkZXJzOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgR29MaWtlIGhlYWRlcnMiKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIGhlYWRlcnMgY8OzIHVzZXItYWdlbnQKICAgICAgICAgICAgaWYgInVzZXItYWdlbnQiIG5vdCBpbiBoZWFkZXJzIGFuZCAiVXNlci1BZ2VudCIgbm90IGluIGhlYWRlcnM6CiAgICAgICAgICAgICAgICBoZWFkZXJzWyJ1c2VyLWFnZW50Il0gPSBzZWxmLnVzZXJfYWdlbnQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IEFQSSBiYXNlIFVSTCB04burIGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyBob+G6t2Mgc+G7rSBk4bulbmcgbeG6t2MgxJHhu4tuaCB04burIGNvbmZpZwogICAgICAgICAgICBhcGlfYmFzZSA9IHNlbGYuZGIuZ2V0X2RldmljZV9jb25maWcoImdvbGlrZV9hcGlfYmFzZSIsIGNvbmZpZy5HT0xJS0VfQVBJX0JBU0UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IFVSTCBraMO0bmcgYuG6r3QgxJHhuqd1IGLhurFuZyBodHRwLCB0aMOqbSBhcGlfYmFzZSB2w6BvIHRyxrDhu5tjCiAgICAgICAgICAgIGlmIG5vdCB1cmwuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgICAgICAgICAgdXJsID0gZiJ7YXBpX2Jhc2V9L3t1cmwubHN0cmlwKCcvJyl9IgoKICAgICAgICAgICAgIyBT4butIGThu6VuZyBjdXJsX2NmZmkgaG/hurdjIGNsb3Vkc2NyYXBlciB0w7l5IHRoZW8gbcO0aSB0csaw4budbmcKICAgICAgICAgICAgaWYgc2VsZi51c2VfY3VybF9jZmZpIGFuZCBDVVJMX0NGRklfQVZBSUxBQkxFOgogICAgICAgICAgICAgICAgaWYgbWV0aG9kID09ICJHRVQiOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3VybF9yZXF1ZXN0cy5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICBpbXBlcnNvbmF0ZT1zZWxmLmltcGVyc29uYXRlCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxpZiBtZXRob2QgPT0gIlBPU1QiOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3VybF9yZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb249cGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICBpbXBlcnNvbmF0ZT1zZWxmLmltcGVyc29uYXRlCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJNZXRob2Qga2jDtG5nIGjhu6NwIGzhu4c6IHttZXRob2R9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBT4butIGThu6VuZyBjbG91ZHNjcmFwZXIgaG/hurdjIGZhbGxiYWNrIHRvIHJlcXVlc3RzCiAgICAgICAgICAgICAgICBpZiBtZXRob2QgPT0gIkdFVCI6CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmNsaWVudC5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZWxpZiBtZXRob2QgPT0gIlBPU1QiOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5jbGllbnQucG9zdCgKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBqc29uPXBheWxvYWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTWV0aG9kIGtow7RuZyBo4bujcCBs4buHOiB7bWV0aG9kfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gaGnhu4NuIHRo4buLIGzhu5dpIGThu4UgxJHhu41jIGjGoW4KICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IHJlc3BvbnNlLnRleHQKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIFBhcnNlIHJlc3BvbnNlIGzDoCBKU09OCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfanNvbiA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAgICAgICAgICMgRm9ybWF0IGxvZyB0aMOgbmggMSBkw7JuZwogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IGVycm9yX2pzb24uZ2V0KCdzdGF0dXMnLCByZXNwb25zZS5zdGF0dXNfY29kZSkKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZXJyb3JfanNvbi5nZXQoJ3N1Y2Nlc3MnLCBGYWxzZSkKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gZXJyb3JfanNvbi5nZXQoJ21lc3NhZ2UnLCAnS2jDtG5nIGPDsyB0aMO0bmcgYsOhbyBs4buXaScpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBH4buZcCB0aMOgbmggMSBkw7JuZwogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkFQSSB0cuG6oyB24buBIGzhu5dpIFt7c3RhdHVzfV0gW3N1Y2Nlc3M6IHtzdWNjZXNzfV0ge21lc3NhZ2V9IikKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyBwaOG6o2kgSlNPTiwgaGnhu4NuIHRo4buLIHRleHQgdGjDtAogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkFQSSB0cuG6oyB24buBIGzhu5dpIHtyZXNwb25zZS5zdGF0dXNfY29kZX06IHtlcnJvcl9tc2d9IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu41pIEFQSToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBfY3VybF9jZmZpX3JlcXVlc3Qoc2VsZiwgdXJsOiBzdHIsIG1ldGhvZDogc3RyID0gImdldCIsIGhlYWRlcnM6IERpY3Rbc3RyLCBzdHJdID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogRGljdFtzdHIsIEFueV0gPSBOb25lLCB0aW1lb3V0OiBpbnQgPSAzMCkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gcmVxdWVzdCBz4butIGThu6VuZyBjdXJsX2NmZmkgKGhp4buHdSBxdeG6oyBjaG8gQ2xvdWRmbGFyZSkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG1ldGhvZC5sb3dlcigpID09ICJnZXQiOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjdXJsX3JlcXVlc3RzLmdldCgKICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgIGRhdGE9ZGF0YSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQsCiAgICAgICAgICAgICAgICAgICAgaW1wZXJzb25hdGU9ImNocm9tZTExMCIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxzZTogICMgUE9TVAogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjdXJsX3JlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycywKICAgICAgICAgICAgICAgICAgICBkYXRhPWRhdGEsCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0LAogICAgICAgICAgICAgICAgICAgIGltcGVyc29uYXRlPSJjaHJvbWUxMTAiCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBzdGF0dXMgY29kZToge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu41pIEFQSToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgIGRlZiBmZXRjaF9nb2xpa2VfcmVwb3J0KHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IHThu6sgR29MaWtlIHbDoCB04buVbmcgaOG7o3AgbOG6oWkKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogVGjDtG5nIHRpbiByZXBvcnQgxJHDoyB04buVbmcgaOG7o3AgaG/hurdjIGRpY3QgcuG7l25nIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBH4buNaSBBUEkgcmVwb3J0CiAgICAgICAgICAgIHJlcG9ydF9kYXRhID0gc2VsZi5hcGlfcmVxdWVzdCgic3RhdGlzdGljcy9yZXBvcnQiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHJlcG9ydF9kYXRhIG9yICJzdWNjZXNzIiBub3QgaW4gcmVwb3J0X2RhdGEgb3Igbm90IHJlcG9ydF9kYXRhWyJzdWNjZXNzIl06CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCB04burIEdvTGlrZSIpCiAgICAgICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFThu5VuZyBo4bujcCB0aMO0bmcgdGluCiAgICAgICAgICAgIGN1cnJlbnRfY29pbiA9IHJlcG9ydF9kYXRhLmdldCgiY3VycmVudF9jb2luIiwgMCkKICAgICAgICAgICAgbWVzc2FnZSA9IHJlcG9ydF9kYXRhLmdldCgibWVzc2FnZSIsICIiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw61uaCB04buVbmcgcGVuZGluZ19jb2luIHbDoCBob2xkX2NvaW4gdOG7qyBjw6FjIGFwcCBxdWFuIHTDom0KICAgICAgICAgICAgYXBwcyA9IFsiaW5zdGFncmFtIiwgInRpa3RvayIsICJzbmFwY2hhdCJdCiAgICAgICAgICAgIHRvdGFsX3BlbmRpbmdfY29pbiA9IDAKICAgICAgICAgICAgdG90YWxfaG9sZF9jb2luID0gMAogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGFwcCBpbiBhcHBzOgogICAgICAgICAgICAgICAgaWYgYXBwIGluIHJlcG9ydF9kYXRhOgogICAgICAgICAgICAgICAgICAgIGFwcF9kYXRhID0gcmVwb3J0X2RhdGFbYXBwXQogICAgICAgICAgICAgICAgICAgIHRvdGFsX3BlbmRpbmdfY29pbiArPSBhcHBfZGF0YS5nZXQoInBlbmRpbmdfY29pbiIsIDApCiAgICAgICAgICAgICAgICAgICAgdG90YWxfaG9sZF9jb2luICs9IGFwcF9kYXRhLmdldCgiaG9sZF9jb2luIiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6oW8gZGljdCBr4bq/dCBxdeG6oyB04buVbmcgaOG7o3AKICAgICAgICAgICAgc3VtbWFyeSA9IHsKICAgICAgICAgICAgICAgICJjdXJyZW50X2NvaW4iOiBjdXJyZW50X2NvaW4sCiAgICAgICAgICAgICAgICAidG90YWxfcGVuZGluZ19jb2luIjogdG90YWxfcGVuZGluZ19jb2luLAogICAgICAgICAgICAgICAgInRvdGFsX2hvbGRfY29pbiI6IHRvdGFsX2hvbGRfY29pbiwKICAgICAgICAgICAgICAgICJnb2xpa2VfcmVwb3J0X21lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAgICAgImdvbGlrZV9yZXBvcnRfdXBkYXRlZF9hdCI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgc2VsZi5kYi5zZXQoImdvbGlrZV9yZXBvcnQiLCBzdW1tYXJ5KQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IHRow7RuZyB0aW4gR29MaWtlIHJlcG9ydDogeHUgaGnhu4duIHThuqFpPXtjdXJyZW50X2NvaW59LCB4dSDEkWFuZyBjaOG7nT17dG90YWxfcGVuZGluZ19jb2lufSwgeHUgZ2nhu689e3RvdGFsX2hvbGRfY29pbn0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHN1bW1hcnkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCB04burIEdvTGlrZToge2V9IikKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIAogICAgZGVmIHN0YXJ0X3JlcG9ydF90aHJlYWQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgdGhyZWFkIMSR4buLbmgga+G7syBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCB04burIEdvTGlrZQogICAgICAgICIiIgogICAgICAgICMgS2nhu4NtIHRyYSB0aHJlYWQgxJHDoyBjaOG6oXkgY2jGsGEKICAgICAgICBpZiBzZWxmLnJlcG9ydF90aHJlYWQgaXMgbm90IE5vbmUgYW5kIHNlbGYucmVwb3J0X3RocmVhZC5pc19hbGl2ZSgpOgogICAgICAgICAgICBsb2dnZXIuaW5mbygiVGhyZWFkIHJlcG9ydCBHb0xpa2UgxJHDoyDEkWFuZyBjaOG6oXkiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgaW1wb3J0IHRocmVhZGluZwogICAgICAgIAogICAgICAgIGRlZiByZXBvcnRfbG9vcCgpOgogICAgICAgICAgICBsb2dnZXIuaW5mbygiQuG6r3QgxJHhuqd1IHRocmVhZCBs4bqleSB0aMO0bmcgdGluIHJlcG9ydCBHb0xpa2UgxJHhu4tuaCBr4buzIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSDEkcOjIGPDsyBoZWFkZXJzIGNoxrBhCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5pc19nb2xpa2VfYXV0aGVudGljYXRlZCgpOgogICAgICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gcmVwb3J0CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZmV0Y2hfZ29saWtlX3JlcG9ydCgpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkNoxrBhIGPDsyBoZWFkZXJzIEdvTGlrZSwga2jDtG5nIHRo4buDIGzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgdHJvbmcgdGhyZWFkIHJlcG9ydCBHb0xpa2U6IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5n4bunIDEwIHBow7p0CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDYwMCkKICAgICAgICAKICAgICAgICAjIFThuqFvIHbDoCBraOG7n2kgxJHhu5luZyB0aHJlYWQKICAgICAgICBzZWxmLnJlcG9ydF90aHJlYWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1yZXBvcnRfbG9vcCwgZGFlbW9uPVRydWUpCiAgICAgICAgc2VsZi5yZXBvcnRfdGhyZWFkLnN0YXJ0KCkKICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBraOG7n2kgxJHhu5luZyB0aHJlYWQgbOG6pXkgdGjDtG5nIHRpbiByZXBvcnQgR29MaWtlIMSR4buLbmgga+G7syIpCgogICAgZGVmIGdldF9nb2xpa2VfcmVwb3J0KHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRow7RuZyB0aW4gcmVwb3J0IEdvTGlrZSDEkcOjIGzGsHUgdHJvbmcgZGF0YWJhc2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogVGjDtG5nIHRpbiByZXBvcnQgaG/hurdjIGRpY3QgcuG7l25nIG7hur91IGtow7RuZyBjw7MKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5kYi5nZXQoImdvbGlrZV9yZXBvcnQiLCB7fSkK').decode('utf-8'))
