import base64
exec(base64.b64decode('aW1wb3J0IHNxbGl0ZTMKaW1wb3J0IGpzb24KaW1wb3J0IG9zCmltcG9ydCB0aW1lCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IHV1aWQKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgTGlzdCwgT3B0aW9uYWwsIFVuaW9uCmltcG9ydCBjb25maWcKCmNsYXNzIERhdGFiYXNlU2VydmljZToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9wYXRoOiBzdHIgPSAiZGF0YS5kYiIsIGRlZmF1bHRfY29uZmlnX3BhdGg6IHN0ciA9ICJkZWZhdWx0Q29uZmlnLmpzb24iKToKICAgICAgICBzZWxmLmRiX3BhdGggPSBkYl9wYXRoCiAgICAgICAgc2VsZi5kZWZhdWx0X2NvbmZpZ19wYXRoID0gZGVmYXVsdF9jb25maWdfcGF0aAogICAgICAgIHNlbGYubG9jYWwgPSB0aHJlYWRpbmcubG9jYWwoKSAgIyBMxrB1IHRy4buvIHJpw6puZyBjaG8gbeG7l2kgdGhyZWFkCiAgICAgICAgCiAgICAgICAgIyBU4bqhbyBi4bqjbmcgbuG6v3UgY2jGsGEgdOG7k24gdOG6oWkKICAgICAgICBzZWxmLl9pbml0X2RiKCkKICAgICAgICAKICAgIGRlZiBfZ2V0X2Nvbm5lY3Rpb24oc2VsZik6CiAgICAgICAgIiIiTOG6pXkga+G6v3QgbuG7kWkgU1FMaXRlIGNobyB0aHJlYWQgaGnhu4duIHThuqFpIiIiCiAgICAgICAgaWYgbm90IGhhc2F0dHIoc2VsZi5sb2NhbCwgJ2Nvbm4nKSBvciBzZWxmLmxvY2FsLmNvbm4gaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5sb2NhbC5jb25uID0gc3FsaXRlMy5jb25uZWN0KHNlbGYuZGJfcGF0aCkKICAgICAgICByZXR1cm4gc2VsZi5sb2NhbC5jb25uCiAgICAgICAgCiAgICBkZWYgX2luaXRfZGIoc2VsZik6CiAgICAgICAgIiIiS2jhu59pIHThuqFvIGPhuqV1IHRyw7pjIGRhdGFiYXNlIG7hur91IGNoxrBhIHThu5NuIHThuqFpIiIiCiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChzZWxmLmRiX3BhdGgpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgICMgVOG6oW8gYuG6o25nIGNvbmZpZwogICAgICAgIGN1cnNvci5leGVjdXRlKCcnJwogICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGNvbmZpZyAoCiAgICAgICAgICAgIGtleSBURVhUIFBSSU1BUlkgS0VZLAogICAgICAgICAgICB2YWx1ZSBURVhUCiAgICAgICAgKQogICAgICAgICcnJykKICAgICAgICAKICAgICAgICAjIFThuqFvIGLhuqNuZyBhY2NvdW50IHbhu5tpIHV1aWQKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgnJycKICAgICAgICBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBhY2NvdW50cyAoCiAgICAgICAgICAgIGlkIElOVEVHRVIgUFJJTUFSWSBLRVksCiAgICAgICAgICAgIGFjY291bnRfdXVpZCBURVhUIFVOSVFVRSwKICAgICAgICAgICAgYXBwIFRFWFQsCiAgICAgICAgICAgIG5pY2tuYW1lIFRFWFQsCiAgICAgICAgICAgIHVuaXF1ZV9pZCBURVhULAogICAgICAgICAgICB1bmlxdWVfdXNlcm5hbWUgVEVYVCwKICAgICAgICAgICAgc3RhdHVzIFRFWFQsCiAgICAgICAgICAgIGluYWN0aXZlX3JlYXNvbiBURVhULAogICAgICAgICAgICBpc19sb2dpbiBJTlRFR0VSLAogICAgICAgICAgICBhdmF0YXJfdGh1bWIgVEVYVCwKICAgICAgICAgICAgdG90YWxfam9icyBJTlRFR0VSLAogICAgICAgICAgICBqb2JfZW5hYmxlIElOVEVHRVIsCiAgICAgICAgICAgIGpvYl9kaXNhYmxlX3VudGlsIElOVEVHRVIsCiAgICAgICAgICAgIGpvYl90b2RheSBJTlRFR0VSLAogICAgICAgICAgICBqb2JfbWF4X2RheSBJTlRFR0VSLAogICAgICAgICAgICBqb2JzX2RvbmVfaW5fc2Vzc2lvbiBJTlRFR0VSLAogICAgICAgICAgICBtYXhfam9ic19wZXJfc2Vzc2lvbiBJTlRFR0VSLAogICAgICAgICAgICBsYXN0X2pvYl90aW1lIElOVEVHRVIsCiAgICAgICAgICAgIGxhc3RfdXBkYXRlIElOVEVHRVIsCiAgICAgICAgICAgIGNhcmVfdG9kYXkgSU5URUdFUiwKICAgICAgICAgICAgaXNfZ29saWtlX2xpbmtlZCBJTlRFR0VSIERFRkFVTFQgMCwKICAgICAgICAgICAgZ29saWtlX2lkIFRFWFQsCiAgICAgICAgICAgIGRldmljZV9pZCBURVhULAogICAgICAgICAgICBpc19zeW5jIElOVEVHRVIgREVGQVVMVCAwLAogICAgICAgICAgICBkYXRhIFRFWFQKICAgICAgICApCiAgICAgICAgJycnKQogICAgICAgIAogICAgICAgICMgVOG6oW8gYuG6o25nIGpvYnNfaGlzdG9yeSDEkeG7gyBsxrB1IGzhu4tjaCBz4butIGpvYgogICAgICAgIGN1cnNvci5leGVjdXRlKCcnJwogICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGpvYnNfaGlzdG9yeSAoCiAgICAgICAgICAgIGlkIElOVEVHRVIgUFJJTUFSWSBLRVksCiAgICAgICAgICAgIGpvYl91dWlkIFRFWFQgVU5JUVVFLAogICAgICAgICAgICBhY2NvdW50X3V1aWQgVEVYVCwKICAgICAgICAgICAgZGV2aWNlX2lkIFRFWFQsCiAgICAgICAgICAgIGFwcCBURVhULAogICAgICAgICAgICBqb2JfaWQgVEVYVCwKICAgICAgICAgICAgam9iX3R5cGUgVEVYVCwKICAgICAgICAgICAgb2JqZWN0X2lkIFRFWFQsCiAgICAgICAgICAgIGxpbmsgVEVYVCwKICAgICAgICAgICAgc3RhdHVzIElOVEVHRVIgREVGQVVMVCAwLAogICAgICAgICAgICBzdWNjZXNzIElOVEVHRVIgREVGQVVMVCAwLAogICAgICAgICAgICBwcmljZSBSRUFMIERFRkFVTFQgMCwKICAgICAgICAgICAgZXJyb3JfbWVzc2FnZSBURVhULAogICAgICAgICAgICBjcmVhdGVkX2F0IElOVEVHRVIsCiAgICAgICAgICAgIGxhc3RfdXBkYXRlIElOVEVHRVIsCiAgICAgICAgICAgIGlzX3N5bmMgSU5URUdFUiBERUZBVUxUIDAsCiAgICAgICAgICAgIGRhdGEgVEVYVAogICAgICAgICkKICAgICAgICAnJycpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHbDoCB0aMOqbSBj4buZdCBhY2NvdW50X3V1aWQgbuG6v3UgY2jGsGEgdOG7k24gdOG6oWkKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiUFJBR01BIHRhYmxlX2luZm8oYWNjb3VudHMpIikKICAgICAgICBjb2x1bW5zID0gW3Jvd1sxXSBmb3Igcm93IGluIGN1cnNvci5mZXRjaGFsbCgpXQogICAgICAgIGlmICJhY2NvdW50X3V1aWQiIG5vdCBpbiBjb2x1bW5zOgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiQUxURVIgVEFCTEUgYWNjb3VudHMgQUREIENPTFVNTiBhY2NvdW50X3V1aWQgVEVYVCBVTklRVUUiKQogICAgICAgICAgICAjIFThuqFvIFVVSUQgY2hvIGPDoWMgdMOgaSBraG/huqNuIMSRw6MgdOG7k24gdOG6oWkKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBpZCBGUk9NIGFjY291bnRzIikKICAgICAgICAgICAgYWNjb3VudHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50czoKICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBhY2NvdW50WzBdCiAgICAgICAgICAgICAgICBhY2NvdW50X3V1aWQgPSBzdHIodXVpZC51dWlkNCgpKQogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlVQREFURSBhY2NvdW50cyBTRVQgYWNjb3VudF91dWlkID0gPyBXSEVSRSBpZCA9ID8iLCAoYWNjb3VudF91dWlkLCBhY2NvdW50X2lkKSkKICAgICAgICAgICAgcHJpbnQoIsSQw6MgdGjDqm0gY+G7mXQgYWNjb3VudF91dWlkIHbDoG8gYuG6o25nIGFjY291bnRzIHbDoCB04bqhbyBVVUlEIGNobyBjw6FjIHTDoGkga2hv4bqjbiBoaeG7h24gY8OzIikKICAgICAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHbDoCB0aMOqbSBj4buZdCBpc19zeW5jIG7hur91IGNoxrBhIHThu5NuIHThuqFpCiAgICAgICAgaWYgImlzX3N5bmMiIG5vdCBpbiBjb2x1bW5zOgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiQUxURVIgVEFCTEUgYWNjb3VudHMgQUREIENPTFVNTiBpc19zeW5jIElOVEVHRVIgREVGQVVMVCAwIikKICAgICAgICAgICAgcHJpbnQoIsSQw6MgdGjDqm0gY+G7mXQgaXNfc3luYyB2w6BvIGLhuqNuZyBhY2NvdW50cyIpCiAgICAgICAgCiAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgIAogICAgICAgICMgS2jhu59pIHThuqFvIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmggdOG7qyBjb25maWcucHkKICAgICAgICBzZWxmLmluaXRfZGVmYXVsdF9jb25maWcoKQogICAgICAgIAogICAgZGVmIGxvYWRfZGVmYXVsdF9jb25maWcoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIixJDhu41jIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmggdOG7qyBmaWxlIiIiCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc2VsZi5kZWZhdWx0X2NvbmZpZ19wYXRoKToKICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuZGVmYXVsdF9jb25maWdfcGF0aCwgJ3InKSBhcyBmOgogICAgICAgICAgICAgICAgcmV0dXJuIGpzb24ubG9hZChmKQogICAgICAgIHJldHVybiB7fQogICAgICAgIAogICAgZGVmIGdldChzZWxmLCBrZXk6IHN0ciwgZGVmYXVsdD1Ob25lKSAtPiBBbnk6CiAgICAgICAgIiIiTOG6pXkgZ2nDoSB0cuG7iyBj4bqldSBow6xuaCB04burIERCLCBu4bq/dSBraMO0bmcgY8OzIHRow6wgbOG6pXkgdOG7qyBkZWZhdWx0IGNvbmZpZyIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgdmFsdWUgRlJPTSBjb25maWcgV0hFUkUga2V5ID0gPyIsIChrZXksKSkKICAgICAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgIAogICAgICAgIGlmIHJlc3VsdDoKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgduG7gSBraeG7g3UgZOG7ryBsaeG7h3UgcGjDuSBo4bujcAogICAgICAgICAgICB2YWx1ZSA9IHJlc3VsdFswXQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbi5sb2Fkcyh2YWx1ZSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBM4bqleSB04burIGRlZmF1bHQgY29uZmlnCiAgICAgICAgICAgIGRlZmF1bHRfY29uZmlnID0gc2VsZi5sb2FkX2RlZmF1bHRfY29uZmlnKCkKICAgICAgICAgICAgaWYga2V5IGluIGRlZmF1bHRfY29uZmlnOgogICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRfY29uZmlnW2tleV0KICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHQKICAgIAogICAgZGVmIHNldChzZWxmLCBrZXk6IHN0ciwgdmFsdWU6IEFueSkgLT4gYm9vbDoKICAgICAgICAiIiJMxrB1IGdpw6EgdHLhu4sgY+G6pXUgaMOsbmggdsOgbyBEQiIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGThu68gbGnhu4d1IHBo4bupYyB04bqhcCB0aMOgbmggSlNPTgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIChkaWN0LCBsaXN0KSk6CiAgICAgICAgICAgIHZhbHVlID0ganNvbi5kdW1wcyh2YWx1ZSkKICAgICAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgICJJTlNFUlQgT1IgUkVQTEFDRSBJTlRPIGNvbmZpZyAoa2V5LCB2YWx1ZSkgVkFMVUVTICg/LCA/KSIsCiAgICAgICAgICAgICAgICAoa2V5LCB2YWx1ZSkKICAgICAgICAgICAgKQogICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBsxrB1IGPhuqV1IGjDrG5oOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGRlbGV0ZShzZWxmLCBrZXk6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiJYw7NhIG3hu5l0IGPhuqV1IGjDrG5oIGto4buPaSBkYXRhYmFzZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGtleTogS2jDs2EgY+G6pXUgaMOsbmggY+G6p24geMOzYQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiREVMRVRFIEZST00gY29uZmlnIFdIRVJFIGtleSA9ID8iLCAoa2V5LCkpCiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHjDs2EgY+G6pXUgaMOsbmgge2tleX06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgc2F2ZV9kZXZpY2VfaW5mbyhzZWxmLCBkZXZpY2VfaW5mbzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiTMawdSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iyB2w6BvIGPhuqV1IGjDrG5oIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuc2V0KCJkZXZpY2VfaW5mbyIsIGRldmljZV9pbmZvKQogICAgCiAgICBkZWYgZ2V0X2RldmljZV9pbmZvKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIkzhuqV5IHRow7RuZyB0aW4gdGhp4bq/dCBi4buLIMSRw6MgbMawdSIiIgogICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXQoImRldmljZV9pbmZvIiwge30pCiAgICAgICAgcmV0dXJuIGRldmljZV9pbmZvCiAgICAKICAgIGRlZiBhZGRfYWNjb3VudChzZWxmLCBhY2NvdW50X2RhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIlRow6ptIHTDoGkga2hv4bqjbiBt4bubaSB2w6BvIGRhdGFiYXNlIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgIyBJbXBvcnQgY29uZmlnIG1vZHVsZQogICAgICAgIGltcG9ydCBjb25maWcgYXMgY29uZmlnX21vZHVsZQogICAgICAgIAogICAgICAgICMgTuG6v3Uga2jDtG5nIGPDsyBkZXZpY2VfaWQsIHPhu60gZOG7pW5nIGRldmljZV9pZCBoaeG7h24gdOG6oWkKICAgICAgICBkZXZpY2VfaWQgPSBhY2NvdW50X2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgIGlmIG5vdCBkZXZpY2VfaWQ6CiAgICAgICAgICAgIGRldmljZV9pZCA9IHNlbGYuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgIAogICAgICAgICMgVMOhY2ggZOG7ryBsaeG7h3UgY2jDrW5oIHbDoCBk4buvIGxp4buHdSBwaOG7pQogICAgICAgIG1haW5fZGF0YSA9IHsKICAgICAgICAgICAgImFwcCI6IGFjY291bnRfZGF0YS5nZXQoImFwcCIsICIiKSwKICAgICAgICAgICAgIm5pY2tuYW1lIjogYWNjb3VudF9kYXRhLmdldCgibmlja25hbWUiLCAiIiksCiAgICAgICAgICAgICJ1bmlxdWVfaWQiOiBhY2NvdW50X2RhdGEuZ2V0KCJ1bmlxdWVfaWQiLCAiIiksCiAgICAgICAgICAgICJ1bmlxdWVfdXNlcm5hbWUiOiBhY2NvdW50X2RhdGEuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiLCAiIiksCiAgICAgICAgICAgICJzdGF0dXMiOiBhY2NvdW50X2RhdGEuZ2V0KCJzdGF0dXMiLCAiaW5hY3RpdmUiKSwKICAgICAgICAgICAgImluYWN0aXZlX3JlYXNvbiI6IGFjY291bnRfZGF0YS5nZXQoImluYWN0aXZlX3JlYXNvbiIsICIiKSwKICAgICAgICAgICAgImlzX2xvZ2luIjogMSBpZiBhY2NvdW50X2RhdGEuZ2V0KCJpc19sb2dpbiIsIEZhbHNlKSBlbHNlIDAsCiAgICAgICAgICAgICJhdmF0YXJfdGh1bWIiOiBhY2NvdW50X2RhdGEuZ2V0KCJhdmF0YXJfdGh1bWIiLCAiIiksCiAgICAgICAgICAgICJ0b3RhbF9qb2JzIjogYWNjb3VudF9kYXRhLmdldCgidG90YWxfam9icyIsIDApLAogICAgICAgICAgICAiam9iX2VuYWJsZSI6IDEgaWYgYWNjb3VudF9kYXRhLmdldCgiam9iX2VuYWJsZSIsIEZhbHNlKSBlbHNlIDAsCiAgICAgICAgICAgICJqb2JfZGlzYWJsZV91bnRpbCI6IGFjY291bnRfZGF0YS5nZXQoImpvYl9kaXNhYmxlX3VudGlsIiwgMCksCiAgICAgICAgICAgICJqb2JfdG9kYXkiOiBhY2NvdW50X2RhdGEuZ2V0KCJqb2JfdG9kYXkiLCAwKSwKICAgICAgICAgICAgImpvYl9tYXhfZGF5IjogYWNjb3VudF9kYXRhLmdldCgiam9iX21heF9kYXkiLCBjb25maWdfbW9kdWxlLk1BWF9KT0JTX1BFUl9EQVkpLAogICAgICAgICAgICAiam9ic19kb25lX2luX3Nlc3Npb24iOiBhY2NvdW50X2RhdGEuZ2V0KCJqb2JzX2RvbmVfaW5fc2Vzc2lvbiIsIDApLAogICAgICAgICAgICAibWF4X2pvYnNfcGVyX3Nlc3Npb24iOiBhY2NvdW50X2RhdGEuZ2V0KCJtYXhfam9ic19wZXJfc2Vzc2lvbiIsIGNvbmZpZ19tb2R1bGUuTUFYX0pPQlNfUEVSX1NFU1NJT04pLAogICAgICAgICAgICAibGFzdF9qb2JfdGltZSI6IGFjY291bnRfZGF0YS5nZXQoImxhc3Rfam9iX3RpbWUiLCAwKSwKICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogaW50KHRpbWUudGltZSgpKSwKICAgICAgICAgICAgImNhcmVfdG9kYXkiOiBhY2NvdW50X2RhdGEuZ2V0KCJjYXJlX3RvZGF5IiwgMCksCiAgICAgICAgICAgICJpc19nb2xpa2VfbGlua2VkIjogMSBpZiBhY2NvdW50X2RhdGEuZ2V0KCJpc19nb2xpa2VfbGlua2VkIiwgRmFsc2UpIGVsc2UgMCwKICAgICAgICAgICAgImdvbGlrZV9pZCI6IGFjY291bnRfZGF0YS5nZXQoImdvbGlrZV9pZCIsICIiKSwKICAgICAgICAgICAgImRldmljZV9pZCI6IGRldmljZV9pZCwKICAgICAgICAgICAgImlzX3N5bmMiOiAwLCAgIyBN4bq3YyDEkeG7i25oIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICAgICAiYWNjb3VudF91dWlkIjogYWNjb3VudF9kYXRhLmdldCgiYWNjb3VudF91dWlkIiwgc3RyKHV1aWQudXVpZDQoKSkpLCAgIyBU4bqhbyBVVUlEIG7hur91IGNoxrBhIGPDswogICAgICAgIH0KICAgICAgICAKICAgICAgICAjIEzGsHUgSUQgdOG7qyBk4buvIGxp4buHdSDEkeG6p3UgdsOgbyBu4bq/dSBjw7MKICAgICAgICBpZiAiaWQiIGluIGFjY291bnRfZGF0YToKICAgICAgICAgICAgbWFpbl9kYXRhWyJpZCJdID0gYWNjb3VudF9kYXRhWyJpZCJdCiAgICAgICAgCiAgICAgICAgIyBMxrB1IGThu68gbGnhu4d1IHBo4bulIGTGsOG7m2kgZOG6oW5nIEpTT04KICAgICAgICBleHRyYV9kYXRhID0ge2s6IHYgZm9yIGssIHYgaW4gYWNjb3VudF9kYXRhLml0ZW1zKCkgaWYgayBub3QgaW4gbWFpbl9kYXRhfQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgY29sdW1ucyA9ICIsICIuam9pbihtYWluX2RhdGEua2V5cygpKQogICAgICAgICAgICBwbGFjZWhvbGRlcnMgPSAiLCAiLmpvaW4oWyI/Il0gKiBsZW4obWFpbl9kYXRhKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHZhbHVlcyA9IGxpc3QobWFpbl9kYXRhLnZhbHVlcygpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBwaOG7pSB2w6BvIGN14buRaQogICAgICAgICAgICBjb2x1bW5zICs9ICIsIGRhdGEiCiAgICAgICAgICAgIHBsYWNlaG9sZGVycyArPSAiLCA/IgogICAgICAgICAgICB2YWx1ZXMuYXBwZW5kKGpzb24uZHVtcHMoZXh0cmFfZGF0YSkpCiAgICAgICAgICAgIAogICAgICAgICAgICBxdWVyeSA9IGYiSU5TRVJUIE9SIFJFUExBQ0UgSU5UTyBhY2NvdW50cyAoe2NvbHVtbnN9KSBWQUxVRVMgKHtwbGFjZWhvbGRlcnN9KSIKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUocXVlcnksIHZhbHVlcykKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGjDqm0gdMOgaSBraG/huqNuOiB7ZX0iKQogICAgICAgICAgICBjb25uLnJvbGxiYWNrKCkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB1cGRhdGVfYWNjb3VudChzZWxmLCBhY2NvdW50X2lkOiBpbnQsIGRhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIkPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIHTDoGkga2hv4bqjbiIiIgogICAgICAgICMgTOG6pXkgdMOgaSBraG/huqNuIGhp4buHbiB04bqhaQogICAgICAgIGFjY291bnQgPSBzZWxmLmdldF9hY2NvdW50KGFjY291bnRfaWQpCiAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgICMgQ+G6rXAgbmjhuq10IGThu68gbGnhu4d1CiAgICAgICAgYWNjb3VudC51cGRhdGUoZGF0YSkKICAgICAgICBhY2NvdW50WyJsYXN0X3VwZGF0ZSJdID0gaW50KHRpbWUudGltZSgpKQogICAgICAgIAogICAgICAgICMgTMawdSBs4bqhaQogICAgICAgIHJldHVybiBzZWxmLmFkZF9hY2NvdW50KGFjY291bnQpCiAgICAKICAgIGRlZiBnZXRfYWNjb3VudChzZWxmLCBhY2NvdW50X2lkOiBpbnQpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiJM4bqleSB0aMO0bmcgdGluIGPhu6dhIG3hu5l0IHTDoGkga2hv4bqjbiB0aGVvIElEIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCAqIEZST00gYWNjb3VudHMgV0hFUkUgaWQgPSA/IiwgKGFjY291bnRfaWQsKSkKICAgICAgICBjb2x1bW5fbmFtZXMgPSBbZGVzY3JpcHRpb25bMF0gZm9yIGRlc2NyaXB0aW9uIGluIGN1cnNvci5kZXNjcmlwdGlvbl0KICAgICAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgIAogICAgICAgIGlmIG5vdCByZXN1bHQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGvhur90IHF14bqjIHRow6BuaCBkaWN0CiAgICAgICAgYWNjb3VudCA9IHtjb2x1bW5fbmFtZXNbaV06IHJlc3VsdFtpXSBmb3IgaSBpbiByYW5nZShsZW4oY29sdW1uX25hbWVzKSl9CiAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgYm9vbGVhbgogICAgICAgIGFjY291bnRbImlzX2xvZ2luIl0gPSBib29sKGFjY291bnRbImlzX2xvZ2luIl0pCiAgICAgICAgYWNjb3VudFsiam9iX2VuYWJsZSJdID0gYm9vbChhY2NvdW50WyJqb2JfZW5hYmxlIl0pCiAgICAgICAgYWNjb3VudFsiaXNfZ29saWtlX2xpbmtlZCJdID0gYm9vbChhY2NvdW50WyJpc19nb2xpa2VfbGlua2VkIl0pCiAgICAgICAgYWNjb3VudFsiaXNfc3luYyJdID0gYm9vbChhY2NvdW50WyJpc19zeW5jIl0pCiAgICAgICAgCiAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBwaOG7pSB04burIHRyxrDhu51uZyBkYXRhCiAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQgYW5kIGFjY291bnRbImRhdGEiXToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZXh0cmFfZGF0YSA9IGpzb24ubG9hZHMoYWNjb3VudFsiZGF0YSJdKQogICAgICAgICAgICAgICAgYWNjb3VudC51cGRhdGUoZXh0cmFfZGF0YSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAjIFjDs2EgdHLGsOG7nW5nIGRhdGEgxJHhu4MgdHLDoW5oIHRyw7luZyBs4bq3cAogICAgICAgIGlmICJkYXRhIiBpbiBhY2NvdW50OgogICAgICAgICAgICBkZWwgYWNjb3VudFsiZGF0YSJdCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhY2NvdW50CiAgICAKICAgIGRlZiBnZXRfYWNjb3VudF9ieV91dWlkKHNlbGYsIGFjY291bnRfdXVpZDogc3RyKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiTOG6pXkgdGjDtG5nIHRpbiBj4bunYSBt4buZdCB0w6BpIGtob+G6o24gdGhlbyBVVUlEIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCAqIEZST00gYWNjb3VudHMgV0hFUkUgYWNjb3VudF91dWlkID0gPyIsIChhY2NvdW50X3V1aWQsKSkKICAgICAgICBjb2x1bW5fbmFtZXMgPSBbZGVzY3JpcHRpb25bMF0gZm9yIGRlc2NyaXB0aW9uIGluIGN1cnNvci5kZXNjcmlwdGlvbl0KICAgICAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgIAogICAgICAgIGlmIG5vdCByZXN1bHQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGvhur90IHF14bqjIHRow6BuaCBkaWN0CiAgICAgICAgYWNjb3VudCA9IHtjb2x1bW5fbmFtZXNbaV06IHJlc3VsdFtpXSBmb3IgaSBpbiByYW5nZShsZW4oY29sdW1uX25hbWVzKSl9CiAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgYm9vbGVhbgogICAgICAgIGFjY291bnRbImlzX2xvZ2luIl0gPSBib29sKGFjY291bnRbImlzX2xvZ2luIl0pCiAgICAgICAgYWNjb3VudFsiam9iX2VuYWJsZSJdID0gYm9vbChhY2NvdW50WyJqb2JfZW5hYmxlIl0pCiAgICAgICAgYWNjb3VudFsiaXNfZ29saWtlX2xpbmtlZCJdID0gYm9vbChhY2NvdW50WyJpc19nb2xpa2VfbGlua2VkIl0pCiAgICAgICAgYWNjb3VudFsiaXNfc3luYyJdID0gYm9vbChhY2NvdW50WyJpc19zeW5jIl0pCiAgICAgICAgCiAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBwaOG7pSB04burIHRyxrDhu51uZyBkYXRhCiAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQgYW5kIGFjY291bnRbImRhdGEiXToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZXh0cmFfZGF0YSA9IGpzb24ubG9hZHMoYWNjb3VudFsiZGF0YSJdKQogICAgICAgICAgICAgICAgYWNjb3VudC51cGRhdGUoZXh0cmFfZGF0YSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAjIFjDs2EgdHLGsOG7nW5nIGRhdGEgxJHhu4MgdHLDoW5oIHRyw7luZyBs4bq3cAogICAgICAgIGlmICJkYXRhIiBpbiBhY2NvdW50OgogICAgICAgICAgICBkZWwgYWNjb3VudFsiZGF0YSJdCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhY2NvdW50CiAgICAKICAgIGRlZiBnZXRfYWNjb3VudHMoc2VsZiwgYXBwOiBzdHIgPSBOb25lLCBzdGF0dXM6IHN0ciA9IE5vbmUsIGpvYl9lbmFibGU6IGJvb2wgPSBOb25lLCBkZXZpY2VfaWQ6IEFueSA9IFRydWUpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIkzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIHRoZW8gxJFp4buBdSBraeG7h24gbOG7jWMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhcHA6IFTDqm4g4bupbmcgZOG7pW5nIMSR4buDIGzhu41jCiAgICAgICAgICAgIHN0YXR1czogVHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24gxJHhu4MgbOG7jWMKICAgICAgICAgICAgam9iX2VuYWJsZTogTOG7jWMgdGhlbyB0cuG6oW5nIHRow6FpIGLhuq10L3Thuq90IGpvYgogICAgICAgICAgICBkZXZpY2VfaWQ6IEzhu41jIHRoZW8gZGV2aWNlX2lkLCBjw7MgdGjhu4MgbMOgOgogICAgICAgICAgICAgICAgLSBUcnVlOiBM4buNYyB0aGVvIGRldmljZV9pZCBj4bunYSB0aGnhur90IGLhu4sgaGnhu4duIHThuqFpICht4bq3YyDEkeG7i25oKQogICAgICAgICAgICAgICAgLSBGYWxzZS9Ob25lOiBLaMO0bmcgbOG7jWMgdGhlbyBkZXZpY2VfaWQKICAgICAgICAgICAgICAgIC0gQ2h14buXaTogTOG7jWMgdGhlbyBkZXZpY2VfaWQgY+G7pSB0aOG7gyDEkcaw4bujYyB0cnV54buBbiB2w6BvCiAgICAgICAgIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgcXVlcnkgPSAiU0VMRUNUICogRlJPTSBhY2NvdW50cyIKICAgICAgICBwYXJhbXMgPSBbXQogICAgICAgIAogICAgICAgICMgVGjDqm0gxJFp4buBdSBraeG7h24gbOG7jWMKICAgICAgICBjb25kaXRpb25zID0gW10KICAgICAgICBpZiBhcHA6CiAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKCJhcHAgPSA/IikKICAgICAgICAgICAgcGFyYW1zLmFwcGVuZChhcHApCiAgICAgICAgaWYgc3RhdHVzOgogICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZCgic3RhdHVzID0gPyIpCiAgICAgICAgICAgIHBhcmFtcy5hcHBlbmQoc3RhdHVzKQogICAgICAgIGlmIGpvYl9lbmFibGUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKCJqb2JfZW5hYmxlID0gPyIpCiAgICAgICAgICAgIHBhcmFtcy5hcHBlbmQoMSBpZiBqb2JfZW5hYmxlIGVsc2UgMCkKICAgICAgICAgICAgCiAgICAgICAgaWYgY29uZGl0aW9uczoKICAgICAgICAgICAgcXVlcnkgKz0gIiBXSEVSRSAiICsgIiBBTkQgIi5qb2luKGNvbmRpdGlvbnMpCiAgICAgICAgICAgIAogICAgICAgIGN1cnNvci5leGVjdXRlKHF1ZXJ5LCBwYXJhbXMpCiAgICAgICAgY29sdW1uX25hbWVzID0gW2Rlc2NyaXB0aW9uWzBdIGZvciBkZXNjcmlwdGlvbiBpbiBjdXJzb3IuZGVzY3JpcHRpb25dCiAgICAgICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgCiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIGZvciByZXN1bHQgaW4gcmVzdWx0czoKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkga+G6v3QgcXXhuqMgdGjDoG5oIGRpY3QKICAgICAgICAgICAgYWNjb3VudCA9IHtjb2x1bW5fbmFtZXNbaV06IHJlc3VsdFtpXSBmb3IgaSBpbiByYW5nZShsZW4oY29sdW1uX25hbWVzKSl9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBib29sZWFuCiAgICAgICAgICAgIGFjY291bnRbImlzX2xvZ2luIl0gPSBib29sKGFjY291bnRbImlzX2xvZ2luIl0pCiAgICAgICAgICAgIGFjY291bnRbImpvYl9lbmFibGUiXSA9IGJvb2woYWNjb3VudFsiam9iX2VuYWJsZSJdKQogICAgICAgICAgICBhY2NvdW50WyJpc19nb2xpa2VfbGlua2VkIl0gPSBib29sKGFjY291bnRbImlzX2dvbGlrZV9saW5rZWQiXSkKICAgICAgICAgICAgYWNjb3VudFsiaXNfc3luYyJdID0gYm9vbChhY2NvdW50WyJpc19zeW5jIl0pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGThu68gbGnhu4d1IHBo4bulIHThu6sgdHLGsOG7nW5nIGRhdGEKICAgICAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQgYW5kIGFjY291bnRbImRhdGEiXToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBleHRyYV9kYXRhID0ganNvbi5sb2FkcyhhY2NvdW50WyJkYXRhIl0pCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudC51cGRhdGUoZXh0cmFfZGF0YSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBYw7NhIHRyxrDhu51uZyBkYXRhIMSR4buDIHRyw6FuaCB0csO5bmcgbOG6t3AKICAgICAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQ6CiAgICAgICAgICAgICAgICBkZWwgYWNjb3VudFsiZGF0YSJdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKGFjY291bnQpCiAgICAgICAgCiAgICAgICAgIyBM4buNYyB0aGVvIGRldmljZV9pZCBu4bq/dSBj4bqnbgogICAgICAgIGlmIGRldmljZV9pZCBpcyBUcnVlOgogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZCBj4bunYSB0aGnhur90IGLhu4sgaGnhu4duIHThuqFpCiAgICAgICAgICAgIGN1cnJlbnRfZGV2aWNlX2lkID0gc2VsZi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgY3VycmVudF9kZXZpY2VfaWQ6CiAgICAgICAgICAgICAgICAjIEzhu41jIHTDoGkga2hv4bqjbiB0aGVvIGRldmljZV9pZCBj4bunYSB0aGnhur90IGLhu4sgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICBhY2NvdW50cyA9IFthY2MgZm9yIGFjYyBpbiBhY2NvdW50cyBpZiBhY2MuZ2V0KCJkZXZpY2VfaWQiKSA9PSBjdXJyZW50X2RldmljZV9pZF0KICAgICAgICBlbGlmIGlzaW5zdGFuY2UoZGV2aWNlX2lkLCBzdHIpIGFuZCBkZXZpY2VfaWQ6CiAgICAgICAgICAgICMgTOG7jWMgdGhlbyBkZXZpY2VfaWQgY+G7pSB0aOG7gyDEkcaw4bujYyB0cnV54buBbiB2w6BvCiAgICAgICAgICAgIGFjY291bnRzID0gW2FjYyBmb3IgYWNjIGluIGFjY291bnRzIGlmIGFjYy5nZXQoImRldmljZV9pZCIpID09IGRldmljZV9pZF0KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGFjY291bnRzCiAgICAKICAgIGRlZiBkZWxldGVfYWNjb3VudChzZWxmLCBhY2NvdW50X2lkOiBpbnQpIC0+IGJvb2w6CiAgICAgICAgIiIiWMOzYSB0w6BpIGtob+G6o24ga2jhu49pIGRhdGFiYXNlIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiREVMRVRFIEZST00gYWNjb3VudHMgV0hFUkUgaWQgPSA/IiwgKGFjY291bnRfaWQsKSkKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICByZXR1cm4gY3Vyc29yLnJvd2NvdW50ID4gMAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgeMOzYSB0w6BpIGtob+G6o246IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgIiIixJDDs25nIGvhur90IG7hu5FpIGRhdGFiYXNlIGPhu6dhIHRocmVhZCBoaeG7h24gdOG6oWkiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZi5sb2NhbCwgJ2Nvbm4nKSBhbmQgc2VsZi5sb2NhbC5jb25uOgogICAgICAgICAgICAgICAgc2VsZi5sb2NhbC5jb25uLmNsb3NlKCkKICAgICAgICAgICAgICAgIHNlbGYubG9jYWwuY29ubiA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDs2EgY8OhYyB0aGFtIGNoaeG6v3UgdGhyZWFkIMSR4buDIHRyw6FuaCBs4buXaQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdsb2NhbCcpOgogICAgICAgICAgICAgICAgaWYgaGFzYXR0cihzZWxmLmxvY2FsLCAnX2xvY2FsX19pbXBsJyk6CiAgICAgICAgICAgICAgICAgICAgIyBYw7NhIHRoYW0gY2hp4bq/dSB0cm9uZyBUaHJlYWRMb2NhbAogICAgICAgICAgICAgICAgICAgIGRlbGF0dHIoc2VsZi5sb2NhbCwgJ19sb2NhbF9faW1wbCcpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSDEkcOzbmcga+G6v3QgbuG7kWkgZGF0YWJhc2U6IHtlfSIpCiAgICAgICAgICAgIAogICAgZGVmIF9fZGVsX18oc2VsZik6CiAgICAgICAgIiIiSOG7p3kgxJHhu5FpIHTGsOG7o25nIiIiCiAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAKICAgIGRlZiB1cGRhdGVfb3JfaW5zZXJ0X2FjY291bnQoc2VsZiwgYXBwX25hbWU6IHN0ciwgdW5pcXVlX2lkOiBzdHIsIGRhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEPhuq1wIG5o4bqtdCBob+G6t2MgdGjDqm0gbeG7m2kgbeG7mXQgdMOgaSBraG/huqNuIHbDoG8gZGF0YWJhc2UKICAgICAgICAiIiIKICAgICAgICAjIMSQ4bqjbSBi4bqjbyBjb25uZWN0aW9uIGzDoCBj4bunYSB0aHJlYWQgaGnhu4duIHThuqFpCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdMOgaSBraG/huqNuIMSRw6MgdOG7k24gdOG6oWkgY2jGsGEKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAiIiJTRUxFQ1QgaWQgRlJPTSBhY2NvdW50cyBXSEVSRSBhcHBfbmFtZSA9ID8gQU5EIHVuaXF1ZV9pZCA9ID8iIiIsIAogICAgICAgICAgICAgICAgKGFwcF9uYW1lLCB1bmlxdWVfaWQpCiAgICAgICAgICAgICkKICAgICAgICAgICAgYWNjb3VudCA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBhY2NvdW50OgogICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIGhp4buHbiBjw7MKICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBhY2NvdW50WzBdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgZOG7ryBsaeG7h3UgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgICAgICAiIiJTRUxFQ1QgZGF0YSBGUk9NIGFjY291bnRzIFdIRVJFIGlkID0gPyIiIiwKICAgICAgICAgICAgICAgICAgICAoYWNjb3VudF9pZCwpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBjdXJyZW50X2RhdGFfcm93ID0gY3Vyc29yLmZldGNob25lKCkKICAgICAgICAgICAgICAgIGN1cnJlbnRfZGF0YSA9IGpzb24ubG9hZHMoY3VycmVudF9kYXRhX3Jvd1swXSkgaWYgY3VycmVudF9kYXRhX3JvdyBlbHNlIHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgSOG7o3AgbmjhuqV0IGThu68gbGnhu4d1IGPFqSB2w6AgbeG7m2kKICAgICAgICAgICAgICAgIG1lcmdlZF9kYXRhID0geyoqY3VycmVudF9kYXRhLCAqKmRhdGF9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10CiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgICAgICAiIiJVUERBVEUgYWNjb3VudHMgU0VUIAogICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSA/LAogICAgICAgICAgICAgICAgICAgICAgIG5pY2tuYW1lID0gPywKICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSA/LAogICAgICAgICAgICAgICAgICAgICAgIGlzX2xvZ2luID0gPywKICAgICAgICAgICAgICAgICAgICAgICBqb2JfZW5hYmxlID0gPywKICAgICAgICAgICAgICAgICAgICAgICBqb2JfbWF4X2RheSA9ID8sCiAgICAgICAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGUgPSA/CiAgICAgICAgICAgICAgICAgICAgICAgV0hFUkUgaWQgPSA/IiIiLAogICAgICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICAgICAganNvbi5kdW1wcyhtZXJnZWRfZGF0YSksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZ2V0KCJuaWNrbmFtZSIsICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5nZXQoInN0YXR1cyIsICJhY3RpdmUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgMSBpZiBkYXRhLmdldCgiaXNfbG9naW4iLCBGYWxzZSkgZWxzZSAwLAogICAgICAgICAgICAgICAgICAgICAgICAxIGlmIGRhdGEuZ2V0KCJqb2JfZW5hYmxlIiwgVHJ1ZSkgZWxzZSAwLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmdldCgiam9iX21heF9kYXkiLCBjb25maWcuTUFYX0pPQlNfUEVSX0RBWSksCiAgICAgICAgICAgICAgICAgICAgICAgIGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRfaWQKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRow6ptIHTDoGkga2hv4bqjbiBt4bubaQogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAgICAgIiIiSU5TRVJUIElOVE8gYWNjb3VudHMgKAogICAgICAgICAgICAgICAgICAgICAgIGFwcF9uYW1lLCB1bmlxdWVfaWQsIG5pY2tuYW1lLCBkYXRhLCBzdGF0dXMsIGlzX2xvZ2luLCBqb2JfZW5hYmxlLCBqb2JfbWF4X2RheSwgaXNfZ29saWtlX2xpbmtlZCwgZ29saWtlX2lkLCBsYXN0X3VwZGF0ZQogICAgICAgICAgICAgICAgICAgICkgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/KSIiIiwKICAgICAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAgICAgIGFwcF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZ2V0KCJuaWNrbmFtZSIsICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAganNvbi5kdW1wcyhkYXRhKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5nZXQoInN0YXR1cyIsICJhY3RpdmUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgMSBpZiBkYXRhLmdldCgiaXNfbG9naW4iLCBGYWxzZSkgZWxzZSAwLAogICAgICAgICAgICAgICAgICAgICAgICAxIGlmIGRhdGEuZ2V0KCJqb2JfZW5hYmxlIiwgVHJ1ZSkgZWxzZSAwLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmdldCgiam9iX21heF9kYXkiLCBjb25maWcuTUFYX0pPQlNfUEVSX0RBWSksCiAgICAgICAgICAgICAgICAgICAgICAgIDAsICAjIGlzX2dvbGlrZV9saW5rZWQKICAgICAgICAgICAgICAgICAgICAgICAgIiIsICMgZ29saWtlX2lkCiAgICAgICAgICAgICAgICAgICAgICAgIGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgY+G6rXAgbmjhuq10L3Row6ptIHTDoGkga2hv4bqjbjoge2V9IikKICAgICAgICAgICAgY29ubi5yb2xsYmFjaygpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgcmVzZXRfbG9naW5fc3RhdHVzX2J5X2FwcChzZWxmLCBhcHBfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQ4bq3dCBs4bqhaSB0cuG6oW5nIHRow6FpIGxvZ2luIGNobyB04bqldCBj4bqjIHTDoGkga2hv4bqjbiBj4bunYSBt4buZdCDhu6luZyBk4bulbmcKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhcHBfbmFtZTogVMOqbiDhu6luZyBk4bulbmcgKGFwcCwga2jDtG5nIHBo4bqjaSBhcHBfbmFtZSkKICAgICAgICAiIiIKICAgICAgICAjIMSQ4bqjbSBi4bqjbyBjb25uZWN0aW9uIGzDoCBj4bunYSB0aHJlYWQgaGnhu4duIHThuqFpCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhurd0IGzhuqFpIHRy4bqhbmcgdGjDoWkgbG9naW4gY2hvIHThuqV0IGPhuqMgdMOgaSBraG/huqNuCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICAgICAgICAgIiIiVVBEQVRFIGFjY291bnRzIFNFVCBpc19sb2dpbiA9IDAgV0hFUkUgYXBwID0gPyIiIiwKICAgICAgICAgICAgICAgIChhcHBfbmFtZSwpCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ8WpbmcgY+G6rXAgbmjhuq10IHRyxrDhu51uZyBpc19sb2dpbiB0cm9uZyBkYXRhIEpTT04KICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAiIiJTRUxFQ1QgaWQsIGRhdGEgRlJPTSBhY2NvdW50cyBXSEVSRSBhcHAgPSA/IiIiLAogICAgICAgICAgICAgICAgKGFwcF9uYW1lLCkKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgYWNjb3VudHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50czoKICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBhY2NvdW50WzBdCiAgICAgICAgICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhhY2NvdW50WzFdKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIGxvZ2luIHRyb25nIGRhdGEKICAgICAgICAgICAgICAgIGRhdGFbImlzX2xvZ2luIl0gPSBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzGsHUgbOG6oWkgZGF0YQogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAgICAgIiIiVVBEQVRFIGFjY291bnRzIFNFVCBkYXRhID0gPyBXSEVSRSBpZCA9ID8iIiIsCiAgICAgICAgICAgICAgICAgICAgKGpzb24uZHVtcHMoZGF0YSksIGFjY291bnRfaWQpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHhurd0IGzhuqFpIHRy4bqhbmcgdGjDoWkgbG9naW46IHtlfSIpCiAgICAgICAgICAgIGNvbm4ucm9sbGJhY2soKQogICAgICAgICAgICByZXR1cm4gRmFsc2UgCgogICAgZGVmIGFkZF9qb2JfaGlzdG9yeShzZWxmLCBqb2JfZGF0YTogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBUaMOqbSBt4buZdCBi4bqjbiBnaGkgbOG7i2NoIHPhu60gam9iIG3hu5tpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgam9iX2RhdGE6IEThu68gbGnhu4d1IGpvYiBj4bqnbiBsxrB1CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVVJRCBj4bunYSBqb2IgxJHDoyB0aMOqbQogICAgICAgICIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgIGN1cnJlbnRfdGltZSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICBqb2JfdXVpZCA9IGpvYl9kYXRhLmdldCgiam9iX3V1aWQiLCBzdHIodXVpZC51dWlkNCgpKSkKICAgICAgICAKICAgICAgICAjIE7hur91IGtow7RuZyBjw7MgZGV2aWNlX2lkLCBz4butIGThu6VuZyBkZXZpY2VfaWQgaGnhu4duIHThuqFpCiAgICAgICAgZGV2aWNlX2lkID0gam9iX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgIGlmIG5vdCBkZXZpY2VfaWQ6CiAgICAgICAgICAgIGRldmljZV9pZCA9IHNlbGYuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgIAogICAgICAgICMgVMOhY2ggZOG7ryBsaeG7h3UgY2jDrW5oIHbDoCBk4buvIGxp4buHdSBwaOG7pQogICAgICAgIG1haW5fZGF0YSA9IHsKICAgICAgICAgICAgImpvYl91dWlkIjogam9iX3V1aWQsCiAgICAgICAgICAgICJhY2NvdW50X3V1aWQiOiBqb2JfZGF0YS5nZXQoImFjY291bnRfdXVpZCIsICIiKSwKICAgICAgICAgICAgImRldmljZV9pZCI6IGRldmljZV9pZCwKICAgICAgICAgICAgImFwcCI6IGpvYl9kYXRhLmdldCgiYXBwIiwgIiIpLAogICAgICAgICAgICAiam9iX2lkIjogam9iX2RhdGEuZ2V0KCJqb2JfaWQiLCAiIiksCiAgICAgICAgICAgICJqb2JfdHlwZSI6IGpvYl9kYXRhLmdldCgiam9iX3R5cGUiLCAiIiksCiAgICAgICAgICAgICJvYmplY3RfaWQiOiBqb2JfZGF0YS5nZXQoIm9iamVjdF9pZCIsICIiKSwKICAgICAgICAgICAgImxpbmsiOiBqb2JfZGF0YS5nZXQoImxpbmsiLCAiIiksCiAgICAgICAgICAgICJzdGF0dXMiOiBqb2JfZGF0YS5nZXQoInN0YXR1cyIsIDApLAogICAgICAgICAgICAic3VjY2VzcyI6IDEgaWYgam9iX2RhdGEuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpIGVsc2UgMCwKICAgICAgICAgICAgInByaWNlIjogam9iX2RhdGEuZ2V0KCJwcmljZSIsIDAuMCksCiAgICAgICAgICAgICJlcnJvcl9tZXNzYWdlIjogam9iX2RhdGEuZ2V0KCJlcnJvcl9tZXNzYWdlIiwgIiIpLAogICAgICAgICAgICAiY3JlYXRlZF9hdCI6IGpvYl9kYXRhLmdldCgiY3JlYXRlZF9hdCIsIGN1cnJlbnRfdGltZSksCiAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGN1cnJlbnRfdGltZSwKICAgICAgICAgICAgImlzX3N5bmMiOiAwICAjIE3hurdjIMSR4buLbmggY2jGsGEgxJHhu5NuZyBi4buZCiAgICAgICAgfQogICAgICAgIAogICAgICAgICMgTMawdSBJRCB04burIGThu68gbGnhu4d1IMSR4bqndSB2w6BvIG7hur91IGPDswogICAgICAgIGlmICJpZCIgaW4gam9iX2RhdGE6CiAgICAgICAgICAgIG1haW5fZGF0YVsiaWQiXSA9IGpvYl9kYXRhWyJpZCJdCiAgICAgICAgCiAgICAgICAgIyBMxrB1IGThu68gbGnhu4d1IHBo4bulIGTGsOG7m2kgZOG6oW5nIEpTT04KICAgICAgICBleHRyYV9kYXRhID0ge2s6IHYgZm9yIGssIHYgaW4gam9iX2RhdGEuaXRlbXMoKSBpZiBrIG5vdCBpbiBtYWluX2RhdGEgYW5kIGsgIT0gImRhdGEifQogICAgICAgIGlmICJkYXRhIiBpbiBqb2JfZGF0YSBhbmQgaXNpbnN0YW5jZShqb2JfZGF0YVsiZGF0YSJdLCBkaWN0KToKICAgICAgICAgICAgZXh0cmFfZGF0YS51cGRhdGUoam9iX2RhdGFbImRhdGEiXSkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbHVtbnMgPSAiLCAiLmpvaW4obWFpbl9kYXRhLmtleXMoKSkKICAgICAgICAgICAgcGxhY2Vob2xkZXJzID0gIiwgIi5qb2luKFsiPyJdICogbGVuKG1haW5fZGF0YSkpCiAgICAgICAgICAgIAogICAgICAgICAgICB2YWx1ZXMgPSBsaXN0KG1haW5fZGF0YS52YWx1ZXMoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gZOG7ryBsaeG7h3UgcGjhu6UgdsOgbyBjdeG7kWkKICAgICAgICAgICAgY29sdW1ucyArPSAiLCBkYXRhIgogICAgICAgICAgICBwbGFjZWhvbGRlcnMgKz0gIiwgPyIKICAgICAgICAgICAgdmFsdWVzLmFwcGVuZChqc29uLmR1bXBzKGV4dHJhX2RhdGEpKQogICAgICAgICAgICAKICAgICAgICAgICAgcXVlcnkgPSBmIklOU0VSVCBPUiBSRVBMQUNFIElOVE8gam9ic19oaXN0b3J5ICh7Y29sdW1uc30pIFZBTFVFUyAoe3BsYWNlaG9sZGVyc30pIgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZShxdWVyeSwgdmFsdWVzKQogICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgIHJldHVybiBqb2JfdXVpZAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGjDqm0gbOG7i2NoIHPhu60gam9iOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gIiIKICAgIAogICAgZGVmIHVwZGF0ZV9qb2JfaGlzdG9yeShzZWxmLCBqb2JfdXVpZDogc3RyLCBkYXRhOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiBs4buLY2ggc+G7rSBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2JfdXVpZDogVVVJRCBj4bunYSBqb2IgY+G6p24gY+G6rXAgbmjhuq10CiAgICAgICAgICAgIGRhdGE6IEThu68gbGnhu4d1IGPhuq1wIG5o4bqtdAogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IGPhuq1wIG5o4bqtdCB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgICMgTOG6pXkgam9iIGhp4buHbiB04bqhaQogICAgICAgIGpvYiA9IHNlbGYuZ2V0X2pvYl9oaXN0b3J5KGpvYl91dWlkKQogICAgICAgIGlmIG5vdCBqb2I6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgICMgQ+G6rXAgbmjhuq10IGThu68gbGnhu4d1CiAgICAgICAgam9iLnVwZGF0ZShkYXRhKQogICAgICAgIGpvYlsibGFzdF91cGRhdGUiXSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAKICAgICAgICAjIEzGsHUgbOG6oWkKICAgICAgICByZXR1cm4gYm9vbChzZWxmLmFkZF9qb2JfaGlzdG9yeShqb2IpKQogICAgCiAgICBkZWYgZ2V0X2pvYl9oaXN0b3J5KHNlbGYsIGpvYl91dWlkOiBzdHIpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIGzhu4tjaCBz4butIGpvYiB0aGVvIFVVSUQKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2JfdXVpZDogVVVJRCBj4bunYSBqb2IgY+G6p24gbOG6pXkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdCBob+G6t2MgTm9uZTogVGjDtG5nIHRpbiBqb2IgbuG6v3UgdMOsbSB0aOG6pXksIE5vbmUgbuG6v3Uga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCAqIEZST00gam9ic19oaXN0b3J5IFdIRVJFIGpvYl91dWlkID0gPyIsIChqb2JfdXVpZCwpKQogICAgICAgIGNvbHVtbl9uYW1lcyA9IFtkZXNjcmlwdGlvblswXSBmb3IgZGVzY3JpcHRpb24gaW4gY3Vyc29yLmRlc2NyaXB0aW9uXQogICAgICAgIHJlc3VsdCA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHJlc3VsdDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkga+G6v3QgcXXhuqMgdGjDoG5oIGRpY3QKICAgICAgICBqb2IgPSB7Y29sdW1uX25hbWVzW2ldOiByZXN1bHRbaV0gZm9yIGkgaW4gcmFuZ2UobGVuKGNvbHVtbl9uYW1lcykpfQogICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGPDoWMgdHLGsOG7nW5nIGJvb2xlYW4KICAgICAgICBqb2JbInN1Y2Nlc3MiXSA9IGJvb2woam9iWyJzdWNjZXNzIl0pCiAgICAgICAgam9iWyJpc19zeW5jIl0gPSBib29sKGpvYlsiaXNfc3luYyJdKQogICAgICAgIAogICAgICAgICMgVGjDqm0gZOG7ryBsaeG7h3UgcGjhu6UgdOG7qyB0csaw4budbmcgZGF0YQogICAgICAgIGlmICJkYXRhIiBpbiBqb2IgYW5kIGpvYlsiZGF0YSJdOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBleHRyYV9kYXRhID0ganNvbi5sb2Fkcyhqb2JbImRhdGEiXSkKICAgICAgICAgICAgICAgIGpvYi51cGRhdGUoZXh0cmFfZGF0YSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAjIFjDs2EgdHLGsOG7nW5nIGRhdGEgxJHhu4MgdHLDoW5oIHRyw7luZyBs4bq3cAogICAgICAgIGlmICJkYXRhIiBpbiBqb2I6CiAgICAgICAgICAgIGRlbCBqb2JbImRhdGEiXQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gam9iCiAgICAKICAgIGRlZiBnZXRfam9iX2hpc3RvcnlfYnlfYWNjb3VudChzZWxmLCBhY2NvdW50X3V1aWQ6IHN0ciwgbGltaXQ6IGludCA9IDUwKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBs4buLY2ggc+G7rSBqb2IgY+G7p2EgbeG7mXQgdMOgaSBraG/huqNuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudF91dWlkOiBVVUlEIGPhu6dhIHTDoGkga2hv4bqjbgogICAgICAgICAgICBsaW1pdDogU+G7kSBsxrDhu6NuZyBi4bqjbiBnaGkgdOG7kWkgxJFhIHRy4bqjIHbhu4EKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggbOG7i2NoIHPhu60gam9iCiAgICAgICAgIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICJTRUxFQ1QgKiBGUk9NIGpvYnNfaGlzdG9yeSBXSEVSRSBhY2NvdW50X3V1aWQgPSA/IE9SREVSIEJZIGNyZWF0ZWRfYXQgREVTQyBMSU1JVCA/IiwgCiAgICAgICAgICAgIChhY2NvdW50X3V1aWQsIGxpbWl0KQogICAgICAgICkKICAgICAgICBjb2x1bW5fbmFtZXMgPSBbZGVzY3JpcHRpb25bMF0gZm9yIGRlc2NyaXB0aW9uIGluIGN1cnNvci5kZXNjcmlwdGlvbl0KICAgICAgICByZXN1bHRzID0gY3Vyc29yLmZldGNoYWxsKCkKICAgICAgICAKICAgICAgICBqb2JzID0gW10KICAgICAgICBmb3IgcmVzdWx0IGluIHJlc3VsdHM6CiAgICAgICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGvhur90IHF14bqjIHRow6BuaCBkaWN0CiAgICAgICAgICAgIGpvYiA9IHtjb2x1bW5fbmFtZXNbaV06IHJlc3VsdFtpXSBmb3IgaSBpbiByYW5nZShsZW4oY29sdW1uX25hbWVzKSl9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBib29sZWFuCiAgICAgICAgICAgIGpvYlsic3VjY2VzcyJdID0gYm9vbChqb2JbInN1Y2Nlc3MiXSkKICAgICAgICAgICAgam9iWyJpc19zeW5jIl0gPSBib29sKGpvYlsiaXNfc3luYyJdKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBwaOG7pSB04burIHRyxrDhu51uZyBkYXRhCiAgICAgICAgICAgIGlmICJkYXRhIiBpbiBqb2IgYW5kIGpvYlsiZGF0YSJdOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGV4dHJhX2RhdGEgPSBqc29uLmxvYWRzKGpvYlsiZGF0YSJdKQogICAgICAgICAgICAgICAgICAgIGpvYi51cGRhdGUoZXh0cmFfZGF0YSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBYw7NhIHRyxrDhu51uZyBkYXRhIMSR4buDIHRyw6FuaCB0csO5bmcgbOG6t3AKICAgICAgICAgICAgaWYgImRhdGEiIGluIGpvYjoKICAgICAgICAgICAgICAgIGRlbCBqb2JbImRhdGEiXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGpvYnMuYXBwZW5kKGpvYikKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGpvYnMKICAgIAogICAgZGVmIGdldF9wZW5kaW5nX3N5bmNfaXRlbXMoc2VsZiwgdGFibGU6IHN0ciwgbGltaXQ6IGludCA9IDEwMCwgZGV2aWNlX2lkOiBBbnkgPSBUcnVlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBkYW5oIHPDoWNoIGPDoWMgYuG6o24gZ2hpIGNoxrBhIMSRxrDhu6NjIMSR4buTbmcgYuG7mQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhYmxlOiBUw6puIGLhuqNuZyAoJ2FjY291bnRzJyBob+G6t2MgJ2pvYnNfaGlzdG9yeScpCiAgICAgICAgICAgIGxpbWl0OiBT4buRIGzGsOG7o25nIGLhuqNuIGdoaSB04buRaSDEkWEgdHLhuqMgduG7gQogICAgICAgICAgICBkZXZpY2VfaWQ6IFRoaeG6v3QgYuG7iyBJRCDEkeG7gyBs4buNYzoKICAgICAgICAgICAgICAgIC0gVHJ1ZTogTOG7jWMgdGhlbyBkZXZpY2VfaWQgaGnhu4duIHThuqFpICht4bq3YyDEkeG7i25oKQogICAgICAgICAgICAgICAgLSBGYWxzZS9Ob25lOiBLaMO0bmcgbOG7jWMgdGhlbyBkZXZpY2VfaWQKICAgICAgICAgICAgICAgIC0gQ2h14buXaTogTOG7jWMgdGhlbyBkZXZpY2VfaWQgY+G7pSB0aOG7gyDEkcaw4bujYyB0cnV54buBbiB2w6BvCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGLhuqNuIGdoaSBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAiIiIKICAgICAgICBpZiB0YWJsZSBub3QgaW4gWydhY2NvdW50cycsICdqb2JzX2hpc3RvcnknXToKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgIAogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgIHV1aWRfZmllbGQgPSAiYWNjb3VudF91dWlkIiBpZiB0YWJsZSA9PSAiYWNjb3VudHMiIGVsc2UgImpvYl91dWlkIgogICAgICAgIAogICAgICAgICMgVGjDqm0gxJFp4buBdSBraeG7h24gbOG7jWMgdGhlbyBkZXZpY2VfaWQKICAgICAgICBpZiBkZXZpY2VfaWQgaXMgVHJ1ZToKICAgICAgICAgICAgIyBM4bqleSBkZXZpY2VfaWQgaGnhu4duIHThuqFpCiAgICAgICAgICAgIGN1cnJlbnRfZGV2aWNlX2lkID0gc2VsZi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgICAgIHF1ZXJ5ID0gZiJTRUxFQ1QgKiBGUk9NIHt0YWJsZX0gV0hFUkUgaXNfc3luYyA9IDAgQU5EIGRldmljZV9pZCA9ID8gTElNSVQgPyIKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUocXVlcnksIChjdXJyZW50X2RldmljZV9pZCwgbGltaXQpKQogICAgICAgIGVsaWYgZGV2aWNlX2lkOgogICAgICAgICAgICAjIFPhu60gZOG7pW5nIGRldmljZV9pZCDEkcaw4bujYyB0cnV54buBbiB2w6BvCiAgICAgICAgICAgIHF1ZXJ5ID0gZiJTRUxFQ1QgKiBGUk9NIHt0YWJsZX0gV0hFUkUgaXNfc3luYyA9IDAgQU5EIGRldmljZV9pZCA9ID8gTElNSVQgPyIKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUocXVlcnksIChkZXZpY2VfaWQsIGxpbWl0KSkKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIEtow7RuZyBs4buNYyB0aGVvIGRldmljZV9pZAogICAgICAgICAgICBxdWVyeSA9IGYiU0VMRUNUICogRlJPTSB7dGFibGV9IFdIRVJFIGlzX3N5bmMgPSAwIExJTUlUID8iCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKHF1ZXJ5LCAobGltaXQsKSkKICAgICAgICAgICAgCiAgICAgICAgY29sdW1uX25hbWVzID0gW2Rlc2NyaXB0aW9uWzBdIGZvciBkZXNjcmlwdGlvbiBpbiBjdXJzb3IuZGVzY3JpcHRpb25dCiAgICAgICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgCiAgICAgICAgaXRlbXMgPSBbXQogICAgICAgIGZvciByZXN1bHQgaW4gcmVzdWx0czoKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkga+G6v3QgcXXhuqMgdGjDoG5oIGRpY3QKICAgICAgICAgICAgaXRlbSA9IHtjb2x1bW5fbmFtZXNbaV06IHJlc3VsdFtpXSBmb3IgaSBpbiByYW5nZShsZW4oY29sdW1uX25hbWVzKSl9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGThu68gbGnhu4d1IHBo4bulIHThu6sgdHLGsOG7nW5nIGRhdGEKICAgICAgICAgICAgaWYgImRhdGEiIGluIGl0ZW0gYW5kIGl0ZW1bImRhdGEiXToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBleHRyYV9kYXRhID0ganNvbi5sb2FkcyhpdGVtWyJkYXRhIl0pCiAgICAgICAgICAgICAgICAgICAgaXRlbS51cGRhdGUoZXh0cmFfZGF0YSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBYw7NhIHRyxrDhu51uZyBkYXRhIMSR4buDIHRyw6FuaCB0csO5bmcgbOG6t3AKICAgICAgICAgICAgaWYgImRhdGEiIGluIGl0ZW06CiAgICAgICAgICAgICAgICBkZWwgaXRlbVsiZGF0YSJdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaXRlbXMuYXBwZW5kKGl0ZW0pCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBpdGVtcwogICAgCiAgICBkZWYgbWFya19hc19zeW5jZWQoc2VsZiwgdGFibGU6IHN0ciwgdXVpZF92YWx1ZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIMSQw6FuaCBk4bqldSBi4bqjbiBnaGkgxJHDoyDEkcaw4bujYyDEkeG7k25nIGLhu5kKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YWJsZTogVMOqbiBi4bqjbmcgKCdhY2NvdW50cycgaG/hurdjICdqb2JzX2hpc3RvcnknKQogICAgICAgICAgICB1dWlkX3ZhbHVlOiBHacOhIHRy4buLIFVVSUQgY+G7p2EgYuG6o24gZ2hpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY+G6rXAgbmjhuq10IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgdGFibGUgbm90IGluIFsnYWNjb3VudHMnLCAnam9ic19oaXN0b3J5J106CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICB1dWlkX2ZpZWxkID0gImFjY291bnRfdXVpZCIgaWYgdGFibGUgPT0gImFjY291bnRzIiBlbHNlICJqb2JfdXVpZCIKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICAgICAgICAgZiJVUERBVEUge3RhYmxlfSBTRVQgaXNfc3luYyA9IDEgV0hFUkUge3V1aWRfZmllbGR9ID0gPyIsCiAgICAgICAgICAgICAgICAodXVpZF92YWx1ZSwpCiAgICAgICAgICAgICkKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICByZXR1cm4gY3Vyc29yLnJvd2NvdW50ID4gMAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHDoW5oIGThuqV1IMSRw6MgxJHhu5NuZyBi4buZOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UgCgogICAgZGVmIGdldF9kZXZpY2VfY29uZmlnKHNlbGYsIGtleTogc3RyLCBkZWZhdWx0PU5vbmUpIC0+IEFueToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBrZXk6IEtow7NhIGPhuqV1IGjDrG5oCiAgICAgICAgICAgIGRlZmF1bHQ6IEdpw6EgdHLhu4sgbeG6t2MgxJHhu4tuaCBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgQW55OiBHacOhIHRy4buLIGPhuqV1IGjDrG5oIGhv4bq3YyBnacOhIHRy4buLIG3hurdjIMSR4buLbmgKICAgICAgICAiIiIKICAgICAgICAjIEzhuqV5IGPhuqV1IGjDrG5oIHThu6sgZGF0YWJhc2UKICAgICAgICByZXR1cm4gc2VsZi5nZXQoa2V5LCBkZWZhdWx0KQoKICAgIGRlZiBzZXRfZGV2aWNlX2NvbmZpZyhzZWxmLCBrZXk6IHN0ciwgdmFsdWU6IEFueSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBTZXQgYSBkZXZpY2UgY29uZmlndXJhdGlvbiB2YWx1ZSBpbiB0aGUgY29uZmlnIHRhYmxlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAga2V5OiBUaGUgY29uZmlndXJhdGlvbiBrZXkKICAgICAgICAgICAgdmFsdWU6IFRoZSB2YWx1ZSB0byBzZXQKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBpZiBzdWNjZXNzZnVsLCBGYWxzZSBvdGhlcndpc2UKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5zZXQoa2V5LCB2YWx1ZSkKCiAgICBkZWYgZ2V0X2FsbF9kZXZpY2VfY29uZmlnKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEdldCBhbGwgZGV2aWNlIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3MKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogRGljdGlvbmFyeSBvZiBhbGwgZGV2aWNlIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3MKICAgICAgICAiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICAjIEdldCBhbGwga2V5cyBzdGFydGluZyB3aXRoICJkZXZpY2VfIiBidXQgZXhjbHVkZSBkZXZpY2VfaW5mbwogICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1Qga2V5LCB2YWx1ZSBGUk9NIGNvbmZpZyBXSEVSRSBrZXkgIT0gJ2RldmljZV9pbmZvJyIpCiAgICAgICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgCiAgICAgICAgIyBCdWlsZCBjb25maWcgZGljdGlvbmFyeSwgcmVtb3ZpbmcgImRldmljZV8iIHByZWZpeCBmcm9tIGtleXMKICAgICAgICBkZXZpY2VfY29uZmlnID0ge30KICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiByZXN1bHRzOgogICAgICAgICAgICAjIFJlbW92ZSAiZGV2aWNlXyIgcHJlZml4CiAgICAgICAgICAgIGNsZWFuX2tleSA9IGtleVs3Ol0gaWYga2V5LnN0YXJ0c3dpdGgoImRldmljZV8iKSBlbHNlIGtleQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXZpY2VfY29uZmlnW2NsZWFuX2tleV0gPSBqc29uLmxvYWRzKHZhbHVlKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkZXZpY2VfY29uZmlnW2NsZWFuX2tleV0gPSB2YWx1ZQogICAgICAgIAogICAgICAgICMgSW1wb3J0IGNvbmZpZyBtb2R1bGUKICAgICAgICBpbXBvcnQgY29uZmlnIGFzIGNvbmZpZ19tb2R1bGUKICAgICAgICAKICAgICAgICAjIEFkZCBkZWZhdWx0IHZhbHVlcyBmb3IgbWlzc2luZyBjb25maWcgaXRlbXMKICAgICAgICBkZWZhdWx0X2NvbmZpZ3MgPSB7CiAgICAgICAgICAgICJtYXhfam9ic19wZXJfZGF5IjogY29uZmlnX21vZHVsZS5NQVhfSk9CU19QRVJfREFZLAogICAgICAgICAgICAibWF4X2pvYnNfcGVyX3Nlc3Npb24iOiBjb25maWdfbW9kdWxlLk1BWF9KT0JTX1BFUl9TRVNTSU9OLAogICAgICAgICAgICAiam9iX2ludGVydmFsX3NlY29uZHMiOiBjb25maWdfbW9kdWxlLkpPQl9DSEVDS19JTlRFUlZBTCwKICAgICAgICAgICAgInJlcG9ydF9pbnRlcnZhbCI6IGNvbmZpZ19tb2R1bGUuTVFUVF9SRVBPUlRfSU5URVJWQUwKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIGtleSwgZGVmYXVsdF92YWx1ZSBpbiBkZWZhdWx0X2NvbmZpZ3MuaXRlbXMoKToKICAgICAgICAgICAgaWYga2V5IG5vdCBpbiBkZXZpY2VfY29uZmlnOgogICAgICAgICAgICAgICAgZGV2aWNlX2NvbmZpZ1trZXldID0gZGVmYXVsdF92YWx1ZQogICAgICAgIAogICAgICAgICMgTG/huqFpIGLhu48gY8OhYyB0csaw4budbmcga2jDtG5nIGPhuqduIHRoaeG6v3QKICAgICAgICBrZXlzX3RvX3JlbW92ZSA9IFsiaWQiLCAiZ29saWtlX2FwaV9iYXNlIl0KICAgICAgICBmb3Iga2V5IGluIGtleXNfdG9fcmVtb3ZlOgogICAgICAgICAgICBpZiBrZXkgaW4gZGV2aWNlX2NvbmZpZzoKICAgICAgICAgICAgICAgIGRlbCBkZXZpY2VfY29uZmlnW2tleV0KICAgICAgICAKICAgICAgICByZXR1cm4gZGV2aWNlX2NvbmZpZwoKICAgIGRlZiBzYXZlX2RldmljZV9jb25maWcoc2VsZiwgY29uZmlnX2RpY3Q6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEzGsHUgbmhp4buBdSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgY8O5bmcgbMO6YwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGNvbmZpZ19kaWN0OiBEaWN0aW9uYXJ5IGNo4bupYSBjw6FjIGPhurdwIGtleS12YWx1ZSBj4bqldSBow6xuaAogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBjb25maWdfZGljdC5pdGVtcygpOgogICAgICAgICAgICAgICAgc2VsZi5zZXRfZGV2aWNlX2NvbmZpZyhrZXksIHZhbHVlKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbMawdSBj4bqldSBow6xuaCB0aGnhur90IGLhu4s6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgaW5pdF9kZWZhdWx0X2NvbmZpZyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgdOG6oW8gY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaCBjaG8gdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEPhuqV1IGjDrG5oIMSRw6Mga2jhu59pIHThuqFvCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFThuqFvIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmgKICAgICAgICAgICAgZGVmYXVsdF9jb25maWcgPSB7CiAgICAgICAgICAgICAgICAjIEPhuqV1IGjDrG5oIGNodW5nCiAgICAgICAgICAgICAgICAic3luY19pbnRlcnZhbCI6IGNvbmZpZy5TWU5DX0lOVEVSVkFMLAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEPhuqV1IGjDrG5oIGNobyBqb2IKICAgICAgICAgICAgICAgICJqb2JfY2hlY2tfaW50ZXJ2YWwiOiBjb25maWcuSk9CX0NIRUNLX0lOVEVSVkFMLAogICAgICAgICAgICAgICAgImpvYl9ob3VyIjogY29uZmlnLkpPQl9IT1VSLAogICAgICAgICAgICAgICAgImpvYl9jb29sZG93bl9taW51dGVzIjogY29uZmlnLkRFRkFVTFRfQ09PTERPV05fTUlOVVRFUywKICAgICAgICAgICAgICAgICJtYXhfam9ic19wZXJfZGF5IjogY29uZmlnLk1BWF9KT0JTX1BFUl9EQVksCiAgICAgICAgICAgICAgICAibWF4X2pvYnNfcGVyX3Nlc3Npb24iOiBjb25maWcuTUFYX0pPQlNfUEVSX1NFU1NJT04sCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgRGFuaCBzw6FjaCBjw6FjIGFwcCDEkcaw4bujYyBrw61jaCBob+G6oXQKICAgICAgICAgICAgICAgICJlbmFibGVkX2FwcHMiOiBjb25maWcuRU5BQkxFRF9BUFBTLAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzGsHUgY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaCB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGRlZmF1bHRfY29uZmlnLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAjIENo4buJIGzGsHUgbuG6v3UgY2jGsGEgY8OzIHRyb25nIGRhdGFiYXNlCiAgICAgICAgICAgICAgICBpZiBzZWxmLmdldF9kZXZpY2VfY29uZmlnKGtleSkgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldF9kZXZpY2VfY29uZmlnKGtleSwgdmFsdWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludCgixJDDoyBraOG7n2kgdOG6oW8gY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaCBjaG8gdGhp4bq/dCBi4buLIikKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRfY29uZmlnCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBraOG7n2kgdOG6oW8gY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIAogICAgZGVmIGdldF9vcl9jcmVhdGVfZGV2aWNlX2lkKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBob+G6t2MgdOG6oW8gZGV2aWNlX2lkCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBkZXZpY2VfaWQKICAgICAgICAiIiIKICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBkZXZpY2VfaWQgdHJvbmcgZGF0YWJhc2Uga2jDtG5nCiAgICAgICAgZGV2aWNlX2lkID0gc2VsZi5nZXRfZGV2aWNlX2NvbmZpZygiZGV2aWNlX2lkIiwgIiIpCiAgICAgICAgaWYgZGV2aWNlX2lkOgogICAgICAgICAgICByZXR1cm4gZGV2aWNlX2lkCiAgICAgICAgICAgIAogICAgICAgICMgVGjhu60gbOG6pXkgZGV2aWNlX2lkIHThu6sgaOG7hyB0aOG7kW5nCiAgICAgICAgZGV2aWNlX2lkID0gc2VsZi5fZ2V0X2RldmljZV9pZF9mcm9tX3N5c3RlbSgpCiAgICAgICAgaWYgZGV2aWNlX2lkOgogICAgICAgICAgICAjIEzGsHUgdsOgbyBj4bqldSBow6xuaCB2w6AgdHLhuqMgduG7gQogICAgICAgICAgICBwcmludChmIsSQw6MgbOG6pXkgxJHGsOG7o2MgZGV2aWNlX2lkIHThu6sgaOG7hyB0aOG7kW5nOiB7ZGV2aWNlX2lkfSIpCiAgICAgICAgICAgIHNlbGYuc2V0X2RldmljZV9jb25maWcoImRldmljZV9pZCIsIGRldmljZV9pZCkKICAgICAgICAgICAgcmV0dXJuIGRldmljZV9pZAogICAgICAgICAgICAKICAgICAgICAjIFRo4butIGzhuqV5IGRldmljZV9pZCB04burIGhlbHBlciBzZXJ2aWNlCiAgICAgICAgZGV2aWNlX2lkID0gc2VsZi5fZ2V0X2RldmljZV9pZF9mcm9tX2hlbHBlcigpCiAgICAgICAgaWYgZGV2aWNlX2lkOgogICAgICAgICAgICAjIEzGsHUgdsOgbyBj4bqldSBow6xuaCB2w6AgdHLhuqMgduG7gQogICAgICAgICAgICBwcmludChmIsSQw6MgbOG6pXkgxJHGsOG7o2MgZGV2aWNlX2lkIHThu6sgaGVscGVyIHNlcnZpY2U6IHtkZXZpY2VfaWR9IikKICAgICAgICAgICAgc2VsZi5zZXRfZGV2aWNlX2NvbmZpZygiZGV2aWNlX2lkIiwgZGV2aWNlX2lkKQogICAgICAgICAgICByZXR1cm4gZGV2aWNlX2lkCiAgICAgICAgICAgIAogICAgICAgICMgTuG6v3Uga2jDtG5nIGzhuqV5IMSRxrDhu6NjLCB04bqhbyBt4bubaQogICAgICAgIGltcG9ydCByYW5kb20KICAgICAgICBpbXBvcnQgc3RyaW5nCiAgICAgICAgcmFuZG9tX2lkID0gJycuam9pbihyYW5kb20uY2hvaWNlcyhzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cywgaz0xMCkpCiAgICAgICAgZGV2aWNlX2lkID0gZiJyYW5kb21fe3JhbmRvbV9pZH0iCiAgICAgICAgcHJpbnQoZiJLaMO0bmcgbOG6pXkgxJHGsOG7o2MgZGV2aWNlX2lkIGLhurFuZyBjw6FjIGPDoWNoIHRyw6puLCB04bqhbyBt4bubaToge2RldmljZV9pZH0iKQogICAgICAgIAogICAgICAgICMgTMawdSB2w6BvIGPhuqV1IGjDrG5oCiAgICAgICAgc2VsZi5zZXRfZGV2aWNlX2NvbmZpZygiZGV2aWNlX2lkIiwgZGV2aWNlX2lkKQogICAgICAgIHJldHVybiBkZXZpY2VfaWQKICAgICAgICAKICAgIGRlZiBfZ2V0X2RldmljZV9pZF9mcm9tX3N5c3RlbShzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgZGV2aWNlX2lkIHThu6sgaOG7hyB0aOG7kW5nIChz4butIGThu6VuZyBs4buHbmggZ2V0cHJvcCkKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IGRldmljZV9pZCBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3Uga2jDtG5nIGzhuqV5IMSRxrDhu6NjCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbXBvcnQgc3VicHJvY2VzcwogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbImdldHByb3AiLCAicm8uc2VyaWFsbm8iXSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQogICAgICAgICAgICBkZXZpY2VfaWQgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGRldmljZV9pZCBhbmQgZGV2aWNlX2lkICE9ICJ1bmtub3duIjoKICAgICAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaWQKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBs4bqleSBkZXZpY2VfaWQgdOG7qyBo4buHIHRo4buRbmc6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAKICAgIGRlZiBfZ2V0X2RldmljZV9pZF9mcm9tX2hlbHBlcihzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgZGV2aWNlX2lkIHThu6sgaGVscGVyIHNlcnZpY2UgKGFuZHJvaWRfaWQpCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBkZXZpY2VfaWQgaG/hurdjIGNodeG7l2kgcuG7l25nIG7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBD4bqnbiBpbXBvcnQgSGVscGVyU2VydmljZSB04bqhaSDEkcOieSDEkeG7gyB0csOhbmggaW1wb3J0IHbDsm5nCiAgICAgICAgICAgIGZyb20gc2VydmljZXMuaGVscGVyX3NlcnZpY2UgaW1wb3J0IEhlbHBlclNlcnZpY2UKICAgICAgICAgICAgaW1wb3J0IGNvbmZpZwogICAgICAgICAgICAKICAgICAgICAgICAgaGVscGVyID0gSGVscGVyU2VydmljZShiYXNlX3VybD1jb25maWcuSEVMUEVSX1NFUlZJQ0VfVVJMKQogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IGhlbHBlci5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZGV2aWNlX2luZm8gYW5kICJzdGF0dXMiIGluIGRldmljZV9pbmZvIGFuZCBkZXZpY2VfaW5mb1sic3RhdHVzIl0gPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgZGF0YSA9IGRldmljZV9pbmZvLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAgICAgYW5kcm9pZF9pZCA9IGRhdGEuZ2V0KCJhbmRyb2lkX2lkIiwgIiIpCiAgICAgICAgICAgICAgICBpZiBhbmRyb2lkX2lkOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBhbmRyb2lkX2lkCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgZGV2aWNlX2lkIHThu6sgaGVscGVyOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICAgICAgCiAgICBkZWYgbWlncmF0ZV9nb2xpa2VfY29uZmlnKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgWMOzYSBjw6FjIGPhuqV1IGjDrG5oIEdvTGlrZSB0csO5bmcgbOG6t3Aga2jDtG5nIGPDsm4gY+G6p24gdGhp4bq/dAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KCLEkGFuZyB4w7NhIGPhuqV1IGjDrG5oIEdvTGlrZSB0csO5bmcgbOG6t3AuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIGvhur90IG7hu5FpIERCCiAgICAgICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRGFuaCBzw6FjaCBjw6FjIGtleSBj4bqnbiB4w7NhCiAgICAgICAgICAgIGtleXNfdG9fZGVsZXRlID0gWwogICAgICAgICAgICAgICAgImdvbGlrZV9oZWFkZXJzIiwgCiAgICAgICAgICAgICAgICAiZ29saWtlX2hlYWRlcnNfdXBkYXRlZCIsCiAgICAgICAgICAgICAgICAiZ29saWtlX2FwaV9iYXNlIgogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDs2EgY8OhYyBrZXkgdHLDuW5nIGzhurdwIGPFqQogICAgICAgICAgICBkZWxldGVkX2NvdW50ID0gMAogICAgICAgICAgICBmb3Iga2V5IGluIGtleXNfdG9fZGVsZXRlOgogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIkRFTEVURSBGUk9NIGNvbmZpZyBXSEVSRSBrZXkgPSA/IiwgKGtleSwpKQogICAgICAgICAgICAgICAgZGVsZXRlZF9jb3VudCArPSBjdXJzb3Iucm93Y291bnQKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ29tbWl0IHRoYXkgxJHhu5VpCiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KGYixJDDoyB4w7NhIHtkZWxldGVkX2NvdW50fSBj4bqldSBow6xuaCBHb0xpa2UgdHLDuW5nIGzhurdwIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB4w7NhIGPhuqV1IGjDrG5oIEdvTGlrZSB0csO5bmcgbOG6t3A6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZSA=').decode('utf-8'))
