import base64
exec(base64.b64decode('aW1wb3J0IHNxbGl0ZTMKaW1wb3J0IGpzb24KaW1wb3J0IG9zCmltcG9ydCB0aW1lCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IHV1aWQKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgTGlzdCwgT3B0aW9uYWwsIFVuaW9uCmltcG9ydCBjb25maWcKCmNsYXNzIERhdGFiYXNlU2VydmljZToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYl9wYXRoOiBzdHIgPSAiZGF0YS5kYiIsIGRlZmF1bHRfY29uZmlnX3BhdGg6IHN0ciA9ICJkZWZhdWx0Q29uZmlnLmpzb24iKToKICAgICAgICBzZWxmLmRiX3BhdGggPSBkYl9wYXRoCiAgICAgICAgc2VsZi5kZWZhdWx0X2NvbmZpZ19wYXRoID0gZGVmYXVsdF9jb25maWdfcGF0aAogICAgICAgIHNlbGYubG9jYWwgPSB0aHJlYWRpbmcubG9jYWwoKSAgIyBMxrB1IHRy4buvIHJpw6puZyBjaG8gbeG7l2kgdGhyZWFkCiAgICAgICAgCiAgICAgICAgIyBU4bqhbyBi4bqjbmcgbuG6v3UgY2jGsGEgdOG7k24gdOG6oWkKICAgICAgICBzZWxmLl9pbml0X2RiKCkKICAgICAgICAKICAgIGRlZiBfZ2V0X2Nvbm5lY3Rpb24oc2VsZik6CiAgICAgICAgIiIiTOG6pXkga+G6v3QgbuG7kWkgU1FMaXRlIGNobyB0aHJlYWQgaGnhu4duIHThuqFpIiIiCiAgICAgICAgaWYgbm90IGhhc2F0dHIoc2VsZi5sb2NhbCwgJ2Nvbm4nKSBvciBzZWxmLmxvY2FsLmNvbm4gaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5sb2NhbC5jb25uID0gc3FsaXRlMy5jb25uZWN0KHNlbGYuZGJfcGF0aCkKICAgICAgICByZXR1cm4gc2VsZi5sb2NhbC5jb25uCiAgICAgICAgCiAgICBkZWYgX2luaXRfZGIoc2VsZik6CiAgICAgICAgIiIiS2jhu59pIHThuqFvIGPhuqV1IHRyw7pjIGRhdGFiYXNlIG7hur91IGNoxrBhIHThu5NuIHThuqFpIiIiCiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChzZWxmLmRiX3BhdGgpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgICMgVOG6oW8gYuG6o25nIGNvbmZpZwogICAgICAgIGN1cnNvci5leGVjdXRlKCcnJwogICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGNvbmZpZyAoCiAgICAgICAgICAgIGtleSBURVhUIFBSSU1BUlkgS0VZLAogICAgICAgICAgICB2YWx1ZSBURVhUCiAgICAgICAgKQogICAgICAgICcnJykKICAgICAgICAKICAgICAgICAjIFThuqFvIGLhuqNuZyBhY2NvdW50IHbhu5tpIHV1aWQKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgnJycKICAgICAgICBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBhY2NvdW50cyAoCiAgICAgICAgICAgIGlkIElOVEVHRVIgUFJJTUFSWSBLRVksCiAgICAgICAgICAgIGFjY291bnRfdXVpZCBURVhUIFVOSVFVRSwKICAgICAgICAgICAgYXBwIFRFWFQsCiAgICAgICAgICAgIG5pY2tuYW1lIFRFWFQsCiAgICAgICAgICAgIHVuaXF1ZV9pZCBURVhULAogICAgICAgICAgICB1bmlxdWVfdXNlcm5hbWUgVEVYVCwKICAgICAgICAgICAgc3RhdHVzIFRFWFQsCiAgICAgICAgICAgIGluYWN0aXZlX3JlYXNvbiBURVhULAogICAgICAgICAgICBpc19sb2dpbiBJTlRFR0VSLAogICAgICAgICAgICBhdmF0YXJfdGh1bWIgVEVYVCwKICAgICAgICAgICAgdG90YWxfam9icyBJTlRFR0VSLAogICAgICAgICAgICBqb2JfZW5hYmxlIElOVEVHRVIsCiAgICAgICAgICAgIGpvYl9kaXNhYmxlX3VudGlsIElOVEVHRVIsCiAgICAgICAgICAgIGpvYl90b2RheSBJTlRFR0VSLAogICAgICAgICAgICBqb2JfbWF4X2RheSBJTlRFR0VSLAogICAgICAgICAgICBqb2JzX2RvbmVfaW5fc2Vzc2lvbiBJTlRFR0VSLAogICAgICAgICAgICBtYXhfam9ic19wZXJfc2Vzc2lvbiBJTlRFR0VSLAogICAgICAgICAgICBsYXN0X2pvYl90aW1lIElOVEVHRVIsCiAgICAgICAgICAgIGxhc3RfdXBkYXRlIElOVEVHRVIsCiAgICAgICAgICAgIGNhcmVfdG9kYXkgSU5URUdFUiwKICAgICAgICAgICAgaXNfZ29saWtlX2xpbmtlZCBJTlRFR0VSIERFRkFVTFQgMCwKICAgICAgICAgICAgZ29saWtlX2lkIFRFWFQsCiAgICAgICAgICAgIGRldmljZV9pZCBURVhULAogICAgICAgICAgICBpc19zeW5jIElOVEVHRVIgREVGQVVMVCAwLAogICAgICAgICAgICBkaXNhYmxlX2ZvbGxvdyBJTlRFR0VSIERFRkFVTFQgMCwKICAgICAgICAgICAgZm9sbG93X2Rpc2FibGVfdW50aWwgSU5URUdFUiBERUZBVUxUIDAsCiAgICAgICAgICAgIGZvbGxvd190b2RheSBJTlRFR0VSIERFRkFVTFQgMCwKICAgICAgICAgICAgZm9sbG93X2luX3Nlc3Npb24gSU5URUdFUiBERUZBVUxUIDAsCiAgICAgICAgICAgIG1heF9mb2xsb3dfZGF5IElOVEVHRVIgREVGQVVMVCAyMCwKICAgICAgICAgICAgbWF4X2ZvbGxvd19zZXNzaW9uIElOVEVHRVIgREVGQVVMVCA1LAogICAgICAgICAgICBsYXN0X2ZvbGxvd190aW1lIElOVEVHRVIgREVGQVVMVCAwLAogICAgICAgICAgICBpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIFRFWFQsCiAgICAgICAgICAgIGRhdGEgVEVYVAogICAgICAgICkKICAgICAgICAnJycpCiAgICAgICAgCiAgICAgICAgIyBU4bqhbyBi4bqjbmcgam9ic19oaXN0b3J5IMSR4buDIGzGsHUgbOG7i2NoIHPhu60gam9iCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoJycnCiAgICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgam9ic19oaXN0b3J5ICgKICAgICAgICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSwKICAgICAgICAgICAgam9iX3V1aWQgVEVYVCBVTklRVUUsCiAgICAgICAgICAgIGFjY291bnRfdXVpZCBURVhULAogICAgICAgICAgICBkZXZpY2VfaWQgVEVYVCwKICAgICAgICAgICAgYXBwIFRFWFQsCiAgICAgICAgICAgIGpvYl9pZCBURVhULAogICAgICAgICAgICBqb2JfdHlwZSBURVhULAogICAgICAgICAgICBvYmplY3RfaWQgVEVYVCwKICAgICAgICAgICAgbGluayBURVhULAogICAgICAgICAgICBzdGF0dXMgSU5URUdFUiBERUZBVUxUIDAsCiAgICAgICAgICAgIHN1Y2Nlc3MgSU5URUdFUiBERUZBVUxUIDAsCiAgICAgICAgICAgIHByaWNlIFJFQUwgREVGQVVMVCAwLAogICAgICAgICAgICBlcnJvcl9tZXNzYWdlIFRFWFQsCiAgICAgICAgICAgIGNyZWF0ZWRfYXQgSU5URUdFUiwKICAgICAgICAgICAgbGFzdF91cGRhdGUgSU5URUdFUiwKICAgICAgICAgICAgaXNfc3luYyBJTlRFR0VSIERFRkFVTFQgMCwKICAgICAgICAgICAgZGF0YSBURVhUCiAgICAgICAgKQogICAgICAgICcnJykKICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgdsOgIHRow6ptIGPhu5l0IGFjY291bnRfdXVpZCBu4bq/dSBjaMawYSB04buTbiB04bqhaQogICAgICAgIGN1cnNvci5leGVjdXRlKCJQUkFHTUEgdGFibGVfaW5mbyhhY2NvdW50cykiKQogICAgICAgIGNvbHVtbnMgPSBbcm93WzFdIGZvciByb3cgaW4gY3Vyc29yLmZldGNoYWxsKCldCiAgICAgICAgaWYgImFjY291bnRfdXVpZCIgbm90IGluIGNvbHVtbnM6CiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJBTFRFUiBUQUJMRSBhY2NvdW50cyBBREQgQ09MVU1OIGFjY291bnRfdXVpZCBURVhUIFVOSVFVRSIpCiAgICAgICAgICAgICMgVOG6oW8gVVVJRCBjaG8gY8OhYyB0w6BpIGtob+G6o24gxJHDoyB04buTbiB04bqhaQogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGlkIEZST00gYWNjb3VudHMiKQogICAgICAgICAgICBhY2NvdW50cyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGFjY291bnRzOgogICAgICAgICAgICAgICAgYWNjb3VudF9pZCA9IGFjY291bnRbMF0KICAgICAgICAgICAgICAgIGFjY291bnRfdXVpZCA9IHN0cih1dWlkLnV1aWQ0KCkpCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiVVBEQVRFIGFjY291bnRzIFNFVCBhY2NvdW50X3V1aWQgPSA/IFdIRVJFIGlkID0gPyIsIChhY2NvdW50X3V1aWQsIGFjY291bnRfaWQpKQogICAgICAgICAgICBwcmludCgixJDDoyB0aMOqbSBj4buZdCBhY2NvdW50X3V1aWQgdsOgbyBi4bqjbmcgYWNjb3VudHMgdsOgIHThuqFvIFVVSUQgY2hvIGPDoWMgdMOgaSBraG/huqNuIGhp4buHbiBjw7MiKQogICAgICAgICAgICAKICAgICAgICAjIEtp4buDbSB0cmEgdsOgIHRow6ptIGPhu5l0IGlzX3N5bmMgbuG6v3UgY2jGsGEgdOG7k24gdOG6oWkKICAgICAgICBpZiAiaXNfc3luYyIgbm90IGluIGNvbHVtbnM6CiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJBTFRFUiBUQUJMRSBhY2NvdW50cyBBREQgQ09MVU1OIGlzX3N5bmMgSU5URUdFUiBERUZBVUxUIDAiKQogICAgICAgICAgICBwcmludCgixJDDoyB0aMOqbSBj4buZdCBpc19zeW5jIHbDoG8gYuG6o25nIGFjY291bnRzIikKICAgICAgICAKICAgICAgICAjIFThuqFvIHVuaXF1ZSBpbmRleCBjaG8gKGFwcCwgdW5pcXVlX3VzZXJuYW1lKSDEkeG7gyB0csOhbmggZHVwbGljYXRlIGFjY291bnRzCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiQ1JFQVRFIFVOSVFVRSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9hY2NvdW50c19hcHBfdXNlcm5hbWUgT04gYWNjb3VudHMoYXBwLCB1bmlxdWVfdXNlcm5hbWUpIikKICAgICAgICAgICAgcHJpbnQoIsSQw6MgdOG6oW8gdW5pcXVlIGluZGV4IGNobyAoYXBwLCB1bmlxdWVfdXNlcm5hbWUpIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICMgTuG6v3UgY8OzIGR1cGxpY2F0ZSBkYXRhLCBj4bqnbiBjbGVhbnVwIHRyxrDhu5tjCiAgICAgICAgICAgIHByaW50KGYiQ+G6o25oIGLDoW8ga2hpIHThuqFvIHVuaXF1ZSBpbmRleDoge2V9IikKICAgICAgICAgICAgc2VsZi5fY2xlYW51cF9kdXBsaWNhdGVfYWNjb3VudHMoY3Vyc29yKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiQ1JFQVRFIFVOSVFVRSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9hY2NvdW50c19hcHBfdXNlcm5hbWUgT04gYWNjb3VudHMoYXBwLCB1bmlxdWVfdXNlcm5hbWUpIikKICAgICAgICAgICAgICAgIHByaW50KCLEkMOjIHThuqFvIHVuaXF1ZSBpbmRleCBjaG8gKGFwcCwgdW5pcXVlX3VzZXJuYW1lKSBzYXUga2hpIGNsZWFudXAiKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGUyOgogICAgICAgICAgICAgICAgcHJpbnQoZiJLaMO0bmcgdGjhu4MgdOG6oW8gdW5pcXVlIGluZGV4OiB7ZTJ9IikKICAgICAgICAKICAgICAgICAjIFRow6ptIGPhu5l0IGRpc2FibGVfZm9sbG93IG7hur91IGNoxrBhIGPDswogICAgICAgIGlmICJkaXNhYmxlX2ZvbGxvdyIgbm90IGluIGNvbHVtbnM6CiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJBTFRFUiBUQUJMRSBhY2NvdW50cyBBREQgQ09MVU1OIGRpc2FibGVfZm9sbG93IElOVEVHRVIgREVGQVVMVCAwIikKICAgICAgICAgICAgcHJpbnQoIsSQw6MgdGjDqm0gY+G7mXQgZGlzYWJsZV9mb2xsb3cgdsOgbyBi4bqjbmcgYWNjb3VudHMiKQogICAgICAgIAogICAgICAgICMgVGjDqm0gY+G7mXQgZm9sbG93X2Rpc2FibGVfdW50aWwgbuG6v3UgY2jGsGEgY8OzCiAgICAgICAgaWYgImZvbGxvd19kaXNhYmxlX3VudGlsIiBub3QgaW4gY29sdW1uczoKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIkFMVEVSIFRBQkxFIGFjY291bnRzIEFERCBDT0xVTU4gZm9sbG93X2Rpc2FibGVfdW50aWwgSU5URUdFUiBERUZBVUxUIDAiKQogICAgICAgICAgICBwcmludCgixJDDoyB0aMOqbSBj4buZdCBmb2xsb3dfZGlzYWJsZV91bnRpbCB2w6BvIGLhuqNuZyBhY2NvdW50cyIpCiAgICAgICAgCiAgICAgICAgIyBUaMOqbSBjw6FjIGPhu5l0IGZvbGxvdyB0cmFja2luZyBu4bq/dSBjaMawYSBjw7MKICAgICAgICBmb2xsb3dfY29sdW1ucyA9IFsKICAgICAgICAgICAgKCJmb2xsb3dfdG9kYXkiLCAiSU5URUdFUiBERUZBVUxUIDAiKSwKICAgICAgICAgICAgKCJmb2xsb3dfaW5fc2Vzc2lvbiIsICJJTlRFR0VSIERFRkFVTFQgMCIpLAogICAgICAgICAgICAoIm1heF9mb2xsb3dfZGF5IiwgIklOVEVHRVIgREVGQVVMVCAyMCIpLAogICAgICAgICAgICAoIm1heF9mb2xsb3dfc2Vzc2lvbiIsICJJTlRFR0VSIERFRkFVTFQgNSIpLAogICAgICAgICAgICAoImxhc3RfZm9sbG93X3RpbWUiLCAiSU5URUdFUiBERUZBVUxUIDAiKSwKICAgICAgICAgICAgKCJpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIiwgIlRFWFQiKQogICAgICAgIF0KICAgICAgICAKICAgICAgICBmb3IgY29sX25hbWUsIGNvbF90eXBlIGluIGZvbGxvd19jb2x1bW5zOgogICAgICAgICAgICBpZiBjb2xfbmFtZSBub3QgaW4gY29sdW1uczoKICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKGYiQUxURVIgVEFCTEUgYWNjb3VudHMgQUREIENPTFVNTiB7Y29sX25hbWV9IHtjb2xfdHlwZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIHRow6ptIGPhu5l0IHtjb2xfbmFtZX0gdsOgbyBi4bqjbmcgYWNjb3VudHMiKQogICAgICAgIAogICAgICAgICMgVGjDqm0gY8OhYyBj4buZdCBjYXJlIHRyYWNraW5nIG7hur91IGNoxrBhIGPDswogICAgICAgIGNhcmVfY29sdW1ucyA9IFsKICAgICAgICAgICAgKCJsYXN0X2NhcmVfdGltZSIsICJJTlRFR0VSIERFRkFVTFQgMCIpLAogICAgICAgICAgICAoImxhc3Rfdmlld19zdG9yaWVzIiwgIklOVEVHRVIgREVGQVVMVCAwIiksCiAgICAgICAgICAgICgiY2FyZV9kYXRhIiwgIlRFWFQiKSAgIyBMxrB1IEpTT04gU21hcnQgQ2FyZSBjaG8gdOG7q25nIHTDoGkga2hv4bqjbgogICAgICAgIF0KICAgICAgICAKICAgICAgICBmb3IgY29sX25hbWUsIGNvbF90eXBlIGluIGNhcmVfY29sdW1uczoKICAgICAgICAgICAgaWYgY29sX25hbWUgbm90IGluIGNvbHVtbnM6CiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZShmIkFMVEVSIFRBQkxFIGFjY291bnRzIEFERCBDT0xVTU4ge2NvbF9uYW1lfSB7Y29sX3R5cGV9IikKICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyB0aMOqbSBj4buZdCB7Y29sX25hbWV9IHbDoG8gYuG6o25nIGFjY291bnRzIikKICAgICAgICAKICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgCiAgICBkZWYgX2NsZWFudXBfZHVwbGljYXRlX2FjY291bnRzKHNlbGYsIGN1cnNvcik6CiAgICAgICAgIiIiCiAgICAgICAgROG7jW4gZOG6uXAgY8OhYyB0w6BpIGtob+G6o24gZHVwbGljYXRlIGThu7FhIHRyw6puIChhcHAsIHVuaXF1ZV91c2VybmFtZSkKICAgICAgICBHaeG7ryBs4bqhaSB0w6BpIGtob+G6o24gY8OzIGlkIGzhu5tuIG5o4bqldCAobeG7m2kgbmjhuqV0KQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUw6xtIGPDoWMgbmjDs20gZHVwbGljYXRlCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCIiIgogICAgICAgICAgICAgICAgU0VMRUNUIGFwcCwgdW5pcXVlX3VzZXJuYW1lLCBDT1VOVCgqKSBhcyBjb3VudAogICAgICAgICAgICAgICAgRlJPTSBhY2NvdW50cyAKICAgICAgICAgICAgICAgIFdIRVJFIHVuaXF1ZV91c2VybmFtZSBJUyBOT1QgTlVMTCBBTkQgdW5pcXVlX3VzZXJuYW1lICE9ICcnCiAgICAgICAgICAgICAgICBHUk9VUCBCWSBhcHAsIHVuaXF1ZV91c2VybmFtZSAKICAgICAgICAgICAgICAgIEhBVklORyBDT1VOVCgqKSA+IDEKICAgICAgICAgICAgIiIiKQogICAgICAgICAgICAKICAgICAgICAgICAgZHVwbGljYXRlcyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgICAgIGlmIG5vdCBkdXBsaWNhdGVzOgogICAgICAgICAgICAgICAgcHJpbnQoIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gZHVwbGljYXRlIG7DoG8iKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoZiJUw6xtIHRo4bqleSB7bGVuKGR1cGxpY2F0ZXMpfSBuaMOzbSB0w6BpIGtob+G6o24gZHVwbGljYXRlLCDEkWFuZyBk4buNbiBk4bq5cC4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICB0b3RhbF9kZWxldGVkID0gMAogICAgICAgICAgICBmb3IgYXBwLCB1c2VybmFtZSwgY291bnQgaW4gZHVwbGljYXRlczoKICAgICAgICAgICAgICAgICMgTOG6pXkgdOG6pXQgY+G6oyB0w6BpIGtob+G6o24gZHVwbGljYXRlIGPhu6dhIG5ow7NtIG7DoHkKICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCIiIgogICAgICAgICAgICAgICAgICAgIFNFTEVDVCBpZCBGUk9NIGFjY291bnRzIAogICAgICAgICAgICAgICAgICAgIFdIRVJFIGFwcCA9ID8gQU5EIHVuaXF1ZV91c2VybmFtZSA9ID8gCiAgICAgICAgICAgICAgICAgICAgT1JERVIgQlkgaWQgREVTQwogICAgICAgICAgICAgICAgIiIiLCAoYXBwLCB1c2VybmFtZSkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFjY291bnRfaWRzID0gW3Jvd1swXSBmb3Igcm93IGluIGN1cnNvci5mZXRjaGFsbCgpXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEdp4buvIGzhuqFpIHTDoGkga2hv4bqjbiDEkeG6p3UgdGnDqm4gKGlkIGzhu5tuIG5o4bqldCksIHjDs2EgY8OhYyB0w6BpIGtob+G6o24gY8OybiBs4bqhaQogICAgICAgICAgICAgICAgaWYgbGVuKGFjY291bnRfaWRzKSA+IDE6CiAgICAgICAgICAgICAgICAgICAga2VlcF9pZCA9IGFjY291bnRfaWRzWzBdICAjIElEIGzhu5tuIG5o4bqldCAobeG7m2kgbmjhuqV0KQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9pZHMgPSBhY2NvdW50X2lkc1sxOl0gICMgQ8OhYyBJRCBjw7JuIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yIGRlbGV0ZV9pZCBpbiBkZWxldGVfaWRzOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiREVMRVRFIEZST00gYWNjb3VudHMgV0hFUkUgaWQgPSA/IiwgKGRlbGV0ZV9pZCwpKQogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9kZWxldGVkICs9IDEKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgeMOzYSB7bGVuKGRlbGV0ZV9pZHMpfSB0w6BpIGtob+G6o24gZHVwbGljYXRlIGNobyB7YXBwfTp7dXNlcm5hbWV9LCBnaeG7ryBs4bqhaSBJRCB7a2VlcF9pZH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoZiLEkMOjIGhvw6BuIHRow6BuaCBk4buNbiBk4bq5cCwgeMOzYSB04buVbmcgY+G7mW5nIHt0b3RhbF9kZWxldGVkfSB0w6BpIGtob+G6o24gZHVwbGljYXRlIikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBk4buNbiBk4bq5cCBkdXBsaWNhdGUgYWNjb3VudHM6IHtlfSIpCiAgICAgICAgCiAgICAgICAgIyBLaOG7n2kgdOG6oW8gY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaCB04burIGNvbmZpZy5weQogICAgICAgIHNlbGYuaW5pdF9kZWZhdWx0X2NvbmZpZygpCiAgICAgICAgCiAgICBkZWYgbG9hZF9kZWZhdWx0X2NvbmZpZyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiLEkOG7jWMgY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaCB04burIGZpbGUiIiIKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzZWxmLmRlZmF1bHRfY29uZmlnX3BhdGgpOgogICAgICAgICAgICB3aXRoIG9wZW4oc2VsZi5kZWZhdWx0X2NvbmZpZ19wYXRoLCAncicpIGFzIGY6CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbi5sb2FkKGYpCiAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgCiAgICBkZWYgZ2V0KHNlbGYsIGtleTogc3RyLCBkZWZhdWx0PU5vbmUpIC0+IEFueToKICAgICAgICAiIiJM4bqleSBnacOhIHRy4buLIGPhuqV1IGjDrG5oIHThu6sgREIsIG7hur91IGtow7RuZyBjw7MgdGjDrCBs4bqleSB04burIGRlZmF1bHQgY29uZmlnIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCB2YWx1ZSBGUk9NIGNvbmZpZyBXSEVSRSBrZXkgPSA/IiwgKGtleSwpKQogICAgICAgIHJlc3VsdCA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgCiAgICAgICAgaWYgcmVzdWx0OgogICAgICAgICAgICAjIENodXnhu4NuIMSR4buVaSB24buBIGtp4buDdSBk4buvIGxp4buHdSBwaMO5IGjhu6NwCiAgICAgICAgICAgIHZhbHVlID0gcmVzdWx0WzBdCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldHVybiBqc29uLmxvYWRzKHZhbHVlKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIEzhuqV5IHThu6sgZGVmYXVsdCBjb25maWcKICAgICAgICAgICAgZGVmYXVsdF9jb25maWcgPSBzZWxmLmxvYWRfZGVmYXVsdF9jb25maWcoKQogICAgICAgICAgICBpZiBrZXkgaW4gZGVmYXVsdF9jb25maWc6CiAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdF9jb25maWdba2V5XQogICAgICAgICAgICByZXR1cm4gZGVmYXVsdAogICAgCiAgICBkZWYgc2V0KHNlbGYsIGtleTogc3RyLCB2YWx1ZTogQW55KSAtPiBib29sOgogICAgICAgICIiIkzGsHUgZ2nDoSB0cuG7iyBj4bqldSBow6xuaCB2w6BvIERCIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgZOG7ryBsaeG7h3UgcGjhu6ljIHThuqFwIHRow6BuaCBKU09OCiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgKGRpY3QsIGxpc3QpKToKICAgICAgICAgICAgdmFsdWUgPSBqc29uLmR1bXBzKHZhbHVlKQogICAgICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICAgICAgICAgIklOU0VSVCBPUiBSRVBMQUNFIElOVE8gY29uZmlnIChrZXksIHZhbHVlKSBWQUxVRVMgKD8sID8pIiwKICAgICAgICAgICAgICAgIChrZXksIHZhbHVlKQogICAgICAgICAgICApCiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGzGsHUgY+G6pXUgaMOsbmg6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgZGVsZXRlKHNlbGYsIGtleTogc3RyKSAtPiBib29sOgogICAgICAgICIiIljDs2EgbeG7mXQgY+G6pXUgaMOsbmgga2jhu49pIGRhdGFiYXNlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAga2V5OiBLaMOzYSBj4bqldSBow6xuaCBj4bqnbiB4w7NhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJERUxFVEUgRlJPTSBjb25maWcgV0hFUkUga2V5ID0gPyIsIChrZXksKSkKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgeMOzYSBj4bqldSBow6xuaCB7a2V5fToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBzYXZlX2RldmljZV9pbmZvKHNlbGYsIGRldmljZV9pbmZvOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiJMxrB1IHRow7RuZyB0aW4gdGhp4bq/dCBi4buLIHbDoG8gY+G6pXUgaMOsbmgiIiIKICAgICAgICByZXR1cm4gc2VsZi5zZXQoImRldmljZV9pbmZvIiwgZGV2aWNlX2luZm8pCiAgICAKICAgIGRlZiBnZXRfZGV2aWNlX2luZm8oc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiTOG6pXkgdGjDtG5nIHRpbiB0aGnhur90IGLhu4sgxJHDoyBsxrB1IiIiCiAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldCgiZGV2aWNlX2luZm8iLCB7fSkKICAgICAgICByZXR1cm4gZGV2aWNlX2luZm8KICAgIAogICAgZGVmIGFkZF9hY2NvdW50KHNlbGYsIGFjY291bnRfZGF0YTogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiVGjDqm0gdMOgaSBraG/huqNuIG3hu5tpIHbDoG8gZGF0YWJhc2UiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICAjIEltcG9ydCBjb25maWcgbW9kdWxlCiAgICAgICAgaW1wb3J0IGNvbmZpZyBhcyBjb25maWdfbW9kdWxlCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBraMO0bmcgY8OzIGRldmljZV9pZCwgc+G7rSBk4bulbmcgZGV2aWNlX2lkIGhp4buHbiB04bqhaQogICAgICAgIGRldmljZV9pZCA9IGFjY291bnRfZGF0YS5nZXQoImRldmljZV9pZCIpCiAgICAgICAgaWYgbm90IGRldmljZV9pZDoKICAgICAgICAgICAgZGV2aWNlX2lkID0gc2VsZi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgCiAgICAgICAgIyBUw6FjaCBk4buvIGxp4buHdSBjaMOtbmggdsOgIGThu68gbGnhu4d1IHBo4bulCiAgICAgICAgbWFpbl9kYXRhID0gewogICAgICAgICAgICAiYXBwIjogYWNjb3VudF9kYXRhLmdldCgiYXBwIiwgIiIpLAogICAgICAgICAgICAibmlja25hbWUiOiBhY2NvdW50X2RhdGEuZ2V0KCJuaWNrbmFtZSIsICIiKSwKICAgICAgICAgICAgInVuaXF1ZV9pZCI6IGFjY291bnRfZGF0YS5nZXQoInVuaXF1ZV9pZCIsICIiKSwKICAgICAgICAgICAgInVuaXF1ZV91c2VybmFtZSI6IGFjY291bnRfZGF0YS5nZXQoInVuaXF1ZV91c2VybmFtZSIsICIiKSwKICAgICAgICAgICAgInN0YXR1cyI6IGFjY291bnRfZGF0YS5nZXQoInN0YXR1cyIsICJpbmFjdGl2ZSIpLAogICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogYWNjb3VudF9kYXRhLmdldCgiaW5hY3RpdmVfcmVhc29uIiwgIiIpLAogICAgICAgICAgICAiaXNfbG9naW4iOiAxIGlmIGFjY291bnRfZGF0YS5nZXQoImlzX2xvZ2luIiwgRmFsc2UpIGVsc2UgMCwKICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6IGFjY291bnRfZGF0YS5nZXQoImF2YXRhcl90aHVtYiIsICIiKSwKICAgICAgICAgICAgInRvdGFsX2pvYnMiOiBhY2NvdW50X2RhdGEuZ2V0KCJ0b3RhbF9qb2JzIiwgMCksCiAgICAgICAgICAgICJqb2JfZW5hYmxlIjogMSBpZiBhY2NvdW50X2RhdGEuZ2V0KCJqb2JfZW5hYmxlIiwgVHJ1ZSkgZWxzZSAwLAogICAgICAgICAgICAiam9iX2Rpc2FibGVfdW50aWwiOiBhY2NvdW50X2RhdGEuZ2V0KCJqb2JfZGlzYWJsZV91bnRpbCIsIDApLAogICAgICAgICAgICAiam9iX3RvZGF5IjogYWNjb3VudF9kYXRhLmdldCgiam9iX3RvZGF5IiwgMCksCiAgICAgICAgICAgICJqb2JfbWF4X2RheSI6IGFjY291bnRfZGF0YS5nZXQoImpvYl9tYXhfZGF5IiwgY29uZmlnX21vZHVsZS5NQVhfSk9CU19QRVJfREFZKSwKICAgICAgICAgICAgImpvYnNfZG9uZV9pbl9zZXNzaW9uIjogYWNjb3VudF9kYXRhLmdldCgiam9ic19kb25lX2luX3Nlc3Npb24iLCAwKSwKICAgICAgICAgICAgIm1heF9qb2JzX3Blcl9zZXNzaW9uIjogYWNjb3VudF9kYXRhLmdldCgibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCBjb25maWdfbW9kdWxlLk1BWF9KT0JTX1BFUl9TRVNTSU9OKSwKICAgICAgICAgICAgImxhc3Rfam9iX3RpbWUiOiBhY2NvdW50X2RhdGEuZ2V0KCJsYXN0X2pvYl90aW1lIiwgMCksCiAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICJjYXJlX3RvZGF5IjogYWNjb3VudF9kYXRhLmdldCgiY2FyZV90b2RheSIsIDApLAogICAgICAgICAgICAiaXNfZ29saWtlX2xpbmtlZCI6IDEgaWYgYWNjb3VudF9kYXRhLmdldCgiaXNfZ29saWtlX2xpbmtlZCIsIEZhbHNlKSBlbHNlIDAsCiAgICAgICAgICAgICJnb2xpa2VfaWQiOiBhY2NvdW50X2RhdGEuZ2V0KCJnb2xpa2VfaWQiLCAiIiksCiAgICAgICAgICAgICJkZXZpY2VfaWQiOiBkZXZpY2VfaWQsCiAgICAgICAgICAgICJpc19zeW5jIjogMSBpZiBhY2NvdW50X2RhdGEuZ2V0KCJpc19zeW5jIiwgRmFsc2UpIGVsc2UgMCwKICAgICAgICAgICAgImRpc2FibGVfZm9sbG93IjogMSBpZiBhY2NvdW50X2RhdGEuZ2V0KCJkaXNhYmxlX2ZvbGxvdyIsIEZhbHNlKSBlbHNlIDAsCiAgICAgICAgICAgICJmb2xsb3dfZGlzYWJsZV91bnRpbCI6IGFjY291bnRfZGF0YS5nZXQoImZvbGxvd19kaXNhYmxlX3VudGlsIiwgMCksCiAgICAgICAgICAgICJmb2xsb3dfdG9kYXkiOiBhY2NvdW50X2RhdGEuZ2V0KCJmb2xsb3dfdG9kYXkiLCAwKSwKICAgICAgICAgICAgImZvbGxvd19pbl9zZXNzaW9uIjogYWNjb3VudF9kYXRhLmdldCgiZm9sbG93X2luX3Nlc3Npb24iLCAwKSwKICAgICAgICAgICAgImxhc3RfZm9sbG93X3RpbWUiOiBhY2NvdW50X2RhdGEuZ2V0KCJsYXN0X2ZvbGxvd190aW1lIiwgMCksCiAgICAgICAgICAgICJpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIjogYWNjb3VudF9kYXRhLmdldCgiaW5hY3RpdmVfZm9sbG93X3JlYXNvbiIsICIiKSwKICAgICAgICAgICAgImxhc3RfY2FyZV90aW1lIjogYWNjb3VudF9kYXRhLmdldCgibGFzdF9jYXJlX3RpbWUiLCAwKSwKICAgICAgICAgICAgImxhc3Rfdmlld19zdG9yaWVzIjogYWNjb3VudF9kYXRhLmdldCgibGFzdF92aWV3X3N0b3JpZXMiLCAwKSwKICAgICAgICAgICAgImFjY291bnRfdXVpZCI6IGFjY291bnRfZGF0YS5nZXQoImFjY291bnRfdXVpZCIsIHN0cih1dWlkLnV1aWQ0KCkpKSwgICMgVOG6oW8gVVVJRCBu4bq/dSBjaMawYSBjw7MKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgIyBMxrB1IElEIHThu6sgZOG7ryBsaeG7h3UgxJHhuqd1IHbDoG8gbuG6v3UgY8OzCiAgICAgICAgaWYgImlkIiBpbiBhY2NvdW50X2RhdGE6CiAgICAgICAgICAgIG1haW5fZGF0YVsiaWQiXSA9IGFjY291bnRfZGF0YVsiaWQiXQogICAgICAgIAogICAgICAgICMgTMawdSBk4buvIGxp4buHdSBwaOG7pSBkxrDhu5tpIGThuqFuZyBKU09OCiAgICAgICAgZXh0cmFfZGF0YSA9IHtrOiB2IGZvciBrLCB2IGluIGFjY291bnRfZGF0YS5pdGVtcygpIGlmIGsgbm90IGluIG1haW5fZGF0YX0KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbHVtbnMgPSAiLCAiLmpvaW4obWFpbl9kYXRhLmtleXMoKSkKICAgICAgICAgICAgcGxhY2Vob2xkZXJzID0gIiwgIi5qb2luKFsiPyJdICogbGVuKG1haW5fZGF0YSkpCiAgICAgICAgICAgIAogICAgICAgICAgICB2YWx1ZXMgPSBsaXN0KG1haW5fZGF0YS52YWx1ZXMoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gZOG7ryBsaeG7h3UgcGjhu6UgdsOgbyBjdeG7kWkKICAgICAgICAgICAgY29sdW1ucyArPSAiLCBkYXRhIgogICAgICAgICAgICBwbGFjZWhvbGRlcnMgKz0gIiwgPyIKICAgICAgICAgICAgdmFsdWVzLmFwcGVuZChqc29uLmR1bXBzKGV4dHJhX2RhdGEpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBT4butIGThu6VuZyBJTlNFUlQgT1IgSUdOT1JFIMSR4buDIHRyw6FuaCBs4buXaSBkdXBsaWNhdGUsIHNhdSDEkcOzIFVQREFURSBu4bq/dSBj4bqnbgogICAgICAgICAgICBpZiAiaWQiIGluIG1haW5fZGF0YToKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIElELCBz4butIGThu6VuZyBJTlNFUlQgT1IgUkVQTEFDRSAodXBkYXRlIGV4aXN0aW5nIHJlY29yZCkKICAgICAgICAgICAgICAgIHF1ZXJ5ID0gZiJJTlNFUlQgT1IgUkVQTEFDRSBJTlRPIGFjY291bnRzICh7Y29sdW1uc30pIFZBTFVFUyAoe3BsYWNlaG9sZGVyc30pIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgY8OzIElELCBraeG7g20gdHJhIGR1cGxpY2F0ZSBi4bqxbmcgdW5pcXVlIGNvbnN0cmFpbnQKICAgICAgICAgICAgICAgIGFwcCA9IG1haW5fZGF0YS5nZXQoImFwcCIpCiAgICAgICAgICAgICAgICB1bmlxdWVfdXNlcm5hbWUgPSBtYWluX2RhdGEuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBhcHAgYW5kIHVuaXF1ZV91c2VybmFtZToKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiDEkcOjIHThu5NuIHThuqFpIGNoxrBhCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBpZCBGUk9NIGFjY291bnRzIFdIRVJFIGFwcCA9ID8gQU5EIHVuaXF1ZV91c2VybmFtZSA9ID8iLCAoYXBwLCB1bmlxdWVfdXNlcm5hbWUpKQogICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nID0gY3Vyc29yLmZldGNob25lKCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBleGlzdGluZzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6BpIGtob+G6o24gxJHDoyB04buTbiB04bqhaSwgY+G6rXAgbmjhuq10IHRow7RuZyB0aW4KICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfaWQgPSBleGlzdGluZ1swXQogICAgICAgICAgICAgICAgICAgICAgICAjIExv4bqhaSBi4buPIGlkIGto4buPaSBtYWluX2RhdGEgxJHhu4MgdXBkYXRlCiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0ge2s6IHYgZm9yIGssIHYgaW4gbWFpbl9kYXRhLml0ZW1zKCkgaWYgayAhPSAiaWQifQogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGF0YVsiZGF0YSJdID0ganNvbi5kdW1wcyhleHRyYV9kYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgc2V0X2NsYXVzZSA9ICIsICIuam9pbihbZiJ7a30gPSA/IiBmb3IgayBpbiB1cGRhdGVfZGF0YS5rZXlzKCldKQogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVfcXVlcnkgPSBmIlVQREFURSBhY2NvdW50cyBTRVQge3NldF9jbGF1c2V9IFdIRVJFIGlkID0gPyIKICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUodXBkYXRlX3F1ZXJ5LCBsaXN0KHVwZGF0ZV9kYXRhLnZhbHVlcygpKSArIFtleGlzdGluZ19pZF0pCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIFTDoGkga2hv4bqjbiBjaMawYSB04buTbiB04bqhaSwgdGjDqm0gbeG7m2kKICAgICAgICAgICAgICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBpZCBraOG7j2kgbWFpbl9kYXRhIMSR4buDIElOU0VSVAogICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRfZGF0YSA9IHtrOiB2IGZvciBrLCB2IGluIG1haW5fZGF0YS5pdGVtcygpIGlmIGsgIT0gImlkIn0KICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0X2NvbHVtbnMgPSAiLCAiLmpvaW4oaW5zZXJ0X2RhdGEua2V5cygpKSArICIsIGRhdGEiCiAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydF9wbGFjZWhvbGRlcnMgPSAiLCAiLmpvaW4oWyI/Il0gKiBsZW4oaW5zZXJ0X2RhdGEpKSArICIsID8iCiAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydF92YWx1ZXMgPSBsaXN0KGluc2VydF9kYXRhLnZhbHVlcygpKSArIFtqc29uLmR1bXBzKGV4dHJhX2RhdGEpXQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSBmIklOU0VSVCBJTlRPIGFjY291bnRzICh7aW5zZXJ0X2NvbHVtbnN9KSBWQUxVRVMgKHtpbnNlcnRfcGxhY2Vob2xkZXJzfSkiCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKHF1ZXJ5LCBpbnNlcnRfdmFsdWVzKQogICAgICAgICAgICAgICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgS2jDtG5nIGPDsyBhcHAgaG/hurdjIHVuaXF1ZV91c2VybmFtZSwgc+G7rSBk4bulbmcgSU5TRVJUIGLDrG5oIHRoxrDhu51uZwogICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gZiJJTlNFUlQgSU5UTyBhY2NvdW50cyAoe2NvbHVtbnN9KSBWQUxVRVMgKHtwbGFjZWhvbGRlcnN9KSIKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICJpZCIgaW4gbWFpbl9kYXRhOgogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUocXVlcnksIHZhbHVlcykKICAgICAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aMOqbSB0w6BpIGtob+G6o246IHtlfSIpCiAgICAgICAgICAgIGNvbm4ucm9sbGJhY2soKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHVwZGF0ZV9hY2NvdW50KHNlbGYsIGFjY291bnRfaWQ6IGludCwgZGF0YTogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdMOgaSBraG/huqNuIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IHTDoGkga2hv4bqjbiBoaeG7h24gdOG6oWkKICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZ2V0X2FjY291bnQoYWNjb3VudF9pZCkKICAgICAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgICAgICBwcmludChmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gduG7m2kgSUQge2FjY291bnRfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgZOG7ryBsaeG7h3UKICAgICAgICAgICAgYWNjb3VudC51cGRhdGUoZGF0YSkKICAgICAgICAgICAgYWNjb3VudFsibGFzdF91cGRhdGUiXSA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRw6FuaCBk4bqldSBj4bqnbiBzeW5jIHRy4burIGtoaSBkYXRhIMSRw6MgY8OzIGlzX3N5bmMgxJHGsOG7o2Mgc2V0IHLDtSByw6BuZwogICAgICAgICAgICBpZiAiaXNfc3luYyIgbm90IGluIGRhdGE6CiAgICAgICAgICAgICAgICBhY2NvdW50WyJpc19zeW5jIl0gPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6FjaCBtYWluX2RhdGEgdsOgIGV4dHJhX2RhdGEKICAgICAgICAgICAgIyBM4bqleSB04bqldCBj4bqjIGPDoWMgY+G7mXQgY+G7p2EgYuG6o25nIGFjY291bnRzCiAgICAgICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlBSQUdNQSB0YWJsZV9pbmZvKGFjY291bnRzKSIpCiAgICAgICAgICAgIGNvbHVtbnMgPSBbcm93WzFdIGZvciByb3cgaW4gY3Vyc29yLmZldGNoYWxsKCldCiAgICAgICAgICAgIG1haW5fZGF0YSA9IHt9CiAgICAgICAgICAgIGV4dHJhX2RhdGEgPSB7fQogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBhY2NvdW50Lml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiBrZXkgaW4gY29sdW1uczoKICAgICAgICAgICAgICAgICAgICBtYWluX2RhdGFba2V5XSA9IHZhbHVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGV4dHJhX2RhdGFba2V5XSA9IHZhbHVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFPhu60gZOG7pW5nIGjDoG0gdXBkYXRlIGNodXnDqm4gYmnhu4d0CiAgICAgICAgICAgIHJldHVybiBzZWxmLnVwZGF0ZV9hY2NvdW50X2J5X2lkKGFjY291bnRfaWQsIG1haW5fZGF0YSwgZXh0cmFfZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGdldF9hY2NvdW50KHNlbGYsIGFjY291bnRfaWQ6IGludCkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIkzhuqV5IHRow7RuZyB0aW4gY+G7p2EgbeG7mXQgdMOgaSBraG/huqNuIHRoZW8gSUQiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUICogRlJPTSBhY2NvdW50cyBXSEVSRSBpZCA9ID8iLCAoYWNjb3VudF9pZCwpKQogICAgICAgIGNvbHVtbl9uYW1lcyA9IFtkZXNjcmlwdGlvblswXSBmb3IgZGVzY3JpcHRpb24gaW4gY3Vyc29yLmRlc2NyaXB0aW9uXQogICAgICAgIHJlc3VsdCA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHJlc3VsdDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkga+G6v3QgcXXhuqMgdGjDoG5oIGRpY3QKICAgICAgICBhY2NvdW50ID0ge2NvbHVtbl9uYW1lc1tpXTogcmVzdWx0W2ldIGZvciBpIGluIHJhbmdlKGxlbihjb2x1bW5fbmFtZXMpKX0KICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBib29sZWFuCiAgICAgICAgYWNjb3VudFsiaXNfbG9naW4iXSA9IGJvb2woYWNjb3VudFsiaXNfbG9naW4iXSkKICAgICAgICBhY2NvdW50WyJqb2JfZW5hYmxlIl0gPSBib29sKGFjY291bnRbImpvYl9lbmFibGUiXSkKICAgICAgICBhY2NvdW50WyJpc19nb2xpa2VfbGlua2VkIl0gPSBib29sKGFjY291bnRbImlzX2dvbGlrZV9saW5rZWQiXSkKICAgICAgICBhY2NvdW50WyJpc19zeW5jIl0gPSBib29sKGFjY291bnRbImlzX3N5bmMiXSkKICAgICAgICBhY2NvdW50WyJkaXNhYmxlX2ZvbGxvdyJdID0gYm9vbChhY2NvdW50WyJkaXNhYmxlX2ZvbGxvdyJdKQogICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGPDoWMgdHLGsOG7nW5nIGZvbGxvdyB0aMOgbmgga2nhu4N1IGThu68gbGnhu4d1IHBow7kgaOG7o3AKICAgICAgICBpZiAiZm9sbG93X3RvZGF5IiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJmb2xsb3dfdG9kYXkiXSA9IGludChhY2NvdW50WyJmb2xsb3dfdG9kYXkiXSkgaWYgYWNjb3VudFsiZm9sbG93X3RvZGF5Il0gZWxzZSAwCiAgICAgICAgaWYgImZvbGxvd19pbl9zZXNzaW9uIiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJmb2xsb3dfaW5fc2Vzc2lvbiJdID0gaW50KGFjY291bnRbImZvbGxvd19pbl9zZXNzaW9uIl0pIGlmIGFjY291bnRbImZvbGxvd19pbl9zZXNzaW9uIl0gZWxzZSAwCiAgICAgICAgIyDEkMOjIGxv4bqhaSBi4buPIG1heF9mb2xsb3dfZGF5IHbDoCBtYXhfZm9sbG93X3Nlc3Npb24KICAgICAgICBpZiAibGFzdF9mb2xsb3dfdGltZSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibGFzdF9mb2xsb3dfdGltZSJdID0gaW50KGFjY291bnRbImxhc3RfZm9sbG93X3RpbWUiXSkgaWYgYWNjb3VudFsibGFzdF9mb2xsb3dfdGltZSJdIGVsc2UgMAogICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGPDoWMgdHLGsOG7nW5nIGNhcmUgdGjDoG5oIGtp4buDdSBk4buvIGxp4buHdSBwaMO5IGjhu6NwCiAgICAgICAgaWYgImxhc3RfY2FyZV90aW1lIiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdID0gaW50KGFjY291bnRbImxhc3RfY2FyZV90aW1lIl0pIGlmIGFjY291bnRbImxhc3RfY2FyZV90aW1lIl0gZWxzZSAwCiAgICAgICAgaWYgImxhc3Rfdmlld19zdG9yaWVzIiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJsYXN0X3ZpZXdfc3RvcmllcyJdID0gaW50KGFjY291bnRbImxhc3Rfdmlld19zdG9yaWVzIl0pIGlmIGFjY291bnRbImxhc3Rfdmlld19zdG9yaWVzIl0gZWxzZSAwCiAgICAgICAgCiAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBwaOG7pSB04burIHRyxrDhu51uZyBkYXRhCiAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQgYW5kIGFjY291bnRbImRhdGEiXToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZXh0cmFfZGF0YSA9IGpzb24ubG9hZHMoYWNjb3VudFsiZGF0YSJdKQogICAgICAgICAgICAgICAgYWNjb3VudC51cGRhdGUoZXh0cmFfZGF0YSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAjIFjDs2EgdHLGsOG7nW5nIGRhdGEgxJHhu4MgdHLDoW5oIHRyw7luZyBs4bq3cAogICAgICAgIGlmICJkYXRhIiBpbiBhY2NvdW50OgogICAgICAgICAgICBkZWwgYWNjb3VudFsiZGF0YSJdCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhY2NvdW50CgogICAgZGVmIHVwZGF0ZV9hY2NvdW50X2J5X2lkKHNlbGYsIGFjY291bnRfaWQsIG1haW5fZGF0YSwgZXh0cmFfZGF0YT1Ob25lKToKICAgICAgICAiIiJD4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHRoZW8gSUQiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTHXDtG4gc2V0IGlzX3N5bmMgPSBGYWxzZSBraGkgdXBkYXRlCiAgICAgICAgICAgIG1haW5fZGF0YVsiaXNfc3luYyJdID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6oW8gY8OidSBs4buHbmggVVBEQVRFCiAgICAgICAgICAgIHVwZGF0ZV9maWVsZHMgPSBbXQogICAgICAgICAgICB2YWx1ZXMgPSBbXQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gbWFpbl9kYXRhLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiBrZXkgIT0gImlkIjogICMgS2jDtG5nIHVwZGF0ZSBJRAogICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9maWVsZHMuYXBwZW5kKGYie2tleX0gPSA/IikKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMuYXBwZW5kKHZhbHVlKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZXh0cmFfZGF0YToKICAgICAgICAgICAgICAgIHVwZGF0ZV9maWVsZHMuYXBwZW5kKCJkYXRhID0gPyIpCiAgICAgICAgICAgICAgICB2YWx1ZXMuYXBwZW5kKGpzb24uZHVtcHMoZXh0cmFfZGF0YSkpCiAgICAgICAgICAgIAogICAgICAgICAgICB2YWx1ZXMuYXBwZW5kKGFjY291bnRfaWQpICAjIFdIRVJFIGlkID0gPwogICAgICAgICAgICAKICAgICAgICAgICAgcXVlcnkgPSBmIlVQREFURSBhY2NvdW50cyBTRVQgeycsICcuam9pbih1cGRhdGVfZmllbGRzKX0gV0hFUkUgaWQgPSA/IgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZShxdWVyeSwgdmFsdWVzKQogICAgICAgICAgICAKICAgICAgICAgICAgcm93c19hZmZlY3RlZCA9IGN1cnNvci5yb3djb3VudAogICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByb3dzX2FmZmVjdGVkID4gMDoKICAgICAgICAgICAgICAgIHByaW50KGYiQ+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiBJRCB7YWNjb3VudF9pZH0gdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gduG7m2kgSUQge2FjY291bnRfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuOiB7ZX0iKQogICAgICAgICAgICBjb25uLnJvbGxiYWNrKCkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGdldF9hY2NvdW50X2J5X3VuaXF1ZV91c2VybmFtZShzZWxmLCBhcHA6IHN0ciwgdW5pcXVlX3VzZXJuYW1lOiBzdHIpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0aMO0bmcgdGluIHTDoGkga2hv4bqjbiB0aGVvIGFwcCB2w6AgdW5pcXVlX3VzZXJuYW1lCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYXBwOiBUw6puIOG7qW5nIGThu6VuZwogICAgICAgICAgICB1bmlxdWVfdXNlcm5hbWU6IFVzZXJuYW1lIGR1eSBuaOG6pXQgY+G7p2EgdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3QgY2jhu6lhIHRow7RuZyB0aW4gdMOgaSBraG/huqNuIGhv4bq3YyBOb25lIG7hur91IGtow7RuZyB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIGlmIG5vdCB1bmlxdWVfdXNlcm5hbWU6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgKiBGUk9NIGFjY291bnRzIFdIRVJFIGFwcCA9ID8gQU5EIHVuaXF1ZV91c2VybmFtZSA9ID8iLCAoYXBwLCB1bmlxdWVfdXNlcm5hbWUpKQogICAgICAgIGNvbHVtbl9uYW1lcyA9IFtkZXNjcmlwdGlvblswXSBmb3IgZGVzY3JpcHRpb24gaW4gY3Vyc29yLmRlc2NyaXB0aW9uXQogICAgICAgIHJlc3VsdCA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHJlc3VsdDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkga+G6v3QgcXXhuqMgdGjDoG5oIGRpY3QKICAgICAgICBhY2NvdW50ID0ge2NvbHVtbl9uYW1lc1tpXTogcmVzdWx0W2ldIGZvciBpIGluIHJhbmdlKGxlbihjb2x1bW5fbmFtZXMpKX0KICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBib29sZWFuCiAgICAgICAgYWNjb3VudFsiaXNfbG9naW4iXSA9IGJvb2woYWNjb3VudFsiaXNfbG9naW4iXSkKICAgICAgICBhY2NvdW50WyJqb2JfZW5hYmxlIl0gPSBib29sKGFjY291bnRbImpvYl9lbmFibGUiXSkKICAgICAgICBhY2NvdW50WyJpc19nb2xpa2VfbGlua2VkIl0gPSBib29sKGFjY291bnRbImlzX2dvbGlrZV9saW5rZWQiXSkKICAgICAgICBhY2NvdW50WyJpc19zeW5jIl0gPSBib29sKGFjY291bnRbImlzX3N5bmMiXSkKICAgICAgICBhY2NvdW50WyJkaXNhYmxlX2ZvbGxvdyJdID0gYm9vbChhY2NvdW50WyJkaXNhYmxlX2ZvbGxvdyJdKQogICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGPDoWMgdHLGsOG7nW5nIGZvbGxvdyB0aMOgbmgga2nhu4N1IGThu68gbGnhu4d1IHBow7kgaOG7o3AKICAgICAgICBpZiAiZm9sbG93X3RvZGF5IiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJmb2xsb3dfdG9kYXkiXSA9IGludChhY2NvdW50WyJmb2xsb3dfdG9kYXkiXSkgaWYgYWNjb3VudFsiZm9sbG93X3RvZGF5Il0gZWxzZSAwCiAgICAgICAgaWYgImZvbGxvd19pbl9zZXNzaW9uIiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJmb2xsb3dfaW5fc2Vzc2lvbiJdID0gaW50KGFjY291bnRbImZvbGxvd19pbl9zZXNzaW9uIl0pIGlmIGFjY291bnRbImZvbGxvd19pbl9zZXNzaW9uIl0gZWxzZSAwCiAgICAgICAgIyDEkMOjIGxv4bqhaSBi4buPIG1heF9mb2xsb3dfZGF5IHbDoCBtYXhfZm9sbG93X3Nlc3Npb24KICAgICAgICBpZiAibGFzdF9mb2xsb3dfdGltZSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibGFzdF9mb2xsb3dfdGltZSJdID0gaW50KGFjY291bnRbImxhc3RfZm9sbG93X3RpbWUiXSkgaWYgYWNjb3VudFsibGFzdF9mb2xsb3dfdGltZSJdIGVsc2UgMAogICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGPDoWMgdHLGsOG7nW5nIGNhcmUgdGjDoG5oIGtp4buDdSBk4buvIGxp4buHdSBwaMO5IGjhu6NwCiAgICAgICAgaWYgImxhc3RfY2FyZV90aW1lIiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdID0gaW50KGFjY291bnRbImxhc3RfY2FyZV90aW1lIl0pIGlmIGFjY291bnRbImxhc3RfY2FyZV90aW1lIl0gZWxzZSAwCiAgICAgICAgaWYgImxhc3Rfdmlld19zdG9yaWVzIiBpbiBhY2NvdW50OgogICAgICAgICAgICBhY2NvdW50WyJsYXN0X3ZpZXdfc3RvcmllcyJdID0gaW50KGFjY291bnRbImxhc3Rfdmlld19zdG9yaWVzIl0pIGlmIGFjY291bnRbImxhc3Rfdmlld19zdG9yaWVzIl0gZWxzZSAwCiAgICAgICAgCiAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBwaOG7pSB04burIHRyxrDhu51uZyBkYXRhCiAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQgYW5kIGFjY291bnRbImRhdGEiXToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZXh0cmFfZGF0YSA9IGpzb24ubG9hZHMoYWNjb3VudFsiZGF0YSJdKQogICAgICAgICAgICAgICAgYWNjb3VudC51cGRhdGUoZXh0cmFfZGF0YSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAjIFjDs2EgdHLGsOG7nW5nIGRhdGEgxJHhu4MgdHLDoW5oIHRyw7luZyBs4bq3cAogICAgICAgIGlmICJkYXRhIiBpbiBhY2NvdW50OgogICAgICAgICAgICBkZWwgYWNjb3VudFsiZGF0YSJdCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhY2NvdW50CiAgICAKICAgIGRlZiBnZXRfYWNjb3VudF9ieV91dWlkKHNlbGYsIGFjY291bnRfdXVpZDogc3RyKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiTOG6pXkgdGjDtG5nIHRpbiBj4bunYSBt4buZdCB0w6BpIGtob+G6o24gdGhlbyBVVUlEIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCAqIEZST00gYWNjb3VudHMgV0hFUkUgYWNjb3VudF91dWlkID0gPyIsIChhY2NvdW50X3V1aWQsKSkKICAgICAgICBjb2x1bW5fbmFtZXMgPSBbZGVzY3JpcHRpb25bMF0gZm9yIGRlc2NyaXB0aW9uIGluIGN1cnNvci5kZXNjcmlwdGlvbl0KICAgICAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgIAogICAgICAgIGlmIG5vdCByZXN1bHQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGvhur90IHF14bqjIHRow6BuaCBkaWN0CiAgICAgICAgYWNjb3VudCA9IHtjb2x1bW5fbmFtZXNbaV06IHJlc3VsdFtpXSBmb3IgaSBpbiByYW5nZShsZW4oY29sdW1uX25hbWVzKSl9CiAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgYm9vbGVhbgogICAgICAgIGFjY291bnRbImlzX2xvZ2luIl0gPSBib29sKGFjY291bnRbImlzX2xvZ2luIl0pCiAgICAgICAgYWNjb3VudFsiam9iX2VuYWJsZSJdID0gYm9vbChhY2NvdW50WyJqb2JfZW5hYmxlIl0pCiAgICAgICAgYWNjb3VudFsiaXNfZ29saWtlX2xpbmtlZCJdID0gYm9vbChhY2NvdW50WyJpc19nb2xpa2VfbGlua2VkIl0pCiAgICAgICAgYWNjb3VudFsiaXNfc3luYyJdID0gYm9vbChhY2NvdW50WyJpc19zeW5jIl0pCiAgICAgICAgYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXSA9IGJvb2woYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXSkKICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBmb2xsb3cgdGjDoG5oIGtp4buDdSBk4buvIGxp4buHdSBwaMO5IGjhu6NwCiAgICAgICAgaWYgImZvbGxvd190b2RheSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsiZm9sbG93X3RvZGF5Il0gPSBpbnQoYWNjb3VudFsiZm9sbG93X3RvZGF5Il0pIGlmIGFjY291bnRbImZvbGxvd190b2RheSJdIGVsc2UgMAogICAgICAgIGlmICJmb2xsb3dfaW5fc2Vzc2lvbiIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsiZm9sbG93X2luX3Nlc3Npb24iXSA9IGludChhY2NvdW50WyJmb2xsb3dfaW5fc2Vzc2lvbiJdKSBpZiBhY2NvdW50WyJmb2xsb3dfaW5fc2Vzc2lvbiJdIGVsc2UgMAogICAgICAgICMgxJDDoyBsb+G6oWkgYuG7jyBtYXhfZm9sbG93X2RheSB2w6AgbWF4X2ZvbGxvd19zZXNzaW9uCiAgICAgICAgaWYgImxhc3RfZm9sbG93X3RpbWUiIGluIGFjY291bnQ6CiAgICAgICAgICAgIGFjY291bnRbImxhc3RfZm9sbG93X3RpbWUiXSA9IGludChhY2NvdW50WyJsYXN0X2ZvbGxvd190aW1lIl0pIGlmIGFjY291bnRbImxhc3RfZm9sbG93X3RpbWUiXSBlbHNlIDAKICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBjYXJlIHRow6BuaCBraeG7g3UgZOG7ryBsaeG7h3UgcGjDuSBo4bujcAogICAgICAgIGlmICJsYXN0X2NhcmVfdGltZSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibGFzdF9jYXJlX3RpbWUiXSA9IGludChhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdKSBpZiBhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdIGVsc2UgMAogICAgICAgIGlmICJsYXN0X3ZpZXdfc3RvcmllcyIgaW4gYWNjb3VudDoKICAgICAgICAgICAgYWNjb3VudFsibGFzdF92aWV3X3N0b3JpZXMiXSA9IGludChhY2NvdW50WyJsYXN0X3ZpZXdfc3RvcmllcyJdKSBpZiBhY2NvdW50WyJsYXN0X3ZpZXdfc3RvcmllcyJdIGVsc2UgMAogICAgICAgIAogICAgICAgICMgVGjDqm0gZOG7ryBsaeG7h3UgcGjhu6UgdOG7qyB0csaw4budbmcgZGF0YQogICAgICAgIGlmICJkYXRhIiBpbiBhY2NvdW50IGFuZCBhY2NvdW50WyJkYXRhIl06CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGV4dHJhX2RhdGEgPSBqc29uLmxvYWRzKGFjY291bnRbImRhdGEiXSkKICAgICAgICAgICAgICAgIGFjY291bnQudXBkYXRlKGV4dHJhX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgIyBYw7NhIHRyxrDhu51uZyBkYXRhIMSR4buDIHRyw6FuaCB0csO5bmcgbOG6t3AKICAgICAgICBpZiAiZGF0YSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgZGVsIGFjY291bnRbImRhdGEiXQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gYWNjb3VudAogICAgCiAgICBkZWYgZ2V0X2FjY291bnRzKHNlbGYsIGFwcDogc3RyID0gTm9uZSwgc3RhdHVzOiBzdHIgPSBOb25lLCBqb2JfZW5hYmxlOiBib29sID0gTm9uZSwgZGV2aWNlX2lkOiBBbnkgPSBUcnVlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiJM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiB0aGVvIMSRaeG7gXUga2nhu4duIGzhu41jCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYXBwOiBUw6puIOG7qW5nIGThu6VuZyDEkeG7gyBs4buNYwogICAgICAgICAgICBzdGF0dXM6IFRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuIMSR4buDIGzhu41jCiAgICAgICAgICAgIGpvYl9lbmFibGU6IEzhu41jIHRoZW8gdHLhuqFuZyB0aMOhaSBi4bqtdC904bqvdCBqb2IKICAgICAgICAgICAgZGV2aWNlX2lkOiBM4buNYyB0aGVvIGRldmljZV9pZCwgY8OzIHRo4buDIGzDoDoKICAgICAgICAgICAgICAgIC0gVHJ1ZTogTOG7jWMgdGhlbyBkZXZpY2VfaWQgY+G7p2EgdGhp4bq/dCBi4buLIGhp4buHbiB04bqhaSAobeG6t2MgxJHhu4tuaCkKICAgICAgICAgICAgICAgIC0gRmFsc2UvTm9uZTogS2jDtG5nIGzhu41jIHRoZW8gZGV2aWNlX2lkCiAgICAgICAgICAgICAgICAtIENodeG7l2k6IEzhu41jIHRoZW8gZGV2aWNlX2lkIGPhu6UgdGjhu4MgxJHGsOG7o2MgdHJ1eeG7gW4gdsOgbwogICAgICAgICIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgIHF1ZXJ5ID0gIlNFTEVDVCAqIEZST00gYWNjb3VudHMiCiAgICAgICAgcGFyYW1zID0gW10KICAgICAgICAKICAgICAgICAjIFRow6ptIMSRaeG7gXUga2nhu4duIGzhu41jCiAgICAgICAgY29uZGl0aW9ucyA9IFtdCiAgICAgICAgaWYgYXBwOgogICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZCgiYXBwID0gPyIpCiAgICAgICAgICAgIHBhcmFtcy5hcHBlbmQoYXBwKQogICAgICAgIGlmIHN0YXR1czoKICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoInN0YXR1cyA9ID8iKQogICAgICAgICAgICBwYXJhbXMuYXBwZW5kKHN0YXR1cykKICAgICAgICBpZiBqb2JfZW5hYmxlIGlzIG5vdCBOb25lOgogICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZCgiam9iX2VuYWJsZSA9ID8iKQogICAgICAgICAgICBwYXJhbXMuYXBwZW5kKDEgaWYgam9iX2VuYWJsZSBlbHNlIDApCiAgICAgICAgICAgIAogICAgICAgIGlmIGNvbmRpdGlvbnM6CiAgICAgICAgICAgIHF1ZXJ5ICs9ICIgV0hFUkUgIiArICIgQU5EICIuam9pbihjb25kaXRpb25zKQogICAgICAgICAgICAKICAgICAgICBjdXJzb3IuZXhlY3V0ZShxdWVyeSwgcGFyYW1zKQogICAgICAgIGNvbHVtbl9uYW1lcyA9IFtkZXNjcmlwdGlvblswXSBmb3IgZGVzY3JpcHRpb24gaW4gY3Vyc29yLmRlc2NyaXB0aW9uXQogICAgICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgICAgIAogICAgICAgIGFjY291bnRzID0gW10KICAgICAgICBmb3IgcmVzdWx0IGluIHJlc3VsdHM6CiAgICAgICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGvhur90IHF14bqjIHRow6BuaCBkaWN0CiAgICAgICAgICAgIGFjY291bnQgPSB7Y29sdW1uX25hbWVzW2ldOiByZXN1bHRbaV0gZm9yIGkgaW4gcmFuZ2UobGVuKGNvbHVtbl9uYW1lcykpfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgYm9vbGVhbgogICAgICAgICAgICBhY2NvdW50WyJpc19sb2dpbiJdID0gYm9vbChhY2NvdW50WyJpc19sb2dpbiJdKQogICAgICAgICAgICBhY2NvdW50WyJqb2JfZW5hYmxlIl0gPSBib29sKGFjY291bnRbImpvYl9lbmFibGUiXSkKICAgICAgICAgICAgYWNjb3VudFsiaXNfZ29saWtlX2xpbmtlZCJdID0gYm9vbChhY2NvdW50WyJpc19nb2xpa2VfbGlua2VkIl0pCiAgICAgICAgICAgIGFjY291bnRbImlzX3N5bmMiXSA9IGJvb2woYWNjb3VudFsiaXNfc3luYyJdKSAgICAgICAgICAgICMgRml4OiBQcmVzZXJ2ZSBkaXNhYmxlX2ZvbGxvdyBzdGF0dXMgZnJvbSBkYXRhYmFzZQogICAgICAgICAgICBhY2NvdW50WyJkaXNhYmxlX2ZvbGxvdyJdID0gYm9vbChhY2NvdW50WyJkaXNhYmxlX2ZvbGxvdyJdKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgZm9sbG93IHRow6BuaCBraeG7g3UgZOG7ryBsaeG7h3UgcGjDuSBo4bujcAogICAgICAgICAgICBpZiAiZm9sbG93X3RvZGF5IiBpbiBhY2NvdW50OgogICAgICAgICAgICAgICAgYWNjb3VudFsiZm9sbG93X3RvZGF5Il0gPSBpbnQoYWNjb3VudFsiZm9sbG93X3RvZGF5Il0pIGlmIGFjY291bnRbImZvbGxvd190b2RheSJdIGVsc2UgMAogICAgICAgICAgICBpZiAiZm9sbG93X2luX3Nlc3Npb24iIGluIGFjY291bnQ6CiAgICAgICAgICAgICAgICBhY2NvdW50WyJmb2xsb3dfaW5fc2Vzc2lvbiJdID0gaW50KGFjY291bnRbImZvbGxvd19pbl9zZXNzaW9uIl0pIGlmIGFjY291bnRbImZvbGxvd19pbl9zZXNzaW9uIl0gZWxzZSAwCiAgICAgICAgICAgICMgxJDDoyBsb+G6oWkgYuG7jyBtYXhfZm9sbG93X2RheSB2w6AgbWF4X2ZvbGxvd19zZXNzaW9uCiAgICAgICAgICAgIGlmICJsYXN0X2ZvbGxvd190aW1lIiBpbiBhY2NvdW50OgogICAgICAgICAgICAgICAgYWNjb3VudFsibGFzdF9mb2xsb3dfdGltZSJdID0gaW50KGFjY291bnRbImxhc3RfZm9sbG93X3RpbWUiXSkgaWYgYWNjb3VudFsibGFzdF9mb2xsb3dfdGltZSJdIGVsc2UgMAogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgY2FyZSB0aMOgbmgga2nhu4N1IGThu68gbGnhu4d1IHBow7kgaOG7o3AKICAgICAgICAgICAgaWYgImxhc3RfY2FyZV90aW1lIiBpbiBhY2NvdW50OgogICAgICAgICAgICAgICAgYWNjb3VudFsibGFzdF9jYXJlX3RpbWUiXSA9IGludChhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdKSBpZiBhY2NvdW50WyJsYXN0X2NhcmVfdGltZSJdIGVsc2UgMAogICAgICAgICAgICBpZiAibGFzdF92aWV3X3N0b3JpZXMiIGluIGFjY291bnQ6CiAgICAgICAgICAgICAgICBhY2NvdW50WyJsYXN0X3ZpZXdfc3RvcmllcyJdID0gaW50KGFjY291bnRbImxhc3Rfdmlld19zdG9yaWVzIl0pIGlmIGFjY291bnRbImxhc3Rfdmlld19zdG9yaWVzIl0gZWxzZSAwCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGThu68gbGnhu4d1IHBo4bulIHThu6sgdHLGsOG7nW5nIGRhdGEKICAgICAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQgYW5kIGFjY291bnRbImRhdGEiXToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBleHRyYV9kYXRhID0ganNvbi5sb2FkcyhhY2NvdW50WyJkYXRhIl0pCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudC51cGRhdGUoZXh0cmFfZGF0YSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBYw7NhIHRyxrDhu51uZyBkYXRhIMSR4buDIHRyw6FuaCB0csO5bmcgbOG6t3AKICAgICAgICAgICAgaWYgImRhdGEiIGluIGFjY291bnQ6CiAgICAgICAgICAgICAgICBkZWwgYWNjb3VudFsiZGF0YSJdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKGFjY291bnQpCiAgICAgICAgCiAgICAgICAgIyBM4buNYyB0aGVvIGRldmljZV9pZCBu4bq/dSBj4bqnbgogICAgICAgIGlmIGRldmljZV9pZCBpcyBUcnVlOgogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZCBj4bunYSB0aGnhur90IGLhu4sgaGnhu4duIHThuqFpCiAgICAgICAgICAgIGN1cnJlbnRfZGV2aWNlX2lkID0gc2VsZi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgY3VycmVudF9kZXZpY2VfaWQ6CiAgICAgICAgICAgICAgICAjIEzhu41jIHTDoGkga2hv4bqjbiB0aGVvIGRldmljZV9pZCBj4bunYSB0aGnhur90IGLhu4sgaGnhu4duIHThuqFpCiAgICAgICAgICAgICAgICBhY2NvdW50cyA9IFthY2MgZm9yIGFjYyBpbiBhY2NvdW50cyBpZiBhY2MuZ2V0KCJkZXZpY2VfaWQiKSA9PSBjdXJyZW50X2RldmljZV9pZF0KICAgICAgICBlbGlmIGlzaW5zdGFuY2UoZGV2aWNlX2lkLCBzdHIpIGFuZCBkZXZpY2VfaWQ6CiAgICAgICAgICAgICMgTOG7jWMgdGhlbyBkZXZpY2VfaWQgY+G7pSB0aOG7gyDEkcaw4bujYyB0cnV54buBbiB2w6BvCiAgICAgICAgICAgIGFjY291bnRzID0gW2FjYyBmb3IgYWNjIGluIGFjY291bnRzIGlmIGFjYy5nZXQoImRldmljZV9pZCIpID09IGRldmljZV9pZF0KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGFjY291bnRzCiAgICAKICAgIGRlZiBkZWxldGVfam9iX2hpc3RvcnlfYnlfYWNjb3VudChzZWxmLCBhY2NvdW50X3V1aWQ6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiJYw7NhIHThuqV0IGPhuqMgam9iIGhpc3RvcnkgY+G7p2EgbeG7mXQgdMOgaSBraG/huqNuIHRoZW8gYWNjb3VudF91dWlkIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiREVMRVRFIEZST00gam9ic19oaXN0b3J5IFdIRVJFIGFjY291bnRfdXVpZCA9ID8iLCAoYWNjb3VudF91dWlkLCkpCiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgZGVsZXRlZF9jb3VudCA9IGN1cnNvci5yb3djb3VudAogICAgICAgICAgICBwcmludChmIsSQw6MgeMOzYSB7ZGVsZXRlZF9jb3VudH0gam9iIGhpc3RvcnkgY+G7p2EgdMOgaSBraG/huqNuIFVVSUQ6IHthY2NvdW50X3V1aWR9IikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHjDs2Egam9iIGhpc3RvcnkgY+G7p2EgdMOgaSBraG/huqNuOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZGVsZXRlX2FjY291bnQoc2VsZiwgYWNjb3VudF9pZDogaW50KSAtPiBib29sOgogICAgICAgICIiIljDs2EgdMOgaSBraG/huqNuIGto4buPaSBkYXRhYmFzZSIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIHRyeToKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIkRFTEVURSBGUk9NIGFjY291bnRzIFdIRVJFIGlkID0gPyIsIChhY2NvdW50X2lkLCkpCiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgcmV0dXJuIGN1cnNvci5yb3djb3VudCA+IDAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHjDs2EgdMOgaSBraG/huqNuOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGNsb3NlKHNlbGYpOgogICAgICAgICIiIsSQw7NuZyBr4bq/dCBu4buRaSBkYXRhYmFzZSBj4bunYSB0aHJlYWQgaGnhu4duIHThuqFpIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYubG9jYWwsICdjb25uJykgYW5kIHNlbGYubG9jYWwuY29ubjoKICAgICAgICAgICAgICAgIHNlbGYubG9jYWwuY29ubi5jbG9zZSgpCiAgICAgICAgICAgICAgICBzZWxmLmxvY2FsLmNvbm4gPSBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBYw7NhIGPDoWMgdGhhbSBjaGnhur91IHRocmVhZCDEkeG7gyB0csOhbmggbOG7l2kKICAgICAgICAgICAgaWYgaGFzYXR0cihzZWxmLCAnbG9jYWwnKToKICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZi5sb2NhbCwgJ19sb2NhbF9faW1wbCcpOgogICAgICAgICAgICAgICAgICAgICMgWMOzYSB0aGFtIGNoaeG6v3UgdHJvbmcgVGhyZWFkTG9jYWwKICAgICAgICAgICAgICAgICAgICBkZWxhdHRyKHNlbGYubG9jYWwsICdfbG9jYWxfX2ltcGwnKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHDs25nIGvhur90IG7hu5FpIGRhdGFiYXNlOiB7ZX0iKQogICAgICAgICAgICAKICAgIGRlZiBfX2RlbF9fKHNlbGYpOgogICAgICAgICIiIkjhu6d5IMSR4buRaSB0xrDhu6NuZyIiIgogICAgICAgIHNlbGYuY2xvc2UoKQogICAgCiAgICBkZWYgdXBkYXRlX29yX2luc2VydF9hY2NvdW50KHNlbGYsIGFwcF9uYW1lOiBzdHIsIHVuaXF1ZV9pZDogc3RyLCBkYXRhOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBD4bqtcCBuaOG6rXQgaG/hurdjIHRow6ptIG3hu5tpIG3hu5l0IHTDoGkga2hv4bqjbiB2w6BvIGRhdGFiYXNlCiAgICAgICAgIiIiCiAgICAgICAgIyDEkOG6o20gYuG6o28gY29ubmVjdGlvbiBsw6AgY+G7p2EgdGhyZWFkIGhp4buHbiB04bqhaQogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIHTDoGkga2hv4bqjbiDEkcOjIHThu5NuIHThuqFpIGNoxrBhCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICAgICAgICAgIiIiU0VMRUNUIGlkIEZST00gYWNjb3VudHMgV0hFUkUgYXBwX25hbWUgPSA/IEFORCB1bmlxdWVfaWQgPSA/IiIiLCAKICAgICAgICAgICAgICAgIChhcHBfbmFtZSwgdW5pcXVlX2lkKQogICAgICAgICAgICApCiAgICAgICAgICAgIGFjY291bnQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgYWNjb3VudDoKICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiBoaeG7h24gY8OzCiAgICAgICAgICAgICAgICBhY2NvdW50X2lkID0gYWNjb3VudFswXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEzhuqV5IGThu68gbGnhu4d1IGhp4buHbiB04bqhaQogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAgICAgIiIiU0VMRUNUIGRhdGEgRlJPTSBhY2NvdW50cyBXSEVSRSBpZCA9ID8iIiIsCiAgICAgICAgICAgICAgICAgICAgKGFjY291bnRfaWQsKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgY3VycmVudF9kYXRhX3JvdyA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgICAgICAgICBjdXJyZW50X2RhdGEgPSBqc29uLmxvYWRzKGN1cnJlbnRfZGF0YV9yb3dbMF0pIGlmIGN1cnJlbnRfZGF0YV9yb3cgZWxzZSB7fQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEjhu6NwIG5o4bqldCBk4buvIGxp4buHdSBjxakgdsOgIG3hu5tpCiAgICAgICAgICAgICAgICBtZXJnZWRfZGF0YSA9IHsqKmN1cnJlbnRfZGF0YSwgKipkYXRhfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdAogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAgICAgIiIiVVBEQVRFIGFjY291bnRzIFNFVCAKICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gPywKICAgICAgICAgICAgICAgICAgICAgICBuaWNrbmFtZSA9ID8sCiAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gPywKICAgICAgICAgICAgICAgICAgICAgICBpc19sb2dpbiA9ID8sCiAgICAgICAgICAgICAgICAgICAgICAgam9iX2VuYWJsZSA9ID8sCiAgICAgICAgICAgICAgICAgICAgICAgam9iX21heF9kYXkgPSA/LAogICAgICAgICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlID0gPwogICAgICAgICAgICAgICAgICAgICAgIFdIRVJFIGlkID0gPyIiIiwKICAgICAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb24uZHVtcHMobWVyZ2VkX2RhdGEpLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmdldCgibmlja25hbWUiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZ2V0KCJzdGF0dXMiLCAiYWN0aXZlIiksCiAgICAgICAgICAgICAgICAgICAgICAgIDEgaWYgZGF0YS5nZXQoImlzX2xvZ2luIiwgRmFsc2UpIGVsc2UgMCwKICAgICAgICAgICAgICAgICAgICAgICAgMSBpZiBkYXRhLmdldCgiam9iX2VuYWJsZSIsIFRydWUpIGVsc2UgMCwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5nZXQoImpvYl9tYXhfZGF5IiwgY29uZmlnLk1BWF9KT0JTX1BFUl9EQVkpLAogICAgICAgICAgICAgICAgICAgICAgICBpbnQodGltZS50aW1lKCkpLAogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50X2lkCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUaMOqbSB0w6BpIGtob+G6o24gbeG7m2kKICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICAgICAgICAgICAgICIiIklOU0VSVCBJTlRPIGFjY291bnRzICgKICAgICAgICAgICAgICAgICAgICAgICBhcHBfbmFtZSwgdW5pcXVlX2lkLCBuaWNrbmFtZSwgZGF0YSwgc3RhdHVzLCBpc19sb2dpbiwgam9iX2VuYWJsZSwgam9iX21heF9kYXksIGlzX2dvbGlrZV9saW5rZWQsIGdvbGlrZV9pZCwgbGFzdF91cGRhdGUKICAgICAgICAgICAgICAgICAgICApIFZBTFVFUyAoPywgPywgPywgPywgPywgPywgPywgPywgPywgPywgPykiIiIsCiAgICAgICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgICAgICBhcHBfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmdldCgibmlja25hbWUiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb24uZHVtcHMoZGF0YSksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZ2V0KCJzdGF0dXMiLCAiYWN0aXZlIiksCiAgICAgICAgICAgICAgICAgICAgICAgIDEgaWYgZGF0YS5nZXQoImlzX2xvZ2luIiwgRmFsc2UpIGVsc2UgMCwKICAgICAgICAgICAgICAgICAgICAgICAgMSBpZiBkYXRhLmdldCgiam9iX2VuYWJsZSIsIFRydWUpIGVsc2UgMCwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5nZXQoImpvYl9tYXhfZGF5IiwgY29uZmlnLk1BWF9KT0JTX1BFUl9EQVkpLAogICAgICAgICAgICAgICAgICAgICAgICAwLCAgIyBpc19nb2xpa2VfbGlua2VkCiAgICAgICAgICAgICAgICAgICAgICAgICIiLCAjIGdvbGlrZV9pZAogICAgICAgICAgICAgICAgICAgICAgICBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGPhuq1wIG5o4bqtdC90aMOqbSB0w6BpIGtob+G6o246IHtlfSIpCiAgICAgICAgICAgIGNvbm4ucm9sbGJhY2soKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHJlc2V0X2xvZ2luX3N0YXR1c19ieV9hcHAoc2VsZiwgYXBwX25hbWU6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkOG6t3QgbOG6oWkgdHLhuqFuZyB0aMOhaSBsb2dpbiBjaG8gdOG6pXQgY+G6oyB0w6BpIGtob+G6o24gY+G7p2EgbeG7mXQg4bupbmcgZOG7pW5nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYXBwX25hbWU6IFTDqm4g4bupbmcgZOG7pW5nIChhcHAsIGtow7RuZyBwaOG6o2kgYXBwX25hbWUpCiAgICAgICAgIiIiCiAgICAgICAgIyDEkOG6o20gYuG6o28gY29ubmVjdGlvbiBsw6AgY+G7p2EgdGhyZWFkIGhp4buHbiB04bqhaQogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bq3dCBs4bqhaSB0cuG6oW5nIHRow6FpIGxvZ2luIGNobyB04bqldCBj4bqjIHTDoGkga2hv4bqjbiB2w6AgxJHDoW5oIGThuqV1IGPhuqduIMSR4buTbmcgYuG7mQogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgICIiIlVQREFURSBhY2NvdW50cyBTRVQgaXNfbG9naW4gPSAwLCBpc19zeW5jID0gMCBXSEVSRSBhcHAgPSA/IiIiLAogICAgICAgICAgICAgICAgKGFwcF9uYW1lLCkKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDxaluZyBj4bqtcCBuaOG6rXQgdHLGsOG7nW5nIGlzX2xvZ2luIHRyb25nIGRhdGEgSlNPTgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgICIiIlNFTEVDVCBpZCwgZGF0YSBGUk9NIGFjY291bnRzIFdIRVJFIGFwcCA9ID8iIiIsCiAgICAgICAgICAgICAgICAoYXBwX25hbWUsKQogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBhY2NvdW50cyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGFjY291bnRzOgogICAgICAgICAgICAgICAgYWNjb3VudF9pZCA9IGFjY291bnRbMF0KICAgICAgICAgICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKGFjY291bnRbMV0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgbG9naW4gdHJvbmcgZGF0YQogICAgICAgICAgICAgICAgZGF0YVsiaXNfbG9naW4iXSA9IEZhbHNlCiAgICAgICAgICAgICAgICAjIMSQw6FuaCBk4bqldSBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgICAgIGRhdGFbImlzX3N5bmMiXSA9IEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTMawdSBs4bqhaSBkYXRhCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgICAgICAiIiJVUERBVEUgYWNjb3VudHMgU0VUIGRhdGEgPSA/IFdIRVJFIGlkID0gPyIiIiwKICAgICAgICAgICAgICAgICAgICAoanNvbi5kdW1wcyhkYXRhKSwgYWNjb3VudF9pZCkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSDEkeG6t3QgbOG6oWkgdHLhuqFuZyB0aMOhaSBsb2dpbjoge2V9IikKICAgICAgICAgICAgY29ubi5yb2xsYmFjaygpCiAgICAgICAgICAgIHJldHVybiBGYWxzZSAKCiAgICBkZWYgYWRkX2pvYl9oaXN0b3J5KHNlbGYsIGpvYl9kYXRhOiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIFRow6ptIG3hu5l0IGLhuqNuIGdoaSBs4buLY2ggc+G7rSBqb2IgbeG7m2kKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBqb2JfZGF0YTogROG7ryBsaeG7h3Ugam9iIGPhuqduIGzGsHUKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBVVUlEIGPhu6dhIGpvYiDEkcOjIHRow6ptCiAgICAgICAgIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgY3VycmVudF90aW1lID0gaW50KHRpbWUudGltZSgpKQogICAgICAgIGpvYl91dWlkID0gam9iX2RhdGEuZ2V0KCJqb2JfdXVpZCIsIHN0cih1dWlkLnV1aWQ0KCkpKQogICAgICAgIAogICAgICAgICMgTuG6v3Uga2jDtG5nIGPDsyBkZXZpY2VfaWQsIHPhu60gZOG7pW5nIGRldmljZV9pZCBoaeG7h24gdOG6oWkKICAgICAgICBkZXZpY2VfaWQgPSBqb2JfZGF0YS5nZXQoImRldmljZV9pZCIpCiAgICAgICAgaWYgbm90IGRldmljZV9pZDoKICAgICAgICAgICAgZGV2aWNlX2lkID0gc2VsZi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgCiAgICAgICAgIyBUw6FjaCBk4buvIGxp4buHdSBjaMOtbmggdsOgIGThu68gbGnhu4d1IHBo4bulCiAgICAgICAgbWFpbl9kYXRhID0gewogICAgICAgICAgICAiam9iX3V1aWQiOiBqb2JfdXVpZCwKICAgICAgICAgICAgImFjY291bnRfdXVpZCI6IGpvYl9kYXRhLmdldCgiYWNjb3VudF91dWlkIiwgIiIpLAogICAgICAgICAgICAiZGV2aWNlX2lkIjogZGV2aWNlX2lkLAogICAgICAgICAgICAiYXBwIjogam9iX2RhdGEuZ2V0KCJhcHAiLCAiIiksCiAgICAgICAgICAgICJqb2JfaWQiOiBqb2JfZGF0YS5nZXQoImpvYl9pZCIsICIiKSwKICAgICAgICAgICAgImpvYl90eXBlIjogam9iX2RhdGEuZ2V0KCJqb2JfdHlwZSIsICIiKSwKICAgICAgICAgICAgIm9iamVjdF9pZCI6IGpvYl9kYXRhLmdldCgib2JqZWN0X2lkIiwgIiIpLAogICAgICAgICAgICAibGluayI6IGpvYl9kYXRhLmdldCgibGluayIsICIiKSwKICAgICAgICAgICAgInN0YXR1cyI6IGpvYl9kYXRhLmdldCgic3RhdHVzIiwgMCksCiAgICAgICAgICAgICJzdWNjZXNzIjogMSBpZiBqb2JfZGF0YS5nZXQoInN1Y2Nlc3MiLCBGYWxzZSkgZWxzZSAwLAogICAgICAgICAgICAicHJpY2UiOiBqb2JfZGF0YS5nZXQoInByaWNlIiwgMC4wKSwKICAgICAgICAgICAgImVycm9yX21lc3NhZ2UiOiBqb2JfZGF0YS5nZXQoImVycm9yX21lc3NhZ2UiLCAiIiksCiAgICAgICAgICAgICJjcmVhdGVkX2F0Ijogam9iX2RhdGEuZ2V0KCJjcmVhdGVkX2F0IiwgY3VycmVudF90aW1lKSwKICAgICAgICAgICAgImxhc3RfdXBkYXRlIjogY3VycmVudF90aW1lLAogICAgICAgICAgICAiaXNfc3luYyI6IDAgICMgTeG6t2MgxJHhu4tuaCBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgIyBMxrB1IElEIHThu6sgZOG7ryBsaeG7h3UgxJHhuqd1IHbDoG8gbuG6v3UgY8OzCiAgICAgICAgaWYgImlkIiBpbiBqb2JfZGF0YToKICAgICAgICAgICAgbWFpbl9kYXRhWyJpZCJdID0gam9iX2RhdGFbImlkIl0KICAgICAgICAKICAgICAgICAjIEzGsHUgZOG7ryBsaeG7h3UgcGjhu6UgZMaw4bubaSBk4bqhbmcgSlNPTgogICAgICAgIGV4dHJhX2RhdGEgPSB7azogdiBmb3IgaywgdiBpbiBqb2JfZGF0YS5pdGVtcygpIGlmIGsgbm90IGluIG1haW5fZGF0YSBhbmQgayAhPSAiZGF0YSJ9CiAgICAgICAgaWYgImRhdGEiIGluIGpvYl9kYXRhIGFuZCBpc2luc3RhbmNlKGpvYl9kYXRhWyJkYXRhIl0sIGRpY3QpOgogICAgICAgICAgICBleHRyYV9kYXRhLnVwZGF0ZShqb2JfZGF0YVsiZGF0YSJdKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgY29sdW1ucyA9ICIsICIuam9pbihtYWluX2RhdGEua2V5cygpKQogICAgICAgICAgICBwbGFjZWhvbGRlcnMgPSAiLCAiLmpvaW4oWyI/Il0gKiBsZW4obWFpbl9kYXRhKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHZhbHVlcyA9IGxpc3QobWFpbl9kYXRhLnZhbHVlcygpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBwaOG7pSB2w6BvIGN14buRaQogICAgICAgICAgICBjb2x1bW5zICs9ICIsIGRhdGEiCiAgICAgICAgICAgIHBsYWNlaG9sZGVycyArPSAiLCA/IgogICAgICAgICAgICB2YWx1ZXMuYXBwZW5kKGpzb24uZHVtcHMoZXh0cmFfZGF0YSkpCiAgICAgICAgICAgIAogICAgICAgICAgICBxdWVyeSA9IGYiSU5TRVJUIE9SIFJFUExBQ0UgSU5UTyBqb2JzX2hpc3RvcnkgKHtjb2x1bW5zfSkgVkFMVUVTICh7cGxhY2Vob2xkZXJzfSkiCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKHF1ZXJ5LCB2YWx1ZXMpCiAgICAgICAgICAgIGNvbm4uY29tbWl0KCkKICAgICAgICAgICAgcmV0dXJuIGpvYl91dWlkCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aMOqbSBs4buLY2ggc+G7rSBqb2I6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgCiAgICBkZWYgdXBkYXRlX2pvYl9oaXN0b3J5KHNlbGYsIGpvYl91dWlkOiBzdHIsIGRhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIGzhu4tjaCBz4butIGpvYgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl91dWlkOiBVVUlEIGPhu6dhIGpvYiBj4bqnbiBj4bqtcCBuaOG6rXQKICAgICAgICAgICAgZGF0YTogROG7ryBsaeG7h3UgY+G6rXAgbmjhuq10CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY+G6rXAgbmjhuq10IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgIyBM4bqleSBqb2IgaGnhu4duIHThuqFpCiAgICAgICAgam9iID0gc2VsZi5nZXRfam9iX2hpc3Rvcnkoam9iX3V1aWQpCiAgICAgICAgaWYgbm90IGpvYjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgIyBD4bqtcCBuaOG6rXQgZOG7ryBsaeG7h3UKICAgICAgICBqb2IudXBkYXRlKGRhdGEpCiAgICAgICAgam9iWyJsYXN0X3VwZGF0ZSJdID0gaW50KHRpbWUudGltZSgpKQogICAgICAgIAogICAgICAgICMgTMawdSBs4bqhaQogICAgICAgIHJldHVybiBib29sKHNlbGYuYWRkX2pvYl9oaXN0b3J5KGpvYikpCiAgICAKICAgIGRlZiBnZXRfam9iX2hpc3Rvcnkoc2VsZiwgam9iX3V1aWQ6IHN0cikgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRow7RuZyB0aW4gbOG7i2NoIHPhu60gam9iIHRoZW8gVVVJRAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl91dWlkOiBVVUlEIGPhu6dhIGpvYiBj4bqnbiBs4bqleQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0IGhv4bq3YyBOb25lOiBUaMO0bmcgdGluIGpvYiBu4bq/dSB0w6xtIHRo4bqleSwgTm9uZSBu4bq/dSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUICogRlJPTSBqb2JzX2hpc3RvcnkgV0hFUkUgam9iX3V1aWQgPSA/IiwgKGpvYl91dWlkLCkpCiAgICAgICAgY29sdW1uX25hbWVzID0gW2Rlc2NyaXB0aW9uWzBdIGZvciBkZXNjcmlwdGlvbiBpbiBjdXJzb3IuZGVzY3JpcHRpb25dCiAgICAgICAgcmVzdWx0ID0gY3Vyc29yLmZldGNob25lKCkKICAgICAgICAKICAgICAgICBpZiBub3QgcmVzdWx0OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAjIENodXnhu4NuIMSR4buVaSBr4bq/dCBxdeG6oyB0aMOgbmggZGljdAogICAgICAgIGpvYiA9IHtjb2x1bW5fbmFtZXNbaV06IHJlc3VsdFtpXSBmb3IgaSBpbiByYW5nZShsZW4oY29sdW1uX25hbWVzKSl9CiAgICAgICAgCiAgICAgICAgIyBDaHV54buDbiDEkeG7lWkgY8OhYyB0csaw4budbmcgYm9vbGVhbgogICAgICAgIGpvYlsic3VjY2VzcyJdID0gYm9vbChqb2JbInN1Y2Nlc3MiXSkKICAgICAgICBqb2JbImlzX3N5bmMiXSA9IGJvb2woam9iWyJpc19zeW5jIl0pCiAgICAgICAgCiAgICAgICAgIyBUaMOqbSBk4buvIGxp4buHdSBwaOG7pSB04burIHRyxrDhu51uZyBkYXRhCiAgICAgICAgaWYgImRhdGEiIGluIGpvYiBhbmQgam9iWyJkYXRhIl06CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGV4dHJhX2RhdGEgPSBqc29uLmxvYWRzKGpvYlsiZGF0YSJdKQogICAgICAgICAgICAgICAgam9iLnVwZGF0ZShleHRyYV9kYXRhKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgICMgWMOzYSB0csaw4budbmcgZGF0YSDEkeG7gyB0csOhbmggdHLDuW5nIGzhurdwCiAgICAgICAgaWYgImRhdGEiIGluIGpvYjoKICAgICAgICAgICAgZGVsIGpvYlsiZGF0YSJdCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBqb2IKICAgIAogICAgZGVmIGdldF9qb2JfaGlzdG9yeV9ieV9hY2NvdW50KHNlbGYsIGFjY291bnRfdXVpZDogc3RyLCBsaW1pdDogaW50ID0gNTApIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGzhu4tjaCBz4butIGpvYiBj4bunYSBt4buZdCB0w6BpIGtob+G6o24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50X3V1aWQ6IFVVSUQgY+G7p2EgdMOgaSBraG/huqNuCiAgICAgICAgICAgIGxpbWl0OiBT4buRIGzGsOG7o25nIGLhuqNuIGdoaSB04buRaSDEkWEgdHLhuqMgduG7gQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCBs4buLY2ggc+G7rSBqb2IKICAgICAgICAiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgIlNFTEVDVCAqIEZST00gam9ic19oaXN0b3J5IFdIRVJFIGFjY291bnRfdXVpZCA9ID8gT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDIExJTUlUID8iLCAKICAgICAgICAgICAgKGFjY291bnRfdXVpZCwgbGltaXQpCiAgICAgICAgKQogICAgICAgIGNvbHVtbl9uYW1lcyA9IFtkZXNjcmlwdGlvblswXSBmb3IgZGVzY3JpcHRpb24gaW4gY3Vyc29yLmRlc2NyaXB0aW9uXQogICAgICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgICAgIAogICAgICAgIGpvYnMgPSBbXQogICAgICAgIGZvciByZXN1bHQgaW4gcmVzdWx0czoKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkga+G6v3QgcXXhuqMgdGjDoG5oIGRpY3QKICAgICAgICAgICAgam9iID0ge2NvbHVtbl9uYW1lc1tpXTogcmVzdWx0W2ldIGZvciBpIGluIHJhbmdlKGxlbihjb2x1bW5fbmFtZXMpKX0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2h1eeG7g24gxJHhu5VpIGPDoWMgdHLGsOG7nW5nIGJvb2xlYW4KICAgICAgICAgICAgam9iWyJzdWNjZXNzIl0gPSBib29sKGpvYlsic3VjY2VzcyJdKQogICAgICAgICAgICBqb2JbImlzX3N5bmMiXSA9IGJvb2woam9iWyJpc19zeW5jIl0pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGThu68gbGnhu4d1IHBo4bulIHThu6sgdHLGsOG7nW5nIGRhdGEKICAgICAgICAgICAgaWYgImRhdGEiIGluIGpvYiBhbmQgam9iWyJkYXRhIl06CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZXh0cmFfZGF0YSA9IGpzb24ubG9hZHMoam9iWyJkYXRhIl0pCiAgICAgICAgICAgICAgICAgICAgam9iLnVwZGF0ZShleHRyYV9kYXRhKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDs2EgdHLGsOG7nW5nIGRhdGEgxJHhu4MgdHLDoW5oIHRyw7luZyBs4bq3cAogICAgICAgICAgICBpZiAiZGF0YSIgaW4gam9iOgogICAgICAgICAgICAgICAgZGVsIGpvYlsiZGF0YSJdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgam9icy5hcHBlbmQoam9iKQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gam9icwogICAgCiAgICBkZWYgZ2V0X3BlbmRpbmdfc3luY19pdGVtcyhzZWxmLCB0YWJsZTogc3RyLCBsaW1pdDogaW50ID0gMTAwLCBkZXZpY2VfaWQ6IEFueSA9IFRydWUpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGRhbmggc8OhY2ggY8OhYyBi4bqjbiBnaGkgY2jGsGEgxJHGsOG7o2MgxJHhu5NuZyBi4buZCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFibGU6IFTDqm4gYuG6o25nICgnYWNjb3VudHMnIGhv4bq3YyAnam9ic19oaXN0b3J5JykKICAgICAgICAgICAgbGltaXQ6IFPhu5EgbMaw4bujbmcgYuG6o24gZ2hpIHThu5FpIMSRYSB0cuG6oyB24buBCiAgICAgICAgICAgIGRldmljZV9pZDogVGhp4bq/dCBi4buLIElEIMSR4buDIGzhu41jOgogICAgICAgICAgICAgICAgLSBUcnVlOiBM4buNYyB0aGVvIGRldmljZV9pZCBoaeG7h24gdOG6oWkgKG3hurdjIMSR4buLbmgpCiAgICAgICAgICAgICAgICAtIEZhbHNlL05vbmU6IEtow7RuZyBs4buNYyB0aGVvIGRldmljZV9pZAogICAgICAgICAgICAgICAgLSBDaHXhu5dpOiBM4buNYyB0aGVvIGRldmljZV9pZCBj4bulIHRo4buDIMSRxrDhu6NjIHRydXnhu4FuIHbDoG8KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggYuG6o24gZ2hpIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICIiIgogICAgICAgIGlmIHRhYmxlIG5vdCBpbiBbJ2FjY291bnRzJywgJ2pvYnNfaGlzdG9yeSddOgogICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgdXVpZF9maWVsZCA9ICJhY2NvdW50X3V1aWQiIGlmIHRhYmxlID09ICJhY2NvdW50cyIgZWxzZSAiam9iX3V1aWQiCiAgICAgICAgCiAgICAgICAgIyBUaMOqbSDEkWnhu4F1IGtp4buHbiBs4buNYyB0aGVvIGRldmljZV9pZAogICAgICAgIGlmIGRldmljZV9pZCBpcyBUcnVlOgogICAgICAgICAgICAjIEzhuqV5IGRldmljZV9pZCBoaeG7h24gdOG6oWkKICAgICAgICAgICAgY3VycmVudF9kZXZpY2VfaWQgPSBzZWxmLmdldF9vcl9jcmVhdGVfZGV2aWNlX2lkKCkKICAgICAgICAgICAgcXVlcnkgPSBmIlNFTEVDVCAqIEZST00ge3RhYmxlfSBXSEVSRSBpc19zeW5jID0gMCBBTkQgZGV2aWNlX2lkID0gPyBMSU1JVCA/IgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZShxdWVyeSwgKGN1cnJlbnRfZGV2aWNlX2lkLCBsaW1pdCkpCiAgICAgICAgZWxpZiBkZXZpY2VfaWQ6CiAgICAgICAgICAgICMgU+G7rSBk4bulbmcgZGV2aWNlX2lkIMSRxrDhu6NjIHRydXnhu4FuIHbDoG8KICAgICAgICAgICAgcXVlcnkgPSBmIlNFTEVDVCAqIEZST00ge3RhYmxlfSBXSEVSRSBpc19zeW5jID0gMCBBTkQgZGV2aWNlX2lkID0gPyBMSU1JVCA/IgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZShxdWVyeSwgKGRldmljZV9pZCwgbGltaXQpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgS2jDtG5nIGzhu41jIHRoZW8gZGV2aWNlX2lkCiAgICAgICAgICAgIHF1ZXJ5ID0gZiJTRUxFQ1QgKiBGUk9NIHt0YWJsZX0gV0hFUkUgaXNfc3luYyA9IDAgTElNSVQgPyIKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUocXVlcnksIChsaW1pdCwpKQogICAgICAgICAgICAKICAgICAgICBjb2x1bW5fbmFtZXMgPSBbZGVzY3JpcHRpb25bMF0gZm9yIGRlc2NyaXB0aW9uIGluIGN1cnNvci5kZXNjcmlwdGlvbl0KICAgICAgICByZXN1bHRzID0gY3Vyc29yLmZldGNoYWxsKCkKICAgICAgICAKICAgICAgICBpdGVtcyA9IFtdCiAgICAgICAgZm9yIHJlc3VsdCBpbiByZXN1bHRzOgogICAgICAgICAgICAjIENodXnhu4NuIMSR4buVaSBr4bq/dCBxdeG6oyB0aMOgbmggZGljdAogICAgICAgICAgICBpdGVtID0ge2NvbHVtbl9uYW1lc1tpXTogcmVzdWx0W2ldIGZvciBpIGluIHJhbmdlKGxlbihjb2x1bW5fbmFtZXMpKX0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gZOG7ryBsaeG7h3UgcGjhu6UgdOG7qyB0csaw4budbmcgZGF0YQogICAgICAgICAgICBpZiAiZGF0YSIgaW4gaXRlbSBhbmQgaXRlbVsiZGF0YSJdOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGV4dHJhX2RhdGEgPSBqc29uLmxvYWRzKGl0ZW1bImRhdGEiXSkKICAgICAgICAgICAgICAgICAgICBpdGVtLnVwZGF0ZShleHRyYV9kYXRhKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDs2EgdHLGsOG7nW5nIGRhdGEgxJHhu4MgdHLDoW5oIHRyw7luZyBs4bq3cAogICAgICAgICAgICBpZiAiZGF0YSIgaW4gaXRlbToKICAgICAgICAgICAgICAgIGRlbCBpdGVtWyJkYXRhIl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpdGVtcy5hcHBlbmQoaXRlbSkKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGl0ZW1zCiAgICAKICAgIGRlZiBtYXJrX2FzX3N5bmNlZChzZWxmLCB0YWJsZTogc3RyLCB1dWlkX3ZhbHVlOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgxJDDoW5oIGThuqV1IGLhuqNuIGdoaSDEkcOjIMSRxrDhu6NjIMSR4buTbmcgYuG7mQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhYmxlOiBUw6puIGLhuqNuZyAoJ2FjY291bnRzJyBob+G6t2MgJ2pvYnNfaGlzdG9yeScpCiAgICAgICAgICAgIHV1aWRfdmFsdWU6IEdpw6EgdHLhu4sgVVVJRCBj4bunYSBi4bqjbiBnaGkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBj4bqtcCBuaOG6rXQgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBpZiB0YWJsZSBub3QgaW4gWydhY2NvdW50cycsICdqb2JzX2hpc3RvcnknXToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgIHV1aWRfZmllbGQgPSAiYWNjb3VudF91dWlkIiBpZiB0YWJsZSA9PSAiYWNjb3VudHMiIGVsc2UgImpvYl91dWlkIgogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICBmIlVQREFURSB7dGFibGV9IFNFVCBpc19zeW5jID0gMSBXSEVSRSB7dXVpZF9maWVsZH0gPSA/IiwKICAgICAgICAgICAgICAgICh1dWlkX3ZhbHVlLCkKICAgICAgICAgICAgKQogICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgIHJldHVybiBjdXJzb3Iucm93Y291bnQgPiAwCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSDEkcOhbmggZOG6pXUgxJHDoyDEkeG7k25nIGLhu5k6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZSAKCiAgICBkZWYgbWFya19hbGxfYWNjb3VudHNfbm90X3N5bmNlZChzZWxmKSAtPiBpbnQ6CiAgICAgICAgIiIiCiAgICAgICAgxJDDoW5oIGThuqV1IHThuqV0IGPhuqMgdMOgaSBraG/huqNuIGzDoCBjaMawYSBzeW5jCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgaW50OiBT4buRIHTDoGkga2hv4bqjbiDEkcOjIMSRxrDhu6NjIGPhuq1wIG5o4bqtdAogICAgICAgICIiIgogICAgICAgIGNvbm4gPSBzZWxmLl9nZXRfY29ubmVjdGlvbigpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlVQREFURSBhY2NvdW50cyBTRVQgaXNfc3luYyA9IDAiKQogICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgIHVwZGF0ZWRfY291bnQgPSBjdXJzb3Iucm93Y291bnQKICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZWRfY291bnQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIMSRw6FuaCBk4bqldSB04bqldCBj4bqjIHTDoGkga2hv4bqjbiBjaMawYSBzeW5jOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gMAoKICAgIGRlZiBnZXRfZGV2aWNlX2NvbmZpZyhzZWxmLCBrZXk6IHN0ciwgZGVmYXVsdD1Ob25lKSAtPiBBbnk6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAga2V5OiBLaMOzYSBj4bqldSBow6xuaAogICAgICAgICAgICBkZWZhdWx0OiBHacOhIHRy4buLIG3hurdjIMSR4buLbmggbuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIEFueTogR2nDoSB0cuG7iyBj4bqldSBow6xuaCBob+G6t2MgZ2nDoSB0cuG7iyBt4bq3YyDEkeG7i25oCiAgICAgICAgIiIiCiAgICAgICAgIyBM4bqleSBj4bqldSBow6xuaCB04burIGRhdGFiYXNlCiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KGtleSwgZGVmYXVsdCkKCiAgICBkZWYgc2V0X2RldmljZV9jb25maWcoc2VsZiwga2V5OiBzdHIsIHZhbHVlOiBBbnkpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgU2V0IGEgZGV2aWNlIGNvbmZpZ3VyYXRpb24gdmFsdWUgaW4gdGhlIGNvbmZpZyB0YWJsZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGtleTogVGhlIGNvbmZpZ3VyYXRpb24ga2V5CiAgICAgICAgICAgIHZhbHVlOiBUaGUgdmFsdWUgdG8gc2V0CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgaWYgc3VjY2Vzc2Z1bCwgRmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuc2V0KGtleSwgdmFsdWUpCgogICAgZGVmIGdldF9hbGxfZGV2aWNlX2NvbmZpZyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBHZXQgYWxsIGRldmljZSBjb25maWd1cmF0aW9uIHNldHRpbmdzCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IERpY3Rpb25hcnkgb2YgYWxsIGRldmljZSBjb25maWd1cmF0aW9uIHNldHRpbmdzCiAgICAgICAgIiIiCiAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uZWN0aW9uKCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgCiAgICAgICAgIyBHZXQgYWxsIGtleXMgc3RhcnRpbmcgd2l0aCAiZGV2aWNlXyIgYnV0IGV4Y2x1ZGUgZGV2aWNlX2luZm8KICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGtleSwgdmFsdWUgRlJPTSBjb25maWcgV0hFUkUga2V5ICE9ICdkZXZpY2VfaW5mbycgQU5EIGtleSAhPSAnZGV2aWNlX2lkJyIpCiAgICAgICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgCiAgICAgICAgIyBCdWlsZCBjb25maWcgZGljdGlvbmFyeSwgcmVtb3ZpbmcgImRldmljZV8iIHByZWZpeCBmcm9tIGtleXMKICAgICAgICBkZXZpY2VfY29uZmlnID0ge30KICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiByZXN1bHRzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXZpY2VfY29uZmlnW2tleV0gPSBqc29uLmxvYWRzKHZhbHVlKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkZXZpY2VfY29uZmlnW2tleV0gPSB2YWx1ZQogICAgICAgIAogICAgICAgICMgSW1wb3J0IGNvbmZpZyBtb2R1bGUKICAgICAgICBpbXBvcnQgY29uZmlnIGFzIGNvbmZpZ19tb2R1bGUKICAgICAgICAKICAgICAgICAjIEFkZCBkZWZhdWx0IHZhbHVlcyBmb3IgbWlzc2luZyBjb25maWcgaXRlbXMKICAgICAgICBkZWZhdWx0X2NvbmZpZ3MgPSB7CiAgICAgICAgICAgICJtYXhfam9ic19wZXJfZGF5IjogY29uZmlnX21vZHVsZS5NQVhfSk9CU19QRVJfREFZLAogICAgICAgICAgICAibWF4X2pvYnNfcGVyX3Nlc3Npb24iOiBjb25maWdfbW9kdWxlLk1BWF9KT0JTX1BFUl9TRVNTSU9OLAogICAgICAgICAgICAiam9iX2ludGVydmFsX3NlY29uZHMiOiBjb25maWdfbW9kdWxlLkpPQl9DSEVDS19JTlRFUlZBTCwKICAgICAgICAgICAgInJlcG9ydF9pbnRlcnZhbCI6IGNvbmZpZ19tb2R1bGUuTVFUVF9SRVBPUlRfSU5URVJWQUwsCiAgICAgICAgICAgICJlbmFibGVfY2FyZSI6IGNvbmZpZ19tb2R1bGUuU01BUlRfQ0FSRV9FTkFCTEVELAogICAgICAgICAgICAiY2FyZV9pbnRlcnZhbF9ob3VycyI6IGNvbmZpZ19tb2R1bGUuU01BUlRfQ0FSRV9JTlRFUlZBTF9IT1VSUywKICAgICAgICAgICAgImNhcmVfY2hhbmNlX3BlcmNlbnQiOiBjb25maWdfbW9kdWxlLlNNQVJUX0NBUkVfQ0hBTkNFX1BFUkNFTlQKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIGtleSwgZGVmYXVsdF92YWx1ZSBpbiBkZWZhdWx0X2NvbmZpZ3MuaXRlbXMoKToKICAgICAgICAgICAgaWYga2V5IG5vdCBpbiBkZXZpY2VfY29uZmlnOgogICAgICAgICAgICAgICAgZGV2aWNlX2NvbmZpZ1trZXldID0gZGVmYXVsdF92YWx1ZQogICAgICAgIAogICAgICAgICMgTG/huqFpIGLhu48gY8OhYyB0csaw4budbmcga2jDtG5nIGPhuqduIHRoaeG6v3QKICAgICAgICBrZXlzX3RvX3JlbW92ZSA9IFsiaWQiLCAiZ29saWtlX2FwaV9iYXNlIl0KICAgICAgICBmb3Iga2V5IGluIGtleXNfdG9fcmVtb3ZlOgogICAgICAgICAgICBpZiBrZXkgaW4gZGV2aWNlX2NvbmZpZzoKICAgICAgICAgICAgICAgIGRlbCBkZXZpY2VfY29uZmlnW2tleV0KICAgICAgICAKICAgICAgICByZXR1cm4gZGV2aWNlX2NvbmZpZwoKICAgIGRlZiBzYXZlX2RldmljZV9jb25maWcoc2VsZiwgY29uZmlnX2RpY3Q6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEzGsHUgbmhp4buBdSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgY8O5bmcgbMO6YwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGNvbmZpZ19kaWN0OiBEaWN0aW9uYXJ5IGNo4bupYSBjw6FjIGPhurdwIGtleS12YWx1ZSBj4bqldSBow6xuaAogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBjb25maWdfZGljdC5pdGVtcygpOgogICAgICAgICAgICAgICAgc2VsZi5zZXRfZGV2aWNlX2NvbmZpZyhrZXksIHZhbHVlKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbMawdSBj4bqldSBow6xuaCB0aGnhur90IGLhu4s6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgaW5pdF9kZWZhdWx0X2NvbmZpZyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBLaOG7n2kgdOG6oW8gY+G6pXUgaMOsbmggbeG6t2MgxJHhu4tuaCBjaG8gdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEPhuqV1IGjDrG5oIMSRw6Mga2jhu59pIHThuqFvCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFThuqFvIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmgKICAgICAgICAgICAgZGVmYXVsdF9jb25maWcgPSB7CiAgICAgICAgICAgICAgICAjIEPhuqV1IGjDrG5oIGNodW5nCiAgICAgICAgICAgICAgICAic3luY19pbnRlcnZhbCI6IGNvbmZpZy5TWU5DX0lOVEVSVkFMLAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEPhuqV1IGjDrG5oIGNobyBqb2IKICAgICAgICAgICAgICAgICJqb2JfY2hlY2tfaW50ZXJ2YWwiOiBjb25maWcuSk9CX0NIRUNLX0lOVEVSVkFMLAogICAgICAgICAgICAgICAgImpvYl9ob3VyIjogY29uZmlnLkpPQl9IT1VSLAogICAgICAgICAgICAgICAgImpvYl9jb29sZG93bl9taW51dGVzIjogY29uZmlnLkRFRkFVTFRfQ09PTERPV05fTUlOVVRFUywKICAgICAgICAgICAgICAgICJtYXhfam9ic19wZXJfZGF5IjogY29uZmlnLk1BWF9KT0JTX1BFUl9EQVksCiAgICAgICAgICAgICAgICAibWF4X2pvYnNfcGVyX3Nlc3Npb24iOiBjb25maWcuTUFYX0pPQlNfUEVSX1NFU1NJT04sCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ+G6pXUgaMOsbmggU21hcnQgQ2FyZSBTeXN0ZW0gIAogICAgICAgICAgICAgICAgImVuYWJsZV9jYXJlIjogY29uZmlnLlNNQVJUX0NBUkVfRU5BQkxFRCwKICAgICAgICAgICAgICAgICJjYXJlX2ludGVydmFsX2hvdXJzIjogY29uZmlnLlNNQVJUX0NBUkVfSU5URVJWQUxfSE9VUlMsCiAgICAgICAgICAgICAgICAiY2FyZV9jaGFuY2VfcGVyY2VudCI6IGNvbmZpZy5TTUFSVF9DQVJFX0NIQU5DRV9QRVJDRU5ULAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIERhbmggc8OhY2ggY8OhYyBhcHAgxJHGsOG7o2Mga8OtY2ggaG/huqF0CiAgICAgICAgICAgICAgICAiZW5hYmxlZF9hcHBzIjogY29uZmlnLkVOQUJMRURfQVBQUywKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmggdsOgbyBkYXRhYmFzZQogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBkZWZhdWx0X2NvbmZpZy5pdGVtcygpOgogICAgICAgICAgICAgICAgIyBDaOG7iSBsxrB1IG7hur91IGNoxrBhIGPDsyB0cm9uZyBkYXRhYmFzZQogICAgICAgICAgICAgICAgaWYgc2VsZi5nZXRfZGV2aWNlX2NvbmZpZyhrZXkpIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRfZGV2aWNlX2NvbmZpZyhrZXksIHZhbHVlKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoIsSQw6Mga2jhu59pIHThuqFvIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmggY2hvIHRoaeG6v3QgYuG7iyIpCiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0X2NvbmZpZwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkga2jhu59pIHThuqFvIGPhuqV1IGjDrG5oIG3hurdjIMSR4buLbmg6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7fQogICAgICAgICAgICAKICAgIGRlZiBnZXRfb3JfY3JlYXRlX2RldmljZV9pZChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgaG/hurdjIHThuqFvIGRldmljZV9pZAogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogZGV2aWNlX2lkCiAgICAgICAgIiIiCiAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgZGV2aWNlX2lkIHRyb25nIGRhdGFiYXNlIGtow7RuZwogICAgICAgIGRldmljZV9pZCA9IHNlbGYuZ2V0X2RldmljZV9jb25maWcoImRldmljZV9pZCIsICIiKQogICAgICAgIGlmIGRldmljZV9pZDoKICAgICAgICAgICAgcmV0dXJuIGRldmljZV9pZAogICAgICAgICAgICAKICAgICAgICAjIFRo4butIGzhuqV5IGRldmljZV9pZCB04burIGjhu4cgdGjhu5FuZwogICAgICAgIGRldmljZV9pZCA9IHNlbGYuX2dldF9kZXZpY2VfaWRfZnJvbV9zeXN0ZW0oKQogICAgICAgIGlmIGRldmljZV9pZDoKICAgICAgICAgICAgIyBMxrB1IHbDoG8gY+G6pXUgaMOsbmggdsOgIHRy4bqjIHbhu4EKICAgICAgICAgICAgcHJpbnQoZiLEkMOjIGzhuqV5IMSRxrDhu6NjIGRldmljZV9pZCB04burIGjhu4cgdGjhu5FuZzoge2RldmljZV9pZH0iKQogICAgICAgICAgICBzZWxmLnNldF9kZXZpY2VfY29uZmlnKCJkZXZpY2VfaWQiLCBkZXZpY2VfaWQpCiAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaWQKICAgICAgICAgICAgCiAgICAgICAgIyBUaOG7rSBs4bqleSBkZXZpY2VfaWQgdOG7qyBoZWxwZXIgc2VydmljZQogICAgICAgIGRldmljZV9pZCA9IHNlbGYuX2dldF9kZXZpY2VfaWRfZnJvbV9oZWxwZXIoKQogICAgICAgIGlmIGRldmljZV9pZDoKICAgICAgICAgICAgIyBMxrB1IHbDoG8gY+G6pXUgaMOsbmggdsOgIHRy4bqjIHbhu4EKICAgICAgICAgICAgcHJpbnQoZiLEkMOjIGzhuqV5IMSRxrDhu6NjIGRldmljZV9pZCB04burIGhlbHBlciBzZXJ2aWNlOiB7ZGV2aWNlX2lkfSIpCiAgICAgICAgICAgIHNlbGYuc2V0X2RldmljZV9jb25maWcoImRldmljZV9pZCIsIGRldmljZV9pZCkKICAgICAgICAgICAgcmV0dXJuIGRldmljZV9pZAogICAgICAgICAgICAKICAgICAgICAjIE7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYywgdOG6oW8gbeG7m2kKICAgICAgICBpbXBvcnQgcmFuZG9tCiAgICAgICAgaW1wb3J0IHN0cmluZwogICAgICAgIHJhbmRvbV9pZCA9ICcnLmpvaW4ocmFuZG9tLmNob2ljZXMoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMsIGs9MTApKQogICAgICAgIGRldmljZV9pZCA9IGYicmFuZG9tX3tyYW5kb21faWR9IgogICAgICAgIHByaW50KGYiS2jDtG5nIGzhuqV5IMSRxrDhu6NjIGRldmljZV9pZCBi4bqxbmcgY8OhYyBjw6FjaCB0csOqbiwgdOG6oW8gbeG7m2k6IHtkZXZpY2VfaWR9IikKICAgICAgICAKICAgICAgICAjIEzGsHUgdsOgbyBj4bqldSBow6xuaAogICAgICAgIHNlbGYuc2V0X2RldmljZV9jb25maWcoImRldmljZV9pZCIsIGRldmljZV9pZCkKICAgICAgICByZXR1cm4gZGV2aWNlX2lkCiAgICAgICAgCiAgICBkZWYgX2dldF9kZXZpY2VfaWRfZnJvbV9zeXN0ZW0oc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGRldmljZV9pZCB04burIGjhu4cgdGjhu5FuZyAoc+G7rSBk4bulbmcgbOG7h25oIGdldHByb3ApCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBkZXZpY2VfaWQgaG/hurdjIGNodeG7l2kgcuG7l25nIG7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0IHN1YnByb2Nlc3MKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oWyJnZXRwcm9wIiwgInJvLnNlcmlhbG5vIl0sIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkKICAgICAgICAgICAgZGV2aWNlX2lkID0gcmVzdWx0LnN0ZG91dC5zdHJpcCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBkZXZpY2VfaWQgYW5kIGRldmljZV9pZCAhPSAidW5rbm93biI6CiAgICAgICAgICAgICAgICByZXR1cm4gZGV2aWNlX2lkCiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgZGV2aWNlX2lkIHThu6sgaOG7hyB0aOG7kW5nOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICAgICAgCiAgICBkZWYgX2dldF9kZXZpY2VfaWRfZnJvbV9oZWxwZXIoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGRldmljZV9pZCB04burIGhlbHBlciBzZXJ2aWNlIChhbmRyb2lkX2lkKQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogZGV2aWNlX2lkIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSBraMO0bmcgbOG6pXkgxJHGsOG7o2MKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ+G6p24gaW1wb3J0IEhlbHBlclNlcnZpY2UgdOG6oWkgxJHDonkgxJHhu4MgdHLDoW5oIGltcG9ydCB2w7JuZwogICAgICAgICAgICBmcm9tIHNlcnZpY2VzLmhlbHBlcl9zZXJ2aWNlIGltcG9ydCBIZWxwZXJTZXJ2aWNlCiAgICAgICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICAgICAgCiAgICAgICAgICAgIGhlbHBlciA9IEhlbHBlclNlcnZpY2UoYmFzZV91cmw9Y29uZmlnLkhFTFBFUl9TRVJWSUNFX1VSTCkKICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBoZWxwZXIuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGRldmljZV9pbmZvIGFuZCAic3RhdHVzIiBpbiBkZXZpY2VfaW5mbyBhbmQgZGV2aWNlX2luZm9bInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgIGRhdGEgPSBkZXZpY2VfaW5mby5nZXQoImRhdGEiLCB7fSkKICAgICAgICAgICAgICAgIGFuZHJvaWRfaWQgPSBkYXRhLmdldCgiYW5kcm9pZF9pZCIsICIiKQogICAgICAgICAgICAgICAgaWYgYW5kcm9pZF9pZDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW5kcm9pZF9pZAogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGzhuqV5IGRldmljZV9pZCB04burIGhlbHBlcjoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgICAgIAogICAgZGVmIG1pZ3JhdGVfZ29saWtlX2NvbmZpZyhzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFjDs2EgY8OhYyBj4bqldSBow6xuaCBHb0xpa2UgdHLDuW5nIGzhurdwIGtow7RuZyBjw7JuIGPhuqduIHRoaeG6v3QKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludCgixJBhbmcgeMOzYSBj4bqldSBow6xuaCBHb0xpa2UgdHLDuW5nIGzhurdwLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTeG7nyBr4bq/dCBu4buRaSBEQgogICAgICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIERhbmggc8OhY2ggY8OhYyBrZXkgY+G6p24geMOzYQogICAgICAgICAgICBrZXlzX3RvX2RlbGV0ZSA9IFsKICAgICAgICAgICAgICAgICJnb2xpa2VfaGVhZGVycyIsIAogICAgICAgICAgICAgICAgImdvbGlrZV9oZWFkZXJzX3VwZGF0ZWQiLAogICAgICAgICAgICAgICAgImdvbGlrZV9hcGlfYmFzZSIKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgIyBYw7NhIGPDoWMga2V5IHRyw7luZyBs4bq3cCBjxakKICAgICAgICAgICAgZGVsZXRlZF9jb3VudCA9IDAKICAgICAgICAgICAgZm9yIGtleSBpbiBrZXlzX3RvX2RlbGV0ZToKICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJERUxFVEUgRlJPTSBjb25maWcgV0hFUkUga2V5ID0gPyIsIChrZXksKSkKICAgICAgICAgICAgICAgIGRlbGV0ZWRfY291bnQgKz0gY3Vyc29yLnJvd2NvdW50CiAgICAgICAgICAgIAogICAgICAgICAgICAjIENvbW1pdCB0aGF5IMSR4buVaQogICAgICAgICAgICBjb25uLmNvbW1pdCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChmIsSQw6MgeMOzYSB7ZGVsZXRlZF9jb3VudH0gY+G6pXUgaMOsbmggR29MaWtlIHRyw7luZyBs4bq3cCIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgeMOzYSBj4bqldSBow6xuaCBHb0xpa2UgdHLDuW5nIGzhurdwOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UgCgogICAgZGVmIHNldF9hY2NvdW50X2luYWN0aXZlX3VudGlsX25leHRfcmVzZXQoc2VsZiwgYWNjb3VudF9pZDogaW50LCBpbmFjdGl2ZV9yZWFzb246IHN0ciA9ICLEkMOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gam9iIGjDoG5nIG5nw6B5IikgLT4gYm9vbDoKICAgICAgICAiIiLEkOG6t3QgdMOgaSBraG/huqNuIHbDoG8gdHLhuqFuZyB0aMOhaSBpbmFjdGl2ZSDEkeG6v24gZ2nhu50gcmVzZXQgdGnhur9wIHRoZW8gaG/hurdjIGpvYl9jb29sZG93bl9taW51dGVzIChjaOG7jW4gbmfhuq9uIGjGoW4pIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbXBvcnQgZGF0ZXRpbWUsIGNvbmZpZywgdGltZQogICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmdldF9hY2NvdW50KGFjY291bnRfaWQpCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgcHJpbnQoZiJbREJdIEtow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gY8OzIElEIHthY2NvdW50X2lkfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEdp4budIHJlc2V0IHbDoCBqb2IgY29vbGRvd24KICAgICAgICAgICAgam9iX2hvdXIgPSBzZWxmLmdldCgiam9iX2hvdXIiLCBjb25maWcuSk9CX0hPVVIpCiAgICAgICAgICAgIGpvYl9jb29sZG93bl9taW51dGVzID0gc2VsZi5nZXQoImpvYl9jb29sZG93bl9taW51dGVzIiwgY29uZmlnLkRFRkFVTFRfQ09PTERPV05fTUlOVVRFUykKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOtbmggdGjhu51pIGdpYW4gxJHhur9uIGzDumMgcmVzZXQgdGnhur9wIHRoZW8KICAgICAgICAgICAgbm93ID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkKICAgICAgICAgICAgbmV4dF9yZXNldCA9IG5vdy5yZXBsYWNlKGhvdXI9am9iX2hvdXIsIG1pbnV0ZT0wLCBzZWNvbmQ9MCwgbWljcm9zZWNvbmQ9MCkKICAgICAgICAgICAgaWYgbm93ID49IG5leHRfcmVzZXQ6CiAgICAgICAgICAgICAgICBuZXh0X3Jlc2V0ID0gbmV4dF9yZXNldCArIGRhdGV0aW1lLnRpbWVkZWx0YShkYXlzPTEpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrW5oIHPhu5EgcGjDunQgdOG7qyBiw6J5IGdp4budIMSR4bq/biBsw7pjIHJlc2V0CiAgICAgICAgICAgIHRpbWVfdG9fcmVzZXRfbWludXRlcyA9IGludCgobmV4dF9yZXNldCAtIG5vdykudG90YWxfc2Vjb25kcygpIC8gNjApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4buNbiB0aOG7nWkgZ2lhbiBuZ+G6r24gaMahbiBnaeG7r2EgdGltZV90b19yZXNldCB2w6Agam9iX2Nvb2xkb3duX21pbnV0ZXMKICAgICAgICAgICAgZGlzYWJsZV9taW51dGVzID0gbWluKHRpbWVfdG9fcmVzZXRfbWludXRlcywgam9iX2Nvb2xkb3duX21pbnV0ZXMpCiAgICAgICAgICAgIGpvYl9kaXNhYmxlX3VudGlsID0gaW50KHRpbWUudGltZSgpICsgZGlzYWJsZV9taW51dGVzICogNjApCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChmIltEQl0gVMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgYWNjb3VudF9pZCl9OiB0aOG7nWkgZ2lhbiDEkeG6v24gcmVzZXQgPSB7dGltZV90b19yZXNldF9taW51dGVzfSBwaMO6dCwgY29vbGRvd24gPSB7am9iX2Nvb2xkb3duX21pbnV0ZXN9IHBow7p0LCBjaOG7jW4gPSB7ZGlzYWJsZV9taW51dGVzfSBwaMO6dCIpCiAgICAgICAgICAgIAogICAgICAgICAgICB1cGRhdGVfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiaW5hY3RpdmUiLAogICAgICAgICAgICAgICAgImpvYl9kaXNhYmxlX3VudGlsIjogam9iX2Rpc2FibGVfdW50aWwsCiAgICAgICAgICAgICAgICAiam9ic19kb25lX2luX3Nlc3Npb24iOiAwLAogICAgICAgICAgICAgICAgImZvbGxvd19pbl9zZXNzaW9uIjogMCwKICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9yZWFzb24iOiBpbmFjdGl2ZV9yZWFzb24sCiAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiW0RCXSBM4buXaSBzZXRfYWNjb3VudF9pbmFjdGl2ZV91bnRpbF9uZXh0X3Jlc2V0OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgc2V0X2FjY291bnRfaW5hY3RpdmUoc2VsZiwgYWNjb3VudF9pZDogaW50LCBjb29sZG93bl9taW51dGVzOiBpbnQgPSBOb25lLCBpbmFjdGl2ZV9yZWFzb246IHN0ciA9ICLEkMOjIGhvw6BuIHRow6BuaCBz4buRIGpvYiB0cm9uZyBwaGnDqm4iKSAtPiBib29sOgogICAgICAgICIiIsSQ4bq3dCB0w6BpIGtob+G6o24gdsOgbyB0cuG6oW5nIHRow6FpIGluYWN0aXZlIHRyb25nIGtob+G6o25nIHRo4budaSBnaWFuIChwaMO6dCkiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGltcG9ydCB0aW1lLCBjb25maWcKICAgICAgICAgICAgYWNjb3VudCA9IHNlbGYuZ2V0X2FjY291bnQoYWNjb3VudF9pZCkKICAgICAgICAgICAgaWYgbm90IGFjY291bnQ6CiAgICAgICAgICAgICAgICBwcmludChmIltEQl0gS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiBjw7MgSUQge2FjY291bnRfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBpZiBjb29sZG93bl9taW51dGVzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBjb29sZG93bl9taW51dGVzID0gc2VsZi5nZXQoImpvYl9jb29sZG93bl9taW51dGVzIiwgY29uZmlnLkRFRkFVTFRfQ09PTERPV05fTUlOVVRFUykKICAgICAgICAgICAgICAgIHByaW50KGYiW0RCXSBT4butIGThu6VuZyBjb29sZG93bl9taW51dGVzIG3hurdjIMSR4buLbmg6IHtjb29sZG93bl9taW51dGVzfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIltEQl0gU+G7rSBk4bulbmcgY29vbGRvd25fbWludXRlcyDEkcaw4bujYyB0cnV54buBbiB2w6BvOiB7Y29vbGRvd25fbWludXRlc30iKQogICAgICAgICAgICAKICAgICAgICAgICAgam9iX2Rpc2FibGVfdW50aWwgPSBpbnQodGltZS50aW1lKCkgKyBjb29sZG93bl9taW51dGVzICogNjApCiAgICAgICAgICAgIHByaW50KGYiW0RCXSBTZXQgYWNjb3VudCBpbmFjdGl2ZTogY29vbGRvd25fbWludXRlcz17Y29vbGRvd25fbWludXRlc30sIGpvYl9kaXNhYmxlX3VudGlsPXtqb2JfZGlzYWJsZV91bnRpbH0sIGN1cnJlbnRfdGltZT17aW50KHRpbWUudGltZSgpKX0iKQogICAgICAgICAgICB1cGRhdGVfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiaW5hY3RpdmUiLAogICAgICAgICAgICAgICAgImpvYl9kaXNhYmxlX3VudGlsIjogam9iX2Rpc2FibGVfdW50aWwsCiAgICAgICAgICAgICAgICAiam9ic19kb25lX2luX3Nlc3Npb24iOiAwLAogICAgICAgICAgICAgICAgImZvbGxvd19pbl9zZXNzaW9uIjogMCwKICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9yZWFzb24iOiBpbmFjdGl2ZV9yZWFzb24sCiAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiW0RCXSBM4buXaSBzZXRfYWNjb3VudF9pbmFjdGl2ZToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlIAoKICAgIGRlZiBkaXNhYmxlX2FjY291bnRfZm9sbG93KHNlbGYsIGFjY291bnRfaWQ6IGludCwgcGVuYWx0eV9ob3VyczogaW50ID0gTm9uZSwgcGVuYWx0eV9taW51dGVzOiBpbnQgPSBOb25lLCByZWFzb246IHN0ciA9ICLEkMOjIMSR4bqhdCBnaeG7m2kgaOG6oW4gZm9sbG93IikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBEaXNhYmxlIGZvbGxvdyBjaG8gdMOgaSBraG/huqNuIHRyb25nIG3hu5l0IGtob+G6o25nIHRo4budaSBnaWFuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudF9pZDogSUQgY+G7p2EgdMOgaSBraG/huqNuCiAgICAgICAgICAgIHBlbmFsdHlfaG91cnM6IFPhu5EgZ2nhu50gZGlzYWJsZSBmb2xsb3cgKMawdSB0acOqbiB0aOG6pXAgaMahbiBwZW5hbHR5X21pbnV0ZXMpCiAgICAgICAgICAgIHBlbmFsdHlfbWludXRlczogU+G7kSBwaMO6dCBkaXNhYmxlIGZvbGxvdyAoxrB1IHRpw6puIGNhbyBoxqFuIHBlbmFsdHlfaG91cnMpCiAgICAgICAgICAgIHJlYXNvbjogTMO9IGRvIGRpc2FibGUgZm9sbG93CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGltcG9ydCB0aW1lCiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmdldF9hY2NvdW50KGFjY291bnRfaWQpCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgcHJpbnQoZiJbREJdIEtow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gY8OzIElEIHthY2NvdW50X2lkfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxq91IHRpw6puIHBlbmFsdHlfbWludXRlcywgbuG6v3Uga2jDtG5nIGPDsyB0aMOsIGTDuW5nIHBlbmFsdHlfaG91cnMKICAgICAgICAgICAgaWYgcGVuYWx0eV9taW51dGVzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdG90YWxfbWludXRlcyA9IHBlbmFsdHlfbWludXRlcwogICAgICAgICAgICAgICAgZGlzcGxheV91bml0ID0gZiJ7cGVuYWx0eV9taW51dGVzfSBwaMO6dCIKICAgICAgICAgICAgICAgIHByaW50KGYiW0RCXSBT4butIGThu6VuZyBwZW5hbHR5X21pbnV0ZXM6IHtwZW5hbHR5X21pbnV0ZXN9IikKICAgICAgICAgICAgZWxpZiBwZW5hbHR5X2hvdXJzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdG90YWxfbWludXRlcyA9IHBlbmFsdHlfaG91cnMgKiA2MAogICAgICAgICAgICAgICAgZGlzcGxheV91bml0ID0gZiJ7cGVuYWx0eV9ob3Vyc30gZ2nhu50iCiAgICAgICAgICAgICAgICBwcmludChmIltEQl0gU+G7rSBk4bulbmcgcGVuYWx0eV9ob3Vyczoge3BlbmFsdHlfaG91cnN9IC0+IHt0b3RhbF9taW51dGVzfSBwaMO6dCIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIE3hurdjIMSR4buLbmggMTIgZ2nhu50gPSA3MjAgcGjDunQKICAgICAgICAgICAgICAgIHRvdGFsX21pbnV0ZXMgPSA3MjAKICAgICAgICAgICAgICAgIGRpc3BsYXlfdW5pdCA9ICI3MjAgcGjDunQgKG3hurdjIMSR4buLbmgpIgogICAgICAgICAgICAgICAgcHJpbnQoZiJbREJdIFPhu60gZOG7pW5nIG3hurdjIMSR4buLbmg6IHt0b3RhbF9taW51dGVzfSBwaMO6dCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBmb2xsb3dfZGlzYWJsZV91bnRpbCA9IGludCh0aW1lLnRpbWUoKSkgKyB0b3RhbF9taW51dGVzICogNjAKICAgICAgICAgICAgcHJpbnQoZiJbREJdIERpc2FibGUgZm9sbG93OiB0b3RhbF9taW51dGVzPXt0b3RhbF9taW51dGVzfSwgZm9sbG93X2Rpc2FibGVfdW50aWw9e2ZvbGxvd19kaXNhYmxlX3VudGlsfSwgY3VycmVudF90aW1lPXtpbnQodGltZS50aW1lKCkpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICB1cGRhdGVfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJkaXNhYmxlX2ZvbGxvdyI6IFRydWUsCiAgICAgICAgICAgICAgICAiZm9sbG93X2Rpc2FibGVfdW50aWwiOiBmb2xsb3dfZGlzYWJsZV91bnRpbCwKICAgICAgICAgICAgICAgICJpbmFjdGl2ZV9mb2xsb3dfcmVhc29uIjogcmVhc29uLAogICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLnVwZGF0ZV9hY2NvdW50KGFjY291bnRfaWQsIHVwZGF0ZV9kYXRhKQogICAgICAgICAgICBwcmludChmIltEQl0gxJDDoyBkaXNhYmxlIGZvbGxvdyBjaG8gdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgYWNjb3VudF9pZCl9IHRyb25nIHtkaXNwbGF5X3VuaXR9IikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIltEQl0gTOG7l2kgZGlzYWJsZV9hY2NvdW50X2ZvbGxvdzoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGVuYWJsZV9hY2NvdW50X2ZvbGxvdyhzZWxmLCBhY2NvdW50X2lkOiBpbnQpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgRW5hYmxlIGzhuqFpIGZvbGxvdyBjaG8gdMOgaSBraG/huqNuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudF9pZDogSUQgY+G7p2EgdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmdldF9hY2NvdW50KGFjY291bnRfaWQpCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgcHJpbnQoZiJbREJdIEtow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24gY8OzIElEIHthY2NvdW50X2lkfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgImRpc2FibGVfZm9sbG93IjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZm9sbG93X2Rpc2FibGVfdW50aWwiOiAwLAogICAgICAgICAgICAgICAgImluYWN0aXZlX2ZvbGxvd19yZWFzb24iOiAiIiwKICAgICAgICAgICAgICAgICJpc19zeW5jIjogRmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgcHJpbnQoZiJbREJdIMSQw6MgZW5hYmxlIGZvbGxvdyBjaG8gdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgYWNjb3VudF9pZCl9IikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIltEQl0gTOG7l2kgZW5hYmxlX2FjY291bnRfZm9sbG93OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UgCgogICAgZGVmIGdldF9hY2NvdW50c19ieV9hcHBfYW5kX2dvbGlrZV9zdGF0dXMoc2VsZiwgYXBwOiBzdHIsIGlzX2xpbmtlZDogYm9vbCA9IEZhbHNlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiB0aGVvIGFwcCB2w6AgdHLhuqFuZyB0aMOhaSBnb2xpa2UKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhcHA6IFTDqm4g4bupbmcgZOG7pW5nIChpbnN0YWdyYW0sIHRpa3RvaywgLi4uKQogICAgICAgICAgICBpc19saW5rZWQ6IFRydWUgbuG6v3UgbOG6pXkgdMOgaSBraG/huqNuIMSRw6MgbGnDqm4ga+G6v3QsIEZhbHNlIG7hur91IGzhuqV5IHTDoGkga2hv4bqjbiBjaMawYSBsacOqbiBr4bq/dAogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAiIiIKICAgICAgICBjb25uID0gc2VsZi5fZ2V0X2Nvbm5lY3Rpb24oKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAKICAgICAgICBxdWVyeSA9ICJTRUxFQ1QgKiBGUk9NIGFjY291bnRzIFdIRVJFIGFwcCA9ID8gQU5EIGlzX2dvbGlrZV9saW5rZWQgPSA/IgogICAgICAgIHBhcmFtcyA9IFthcHAsIDEgaWYgaXNfbGlua2VkIGVsc2UgMF0KICAgICAgICAKICAgICAgICAjIEzhu41jIHRoZW8gZGV2aWNlX2lkIGPhu6dhIHRoaeG6v3QgYuG7iyBoaeG7h24gdOG6oWkKICAgICAgICBjdXJyZW50X2RldmljZV9pZCA9IHNlbGYuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgIGlmIGN1cnJlbnRfZGV2aWNlX2lkOgogICAgICAgICAgICBxdWVyeSArPSAiIEFORCBkZXZpY2VfaWQgPSA/IgogICAgICAgICAgICBwYXJhbXMuYXBwZW5kKGN1cnJlbnRfZGV2aWNlX2lkKQogICAgICAgIAogICAgICAgIGN1cnNvci5leGVjdXRlKHF1ZXJ5LCBwYXJhbXMpCiAgICAgICAgY29sdW1uX25hbWVzID0gW2Rlc2NyaXB0aW9uWzBdIGZvciBkZXNjcmlwdGlvbiBpbiBjdXJzb3IuZGVzY3JpcHRpb25dCiAgICAgICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgCiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIGZvciByZXN1bHQgaW4gcmVzdWx0czoKICAgICAgICAgICAgIyBDaHV54buDbiDEkeG7lWkga+G6v3QgcXXhuqMgdGjDoG5oIGRpY3QKICAgICAgICAgICAgYWNjb3VudCA9IHtjb2x1bW5fbmFtZXNbaV06IHJlc3VsdFtpXSBmb3IgaSBpbiByYW5nZShsZW4oY29sdW1uX25hbWVzKSl9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIENodXnhu4NuIMSR4buVaSBjw6FjIHRyxrDhu51uZyBib29sZWFuCiAgICAgICAgICAgIGFjY291bnRbImlzX2xvZ2luIl0gPSBib29sKGFjY291bnRbImlzX2xvZ2luIl0pCiAgICAgICAgICAgIGFjY291bnRbImpvYl9lbmFibGUiXSA9IGJvb2woYWNjb3VudFsiam9iX2VuYWJsZSJdKQogICAgICAgICAgICBhY2NvdW50WyJpc19nb2xpa2VfbGlua2VkIl0gPSBib29sKGFjY291bnRbImlzX2dvbGlrZV9saW5rZWQiXSkKICAgICAgICAgICAgYWNjb3VudFsiaXNfc3luYyJdID0gYm9vbChhY2NvdW50WyJpc19zeW5jIl0pCiAgICAgICAgICAgICMgTHXDtG4gbHXDtG4gxJHhu4MgZGlzYWJsZV9mb2xsb3cgPSBGYWxzZSB2w6wgxJHDoyBi4buPIGdp4bubaSBo4bqhbiBmb2xsb3cKICAgICAgICAgICAgYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXSA9IGJvb2woYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gZOG7ryBsaeG7h3UgcGjhu6UgdOG7qyB0csaw4budbmcgZGF0YQogICAgICAgICAgICBpZiAiZGF0YSIgaW4gYWNjb3VudCBhbmQgYWNjb3VudFsiZGF0YSJdOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGV4dHJhX2RhdGEgPSBqc29uLmxvYWRzKGFjY291bnRbImRhdGEiXSkKICAgICAgICAgICAgICAgICAgICBhY2NvdW50LnVwZGF0ZShleHRyYV9kYXRhKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDs2EgdHLGsOG7nW5nIGRhdGEgxJHhu4MgdHLDoW5oIHRyw7luZyBs4bq3cAogICAgICAgICAgICBpZiAiZGF0YSIgaW4gYWNjb3VudDoKICAgICAgICAgICAgICAgIGRlbCBhY2NvdW50WyJkYXRhIl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBhY2NvdW50cy5hcHBlbmQoYWNjb3VudCkKICAgICAgICAKICAgICAgICByZXR1cm4gYWNjb3VudHMKICAgIAogICAgZGVmIGdldF9hY2NvdW50X2NhcmVfZGF0YShzZWxmLCBhY2NvdW50X2lkOiBpbnQpIC0+IGRpY3Q6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgY2FyZSBkYXRhIGPhu6dhIHTDoGkga2hv4bqjbiBkxrDhu5tpIGThuqFuZyBkaWN0CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudF9pZDogSUQgY+G7p2EgdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGRpY3Q6IENhcmUgZGF0YSBob+G6t2MgZGljdCBy4buXbmcgbuG6v3UgY2jGsGEgY8OzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KHNlbGYuZGJfcGF0aCkKICAgICAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgICAgICAKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBjYXJlX2RhdGEgRlJPTSBhY2NvdW50cyBXSEVSRSBpZCA9ID8iLCAoYWNjb3VudF9pZCwpKQogICAgICAgICAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgICAgICBjb25uLmNsb3NlKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdCBhbmQgcmVzdWx0WzBdOgogICAgICAgICAgICAgICAgaW1wb3J0IGpzb24KICAgICAgICAgICAgICAgIHJldHVybiBqc29uLmxvYWRzKHJlc3VsdFswXSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiB7fQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgbOG6pXkgY2FyZSBkYXRhIGNobyBhY2NvdW50IHthY2NvdW50X2lkfToge2V9IikKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAKICAgIGRlZiB1cGRhdGVfYWNjb3VudF9jYXJlX2RhdGEoc2VsZiwgYWNjb3VudF9pZDogaW50LCBjYXJlX2RhdGE6IGRpY3QpOgogICAgICAgICIiIgogICAgICAgIEPhuq1wIG5o4bqtdCBjYXJlIGRhdGEgY2hvIHTDoGkga2hv4bqjbgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnRfaWQ6IElEIGPhu6dhIHTDoGkga2hv4bqjbgogICAgICAgICAgICBjYXJlX2RhdGE6IERpY3Rpb25hcnkgY2jhu6lhIHRow7RuZyB0aW4gY2FyZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0IGpzb24KICAgICAgICAgICAgY2FyZV9qc29uID0ganNvbi5kdW1wcyhjYXJlX2RhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KHNlbGYuZGJfcGF0aCkKICAgICAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgICAgICAKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAiVVBEQVRFIGFjY291bnRzIFNFVCBjYXJlX2RhdGEgPSA/LCBpc19zeW5jID0gMCBXSEVSRSBpZCA9ID8iLCAKICAgICAgICAgICAgICAgIChjYXJlX2pzb24sIGFjY291bnRfaWQpCiAgICAgICAgICAgICkKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICBjb25uLmNsb3NlKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KGYixJDDoyBj4bqtcCBuaOG6rXQgY2FyZSBkYXRhIGNobyBhY2NvdW50IHthY2NvdW50X2lkfSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBj4bqtcCBuaOG6rXQgY2FyZSBkYXRhIGNobyBhY2NvdW50IHthY2NvdW50X2lkfToge2V9IikKICAgIAogICAgZGVmIG1lcmdlX2FjY291bnRfY2FyZV9kYXRhKHNlbGYsIGFjY291bnRfaWQ6IGludCwgbmV3X2RhdGE6IGRpY3QpOgogICAgICAgICIiIgogICAgICAgIE1lcmdlIGThu68gbGnhu4d1IG3hu5tpIHbDoG8gY2FyZSBkYXRhIGhp4buHbiBjw7MKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50X2lkOiBJRCBj4bunYSB0w6BpIGtob+G6o24KICAgICAgICAgICAgbmV3X2RhdGE6IERpY3Rpb25hcnkgY2jhu6lhIGThu68gbGnhu4d1IG3hu5tpIGPhuqduIG1lcmdlCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGNhcmUgZGF0YSBoaeG7h24gdOG6oWkKICAgICAgICAgICAgY3VycmVudF9kYXRhID0gc2VsZi5nZXRfYWNjb3VudF9jYXJlX2RhdGEoYWNjb3VudF9pZCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTWVyZ2UgZOG7ryBsaeG7h3UgbeG7m2kKICAgICAgICAgICAgY3VycmVudF9kYXRhLnVwZGF0ZShuZXdfZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGzhuqFpCiAgICAgICAgICAgIHNlbGYudXBkYXRlX2FjY291bnRfY2FyZV9kYXRhKGFjY291bnRfaWQsIGN1cnJlbnRfZGF0YSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIG1lcmdlIGNhcmUgZGF0YSBjaG8gYWNjb3VudCB7YWNjb3VudF9pZH06IHtlfSIpCg==').decode('utf-8'))
