import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHJlCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBvcwppbXBvcnQgY29uZmlnCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBUdXBsZSwgTGlzdCwgVW5pb24KdHJ5OgogICAgZnJvbSBseG1sIGltcG9ydCBldHJlZQogICAgTFhNTF9BVkFJTEFCTEUgPSBUcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIExYTUxfQVZBSUxBQkxFID0gRmFsc2UKCmNsYXNzIEhlbHBlclNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgYmFzZV91cmw6IHN0ciA9ICJodHRwOi8vbG9jYWxob3N0OjgwODAiKToKICAgICAgICBzZWxmLmJhc2VfdXJsID0gYmFzZV91cmwKICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHNlbGYuZGV2aWNlX2lwID0gTm9uZQogICAgICAgIAogICAgICAgICMgTuG6v3UgYmFzZV91cmwgY2jhu6lhIMSR4buLYSBjaOG7iSBJUCwgdGjhu60ga+G6v3QgbuG7kWkgQURCCiAgICAgICAgaXBfbWF0Y2ggPSByZS5zZWFyY2gociJodHRwOi8vKFswLTldK1wuWzAtOV0rXC5bMC05XStcLlswLTldKykiLCBiYXNlX3VybCkKICAgICAgICBpZiBpcF9tYXRjaDoKICAgICAgICAgICAgc2VsZi5kZXZpY2VfaXAgPSBpcF9tYXRjaC5ncm91cCgxKQogICAgICAgICAgICBzZWxmLmNoZWNrX2FuZF9jb25uZWN0X2FkYigpCgogICAgZGVmIGNoZWNrX2FuZF9jb25uZWN0X2FkYihzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgdsOgIGvhur90IG7hu5FpIEFEQiB04bubaSB0aGnhur90IGLhu4sKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBBREIgY8OzIMSRxrDhu6NjIGPDoGkgxJHhurd0IGtow7RuZwogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbImFkYiIsICItLXZlcnNpb24iXSwgY2hlY2s9VHJ1ZSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS+G6v3QgbuG7kWkgQURCIMSR4bq/biB0aGnhur90IGLhu4sgc+G7rSBk4bulbmcgxJHhu4thIGNo4buJIHThu6sgY29uZmlnCiAgICAgICAgICAgIGFkYl9hZGRyZXNzID0gZiJ7Y29uZmlnLkFEQl9IT1NUfTp7Y29uZmlnLkFEQl9QT1JUfSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjhu60ga+G6v3QgbuG7kWkgxJHhur9uIHRoaeG6v3QgYuG7iwogICAgICAgICAgICBjb25uZWN0X3Byb2Nlc3MgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgIFsiYWRiIiwgImNvbm5lY3QiLCBhZGJfYWRkcmVzc10sCiAgICAgICAgICAgICAgICBjaGVjaz1UcnVlLAogICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB0ZXh0PVRydWUKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IHF14bqjIGvhur90IG7hu5FpCiAgICAgICAgICAgIGlmICJjb25uZWN0ZWQiIGluIGNvbm5lY3RfcHJvY2Vzcy5zdGRvdXQubG93ZXIoKToKICAgICAgICAgICAgICAgIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZCA9IFRydWUKICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyBr4bq/dCBu4buRaSBBREIgdGjDoG5oIGPDtG5nIMSR4bq/biB7YWRiX2FkZHJlc3N9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgKHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yLCBGaWxlTm90Rm91bmRFcnJvcikgYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJLaMO0bmcgdGjhu4Mga+G6v3QgbuG7kWkgQURCOiB7ZX0iKQogICAgICAgIAogICAgICAgIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9nZXRfYWRiX2RldmljZV9wYXJhbShzZWxmKSAtPiBMaXN0W3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgVHLhuqMgduG7gSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLIGNobyBs4buHbmggQURCCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtzdHJdOiBEYW5oIHPDoWNoIHRoYW0gc+G7kSBbLXMsIGRldmljZV9pZF0gaG/hurdjIGxpc3QgcuG7l25nIG7hur91IGtow7RuZyBjw7MgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIHJldHVybiBbIi1zIiwgYWRiX2FkZHJlc3NdCiAgICAgICAgcmV0dXJuIFtdCgogICAgZGVmIF9tYWtlX3JlcXVlc3Qoc2VsZiwgZW5kcG9pbnQ6IHN0ciwgcGFyYW1zOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gcmVxdWVzdCBBUEkgdsOgIHRy4bqjIHbhu4Ega+G6v3QgcXXhuqMgZOG6oW5nIEpTT04gaG/hurdjIFhNTAogICAgICAgICIiIgogICAgICAgIHVybCA9IGYie3NlbGYuYmFzZV91cmx9L3tlbmRwb2ludH0iCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRoaeG6v3QgbOG6rXAgdGltZW91dCBjaG8gcmVxdWVzdAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIENvbnRlbnQtVHlwZQogICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICMgVHLhuqMgduG7gSBYTUwgZMaw4bubaSBk4bqhbmcgdGV4dAogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLnRleHR9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgSlNPTgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlRpbWVvdXQ6CiAgICAgICAgICAgIHByaW50KGYiUmVxdWVzdCB0aW1lb3V0IGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCIpCiAgICAgICAgICAgIHNlbGYuX3Jlc3RhcnRfaGVscGVyX2FwcCgpCiAgICAgICAgICAgICMgVGjhu60gbOG6oWkgcmVxdWVzdCBzYXUga2hpIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKSAgIyBDaOG7nSAxIGdpw6J5IMSR4buDIOG7qW5nIGThu6VuZyBraOG7n2kgxJHhu5luZwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJkYXRhIjogcmVzcG9uc2UudGV4dH0KICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIlbhuqtuIGzhu5dpIHNhdSBraGkgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvciBhcyBlOgogICAgICAgICAgICAjIELhuq90IGzhu5dpIGvhur90IG7hu5FpIGLhu4sgdOG7qyBjaOG7kWkgaG/hurdjIGtow7RuZyB0aOG7gyBr4bq/dCBu4buRaQogICAgICAgICAgICBwcmludChmIkzhu5dpIGvhur90IG7hu5FpIGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgc2VsZi5fcmVzdGFydF9oZWxwZXJfYXBwKCkKICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSByZXF1ZXN0IHNhdSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpICAjIENo4budIDIgZ2nDonkgxJHhu4Mg4bupbmcgZOG7pW5nIGto4bufaSDEkeG7mW5nCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29udGVudF90eXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICAgICAgaWYgJ2FwcGxpY2F0aW9uL3htbCcgaW4gY29udGVudF90eXBlIG9yIGVuZHBvaW50ID09ICdkdW1wLXNjcmVlbi14bWwnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgImRhdGEiOiByZXNwb25zZS50ZXh0fQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIHJlcXVlc3Q6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQoKICAgIGRlZiBfcmVzdGFydF9oZWxwZXJfYXBwKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBz4butIGThu6VuZyBBREIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgaGVscGVyIGFwcCBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCAiYW0iLCAic3RhcnQiLCAiLW4iLCAiY29tLmRuZHZpbmEuaGVscGVyLy5NYWluQWN0aXZpdHkiXQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcHJpbnQoIsSQw6Mga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIktow7RuZyB0aOG7gyBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHbDrCBBREIgY2jGsGEgxJHGsOG7o2Mga+G6v3QgbuG7kWkiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgdGFwKHNlbGYsIHg6IGludCwgeTogaW50KSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaOG6oW0gdsOgbyB24buLIHRyw60geCx5IHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJ0YXAiLCBwYXJhbXM9eyJ4IjogeCwgInkiOiB5fSkKCiAgICBkZWYgdGFwX2VsZW1lbnQoc2VsZiwgYm91bmRzOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIG3hu5l0IHBo4bqnbiB04butIGThu7FhIHRyw6puIGJvdW5kcyBj4bunYSBuw7MKICAgICAgICBGb3JtYXQgYm91bmRzOiAiW3gxLHkxXVt4Mix5Ml0iCiAgICAgICAgIiIiCiAgICAgICAgIyBQaMOibiB0w61jaCBib3VuZHMgxJHhu4MgbOG6pXkgdOG7jWEgxJHhu5kKICAgICAgICBtYXRjaCA9IHJlLm1hdGNoKHIiXFsoXGQrKSwoXGQrKVxdXFsoXGQrKSwoXGQrKVxdIiwgYm91bmRzKQogICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IG1hcChpbnQsIG1hdGNoLmdyb3VwcygpKQogICAgICAgICAgICAjIENo4buNbiBt4buZdCDEkWnhu4NtIG5n4bqrdSBuaGnDqm4gdHJvbmcgYm91bmRzCiAgICAgICAgICAgIHggPSByYW5kb20ucmFuZGludCh4MSwgeDIpCiAgICAgICAgICAgIHkgPSByYW5kb20ucmFuZGludCh5MSwgeTIpCiAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcCh4LCB5KQogICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIsSQ4buLbmggZOG6oW5nIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hyJ9CgogICAgZGVmIHN3aXBlX3VwKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCBsw6puIHThu6sgduG7iyB0csOtIG5n4bqrdSBuaGnDqm4gcGjDuSBo4bujcAogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX3VwIikKCiAgICBkZWYgc3dpcGVfZG93bihzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgeHXhu5FuZyB04burIHbhu4sgdHLDrSBuZ+G6q3Ugbmhpw6puIHBow7kgaOG7o3AKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV9kb3duIikKCiAgICBkZWYgaW5wdXRfdGV4dChzZWxmLCB0ZXh0OiBzdHIsIHNwZWVkOiBmbG9hdCA9IDEuMCwgCiAgICAgICAgICAgICAgICAgIGRpcmVjdF9tb2RlOiBib29sID0gRmFsc2UsIHBlcmZlY3RfbW9kZTogYm9vbCA9IFRydWUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3DtCBwaOG7j25nIGfDtSBwaMOtbSB24bubaSB04buRYyDEkeG7mSBuZ+G6q3Ugbmhpw6puIGdp4buRbmcgbmfGsOG7nWkgdGjhuq10CiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAidGV4dCI6IHRleHQsCiAgICAgICAgICAgICJzcGVlZCI6IHNwZWVkLAogICAgICAgICAgICAiZGlyZWN0X21vZGUiOiBzdHIoZGlyZWN0X21vZGUpLmxvd2VyKCksCiAgICAgICAgICAgICJwZXJmZWN0X21vZGUiOiBzdHIocGVyZmVjdF9tb2RlKS5sb3dlcigpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImlucHV0X3RleHQiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBzaG93X3RvYXN0KHNlbGYsIG1lc3NhZ2U6IHN0ciwgdHlwZV86IHN0ciA9ICJpbmZvIiwgCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBzdHIgPSAiYm90dG9tIikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIHRvYXN0CiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICJ0eXBlIjogdHlwZV8sCiAgICAgICAgICAgICJwb3NpdGlvbiI6IHBvc2l0aW9uCiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInRvYXN0LW1lc3NhZ2UiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBnZXRfZGV2aWNlX2luZm8oc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGjDtG5nIHRpbiBjaGkgdGnhur90IHbhu4EgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgiZGV2aWNlLWluZm8iKQoKICAgIGRlZiBkdW1wX3NjcmVlbl94bWwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIER1bXAgdG/DoG4gYuG7mSBj4bqldSB0csO6YyBYTUwgY+G7p2EgbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICAKICAgICAgICBUcuG6oyB24buBIG7hu5lpIGR1bmcgWE1MIGTGsOG7m2kgZOG6oW5nIGNodeG7l2kKICAgICAgICAiIiIKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiZHVtcC1zY3JlZW4teG1sIikKICAgICAgICBpZiByZXNwb25zZVsic3RhdHVzIl0gPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXQogICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBvcGVuX2FwcChzZWxmLCBwYWNrYWdlOiBzdHIsIGFjdGl2aXR5OiBzdHIgPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBN4bufIG3hu5l0IOG7qW5nIGThu6VuZyB24bubaSBwYWNrYWdlIG5hbWUgdsOgIGFjdGl2aXR5IGPhu6UgdGjhu4MKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7InBhY2thZ2UiOiBwYWNrYWdlfQogICAgICAgIGlmIGFjdGl2aXR5OgogICAgICAgICAgICBwYXJhbXNbImFjdGl2aXR5Il0gPSBhY3Rpdml0eQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoIm9wZW5fYXBwIiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgY2xvc2VfYXBwKHNlbGYsIHBhY2thZ2U6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgxJDDs25nIG3hu5l0IOG7qW5nIGThu6VuZyDEkWFuZyBjaOG6oXkKICAgICAgICDGr3UgdGnDqm4gc+G7rSBk4bulbmcgQURCIG7hur91IMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICAiIiIKICAgICAgICBpZiBzZWxmLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkMOzbmcg4bupbmcgZOG7pW5nIGLhurFuZyBBREIKICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJzaGVsbCIsIGYiYW0gZm9yY2Utc3RvcCB7cGFja2FnZX0iXQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJtZXNzYWdlIjogZiLEkMOjIMSRw7NuZyB7cGFja2FnZX0gYuG6sW5nIEFEQiJ9CiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHDs25nIOG7qW5nIGThu6VuZyBi4bqxbmcgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgIyBO4bq/dSBs4buXaSwgdGjhu60gcGjGsMahbmcgdGjhu6ljIEhUVFAKICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIEhUVFAgQVBJIG7hur91IGtow7RuZyBjw7MgQURCIGhv4bq3YyBBREIgYuG7iyBs4buXaQogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoImNsb3NlX2FwcCIsIHBhcmFtcz17InBhY2thZ2UiOiBwYWNrYWdlfSkKCiAgICBkZWYgX3Nhbml0aXplX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTCDEkeG7gyB0csOhbmggbOG7l2kga2hpIHBow6JuIHTDrWNoCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgeG1sX2NvbnRlbnQ6IENodeG7l2kgWE1MIGPhuqduIHjhu60gbMO9CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogQ2h14buXaSBYTUwgxJHDoyDEkcaw4bujYyB44butIGzDvQogICAgICAgICIiIgogICAgICAgICMgVGhheSB0aOG6vyBjw6FjIGvDvSB04buxICYga2jDtG5nIGjhu6NwIGzhu4cgYuG6sW5nICZhbXA7CiAgICAgICAgIyBOaMawbmcgZ2nhu68gbmd1ecOqbiBjw6FjIGVudGl0eSBo4bujcCBs4buHIG5oxrAgJmFtcDssICZsdDssICZndDssICZxdW90OywgJmFwb3M7CiAgICAgICAgeG1sX2NvbnRlbnQgPSByZS5zdWIocicmKD8hKGFtcHxsdHxndHxxdW90fGFwb3MpOyknLCAnJmFtcDsnLCB4bWxfY29udGVudCkKICAgICAgICAKICAgICAgICAjIExv4bqhaSBi4buPIGPDoWMga8O9IHThu7EgxJFp4buBdSBraGnhu4NuIGtow7RuZyBo4bujcCBs4buHIHRyb25nIFhNTAogICAgICAgIHhtbF9jb250ZW50ID0gcmUuc3ViKHInW1x4MDAtXHgwOFx4MEJceDBDXHgwRS1ceDFGXScsICcnLCB4bWxfY29udGVudCkKICAgICAgICAKICAgICAgICByZXR1cm4geG1sX2NvbnRlbnQKCiAgICBkZWYgZmluZF9lbGVtZW50X2luX3htbChzZWxmLCB4bWxfY29udGVudDogc3RyLCAKICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSBwaOG6p24gdOG7rSB0cm9uZyBYTUwgZOG7sWEgdHLDqm4gdGV4dCwgY29udGVudC1kZXNjLCByZXNvdXJjZS1pZCBob+G6t2MgY2xhc3MKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IFBo4bqnbiB04butIMSR4bqndSB0acOqbiB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICBpZiBub3QgeG1sX2NvbnRlbnQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgIGlmIExYTUxfQVZBSUxBQkxFOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjDonkgZOG7sW5nIFhQYXRoIHF1ZXJ5IGThu7FhIHRyw6puIGPDoWMgxJFp4buBdSBraeG7h24KICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0B0ZXh0PSJ7dGV4dH0iJykKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0BjbGFzcz0ie2NsYXNzX25hbWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ID0gIi8vbm9kZSIKICAgICAgICAgICAgICAgIGlmIGNvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgKz0gIlsiICsgIiBhbmQgIi5qb2luKGNvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBwaOG6p24gdOG7rSDEkeG6p3UgdGnDqm4gcGjDuSBo4bujcAogICAgICAgICAgICAgICAgZWxlbWVudCA9IHJvb3QueHBhdGgoeHBhdGhfcXVlcnkpCiAgICAgICAgICAgICAgICBpZiBlbGVtZW50OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbGVtZW50X3RvX2RpY3QoZWxlbWVudFswXSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBwaOG6p24gdOG7rSB24bubaSBseG1sOiB7ZX0iKQogICAgICAgIAogICAgICAgICMgRmFsbGJhY2s6IFTDrG0ga2nhur9tIGLhurFuZyByZWdleAogICAgICAgIGlmIHRleHQ6CiAgICAgICAgICAgIHBhdHRlcm4gPSBmJ3RleHQ9Int0ZXh0fSInCiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHhtbF9jb250ZW50KQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICMgVMOsbSB0aOG6uyBub2RlIGNo4bupYSB0ZXh0CiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAKICAgICAgICBpZiBjb250ZW50X2Rlc2M6CiAgICAgICAgICAgIHBhdHRlcm4gPSBmJ2NvbnRlbnQtZGVzYz0ie2NvbnRlbnRfZGVzY30iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgY29udGVudC1kZXNjCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAKICAgICAgICBpZiByZXNvdXJjZV9pZDoKICAgICAgICAgICAgcGF0dGVybiA9IGYncmVzb3VyY2UtaWQ9IntyZXNvdXJjZV9pZH0iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgcmVzb3VyY2UtaWQKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgIGlmIGNsYXNzX25hbWU6CiAgICAgICAgICAgIHBhdHRlcm4gPSBmJ2NsYXNzPSJ7Y2xhc3NfbmFtZX0iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgY2xhc3MKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0X2F0dHJpYnV0ZXMobm9kZV9jb250ZW50KQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGRlZiBmaW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHBo4bqnbiB04butIHRyb25nIFhNTCBwaMO5IGjhu6NwIHbhu5tpIMSRaeG7gXUga2nhu4duCiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0cyA9IFtdCiAgICAgICAgCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50OgogICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MIMSR4buDIHRyw6FuaCBs4buXaSBFbnRpdHlSZWYKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjDonkgZOG7sW5nIFhQYXRoIHF1ZXJ5IGThu7FhIHRyw6puIGPDoWMgxJFp4buBdSBraeG7h24KICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0B0ZXh0PSJ7dGV4dH0iJykKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0BjbGFzcz0ie2NsYXNzX25hbWV9IicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ID0gIi8vbm9kZSIKICAgICAgICAgICAgICAgIGlmIGNvbmRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgKz0gIlsiICsgIiBhbmQgIi5qb2luKGNvbmRpdGlvbnMpICsgIl0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB04bqldCBj4bqjIHBo4bqnbiB04butIHBow7kgaOG7o3AKICAgICAgICAgICAgICAgIGVsZW1lbnRzID0gcm9vdC54cGF0aCh4cGF0aF9xdWVyeSkKICAgICAgICAgICAgICAgIGZvciBlbGVtZW50IGluIGVsZW1lbnRzOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2VsZW1lbnRfdG9fZGljdChlbGVtZW50KSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdMOsbSBwaOG6p24gdOG7rSB24bubaSBseG1sOiB7ZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiJUaOG7rSB0w6xtIHBo4bqnbiB04butIGLhurFuZyBwaMawxqFuZyB0aOG7qWMgdGhheSB0aOG6vy4uLiIpCiAgICAgICAgCiAgICAgICAgIyBGYWxsYmFjazogVMOsbSBraeG6v20gYuG6sW5nIHJlZ2V4IChjaOG7iSB0cuG6oyB24buBIGvhur90IHF14bqjIMSRxqFuIGdp4bqjbikKICAgICAgICBpZiBub3QgcmVzdWx0cyBhbmQgdGV4dDoKICAgICAgICAgICAgcGF0dGVybiA9IGYndGV4dD0ie3RleHR9IicKICAgICAgICAgICAgZm9yIG1hdGNoIGluIHJlLmZpbmRpdGVyKHBhdHRlcm4sIHhtbF9jb250ZW50KToKICAgICAgICAgICAgICAgIHN0YXJ0X3BvcyA9IHhtbF9jb250ZW50LnJmaW5kKCc8bm9kZScsIDAsIG1hdGNoLnN0YXJ0KCkpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3MgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZW5kX3BvcyA9IHhtbF9jb250ZW50LmZpbmQoJz4nLCBzdGFydF9wb3MpICsgMQogICAgICAgICAgICAgICAgICAgIG5vZGVfY29udGVudCA9IHhtbF9jb250ZW50W3N0YXJ0X3BvczplbmRfcG9zXQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzCiAgICAKICAgIGRlZiBfZXh0cmFjdF9hdHRyaWJ1dGVzKHNlbGYsIG5vZGVfY29udGVudDogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUcsOtY2ggeHXhuqV0IGPDoWMgdGh14buZYyB0w61uaCB04burIG7hu5lpIGR1bmcgY+G7p2EgbeG7mXQgdGjhursgbm9kZQogICAgICAgICIiIgogICAgICAgIGF0dHJpYnV0ZXMgPSB7fQogICAgICAgIAogICAgICAgICMgQ8OhYyB0aHXhu5ljIHTDrW5oIGPhuqduIHRyw61jaCB4deG6pXQKICAgICAgICBhdHRyX3BhdHRlcm5zID0gewogICAgICAgICAgICAiY2xhc3MiOiByJ2NsYXNzPSIoW14iXSopIicsCiAgICAgICAgICAgICJwYWNrYWdlIjogcidwYWNrYWdlPSIoW14iXSopIicsCiAgICAgICAgICAgICJyZXNvdXJjZS1pZCI6IHIncmVzb3VyY2UtaWQ9IihbXiJdKikiJywKICAgICAgICAgICAgInRleHQiOiByJ3RleHQ9IihbXiJdKikiJywKICAgICAgICAgICAgImNvbnRlbnQtZGVzYyI6IHInY29udGVudC1kZXNjPSIoW14iXSopIicsCiAgICAgICAgICAgICJib3VuZHMiOiByJ2JvdW5kcz0iKFteIl0qKSInLAogICAgICAgICAgICAiY2hlY2thYmxlIjogcidjaGVja2FibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImNoZWNrZWQiOiByJ2NoZWNrZWQ9IihbXiJdKikiJywKICAgICAgICAgICAgImNsaWNrYWJsZSI6IHInY2xpY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJlbmFibGVkIjogcidlbmFibGVkPSIoW14iXSopIicsCiAgICAgICAgICAgICJmb2N1c2FibGUiOiByJ2ZvY3VzYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAiZm9jdXNlZCI6IHInZm9jdXNlZD0iKFteIl0qKSInLAogICAgICAgICAgICAic2Nyb2xsYWJsZSI6IHInc2Nyb2xsYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAibG9uZy1jbGlja2FibGUiOiByJ2xvbmctY2xpY2thYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJwYXNzd29yZCI6IHIncGFzc3dvcmQ9IihbXiJdKikiJywKICAgICAgICAgICAgInNlbGVjdGVkIjogcidzZWxlY3RlZD0iKFteIl0qKSInCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciBhdHRyX25hbWUsIHBhdHRlcm4gaW4gYXR0cl9wYXR0ZXJucy5pdGVtcygpOgogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCBub2RlX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgYXR0cmlidXRlc1thdHRyX25hbWVdID0gbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhdHRyaWJ1dGVzCgogICAgZGVmIF9lbGVtZW50X3RvX2RpY3Qoc2VsZiwgZWxlbWVudCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2h1eeG7g24gxJHhu5VpIG3hu5l0IHBo4bqnbiB04butIFhNTCB04burIGx4bWwgdGjDoG5oIGRpY3QKICAgICAgICAiIiIKICAgICAgICByZXN1bHQgPSB7fQogICAgICAgIAogICAgICAgICMgTOG6pXkgdOG6pXQgY+G6oyB0aHXhu5ljIHTDrW5oCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZWxlbWVudC5hdHRyaWIuaXRlbXMoKToKICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0CgogICAgZGVmIGZpbmRfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSBwaOG6p24gdOG7rSB0csOqbiBtw6BuIGjDrG5oIGThu7FhIHRyw6puIHRleHQsIGNvbnRlbnQtZGVzYywgcmVzb3VyY2UtaWQgaG/hurdjIGNsYXNzCiAgICAgICAgIiIiCiAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9lbGVtZW50X2luX3htbCh4bWxfY29udGVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSkKCiAgICBkZWYgZmluZF9hbGxfZWxlbWVudHMoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gdOG6pXQgY+G6oyBjw6FjIHBo4bqnbiB04butIHRyw6puIG3DoG4gaMOsbmggcGjDuSBo4bujcCB24bubaSDEkWnhu4F1IGtp4buHbgogICAgICAgICIiIgogICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIHJldHVybiBzZWxmLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCh4bWxfY29udGVudCwgdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCwgY2xhc3NfbmFtZSkKCiAgICBkZWYgaXNfZWxlbWVudF9zZWxlY3RlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2MgY2jhu41uIGhheSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoInNlbGVjdGVkIikgPT0gInRydWUiCgogICAgZGVmIHdhaXRfZm9yX2VsZW1lbnQoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIHRpbWVvdXQ6IGludCA9IDMwLCAKICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgbeG7mXQgcGjhuqduIHThu60geHXhuqV0IGhp4buHbiB0csOqbiBtw6BuIGjDrG5oCiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgdGltZW91dDoKICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYuZmluZF9lbGVtZW50KHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQpCiAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgIGRlZiBnZXRfZWxlbWVudF90ZXh0KHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGV4dCBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgidGV4dCIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY29udGVudF9kZXNjKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgY29udGVudC1kZXNjIGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X3Jlc291cmNlX2lkKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgcmVzb3VyY2UtaWQgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoInJlc291cmNlLWlkIiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jbGFzcyhzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGNsYXNzIGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjbGFzcyIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfZW5hYmxlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2Mga8OtY2ggaG/huqF0IGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiZW5hYmxlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2xpY2thYmxlKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyB0aOG7gyBuaOG6pXAgdsOgbyBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImNsaWNrYWJsZSIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfZm9jdXNlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2MgZm9jdXMga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJmb2N1c2VkIikgPT0gInRydWUiCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jaGVja2VkKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyDEkcaw4bujYyBjaOG7jW4ga2jDtG5nIChjaG8gY2hlY2tib3gpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjaGVja2VkIikgPT0gInRydWUiCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9ib3VuZHMoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IFR1cGxlW2ludCwgaW50LCBpbnQsIGludF06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdOG7jWEgxJHhu5kgYm91bmRzIGPhu6dhIHBo4bqnbiB04butIGTGsOG7m2kgZOG6oW5nIHR1cGxlICh4MSwgeTEsIHgyLCB5MikKICAgICAgICAiIiIKICAgICAgICBib3VuZHMgPSBlbGVtZW50LmdldCgiYm91bmRzIiwgIlswLDBdWzAsMF0iKQogICAgICAgIG1hdGNoID0gcmUubWF0Y2gociJcWyhcZCspLChcZCspXF1cWyhcZCspLChcZCspXF0iLCBib3VuZHMpCiAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgIHJldHVybiB0dXBsZShtYXAoaW50LCBtYXRjaC5ncm91cHMoKSkpCiAgICAgICAgcmV0dXJuICgwLCAwLCAwLCAwKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2VudGVyKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBUdXBsZVtpbnQsIGludF06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdOG7jWEgxJHhu5kgdHJ1bmcgdMOibSBj4bunYSBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHgxLCB5MSwgeDIsIHkyID0gc2VsZi5nZXRfZWxlbWVudF9ib3VuZHMoZWxlbWVudCkKICAgICAgICByZXR1cm4gKCh4MSArIHgyKSAvLyAyLCAoeTEgKyB5MikgLy8gMikKICAgIAogICAgZGVmIHRhcF9lbGVtZW50X2NlbnRlcihzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhuqFtIHbDoG8gdHJ1bmcgdMOibSBj4bunYSBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHgsIHkgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgICAgIHJldHVybiBzZWxmLnRhcCh4LCB5KQogICAgCiAgICBkZWYgbG9uZ19wcmVzcyhzZWxmLCB4OiBpbnQsIHk6IGludCwgZHVyYXRpb246IGludCA9IDEwMDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBnaeG7ryB04bqhaSB24buLIHRyw60geCx5IHRyb25nIG3hu5l0IGtob+G6o25nIHRo4budaSBnaWFuCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAieCI6IHgsCiAgICAgICAgICAgICJ5IjogeSwKICAgICAgICAgICAgImR1cmF0aW9uIjogZHVyYXRpb24KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgibG9uZ19wcmVzcyIsIHBhcmFtcz1wYXJhbXMpCiAgICAKICAgIGRlZiBsb25nX3ByZXNzX2VsZW1lbnQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0sIGR1cmF0aW9uOiBpbnQgPSAxMDAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gZ2nhu68gdOG6oWkgdHJ1bmcgdMOibSBj4bunYSBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHgsIHkgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihlbGVtZW50KQogICAgICAgIHJldHVybiBzZWxmLmxvbmdfcHJlc3MoeCwgeSwgZHVyYXRpb24pCiAgICAKICAgIGRlZiBzd2lwZShzZWxmLCBzdGFydF94OiBpbnQsIHN0YXJ0X3k6IGludCwgZW5kX3g6IGludCwgZW5kX3k6IGludCwgCiAgICAgICAgICAgICBkdXJhdGlvbjogaW50ID0gNTAwKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgdOG7qyDEkWnhu4NtIChzdGFydF94LCBzdGFydF95KSDEkeG6v24gxJFp4buDbSAoZW5kX3gsIGVuZF95KQogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgInN0YXJ0X3giOiBzdGFydF94LAogICAgICAgICAgICAic3RhcnRfeSI6IHN0YXJ0X3ksCiAgICAgICAgICAgICJlbmRfeCI6IGVuZF94LAogICAgICAgICAgICAiZW5kX3kiOiBlbmRfeSwKICAgICAgICAgICAgImR1cmF0aW9uIjogZHVyYXRpb24KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGUiLCBwYXJhbXM9cGFyYW1zKQogICAgCiAgICBkZWYgc3dpcGVfYmV0d2Vlbl9lbGVtZW50cyhzZWxmLCBzdGFydF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZF9lbGVtZW50OiBEaWN0W3N0ciwgQW55XSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBpbnQgPSA1MDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCB04burIHBo4bqnbiB04butIHN0YXJ0X2VsZW1lbnQgxJHhur9uIHBo4bqnbiB04butIGVuZF9lbGVtZW50CiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfeCwgc3RhcnRfeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKHN0YXJ0X2VsZW1lbnQpCiAgICAgICAgZW5kX3gsIGVuZF95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZW5kX2VsZW1lbnQpCiAgICAgICAgcmV0dXJuIHNlbGYuc3dpcGUoc3RhcnRfeCwgc3RhcnRfeSwgZW5kX3gsIGVuZF95LCBkdXJhdGlvbikKICAgIAogICAgZGVmIHdhaXRfZm9yX2VsZW1lbnRfdG9fZGlzYXBwZWFyKHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCB0aW1lb3V0OiBpbnQgPSAzMCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIENo4budIMSR4bujaSBjaG8gxJHhur9uIGtoaSBt4buZdCBwaOG6p24gdOG7rSBiaeG6v24gbeG6pXQga2jhu49pIG3DoG4gaMOsbmgKICAgICAgICAiIiIKICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCB0aW1lb3V0OgogICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5maW5kX2VsZW1lbnQodGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZCkKICAgICAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB3YWl0X2Zvcl9hbnlfZWxlbWVudChzZWxmLCBlbGVtZW50c190b19maW5kOiBMaXN0W0RpY3Rbc3RyLCBzdHJdXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IGludCA9IDMwLCBjaGVja19pbnRlcnZhbDogaW50ID0gMSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIENo4budIMSR4bujaSBjaG8gxJHhur9uIGtoaSBi4bqldCBr4buzIHBo4bqnbiB04butIG7DoG8gdHJvbmcgZGFuaCBzw6FjaCB4deG6pXQgaGnhu4duCiAgICAgICAgCiAgICAgICAgZWxlbWVudHNfdG9fZmluZCBsw6AgZGFuaCBzw6FjaCBjw6FjIGRpY3QgduG7m2kgY8OhYyBraMOzYTogdGV4dCwgY29udGVudF9kZXNjLCByZXNvdXJjZV9pZAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6CiAgICAgICAgICAgIGZvciBlbGVtZW50X2NyaXRlcmlhIGluIGVsZW1lbnRzX3RvX2ZpbmQ6CiAgICAgICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5maW5kX2VsZW1lbnQoCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9jcml0ZXJpYS5nZXQoInRleHQiKSwgCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9jcml0ZXJpYS5nZXQoImNvbnRlbnRfZGVzYyIpLCAKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2NyaXRlcmlhLmdldCgicmVzb3VyY2VfaWQiKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIGdldF9zY3JlZW5fc2l6ZShzZWxmKSAtPiBUdXBsZVtpbnQsIGludF06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkga8OtY2ggdGjGsOG7m2MgbcOgbiBow6xuaCAod2lkdGgsIGhlaWdodCkKICAgICAgICAiIiIKICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICBpZiBkZXZpY2VfaW5mb1sic3RhdHVzIl0gPT0gInN1Y2Nlc3MiIGFuZCAic2NyZWVuX3NpemUiIGluIGRldmljZV9pbmZvWyJkYXRhIl06CiAgICAgICAgICAgIHNpemUgPSBkZXZpY2VfaW5mb1siZGF0YSJdWyJzY3JlZW5fc2l6ZSJdCiAgICAgICAgICAgIHJldHVybiAoc2l6ZVsid2lkdGgiXSwgc2l6ZVsiaGVpZ2h0Il0pCiAgICAgICAgcmV0dXJuICgwLCAwKQogICAgCiAgICBkZWYgdGFrZV9zY3JlZW5zaG90KHNlbGYsIGZpbGVfcGF0aDogc3RyID0gTm9uZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu6VwIOG6o25oIG3DoG4gaMOsbmggdsOgIGzGsHUgdsOgbyBmaWxlX3BhdGggKG7hur91IMSRxrDhu6NjIGN1bmcgY+G6pXApCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0ge30KICAgICAgICBpZiBmaWxlX3BhdGg6CiAgICAgICAgICAgIHBhcmFtc1siZmlsZV9wYXRoIl0gPSBmaWxlX3BhdGgKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzY3JlZW5zaG90IiwgcGFyYW1zPXBhcmFtcykKICAgIAogICAgZGVmIGdldF9jdXJyZW50X2FjdGl2aXR5KHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0w6puIGFjdGl2aXR5IGhp4buHbiB04bqhaQogICAgICAgICIiIgogICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgIGlmIGRldmljZV9pbmZvWyJzdGF0dXMiXSA9PSAic3VjY2VzcyIgYW5kICJjdXJyZW50X2FjdGl2aXR5IiBpbiBkZXZpY2VfaW5mb1siZGF0YSJdOgogICAgICAgICAgICByZXR1cm4gZGV2aWNlX2luZm9bImRhdGEiXVsiY3VycmVudF9hY3Rpdml0eSJdCiAgICAgICAgcmV0dXJuICIiCiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9wYWNrYWdlKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSB0w6puIHBhY2thZ2UgaGnhu4duIHThuqFpCiAgICAgICAgIiIiCiAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgaWYgZGV2aWNlX2luZm9bInN0YXR1cyJdID09ICJzdWNjZXNzIiBhbmQgImN1cnJlbnRfcGFja2FnZSIgaW4gZGV2aWNlX2luZm9bImRhdGEiXToKICAgICAgICAgICAgcmV0dXJuIGRldmljZV9pbmZvWyJkYXRhIl1bImN1cnJlbnRfcGFja2FnZSJdCiAgICAgICAgcmV0dXJuICIiCiAgICAKICAgIGRlZiBwcmVzc19iYWNrKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IEJhY2sKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19iYWNrIikKICAgIAogICAgZGVmIHByZXNzX2hvbWUoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgSG9tZQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInByZXNzX2hvbWUiKQogICAgCiAgICBkZWYgcHJlc3NfcmVjZW50X2FwcHMoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIG7DunQgUmVjZW50IEFwcHMKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19yZWNlbnRfYXBwcyIpCgogICAgZGVmIGlzX2FwcF9pbnN0YWxsZWQoc2VsZiwgcGFja2FnZV9uYW1lOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIMSRw6MgxJHGsOG7o2MgY8OgaSDEkeG6t3QgdHLDqm4gdGhp4bq/dCBi4buLIGNoxrBhCiAgICAgICAgxq91IHRpw6puIHPhu60gZOG7pW5nIEFEQiBu4bq/dSDEkcOjIGvhur90IG7hu5FpCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGFja2FnZV9uYW1lOiBUw6puIHBhY2thZ2UgY+G7p2Eg4bupbmcgZOG7pW5nIGPhuqduIGtp4buDbSB0cmEKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDhu6luZyBk4bulbmcgxJHDoyBjw6BpIMSR4bq3dCwgRmFsc2UgbuG6v3UgY2jGsGEKICAgICAgICAiIiIKICAgICAgICAjIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEg4bupbmcgZOG7pW5nIGLhurFuZyBBREIKICAgICAgICAgICAgICAgIGNtZCA9IFsiYWRiIl0gKyBkZXZpY2VfcGFyYW1zICsgWyJzaGVsbCIsIGYicG0gbGlzdCBwYWNrYWdlcyB8IGdyZXAgLXggcGFja2FnZTp7cGFja2FnZV9uYW1lfSJdCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIGvhur90IHF14bqjLCDhu6luZyBk4bulbmcgxJHDoyDEkcaw4bujYyBjw6BpIMSR4bq3dAogICAgICAgICAgICAgICAgcmV0dXJuIHBhY2thZ2VfbmFtZSBpbiByZXN1bHQuc3Rkb3V0CiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvcjoKICAgICAgICAgICAgICAgICMgTuG6v3UgbOG7l2kgQURCLCBz4butIGThu6VuZyBBUEkgSFRUUAogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgSFRUUCBBUEkKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiYXBwLWluc3RhbGxlZCIsIHsicGFja2FnZSI6IHBhY2thZ2VfbmFtZX0pCiAgICAgICAgaWYgcmVzcG9uc2VbInN0YXR1cyJdID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJkYXRhIl0uZ2V0KCJpbnN0YWxsZWQiLCBGYWxzZSkKICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgIGRlZiBmaW5kX2VsZW1lbnRzKHNlbGYsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsIHRleHQ6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCByZXNvdXJjZV9pZDogc3RyID0gTm9uZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgcGjhuqduIHThu60gdGhlbyBjbGFzc19uYW1lLCB0ZXh0LCBjb250ZW50X2Rlc2MgaG/hurdjIHJlc291cmNlX2lkCiAgICAgICAgxJDDonkgbMOgIG3hu5l0IHBoxrDGoW5nIHRo4bupYyB0aeG7h24gbOG7o2kga+G6v3QgaOG7o3AgZHVtcF9zY3JlZW5feG1sIHbDoCBmaW5kX2FsbF9lbGVtZW50c19pbl94bWwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgcGjhuqduIHThu60gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICAjIEzhuqV5IFhNTCBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgaWYgbm90IHNjcmVlbl94bWw6CiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIGZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCDEkeG7gyB0w6xtIGPDoWMgcGjhuqduIHThu60KICAgICAgICByZXR1cm4gc2VsZi5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgIHNjcmVlbl94bWwsIAogICAgICAgICAgICB0ZXh0PXRleHQsIAogICAgICAgICAgICBjb250ZW50X2Rlc2M9Y29udGVudF9kZXNjLCAKICAgICAgICAgICAgcmVzb3VyY2VfaWQ9cmVzb3VyY2VfaWQsCiAgICAgICAgICAgIGNsYXNzX25hbWU9Y2xhc3NfbmFtZQogICAgICAgICkKCiAgICBkZWYgb3Blbl91cmwoc2VsZiwgdXJsOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3hu58gbeG7mXQgVVJMIHRyw6puIHRoaeG6v3QgYuG7iy4gSOG7r3Ugw61jaCDEkeG7gyBt4bufIGPDoWMgbGluayBt4bqhbmcgeMOjIGjhu5lpIHRy4buxYyB0aeG6v3AuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdXJsOiBVUkwgY+G6p24gbeG7nyAodsOtIGThu6U6IGh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vdXNlcm5hbWUvKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJvcGVuX3VybCIsIHBhcmFtcz17InVybCI6IHVybH0pCgojIFbDrSBk4bulIHPhu60gZOG7pW5nCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBoZWxwZXIgPSBIZWxwZXJTZXJ2aWNlKCkKICAgIAogICAgIyBM4bqleSBrw61jaCB0aMaw4bubYyBtw6BuIGjDrG5oCiAgICB3aWR0aCwgaGVpZ2h0ID0gaGVscGVyLmdldF9zY3JlZW5fc2l6ZSgpCiAgICBwcmludChmIkvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmg6IHt3aWR0aH14e2hlaWdodH0iKQogICAgCiAgICAjIE3hu58gVGlrVG9rCiAgICBoZWxwZXIub3Blbl9hcHAoImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbCIpCiAgICAKICAgICMgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG7DunQgIlRyYW5nIGNo4bunIiBob+G6t2MgbsO6dCAiS2jDoW0gcGjDoSIgeHXhuqV0IGhp4buHbgogICAgZWxlbWVudHNfdG9fZmluZCA9IFsKICAgICAgICB7ImNvbnRlbnRfZGVzYyI6ICJUcmFuZyBjaOG7pyJ9LAogICAgICAgIHsiY29udGVudF9kZXNjIjogIktow6FtIHBow6EifQogICAgXQogICAgCiAgICBlbGVtZW50ID0gaGVscGVyLndhaXRfZm9yX2FueV9lbGVtZW50KGVsZW1lbnRzX3RvX2ZpbmQpCiAgICAKICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgcHJpbnQoZiLEkMOjIHTDrG0gdGjhuqV5IHBo4bqnbiB04butOiB7aGVscGVyLmdldF9lbGVtZW50X2NvbnRlbnRfZGVzYyhlbGVtZW50KX0iKQogICAgICAgIGhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIktow7RuZyB0w6xtIHRo4bqleSBwaOG6p24gdOG7rSBuw6BvIHNhdSB0aOG7nWkgZ2lhbiBjaOG7nSIpIA==').decode('utf-8'))
