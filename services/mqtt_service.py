import base64
exec(base64.b64decode('aW1wb3J0IHBhaG8ubXF0dC5jbGllbnQgYXMgbXF0dAppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCB1dWlkCmltcG9ydCBvcwpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBMaXN0LCBPcHRpb25hbCwgQ2FsbGFibGUsIFVuaW9uCmltcG9ydCBjb25maWcKaW1wb3J0IHV0aWxzCmltcG9ydCBzb2NrZXQKaW1wb3J0IHJhbmRvbQppbXBvcnQgc3VicHJvY2VzcwoKIyBMb2dnZXIKbG9nZ2VyID0gdXRpbHMuZ2V0X2xvZ2dlcigiTVFUVFNlcnZpY2UiKQoKY2xhc3MgTVFUVFNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGJfc2VydmljZSwgZGV2aWNlX2lkLCBoZWxwZXJfc2VydmljZT1Ob25lLCBqb2Jfc2VydmljZT1Ob25lKToKICAgICAgICAjIEto4bufaSB04bqhbyBjw6FjIHNlcnZpY2UKICAgICAgICBzZWxmLmRiID0gZGJfc2VydmljZQogICAgICAgIHNlbGYuaGVscGVyX3NlcnZpY2UgPSBoZWxwZXJfc2VydmljZQogICAgICAgIHNlbGYuam9iX3NlcnZpY2UgPSBqb2Jfc2VydmljZSAgIyBUaMOqbSByZWZlcmVuY2UgxJHhur9uIEpvYlNlcnZpY2UKICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIE1RVFQKICAgICAgICBzZWxmLmNsaWVudF9pZCA9IGYie2NvbmZpZy5NUVRUX0NMSUVOVF9JRF9QUkVGSVh9X3tyYW5kb20ucmFuZGludCgxLCA5OSl9X3tkZXZpY2VfaWR9IgogICAgICAgIHNlbGYuYnJva2VyX3VybCA9IGNvbmZpZy5NUVRUX1NFUlZFUlNbY29uZmlnLk1PREVdCiAgICAgICAgc2VsZi5icm9rZXJfYWRkcmVzcyA9IHNlbGYuYnJva2VyX3VybC5yZXBsYWNlKCJtcXR0Oi8vIiwgIiIpLnNwbGl0KCI6IilbMF0KICAgICAgICBzZWxmLmJyb2tlcl9wb3J0ID0gaW50KHNlbGYuYnJva2VyX3VybC5zcGxpdCgiOiIpWy0xXSkgaWYgIjoiIGluIHNlbGYuYnJva2VyX3VybCBlbHNlIDE4ODMKICAgICAgICBzZWxmLnVzZXJuYW1lID0gY29uZmlnLk1RVFRfVVNFUk5BTUUKICAgICAgICBzZWxmLnBhc3N3b3JkID0gY29uZmlnLk1RVFRfUEFTU1dPUkQKICAgICAgICAKICAgICAgICAjIFRy4bqhbmcgdGjDoWkga+G6v3QgbuG7kWkKICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5jbGllbnQgPSBOb25lCiAgICAgICAgc2VsZi5kZXZpY2VfaWQgPSBkZXZpY2VfaWQKICAgICAgICAKICAgICAgICAjIFJlY29ubmVjdGlvbiBsb2dpYwogICAgICAgIHNlbGYucmVjb25uZWN0X2RlbGF5ID0gMSAgIyBC4bqvdCDEkeG6p3UgduG7m2kgMSBnacOieQogICAgICAgIHNlbGYubWF4X3JlY29ubmVjdF9kZWxheSA9IDYwICAjIFThu5FpIMSRYSA2MCBnacOieQogICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ID0gMAogICAgICAgIHNlbGYubGFzdF9kaXNjb25uZWN0X3RpbWUgPSAwCiAgICAgICAgc2VsZi5tYW51YWxfZGlzY29ubmVjdCA9IEZhbHNlICAjIEZsYWcgxJHhu4MgcGjDom4gYmnhu4d0IGRpc2Nvbm5lY3QgY8OzIGNo4bunIMO9IHbDoCBraMO0bmcgY2jhu6cgw70KICAgICAgICAKICAgICAgICAjIFRvcGljcwogICAgICAgIHNlbGYudG9waWNfY2xpZW50X3N5bmMgPSBjb25maWcuTVFUVF9UT1BJQ19DTElFTlRfU1lOQwogICAgICAgIHNlbGYudG9waWNfc2VydmVyX3Rhc2sgPSBmIntjb25maWcuTVFUVF9UT1BJQ19TRVJWRVJfVEFTS19QUkVGSVh9L3tzZWxmLmRldmljZV9pZH0iCiAgICAgICAgCiAgICAgICAgIyBRdeG6o24gbMO9IHRhc2sgdsOgIHN5bmMKICAgICAgICBzZWxmLnRhc2tfaGFuZGxlcnMgPSB7fQogICAgICAgIHNlbGYuc3luY190aHJlYWQgPSBOb25lCiAgICAgICAgc2VsZi5zeW5jX2ludGVydmFsID0gY29uZmlnLlNZTkNfSU5URVJWQUwKICAgICAgICBzZWxmLnN5bmNfcnVubmluZyA9IEZhbHNlCiAgICAKICAgIGRlZiBzZXRfam9iX3NlcnZpY2Uoc2VsZiwgam9iX3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIMSQ4bq3dCBKb2JTZXJ2aWNlIMSR4buDIHjhu60gbMO9IGPDoWMgdGjDtG5nIGLDoW8gY29uZmlnIHVwZGF0ZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl9zZXJ2aWNlOiBJbnN0YW5jZSBj4bunYSBKb2JTZXJ2aWNlCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5qb2Jfc2VydmljZSA9IGpvYl9zZXJ2aWNlCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgxJHhurd0IEpvYlNlcnZpY2UgY2hvIE1RVFRTZXJ2aWNlIikKICAgICAgICBzZWxmLnJ1bm5pbmcgPSBGYWxzZQogICAgICAgIHNlbGYuc3RvcF9ldmVudCA9IHRocmVhZGluZy5FdmVudCgpCiAgICAgICAgc2VsZi5zeW5jX2ludGVydmFsID0gc2VsZi5kYi5nZXRfZGV2aWNlX2NvbmZpZygic3luY19pbnRlcnZhbCIsIGNvbmZpZy5TWU5DX0lOVEVSVkFMKQogICAgICAgIAogICAgICAgICMgVGhlbyBkw7VpIFJBTSDEkeG7gyB04buxIMSR4buZbmcgcmVib290CiAgICAgICAgc2VsZi5yYW1fdXNhZ2VfaGlzdG9yeSA9IFtdICAjIEzGsHUgMyBs4bqnbiDEkW8gUkFNIGfhuqduIG5o4bqldAogICAgICAgIHNlbGYuaGlnaF9yYW1fdGhyZXNob2xkID0gODggICMgTmfGsOG7oW5nIFJBTSBjYW8gKCUpCiAgICAgICAgc2VsZi5jb25zZWN1dGl2ZV9oaWdoX3JhbV9saW1pdCA9IDMgICMgU+G7kSBs4bqnbiBsacOqbiB0aeG6v3AgUkFNIGNhbyB0csaw4bubYyBraGkgcmVib290CiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIG3DtGkgdHLGsOG7nW5nIFRlcm11eAogICAgICAgIHNlbGYuaXNfdGVybXV4ID0gJ1RFUk1VWF9WRVJTSU9OJyBpbiBvcy5lbnZpcm9uIG9yICcvZGF0YS9kYXRhL2NvbS50ZXJtdXgnIGluIG9zLmVudmlyb24uZ2V0KCdQQVRIJywgJycpCiAgICAgICAgaWYgc2VsZi5pc190ZXJtdXg6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkGFuZyBjaOG6oXkgdHJvbmcgbcO0aSB0csaw4budbmcgVGVybXV4IikKCiAgICBkZWYgX2NyZWF0ZV9jbGllbnQoc2VsZikgLT4gbXF0dC5DbGllbnQ6CiAgICAgICAgIiIiVOG6oW8gdsOgIGPhuqV1IGjDrG5oIE1RVFQgY2xpZW50IiIiCiAgICAgICAgY2xpZW50ID0gTm9uZQoKICAgICAgICAjIFRo4butIHThuqFvIHbhu5tpIEFQSSB2MgogICAgICAgIHRyeToKICAgICAgICAgICAgY2xpZW50ID0gbXF0dC5DbGllbnQoCiAgICAgICAgICAgICAgICBjbGllbnRfaWQ9c2VsZi5jbGllbnRfaWQsCiAgICAgICAgICAgICAgICBjbGVhbl9zZXNzaW9uPVRydWUsCiAgICAgICAgICAgICAgICBwcm90b2NvbD1tcXR0Lk1RVFR2MzExLAogICAgICAgICAgICAgICAgY2FsbGJhY2tfYXBpX3ZlcnNpb249Z2V0YXR0cihtcXR0LkNhbGxiYWNrQVBJVmVyc2lvbiwgJ1ZFUlNJT04yJywgTm9uZSkKICAgICAgICAgICAgKQogICAgICAgICAgICBsb2dnZXIuaW5mbygiVOG6oW8gTVFUVCBjbGllbnQgduG7m2kgQVBJIHYyIikKICAgICAgICBleGNlcHQgKEF0dHJpYnV0ZUVycm9yLCBUeXBlRXJyb3IpOgogICAgICAgICAgICAjIEZhbGxiYWNrIEFQSSB2MQogICAgICAgICAgICBjbGllbnQgPSBtcXR0LkNsaWVudCgKICAgICAgICAgICAgICAgIGNsaWVudF9pZD1zZWxmLmNsaWVudF9pZCwKICAgICAgICAgICAgICAgIGNsZWFuX3Nlc3Npb249VHJ1ZSwKICAgICAgICAgICAgICAgIHByb3RvY29sPW1xdHQuTVFUVHYzMTEKICAgICAgICAgICAgKQogICAgICAgICAgICBsb2dnZXIuaW5mbygiVOG6oW8gTVFUVCBjbGllbnQgduG7m2kgQVBJIHYxIikKICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIHjDoWMgdGjhu7FjIG7hur91IGPDswogICAgICAgIGlmIHNlbGYudXNlcm5hbWUgYW5kIHNlbGYucGFzc3dvcmQ6CiAgICAgICAgICAgIGNsaWVudC51c2VybmFtZV9wd19zZXQoc2VsZi51c2VybmFtZSwgc2VsZi5wYXNzd29yZCkKICAgICAgICAKICAgICAgICAjIMSQxINuZyBrw70gY2FsbGJhY2sKICAgICAgICBjbGllbnQub25fY29ubmVjdCA9IHNlbGYuX29uX2Nvbm5lY3QKICAgICAgICBjbGllbnQub25fbWVzc2FnZSA9IHNlbGYuX29uX21lc3NhZ2UKICAgICAgICBjbGllbnQub25fZGlzY29ubmVjdCA9IHNlbGYuX29uX2Rpc2Nvbm5lY3QKICAgICAgICAKICAgICAgICAjIEPhuqV1IGjDrG5oIGtlZXAtYWxpdmUgZMOgaSBoxqFuIHbDoCByZWNvbm5lY3Rpb24KICAgICAgICBjbGllbnQucmVjb25uZWN0X2RlbGF5X3NldChtaW5fZGVsYXk9MSwgbWF4X2RlbGF5PTYwKQogICAgICAgIAogICAgICAgIHJldHVybiBjbGllbnQKCiAgICBkZWYgY29ubmVjdChzZWxmKSAtPiBib29sOgogICAgICAgICIiIkvhur90IG7hu5FpIMSR4bq/biBNUVRUIGJyb2tlciB24bubaSBleHBvbmVudGlhbCBiYWNrb2ZmIiIiCiAgICAgICAgZGVmIGNhbl9jb25uZWN0KGhvc3Q6IHN0ciwgcG9ydDogaW50LCB0aW1lb3V0OiBmbG9hdCA9IDMuMCkgLT4gYm9vbDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgd2l0aCBzb2NrZXQuY3JlYXRlX2Nvbm5lY3Rpb24oKGhvc3QsIHBvcnQpLCB0aW1lb3V0PXRpbWVvdXQpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgbWFpbl9ob3N0ID0gc2VsZi5icm9rZXJfYWRkcmVzcwogICAgICAgIG1haW5fcG9ydCA9IHNlbGYuYnJva2VyX3BvcnQKICAgICAgICBmYWxsYmFja19ob3N0ID0gIjEwLjAuMC41IgogICAgICAgIGZhbGxiYWNrX2hvc3QyID0gIjEwLjEuMC41IgogICAgICAgIGZhbGxiYWNrX3BvcnQgPSA5MDIwCgogICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBu4buRaSBzb2NrZXQgdOG7m2kgY+G6oyAyIElQCiAgICAgICAgbWFpbl9vayA9IGNhbl9jb25uZWN0KG1haW5faG9zdCwgbWFpbl9wb3J0KQogICAgICAgIGZhbGxiYWNrX29rID0gY2FuX2Nvbm5lY3QoZmFsbGJhY2tfaG9zdCwgZmFsbGJhY2tfcG9ydCkKICAgICAgICBmYWxsYmFjazJfb2sgPSBjYW5fY29ubmVjdChmYWxsYmFja19ob3N0MiwgZmFsbGJhY2tfcG9ydCkKICAgICAgICBpZiBtYWluX29rOgogICAgICAgICAgICBjb25uZWN0X2hvc3QgPSBtYWluX2hvc3QKICAgICAgICAgICAgY29ubmVjdF9wb3J0ID0gbWFpbl9wb3J0CiAgICAgICAgZWxpZiBmYWxsYmFja19vazoKICAgICAgICAgICAgY29ubmVjdF9ob3N0ID0gZmFsbGJhY2tfaG9zdAogICAgICAgICAgICBjb25uZWN0X3BvcnQgPSBmYWxsYmFja19wb3J0CiAgICAgICAgZWxpZiBmYWxsYmFja19ob3N0MjoKICAgICAgICAgICAgY29ubmVjdF9ob3N0ID0gZmFsbGJhY2tfaG9zdDIKICAgICAgICAgICAgY29ubmVjdF9wb3J0ID0gZmFsbGJhY2tfcG9ydAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyBr4bq/dCBu4buRaSDEkcaw4bujYyBzb2NrZXQgdOG7m2kgY+G6oyB7bWFpbl9ob3N0fTp7bWFpbl9wb3J0fSBs4bqrbiB7ZmFsbGJhY2tfaG9zdH06e2ZhbGxiYWNrX3BvcnR9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBU4bqhbyBjbGllbnQgbeG7m2kgbuG6v3UgY2jGsGEgY8OzIGhv4bq3YyBjbGllbnQgY8WpIGLhu4sgbOG7l2kKICAgICAgICAgICAgaWYgc2VsZi5jbGllbnQgaXMgTm9uZToKICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50ID0gc2VsZi5fY3JlYXRlX2NsaWVudCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IHRy4bqhbmcgdGjDoWkKICAgICAgICAgICAgc2VsZi5zdG9wX2V2ZW50LmNsZWFyKCkKICAgICAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgICAgICBzZWxmLm1hbnVhbF9kaXNjb25uZWN0ID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJBhbmcga+G6v3QgbuG7kWkgdOG7m2kgTVFUVCBicm9rZXIge2Nvbm5lY3RfaG9zdH06e2Nvbm5lY3RfcG9ydH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBT4butIGThu6VuZyBrZWVwYWxpdmUgbOG7m24gaMahbiAoMTIwIGdpw6J5IHRoYXkgdsOsIDYwKQogICAgICAgICAgICBzZWxmLmNsaWVudC5jb25uZWN0X2FzeW5jKGNvbm5lY3RfaG9zdCwgY29ubmVjdF9wb3J0LCBrZWVwYWxpdmU9MTIwKQogICAgICAgICAgICBzZWxmLmNsaWVudC5sb29wX3N0YXJ0KCkKCiAgICAgICAgICAgIGRlZiBfd2FpdF9jb25uZWN0ZWQodGltZW91dF9zZWM6IGludCA9IDE1KSAtPiBib29sOgogICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UodGltZW91dF9zZWMpOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgaWYgX3dhaXRfY29ubmVjdGVkKCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6Mga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nIMSR4bq/biBNUVRUIGJyb2tlciB7Y29ubmVjdF9ob3N0fTp7Y29ubmVjdF9wb3J0fSIpCiAgICAgICAgICAgICAgICBzZWxmLmJyb2tlcl9hZGRyZXNzID0gY29ubmVjdF9ob3N0CiAgICAgICAgICAgICAgICBzZWxmLmJyb2tlcl9wb3J0ID0gY29ubmVjdF9wb3J0CiAgICAgICAgICAgICAgICAjIFJlc2V0IHJlY29ubmVjdCBkZWxheSBraGkga+G6v3QgbuG7kWkgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICBzZWxmLnJlY29ubmVjdF9kZWxheSA9IDEKICAgICAgICAgICAgICAgIHNlbGYucmVjb25uZWN0X2NvdW50ID0gMAogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkvhur90IG7hu5FpIE1RVFQgdGjhuqV0IGLhuqFpIHThu5tpIHtjb25uZWN0X2hvc3R9Ontjb25uZWN0X3BvcnR9IikKICAgICAgICAgICAgICAgIHNlbGYuX2NsZWFudXBfY2xpZW50KCkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGvhur90IG7hu5FpIE1RVFQ6IHtzdHIoZSl9IikKICAgICAgICAgICAgc2VsZi5fY2xlYW51cF9jbGllbnQoKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2NsZWFudXBfY2xpZW50KHNlbGYpOgogICAgICAgICIiIkThu41uIGThurlwIE1RVFQgY2xpZW50IiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBzZWxmLmNsaWVudDoKICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50Lmxvb3Bfc3RvcCgpCiAgICAgICAgICAgICAgICBzZWxmLmNsaWVudC5kaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50ID0gTm9uZQogICAgICAgICAgICBzZWxmLmlzX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBk4buNbiBk4bq5cCBNUVRUIGNsaWVudDoge2V9IikKCiAgICBkZWYgZW5zdXJlX2Nvbm5lY3RlZChzZWxmKSAtPiBib29sOgogICAgICAgICIiIsSQ4bqjbSBi4bqjbyBr4bq/dCBu4buRaSBNUVRUIHRyxrDhu5tjIGtoaSB0aOG7sWMgaGnhu4duIGPDoWMgdGhhbyB0w6FjIHbhu5tpIHJhdGUgbGltaXRpbmciIiIKICAgICAgICBpZiBzZWxmLmlzX2Nvbm5lY3RlZDoKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBjw7MgxJFhbmcgdHJvbmcgcXXDoSB0csOsbmggcmVjb25uZWN0IGtow7RuZwogICAgICAgIGN1cnJlbnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgaWYgY3VycmVudF90aW1lIC0gc2VsZi5sYXN0X2Rpc2Nvbm5lY3RfdGltZSA8IDU6ICAjIENo4budIMOtdCBuaOG6pXQgNSBnacOieSB04burIGzhuqduIGRpc2Nvbm5lY3QgY3Xhu5FpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygixJBhbmcgdHJvbmcgdGjhu51pIGdpYW4gY29vbGRvd24gcmVjb25uZWN0LCBjaOG7nS4uLiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBsb2dnZXIud2FybmluZygiTVFUVCBjaMawYSBr4bq/dCBu4buRaSwgxJFhbmcgdGjhu60ga+G6v3QgbuG7kWkgbOG6oWkuLi4iKQogICAgICAgIHJldHVybiBzZWxmLmNvbm5lY3QoKQoKICAgIGRlZiBfb25fY29ubmVjdChzZWxmLCBjbGllbnQsIHVzZXJkYXRhLCBmbGFncywgcmMsIHByb3BlcnRpZXM9Tm9uZSk6CiAgICAgICAgIiIiQ2FsbGJhY2sga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZyIiIgogICAgICAgIGlmIHJjID09IDA6CiAgICAgICAgICAgIHNlbGYuaXNfY29ubmVjdGVkID0gVHJ1ZQogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcgdOG7m2kgTVFUVCBicm9rZXIiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMSDbmcga8O9IG5o4bqtbiB0YXNrCiAgICAgICAgICAgIHNlbGYuY2xpZW50LnN1YnNjcmliZShzZWxmLnRvcGljX3NlcnZlcl90YXNrLCBxb3M9MSkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIMSRxINuZyBrw70gbmjhuq1uIHRhc2sgdOG6oWk6IHtzZWxmLnRvcGljX3NlcnZlcl90YXNrfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpCiAgICAgICAgICAgIHNlbGYuc2VuZF9jb25uZWN0X25vdGlmaWNhdGlvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IHJlY29ubmVjdCBjb3VudGVyIGtoaSBr4bq/dCBu4buRaSB0aMOgbmggY8O0bmcKICAgICAgICAgICAgc2VsZi5yZWNvbm5lY3RfY291bnQgPSAwCiAgICAgICAgICAgIHNlbGYucmVjb25uZWN0X2RlbGF5ID0gMQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkvhur90IG7hu5FpIE1RVFQgdGjhuqV0IGLhuqFpIHbhu5tpIG3DoyBs4buXaToge3JjfSIpCiAgICAgICAgICAgICMgVMSDbmcgcmVjb25uZWN0IGNvdW50IGtoaSBr4bq/dCBu4buRaSB0aOG6pXQgYuG6oWkKICAgICAgICAgICAgc2VsZi5yZWNvbm5lY3RfY291bnQgKz0gMQoKICAgIGRlZiBfb25fZGlzY29ubmVjdChzZWxmLCBjbGllbnQsIHVzZXJkYXRhLCByYywgcHJvcGVydGllcz1Ob25lLCByZWFzb25fY29kZT1Ob25lLCAqKmt3YXJncyk6CiAgICAgICAgIiIiQ2FsbGJhY2sga2hpIG5n4bqvdCBr4bq/dCBu4buRaSB24bubaSBjxqEgY2jhur8gcmVjb25uZWN0IHRow7RuZyBtaW5oIiIiCiAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHNlbGYubGFzdF9kaXNjb25uZWN0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIAogICAgICAgIGlmIHNlbGYubWFudWFsX2Rpc2Nvbm5lY3Q6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIG5n4bqvdCBr4bq/dCBu4buRaSBNUVRUIHRoZW8gecOqdSBj4bqndSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBpZiByYyAhPSAwOgogICAgICAgICAgICBzZWxmLnJlY29ubmVjdF9jb3VudCArPSAxCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTmfhuq90IGvhur90IG7hu5FpIE1RVFQga2jDtG5nIG1vbmcgbXXhu5FuIGzhuqduIHtzZWxmLnJlY29ubmVjdF9jb3VudH0gduG7m2kgbcOjIGzhu5dpOiB7cmN9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2jhu4kgYXV0by1yZWNvbm5lY3QgbuG6v3Uga2jDtG5nIHBo4bqjaSBtYW51YWwgZGlzY29ubmVjdAogICAgICAgICAgICBpZiBub3Qgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpOgogICAgICAgICAgICAgICAgc2VsZi5fc2NoZWR1bGVfcmVjb25uZWN0KCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuaW5mbygixJDDoyBuZ+G6r3Qga+G6v3QgbuG7kWkgTVFUVCIpCgogICAgZGVmIF9zY2hlZHVsZV9yZWNvbm5lY3Qoc2VsZik6CiAgICAgICAgIiIiTMOqbiBs4buLY2gga+G6v3QgbuG7kWkgbOG6oWkgduG7m2kgZXhwb25lbnRpYWwgYmFja29mZiIiIgogICAgICAgICMgVMOtbmggZGVsYXkgduG7m2kgZXhwb25lbnRpYWwgYmFja29mZgogICAgICAgIGRlbGF5ID0gbWluKHNlbGYucmVjb25uZWN0X2RlbGF5ICogKDIgKiogbWluKHNlbGYucmVjb25uZWN0X2NvdW50IC0gMSwgNikpLCBzZWxmLm1heF9yZWNvbm5lY3RfZGVsYXkpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiJT4bq9IHRo4butIGvhur90IG7hu5FpIGzhuqFpIHNhdSB7ZGVsYXl9IGdpw6J5Li4uIikKICAgICAgICAKICAgICAgICBkZWYgcmVjb25uZWN0X2FmdGVyX2RlbGF5KCk6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnN0b3BfZXZlbnQud2FpdChkZWxheSk6ICAjIENo4budIGRlbGF5IHNlY29uZHMsIHRy4burIGtoaSBi4buLIHN0b3AKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmlzX2Nvbm5lY3RlZCBhbmQgbm90IHNlbGYubWFudWFsX2Rpc2Nvbm5lY3Q6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUaOG7rSBr4bq/dCBu4buRaSBs4bqhaSBNUVRUIChs4bqnbiB7c2VsZi5yZWNvbm5lY3RfY291bnR9KSIpCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5jb25uZWN0KCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJL4bq/dCBu4buRaSBs4bqhaSBNUVRUIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB24bqrbiB0aOG6pXQgYuG6oWksIGzDqm4gbOG7i2NoIHRo4butIGzhuqFpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYucmVjb25uZWN0X2NvdW50IDwgMTA6ICAjIEdp4bubaSBo4bqhbiBz4buRIGzhuqduIHRo4butCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zY2hlZHVsZV9yZWNvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCLEkMOjIHRo4butIGvhur90IG7hu5FpIGzhuqFpIE1RVFQgcXXDoSBuaGnhu4F1IGzhuqduLCB04bqhbSBk4burbmcgYXV0by1yZWNvbm5lY3QiKQogICAgICAgIAogICAgICAgICMgQ2jhuqF5IHRyb25nIHRocmVhZCByacOqbmcgxJHhu4Mga2jDtG5nIGJsb2NrCiAgICAgICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9cmVjb25uZWN0X2FmdGVyX2RlbGF5LCBkYWVtb249VHJ1ZSkuc3RhcnQoKQoKICAgIGRlZiBfc2FmZV9wdWJsaXNoKHNlbGYsIHRvcGljOiBzdHIsIHBheWxvYWQ6IHN0ciwgcW9zOiBpbnQgPSAxKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEfhu61pIG1lc3NhZ2UgYW4gdG/DoG4gduG7m2kga2nhu4NtIHRyYSBr4bq/dCBu4buRaSB0csaw4bubYyBraGkgcHVibGlzaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRvcGljOiBNUVRUIHRvcGljCiAgICAgICAgICAgIHBheWxvYWQ6IE7hu5lpIGR1bmcgbWVzc2FnZSAoc3RyaW5nKQogICAgICAgICAgICBxb3M6IFF1YWxpdHkgb2YgU2VydmljZSAoMCwgMSwgaG/hurdjIDIpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgZ+G7rWkgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9jb25uZWN0ZWQoKToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBn4butaSBtZXNzYWdlIMSR4bq/biB7dG9waWN9OiBNUVRUIGNoxrBhIGvhur90IG7hu5FpIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi5jbGllbnQucHVibGlzaCh0b3BpYywgcGF5bG9hZCwgcW9zPXFvcykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5yYyA9PSBtcXR0Lk1RVFRfRVJSX1NVQ0NFU1M6CiAgICAgICAgICAgICAgICAjbG9nZ2VyLmluZm8oZiLEkMOjIGfhu61pIG1lc3NhZ2UgdGjDoG5oIGPDtG5nIMSR4bq/biB7dG9waWN9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7rWkgbWVzc2FnZSDEkeG6v24ge3RvcGljfToge21xdHQuZXJyb3Jfc3RyaW5nKHJlc3VsdC5yYyl9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4butaSBtZXNzYWdlIMSR4bq/biB7dG9waWN9OiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBzZW5kX3Rhc2tfcmVwb3J0KHNlbGYsIHRhc2tfaWQ6IHN0ciwgZGV2aWNlX2lkOiBzdHIsIHN0YXR1czogc3RyLCBjbGllbnRfbWVzc2FnZTogc3RyID0gIiIpOgogICAgICAgICIiIkfhu61pIGLDoW8gY8OhbyBr4bq/dCBxdeG6oyB0aOG7sWMgaGnhu4duIHRhc2siIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlcG9ydF9kYXRhID0gewogICAgICAgICAgICAgICAgInRhc2tfaWQiOiB0YXNrX2lkLAogICAgICAgICAgICAgICAgImRldmljZV9pZCI6IGRldmljZV9pZCwKICAgICAgICAgICAgICAgICJzdGF0dXMiOiBzdGF0dXMsCiAgICAgICAgICAgICAgICAiY2xpZW50X21lc3NhZ2UiOiBjbGllbnRfbWVzc2FnZSwKICAgICAgICAgICAgICAgICJ0aW1lc3RhbXAiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIHNlbGYuX3NhZmVfcHVibGlzaCgiZG5kdmluYS9jbGllbnQvdGFza19yZXBvcnQiLCBqc29uLmR1bXBzKHJlcG9ydF9kYXRhKSk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgZ+G7rWkgYsOhbyBjw6FvIHRhc2sge3Rhc2tfaWR9IHbhu5tpIHRy4bqhbmcgdGjDoWkge3N0YXR1c30iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIGLDoW8gY8OhbyB0YXNrOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBzZW5kX2Nvbm5lY3Rfbm90aWZpY2F0aW9uKHNlbGYpOgogICAgICAgICIiIkfhu61pIHRow7RuZyBiw6FvIGvhur90IG7hu5FpIMSR4bq/biBzZXJ2ZXIiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbm5lY3RfZGF0YSA9IHsKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiBzZWxmLmRldmljZV9pZCwKICAgICAgICAgICAgICAgICJ0aW1lc3RhbXAiOiBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIHNlbGYuX3NhZmVfcHVibGlzaCgiZG5kdmluYS9jbGllbnQvY29ubmVjdCIsIGpzb24uZHVtcHMoY29ubmVjdF9kYXRhKSk6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgZ+G7rWkgdGjDtG5nIGLDoW8ga+G6v3QgbuG7kWkgY2hvIHRoaeG6v3QgYuG7iyB7c2VsZi5kZXZpY2VfaWR9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBn4butaSB0aMO0bmcgYsOhbyBr4bq/dCBu4buRaToge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgcmVnaXN0ZXJfdGFza19oYW5kbGVyKHNlbGYsIHRhc2tfdHlwZTogc3RyLCBoYW5kbGVyOiBDYWxsYWJsZSk6CiAgICAgICAgIiIiCiAgICAgICAgxJDEg25nIGvDvSBoYW5kbGVyIGNobyBsb+G6oWkgdGFzawogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfdHlwZTogTG/huqFpIHRhc2sKICAgICAgICAgICAgaGFuZGxlcjogSMOgbSB44butIGzDvSB0YXNrCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi50YXNrX2hhbmRsZXJzW3Rhc2tfdHlwZV0gPSBoYW5kbGVyCiAgICAKICAgIGRlZiBfcmVhZF9yZWNlbnRfbG9ncyhzZWxmLCBudW1fbGluZXM9MTAwKToKICAgICAgICAiIiIKICAgICAgICDEkOG7jWMgY8OhYyBkw7JuZyBsb2cgZ+G6p24gbmjhuqV0IHThu6sgZmlsZSBhcHAubG9nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbnVtX2xpbmVzOiBT4buRIGTDsm5nIGxvZyBj4bqnbiDEkeG7jWMgKG3hurdjIMSR4buLbmggMTAwKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W3N0cl06IERhbmggc8OhY2ggY8OhYyBkw7JuZyBsb2cgZ+G6p24gbmjhuqV0IGhv4bq3YyB0aMO0bmcgYsOhbyBs4buXaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgbG9nX2ZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihjb25maWcuQkFTRV9ESVIsICJhcHAubG9nIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZV9wYXRoKToKICAgICAgICAgICAgICAgICMgRmlsZSBjaMawYSDEkcaw4bujYyB04bqhbyBi4bufaSBsb2dnaW5nIHN5c3RlbQogICAgICAgICAgICAgICAgcmV0dXJuIFtmIltJTkZPXSBGaWxlIGxvZyBjaMawYSDEkcaw4bujYyB04bqhbywgY2jGsGEgY8OzIGxvZyBuw6BvIl0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIMSR4buNYyBmaWxlIHbhu5tpIHJldHJ5IMSR4buDIHRyw6FuaCB4dW5nIMSR4buZdAogICAgICAgICAgICBtYXhfcmV0cmllcyA9IDMKICAgICAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UobWF4X3JldHJpZXMpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihsb2dfZmlsZV9wYXRoLCAncicsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0naWdub3JlJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgbGluZXMgPSBmLnJlYWRsaW5lcygpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTOG6pXkgbnVtX2xpbmVzIGTDsm5nIGN14buRaSBjw7luZwogICAgICAgICAgICAgICAgICAgIHJlY2VudF9saW5lcyA9IGxpbmVzWy1udW1fbGluZXM6XSBpZiBsZW4obGluZXMpID4gbnVtX2xpbmVzIGVsc2UgbGluZXMKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIExv4bqhaSBi4buPIGvDvSB04buxIHh14buRbmcgZMOybmcgdsOgIGPDoWMga2hv4bqjbmcgdHLhuq9uZyB0aOG7q2EKICAgICAgICAgICAgICAgICAgICByZWNlbnRfbG9ncyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gcmVjZW50X2xpbmVzIGlmIGxpbmUuc3RyaXAoKV0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkMOjIMSR4buNYyB7bGVuKHJlY2VudF9sb2dzKX0gZMOybmcgbG9nIGfhuqduIG5o4bqldCIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY2VudF9sb2dzCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBleGNlcHQgKFBlcm1pc3Npb25FcnJvciwgSU9FcnJvciwgT1NFcnJvcikgYXMgZmlsZV9lcnJvcjoKICAgICAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X3JldHJpZXMgLSAxOgogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuMSkgICMgQ2jhu50gMTAwbXMgcuG7k2kgdGjhu60gbOG6oWkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2YiW0VSUk9SXSBLaMO0bmcgdGjhu4MgxJHhu41jIGZpbGUgbG9nOiB7c3RyKGZpbGVfZXJyb3IpfSJdCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIFtmIltFUlJPUl0gTOG7l2kgxJHhu41jIGZpbGUgbG9nOiB7c3RyKGUpfSJdCgogICAgZGVmIHN5bmNfZGF0YShzZWxmKToKICAgICAgICAiIiLEkOG7k25nIGLhu5kgZOG7ryBsaeG7h3UgduG7m2kgc2VydmVyIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIE7hur91IGNoxrBhIGvhur90IG7hu5FpIE1RVFQsIGtow7RuZyB0aOG7gyDEkeG7k25nIGLhu5kKICAgICAgICAgICAgaWYgbm90IHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkNoxrBhIGvhur90IG7hu5FpIE1RVFQsIGtow7RuZyB0aOG7gyDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBoZWxwZXIgc2VydmljZQogICAgICAgICAgICBoZWxwZXIgPSBzZWxmLmhlbHBlcl9zZXJ2aWNlCiAgICAgICAgICAgIGlmIG5vdCBoZWxwZXI6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyBjw7MgaGVscGVyIHNlcnZpY2UsIGtow7RuZyB0aOG7gyDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBkZXZpY2VfaWQKICAgICAgICAgICAgZGV2aWNlX2lkID0gc2VsZi5kYi5nZXRfb3JfY3JlYXRlX2RldmljZV9pZCgpCiAgICAgICAgICAgIGlmIG5vdCBkZXZpY2VfaWQ6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB4w6FjIMSR4buLbmggZGV2aWNlX2lkLCBraMO0bmcgdGjhu4MgxJHhu5NuZyBi4buZIGThu68gbGnhu4d1IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgdGjDtG5nIHRpbiB0aGnhur90IGLhu4sKICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBOb25lCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRldmljZV9pbmZvX3Jlc3BvbnNlID0gaGVscGVyLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgbOG6pXkgdGjDoG5oIGPDtG5nLCBsxrB1IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgICAgIGlmIGRldmljZV9pbmZvX3Jlc3BvbnNlWyJzdGF0dXMiXSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiBkZXZpY2VfaW5mb19yZXNwb25zZToKICAgICAgICAgICAgICAgICAgICAjIEzGsHUgdGjDtG5nIHRpbiB0aGnhur90IGLhu4sgdsOgbyBkYXRhYmFzZQogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuc2F2ZV9kZXZpY2VfaW5mbyhkZXZpY2VfaW5mb19yZXNwb25zZVsiZGF0YSJdKQogICAgICAgICAgICAgICAgICAgIGRldmljZV9pbmZvID0gZGV2aWNlX2luZm9fcmVzcG9uc2VbImRhdGEiXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVGhlbyBkw7VpIFJBTSDEkeG7gyB04buxIMSR4buZbmcgcmVib290CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbW9uaXRvcl9yYW1fdXNhZ2UoZGV2aWNlX2luZm8pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBs4bqleSB0aMO0bmcgdGluIHRoaeG6v3QgYuG7izoge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGtow7RuZyBs4bqleSDEkcaw4bujYyB0aMO0bmcgdGluIHRoaeG6v3QgYuG7iywgc+G7rSBk4bulbmcgdGjDtG5nIHRpbiDEkcOjIGzGsHUgdHJvbmcgZGF0YWJhc2UKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmRiLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIktow7RuZyBjw7MgdGjDtG5nIHRpbiB0aGnhur90IGLhu4ssIMSR4buTbmcgYuG7mSBk4buvIGxp4buHdSBjw7MgdGjhu4Mga2jDtG5nIMSR4bqneSDEkeG7pyIpCiAgICAgICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sKICAgICAgICAgICAgZGV2aWNlX2NvbmZpZyA9IHNlbGYuZGIuZ2V0X2FsbF9kZXZpY2VfY29uZmlnKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7mXAgY8OhYyB0cuG6oW5nIHRow6FpIHJ1bnRpbWUgKHBhdXNlX2pvYiwgZGV2aWNlX2lzX3dvcmtpbmcsIGRldmljZV9tZXNzYWdlKSB2w6BvIGRldmljZV9pbmZvCiAgICAgICAgICAgIGZvciBydW50aW1lX2tleSBpbiBbInBhdXNlX2pvYiIsICJkZXZpY2VfaXNfd29ya2luZyIsICJkZXZpY2VfbWVzc2FnZSJdOgogICAgICAgICAgICAgICAgaWYgcnVudGltZV9rZXkgaW4gZGV2aWNlX2NvbmZpZzoKICAgICAgICAgICAgICAgICAgICBkZXZpY2VfaW5mb1tydW50aW1lX2tleV0gPSBkZXZpY2VfY29uZmlnLnBvcChydW50aW1lX2tleSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBHacOhIHRy4buLIG3hurdjIMSR4buLbmggbuG6v3UgY2jGsGEgY+G6pXUgaMOsbmgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VfaW5mb1tydW50aW1lX2tleV0gPSBGYWxzZSBpZiBydW50aW1lX2tleSAhPSAiZGV2aWNlX21lc3NhZ2UiIGVsc2UgIiIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTG/huqFpIGLhu48gZ29saWtlX3JlcG9ydCBraOG7j2kgZGV2aWNlX2NvbmZpZyDEkeG7gyBn4butaSByacOqbmcKICAgICAgICAgICAgZ29saWtlX3JlcG9ydCA9IE5vbmUKICAgICAgICAgICAgaWYgImdvbGlrZV9yZXBvcnQiIGluIGRldmljZV9jb25maWc6CiAgICAgICAgICAgICAgICBnb2xpa2VfcmVwb3J0ID0gZGV2aWNlX2NvbmZpZy5wb3AoImdvbGlrZV9yZXBvcnQiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyBnb2xpa2VfYXBpX2Jhc2Uga2jhu49pIGRldmljZV9jb25maWcKICAgICAgICAgICAgaWYgImdvbGlrZV9hcGlfYmFzZSIgaW4gZGV2aWNlX2NvbmZpZzoKICAgICAgICAgICAgICAgIGRldmljZV9jb25maWcucG9wKCJnb2xpa2VfYXBpX2Jhc2UiKQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCLEkMOjIGxv4bqhaSBi4buPIGdvbGlrZV9hcGlfYmFzZSBraOG7j2kgZOG7ryBsaeG7h3UgxJHhu5NuZyBi4buZIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGPDoWMgdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mQogICAgICAgICAgICBwZW5kaW5nX2FjY291bnRzID0gc2VsZi5kYi5nZXRfcGVuZGluZ19zeW5jX2l0ZW1zKCJhY2NvdW50cyIsIGxpbWl0PTUwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBjw6FjIGpvYiBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgcGVuZGluZ19qb2JzID0gc2VsZi5kYi5nZXRfcGVuZGluZ19zeW5jX2l0ZW1zKCJqb2JzX2hpc3RvcnkiLCBsaW1pdD01MCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhu41jIDEwMCBkw7JuZyBsb2cgZ+G6p24gbmjhuqV0CiAgICAgICAgICAgIHJlY2VudF9sb2dzID0gc2VsZi5fcmVhZF9yZWNlbnRfbG9ncygxMDApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBwYXlsb2FkCiAgICAgICAgICAgIHBheWxvYWQgPSB7CiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgImRldmljZV9pbmZvIjogZGV2aWNlX2luZm8sCiAgICAgICAgICAgICAgICAiZGV2aWNlX2NvbmZpZyI6IGRldmljZV9jb25maWcsCiAgICAgICAgICAgICAgICAibWV0YV9kYXRhIjogewogICAgICAgICAgICAgICAgICAgICJkZXZpY2VfbG9ncyI6IHJlY2VudF9sb2dzCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBnb2xpa2VfcmVwb3J0IG7hur91IGPDswogICAgICAgICAgICBpZiBnb2xpa2VfcmVwb3J0OgogICAgICAgICAgICAgICAgcGF5bG9hZFsiZ29saWtlX3JlcG9ydCJdID0gZ29saWtlX3JlcG9ydAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mSBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgcGVuZGluZ19hY2NvdW50czoKICAgICAgICAgICAgICAgIHBheWxvYWRbImFjY291bnRzIl0gPSBwZW5kaW5nX2FjY291bnRzCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkOG7k25nIGLhu5kge2xlbihwZW5kaW5nX2FjY291bnRzKX0gdMOgaSBraG/huqNuIGNoxrBhIMSR4buTbmcgYuG7mSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUaMOqbSBqb2IgY2jGsGEgxJHhu5NuZyBi4buZIG7hur91IGPDswogICAgICAgICAgICBpZiBwZW5kaW5nX2pvYnM6CiAgICAgICAgICAgICAgICBwYXlsb2FkWyJqb2JzIl0gPSBwZW5kaW5nX2pvYnMKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIsSQ4buTbmcgYuG7mSB7bGVuKHBlbmRpbmdfam9icyl9IGpvYiBjaMawYSDEkeG7k25nIGLhu5kiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7rWkgZOG7ryBsaeG7h3UKICAgICAgICAgICAgc2VsZi5fc2FmZV9wdWJsaXNoKGNvbmZpZy5NUVRUX1RPUElDX0NMSUVOVF9TWU5DLCBqc29uLmR1bXBzKHBheWxvYWQpKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMb2cgdGjDtG5nIHRpbiB24buBIHPhu5EgZMOybmcgbG9nIMSRw6MgZ+G7rWkKICAgICAgICAgICAgaWYgcmVjZW50X2xvZ3M6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLEkMOjIGfhu61pIHtsZW4ocmVjZW50X2xvZ3MpfSBkw7JuZyBsb2cgZ+G6p24gbmjhuqV0IGzDqm4gc2VydmVyIikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgxJHhu5NuZyBi4buZIGThu68gbGnhu4d1IHbhu5tpIHNlcnZlciIpCiAgICAKICAgIGRlZiBzdGFydF9zeW5jX3RocmVhZChzZWxmKToKICAgICAgICAiIiJC4bqvdCDEkeG6p3UgdGhyZWFkIMSR4buTbmcgYuG7mSB04buxIMSR4buZbmciIiIKICAgICAgICBpZiBzZWxmLnN5bmNfdGhyZWFkIGlzIG5vdCBOb25lIGFuZCBzZWxmLnN5bmNfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJUaHJlYWQgxJHhu5NuZyBi4buZIMSRw6MgxJFhbmcgY2jhuqF5IikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgIHNlbGYucnVubmluZyA9IFRydWUKICAgICAgICBzZWxmLnN0b3BfZXZlbnQuY2xlYXIoKQogICAgICAgIHNlbGYuc3luY190aHJlYWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1zZWxmLl9zeW5jX2xvb3AsIGRhZW1vbj1UcnVlKQogICAgICAgIHNlbGYuc3luY190aHJlYWQuc3RhcnQoKQogICAgICAgIGxvZ2dlci5pbmZvKCLEkMOjIGto4bufaSDEkeG7mW5nIHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIikKICAgIAogICAgZGVmIF9zeW5jX2xvb3Aoc2VsZik6CiAgICAgICAgIiIiTG9vcCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oZiJC4bqvdCDEkeG6p3UgxJHhu5NuZyBi4buZIHThu7EgxJHhu5luZyBt4buXaSB7c2VsZi5zeW5jX2ludGVydmFsfSBnacOieSIpCgogICAgICAgIHdoaWxlIG5vdCBzZWxmLnN0b3BfZXZlbnQuaXNfc2V0KCkgYW5kIHNlbGYucnVubmluZzoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19jb25uZWN0ZWQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zeW5jX2RhdGEoKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB0cm9uZyBxdcOhIHRyw6xuaCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBOZ2jhu4kgxJHhur9uIGzhuqduIMSR4buTbmcgYuG7mSB0aeG6v3AgdGhlbwogICAgICAgICAgICBmb3IgXyBpbiByYW5nZShzZWxmLnN5bmNfaW50ZXJ2YWwpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5zdG9wX2V2ZW50LmlzX3NldCgpIG9yIG5vdCBzZWxmLnJ1bm5pbmc6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgIAogICAgZGVmIHN0b3Bfc3luY190aHJlYWQoc2VsZik6CiAgICAgICAgIiIiROG7q25nIHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIiIiCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBzZWxmLnN0b3BfZXZlbnQuc2V0KCkKICAgICAgICBpZiBzZWxmLnN5bmNfdGhyZWFkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLnN5bmNfdGhyZWFkLmpvaW4odGltZW91dD0yLjApCiAgICAgICAgICAgIHNlbGYuc3luY190aHJlYWQgPSBOb25lCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgZOG7q25nIHRocmVhZCDEkeG7k25nIGLhu5kgdOG7sSDEkeG7mW5nIikKICAgIAogICAgZGVmIGRpc2Nvbm5lY3Qoc2VsZik6CiAgICAgICAgIiIiTmfhuq90IGvhur90IG7hu5FpIE1RVFQiIiIKICAgICAgICBzZWxmLm1hbnVhbF9kaXNjb25uZWN0ID0gVHJ1ZSAgIyDEkMOhbmggZOG6pXUgxJHDonkgbMOgIGRpc2Nvbm5lY3QgY8OzIGNo4bunIMO9CiAgICAgICAgc2VsZi5zdG9wX3N5bmNfdGhyZWFkKCkKICAgICAgICAKICAgICAgICBpZiBzZWxmLmNsaWVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5jbGllbnQubG9vcF9zdG9wKCkKICAgICAgICAgICAgc2VsZi5jbGllbnQuZGlzY29ubmVjdCgpCiAgICAgICAgICAgIHNlbGYuaXNfY29ubmVjdGVkID0gRmFsc2UKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mgbmfhuq90IGvhur90IG7hu5FpIE1RVFQiKQogICAgICAgIAogICAgICAgICMgROG7q25nIHThuqV0IGPhuqMgYXV0by1yZWNvbm5lY3QKICAgICAgICBzZWxmLnN0b3BfZXZlbnQuc2V0KCkKICAgIAogICAgZGVmIHNldHVwX21xdHRfaGFuZGxlcnMoc2VsZik6CiAgICAgICAgIiIiVGhp4bq/dCBs4bqtcCBjw6FjIGhhbmRsZXIgY2hvIE1RVFQgdGFza3MiIiIKICAgICAgICAjIMSQxINuZyBrw70gY8OhYyB0YXNrIGhhbmRsZXIgbeG6t2MgxJHhu4tuaAogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJ1cGRhdGVfY29uZmlnIiwgc2VsZi5faGFuZGxlX3VwZGF0ZV9kZXZpY2VfY29uZmlnKQogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJ1cGRhdGVfc3luY2VkIiwgc2VsZi5faGFuZGxlX3VwZGF0ZV9zeW5jZWQpCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoImFjY291bnRfdXBkYXRlIiwgc2VsZi5faGFuZGxlX2FjY291bnRfdXBkYXRlKQogICAgICAgIHNlbGYucmVnaXN0ZXJfdGFza19oYW5kbGVyKCJ2ZXJpZnlfZ29saWtlIiwgc2VsZi5faGFuZGxlX3ZlcmlmeV9nb2xpa2UpCiAgICAgICAgc2VsZi5yZWdpc3Rlcl90YXNrX2hhbmRsZXIoInVwZGF0ZV9wcm94eSIsIHNlbGYuX2hhbmRsZV91cGRhdGVfcHJveHkpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgdGhp4bq/dCBs4bqtcCBjw6FjIE1RVFQgdGFzayBoYW5kbGVyIikKICAgICAgICAKICAgIGRlZiBfaGFuZGxlX3VwZGF0ZV9kZXZpY2VfY29uZmlnKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza19kYXRhOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXNrX2lkID0gdGFza19kYXRhLmdldCgidGFza19pZCIpCiAgICAgICAgICAgIGRldmljZV9pZCA9IHRhc2tfZGF0YS5nZXQoImRldmljZV9pZCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5o4bqtbiB5w6p1IGPhuqd1IGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICBjb25maWdfZGF0YSA9IHRhc2tfZGF0YS5nZXQoImNvbmZpZ19kYXRhIiwge30pCiAgICAgICAgICAgIGlmIG5vdCBjb25maWdfZGF0YToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJE4buvIGxp4buHdSBj4bqldSBow6xuaCB0aGnhur90IGLhu4sgcuG7l25nIikKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCAiROG7ryBsaeG7h3UgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLIHLhu5duZyIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSB04burbmcgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLmRiLnNhdmVfZGV2aWNlX2NvbmZpZyhjb25maWdfZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7izogeycsICcuam9pbihjb25maWdfZGF0YS5rZXlzKCkpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IHThuqV0IGPhuqMgdMOgaSBraG/huqNuIGzDoCBjaMawYSBzeW5jIMSR4buDIMSR4bqjbSBi4bqjbyB0aMO0bmcgdGluIG3hu5tpIG5o4bqldCDEkcaw4bujYyBn4butaSBsw6puIHNlcnZlcgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfYWNjb3VudHMgPSBzZWxmLmRiLm1hcmtfYWxsX2FjY291bnRzX25vdF9zeW5jZWQoKQogICAgICAgICAgICAgICAgICAgIGlmIHVwZGF0ZWRfYWNjb3VudHMgPiAwOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgxJHDoW5oIGThuqV1IHt1cGRhdGVkX2FjY291bnRzfSB0w6BpIGtob+G6o24gbMOgIGNoxrBhIHN5bmMgc2F1IGtoaSBj4bqtcCBuaOG6rXQgY+G6pXUgaMOsbmggdGhp4bq/dCBi4buLIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIktow7RuZyBjw7MgdMOgaSBraG/huqNuIG7DoG8gY+G6p24gxJHDoW5oIGThuqV1IGNoxrBhIHN5bmMiKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIMSRw6FuaCBk4bqldSB0w6BpIGtob+G6o24gY2jGsGEgc3luYzoge2V9IikKICAgICAgICAgICAgICAgICAgICAjIEtow7RuZyBmYWlsIHRhc2sgdsOsIHZp4buHYyBj4bqtcCBuaOG6rXQgY29uZmlnIMSRw6MgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHN5bmNfaW50ZXJ2YWwgbuG6v3UgbsOzIHRoYXkgxJHhu5VpCiAgICAgICAgICAgICAgICBpZiAic3luY19pbnRlcnZhbCIgaW4gY29uZmlnX2RhdGE6CiAgICAgICAgICAgICAgICAgICAgbmV3X3N5bmNfaW50ZXJ2YWwgPSBjb25maWdfZGF0YVsic3luY19pbnRlcnZhbCJdCiAgICAgICAgICAgICAgICAgICAgaWYgbmV3X3N5bmNfaW50ZXJ2YWwgIT0gc2VsZi5zeW5jX2ludGVydmFsOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIkPhuq1wIG5o4bqtdCBzeW5jX2ludGVydmFsIHThu6sge3NlbGYuc3luY19pbnRlcnZhbH0gdGjDoG5oIHtuZXdfc3luY19pbnRlcnZhbH0iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN5bmNfaW50ZXJ2YWwgPSBuZXdfc3luY19pbnRlcnZhbAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaOG7n2kgxJHhu5luZyBs4bqhaSB0aHJlYWQgxJHhu5NuZyBi4buZIG7hur91IMSRYW5nIGNo4bqheQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnN5bmNfdGhyZWFkIGlzIG5vdCBOb25lIGFuZCBzZWxmLnN5bmNfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiS2jhu59pIMSR4buZbmcgbOG6oWkgdGhyZWFkIMSR4buTbmcgYuG7mSB24bubaSBraG/huqNuZyB0aOG7nWkgZ2lhbiBt4bubaSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN0b3Bfc3luY190aHJlYWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zdGFydF9zeW5jX3RocmVhZCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGjDtG5nIGLDoW8gY2hvIEpvYlNlcnZpY2UgduG7gSB04bqldCBj4bqjIGNvbmZpZyB1cGRhdGUKICAgICAgICAgICAgICAgIGlmIHNlbGYuam9iX3NlcnZpY2UgYW5kIGhhc2F0dHIoc2VsZi5qb2Jfc2VydmljZSwgJ2hhbmRsZV9tcXR0X2NvbmZpZ191cGRhdGUnKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiVGjDtG5nIGLDoW8gSm9iU2VydmljZSB24buBIGNvbmZpZyB1cGRhdGUiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuam9iX3NlcnZpY2UuaGFuZGxlX21xdHRfY29uZmlnX3VwZGF0ZShjb25maWdfZGF0YSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBMb2cgdGjDqm0gdGjDtG5nIHRpbiB24buBIGpvYi1yZWxhdGVkIGNvbmZpZ3MKICAgICAgICAgICAgICAgIGpvYl9yZWxhdGVkX2tleXMgPSBbIm1heF9qb2JzX3Blcl9kYXkiLCAibWF4X2pvYnNfcGVyX3Nlc3Npb24iLCAiam9iX2ludGVydmFsX3NlY29uZHMiLCAiY2FyZV9pbl93b3JraW5nX2pvYiJdCiAgICAgICAgICAgICAgICBpZiBhbnkoa2V5IGluIGNvbmZpZ19kYXRhIGZvciBrZXkgaW4gam9iX3JlbGF0ZWRfa2V5cyk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkPhuqV1IGjDrG5oIGxpw6puIHF1YW4gxJHhur9uIEpvYlNlcnZpY2UgxJHDoyDEkcaw4bujYyBj4bqtcCBuaOG6rXQiKQogICAgICAgICAgICAgICAgICAgICMgSm9iU2VydmljZSBz4bq9IHjhu60gbMO9IGxvZ2ljIHJlc3RhcnQgc2Vzc2lvbiBu4bq/dSBj4bqnbiB0aGnhur90CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgR+G7rWkgYsOhbyBjw6FvIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBmIsSQw6MgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7izogeycsICcuam9pbihjb25maWdfZGF0YS5rZXlzKCkpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9ICJLaMO0bmcgdGjhu4MgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7iyIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTOG7l2kgeOG7rSBsw70gY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHRoaeG6v3QgYuG7izoge3N0cihlKX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKCiAgICBkZWYgX2hhbmRsZV91cGRhdGVfc3luY2VkKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkeG7k25nIGLhu5kKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0YXNrX2RhdGE6IEThu68gbGnhu4d1IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiTmjhuq1uIHnDqnUgY+G6p3UgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZIHThu6sgc2VydmVyIikKICAgICAgICAgICAgZGF0YSA9IHRhc2tfZGF0YS5nZXQoImRhdGEiLCB7fSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGFjY291bnRfY291bnQgPSAwCiAgICAgICAgICAgIGpvYl9jb3VudCA9IDAKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDDoW5oIGThuqV1IHTDoGkga2hv4bqjbiDEkcOjIMSR4buTbmcgYuG7mQogICAgICAgICAgICBpZiAiYWNjb3VudHMiIGluIGRhdGEgYW5kIGlzaW5zdGFuY2UoZGF0YVsiYWNjb3VudHMiXSwgbGlzdCk6CiAgICAgICAgICAgICAgICBmb3IgYWNjb3VudF91dWlkIGluIGRhdGFbImFjY291bnRzIl06CiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5tYXJrX2FzX3N5bmNlZCgiYWNjb3VudHMiLCBhY2NvdW50X3V1aWQpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYixJDDoW5oIGThuqV1IHTDoGkga2hv4bqjbiDEkcOjIMSR4buTbmcgYuG7mToge2FjY291bnRfdXVpZH0iKQogICAgICAgICAgICAgICAgYWNjb3VudF9jb3VudCA9IGxlbihkYXRhWyJhY2NvdW50cyJdKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgam9iIMSRw6MgxJHhu5NuZyBi4buZCiAgICAgICAgICAgIGlmICJqb2JzIiBpbiBkYXRhIGFuZCBpc2luc3RhbmNlKGRhdGFbImpvYnMiXSwgbGlzdCk6CiAgICAgICAgICAgICAgICBmb3Igam9iX3V1aWQgaW4gZGF0YVsiam9icyJdOgogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIubWFya19hc19zeW5jZWQoImpvYnNfaGlzdG9yeSIsIGpvYl91dWlkKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIsSQw6FuaCBk4bqldSBqb2IgxJHDoyDEkeG7k25nIGLhu5k6IHtqb2JfdXVpZH0iKQogICAgICAgICAgICAgICAgam9iX2NvdW50ID0gbGVuKGRhdGFbImpvYnMiXSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIHThu5VuZyBo4bujcCBob+G6t2MgdGjDtG5nIGLDoW8gdOG7qyBzZXJ2ZXIKICAgICAgICAgICAgaWYgIm1lc3NhZ2UiIGluIHRhc2tfZGF0YToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVGjDtG5nIGLDoW8gdOG7qyBzZXJ2ZXI6IHt0YXNrX2RhdGFbJ21lc3NhZ2UnXX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBIaeG7g24gdGjhu4sgdGjDtG5nIGLDoW8gdOG7lW5nIGjhu6NwIG7hur91IGtow7RuZyBjw7MgbWVzc2FnZSB04burIHNlcnZlcgogICAgICAgICAgICAgICAgaWYgYWNjb3VudF9jb3VudCA+IDAgb3Igam9iX2NvdW50ID4gMDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgxJHhu5NuZyBi4buZIHRow6BuaCBjw7RuZzoge2FjY291bnRfY291bnR9IHTDoGkga2hv4bqjbiwge2pvYl9jb3VudH0gam9iIikKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kgeOG7rSBsw70gY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHhu5NuZyBi4buZOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIAogICAgCiAgICBkZWYgX2hhbmRsZV9hY2NvdW50X3VwZGF0ZShzZWxmLCB0YXNrX2RhdGEpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgY+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza19kYXRhOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyIGPDsyBj4bqldSB0csO6YzoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInRhc2tfaWQiOiAidGFza18xNzQ5Mzk5NTM2MjcyXzY0MSIsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogImExMjVmNjI0ZjQxYTRmN2MiLAogICAgICAgICAgICAgICAgInRhc2tfdHlwZSI6ICJhY2NvdW50X3VwZGF0ZSIsCiAgICAgICAgICAgICAgICAiZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAiYXBwIjogImluc3RhZ3JhbSIsCiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJpbmFjdGl2ZSIsCiAgICAgICAgICAgICAgICAgICAgImpvYl9tYXhfZGF5IjogMTA4LAogICAgICAgICAgICAgICAgICAgICJqb2JfdG9kYXkiOiAzMCwKICAgICAgICAgICAgICAgICAgICAiam9iX2VuYWJsZSI6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgImFjY291bnRfdXVpZCI6ICI3ZWQ5NTU3ZC03NmE0LTQ3ZjctODg1MC03Y2VlZjBjNjkwYWYiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiAiIiwKICAgICAgICAgICAgICAgICJzdGF0dXMiOiAicGVuZGluZyIKICAgICAgICAgICAgfQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gecOqdSBj4bqndSBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHThu6sgc2VydmVyICh0YXNrX2lkOiB7dGFza19pZH0pIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBkYXRhIG9yICJhY2NvdW50X3V1aWQiIG5vdCBpbiBkYXRhOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkThu68gbGnhu4d1IHTDoGkga2hv4bqjbiBraMO0bmcgaOG7o3AgbOG7hyIpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgIkThu68gbGnhu4d1IHTDoGkga2hv4bqjbiBraMO0bmcgaOG7o3AgbOG7hyIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHTDoGkga2hv4bqjbiB04burIERCCiAgICAgICAgICAgIGFjY291bnQgPSBzZWxmLmRiLmdldF9hY2NvdW50X2J5X3V1aWQoZGF0YVsiYWNjb3VudF91dWlkIl0pCiAgICAgICAgICAgIGlmIG5vdCBhY2NvdW50OgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIHbhu5tpIFVVSUQ6IHtkYXRhWydhY2NvdW50X3V1aWQnXX0iCiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7fQogICAgICAgICAgICB2YWxpZF9maWVsZHMgPSBbInN0YXR1cyIsICJqb2JfbWF4X2RheSIsICJtYXhfam9ic19wZXJfc2Vzc2lvbiIsICJqb2JfZW5hYmxlIiwgImpvYl9kaXNhYmxlX3VudGlsIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgImRpc2FibGVfZm9sbG93IiwgImZvbGxvd19kaXNhYmxlX3VudGlsIiwgImZvbGxvd190b2RheSIsICJmb2xsb3dfaW5fc2Vzc2lvbiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJtYXhfZm9sbG93X2RheSIsICJtYXhfZm9sbG93X3Nlc3Npb24iLCAiaW5hY3RpdmVfZm9sbG93X3JlYXNvbiJdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgbuG6v3Ugc3RhdHVzID0gImRlbGV0ZSIgdGjDrCB4w7NhIHTDoGkga2hv4bqjbgogICAgICAgICAgICBpZiBkYXRhLmdldCgic3RhdHVzIikgPT0gImRlbGV0ZSI6CiAgICAgICAgICAgICAgICBhY2NvdW50X3V1aWQgPSBkYXRhWyJhY2NvdW50X3V1aWQiXQogICAgICAgICAgICAgICAgYWNjb3VudF91c2VybmFtZSA9IGFjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiLCAiVW5rbm93biIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTmjhuq1uIHnDqnUgY+G6p3UgeMOzYSB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IChVVUlEOiB7YWNjb3VudF91dWlkfSkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIDEuIFjDs2EgdOG6pXQgY+G6oyBqb2IgaGlzdG9yeSBj4bunYSB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIGpvYl9oaXN0b3J5X2RlbGV0ZWQgPSBzZWxmLmRiLmRlbGV0ZV9qb2JfaGlzdG9yeV9ieV9hY2NvdW50KGFjY291bnRfdXVpZCkKICAgICAgICAgICAgICAgIGlmIGpvYl9oaXN0b3J5X2RlbGV0ZWQ6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIHjDs2Egam9iIGhpc3RvcnkgY+G7p2EgdMOgaSBraG/huqNuIHthY2NvdW50X3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHRo4buDIHjDs2Egam9iIGhpc3RvcnkgY+G7p2EgdMOgaSBraG/huqNuIHthY2NvdW50X3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgMi4gWMOzYSB0w6BpIGtob+G6o24KICAgICAgICAgICAgICAgIGFjY291bnRfZGVsZXRlZCA9IHNlbGYuZGIuZGVsZXRlX2FjY291bnQoYWNjb3VudFsiaWQiXSkKICAgICAgICAgICAgICAgIGlmIGFjY291bnRfZGVsZXRlZDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIsSQw6MgeMOzYSB0w6BpIGtob+G6o24ge2FjY291bnRfdXNlcm5hbWV9IChJRDoge2FjY291bnRbJ2lkJ119KSBraOG7j2kgZGF0YWJhc2UiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJzdWNjZXNzIiwgZiLEkMOjIHjDs2EgdMOgaSBraG/huqNuIHthY2NvdW50X3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYiS2jDtG5nIHRo4buDIHjDs2EgdMOgaSBraG/huqNuIHthY2NvdW50X3VzZXJuYW1lfSIKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGRhdGEuaXRlbXMoKToKICAgICAgICAgICAgICAgIGlmIGtleSBpbiB2YWxpZF9maWVsZHM6CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGFba2V5XSA9IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCB1cGRhdGVfZGF0YToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJLaMO0bmcgY8OzIHRow7RuZyB0aW4gY+G6p24gY+G6rXAgbmjhuq10IikKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCAiS2jDtG5nIGPDsyB0aMO0bmcgdGluIGPhuqduIGPhuq1wIG5o4bqtdCIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IGzhuqFpIHbDoG8gREIKICAgICAgICAgICAgdXBkYXRlX2RhdGFbImlzX3N5bmMiXSA9IEZhbHNlCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLmRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRbImlkIl0sIHVwZGF0ZV9kYXRhKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJywgJycpfSAoVVVJRDoge2RhdGFbJ2FjY291bnRfdXVpZCddfSkgduG7m2kgZOG7ryBsaeG7h3U6IHt1cGRhdGVfZGF0YX0iKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBmIsSQw6MgY+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICcnKX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgdGjhu4MgY+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScsICcnKX0iCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSB44butIGzDvSBj4bqtcCBuaOG6rXQgdMOgaSBraG/huqNuOiB7c3RyKGUpfSIKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKCiAgICBkZWYgX2hhbmRsZV92ZXJpZnlfZ29saWtlKHNlbGYsIHRhc2tfZGF0YSk6CiAgICAgICAgIiIiCiAgICAgICAgWOG7rSBsw70gdGFzayB2ZXJpZnkgdMOgaSBraG/huqNuIGdvbGlrZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhc2tfZGF0YTogROG7ryBsaeG7h3UgdGFzayB04burIHNlcnZlciBjw7MgY+G6pXUgdHLDumM6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJ0YXNrX2lkIjogInRhc2tfMTc0OTM5OTUzNjI3Ml82NDEiLAogICAgICAgICAgICAgICAgImRldmljZV9pZCI6ICJhMTI1ZjYyNGY0MWE0ZjdjIiwKICAgICAgICAgICAgICAgICJ0YXNrX3R5cGUiOiAidmVyaWZ5X2dvbGlrZSIsCiAgICAgICAgICAgICAgICAiZGF0YSI6IHsKICAgICAgICAgICAgICAgICAgICAiYXBwIjogImluc3RhZ3JhbSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibWVzc2FnZSI6ICIiLAogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJwZW5kaW5nIgogICAgICAgICAgICB9CiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXNrX2lkID0gdGFza19kYXRhLmdldCgidGFza19pZCIpCiAgICAgICAgICAgIGRldmljZV9pZCA9IHRhc2tfZGF0YS5nZXQoImRldmljZV9pZCIpCiAgICAgICAgICAgIGRhdGEgPSB0YXNrX2RhdGEuZ2V0KCJkYXRhIiwge30pCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5o4bqtbiB5w6p1IGPhuqd1IHZlcmlmeSBnb2xpa2UgdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgYXBwX25hbWUgPSBkYXRhLmdldCgiYXBwIikKICAgICAgICAgICAgaWYgbm90IGFwcF9uYW1lOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gIlRoaeG6v3UgdGjDtG5nIHRpbiBhcHAgdHJvbmcgZOG7ryBsaeG7h3UgdGFzayIKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgSW1wb3J0IGdvbGlrZV9zZXJ2aWNlIGtoaSBj4bqnbiB0aGnhur90CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZyb20gc2VydmljZXMuZ29saWtlX3NlcnZpY2UgaW1wb3J0IEdvbGlrZVNlcnZpY2UKICAgICAgICAgICAgICAgIGdvbGlrZV9zZXJ2aWNlID0gR29saWtlU2VydmljZShzZWxmLmRiKQogICAgICAgICAgICBleGNlcHQgSW1wb3J0RXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYiS2jDtG5nIHRo4buDIGltcG9ydCBHb2xpa2VTZXJ2aWNlOiB7c3RyKGUpfSIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIGNoxrBhIGxpw6puIGvhur90IGdvbGlrZQogICAgICAgICAgICB1bmxpbmtlZF9hY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzX2J5X2FwcF9hbmRfZ29saWtlX3N0YXR1cyhhcHBfbmFtZSwgaXNfbGlua2VkPUZhbHNlKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHVubGlua2VkX2FjY291bnRzOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJLaMO0bmcgY8OzIHTDoGkga2hv4bqjbiB7YXBwX25hbWV9IG7DoG8gY2jGsGEgbGnDqm4ga+G6v3QgZ29saWtlIgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUw6xtIHRo4bqleSB7bGVuKHVubGlua2VkX2FjY291bnRzKX0gdMOgaSBraG/huqNuIHthcHBfbmFtZX0gY2jGsGEgbGnDqm4ga+G6v3QgZ29saWtlIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVmVyaWZ5IHThu6tuZyB0w6BpIGtob+G6o24KICAgICAgICAgICAgdmVyaWZpY2F0aW9uX3Jlc3VsdHMgPSBbXQogICAgICAgICAgICBzdWNjZXNzX2NvdW50ID0gMAogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gdW5saW5rZWRfYWNjb3VudHM6CiAgICAgICAgICAgICAgICB1bmlxdWVfdXNlcm5hbWUgPSBhY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIikKICAgICAgICAgICAgICAgIGlmIG5vdCB1bmlxdWVfdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJUw6BpIGtob+G6o24gSUQge2FjY291bnQuZ2V0KCdpZCcpfSBraMO0bmcgY8OzIHVuaXF1ZV91c2VybmFtZSIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgR+G7jWkgQVBJIHZlcmlmeSBhY2NvdW50IHF1YSBnb2xpa2Vfc2VydmljZQogICAgICAgICAgICAgICAgICAgIGVuZHBvaW50ID0gZiIve2FwcF9uYW1lfS1hY2NvdW50L3ZlcmlmeS1hY2NvdW50IgogICAgICAgICAgICAgICAgICAgIHZlcmlmeV9kYXRhID0geyJvYmplY3RfaWQiOiB1bmlxdWVfdXNlcm5hbWV9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBU4bqhbyBVUkwgxJHhuqd5IMSR4bunCiAgICAgICAgICAgICAgICAgICAgdXJsID0gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX17ZW5kcG9pbnR9IgogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGdvbGlrZV9zZXJ2aWNlLmFwaV9yZXF1ZXN0KHVybCwgbWV0aG9kPSJQT1NUIiwgcGF5bG9hZD12ZXJpZnlfZGF0YSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJzdWNjZXNzIikgYW5kIHJlc3VsdC5nZXQoInN0YXR1cyIpID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBWZXJpZnkgdGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSByZXN1bHQuZ2V0KCJtZXNzYWdlIiwgIlRow6BuaCBjw7RuZyEiKQogICAgICAgICAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25fcmVzdWx0cy5hcHBlbmQoZiJbVFJVRV1be3VuaXF1ZV91c2VybmFtZX1dOiB7bWVzc2FnZX0iKQogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgbGnDqm4ga+G6v3QgdHJvbmcgZGF0YWJhc2UKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXNfZ29saWtlX2xpbmtlZCI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZ29saWtlX3VzZXJfaWQiOiByZXN1bHQuZ2V0KCJkYXRhIiwge30pLmdldCgidXNlcl9pZCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJWZXJpZnkgdGjDoG5oIGPDtG5nIHTDoGkga2hv4bqjbiB7dW5pcXVlX3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICMgVmVyaWZ5IHRo4bqldCBi4bqhaQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tZXNzYWdlID0gcmVzdWx0LmdldCgibWVzc2FnZSIsICJM4buXaSBraMO0bmcgeMOhYyDEkeG7i25oIikKICAgICAgICAgICAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uX3Jlc3VsdHMuYXBwZW5kKGYiW0ZBTFNFXVt7dW5pcXVlX3VzZXJuYW1lfV06IHtlcnJvcl9tZXNzYWdlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiVmVyaWZ5IHRo4bqldCBi4bqhaSB0w6BpIGtob+G6o24ge3VuaXF1ZV91c2VybmFtZX06IHtlcnJvcl9tZXNzYWdlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGVycm9yX21lc3NhZ2UgPSBmIkzhu5dpIGtoaSB2ZXJpZnk6IHtzdHIoZSl9IgogICAgICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9yZXN1bHRzLmFwcGVuZChmIltGQUxTRV1be3VuaXF1ZV91c2VybmFtZX1dOiB7ZXJyb3JfbWVzc2FnZX0iKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB2ZXJpZnkgdMOgaSBraG/huqNuIHt1bmlxdWVfdXNlcm5hbWV9OiB7c3RyKGUpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIGLDoW8gY8OhbyBr4bq/dCBxdeG6owogICAgICAgICAgICByZXBvcnRfbWVzc2FnZSA9ICJcbiIuam9pbih2ZXJpZmljYXRpb25fcmVzdWx0cykKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7rWkgYsOhbyBjw6FvIHRhc2sKICAgICAgICAgICAgaWYgc3VjY2Vzc19jb3VudCA9PSBsZW4odW5saW5rZWRfYWNjb3VudHMpOgogICAgICAgICAgICAgICAgIyBU4bqldCBj4bqjIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiJWZXJpZnkgdGjDoG5oIGPDtG5nIHtzdWNjZXNzX2NvdW50fS97bGVuKHVubGlua2VkX2FjY291bnRzKX0gdMOgaSBraG/huqNuOlxue3JlcG9ydF9tZXNzYWdlfSIpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlZlcmlmeSBnb2xpa2UgaG/DoG4gdGjDoG5oOiB7c3VjY2Vzc19jb3VudH0ve2xlbih1bmxpbmtlZF9hY2NvdW50cyl9IHTDoGkga2hv4bqjbiB0aMOgbmggY8O0bmciKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBDw7MgbeG7mXQgc+G7kSB0aOG6pXQgYuG6oWkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiJWZXJpZnkgdGjDoG5oIGPDtG5nIHtzdWNjZXNzX2NvdW50fS97bGVuKHVubGlua2VkX2FjY291bnRzKX0gdMOgaSBraG/huqNuOlxue3JlcG9ydF9tZXNzYWdlfSIpCiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlZlcmlmeSBnb2xpa2UgaG/DoG4gdGjDoG5oIHbhu5tpIGzhu5dpOiB7c3VjY2Vzc19jb3VudH0ve2xlbih1bmxpbmtlZF9hY2NvdW50cyl9IHTDoGkga2hv4bqjbiB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIHjhu60gbMO9IHZlcmlmeSBnb2xpa2U6IHtzdHIoZSl9IgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQoKICAgIGRlZiBfaGFuZGxlX3VwZGF0ZV9wcm94eShzZWxmLCB0YXNrX2RhdGEpOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgY+G6rXAgbmjhuq10IGPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFza19kYXRhOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyIGPDsyBj4bqldSB0csO6YzoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInRhc2tfaWQiOiAidGFza18xNzQ5Mzk5NTM2MjcyXzY0MSIsCiAgICAgICAgICAgICAgICAiZGV2aWNlX2lkIjogImExMjVmNjI0ZjQxYTRmN2MiLAogICAgICAgICAgICAgICAgInRhc2tfdHlwZSI6ICJ1cGRhdGVfcHJveHkiLAogICAgICAgICAgICAgICAgImRhdGEiOiB7CiAgICAgICAgICAgICAgICAgICAgInByb3h5X2NvbmZpZyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImlkIjogInByb3h5XzQ1NiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJob3N0IjogInByb3h5LmV4YW1wbGUuY29tIiwKICAgICAgICAgICAgICAgICAgICAgICAgInBvcnQiOiA4MDgwLAogICAgICAgICAgICAgICAgICAgICAgICAidXNlcm5hbWUiOiAidXNlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICJwYXNzd29yZCI6ICJwYXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiaHR0cCIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiAiIiwKICAgICAgICAgICAgICAgICJzdGF0dXMiOiAicGVuZGluZyIKICAgICAgICAgICAgfQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgdGFza19pZCA9IHRhc2tfZGF0YS5nZXQoInRhc2tfaWQiKQogICAgICAgICAgICBkZXZpY2VfaWQgPSB0YXNrX2RhdGEuZ2V0KCJkZXZpY2VfaWQiKQogICAgICAgICAgICBkYXRhID0gdGFza19kYXRhLmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOaOG6rW4gecOqdSBj4bqndSBj4bqtcCBuaOG6rXQgcHJveHkgdOG7qyBzZXJ2ZXIgKHRhc2tfaWQ6IHt0YXNrX2lkfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJveHlfY29uZmlnID0gZGF0YQogICAgICAgICAgICBpZiBub3QgcHJveHlfY29uZmlnOgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gIlRoaeG6v3UgdGjDtG5nIHRpbiBwcm94eV9jb25maWcgdHJvbmcgZOG7ryBsaeG7h3UgdGFzayIKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF90YXNrX3JlcG9ydCh0YXNrX2lkLCBkZXZpY2VfaWQsICJmYWlsZWQiLCBlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSBj4bqldSBow6xuaCBwcm94eSB2w6BvIGRhdGFiYXNlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJwcm94eV9jb25maWciLCBwcm94eV9jb25maWcpCiAgICAgICAgICAgICAgICAjIFJlc2V0IHRy4bqhbmcgdGjDoWkgecOqdSBj4bqndSBwcm94eSB2w6wgxJHDoyBuaOG6rW4gxJHGsOG7o2MgcHJveHkKICAgICAgICAgICAgICAgIHNlbGYuZGIuc2V0KCJwcm94eV9yZXF1ZXN0ZWQiLCAwKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLEkMOjIGPhuq1wIG5o4bqtdCBj4bqldSBow6xuaCBwcm94eToge3Byb3h5X2NvbmZpZ1snbmFtZSddfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgR+G7rWkgYsOhbyBjw6FvIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgc3VjY2Vzc19tc2cgPSBmIsSQw6MgY+G6rXAgbmjhuq10IHByb3h5OiB7cHJveHlfY29uZmlnWyduYW1lJ119IgogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgInN1Y2Nlc3MiLCBzdWNjZXNzX21zZykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIGtoaSBsxrB1IGPhuqV1IGjDrG5oIHByb3h5OiB7c3RyKGUpfSIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfdGFza19yZXBvcnQodGFza19pZCwgZGV2aWNlX2lkLCAiZmFpbGVkIiwgZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkzhu5dpIHjhu60gbMO9IGPhuq1wIG5o4bqtdCBwcm94eToge3N0cihlKX0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrX2RhdGEuZ2V0KCJ0YXNrX2lkIikKICAgICAgICAgICAgZGV2aWNlX2lkID0gdGFza19kYXRhLmdldCgiZGV2aWNlX2lkIikKICAgICAgICAgICAgc2VsZi5zZW5kX3Rhc2tfcmVwb3J0KHRhc2tfaWQsIGRldmljZV9pZCwgImZhaWxlZCIsIGVycm9yX21zZykKCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBraOG7n2kgxJHhu5luZyB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUaGnhur90IGzhuq1wIGPDoWMgaGFuZGxlciB0csaw4bubYyBraGkga+G6v3QgbuG7kWkKICAgICAgICAgICAgc2VsZi5zZXR1cF9tcXR0X2hhbmRsZXJzKCkKICAgICAgICAgICAgc2VsZi5jb25uZWN0KCkKICAgICAgICAgICAgIyBLaOG7n2kgxJHhu5luZyBzeW5jIHRocmVhZCBzYXUga2hpIGvhur90IG7hu5FpIHRow6BuaCBjw7RuZwogICAgICAgICAgICBzZWxmLnN0YXJ0X3N5bmNfdGhyZWFkKCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6Mga2jhu59pIMSR4buZbmcgTVFUVCBzZXJ2aWNlIHbDoCDEkeG7k25nIGLhu5kgZOG7ryBsaeG7h3UiKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraOG7n2kgxJHhu5luZyBNUVRUIHNlcnZpY2UiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX29uX21lc3NhZ2Uoc2VsZiwgY2xpZW50LCB1c2VyZGF0YSwgbXNnLCBwcm9wZXJ0aWVzPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIENhbGxiYWNrIGtoaSBuaOG6rW4gxJHGsOG7o2MgbWVzc2FnZSB04burIE1RVFQgYnJva2VyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY2xpZW50OiBNUVRUIGNsaWVudCBpbnN0YW5jZQogICAgICAgICAgICB1c2VyZGF0YTogVXNlciBkYXRhIMSRxrDhu6NjIHRydXnhu4FuIHbDoG8gY2xpZW50CiAgICAgICAgICAgIG1zZzogTWVzc2FnZSBvYmplY3QgY2jhu6lhIHRvcGljIHbDoCBwYXlsb2FkCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFByb3BlcnRpZXMgY+G7p2EgbWVzc2FnZSAoTVFUVCB2NSkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIk5o4bqtbiBtZXNzYWdlIHThu6sgdG9waWM6IHttc2cudG9waWN9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUGFyc2UgcGF5bG9hZCBKU09OCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBheWxvYWQgPSBqc29uLmxvYWRzKG1zZy5wYXlsb2FkLmRlY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIHBhcnNlIEpTT04gdOG7qyBwYXlsb2FkOiB7bXNnLnBheWxvYWR9IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBY4butIGzDvSBtZXNzYWdlIGThu7FhIHRyw6puIHRvcGljCiAgICAgICAgICAgIGlmIG1zZy50b3BpYyA9PSBzZWxmLnRvcGljX3NlcnZlcl90YXNrOgogICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlX3NlcnZlcl90YXNrKHBheWxvYWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIk5o4bqtbiBtZXNzYWdlIHThu6sgdG9waWMga2jDtG5nIHjDoWMgxJHhu4tuaDoge21zZy50b3BpY30iKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB44butIGzDvSBtZXNzYWdlOiB7c3RyKGUpfSIpCgogICAgZGVmIF9oYW5kbGVfc2VydmVyX3Rhc2soc2VsZiwgcGF5bG9hZDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IHRhc2sgdOG7qyBzZXJ2ZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwYXlsb2FkOiBE4buvIGxp4buHdSB0YXNrIHThu6sgc2VydmVyCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXNrX3R5cGUgPSBwYXlsb2FkLmdldCgidGFza190eXBlIikKICAgICAgICAgICAgaWYgbm90IHRhc2tfdHlwZToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJOaOG6rW4gdGFzayBraMO0bmcgY8OzIHRhc2tfdHlwZSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIk5o4bqtbiB0YXNrIHThu6sgc2VydmVyOiB7dGFza190eXBlfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIGhhbmRsZXIgdMawxqFuZyDhu6luZyBu4bq/dSDEkcOjIMSRxINuZyBrw70KICAgICAgICAgICAgaWYgdGFza190eXBlIGluIHNlbGYudGFza19oYW5kbGVyczoKICAgICAgICAgICAgICAgIHNlbGYudGFza19oYW5kbGVyc1t0YXNrX3R5cGVdKHBheWxvYWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIktow7RuZyB0w6xtIHRo4bqleSBoYW5kbGVyIGNobyB0YXNrX3R5cGU6IHt0YXNrX3R5cGV9IikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB44butIGzDvSB0YXNrIHThu6sgc2VydmVyOiB7c3RyKGUpfSIpCiAgICAKICAgIGRlZiBfbW9uaXRvcl9yYW1fdXNhZ2Uoc2VsZiwgZGV2aWNlX2luZm86IERpY3Rbc3RyLCBBbnldKToKICAgICAgICAiIiIKICAgICAgICBUaGVvIGTDtWkgUkFNIHbDoCB04buxIMSR4buZbmcgcmVib290IG7hur91IFJBTSBjYW8gbGnDqm4gdOG7pWMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBkZXZpY2VfaW5mbzogVGjDtG5nIHRpbiB0aGnhur90IGLhu4sgY2jhu6lhIFJBTSB1c2FnZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBwaOG6p24gdHLEg20gUkFNIHRy4buxYyB0aeG6v3AgdOG7qyBkZXZpY2VfaW5mbyAobeG6t2MgxJHhu4tuaCBsw6AgMCBu4bq/dSBraMO0bmcgY8OzKQogICAgICAgICAgICByYW1fdXNhZ2VfcGVyY2VudCA9IGRldmljZV9pbmZvLmdldCgicmFtX3BlcmNlbnRhZ2UiLCAwKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmFtX3VzYWdlX3BlcmNlbnQgPT0gMDoKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiS2jDtG5nIGPDsyB0aMO0bmcgdGluIHJhbV9wZXJjZW50YWdlIHRyb25nIGRldmljZV9pbmZvLCBz4butIGThu6VuZyBnacOhIHRy4buLIG3hurdjIMSR4buLbmggMCIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIHbDoG8gbOG7i2NoIHPhu60gKGNo4buJIGdp4buvIGzhuqFpIDMgbOG6p24gZ+G6p24gbmjhuqV0KQogICAgICAgICAgICBzZWxmLnJhbV91c2FnZV9oaXN0b3J5LmFwcGVuZChyYW1fdXNhZ2VfcGVyY2VudCkKICAgICAgICAgICAgaWYgbGVuKHNlbGYucmFtX3VzYWdlX2hpc3RvcnkpID4gc2VsZi5jb25zZWN1dGl2ZV9oaWdoX3JhbV9saW1pdDoKICAgICAgICAgICAgICAgIHNlbGYucmFtX3VzYWdlX2hpc3RvcnkucG9wKDApCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJSQU0gaGnhu4duIHThuqFpOiB7cmFtX3VzYWdlX3BlcmNlbnQ6LjFmfSUgKGzhu4tjaCBz4butOiB7W2Yne3g6LjFmfSUnIGZvciB4IGluIHNlbGYucmFtX3VzYWdlX2hpc3RvcnldfSkiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyDEkeG7pyAzIGzhuqduIMSRbyB2w6AgdOG6pXQgY+G6oyDEkeG7gXUgPiBuZ8aw4buhbmcKICAgICAgICAgICAgaWYgbGVuKHNlbGYucmFtX3VzYWdlX2hpc3RvcnkpID49IHNlbGYuY29uc2VjdXRpdmVfaGlnaF9yYW1fbGltaXQ6CiAgICAgICAgICAgICAgICBpZiBhbGwodXNhZ2UgPiBzZWxmLmhpZ2hfcmFtX3RocmVzaG9sZCBmb3IgdXNhZ2UgaW4gc2VsZi5yYW1fdXNhZ2VfaGlzdG9yeSk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJSQU0gY2FvIGxpw6puIHThu6VjIHtzZWxmLmNvbnNlY3V0aXZlX2hpZ2hfcmFtX2xpbWl0fSBs4bqnbiAoPntzZWxmLmhpZ2hfcmFtX3RocmVzaG9sZH0lKToge1tmJ3t4Oi4xZn0lJyBmb3IgeCBpbiBzZWxmLnJhbV91c2FnZV9oaXN0b3J5XX0iKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJC4bqvdCDEkeG6p3UgcmVib290IHRoaeG6v3QgYuG7iyDEkeG7gyBnaeG6o2kgcGjDs25nIFJBTS4uLiIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIHJlYm9vdAogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX3JlYm9vdF9kZXZpY2UoKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIsSQw6MgZ+G7rWkgbOG7h25oIHJlYm9vdCB0aMOgbmggY8O0bmciKQogICAgICAgICAgICAgICAgICAgICAgICAjIFJlc2V0IGzhu4tjaCBz4butIHNhdSBraGkgcmVib290CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmFtX3VzYWdlX2hpc3RvcnkuY2xlYXIoKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIHRo4buxYyBoaeG7h24gcmVib290IHRoaeG6v3QgYuG7iyIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHRoZW8gZMO1aSBSQU06IHtlfSIpCiAgICAKICAgIGRlZiBfcmVib290X2RldmljZShzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gcmVib290IHRoaeG6v3QgYuG7iyBxdWEgQURCCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBT4butIGThu6VuZyBERVZJQ0VfSVAgdOG7qyBjb25maWcgdGhheSB2w6wgQURCX0hPU1QKICAgICAgICAgICAgZGV2aWNlX2FkZHJlc3MgPSBmIntjb25maWcuREVWSUNFX0lQfTp7Y29uZmlnLkFEQl9QT1JUfSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG7h25oIHJlYm9vdCBxdWEgQURCCiAgICAgICAgICAgIGNtZCA9IFsiYWRiIiwgIi1zIiwgZGV2aWNlX2FkZHJlc3MsICJyZWJvb3QiXQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJUaOG7sWMgaGnhu4duIHJlYm9vdCB0aGnhur90IGLhu4s6IHsnICcuam9pbihjbWQpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAgICMgVGltZW91dCAxMCBnacOieQogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIkzhu4duaCByZWJvb3QgxJHDoyDEkcaw4bujYyBn4butaSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5UaW1lb3V0RXhwaXJlZDoKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIlRpbWVvdXQga2hpIGfhu61pIGzhu4duaCByZWJvb3QgKHRoaeG6v3QgYuG7iyBjw7MgdGjhu4MgxJFhbmcgcmVib290KSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlICAjIENvaSBuaMawIHRow6BuaCBjw7RuZyB2w6wgY8OzIHRo4buDIHRoaeG6v3QgYuG7iyDEkWFuZyByZWJvb3QKICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gcmVib290OiB7ZS5zdGRlcnJ9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBs4buHbmggYWRiLCBraMO0bmcgdGjhu4MgcmVib290IHRoaeG6v3QgYuG7iyIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2jDtG5nIHjDoWMgxJHhu4tuaCBraGkgcmVib290IHRoaeG6v3QgYuG7izoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNl').decode('utf-8'))
