import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKaW1wb3J0IHJlCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBvcwppbXBvcnQgY29uZmlnCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCBxdW90ZSwgdW5xdW90ZQpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBPcHRpb25hbCwgVHVwbGUsIExpc3QsIFVuaW9uCnRyeToKICAgIGZyb20gbHhtbCBpbXBvcnQgZXRyZWUKICAgIExYTUxfQVZBSUxBQkxFID0gVHJ1ZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBMWE1MX0FWQUlMQUJMRSA9IEZhbHNlCgpjbGFzcyBIZWxwZXJTZXJ2aWNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGJhc2VfdXJsOiBzdHIgPSAiaHR0cDovL2xvY2FsaG9zdDo4MDgwIiwgZGJfc2VydmljZT1Ob25lKToKICAgICAgICBzZWxmLmJhc2VfdXJsID0gYmFzZV91cmwKICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHNlbGYuZGV2aWNlX2lwID0gTm9uZQogICAgICAgIHNlbGYuZGJfc2VydmljZSA9IGRiX3NlcnZpY2UKICAgICAgICAKICAgICAgICAjIE7hur91IGJhc2VfdXJsIGNo4bupYSDEkeG7i2EgY2jhu4kgSVAsIHRo4butIGvhur90IG7hu5FpIEFEQgogICAgICAgIGlwX21hdGNoID0gcmUuc2VhcmNoKHIiaHR0cDovLyhbMC05XStcLlswLTldK1wuWzAtOV0rXC5bMC05XSspIiwgYmFzZV91cmwpCiAgICAgICAgaWYgaXBfbWF0Y2g6CiAgICAgICAgICAgIHNlbGYuZGV2aWNlX2lwID0gaXBfbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgc2VsZi5jaGVja19hbmRfY29ubmVjdF9hZGIoKQoKICAgIGRlZiBjaGVja19hbmRfY29ubmVjdF9hZGIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHbDoCBr4bq/dCBu4buRaSBBREIgdOG7m2kgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgQURCIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBraMO0bmcKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJhZGIiLCAiLS12ZXJzaW9uIl0sIGNoZWNrPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEvhur90IG7hu5FpIEFEQiDEkeG6v24gdGhp4bq/dCBi4buLIHPhu60gZOG7pW5nIMSR4buLYSBjaOG7iSB04burIGNvbmZpZwogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRo4butIGvhur90IG7hu5FpIMSR4bq/biB0aGnhur90IGLhu4sKICAgICAgICAgICAgY29ubmVjdF9wcm9jZXNzID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbImFkYiIsICJjb25uZWN0IiwgYWRiX2FkZHJlc3NdLAogICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyBr4bq/dCBu4buRaQogICAgICAgICAgICBpZiAiY29ubmVjdGVkIiBpbiBjb25uZWN0X3Byb2Nlc3Muc3Rkb3V0Lmxvd2VyKCk6CiAgICAgICAgICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBUcnVlCiAgICAgICAgICAgICAgICBwcmludChmIsSQw6Mga+G6v3QgbuG7kWkgQURCIHRow6BuaCBjw7RuZyDEkeG6v24ge2FkYl9hZGRyZXNzfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IChzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciwgRmlsZU5vdEZvdW5kRXJyb3IpIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIEFEQjoge2V9IikKICAgICAgICAKICAgICAgICBzZWxmLmlzX2FkYl9jb25uZWN0ZWQgPSBGYWxzZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfZ2V0X2FkYl9kZXZpY2VfcGFyYW0oc2VsZikgLT4gTGlzdFtzdHJdOgogICAgICAgICIiIgogICAgICAgIFRy4bqjIHbhu4EgdGhhbSBz4buRIHRoaeG6v3QgYuG7iyBjaG8gbOG7h25oIEFEQgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3Rbc3RyXTogRGFuaCBzw6FjaCBbLXMsIGRldmljZV9pZF0gaG/hurdjIGxpc3QgcuG7l25nIG7hur91IGtow7RuZyBjw7MgdGhp4bq/dCBi4buLCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICBhZGJfYWRkcmVzcyA9IGYie2NvbmZpZy5BREJfSE9TVH06e2NvbmZpZy5BREJfUE9SVH0iCiAgICAgICAgICAgIHJldHVybiBbIi1zIiwgYWRiX2FkZHJlc3NdCiAgICAgICAgcmV0dXJuIFtdCgogICAgZGVmIF9tYWtlX3JlcXVlc3Qoc2VsZiwgZW5kcG9pbnQ6IHN0ciwgcGFyYW1zOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gcmVxdWVzdCBBUEkgdsOgIHRy4bqjIHbhu4Ega+G6v3QgcXXhuqMgZOG6oW5nIEpTT04gaG/hurdjIFhNTAogICAgICAgICIiIgogICAgICAgIHVybCA9IGYie3NlbGYuYmFzZV91cmx9L3tlbmRwb2ludH0iCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRoaeG6v3QgbOG6rXAgdGltZW91dCBjaG8gcmVxdWVzdAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIENvbnRlbnQtVHlwZQogICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICMgVHLhuqMgduG7gSBYTUwgZMaw4bubaSBk4bqhbmcgdGV4dAogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHJlc3BvbnNlLnRleHR9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRy4bqjIHbhu4EgSlNPTgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlRpbWVvdXQ6CiAgICAgICAgICAgIHByaW50KGYiUmVxdWVzdCB0aW1lb3V0IGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCIpCiAgICAgICAgICAgIHNlbGYuX3Jlc3RhcnRfaGVscGVyX2FwcCgpCiAgICAgICAgICAgICMgVGjhu60gbOG6oWkgcmVxdWVzdCBzYXUga2hpIGto4bufaSDEkeG7mW5nIGzhuqFpIGhlbHBlciBhcHAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKSAgIyBDaOG7nSAxIGdpw6J5IMSR4buDIOG7qW5nIGThu6VuZyBraOG7n2kgxJHhu5luZwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi94bWwnIGluIGNvbnRlbnRfdHlwZSBvciBlbmRwb2ludCA9PSAnZHVtcC1zY3JlZW4teG1sJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJkYXRhIjogcmVzcG9uc2UudGV4dH0KICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIlbhuqtuIGzhu5dpIHNhdSBraGkgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvciBhcyBlOgogICAgICAgICAgICAjIELhuq90IGzhu5dpIGvhur90IG7hu5FpIGLhu4sgdOG7qyBjaOG7kWkgaG/hurdjIGtow7RuZyB0aOG7gyBr4bq/dCBu4buRaQogICAgICAgICAgICBwcmludChmIkzhu5dpIGvhur90IG7hu5FpIGtoaSBn4buNaSB7dXJsfSwgdGjhu60ga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcDoge2V9IikKICAgICAgICAgICAgc2VsZi5fcmVzdGFydF9oZWxwZXJfYXBwKCkKICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSByZXF1ZXN0IHNhdSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpICAjIENo4budIDIgZ2nDonkgxJHhu4Mg4bupbmcgZOG7pW5nIGto4bufaSDEkeG7mW5nCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1wYXJhbXMsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29udGVudF90eXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICAgICAgaWYgJ2FwcGxpY2F0aW9uL3htbCcgaW4gY29udGVudF90eXBlIG9yIGVuZHBvaW50ID09ICdkdW1wLXNjcmVlbi14bWwnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgImRhdGEiOiByZXNwb25zZS50ZXh0fQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiVuG6q24gbOG7l2kgc2F1IGtoaSB0aOG7rSBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBzdHIoZSl9CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIHJlcXVlc3Q6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogc3RyKGUpfQoKICAgIGRlZiBfcmVzdGFydF9oZWxwZXJfYXBwKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBz4butIGThu6VuZyBBREIKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5pc19hZGJfY29ubmVjdGVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IHRoYW0gc+G7kSB0aGnhur90IGLhu4sKICAgICAgICAgICAgICAgIGRldmljZV9wYXJhbXMgPSBzZWxmLl9nZXRfYWRiX2RldmljZV9wYXJhbSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgaGVscGVyIGFwcCBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCAiYW0iLCAic3RhcnQiLCAiLW4iLCAiY29tLmRuZHZpbmEuaGVscGVyLy5NYWluQWN0aXZpdHkiXQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcHJpbnQoIsSQw6Mga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlN1YnByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkga2jhu59pIMSR4buZbmcgbOG6oWkgaGVscGVyIGFwcCBxdWEgQURCOiB7ZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIktow7RuZyB0aOG7gyBraOG7n2kgxJHhu5luZyBs4bqhaSBoZWxwZXIgYXBwIHbDrCBBREIgY2jGsGEgxJHGsOG7o2Mga+G6v3QgbuG7kWkiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgdGFwKHNlbGYsIHg6IGludCwgeTogaW50KSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaOG6oW0gdsOgbyB24buLIHRyw60geCx5IHRyw6puIG3DoG4gaMOsbmgKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJ0YXAiLCBwYXJhbXM9eyJ4IjogeCwgInkiOiB5fSkKCiAgICBkZWYgdGFwX2VsZW1lbnQoc2VsZiwgYm91bmRzOiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENo4bqhbSB2w6BvIG3hu5l0IHBo4bqnbiB04butIGThu7FhIHRyw6puIGJvdW5kcyBj4bunYSBuw7MKICAgICAgICBGb3JtYXQgYm91bmRzOiAiW3gxLHkxXVt4Mix5Ml0iIGhv4bq3YyBlbGVtZW50IGRpY3QKICAgICAgICAiIiIKICAgICAgICAjIE7hur91IGJvdW5kcyBsw6AgbeG7mXQgZGljdCAoZWxlbWVudCksIGzhuqV5IGJvdW5kcyBzdHJpbmcgdOG7qyDEkcOzCiAgICAgICAgaWYgaXNpbnN0YW5jZShib3VuZHMsIGRpY3QpOgogICAgICAgICAgICBib3VuZHMgPSBib3VuZHMuZ2V0KCJib3VuZHMiLCAiWzAsMF1bMCwwXSIpCiAgICAgICAgICAgIAogICAgICAgICMgVGjhu60gY8OhYyBwYXR0ZXJuIGtow6FjIG5oYXUgxJHhu4MgcGFyc2UgYm91bmRzLCBjaG8gcGjDqXAgc+G7kSDDom0KICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgciJcWygtP1xkKyksKC0/XGQrKVxdXFsoLT9cZCspLCgtP1xkKylcXSIsICAjIFt4MSx5MV1beDIseTJdIHbhu5tpIHPhu5Egw6JtCiAgICAgICAgICAgIHIiKC0/XGQrKSwoLT9cZCspLCgtP1xkKyksKC0/XGQrKSIsICAgICAgICAgIyB4MSx5MSx4Mix5MgogICAgICAgICAgICByIlxbKC0/XGQrKTsoLT9cZCspXF1cWygtP1xkKyk7KC0/XGQrKVxdIiAgICMgW3gxO3kxXVt4Mjt5Ml0KICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUubWF0Y2gocGF0dGVybiwgYm91bmRzKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIHgxLCB5MSwgeDIsIHkyID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgcHJpbnQoZiJPcmlnaW5hbCBib3VuZHM6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpICAjIELhu48gbG9nIG7DoHkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBT4butYSBjaOG7r2EgYm91bmRzIGtow7RuZyBo4bujcCBs4buHCiAgICAgICAgICAgICAgICBpZiB5MSA8IDAgb3IgeTIgPCAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiRml4aW5nIG5lZ2F0aXZlIFkgY29vcmRpbmF0ZXMuLi4iKQogICAgICAgICAgICAgICAgICAgIGlmIHkyIDwgMDoKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gYWJzKHkyIC0geTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gbWF4KDAsIHkxKQogICAgICAgICAgICAgICAgICAgICAgICB5MiA9IHkxICsgaGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiQWRqdXN0ZWQgWTogeTE9e3kxfSwgeTI9e3kyfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHgxIDwgMCBvciB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJGaXhpbmcgbmVnYXRpdmUgWCBjb29yZGluYXRlcy4uLiIpCiAgICAgICAgICAgICAgICAgICAgaWYgeDIgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGFicyh4MiAtIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MSA9IG1heCgwLCB4MSkKICAgICAgICAgICAgICAgICAgICAgICAgeDIgPSB4MSArIHdpZHRoCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiQWRqdXN0ZWQgWDogeDE9e3gxfSwgeDI9e3gyfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBib3VuZHMgaOG7o3AgbOG7hyBzYXUga2hpIMSRaeG7gXUgY2jhu4luaAogICAgICAgICAgICAgICAgaWYgeDEgPj0geDIgb3IgeTEgPj0geTI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJJbnZhbGlkIGJvdW5kcyBhZnRlciBhZGp1c3RtZW50OiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIENo4buNbiBt4buZdCDEkWnhu4NtIHRyb25nIGJvdW5kcyB24bubaSBtYXJnaW4gYW4gdG/DoG4KICAgICAgICAgICAgICAgIG1hcmdpbiA9IG1pbigzLCAoeDIgLSB4MSkgLy8gNCwgKHkyIC0geTEpIC8vIDQpICAjIER5bmFtaWMgbWFyZ2luCiAgICAgICAgICAgICAgICBtYXJnaW4gPSBtYXgoMSwgbWFyZ2luKSAgIyDDjXQgbmjhuqV0IDFweCBtYXJnaW4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgeCA9IHJhbmRvbS5yYW5kaW50KHgxICsgbWFyZ2luLCBtYXgoeDEgKyBtYXJnaW4gKyAxLCB4MiAtIG1hcmdpbikpCiAgICAgICAgICAgICAgICB5ID0gcmFuZG9tLnJhbmRpbnQoeTEgKyBtYXJnaW4sIG1heCh5MSArIG1hcmdpbiArIDEsIHkyIC0gbWFyZ2luKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBwcmludChmIkZpbmFsIHRhcCBjb29yZGluYXRlczogKHt4fSwge3l9KSB3aXRoIG1hcmdpbiB7bWFyZ2lufSIpICAjIELhu48gbG9nIG7DoHkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudGFwKHgsIHkpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBmIsSQ4buLbmggZOG6oW5nIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hzoge2JvdW5kc30ifQoKICAgIGRlZiBzd2lwZV91cChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgbMOqbiB04burIHbhu4sgdHLDrSBuZ+G6q3Ugbmhpw6puIHBow7kgaOG7o3AKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZV91cCIpCgogICAgZGVmIHN3aXBlX2Rvd24oc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHh14buRbmcgdOG7qyB24buLIHRyw60gbmfhuqt1IG5oacOqbiBwaMO5IGjhu6NwCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgic3dpcGVfZG93biIpCgogICAgZGVmIGlucHV0X3RleHQoc2VsZiwgdGV4dDogc3RyLCBzcGVlZDogZmxvYXQgPSAxLjAsIAogICAgICAgICAgICAgICAgICBkaXJlY3RfbW9kZTogYm9vbCA9IEZhbHNlLCBwZXJmZWN0X21vZGU6IGJvb2wgPSBUcnVlKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBNw7QgcGjhu49uZyBnw7UgcGjDrW0gduG7m2kgdOG7kWMgxJHhu5kgbmfhuqt1IG5oacOqbiBnaeG7kW5nIG5nxrDhu51pIHRo4bqtdAogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgInRleHQiOiB0ZXh0LAogICAgICAgICAgICAic3BlZWQiOiBzcGVlZCwKICAgICAgICAgICAgImRpcmVjdF9tb2RlIjogc3RyKGRpcmVjdF9tb2RlKS5sb3dlcigpLAogICAgICAgICAgICAicGVyZmVjdF9tb2RlIjogc3RyKHBlcmZlY3RfbW9kZSkubG93ZXIoKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpbnB1dF90ZXh0IiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgc2hvd190b2FzdChzZWxmLCBtZXNzYWdlOiBzdHIsIHR5cGVfOiBzdHIgPSAiaW5mbyIsIAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogc3RyID0gImJvdHRvbSIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEhp4buDbiB0aOG7iyB0aMO0bmcgYsOhbyB0b2FzdAogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgIm1lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAidHlwZSI6IHR5cGVfLAogICAgICAgICAgICAicG9zaXRpb24iOiBwb3NpdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJ0b2FzdC1tZXNzYWdlIiwgcGFyYW1zPXBhcmFtcykKCiAgICBkZWYgZ2V0X2RldmljZV9pbmZvKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRow7RuZyB0aW4gY2hpIHRp4bq/dCB24buBIHRoaeG6v3QgYuG7iwogICAgICAgICIiIgogICAgICAgIHJlc3VsdCA9IHNlbGYuX21ha2VfcmVxdWVzdCgiZGV2aWNlLWluZm8iKQogICAgICAgIAogICAgICAgICMgTuG6v3Uga+G6v3QgcXXhuqMgdGjDoG5oIGPDtG5nLCB0aMOqbSB0aMO0bmcgdGluIGludGVybmV0IElQCiAgICAgICAgaWYgcmVzdWx0LmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiIGFuZCAiZGF0YSIgaW4gcmVzdWx0OgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEzhuqV5IGludGVybmV0IElQIGLhurFuZyByZXF1ZXN0cwogICAgICAgICAgICAgICAgaW50ZXJuZXRfaXAgPSBzZWxmLl9nZXRfaW50ZXJuZXRfaXAoKQogICAgICAgICAgICAgICAgaWYgaW50ZXJuZXRfaXA6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0WyJkYXRhIl1bImludGVybmV0X2lwIl0gPSBpbnRlcm5ldF9pcAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXN1bHRbImRhdGEiXVsiaW50ZXJuZXRfaXAiXSA9ICJ1bmtub3duIgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBs4bqleSBpbnRlcm5ldCBJUDoge2V9IikKICAgICAgICAgICAgICAgIHJlc3VsdFsiZGF0YSJdWyJpbnRlcm5ldF9pcCJdID0gImVycm9yIgogICAgICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgIAogICAgZGVmIF9nZXRfaW50ZXJuZXRfaXAoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IMSR4buLYSBjaOG7iSBJUCBjw7RuZyBj4buZbmcgYuG6sW5nIHJlcXVlc3RzCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiDEkOG7i2EgY2jhu4kgSVAgY8O0bmcgY+G7mW5nIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5pcGlmeS5vcmciLCB0aW1lb3V0PTMpCiAgICAgICAgICAgIGlwID0gcmVzcG9uc2UudGV4dC5zdHJpcCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgxJHhu4tuaCBk4bqhbmcgSVAgxJHGoW4gZ2nhuqNuCiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHInXlxkezEsM31cLlxkezEsM31cLlxkezEsM31cLlxkezEsM30kJywgaXApOgogICAgICAgICAgICAgICAgcmV0dXJuIGlwCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIkvhur90IHF14bqjIGtow7RuZyBwaOG6o2kgbMOgIElQIGjhu6NwIGzhu4c6IHtpcH0iKQogICAgICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5UaW1lb3V0OgogICAgICAgICAgICBwcmludCgiVGltZW91dCBraGkgbOG6pXkgaW50ZXJuZXQgSVAgKDMgZ2nDonkpIikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBs4bqleSBpbnRlcm5ldCBJUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtow7RuZyB4w6FjIMSR4buLbmgga2hpIGzhuqV5IGludGVybmV0IElQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgY2hlY2tfaW50ZXJuZXQoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIGvhur90IG7hu5FpIGludGVybmV0CiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBjw7Mga+G6v3QgbuG7kWkgaW50ZXJuZXQsIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUaOG7rSBr4bq/dCBu4buRaSDEkeG6v24gR29vZ2xlIEROUyB24bubaSB0aW1lb3V0IG5n4bqvbgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly84LjguOC44IiwgdGltZW91dD01KQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb246CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgVGjhu60gduG7m2kgbeG7mXQgZG9tYWluIGtow6FjCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbSIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb246CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZ2V0X2xvY2FsX2lwKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSDEkeG7i2EgY2jhu4kgSVAgbG9jYWwgY+G7p2EgdGhp4bq/dCBi4buLIHThu6sgZGV2aWNlIGluZm8KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IMSQ4buLYSBjaOG7iSBJUCBsb2NhbCBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgaWYgZGV2aWNlX2luZm8uZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kICJkYXRhIiBpbiBkZXZpY2VfaW5mbzoKICAgICAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaW5mb1siZGF0YSJdLmdldCgibG9jYWxfaXAiLCAiIikKICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBs4bqleSBsb2NhbCBJUDoge2V9IikKICAgICAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIGR1bXBfc2NyZWVuX3htbChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgRHVtcCB0b8OgbiBi4buZIGPhuqV1IHRyw7pjIFhNTCBj4bunYSBtw6BuIGjDrG5oIGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIFRy4bqjIHbhu4EgbuG7mWkgZHVuZyBYTUwgZMaw4bubaSBk4bqhbmcgY2h14buXaQogICAgICAgICIiIgogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fbWFrZV9yZXF1ZXN0KCJkdW1wLXNjcmVlbi14bWwiKQogICAgICAgIGlmIHJlc3BvbnNlWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdCiAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIG9wZW5fYXBwKHNlbGYsIHBhY2thZ2U6IHN0ciwgYWN0aXZpdHk6IHN0ciA9IE5vbmUpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE3hu58gbeG7mXQg4bupbmcgZOG7pW5nIHbhu5tpIHBhY2thZ2UgbmFtZSB2w6AgYWN0aXZpdHkgY+G7pSB0aOG7gwogICAgICAgICIiIgogICAgICAgIHBhcmFtcyA9IHsicGFja2FnZSI6IHBhY2thZ2V9CiAgICAgICAgaWYgYWN0aXZpdHk6CiAgICAgICAgICAgIHBhcmFtc1siYWN0aXZpdHkiXSA9IGFjdGl2aXR5CiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgib3Blbl9hcHAiLCBwYXJhbXM9cGFyYW1zKQoKICAgIGRlZiBjbG9zZV9hcHAoc2VsZiwgcGFja2FnZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICDEkMOzbmcgbeG7mXQg4bupbmcgZOG7pW5nIMSRYW5nIGNo4bqheQogICAgICAgIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuaXNfYWRiX2Nvbm5lY3RlZDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBM4bqleSB0aGFtIHPhu5EgdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICBkZXZpY2VfcGFyYW1zID0gc2VsZi5fZ2V0X2FkYl9kZXZpY2VfcGFyYW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMSQw7NuZyDhu6luZyBk4bulbmcgYuG6sW5nIEFEQgogICAgICAgICAgICAgICAgY21kID0gWyJhZGIiXSArIGRldmljZV9wYXJhbXMgKyBbInNoZWxsIiwgZiJhbSBmb3JjZS1zdG9wIHtwYWNrYWdlfSJdCiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNzIiwgIm1lc3NhZ2UiOiBmIsSQw6MgxJHDs25nIHtwYWNrYWdlfSBi4bqxbmcgQURCIn0KICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSDEkcOzbmcg4bupbmcgZOG7pW5nIGLhurFuZyBBREI6IHtlfSIpCiAgICAgICAgICAgICAgICAjIE7hur91IGzhu5dpLCB0aOG7rSBwaMawxqFuZyB0aOG7qWMgSFRUUAogICAgICAgIAogICAgICAgICMgU+G7rSBk4bulbmcgSFRUUCBBUEkgbuG6v3Uga2jDtG5nIGPDsyBBREIgaG/hurdjIEFEQiBi4buLIGzhu5dpCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfaG9tZSIpCgogICAgZGVmIF9zYW5pdGl6ZV94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0cikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIFjhu60gbMO9IGPDoWMga8O9IHThu7EgxJHhurdjIGJp4buHdCB0cm9uZyBYTUwgxJHhu4MgdHLDoW5oIGzhu5dpIGtoaSBwaMOibiB0w61jaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBDaHXhu5dpIFhNTCBj4bqnbiB44butIGzDvQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IENodeG7l2kgWE1MIMSRw6MgxJHGsOG7o2MgeOG7rSBsw70KICAgICAgICAiIiIKICAgICAgICAjIFRoYXkgdGjhur8gY8OhYyBrw70gdOG7sSAmIGtow7RuZyBo4bujcCBs4buHIGLhurFuZyAmYW1wOwogICAgICAgICMgTmjGsG5nIGdp4buvIG5ndXnDqm4gY8OhYyBlbnRpdHkgaOG7o3AgbOG7hyBuaMawICZhbXA7LCAmbHQ7LCAmZ3Q7LCAmcXVvdDssICZhcG9zOwogICAgICAgIHhtbF9jb250ZW50ID0gcmUuc3ViKHInJig/IShhbXB8bHR8Z3R8cXVvdHxhcG9zKTspJywgJyZhbXA7JywgeG1sX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgIyBMb+G6oWkgYuG7jyBjw6FjIGvDvSB04buxIMSRaeG7gXUga2hp4buDbiBraMO0bmcgaOG7o3AgbOG7hyB0cm9uZyBYTUwKICAgICAgICB4bWxfY29udGVudCA9IHJlLnN1YihyJ1tceDAwLVx4MDhceDBCXHgwQ1x4MEUtXHgxRl0nLCAnJywgeG1sX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHhtbF9jb250ZW50CgogICAgZGVmIGZpbmRfZWxlbWVudF9pbl94bWwoc2VsZiwgeG1sX2NvbnRlbnQ6IHN0ciwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSBwaOG6p24gdOG7rSB0cm9uZyBYTUwgZOG7sWEgdHLDqm4gdGV4dCwgY29udGVudC1kZXNjLCByZXNvdXJjZS1pZCwgY2xhc3MgaG/hurdjIHZpc2libGUtdG8tdXNlcgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHhtbF9jb250ZW50OiBO4buZaSBkdW5nIFhNTAogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogUGjhuqduIHThu60gxJHhuqd1IHRpw6puIHTDrG0gdGjhuqV5IGhv4bq3YyBOb25lIG7hur91IGtow7RuZyB0w6xtIHRo4bqleQogICAgICAgICIiIgogICAgICAgIGlmIG5vdCB4bWxfY29udGVudDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgaWYgTFhNTF9BVkFJTEFCTEU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgWOG7rSBsw70gY8OhYyBrw70gdOG7sSDEkeG6t2MgYmnhu4d0IHRyb25nIFhNTAogICAgICAgICAgICAgICAgeG1sX2NvbnRlbnQgPSBzZWxmLl9zYW5pdGl6ZV94bWwoeG1sX2NvbnRlbnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUGFyc2UgWE1MIHbhu5tpIHTDuXkgY2jhu41uIHJlY292ZXIgxJHhu4MgeOG7rSBsw70gbOG7l2kKICAgICAgICAgICAgICAgIHBhcnNlciA9IGV0cmVlLlhNTFBhcnNlcihyZWNvdmVyPVRydWUpCiAgICAgICAgICAgICAgICByb290ID0gZXRyZWUuZnJvbXN0cmluZyh4bWxfY29udGVudC5lbmNvZGUoJ3V0Zi04JyksIHBhcnNlcj1wYXJzZXIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgWMOieSBk4buxbmcgWFBhdGggcXVlcnkgZOG7sWEgdHLDqm4gY8OhYyDEkWnhu4F1IGtp4buHbgogICAgICAgICAgICAgICAgY29uZGl0aW9ucyA9IFtdCiAgICAgICAgICAgICAgICBpZiB0ZXh0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHRleHQ9Int0ZXh0fSInKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQGNvbnRlbnQtZGVzYz0ie2NvbnRlbnRfZGVzY30iJykKICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQHJlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicpCiAgICAgICAgICAgICAgICBpZiBjbGFzc19uYW1lIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMuYXBwZW5kKGYnQGNsYXNzPSJ7Y2xhc3NfbmFtZX0iJykKICAgICAgICAgICAgICAgIGlmIHZpc2libGVfdG9fdXNlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3ZhbHVlID0gInRydWUiIGlmIHZpc2libGVfdG9fdXNlciBlbHNlICJmYWxzZSIKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0B2aXNpYmxlLXRvLXVzZXI9Int2aXNpYmxlX3ZhbHVlfSInKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSA9ICIvL25vZGUiCiAgICAgICAgICAgICAgICBpZiBjb25kaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHhwYXRoX3F1ZXJ5ICs9ICJbIiArICIgYW5kICIuam9pbihjb25kaXRpb25zKSArICJdIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gcGjhuqduIHThu60gxJHhuqd1IHRpw6puIHBow7kgaOG7o3AKICAgICAgICAgICAgICAgIGVsZW1lbnQgPSByb290LnhwYXRoKHhwYXRoX3F1ZXJ5KQogICAgICAgICAgICAgICAgaWYgZWxlbWVudDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZWxlbWVudF90b19kaWN0KGVsZW1lbnRbMF0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHTDrG0gcGjhuqduIHThu60gduG7m2kgbHhtbDoge2V9IikKICAgICAgICAKICAgICAgICAjIEZhbGxiYWNrOiBUw6xtIGtp4bq/bSBi4bqxbmcgcmVnZXgKICAgICAgICBpZiB0ZXh0OgogICAgICAgICAgICBwYXR0ZXJuID0gZid0ZXh0PSJ7dGV4dH0iJwogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB4bWxfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAjIFTDrG0gdGjhursgbm9kZSBjaOG7qWEgdGV4dAogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgaWYgY29udGVudF9kZXNjOgogICAgICAgICAgICBwYXR0ZXJuID0gZidjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3RfYXR0cmlidXRlcyhub2RlX2NvbnRlbnQpCiAgICAgICAgCiAgICAgICAgaWYgcmVzb3VyY2VfaWQ6CiAgICAgICAgICAgIHBhdHRlcm4gPSBmJ3Jlc291cmNlLWlkPSJ7cmVzb3VyY2VfaWR9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBpZiBjbGFzc19uYW1lOgogICAgICAgICAgICBwYXR0ZXJuID0gZidjbGFzcz0ie2NsYXNzX25hbWV9IicKICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgeG1sX2NvbnRlbnQpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgIyBUw6xtIHRo4bq7IG5vZGUgY2jhu6lhIGNsYXNzCiAgICAgICAgICAgICAgICBzdGFydF9wb3MgPSB4bWxfY29udGVudC5yZmluZCgnPG5vZGUnLCAwLCBtYXRjaC5zdGFydCgpKQogICAgICAgICAgICAgICAgaWYgc3RhcnRfcG9zICE9IC0xOgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSB4bWxfY29udGVudC5maW5kKCc+Jywgc3RhcnRfcG9zKSArIDEKICAgICAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnQgPSB4bWxfY29udGVudFtzdGFydF9wb3M6ZW5kX3Bvc10KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkKICAgICAgICAKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNlbGYsIHhtbF9jb250ZW50OiBzdHIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgVMOsbSB04bqldCBj4bqjIGPDoWMgcGjhuqduIHThu60gdHJvbmcgWE1MIHBow7kgaOG7o3AgduG7m2kgxJFp4buBdSBraeG7h24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB4bWxfY29udGVudDogTuG7mWkgZHVuZyBYTUwKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCBjw6FjIHBo4bqnbiB04butIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0cyA9IFtdCiAgICAgICAgCiAgICAgICAgaWYgbm90IHhtbF9jb250ZW50OgogICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAKICAgICAgICBpZiBMWE1MX0FWQUlMQUJMRToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBY4butIGzDvSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QgdHJvbmcgWE1MIMSR4buDIHRyw6FuaCBs4buXaSBFbnRpdHlSZWYKICAgICAgICAgICAgICAgIHhtbF9jb250ZW50ID0gc2VsZi5fc2FuaXRpemVfeG1sKHhtbF9jb250ZW50KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBhcnNlIFhNTCB24bubaSB0w7l5IGNo4buNbiByZWNvdmVyIMSR4buDIHjhu60gbMO9IGzhu5dpCiAgICAgICAgICAgICAgICBwYXJzZXIgPSBldHJlZS5YTUxQYXJzZXIocmVjb3Zlcj1UcnVlKQogICAgICAgICAgICAgICAgcm9vdCA9IGV0cmVlLmZyb21zdHJpbmcoeG1sX2NvbnRlbnQuZW5jb2RlKCd1dGYtOCcpLCBwYXJzZXI9cGFyc2VyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFjDonkgZOG7sW5nIFhQYXRoIHF1ZXJ5IGThu7FhIHRyw6puIGPDoWMgxJFp4buBdSBraeG7h24KICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMgPSBbXQogICAgICAgICAgICAgICAgaWYgdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0B0ZXh0PSJ7dGV4dH0iJykKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0Bjb250ZW50LWRlc2M9Intjb250ZW50X2Rlc2N9IicpCiAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0ByZXNvdXJjZS1pZD0ie3Jlc291cmNlX2lkfSInKQogICAgICAgICAgICAgICAgaWYgY2xhc3NfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmFwcGVuZChmJ0BjbGFzcz0ie2NsYXNzX25hbWV9IicpCiAgICAgICAgICAgICAgICBpZiB2aXNpYmxlX3RvX3VzZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV92YWx1ZSA9ICJ0cnVlIiBpZiB2aXNpYmxlX3RvX3VzZXIgZWxzZSAiZmFsc2UiCiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5hcHBlbmQoZidAdmlzaWJsZS10by11c2VyPSJ7dmlzaWJsZV92YWx1ZX0iJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgeHBhdGhfcXVlcnkgPSAiLy9ub2RlIgogICAgICAgICAgICAgICAgaWYgY29uZGl0aW9uczoKICAgICAgICAgICAgICAgICAgICB4cGF0aF9xdWVyeSArPSAiWyIgKyAiIGFuZCAiLmpvaW4oY29uZGl0aW9ucykgKyAiXSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgcGjhuqduIHThu60gcGjDuSBo4bujcAogICAgICAgICAgICAgICAgZWxlbWVudHMgPSByb290LnhwYXRoKHhwYXRoX3F1ZXJ5KQogICAgICAgICAgICAgICAgZm9yIGVsZW1lbnQgaW4gZWxlbWVudHM6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoc2VsZi5fZWxlbWVudF90b19kaWN0KGVsZW1lbnQpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0w6xtIHBo4bqnbiB04butIHbhu5tpIGx4bWw6IHtlfSIpCiAgICAgICAgICAgICAgICBwcmludChmIlRo4butIHTDrG0gcGjhuqduIHThu60gYuG6sW5nIHBoxrDGoW5nIHRo4bupYyB0aGF5IHRo4bq/Li4uIikKICAgICAgICAKICAgICAgICAjIEZhbGxiYWNrOiBUw6xtIGtp4bq/bSBi4bqxbmcgcmVnZXggKGNo4buJIHRy4bqjIHbhu4Ega+G6v3QgcXXhuqMgxJHGoW4gZ2nhuqNuKQogICAgICAgIGlmIG5vdCByZXN1bHRzIGFuZCB0ZXh0OgogICAgICAgICAgICBwYXR0ZXJuID0gZid0ZXh0PSJ7dGV4dH0iJwogICAgICAgICAgICBmb3IgbWF0Y2ggaW4gcmUuZmluZGl0ZXIocGF0dGVybiwgeG1sX2NvbnRlbnQpOgogICAgICAgICAgICAgICAgc3RhcnRfcG9zID0geG1sX2NvbnRlbnQucmZpbmQoJzxub2RlJywgMCwgbWF0Y2guc3RhcnQoKSkKICAgICAgICAgICAgICAgIGlmIHN0YXJ0X3BvcyAhPSAtMToKICAgICAgICAgICAgICAgICAgICBlbmRfcG9zID0geG1sX2NvbnRlbnQuZmluZCgnPicsIHN0YXJ0X3BvcykgKyAxCiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50ID0geG1sX2NvbnRlbnRbc3RhcnRfcG9zOmVuZF9wb3NdCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoc2VsZi5fZXh0cmFjdF9hdHRyaWJ1dGVzKG5vZGVfY29udGVudCkpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdHMKICAgIAogICAgZGVmIF9leHRyYWN0X2F0dHJpYnV0ZXMoc2VsZiwgbm9kZV9jb250ZW50OiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRyw61jaCB4deG6pXQgY8OhYyB0aHXhu5ljIHTDrW5oIHThu6sgbuG7mWkgZHVuZyBj4bunYSBt4buZdCB0aOG6uyBub2RlCiAgICAgICAgIiIiCiAgICAgICAgYXR0cmlidXRlcyA9IHt9CiAgICAgICAgCiAgICAgICAgIyBDw6FjIHRodeG7mWMgdMOtbmggY+G6p24gdHLDrWNoIHh14bqldAogICAgICAgIGF0dHJfcGF0dGVybnMgPSB7CiAgICAgICAgICAgICJjbGFzcyI6IHInY2xhc3M9IihbXiJdKikiJywKICAgICAgICAgICAgInBhY2thZ2UiOiByJ3BhY2thZ2U9IihbXiJdKikiJywKICAgICAgICAgICAgInJlc291cmNlLWlkIjogcidyZXNvdXJjZS1pZD0iKFteIl0qKSInLAogICAgICAgICAgICAidGV4dCI6IHIndGV4dD0iKFteIl0qKSInLAogICAgICAgICAgICAiY29udGVudC1kZXNjIjogcidjb250ZW50LWRlc2M9IihbXiJdKikiJywKICAgICAgICAgICAgImJvdW5kcyI6IHInYm91bmRzPSIoW14iXSopIicsCiAgICAgICAgICAgICJjaGVja2FibGUiOiByJ2NoZWNrYWJsZT0iKFteIl0qKSInLAogICAgICAgICAgICAiY2hlY2tlZCI6IHInY2hlY2tlZD0iKFteIl0qKSInLAogICAgICAgICAgICAiY2xpY2thYmxlIjogcidjbGlja2FibGU9IihbXiJdKikiJywKICAgICAgICAgICAgImVuYWJsZWQiOiByJ2VuYWJsZWQ9IihbXiJdKikiJywKICAgICAgICAgICAgImZvY3VzYWJsZSI6IHInZm9jdXNhYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJmb2N1c2VkIjogcidmb2N1c2VkPSIoW14iXSopIicsCiAgICAgICAgICAgICJzY3JvbGxhYmxlIjogcidzY3JvbGxhYmxlPSIoW14iXSopIicsCiAgICAgICAgICAgICJsb25nLWNsaWNrYWJsZSI6IHInbG9uZy1jbGlja2FibGU9IihbXiJdKikiJywKICAgICAgICAgICAgInBhc3N3b3JkIjogcidwYXNzd29yZD0iKFteIl0qKSInLAogICAgICAgICAgICAic2VsZWN0ZWQiOiByJ3NlbGVjdGVkPSIoW14iXSopIicKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIGF0dHJfbmFtZSwgcGF0dGVybiBpbiBhdHRyX3BhdHRlcm5zLml0ZW1zKCk6CiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIG5vZGVfY29udGVudCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzW2F0dHJfbmFtZV0gPSBtYXRjaC5ncm91cCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZXMKCiAgICBkZWYgX2VsZW1lbnRfdG9fZGljdChzZWxmLCBlbGVtZW50KSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaHV54buDbiDEkeG7lWkgbeG7mXQgcGjhuqduIHThu60gWE1MIHThu6sgbHhtbCB0aMOgbmggZGljdAogICAgICAgICIiIgogICAgICAgIHJlc3VsdCA9IHt9CiAgICAgICAgCiAgICAgICAgIyBM4bqleSB04bqldCBj4bqjIHRodeG7mWMgdMOtbmgKICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBlbGVtZW50LmF0dHJpYi5pdGVtcygpOgogICAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlCiAgICAgICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHQKCiAgICBkZWYgZmluZF9lbGVtZW50KHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIFTDrG0gcGjhuqduIHThu60gdHLDqm4gbcOgbiBow6xuaCBk4buxYSB0csOqbiB0ZXh0LCBjb250ZW50LWRlc2MsIHJlc291cmNlLWlkLCBjbGFzcyBob+G6t2MgdmlzaWJsZS10by11c2VyCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06IFBo4bqnbiB04butIMSR4bqndSB0acOqbiB0w6xtIHRo4bqleSBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICByZXR1cm4gc2VsZi5maW5kX2VsZW1lbnRfaW5feG1sKHhtbF9jb250ZW50LCB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIpCgogICAgZGVmIGZpbmRfYWxsX2VsZW1lbnRzKHNlbGYsIHRleHQ6IHN0ciA9IE5vbmUsIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlX2lkOiBzdHIgPSBOb25lLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSB0csOqbiBtw6BuIGjDrG5oIHBow7kgaOG7o3AgduG7m2kgxJFp4buBdSBraeG7h24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB0ZXh0OiBUZXh0IGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY29udGVudF9kZXNjOiBDb250ZW50IGRlc2NyaXB0aW9uIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IFJlc291cmNlIElEIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogVHJ1ZSDEkeG7gyB0w6xtIGVsZW1lbnQgaGnhu4NuIHRo4buLIHbhu5tpIHVzZXIgKG3hurdjIMSR4buLbmgpLCBGYWxzZSDEkeG7gyB0w6xtIGVsZW1lbnQg4bqpbiwgTm9uZSDEkeG7gyBi4buPIHF1YSDEkWnhu4F1IGtp4buHbiBuw6B5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIGPDoWMgcGjhuqduIHThu60gdMOsbSB0aOG6pXkKICAgICAgICAiIiIKICAgICAgICB4bWxfY29udGVudCA9IHNlbGYuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICByZXR1cm4gc2VsZi5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoeG1sX2NvbnRlbnQsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQsIGNsYXNzX25hbWUsIHZpc2libGVfdG9fdXNlcikKCiAgICBkZWYgaXNfZWxlbWVudF9zZWxlY3RlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2MgY2jhu41uIGhheSBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoInNlbGVjdGVkIikgPT0gInRydWUiCgogICAgZGVmIHdhaXRfZm9yX2VsZW1lbnQoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIGNsYXNzX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcjogYm9vbCA9IFRydWUsIHRpbWVvdXQ6IGludCA9IDMwLCAKICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgY2hvIMSR4bq/biBraGkgbeG7mXQgcGjhuqduIHThu60geHXhuqV0IGhp4buHbiB0csOqbiBtw6BuIGjDrG5oCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGV4dDogVGV4dCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogQ29udGVudCBkZXNjcmlwdGlvbiBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHJlc291cmNlX2lkOiBSZXNvdXJjZSBJRCBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIGNsYXNzX25hbWU6IENsYXNzIG5hbWUgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICB0aW1lb3V0OiBUaOG7nWkgZ2lhbiBjaOG7nSB04buRaSDEkWEgKGdpw6J5KQogICAgICAgICAgICBjaGVja19pbnRlcnZhbDogS2hv4bqjbmcgdGjhu51pIGdpYW4gZ2nhu69hIGPDoWMgbOG6p24ga2nhu4NtIHRyYSAoZ2nDonkpCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXTogUGjhuqduIHThu60gdMOsbSB0aOG6pXkgaG/hurdjIE5vbmUgbuG6v3UgdGltZW91dAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6CiAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmZpbmRfZWxlbWVudCh0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkLCBjbGFzc19uYW1lLCB2aXNpYmxlX3RvX3VzZXIpCiAgICAgICAgICAgIGlmIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgd2FpdF90b190YXBfZWxlbWVudChzZWxmLCB0ZXh0OiBzdHIgPSBOb25lLCBjb250ZW50X2Rlc2M6IHN0ciA9IE5vbmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZDogc3RyID0gTm9uZSwgY2xhc3NfbmFtZTogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBib29sID0gVHJ1ZSwgdGltZW91dDogaW50ID0gMzAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19pbnRlcnZhbDogaW50ID0gMSwgZGVsYXlfYmVmb3JlX3RhcDogaW50ID0gMSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBDaOG7nSDEkeG7o2kgZWxlbWVudCB4deG6pXQgaGnhu4duLCBkZWxheSBt4buZdCBraG/huqNuZyB0aOG7nWkgZ2lhbiwgcuG7k2kgdGFwIHbDoG8gZWxlbWVudAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjbGFzc19uYW1lOiBDbGFzcyBuYW1lIGPhu6dhIHBo4bqnbiB04butIGPhuqduIHTDrG0KICAgICAgICAgICAgdmlzaWJsZV90b191c2VyOiBUcnVlIMSR4buDIHTDrG0gZWxlbWVudCBoaeG7g24gdGjhu4sgduG7m2kgdXNlciAobeG6t2MgxJHhu4tuaCksIEZhbHNlIMSR4buDIHTDrG0gZWxlbWVudCDhuqluLCBOb25lIMSR4buDIGLhu48gcXVhIMSRaeG7gXUga2nhu4duIG7DoHkKICAgICAgICAgICAgdGltZW91dDogVGjhu51pIGdpYW4gY2jhu50gdOG7kWkgxJFhIMSR4buDIHTDrG0gZWxlbWVudCAoZ2nDonkpCiAgICAgICAgICAgIGNoZWNrX2ludGVydmFsOiBLaG/huqNuZyB0aOG7nWkgZ2lhbiBnaeG7r2EgY8OhYyBs4bqnbiBraeG7g20gdHJhIChnacOieSkKICAgICAgICAgICAgZGVsYXlfYmVmb3JlX3RhcDogVGjhu51pIGdpYW4gZGVsYXkgdHLGsOG7m2Mga2hpIHRhcCAoZ2nDonksIG3hurdjIMSR4buLbmggMSBnacOieSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaOG7nSBlbGVtZW50IHh14bqldCBoaeG7h24KICAgICAgICAgICAgZWxlbWVudCA9IHNlbGYud2FpdF9mb3JfZWxlbWVudCgKICAgICAgICAgICAgICAgIHRleHQ9dGV4dCwgCiAgICAgICAgICAgICAgICBjb250ZW50X2Rlc2M9Y29udGVudF9kZXNjLCAKICAgICAgICAgICAgICAgIHJlc291cmNlX2lkPXJlc291cmNlX2lkLCAKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9Y2xhc3NfbmFtZSwKICAgICAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcj12aXNpYmxlX3RvX3VzZXIsIAogICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0LCAKICAgICAgICAgICAgICAgIGNoZWNrX2ludGVydmFsPWNoZWNrX2ludGVydmFsCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICAgICAgIyBU4bqhbyB0aMO0bmcgYsOhbyBs4buXaSBjaGkgdGnhur90CiAgICAgICAgICAgICAgICBjcml0ZXJpYSA9IFtdCiAgICAgICAgICAgICAgICBpZiB0ZXh0OgogICAgICAgICAgICAgICAgICAgIGNyaXRlcmlhLmFwcGVuZChmInRleHQ9J3t0ZXh0fSciKQogICAgICAgICAgICAgICAgaWYgY29udGVudF9kZXNjOgogICAgICAgICAgICAgICAgICAgIGNyaXRlcmlhLmFwcGVuZChmImNvbnRlbnRfZGVzYz0ne2NvbnRlbnRfZGVzY30nIikKICAgICAgICAgICAgICAgIGlmIHJlc291cmNlX2lkOgogICAgICAgICAgICAgICAgICAgIGNyaXRlcmlhLmFwcGVuZChmInJlc291cmNlX2lkPSd7cmVzb3VyY2VfaWR9JyIpCiAgICAgICAgICAgICAgICBpZiBjbGFzc19uYW1lOgogICAgICAgICAgICAgICAgICAgIGNyaXRlcmlhLmFwcGVuZChmImNsYXNzX25hbWU9J3tjbGFzc19uYW1lfSciKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjcml0ZXJpYV9zdHIgPSAiLCAiLmpvaW4oY3JpdGVyaWEpIGlmIGNyaXRlcmlhIGVsc2UgImtow7RuZyB4w6FjIMSR4buLbmgiCiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIktow7RuZyB0w6xtIHRo4bqleSBlbGVtZW50IHNhdSB7dGltZW91dH1zIHbhu5tpIHRpw6p1IGNow606IHtjcml0ZXJpYV9zdHJ9IgogICAgICAgICAgICAgICAgcHJpbnQoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRGVsYXkgdHLGsOG7m2Mga2hpIHRhcAogICAgICAgICAgICBpZiBkZWxheV9iZWZvcmVfdGFwID4gMDoKICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyB0w6xtIHRo4bqleSBlbGVtZW50LCBkZWxheSB7ZGVsYXlfYmVmb3JlX3RhcH1zIHRyxrDhu5tjIGtoaSB0YXAuLi4iKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcChkZWxheV9iZWZvcmVfdGFwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUYXAgdsOgbyBlbGVtZW50CiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYudGFwX2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEga+G6v3QgcXXhuqMgdGFwCiAgICAgICAgICAgIGlmIHJlc3VsdC5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mbyA9IFtdCiAgICAgICAgICAgICAgICBpZiB0ZXh0OgogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mby5hcHBlbmQoZiJ0ZXh0PSd7dGV4dH0nIikKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfZGVzYzoKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2luZm8uYXBwZW5kKGYiY29udGVudF9kZXNjPSd7Y29udGVudF9kZXNjfSciKQogICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfaWQ6CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF9pbmZvLmFwcGVuZChmInJlc291cmNlX2lkPSd7cmVzb3VyY2VfaWR9JyIpCiAgICAgICAgICAgICAgICBpZiBjbGFzc19uYW1lOgogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfaW5mby5hcHBlbmQoZiJjbGFzc19uYW1lPSd7Y2xhc3NfbmFtZX0nIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxlbWVudF9zdHIgPSAiLCAiLmpvaW4oZWxlbWVudF9pbmZvKSBpZiBlbGVtZW50X2luZm8gZWxzZSAiZWxlbWVudCIKICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyB0YXAgdGjDoG5oIGPDtG5nIHbDoG8ge2VsZW1lbnRfc3RyfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGFwIGVsZW1lbnQ6IHtyZXN1bHQuZ2V0KCdtZXNzYWdlJywgJ0tow7RuZyB4w6FjIMSR4buLbmgnKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiJM4buXaSB0cm9uZyB3YWl0X3RvX3RhcF9lbGVtZW50OiB7c3RyKGUpfSIKICAgICAgICAgICAgcHJpbnQoZXJyb3JfbXNnKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfdGV4dChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRleHQgY+G7p2EgbeG7mXQgcGjhuqduIHThu60KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoInRleHQiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NvbnRlbnRfZGVzYyhzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGNvbnRlbnQtZGVzYyBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9yZXNvdXJjZV9pZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHJlc291cmNlLWlkIGPhu6dhIG3hu5l0IHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJyZXNvdXJjZS1pZCIsICIiKQogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2xhc3Moc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBjbGFzcyBj4bunYSBt4buZdCBwaOG6p24gdOG7rQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2xhc3MiLCAiIikKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2VuYWJsZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGvDrWNoIGhv4bqhdCBraMO0bmcKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImVuYWJsZWQiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2NsaWNrYWJsZShzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgdGjhu4MgbmjhuqVwIHbDoG8ga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0KCJjbGlja2FibGUiKSA9PSAidHJ1ZSIKICAgIAogICAgZGVmIGdldF9lbGVtZW50X2ZvY3VzZWQoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIMSRxrDhu6NjIGZvY3VzIGtow7RuZwogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiZm9jdXNlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfY2hlY2tlZChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHhlbSBwaOG6p24gdOG7rSBjw7MgxJHGsOG7o2MgY2jhu41uIGtow7RuZyAoY2hvIGNoZWNrYm94KQogICAgICAgICIiIgogICAgICAgIHJldHVybiBlbGVtZW50LmdldCgiY2hlY2tlZCIpID09ICJ0cnVlIgogICAgCiAgICBkZWYgZ2V0X2VsZW1lbnRfYm91bmRzKHNlbGYsIGVsZW1lbnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBUdXBsZVtpbnQsIGludCwgaW50LCBpbnRdOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHThu41hIMSR4buZIGJvdW5kcyBj4bunYSBwaOG6p24gdOG7rSBkxrDhu5tpIGThuqFuZyB0dXBsZSAoeDEsIHkxLCB4MiwgeTIpCiAgICAgICAgWOG7rSBsw70gY8OhYyB0csaw4budbmcgaOG7o3AgYm91bmRzIGtow7RuZyBo4bujcCBs4buHICjDom0sIDAsIGhv4bq3YyBmb3JtYXQgc2FpKQogICAgICAgICIiIgogICAgICAgIGJvdW5kcyA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiWzAsMF1bMCwwXSIpCiAgICAgICAgCiAgICAgICAgIyBUaOG7rSBjw6FjIHBhdHRlcm4ga2jDoWMgbmhhdSDEkeG7gyBwYXJzZSBib3VuZHMKICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgciJcWygtP1xkKyksKC0/XGQrKVxdXFsoLT9cZCspLCgtP1xkKylcXSIsICAjIFBhdHRlcm4gaGnhu4duIHThuqFpLCBjaG8gcGjDqXAgc+G7kSDDom0KICAgICAgICAgICAgciIoLT9cZCspLCgtP1xkKyksKC0/XGQrKSwoLT9cZCspIiwgICAgICAgICAjIFBhdHRlcm46IHgxLHkxLHgyLHkyCiAgICAgICAgICAgIHIiXFsoLT9cZCspOygtP1xkKylcXVxbKC0/XGQrKTsoLT9cZCspXF0iICAgIyBQYXR0ZXJuIHbhu5tpIGThuqV1IDsKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUubWF0Y2gocGF0dGVybiwgYm91bmRzKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIHgxLCB5MSwgeDIsIHkyID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU+G7rWEgY2jhu69hIGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hwogICAgICAgICAgICAgICAgIyBO4bq/dSBjw7MgdOG7jWEgxJHhu5kgw6JtLCDEkWnhu4F1IGNo4buJbmgKICAgICAgICAgICAgICAgIGlmIHkxIDwgMCBvciB5MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogQm91bmRzIGPDsyB04buNYSDEkeG7mSB5IMOibTogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgICAgICAjIE7hur91IHkyIMOibSwgY8OzIHRo4buDIGVsZW1lbnQgbuG6sW0gdHLDqm4gdGhhbmggc3RhdHVzIGJhcgogICAgICAgICAgICAgICAgICAgIGlmIHkyIDwgMDoKICAgICAgICAgICAgICAgICAgICAgICAgIyDEkGnhu4F1IGNo4buJbmggxJHhu4MgZWxlbWVudCBjw7MgdGjhu4MgdGFwIMSRxrDhu6NjCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGFicyh5MiAtIHkxKSAgIyBDaGnhu4F1IGNhbyBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gbWF4KDAsIHkxKSAgIyDEkOG6o20gYuG6o28geTEgPj0gMAogICAgICAgICAgICAgICAgICAgICAgICB5MiA9IHkxICsgaGVpZ2h0ICAjIMSQ4bq3dCB5MiBkxrDGoW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYixJDDoyDEkWnhu4F1IGNo4buJbmggYm91bmRzIHRow6BuaDogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgeDEgPCAwIG9yIHgyIDwgMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBCb3VuZHMgY8OzIHThu41hIMSR4buZIHggw6JtOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgICAgICMgVMawxqFuZyB04buxIHbhu5tpIHgKICAgICAgICAgICAgICAgICAgICBpZiB4MiA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gYWJzKHgyIC0geDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gbWF4KDAsIHgxKQogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHgxICsgd2lkdGgKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIMSRaeG7gXUgY2jhu4luaCBib3VuZHMgdGjDoG5oOiAoe3gxfSwge3kxfSwge3gyfSwge3kyfSkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgYm91bmRzIGjhu6NwIGzhu4cgc2F1IGtoaSDEkWnhu4F1IGNo4buJbmgKICAgICAgICAgICAgICAgIGlmIHgxIDwgeDIgYW5kIHkxIDwgeTIgYW5kIG5vdCAoeDEgPT0gMCBhbmQgeTEgPT0gMCBhbmQgeDIgPT0gMCBhbmQgeTIgPT0gMCk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh4MSwgeTEsIHgyLCB5MikKICAgICAgICAKICAgICAgICAjIE7hur91IGtow7RuZyBwYXJzZSDEkcaw4bujYyBob+G6t2MgdOG6pXQgY+G6oyBsw6AgMCwgdGjhu60gbOG6pXkgdOG7qyB0aHXhu5ljIHTDrW5oIGtow6FjCiAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogS2jDtG5nIHRo4buDIHBhcnNlIGJvdW5kcyAne2JvdW5kc30nIGPhu6dhIGVsZW1lbnQsIHRo4butIHBoxrDGoW5nIHBow6FwIGtow6FjLi4uIikKICAgICAgICAKICAgICAgICAjIFRo4butIGzhuqV5IHThu6sgY8OhYyB0aHXhu5ljIHTDrW5oIGtow6FjIG7hur91IGPDswogICAgICAgIHggPSBlbGVtZW50LmdldCgieCIsIDApCiAgICAgICAgeSA9IGVsZW1lbnQuZ2V0KCJ5IiwgMCkKICAgICAgICB3aWR0aCA9IGVsZW1lbnQuZ2V0KCJ3aWR0aCIsIDEwMCkgICMgRGVmYXVsdCB3aWR0aAogICAgICAgIGhlaWdodCA9IGVsZW1lbnQuZ2V0KCJoZWlnaHQiLCA1MCkgICMgRGVmYXVsdCBoZWlnaHQKICAgICAgICAKICAgICAgICBpZiB4IG9yIHkgb3Igd2lkdGggIT0gMTAwIG9yIGhlaWdodCAhPSA1MDogICMgQ8OzIMOtdCBuaOG6pXQgbeG7mXQgdGh14buZYyB0w61uaCBraMOhYyAwL2RlZmF1bHQKICAgICAgICAgICAgcmV0dXJuICh4LCB5LCB4ICsgd2lkdGgsIHkgKyBoZWlnaHQpCiAgICAgICAgCiAgICAgICAgcHJpbnQoZiJD4bqjbmggYsOhbzogRWxlbWVudCBib3VuZHMga2jDtG5nIGjhu6NwIGzhu4csIHPhu60gZOG7pW5nIHThu41hIMSR4buZIG3hurdjIMSR4buLbmgiKQogICAgICAgIHJldHVybiAoMCwgMCwgMTAwLCA1MCkgICMgRmFsbGJhY2sgYm91bmRzIG5o4buPCiAgICAKICAgIGRlZiBnZXRfZWxlbWVudF9jZW50ZXIoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IFR1cGxlW2ludCwgaW50XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB04buNYSDEkeG7mSB0cnVuZyB0w6JtIGPhu6dhIHBo4bqnbiB04butIHbhu5tpIHjhu60gbMO9IGzhu5dpIG7Dom5nIGNhbwogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICBwcmludCgiQ+G6o25oIGLDoW86IEVsZW1lbnQgbMOgIE5vbmUgaG/hurdjIHLhu5duZyIpCiAgICAgICAgICAgIHJldHVybiAoMCwgMCkKICAgICAgICAgICAgCiAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyhlbGVtZW50KQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBib3VuZHMgaOG7o3AgbOG7hwogICAgICAgIGlmIHgxID49IHgyIG9yIHkxID49IHkyOgogICAgICAgICAgICBib3VuZHNfc3RyID0gZWxlbWVudC5nZXQoImJvdW5kcyIsICIiKQogICAgICAgICAgICBwcmludChmIkPhuqNuaCBiw6FvOiBCb3VuZHMga2jDtG5nIGjhu6NwIGzhu4cgJ3tib3VuZHNfc3RyfSc6ICh7eDF9LCB7eTF9LCB7eDJ9LCB7eTJ9KSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGJvdW5kcyBraMO0bmcgaOG7o3AgbOG7hywgdHLhuqMgduG7gSB04buNYSDEkeG7mSBhbiB0b8OgbiDhu58gZ2nhu69hIG3DoG4gaMOsbmgKICAgICAgICAgICAgc2NyZWVuX3dpZHRoLCBzY3JlZW5faGVpZ2h0ID0gc2VsZi5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgICAgICBpZiBzY3JlZW5fd2lkdGggPiAwIGFuZCBzY3JlZW5faGVpZ2h0ID4gMDoKICAgICAgICAgICAgICAgIGNlbnRlcl94ID0gc2NyZWVuX3dpZHRoIC8vIDIKICAgICAgICAgICAgICAgIGNlbnRlcl95ID0gc2NyZWVuX2hlaWdodCAvLyAyCiAgICAgICAgICAgICAgICByZXR1cm4gKGNlbnRlcl94LCBjZW50ZXJfeSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiAoNTQwLCA5NjApICAjIFThu41hIMSR4buZIG3hurdjIMSR4buLbmggY2hvIG3DoG4gaMOsbmggMTA4MHgxOTIwCiAgICAgICAgCiAgICAgICAgY2VudGVyX3ggPSAoeDEgKyB4MikgLy8gMgogICAgICAgIGNlbnRlcl95ID0gKHkxICsgeTIpIC8vIDIKICAgICAgICAKICAgICAgICAjIFRow6ptIG3hu5l0IGNow7p0IHJhbmRvbSDEkeG7gyB0csOhbmggZGV0ZWN0aW9uICjCsTMgcGl4ZWxzKQogICAgICAgIGNlbnRlcl94ICs9IHJhbmRvbS5yYW5kaW50KC0zLCAzKQogICAgICAgIGNlbnRlcl95ICs9IHJhbmRvbS5yYW5kaW50KC0zLCAzKQogICAgICAgIAogICAgICAgICMgxJDhuqNtIGLhuqNvIHThu41hIMSR4buZIHRyb25nIHBo4bqhbSB2aSBtw6BuIGjDrG5oCiAgICAgICAgc2NyZWVuX3dpZHRoLCBzY3JlZW5faGVpZ2h0ID0gc2VsZi5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgIGlmIHNjcmVlbl93aWR0aCA+IDAgYW5kIHNjcmVlbl9oZWlnaHQgPiAwOgogICAgICAgICAgICBjZW50ZXJfeCA9IG1heCgxMCwgbWluKGNlbnRlcl94LCBzY3JlZW5fd2lkdGggLSAxMCkpICAjIE1hcmdpbiAxMHB4IHThu6sgYmnDqm4KICAgICAgICAgICAgY2VudGVyX3kgPSBtYXgoMTAsIG1pbihjZW50ZXJfeSwgc2NyZWVuX2hlaWdodCAtIDEwKSkKICAgICAgICAKICAgICAgICByZXR1cm4gKGNlbnRlcl94LCBjZW50ZXJfeSkKICAgIAogICAgZGVmIHRhcF9lbGVtZW50X2NlbnRlcihzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhuqFtIHbDoG8gcGjhuqduIHThu60gduG7m2kgdMOtbmggcmFuZG9tIChz4butIGThu6VuZyB0YXBfZWxlbWVudCBiw6puIHRyb25nKQogICAgICAgIE7hur91IGVsZW1lbnQgcXXDoSBuaOG7jyB0aMOsIG3hu5tpIGTDuW5nIGNlbnRlciwgbmfGsOG7o2MgbOG6oWkgc+G6vSB0YXAgcmFuZG9tCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IGVsZW1lbnQ6CiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIkVsZW1lbnQgbMOgIE5vbmUgaG/hurdjIHLhu5duZyJ9CiAgICAgICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHZpc2libGUtdG8tdXNlciB0csaw4bubYwogICAgICAgICAgICB2aXNpYmxlID0gZWxlbWVudC5nZXQoInZpc2libGUtdG8tdXNlciIsICJ0cnVlIikKICAgICAgICAgICAgaWYgdmlzaWJsZSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgcHJpbnQoIkPhuqNuaCBiw6FvOiBFbGVtZW50IGPDsyB2aXNpYmxlLXRvLXVzZXI9J2ZhbHNlJywgduG6q24gdGjhu60gdGFwLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgYm91bmRzIGPhu6dhIGVsZW1lbnQgxJHhu4Mga2nhu4NtIHRyYSBrw61jaCB0aMaw4bubYwogICAgICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IHNlbGYuZ2V0X2VsZW1lbnRfYm91bmRzKGVsZW1lbnQpCiAgICAgICAgICAgIHdpZHRoID0geDIgLSB4MQogICAgICAgICAgICBoZWlnaHQgPSB5MiAtIHkxCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE7hur91IGVsZW1lbnQgcXXDoSBuaOG7jyAoPCAyMHB4IHdpZHRoIGhv4bq3YyBoZWlnaHQpLCBkw7luZyBjZW50ZXIKICAgICAgICAgICAgaWYgd2lkdGggPCAyMCBvciBoZWlnaHQgPCAyMDoKICAgICAgICAgICAgICAgIHByaW50KGYiRWxlbWVudCBuaOG7jyAoe3dpZHRofXh7aGVpZ2h0fXB4KSwgc+G7rSBk4bulbmcgdGFwIGNlbnRlciIpCiAgICAgICAgICAgICAgICB4LCB5ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHThu41hIMSR4buZIGjhu6NwIGzhu4cKICAgICAgICAgICAgICAgIGlmIHggPD0gMCBhbmQgeSA8PSAwOgogICAgICAgICAgICAgICAgICAgIGJvdW5kc19zdHIgPSBlbGVtZW50LmdldCgiYm91bmRzIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgaWYgYm91bmRzX3N0ciBhbmQgYm91bmRzX3N0ciAhPSAiWzAsMF1bMCwwXSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnRhcF9lbGVtZW50KGJvdW5kc19zdHIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiAiS2jDtG5nIHRo4buDIHjDoWMgxJHhu4tuaCB04buNYSDEkeG7mSDEkeG7gyB0YXAifQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi50YXAoeCwgeSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRWxlbWVudCDEkeG7pyBs4bubbiwgc+G7rSBk4bulbmcgdGFwX2VsZW1lbnQgxJHhu4MgdGFwIHJhbmRvbQogICAgICAgICAgICAgICAgIyBwcmludChmIkVsZW1lbnQgxJHhu6cgbOG7m24gKHt3aWR0aH14e2hlaWdodH1weCksIHPhu60gZOG7pW5nIHRhcCByYW5kb20iKSAgIyBC4buPIGxvZyBuw6B5CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi50YXBfZWxlbWVudChlbGVtZW50KQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6IGYiTOG7l2kga2hpIHRhcCBlbGVtZW50OiB7c3RyKGUpfSJ9CiAgICAKICAgIGRlZiBsb25nX3ByZXNzKHNlbGYsIHg6IGludCwgeTogaW50LCBkdXJhdGlvbjogaW50ID0gMTAwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTmjhuqVuIGdp4buvIHThuqFpIHbhu4sgdHLDrSB4LHkgdHJvbmcgbeG7mXQga2hv4bqjbmcgdGjhu51pIGdpYW4KICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICJ4IjogeCwKICAgICAgICAgICAgInkiOiB5LAogICAgICAgICAgICAiZHVyYXRpb24iOiBkdXJhdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJsb25nX3ByZXNzIiwgcGFyYW1zPXBhcmFtcykKICAgIAogICAgZGVmIGxvbmdfcHJlc3NfZWxlbWVudChzZWxmLCBlbGVtZW50OiBEaWN0W3N0ciwgQW55XSwgZHVyYXRpb246IGludCA9IDEwMDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBnaeG7ryB04bqhaSB0cnVuZyB0w6JtIGPhu6dhIHBo4bqnbiB04butCiAgICAgICAgIiIiCiAgICAgICAgeCwgeSA9IHNlbGYuZ2V0X2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICAgICAgcmV0dXJuIHNlbGYubG9uZ19wcmVzcyh4LCB5LCBkdXJhdGlvbikKICAgIAogICAgZGVmIHN3aXBlKHNlbGYsIHN0YXJ0X3g6IGludCwgc3RhcnRfeTogaW50LCBlbmRfeDogaW50LCBlbmRfeTogaW50LCAKICAgICAgICAgICAgIGR1cmF0aW9uOiBpbnQgPSA1MDApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFZ14buRdCB04burIMSRaeG7g20gKHN0YXJ0X3gsIHN0YXJ0X3kpIMSR4bq/biDEkWnhu4NtIChlbmRfeCwgZW5kX3kpCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAic3RhcnRfeCI6IHN0YXJ0X3gsCiAgICAgICAgICAgICJzdGFydF95Ijogc3RhcnRfeSwKICAgICAgICAgICAgImVuZF94IjogZW5kX3gsCiAgICAgICAgICAgICJlbmRfeSI6IGVuZF95LAogICAgICAgICAgICAiZHVyYXRpb24iOiBkdXJhdGlvbgogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJzd2lwZSIsIHBhcmFtcz1wYXJhbXMpCiAgICAKICAgIGRlZiBzd2lwZV9iZXR3ZWVuX2VsZW1lbnRzKHNlbGYsIHN0YXJ0X2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kX2VsZW1lbnQ6IERpY3Rbc3RyLCBBbnldLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IGludCA9IDUwMCkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHThu6sgcGjhuqduIHThu60gc3RhcnRfZWxlbWVudCDEkeG6v24gcGjhuqduIHThu60gZW5kX2VsZW1lbnQKICAgICAgICAiIiIKICAgICAgICBzdGFydF94LCBzdGFydF95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoc3RhcnRfZWxlbWVudCkKICAgICAgICBlbmRfeCwgZW5kX3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcihlbmRfZWxlbWVudCkKICAgICAgICByZXR1cm4gc2VsZi5zd2lwZShzdGFydF94LCBzdGFydF95LCBlbmRfeCwgZW5kX3ksIGR1cmF0aW9uKQogICAgCiAgICBkZWYgd2FpdF9mb3JfZWxlbWVudF90b19kaXNhcHBlYXIoc2VsZiwgdGV4dDogc3RyID0gTm9uZSwgY29udGVudF9kZXNjOiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsIHRpbWVvdXQ6IGludCA9IDMwLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfaW50ZXJ2YWw6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIG3hu5l0IHBo4bqnbiB04butIGJp4bq/biBt4bqldCBraOG7j2kgbcOgbiBow6xuaAogICAgICAgICIiIgogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6CiAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmZpbmRfZWxlbWVudCh0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkKQogICAgICAgICAgICBpZiBub3QgZWxlbWVudDoKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdGltZS5zbGVlcChjaGVja19pbnRlcnZhbCkKICAgICAgICAKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHdhaXRfZm9yX2FueV9lbGVtZW50KHNlbGYsIGVsZW1lbnRzX3RvX2ZpbmQ6IExpc3RbRGljdFtzdHIsIHN0cl1dLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogaW50ID0gMzAsIGNoZWNrX2ludGVydmFsOiBpbnQgPSAxKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgQ2jhu50gxJHhu6NpIGNobyDEkeG6v24ga2hpIGLhuqV0IGvhu7MgcGjhuqduIHThu60gbsOgbyB0cm9uZyBkYW5oIHPDoWNoIHh14bqldCBoaeG7h24KICAgICAgICAKICAgICAgICBlbGVtZW50c190b19maW5kIGzDoCBkYW5oIHPDoWNoIGPDoWMgZGljdCB24bubaSBjw6FjIGtow7NhOiB0ZXh0LCBjb250ZW50X2Rlc2MsIHJlc291cmNlX2lkCiAgICAgICAgIiIiCiAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgLSBzdGFydF90aW1lIDwgdGltZW91dDoKICAgICAgICAgICAgZm9yIGVsZW1lbnRfY3JpdGVyaWEgaW4gZWxlbWVudHNfdG9fZmluZDoKICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBzZWxmLmZpbmRfZWxlbWVudCgKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2NyaXRlcmlhLmdldCgidGV4dCIpLCAKICAgICAgICAgICAgICAgICAgICBlbGVtZW50X2NyaXRlcmlhLmdldCgiY29udGVudF9kZXNjIiksIAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfY3JpdGVyaWEuZ2V0KCJyZXNvdXJjZV9pZCIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiBlbGVtZW50OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdGltZS5zbGVlcChjaGVja19pbnRlcnZhbCkKICAgICAgICAKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZ2V0X3NjcmVlbl9zaXplKHNlbGYpIC0+IFR1cGxlW2ludCwgaW50XToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBrw61jaCB0aMaw4bubYyBtw6BuIGjDrG5oICh3aWR0aCwgaGVpZ2h0KQogICAgICAgICIiIgogICAgICAgIGRldmljZV9pbmZvID0gc2VsZi5nZXRfZGV2aWNlX2luZm8oKQogICAgICAgIGlmIGRldmljZV9pbmZvWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgIHJldHVybiAoZGV2aWNlX2luZm9bImRhdGEiXVsic2NyZWVuX3dpZHRoIl0sIGRldmljZV9pbmZvWyJkYXRhIl1bInNjcmVlbl9oZWlnaHQiXSkKICAgICAgICByZXR1cm4gKDAsIDApCiAgICAKICAgIGRlZiB0YWtlX3NjcmVlbnNob3Qoc2VsZiwgZmlsZV9wYXRoOiBzdHIgPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDaOG7pXAg4bqjbmggbcOgbiBow6xuaCB2w6AgbMawdSB2w6BvIGZpbGVfcGF0aCAobuG6v3UgxJHGsOG7o2MgY3VuZyBj4bqlcCkKICAgICAgICAiIiIKICAgICAgICBwYXJhbXMgPSB7fQogICAgICAgIGlmIGZpbGVfcGF0aDoKICAgICAgICAgICAgcGFyYW1zWyJmaWxlX3BhdGgiXSA9IGZpbGVfcGF0aAogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInNjcmVlbnNob3QiLCBwYXJhbXM9cGFyYW1zKQogICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfYWN0aXZpdHkoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHTDqm4gYWN0aXZpdHkgaGnhu4duIHThuqFpCiAgICAgICAgIiIiCiAgICAgICAgZGV2aWNlX2luZm8gPSBzZWxmLmdldF9kZXZpY2VfaW5mbygpCiAgICAgICAgaWYgZGV2aWNlX2luZm9bInN0YXR1cyJdID09ICJzdWNjZXNzIiBhbmQgImN1cnJlbnRfYWN0aXZpdHkiIGluIGRldmljZV9pbmZvWyJkYXRhIl06CiAgICAgICAgICAgIHJldHVybiBkZXZpY2VfaW5mb1siZGF0YSJdWyJjdXJyZW50X2FjdGl2aXR5Il0KICAgICAgICByZXR1cm4gIiIKICAgIAogICAgZGVmIGdldF9jdXJyZW50X3BhY2thZ2Uoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHTDqm4gcGFja2FnZSBoaeG7h24gdOG6oWkKICAgICAgICAiIiIKICAgICAgICByZXNwb25zZSA9IHNlbGYuX21ha2VfcmVxdWVzdCgiY3VycmVudC1wYWNrYWdlIikKICAgICAgICBpZiByZXNwb25zZS5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIHJlc3BvbnNlOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbImRhdGEiXS5nZXQoInBhY2thZ2UiLCAiIikKICAgICAgICByZXR1cm4gIiIKICAgIAogICAgZGVmIHByZXNzX2VudGVyKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IEVudGVyCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfZW50ZXIiKQogICAgCiAgICBkZWYgcHJlc3NfYmFjayhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBOaOG6pW4gbsO6dCBCYWNrCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfYmFjayIpCiAgICAKICAgIGRlZiBwcmVzc19ob21lKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IEhvbWUKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJwcmVzc19ob21lIikKICAgIAogICAgZGVmIHByZXNzX3JlY2VudF9hcHBzKHNlbGYpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIE5o4bqlbiBuw7p0IFJlY2VudCBBcHBzCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX21ha2VfcmVxdWVzdCgicHJlc3NfcmVjZW50X2FwcHMiKQoKICAgIGRlZiBpc19hcHBfaW5zdGFsbGVkKHNlbGYsIHBhY2thZ2VfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIOG7qW5nIGThu6VuZyDEkcOjIMSRxrDhu6NjIGPDoGkgxJHhurd0IHRyw6puIHRoaeG6v3QgYuG7iyBjaMawYQogICAgICAgIMavdSB0acOqbiBz4butIGThu6VuZyBBREIgbuG6v3UgxJHDoyBr4bq/dCBu4buRaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBhY2thZ2VfbmFtZTogVMOqbiBwYWNrYWdlIGPhu6dhIOG7qW5nIGThu6VuZyBj4bqnbiBraeG7g20gdHJhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3Ug4bupbmcgZOG7pW5nIMSRw6MgY8OgaSDEkeG6t3QsIEZhbHNlIG7hur91IGNoxrBhCiAgICAgICAgIiIiCiAgICAgICAgIyDGr3UgdGnDqm4gc+G7rSBk4bulbmcgQURCIG7hur91IMSRw6Mga+G6v3QgbuG7kWkKICAgICAgICBpZiBzZWxmLmlzX2FkYl9jb25uZWN0ZWQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgdGhhbSBz4buRIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgZGV2aWNlX3BhcmFtcyA9IHNlbGYuX2dldF9hZGJfZGV2aWNlX3BhcmFtKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIOG7qW5nIGThu6VuZyBi4bqxbmcgQURCCiAgICAgICAgICAgICAgICBjbWQgPSBbImFkYiJdICsgZGV2aWNlX3BhcmFtcyArIFsic2hlbGwiLCBmInBtIGxpc3QgcGFja2FnZXMgfCBncmVwIC14IHBhY2thZ2U6e3BhY2thZ2VfbmFtZX0iXQogICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGPDsyBr4bq/dCBxdeG6oywg4bupbmcgZOG7pW5nIMSRw6MgxJHGsOG7o2MgY8OgaSDEkeG6t3QKICAgICAgICAgICAgICAgIHJldHVybiBwYWNrYWdlX25hbWUgaW4gcmVzdWx0LnN0ZG91dAogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5TdWJwcm9jZXNzRXJyb3I6CiAgICAgICAgICAgICAgICAjIE7hur91IGzhu5dpIEFEQiwgc+G7rSBk4bulbmcgQVBJIEhUVFAKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAKICAgICAgICAjIFPhu60gZOG7pW5nIEhUVFAgQVBJCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImFwcC1pbnN0YWxsZWQiLCB7InBhY2thZ2UiOiBwYWNrYWdlX25hbWV9KQogICAgICAgIGlmIHJlc3BvbnNlWyJzdGF0dXMiXSA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdLmdldCgiaW5zdGFsbGVkIiwgRmFsc2UpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgZmluZF9lbGVtZW50cyhzZWxmLCBjbGFzc19uYW1lOiBzdHIgPSBOb25lLCB0ZXh0OiBzdHIgPSBOb25lLCAKICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYzogc3RyID0gTm9uZSwgcmVzb3VyY2VfaWQ6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IGJvb2wgPSBUcnVlKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBUw6xtIHThuqV0IGPhuqMgY8OhYyBwaOG6p24gdOG7rSB0aGVvIGNsYXNzX25hbWUsIHRleHQsIGNvbnRlbnRfZGVzYywgcmVzb3VyY2VfaWQgaG/hurdjIHZpc2libGUtdG8tdXNlcgogICAgICAgIMSQw6J5IGzDoCBt4buZdCBwaMawxqFuZyB0aOG7qWMgdGnhu4duIGzhu6NpIGvhur90IGjhu6NwIGR1bXBfc2NyZWVuX3htbCB2w6AgZmluZF9hbGxfZWxlbWVudHNfaW5feG1sCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY2xhc3NfbmFtZTogQ2xhc3MgbmFtZSBj4bunYSBwaOG6p24gdOG7rSBj4bqnbiB0w6xtCiAgICAgICAgICAgIHRleHQ6IFRleHQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICBjb250ZW50X2Rlc2M6IENvbnRlbnQgZGVzY3JpcHRpb24gY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICByZXNvdXJjZV9pZDogUmVzb3VyY2UgSUQgY+G7p2EgcGjhuqduIHThu60gY+G6p24gdMOsbQogICAgICAgICAgICB2aXNpYmxlX3RvX3VzZXI6IFRydWUgxJHhu4MgdMOsbSBlbGVtZW50IGhp4buDbiB0aOG7iyB24bubaSB1c2VyICht4bq3YyDEkeG7i25oKSwgRmFsc2UgxJHhu4MgdMOsbSBlbGVtZW50IOG6qW4sIE5vbmUgxJHhu4MgYuG7jyBxdWEgxJFp4buBdSBraeG7h24gbsOgeQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBMaXN0W0RpY3Rbc3RyLCBBbnldXTogRGFuaCBzw6FjaCBjw6FjIHBo4bqnbiB04butIHTDrG0gdGjhuqV5CiAgICAgICAgIiIiCiAgICAgICAgIyBM4bqleSBYTUwgbcOgbiBow6xuaCBoaeG7h24gdOG6oWkKICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgIGlmIG5vdCBzY3JlZW5feG1sOgogICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgCiAgICAgICAgIyBT4butIGThu6VuZyBmaW5kX2FsbF9lbGVtZW50c19pbl94bWwgxJHhu4MgdMOsbSBjw6FjIHBo4bqnbiB04butCiAgICAgICAgcmV0dXJuIHNlbGYuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLCAKICAgICAgICAgICAgdGV4dD10ZXh0LCAKICAgICAgICAgICAgY29udGVudF9kZXNjPWNvbnRlbnRfZGVzYywgCiAgICAgICAgICAgIHJlc291cmNlX2lkPXJlc291cmNlX2lkLAogICAgICAgICAgICBjbGFzc19uYW1lPWNsYXNzX25hbWUsCiAgICAgICAgICAgIHZpc2libGVfdG9fdXNlcj12aXNpYmxlX3RvX3VzZXIKICAgICAgICApCgogICAgZGVmIG9wZW5fdXJsKHNlbGYsIHVybDogc3RyLCBwYWNrYWdlOiBzdHIgPSBOb25lKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBN4bufIG3hu5l0IFVSTCB0csOqbiB0aGnhur90IGLhu4suIEjhu691IMOtY2ggxJHhu4MgbeG7nyBjw6FjIGxpbmsgbeG6oW5nIHjDoyBo4buZaSB0cuG7sWMgdGnhur9wLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHVybDogVVJMIGPhuqduIG3hu58gKHbDrSBk4bulOiBodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL3VzZXJuYW1lLykKICAgICAgICAgICAgcGFja2FnZTogUGFja2FnZSBuYW1lIGPhu6dhIOG7qW5nIGThu6VuZyDEkeG7gyBt4bufIFVSTCAodMO5eSBjaOG7jW4pCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyB04burIHNlcnZlcgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBVUkwgZW5jb2RlIMSR4buDIHRyw6FuaCBs4buXaSB24bubaSBjw6FjIGvDvSB04buxIMSR4bq3YyBiaeG7h3QKICAgICAgICAgICAgIyBDaOG7iSBlbmNvZGUgcGjhuqduIHNhdSBkb21haW4gxJHhu4MgZ2nhu68gbmd1ecOqbiBwcm90b2NvbCB2w6AgZG9tYWluCiAgICAgICAgICAgIGlmICc6Ly8nIGluIHVybDoKICAgICAgICAgICAgICAgIHBhcnRzID0gdXJsLnNwbGl0KCc6Ly8nLCAxKQogICAgICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA9PSAyOgogICAgICAgICAgICAgICAgICAgIHByb3RvY29sID0gcGFydHNbMF0KICAgICAgICAgICAgICAgICAgICByZW1haW5pbmcgPSBwYXJ0c1sxXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICcvJyBpbiByZW1haW5pbmc6CiAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbl9wYXJ0cyA9IHJlbWFpbmluZy5zcGxpdCgnLycsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbiA9IGRvbWFpbl9wYXJ0c1swXQogICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gZG9tYWluX3BhcnRzWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICMgRW5jb2RlIHBhdGggcGFydCwgbmjGsG5nIGdp4buvIG5ndXnDqm4gY8OhYyBrw70gdOG7sSBhbiB0b8OgbgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3BhdGggPSBxdW90ZShwYXRoLCBzYWZlPScvQDo/I1tdISQmXCcoKSorLDs9JykKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlZF91cmwgPSBmIntwcm90b2NvbH06Ly97ZG9tYWlufS97ZW5jb2RlZF9wYXRofSIKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3VybCA9IHVybCAgIyBDaOG7iSBjw7MgZG9tYWluLCBraMO0bmcgY+G6p24gZW5jb2RlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGVuY29kZWRfdXJsID0gdXJsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEtow7RuZyBjw7MgcHJvdG9jb2wsIGVuY29kZSB0b8OgbiBi4buZCiAgICAgICAgICAgICAgICBlbmNvZGVkX3VybCA9IHF1b3RlKHVybCwgc2FmZT0nL0A6PyNbXSEkJlwnKCkqKyw7PScpCiAgICAgICAgICAgIAogICAgICAgICAgICBwYXJhbXMgPSB7InVybCI6IGVuY29kZWRfdXJsfQogICAgICAgICAgICBpZiBwYWNrYWdlOgogICAgICAgICAgICAgICAgcGFyYW1zWyJwYWNrYWdlIl0gPSBwYWNrYWdlCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoIm9wZW5fdXJsIiwgcGFyYW1zPXBhcmFtcykKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBlbmNvZGUgVVJMOiB7ZX0iKQogICAgICAgICAgICAjIEZhbGxiYWNrOiBn4butaSBVUkwgZ+G7kWMgbuG6v3UgY8OzIGzhu5dpIGVuY29kZQogICAgICAgICAgICBwYXJhbXMgPSB7InVybCI6IHVybH0KICAgICAgICAgICAgaWYgcGFja2FnZToKICAgICAgICAgICAgICAgIHBhcmFtc1sicGFja2FnZSJdID0gcGFja2FnZQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJvcGVuX3VybCIsIHBhcmFtcz1wYXJhbXMpCgogICAgZGVmIGdldF9jbGlwYm9hcmQoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IG7hu5lpIGR1bmcgY2xpcGJvYXJkIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgc3RyOiBO4buZaSBkdW5nIGNsaXBib2FyZCBob+G6t2MgY2h14buXaSBy4buXbmcgbuG6v3Uga2jDtG5nIGPDsyBu4buZaSBkdW5nCiAgICAgICAgIiIiCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImNsaXBib2FyZCIpCiAgICAgICAgaWYgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSAic3VjY2VzcyIgYW5kIHJlc3BvbnNlLmdldCgiZGF0YSIsIHt9KS5nZXQoImhhc19jb250ZW50Iik6CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsiZGF0YSJdWyJjbGlwYm9hcmRfdGV4dCJdCiAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIHN3aXBlX2xlZnQoc2VsZikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVnXhu5F0IHNhbmcgdHLDoWkgKHThu5FpIMawdSBjaG8gbmfDs24gY8OhaSB0YXkgcGjhuqNpKQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX2xlZnQiKQoKICAgIGRlZiBzd2lwZV9yaWdodChzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBWdeG7kXQgc2FuZyBwaOG6o2kgKHThu5FpIMawdSBjaG8gbmfDs24gY8OhaSB0YXkgcGjhuqNpKQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYWtlX3JlcXVlc3QoInN3aXBlX3JpZ2h0IikKCiAgICBkZWYgaXNfaW5zdGFsbGVkKHNlbGYsIHBhY2thZ2U6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIGPDsyDEkcaw4bujYyBjw6BpIMSR4bq3dCBoYXkga2jDtG5nIChkw7luZyBBUEkgbeG7m2kpCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGFja2FnZTogVMOqbiBwYWNrYWdlIGPhu6dhIOG7qW5nIGThu6VuZwogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGRpY3Q6IEvhur90IHF14bqjIGtp4buDbSB0cmEKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fbWFrZV9yZXF1ZXN0KCJpc19pbnN0YWxsZWQiLCBwYXJhbXM9eyJwYWNrYWdlIjogcGFja2FnZX0pCgogICAgZGVmIHNldHVwX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBjaG8gcGhpw6puIGzDoG0gdmnhu4djCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSB24bubaSBjw6FjIHRyxrDhu51uZzoKICAgICAgICAgICAgICAgIC0gaWQ6IElEIGPhu6dhIHByb3h5CiAgICAgICAgICAgICAgICAtIHR5cGU6IExv4bqhaSBwcm94eSAocHBvZSwgaHR0cCwgc29ja3M1LCBldGMuKQogICAgICAgICAgICAgICAgLSBob3N0OiDEkOG7i2EgY2jhu4kgc2VydmVyIHByb3h5CiAgICAgICAgICAgICAgICAtIHBvcnQ6IFBvcnQgY+G7p2EgcHJveHkKICAgICAgICAgICAgICAgIC0gdXNlcm5hbWU6IFVzZXJuYW1lIChu4bq/dSBjw7MpCiAgICAgICAgICAgICAgICAtIHBhc3N3b3JkOiBQYXNzd29yZCAobuG6v3UgY8OzKQogICAgICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aGnhur90IGzhuq1wIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcm94eV90eXBlID0gcHJveHlfY29uZmlnLmdldCgidHlwZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcHJveHlfdHlwZSA9PSAicHBvZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fc2V0dXBfcHBvZV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSBpbiBbImh0dHAiLCAiaHR0cHMiXToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZXR1cF9odHRwX3Byb3h5KHByb3h5X2NvbmZpZykKICAgICAgICAgICAgZWxpZiBwcm94eV90eXBlID09ICJzb2NrczUiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NldHVwX3NvY2tzNV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIkxv4bqhaSBwcm94eSBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7ozoge3Byb3h5X3R5cGV9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB0aGnhur90IGzhuq1wIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3NldHVwX3Bwb2VfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaGnhur90IGzhuq1wIHByb3h5IFBQUG9FCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBQUFBvRQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBob3N0ID0gcHJveHlfY29uZmlnLmdldCgic2VydmVyX2lwIikKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJwcm94eV9pZCIpCiAgICAgICAgICAgIHByb3h5X25hbWUgPSBwcm94eV9jb25maWcuZ2V0KCJuYW1lIikKICAgICAgICAgICAgaWYgbm90IGhvc3Q6CiAgICAgICAgICAgICAgICBwcmludCgiVGhp4bq/dSB0aMO0bmcgdGluIGhvc3QgY2hvIHByb3h5IFBQUG9FIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJIHJlZ2lzdGVyIHRyxrDhu5tjCiAgICAgICAgICAgIHJlZ2lzdGVyX3VybCA9IGYiaHR0cDovL3tob3N0fS9yZWdpc3RlciIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBkZXZpY2UgaW5mbwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgbG9jYWxfaXAgPSAiIgogICAgICAgICAgICBpZiBkZXZpY2VfaW5mby5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9jYWxfaXAgPSBkZXZpY2VfaW5mb1siZGF0YSJdLmdldCgibG9jYWxfaXAiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlZ2lzdGVyX2RhdGEgPSB7Im5hbWUiOiBwcm94eV9uYW1lfQogICAgICAgICAgICAgICAgaWYgbG9jYWxfaXA6CiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJfZGF0YVsibG9jYWxfaXAiXSA9IGxvY2FsX2lwCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZWdpc3Rlcl9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJfdXJsLCAKICAgICAgICAgICAgICAgICAgICBqc29uPXJlZ2lzdGVyX2RhdGEsIAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9LCAKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiByZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIMSRxINuZyBrw70gdGjDoG5oIGPDtG5nIHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge2hvc3R9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgxJHEg25nIGvDvSB24bubaSBwcm94eSBQUFBvRSBzZXJ2ZXI6IHtyZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJLaMO0bmcgdGjhu4Mga+G6v3QgbuG7kWkgxJHhur9uIHByb3h5IFBQUG9FIHNlcnZlciB7aG9zdH06IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlc2V0IElQIHByb3h5CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNldF9wcm94eV9pcChwcm94eV9jb25maWcpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eSBQUFBvRToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF9zZXR1cF9odHRwX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVGhp4bq/dCBs4bqtcCBwcm94eSBIVFRQL0hUVFBTCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBIVFRQCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhu5FpIHbhu5tpIEhUVFAgcHJveHksIGNo4buJIGPhuqduIHJlc2V0IElQCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNldF9wcm94eV9pcChwcm94eV9jb25maWcpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgdGhp4bq/dCBs4bqtcCBwcm94eSBIVFRQOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3NldHVwX3NvY2tzNV9wcm94eShzZWxmLCBwcm94eV9jb25maWc6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgU09DS1M1CiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBTT0NLUzUKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG7kWkgduG7m2kgU09DS1M1IHByb3h5LCBjaOG7iSBj4bqnbiByZXNldCBJUAogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHRoaeG6v3QgbOG6rXAgcHJveHkgU09DS1M1OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3Jlc2V0X3Byb3h5X2lwKHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUmVzZXQgSVAgcHJveHkgKGxvZ2ljIGPFqSDEkcaw4bujYyBjaHV54buDbiB2w6BvIMSRw6J5KQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBMb2dpYyByZXNldCBJUCBwcm94eSBz4bq9IMSRxrDhu6NjIGltcGxlbWVudCB0w7l5IHRoZW8gbG/huqFpIHByb3h5CiAgICAgICAgICAgICMgSGnhu4duIHThuqFpIHJldHVybiBUcnVlIMSR4buDIGtow7RuZyBibG9jayB3b3JrZmxvdwogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgcHJveHlfdHlwZSA9IHByb3h5X2NvbmZpZy5nZXQoInR5cGUiLCAidW5rbm93biIpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChmIlJlc2V0IElQIGNobyBwcm94eSB7cHJveHlfaWR9ICh0eXBlOiB7cHJveHlfdHlwZX0pIikKICAgICAgICAgICAgIyBLaeG7g20gdHJhIG7hur91IGPDsyB0aMO0bmcgdGluIHJlc2V0IElQCiAgICAgICAgICAgIHJlc2V0X2lwX2xpbmsgPSBwcm94eV9jb25maWcuZ2V0KCJsaW5rX3Jlc2V0X2lwIikKICAgICAgICAgICAgcHBvZV9uYW1lID0gcHJveHlfY29uZmlnLmdldCgicHBvZV9uYW1lIikKCiAgICAgICAgICAgIGlmIHJlc2V0X2lwX2xpbmsgYW5kIHBwb2VfbmFtZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIEfhu61pIFBPU1QgcmVxdWVzdCDEkeG7gyByZXNldCBJUAogICAgICAgICAgICAgICAgICAgIHJlc2V0X2RhdGEgPSB7InBwb2VfbmFtZSI6IHBwb2VfbmFtZX0KICAgICAgICAgICAgICAgICAgICByZXNldF9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0X2lwX2xpbmssIAogICAgICAgICAgICAgICAgICAgICAgICBqc29uPXJlc2V0X2RhdGEsIAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzZXRfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIsSQw6MgcmVzZXQgSVAgdGjDoG5oIGPDtG5nIGNobyBwcm94eSB7cHBvZV9uYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgcmVzZXQgSVA6IEhUVFAge3Jlc2V0X3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgZ+G7rWkgcmVxdWVzdCByZXNldCBJUDoge2V9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJUaGnhur91IHRow7RuZyB0aW4gbGlua19yZXNldF9pcCBob+G6t2MgcHJveHlfbmFtZSIpCiAgICAgICAgICAgICMgVE9ETzogSW1wbGVtZW50IGxvZ2ljIHJlc2V0IElQIGPhu6UgdGjhu4MgY2hvIHThu6tuZyBsb+G6oWkgcHJveHkKICAgICAgICAgICAgIyBWw60gZOG7pTogZ+G7jWkgQVBJIHJlc2V0IElQLCBob+G6t2MgdGjhu7FjIGhp4buHbiBjw6FjIGzhu4duaCBj4bqnbiB0aGnhur90CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIHJlc2V0IElQIHByb3h5OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgcmVzZXRfcHJveHlfaXAoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBQaMawxqFuZyB0aOG7qWMgcHVibGljIMSR4buDIHJlc2V0IElQIHByb3h5ICjEkeG7gyB0xrDGoW5nIHRow61jaCB24bubaSBjb2RlIGPFqSkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fcmVzZXRfcHJveHlfaXAocHJveHlfY29uZmlnKQoKICAgIGRlZiB1bnJlZ2lzdGVyX3Byb3h5KHNlbGYsIHByb3h5X2NvbmZpZzogRGljdFtzdHIsIEFueV0gPSBOb25lKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEjhu6d5IMSRxINuZyBrw70gcHJveHkgc2F1IGtoaSBz4butIGThu6VuZyB4b25nCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSAodMO5eSBjaOG7jW4sIGPDsyB0aOG7gyBs4bqleSB04burIGRhdGFiYXNlIG7hur91IGtow7RuZyB0cnV54buBbikKICAgICAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgaOG7p3kgxJHEg25nIGvDvSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdHJ1eeG7gW4gcHJveHlfY29uZmlnLCBjw7MgdGjhu4MgbOG6pXkgdOG7qyBkYXRhYmFzZSBob+G6t2MgY29udGV4dCBoaeG7h24gdOG6oWkKICAgICAgICAgICAgaWYgbm90IHByb3h5X2NvbmZpZzoKICAgICAgICAgICAgICAgIHByaW50KCJLaMO0bmcgY8OzIHByb3h5IGNvbmZpZyDEkeG7gyB1bnJlZ2lzdGVyIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlICAjIENvaSBuaMawIHRow6BuaCBjw7RuZyBu4bq/dSBraMO0bmcgY8OzIGfDrCDEkeG7gyB1bnJlZ2lzdGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcHJveHlfdHlwZSA9IHByb3h5X2NvbmZpZy5nZXQoInR5cGUiLCAiIikubG93ZXIoKQogICAgICAgICAgICBwcm94eV9pZCA9IHByb3h5X2NvbmZpZy5nZXQoImlkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHByb3h5X3R5cGUgPT0gInBwb2UiOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3VucmVnaXN0ZXJfcHBvZV9wcm94eShwcm94eV9jb25maWcpCiAgICAgICAgICAgIGVsaWYgcHJveHlfdHlwZSBpbiBbImh0dHAiLCAiaHR0cHMiXToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl91bnJlZ2lzdGVyX2h0dHBfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbGlmIHByb3h5X3R5cGUgPT0gInNvY2tzNSI6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdW5yZWdpc3Rlcl9zb2NrczVfcHJveHkocHJveHlfY29uZmlnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJMb+G6oWkgcHJveHkga2jDtG5nIGPhuqduIHVucmVnaXN0ZXIgaG/hurdjIGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujOiB7cHJveHlfdHlwZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF91bnJlZ2lzdGVyX3Bwb2VfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IFBQUG9FCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJveHlfY29uZmlnOiBD4bqldSBow6xuaCBwcm94eSBQUFBvRQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBob3N0ID0gcHJveHlfY29uZmlnLmdldCgic2VydmVyX2lwIikKICAgICAgICAgICAgcHJveHlfaWQgPSBwcm94eV9jb25maWcuZ2V0KCJwcm94eV9pZCIpCiAgICAgICAgICAgIHByb3h5X25hbWUgPSBwcm94eV9jb25maWcuZ2V0KCJuYW1lIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBob3N0OgogICAgICAgICAgICAgICAgcHJpbnQoIlRoaeG6v3UgdGjDtG5nIHRpbiBob3N0IGNobyBwcm94eSBQUFBvRSwgYuG7jyBxdWEgdW5yZWdpc3RlciIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJIHVucmVnaXN0ZXIKICAgICAgICAgICAgdW5yZWdpc3Rlcl91cmwgPSBmImh0dHA6Ly97aG9zdH0vdW5yZWdpc3RlciIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgbG9jYWwgSVAgdOG7qyBkZXZpY2UgaW5mbwogICAgICAgICAgICBkZXZpY2VfaW5mbyA9IHNlbGYuZ2V0X2RldmljZV9pbmZvKCkKICAgICAgICAgICAgbG9jYWxfaXAgPSAiIgogICAgICAgICAgICBpZiBkZXZpY2VfaW5mby5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIiBhbmQgImRhdGEiIGluIGRldmljZV9pbmZvOgogICAgICAgICAgICAgICAgbG9jYWxfaXAgPSBkZXZpY2VfaW5mb1siZGF0YSJdLmdldCgibG9jYWxfaXAiLCAiIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJfZGF0YSA9IHsibmFtZSI6IHByb3h5X25hbWV9CiAgICAgICAgICAgICAgICBpZiBsb2NhbF9pcDoKICAgICAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyX2RhdGFbImxvY2FsX2lwIl0gPSBsb2NhbF9pcAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgdW5yZWdpc3Rlcl91cmwsIAogICAgICAgICAgICAgICAgICAgIGpzb249dW5yZWdpc3Rlcl9kYXRhLCAKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSwgCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgdW5yZWdpc3Rlcl9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLEkMOjIGjhu6d5IMSRxINuZyBrw70gdGjDoG5oIGPDtG5nIHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge2hvc3R9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHbhu5tpIHByb3h5IFBQUG9FIHNlcnZlcjoge3VucmVnaXN0ZXJfcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiS2jDtG5nIHRo4buDIGvhur90IG7hu5FpIMSR4bq/biBwcm94eSBQUFBvRSBzZXJ2ZXIge2hvc3R9IMSR4buDIHVucmVnaXN0ZXI6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJM4buXaSBraGkgaOG7p3kgxJHEg25nIGvDvSBwcm94eSBQUFBvRToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIF91bnJlZ2lzdGVyX2h0dHBfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IEhUVFAvSFRUUFMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9jb25maWc6IEPhuqV1IGjDrG5oIHByb3h5IEhUVFAKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBIVFRQIHByb3h5IHRoxrDhu51uZyBraMO0bmcgY+G6p24gdW5yZWdpc3RlciDEkeG6t2MgYmnhu4d0CiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICBwcmludChmIkjhu6d5IMSRxINuZyBrw70gcHJveHkgSFRUUCB7cHJveHlfaWR9IChraMO0bmcgY+G6p24gdGhhbyB0w6FjIMSR4bq3YyBiaeG7h3QpIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSBo4buneSDEkcSDbmcga8O9IHByb3h5IEhUVFA6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGRlZiBfdW5yZWdpc3Rlcl9zb2NrczVfcHJveHkoc2VsZiwgcHJveHlfY29uZmlnOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBI4buneSDEkcSDbmcga8O9IHByb3h5IFNPQ0tTNQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb3h5X2NvbmZpZzogQ+G6pXUgaMOsbmggcHJveHkgU09DS1M1CiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgU09DS1M1IHByb3h5IHRoxrDhu51uZyBraMO0bmcgY+G6p24gdW5yZWdpc3RlciDEkeG6t2MgYmnhu4d0CiAgICAgICAgICAgIHByb3h5X2lkID0gcHJveHlfY29uZmlnLmdldCgiaWQiKQogICAgICAgICAgICBwcmludChmIkjhu6d5IMSRxINuZyBrw70gcHJveHkgU09DS1M1IHtwcm94eV9pZH0gKGtow7RuZyBj4bqnbiB0aGFvIHTDoWMgxJHhurdjIGJp4buHdCkiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiTOG7l2kga2hpIGjhu6d5IMSRxINuZyBrw70gcHJveHkgU09DS1M1OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZGVidWdfZWxlbWVudF9ib3VuZHMoc2VsZiwgZWxlbWVudDogRGljdFtzdHIsIEFueV0pIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgRGVidWcgdGjDtG5nIHRpbiBib3VuZHMgY+G7p2EgZWxlbWVudCDEkeG7gyBraeG7g20gdHJhIHhlbSBjw7MgdGFwIMSRxrDhu6NjIGtow7RuZwogICAgICAgICIiIgogICAgICAgIGlmIG5vdCBlbGVtZW50OgogICAgICAgICAgICBwcmludCgiREVCVUc6IEVsZW1lbnQgaXMgTm9uZSBvciBlbXB0eSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBwcmludCgiPT09IERFQlVHIEVMRU1FTlQgQk9VTkRTID09PSIpCiAgICAgICAgYm91bmRzX3N0ciA9IGVsZW1lbnQuZ2V0KCJib3VuZHMiLCAiIikKICAgICAgICBwcmludChmIk9yaWdpbmFsIGJvdW5kcyBzdHJpbmc6ICd7Ym91bmRzX3N0cn0nIikKICAgICAgICAKICAgICAgICAjIFRlc3QgZ2V0X2VsZW1lbnRfYm91bmRzCiAgICAgICAgeDEsIHkxLCB4MiwgeTIgPSBzZWxmLmdldF9lbGVtZW50X2JvdW5kcyhlbGVtZW50KQogICAgICAgIHByaW50KGYiUGFyc2VkIGJvdW5kczogKHt4MX0sIHt5MX0sIHt4Mn0sIHt5Mn0pIikKICAgICAgICAKICAgICAgICAjIFRlc3QgZ2V0X2VsZW1lbnRfY2VudGVyCiAgICAgICAgY2VudGVyX3gsIGNlbnRlcl95ID0gc2VsZi5nZXRfZWxlbWVudF9jZW50ZXIoZWxlbWVudCkKICAgICAgICBwcmludChmIkNhbGN1bGF0ZWQgY2VudGVyOiAoe2NlbnRlcl94fSwge2NlbnRlcl95fSkiKQogICAgICAgIAogICAgICAgICMgVGVzdCB24bubaSB2w60gZOG7pSBj4bulIHRo4buDCiAgICAgICAgcHJpbnQoIlxuLS0tIFRlc3Rpbmcgd2l0aCBleGFtcGxlIGJvdW5kcyBbMzYsMF1bODQsLTMwXSAtLS0iKQogICAgICAgIHRlc3RfZWxlbWVudCA9IHsiYm91bmRzIjogIlszNiwwXVs4NCwtMzBdIiwgImNvbnRlbnQtZGVzYyI6ICJUw6xtIGtp4bq/bSJ9CiAgICAgICAgCiAgICAgICAgdGVzdF94MSwgdGVzdF95MSwgdGVzdF94MiwgdGVzdF95MiA9IHNlbGYuZ2V0X2VsZW1lbnRfYm91bmRzKHRlc3RfZWxlbWVudCkKICAgICAgICBwcmludChmIlRlc3QgcGFyc2VkIGJvdW5kczogKHt0ZXN0X3gxfSwge3Rlc3RfeTF9LCB7dGVzdF94Mn0sIHt0ZXN0X3kyfSkiKQogICAgICAgIAogICAgICAgIHRlc3RfY2VudGVyX3gsIHRlc3RfY2VudGVyX3kgPSBzZWxmLmdldF9lbGVtZW50X2NlbnRlcih0ZXN0X2VsZW1lbnQpCiAgICAgICAgcHJpbnQoZiJUZXN0IGNhbGN1bGF0ZWQgY2VudGVyOiAoe3Rlc3RfY2VudGVyX3h9LCB7dGVzdF9jZW50ZXJfeX0pIikKICAgICAgICAKICAgICAgICAjIFRlc3QgdGFwX2VsZW1lbnQKICAgICAgICBwcmludCgiXG4tLS0gVGVzdGluZyB0YXBfZWxlbWVudCAtLS0iKQogICAgICAgIHJlc3VsdCA9IHNlbGYudGFwX2VsZW1lbnQodGVzdF9lbGVtZW50KQogICAgICAgIHByaW50KGYiVGFwIHJlc3VsdDoge3Jlc3VsdH0iKQogICAgICAgIAogICAgICAgIHByaW50KCI9PT0gRU5EIERFQlVHID09PSIpCgogICAgZGVmIGRvd25sb2FkX2ltYWdlKHNlbGYsIHNlcnZlcjogc3RyID0gImh0dHA6Ly8xMC4wLjAuNTo1MDAwIiwgY291bnQ6IGludCA9IDEpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVOG6o2kg4bqjbmggdOG7qyBzZXJ2ZXIgduG7gSB0aGnhur90IGLhu4sgdGjDtG5nIHF1YSBoZWxwZXIgc2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHNlcnZlcjogU2VydmVyIMSR4buLYSBjaOG7iSAobuG6v3UgTm9uZSB0aMOsIMSR4buNYyB04burIGNvbmZpZyBkYiwgbeG6t2MgxJHhu4tuaCAiaHR0cDovLzEwLjAuMC41OjUwMDAiKQogICAgICAgICAgICBjb3VudDogU+G7kSBsxrDhu6NuZyDhuqNuaCBj4bqnbiB04bqjaSAobeG6t2MgxJHhu4tuaCAxKQogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHThuqNpIHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IHNlcnZlciB04burIGRhdGFiYXNlIG7hur91IGtow7RuZyB0cnV54buBbiB2w6BvCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyBzZXJ2ZXIgY8OzIHByb3RvY29sCiAgICAgICAgICAgIGlmIG5vdCBzZXJ2ZXIuc3RhcnRzd2l0aCgoImh0dHA6Ly8iLCAiaHR0cHM6Ly8iKSk6CiAgICAgICAgICAgICAgICBzZXJ2ZXIgPSBmImh0dHA6Ly97c2VydmVyfSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgWMOieSBk4buxbmcgVVJMIGThu7FhIHRyw6puIHPhu5EgbMaw4bujbmcg4bqjbmgKICAgICAgICAgICAgaWYgY291bnQgPT0gMToKICAgICAgICAgICAgICAgICMgVHLGsOG7nW5nIGjhu6NwIHThuqNpIDEg4bqjbmggLSBz4butIGThu6VuZyBlbmRwb2ludCByYW5kb20tYXZhdGFyCiAgICAgICAgICAgICAgICBpbWFnZV91cmwgPSBmIntzZXJ2ZXJ9L3JhbmRvbS1hdmF0YXIiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRyxrDhu51uZyBo4bujcCB04bqjaSBuaGnhu4F1IOG6o25oIC0gc+G7rSBk4bulbmcgZW5kcG9pbnQgZ2V0LXNpbWlsYXItaW1hZ2VzCiAgICAgICAgICAgICAgICBpbWFnZV91cmwgPSBmIntzZXJ2ZXJ9L2dldC1zaW1pbGFyLWltYWdlcz9jb3VudD17Y291bnR9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyBT4butIGThu6VuZyBfbWFrZV9yZXF1ZXN0IMSR4buDIHThuq1uIGThu6VuZyBjxqEgY2jhur8gcmV0cnkgdsOgIGVycm9yIGhhbmRsaW5nIGPDsyBz4bq1bgogICAgICAgICAgICByZXN1bHQgPSBzZWxmLl9tYWtlX3JlcXVlc3QoImRvd25sb2FkLWltYWdlIiwgcGFyYW1zPXsidXJsIjogaW1hZ2VfdXJsfSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgWOG7rSBsw70gcmVzcG9uc2UgZm9ybWF0IHRo4buxYyB04bq/CiAgICAgICAgICAgICMgUmVzcG9uc2U6IHsiZGF0YSI6IHsic3VjY2VzcyI6IHRydWUsICJtZXNzYWdlIjogIi4uLiIsICJkYXRhIjogey4uLn19LCAibWVzc2FnZSI6ICIuLi4iLCAic3RhdHVzIjogInN1Y2Nlc3MifQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJlc3VsdCwgZGljdCkgYW5kIHJlc3VsdC5nZXQoInN0YXR1cyIpID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBkYXRhLnN1Y2Nlc3MgdsOgIGRhdGEubWVzc2FnZQogICAgICAgICAgICAgICAgZGF0YV9zZWN0aW9uID0gcmVzdWx0LmdldCgiZGF0YSIsIHt9KQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IGRhdGFfc2VjdGlvbi5nZXQoInN1Y2Nlc3MiLCBGYWxzZSkKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBkYXRhX3NlY3Rpb24uZ2V0KCJtZXNzYWdlIiwgIiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzIGFuZCAidGjDoG5oIGPDtG5nIiBpbiBtZXNzYWdlCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkzhu5dpIGtoaSB04bqjaSDhuqNuaDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgojIFRlc3QgZnVuY3Rpb24gZm9yIHRoZSBwcm9ibGVtYXRpYyBlbGVtZW50CmRlZiB0ZXN0X3Byb2JsZW1hdGljX2VsZW1lbnQoKToKICAgICIiIgogICAgVGVzdCBmdW5jdGlvbiDEkeG7gyBraeG7g20gdHJhIGVsZW1lbnQgY8OzIGJvdW5kcyDDom0KICAgICIiIgogICAgaGVscGVyID0gSGVscGVyU2VydmljZSgpCiAgICAKICAgICMgRWxlbWVudCB04burIHbDrSBk4bulIGPhu6dhIHVzZXIKICAgIHByb2JsZW1hdGljX2VsZW1lbnQgPSB7CiAgICAgICAgImNsYXNzIjogImFuZHJvaWQud2lkZ2V0LkltYWdlVmlldyIsCiAgICAgICAgInBhY2thZ2UiOiAiY29tLnNzLmFuZHJvaWQudWdjLnRyaWxsIiwgCiAgICAgICAgInJlc291cmNlLWlkIjogImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbDppZC9kZWwiLAogICAgICAgICJ0ZXh0IjogIm51bGwiLAogICAgICAgICJjb250ZW50LWRlc2MiOiAiVMOsbSBraeG6v20iLAogICAgICAgICJib3VuZHMiOiAiWzM2LDBdWzg0LC0zMF0iLAogICAgICAgICJjbGlja2FibGUiOiAiZmFsc2UiLAogICAgICAgICJlbmFibGVkIjogInRydWUiLAogICAgICAgICJ2aXNpYmxlLXRvLXVzZXIiOiAiZmFsc2UiCiAgICB9CiAgICAKICAgIHByaW50KCJUZXN0aW5nIHByb2JsZW1hdGljIGVsZW1lbnQgd2l0aCBib3VuZHMgWzM2LDBdWzg0LC0zMF0iKQogICAgaGVscGVyLmRlYnVnX2VsZW1lbnRfYm91bmRzKHByb2JsZW1hdGljX2VsZW1lbnQpCiAgICAKICAgIHByaW50KCJcblRyeWluZyB0byB0YXAgdGhlIGVsZW1lbnQuLi4iKQogICAgcmVzdWx0ID0gaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihwcm9ibGVtYXRpY19lbGVtZW50KQogICAgcHJpbnQoZiJGaW5hbCB0YXAgcmVzdWx0OiB7cmVzdWx0fSIpCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgdGVzdF9wcm9ibGVtYXRpY19lbGVtZW50KCkKICAgIAogICAgIyBWw60gZOG7pSBz4butIGThu6VuZwogICAgaGVscGVyID0gSGVscGVyU2VydmljZSgpCiAgICAKICAgICMgTOG6pXkga8OtY2ggdGjGsOG7m2MgbcOgbiBow6xuaAogICAgd2lkdGgsIGhlaWdodCA9IGhlbHBlci5nZXRfc2NyZWVuX3NpemUoKQogICAgcHJpbnQoZiJLw61jaCB0aMaw4bubYyBtw6BuIGjDrG5oOiB7d2lkdGh9eHtoZWlnaHR9IikKICAgIAogICAgIyBN4bufIFRpa1RvawogICAgaGVscGVyLm9wZW5fYXBwKCJjb20uc3MuYW5kcm9pZC51Z2MudHJpbGwiKQogICAgCiAgICAjIENo4budIMSR4bujaSBjaG8gxJHhur9uIGtoaSBuw7p0ICJUcmFuZyBjaOG7pyIgaG/hurdjIG7DunQgIktow6FtIHBow6EiIHh14bqldCBoaeG7h24KICAgIGVsZW1lbnRzX3RvX2ZpbmQgPSBbCiAgICAgICAgeyJjb250ZW50X2Rlc2MiOiAiVHJhbmcgY2jhu6cifSwKICAgICAgICB7ImNvbnRlbnRfZGVzYyI6ICJLaMOhbSBwaMOhIn0KICAgIF0KICAgIAogICAgZWxlbWVudCA9IGhlbHBlci53YWl0X2Zvcl9hbnlfZWxlbWVudChlbGVtZW50c190b19maW5kKQogICAgCiAgICBpZiBlbGVtZW50OgogICAgICAgIHByaW50KGYixJDDoyB0w6xtIHRo4bqleSBwaOG6p24gdOG7rToge2hlbHBlci5nZXRfZWxlbWVudF9jb250ZW50X2Rlc2MoZWxlbWVudCl9IikKICAgICAgICBoZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGVsZW1lbnQpCiAgICBlbHNlOgogICAgICAgIHByaW50KCJLaMO0bmcgdMOsbSB0aOG6pXkgcGjhuqduIHThu60gbsOgbyBzYXUgdGjhu51pIGdpYW4gY2jhu50iKQ==').decode('utf-8'))
