import base64
exec(base64.b64decode('aW1wb3J0IHRpbWUKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgTGlzdCwgT3B0aW9uYWwsIENhbGxhYmxlCmZyb20gYWJjIGltcG9ydCBBQkMsIGFic3RyYWN0bWV0aG9kCmltcG9ydCB1dGlscwpmcm9tIHV0aWxzIGltcG9ydCBMb2dMZXZlbCwgTG9nZ2VyCmltcG9ydCB1cmxsaWIucGFyc2UKaW1wb3J0IHJhbmRvbQppbXBvcnQgY29uZmlnCiMgVOG6oW8gbG9nZ2VyIGNobyBCYXNlSm9iCmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoIkJhc2VKb2IiKQoKY2xhc3MgQmFzZUpvYihBQkMpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZT1Ob25lKToKICAgICAgICBzZWxmLmRiID0gZGJfc2VydmljZQogICAgICAgIHNlbGYuaGVscGVyID0gaGVscGVyX3NlcnZpY2UKICAgICAgICBzZWxmLmdvbGlrZV9zZXJ2aWNlID0gZ29saWtlX3NlcnZpY2UKICAgICAgICBzZWxmLmFwcF9wYWNrYWdlID0gIiIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gIiIKICAgICAgICAjIEjDoG0gc2xlZXAgbeG6t2MgxJHhu4tuaCBsw6AgdGltZS5zbGVlcAogICAgICAgIHNlbGYuX3NsZWVwX2Z1bmMgPSB0aW1lLnNsZWVwCiAgICAgICAgIyBU4bqhbyBsb2dnZXIgY2hvIGluc3RhbmNlIGPhu6UgdGjhu4MKICAgICAgICBzZWxmLmxvZ2dlciA9IHV0aWxzLmdldF9sb2dnZXIoZiJKb2Iue3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpCiAgICAgICAgCiAgICAgICAgIyBQcm94eSBzZXJ2aWNlIHPhur0gxJHGsOG7o2Mgc2V0IHNhdSBraGkga2jhu59pIHThuqFvCiAgICAgICAgc2VsZi5wcm94eV9zZXJ2aWNlID0gTm9uZQogICAgICAgIAogICAgZGVmIHNldF9wcm94eV9zZXJ2aWNlKHNlbGYsIHByb3h5X3NlcnZpY2UpOgogICAgICAgICIiIgogICAgICAgIFRoaeG6v3QgbOG6rXAgcHJveHkgc2VydmljZSBjaG8gam9iIGhhbmRsZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwcm94eV9zZXJ2aWNlOiBQcm94eVNlcnZpY2UgaW5zdGFuY2UKICAgICAgICAiIiIKICAgICAgICBzZWxmLnByb3h5X3NlcnZpY2UgPSBwcm94eV9zZXJ2aWNlCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgdGhp4bq/dCBs4bqtcCBwcm94eSBzZXJ2aWNlIGNobyB7c2VsZi5fX2NsYXNzX18uX19uYW1lX199IikKICAgICAgICAKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIGdldF9hY2NvdW50c19mcm9tX2RldmljZShzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiJM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiB04burIHRoaeG6v3QgYuG7iyIiIgogICAgICAgIHBhc3MKCiAgICAgICAgCiAgICBkZWYgc3luY19hY2NvdW50c190b19kYihzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICDEkOG7k25nIGLhu5kgdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLIHbDoG8gZGF0YWJhc2UgdsOgIG1hcCB24bubaSB0w6BpIGtob+G6o24gR29MaWtlCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGRldmljZV9hY2NvdW50cyA9IHNlbGYuZ2V0X2FjY291bnRzX2Zyb21fZGV2aWNlKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZGV2aWNlX2lkIHThu6sgZGF0YWJhc2UKICAgICAgICAgICAgYW5kcm9pZF9pZCA9IHNlbGYuZGIuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiBoaeG7h24gY8OzIHRyb25nIERCIGNobyBhcHAgbsOgeQogICAgICAgICAgICBleGlzdGluZ19hY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1zZWxmLmFwcF9uYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBzZXQgY8OhYyB1bmlxdWVfdXNlcm5hbWUgdOG7qyB0aGnhur90IGLhu4sgxJHhu4MgZOG7hSBzbyBzw6FuaAogICAgICAgICAgICBkZXZpY2VfdXNlcm5hbWVzID0gc2V0KCkKICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gZGV2aWNlX2FjY291bnRzOgogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBhY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIikKICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgIGRldmljZV91c2VybmFtZXMuYWRkKHVzZXJuYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHTDoGkga2hv4bqjbiB0cm9uZyBEQiBtw6Aga2jDtG5nIGPDsm4gdHLDqm4gdGhp4bq/dCBi4buLIC0+IMSRw6FuaCBk4bqldSBsb2dvdXQKICAgICAgICAgICAgZm9yIGV4aXN0aW5nX2FjY291bnQgaW4gZXhpc3RpbmdfYWNjb3VudHM6CiAgICAgICAgICAgICAgICBleGlzdGluZ191c2VybmFtZSA9IGV4aXN0aW5nX2FjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKQogICAgICAgICAgICAgICAgaWYgZXhpc3RpbmdfdXNlcm5hbWUgYW5kIGV4aXN0aW5nX3VzZXJuYW1lIG5vdCBpbiBkZXZpY2VfdXNlcm5hbWVzOgogICAgICAgICAgICAgICAgICAgICMgVMOgaSBraG/huqNuIGPDsyB0cm9uZyBEQiBuaMawbmcga2jDtG5nIGPDsyB0csOqbiB0aGnhur90IGLhu4sgLT4gbG9nb3V0CiAgICAgICAgICAgICAgICAgICAgaWYgZXhpc3RpbmdfYWNjb3VudC5nZXQoInN0YXR1cyIpICE9ICJsb2dvdXQiOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiVMOgaSBraG/huqNuIHtleGlzdGluZ191c2VybmFtZX0ga2jDtG5nIGPDsm4gdHLDqm4gdGhp4bq/dCBi4buLLCDEkcOhbmggZOG6pXUgbG9nb3V0IikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChleGlzdGluZ19hY2NvdW50WyJpZCJdLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogImxvZ291dCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW5hY3RpdmVfcmVhc29uIjogIlTDoGkga2hv4bqjbiBraMO0bmcgY8OybiB0csOqbiB0aGnhur90IGLhu4siLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzX3N5bmMiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgaG/hurdjIHRow6ptIG3hu5tpIHbDoG8gREIKICAgICAgICAgICAgZm9yIGFjY291bnQgaW4gZGV2aWNlX2FjY291bnRzOgogICAgICAgICAgICAgICAgIyBUaMOqbSB0aMO0bmcgdGluIGFwcCB2w6AgZGV2aWNlX2lkCiAgICAgICAgICAgICAgICBhY2NvdW50WyJhcHAiXSA9IHNlbGYuYXBwX25hbWUKICAgICAgICAgICAgICAgIGFjY291bnRbImRldmljZV9pZCJdID0gYW5kcm9pZF9pZAogICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgbMOgIGNoxrBhIMSR4buTbmcgYuG7mSDEkeG7gyBn4butaSBsw6puIHNlcnZlcgogICAgICAgICAgICAgICAgYWNjb3VudFsiaXNfc3luYyJdID0gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHTDoGkga2hv4bqjbiDEkcOjIHThu5NuIHThuqFpIGNoxrBhIGThu7FhIHbDoG8gdW5pcXVlX3VzZXJuYW1lICsgYXBwCiAgICAgICAgICAgICAgICBleGlzdGluZ19hY2NvdW50ID0gc2VsZi5kYi5nZXRfYWNjb3VudF9ieV91bmlxdWVfdXNlcm5hbWUoc2VsZi5hcHBfbmFtZSwgYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBleGlzdGluZ19hY2NvdW50OgogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbiBoaeG7h24gY8OzIC0gY2jhu4kgxJHhu5NuZyBi4buZIHRy4bqhbmcgdGjDoWkgbG9naW4vbG9nb3V0CiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9pZCA9IGV4aXN0aW5nX2FjY291bnRbImlkIl0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENodeG6qW4gYuG7iyBk4buvIGxp4buHdSBj4bqtcCBuaOG6rXQgdOG7kWkgdGhp4buDdQogICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAiaXNfbG9naW4iOiBhY2NvdW50LmdldCgiaXNfbG9naW4iLCBGYWxzZSksCiAgICAgICAgICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGFjY291bnQuZ2V0KCJsYXN0X3VwZGF0ZSIsIGludCh0aW1lLnRpbWUoKSkpLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSB0w6BpIGtob+G6o24gdHJvbmcgREIgxJFhbmcg4bufIHRy4bqhbmcgdGjDoWkgbG9nb3V0IG5oxrBuZyB4deG6pXQgaGnhu4duIGzhuqFpIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgICAgICAgICAgICAgIGlmIGV4aXN0aW5nX2FjY291bnQuZ2V0KCJzdGF0dXMiKSA9PSAibG9nb3V0IjoKICAgICAgICAgICAgICAgICAgICAgICAgIyBSZXNldCB04burIGxvZ291dCB24buBIGFjdGl2ZSB2w6AgeMOzYSBpbmFjdGl2ZV9yZWFzb24KICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGFbInN0YXR1cyJdID0gImFjdGl2ZSIKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGFbImluYWN0aXZlX3JlYXNvbiJdID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDoGkga2hv4bqjbiB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSDEkcOjIHh14bqldCBoaeG7h24gbOG6oWkgdHLDqm4gdGhp4bq/dCBi4buLLCByZXNldCB04burIGxvZ291dCB24buBIGFjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSDEkcOjIGFjdGl2ZSB0aMOsIGdp4buvIG5ndXnDqm4gc3RhdHVzLCBraMO0bmcgdGhheSDEkeG7lWkgZ8OsIGtow6FjCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSDEkcSDbmcgbmjhuq1wIGNobyB0w6BpIGtob+G6o24ge2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnKX0gdHJvbmcge3NlbGYuYXBwX25hbWV9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBUaMOqbSB0w6BpIGtob+G6o24gbeG7m2kgduG7m2kgdHLhuqFuZyB0aMOhaSBhY3RpdmUKICAgICAgICAgICAgICAgICAgICBhY2NvdW50WyJzdGF0dXMiXSA9ICJhY3RpdmUiCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5hZGRfYWNjb3VudChhY2NvdW50KQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHRow6ptIHTDoGkga2hv4bqjbiBt4bubaSB7YWNjb3VudC5nZXQoJ3VuaXF1ZV91c2VybmFtZScpfSBjaG8ge3NlbGYuYXBwX25hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU2F1IGtoaSDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLLCB0aOG7sWMgaGnhu4duIG1hcHBpbmcgduG7m2kgR29MaWtlCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJC4bqvdCDEkeG6p3UgbWFwcGluZyB0w6BpIGtob+G6o24ge3NlbGYuYXBwX25hbWV9IHbhu5tpIEdvTGlrZS4uLiIpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gR29MaWtlCiAgICAgICAgICAgICAgICBnb2xpa2VfYWNjb3VudHMgPSBzZWxmLmdldF9nb2xpa2VfYWNjb3VudHMoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBnb2xpa2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHtsZW4oZ29saWtlX2FjY291bnRzKX0gdMOgaSBraG/huqNuIEdvTGlrZSBjaG8ge3NlbGYuYXBwX25hbWV9IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIMSRw6MgY+G6rXAgbmjhuq10IHThu6sgREIKICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2RldmljZV9hY2NvdW50cyA9IHNlbGYuZGIuZ2V0X2FjY291bnRzKGFwcD1zZWxmLmFwcF9uYW1lKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBtYXBwaW5nCiAgICAgICAgICAgICAgICAgICAgbWFwcGVkX2NvdW50ID0gc2VsZi5tYXBfZ29saWtlX2FjY291bnRzKGdvbGlrZV9hY2NvdW50cywgdXBkYXRlZF9kZXZpY2VfYWNjb3VudHMpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShtYXBwZWRfY291bnQsIGludCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIG1hcHBpbmcge21hcHBlZF9jb3VudH0gdMOgaSBraG/huqNuIHtzZWxmLmFwcF9uYW1lfSB24bubaSBHb0xpa2UiKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJIb8OgbiB0aMOgbmggbWFwcGluZyB0w6BpIGtob+G6o24ge3NlbGYuYXBwX25hbWV9IHbhu5tpIEdvTGlrZSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJLaMO0bmcgdMOsbSB0aOG6pXkgdMOgaSBraG/huqNuIEdvTGlrZSBuw6BvIGNobyB7c2VsZi5hcHBfbmFtZX0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiTOG7l2kga2hpIG1hcHBpbmcgduG7m2kgR29MaWtlOiB7ZX0iKQogICAgICAgICAgICAgICAgIyBLaMO0bmcgdGhyb3cgZXhjZXB0aW9uIHbDrCBzeW5jIHTDoGkga2hv4bqjbiB04burIHRoaeG6v3QgYuG7iyDEkcOjIHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBkZXZpY2VfYWNjb3VudHMKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSDEkeG7k25nIGLhu5kgdMOgaSBraG/huqNuIHtzZWxmLmFwcF9uYW1lfSIpCiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAKICAgIGRlZiBpc19nb2xpa2VfYXV0aGVudGljYXRlZChzZWxmKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEtp4buDbSB0cmEgeGVtIMSRw6MgY8OzIHRow7RuZyB0aW4geMOhYyB0aOG7sWMgR29MaWtlIGNoxrBhCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSDEkcOjIHjDoWMgdGjhu7FjLCBGYWxzZSBu4bq/dSBjaMawYQogICAgICAgICIiIgogICAgICAgIGdvbGlrZV9oZWFkZXJzID0gc2VsZi5kYi5nZXQoImdvbGlrZV9oZWFkZXJzIiwge30pCiAgICAgICAgcmV0dXJuIGJvb2woZ29saWtlX2hlYWRlcnMgYW5kICJhdXRob3JpemF0aW9uIiBpbiBnb2xpa2VfaGVhZGVycykKICAgIAogICAgZGVmIGFwaV9yZXF1ZXN0KHNlbGYsIHVybDogc3RyLCBtZXRob2Q6IHN0ciA9ICJHRVQiLCBwYXlsb2FkOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBH4buNaSBBUEkgR29MaWtlIHRow7RuZyBxdWEgR29MaWtlU2VydmljZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHVybDogVVJMIGPhu6dhIEFQSQogICAgICAgICAgICBtZXRob2Q6IFBoxrDGoW5nIHRo4bupYyBIVFRQIChHRVQgaG/hurdjIFBPU1QpCiAgICAgICAgICAgIHBheWxvYWQ6IEThu68gbGnhu4d1IGfhu61pIMSRaSAoY2hvIFBPU1QgcmVxdWVzdCkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdCBob+G6t2MgTm9uZTogS+G6v3QgcXXhuqMgQVBJIG7hur91IHRow6BuaCBjw7RuZywgTm9uZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICBpZiBub3Qgc2VsZi5nb2xpa2Vfc2VydmljZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgZ+G7jWkgQVBJOiBHb0xpa2VTZXJ2aWNlIGNoxrBhIMSRxrDhu6NjIGN1bmcgY+G6pXAgY2hvIHtzZWxmLmFwcF9uYW1lfSBqb2IiKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAjIFjhu60gbMO9IHBheWxvYWQgY2hvIEdFVCByZXF1ZXN0IC0gdGjDqm0gdsOgbyBVUkwKICAgICAgICBpZiBtZXRob2QudXBwZXIoKSA9PSAiR0VUIiBhbmQgcGF5bG9hZDoKICAgICAgICAgICAgIyBU4bqhbyBxdWVyeSBzdHJpbmcgdOG7qyBwYXlsb2FkCiAgICAgICAgICAgIHF1ZXJ5X3BhcmFtcyA9IFtdCiAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIHBheWxvYWQuaXRlbXMoKToKICAgICAgICAgICAgICAgIGlmIHZhbHVlIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHF1ZXJ5X3BhcmFtcy5hcHBlbmQoZiJ7dXJsbGliLnBhcnNlLnF1b3RlKGtleSl9PXt1cmxsaWIucGFyc2UucXVvdGUoc3RyKHZhbHVlKSl9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gcXVlcnkgc3RyaW5nIHbDoG8gVVJMCiAgICAgICAgICAgIGlmIHF1ZXJ5X3BhcmFtczoKICAgICAgICAgICAgICAgIHNlcGFyYXRvciA9ICImIiBpZiAiPyIgaW4gdXJsIGVsc2UgIj8iCiAgICAgICAgICAgICAgICB1cmwgPSBmInt1cmx9e3NlcGFyYXRvcn17JyYnLmpvaW4ocXVlcnlfcGFyYW1zKX0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bq3dCBwYXlsb2FkIHbhu4EgTm9uZSB2w6wgxJHDoyDEkcawYSB2w6BvIFVSTAogICAgICAgICAgICBwYXlsb2FkID0gTm9uZQogICAgICAgIAogICAgICAgIHJldHVybiBzZWxmLmdvbGlrZV9zZXJ2aWNlLmFwaV9yZXF1ZXN0KHVybCwgbWV0aG9kLCBwYXlsb2FkKQogICAgCiAgICBkZWYgZ2V0X2dvbGlrZV9hY2NvdW50cyhzZWxmKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiDEkcOjIMSRxINuZyBrw70gduG7m2kgR29MaWtlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggdMOgaSBraG/huqNuIEdvTGlrZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkMaw4budbmcgZOG6q24gQVBJIGzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgIHVybCA9IGYie3NlbGYuZ2V0X2FjY291bnRfdXJsKCl9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBBUEkKICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmFwaV9yZXF1ZXN0KHVybCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlIGFuZCByZXNwb25zZS5nZXQoInN1Y2Nlc3MiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBhY2NvdW50cyA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIFtdKQogICAgICAgICAgICAgICAgcmV0dXJuIGFjY291bnRzCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gW10KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIEdvTGlrZSIpCiAgICAgICAgICAgIHJldHVybiBbXQogICAgCiAgICBkZWYgbWFwX2dvbGlrZV9hY2NvdW50cyhzZWxmLCBnb2xpa2VfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dLCBkZXZpY2VfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICDDgW5oIHjhuqEgdMOgaSBraG/huqNuIHThu6sgR29MaWtlIHbDoG8gdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGdvbGlrZV9hY2NvdW50czogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdOG7qyBHb0xpa2UgQVBJCiAgICAgICAgICAgIGRldmljZV9hY2NvdW50czogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdHLDqm4gdGhp4bq/dCBi4buLCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiDEkcOjIMOhbmggeOG6oQogICAgICAgICIiIgogICAgICAgICMgUGjGsMahbmcgdGjhu6ljIG3hurdjIMSR4buLbmgsIGPhuqduIG92ZXJyaWRlIOG7nyBs4bubcCBjb24KICAgICAgICByZXR1cm4gW10KICAgIAogICAgZGVmIGZldGNoX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IHRow7RuZyB0aW4gam9iIHThu6sgR29MaWtlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdCBob+G6t2MgTm9uZTogVGjDtG5nIHRpbiBqb2IgbuG6v3UgY8OzLCBOb25lIG7hur91IGtow7RuZyBjw7MKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDGsOG7nW5nIGThuqtuIEFQSSBs4bqleSBqb2IKICAgICAgICAgICAgdXJsID0gZiJ7c2VsZi5nZXRfam9ic191cmwoKX0iCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRoYW0gc+G7kSB0w7l5IHRoZW8gbG/huqFpIGFwcAogICAgICAgICAgICBwYXJhbXMgPSBzZWxmLmdldF9qb2JfcGFyYW1zKGFjY291bnQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSQogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuYXBpX3JlcXVlc3QodXJsLCAiR0VUIiwgcGFyYW1zKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzcG9uc2UgYW5kIHJlc3BvbnNlLmdldCgic3VjY2VzcyIsIEZhbHNlKToKICAgICAgICAgICAgICAgIGpvYiA9IHJlc3BvbnNlLmdldCgiZGF0YSIsIE5vbmUpCiAgICAgICAgICAgICAgICBpZiBqb2I6CiAgICAgICAgICAgICAgICAgICAgIyBDaHXhuqluIGjDs2EgZOG7ryBsaeG7h3Ugam9iCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYubWFwX2pvYl9kYXRhKGpvYikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBs4bqleSBqb2IiKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgbWFwX2pvYl9kYXRhKHNlbGYsIGpvYl9kYXRhOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ2h14bqpbiBow7NhIGThu68gbGnhu4d1IGpvYiB04burIEFQSQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl9kYXRhOiBE4buvIGxp4buHdSBqb2IgdOG7qyBBUEkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEThu68gbGnhu4d1IGpvYiDEkcOjIGNodeG6qW4gaMOzYQogICAgICAgICIiIgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJhcHAiOiBzZWxmLmFwcF9uYW1lLAogICAgICAgICAgICAiaWQiOiBqb2JfZGF0YS5nZXQoImlkIiksCiAgICAgICAgICAgICJsaW5rIjogam9iX2RhdGEuZ2V0KCJsaW5rIiksCiAgICAgICAgICAgICJ0eXBlIjogam9iX2RhdGEuZ2V0KCJ0eXBlIiksCiAgICAgICAgICAgICJvYmplY3RfaWQiOiBqb2JfZGF0YS5nZXQoIm9iamVjdF9pZCIpLAogICAgICAgICAgICAicHJpY2VfYWZ0ZXJfY29zdCI6IGpvYl9kYXRhLmdldCgicHJpY2VfYWZ0ZXJfY29zdCIpLAogICAgICAgICAgICAic3RhdHVzIjogImlkbGUiLCAgIyBTdGF0dXMgbeG6t2MgxJHhu4tuaCBsw6AgaWRsZQogICAgICAgICAgICAicmF3X2RhdGEiOiBqb2JfZGF0YSAgIyBMxrB1IGzhuqFpIGThu68gbGnhu4d1IGfhu5FjIMSR4buDIHRoYW0ga2jhuqNvIGtoaSBj4bqnbgogICAgICAgIH0KICAgIAogICAgZGVmIHZhbGlkYXRlX2pvYl9iZWZvcmVfZXhlY3V0aW9uKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBLaeG7g20gdHJhIHbDoCB2YWxpZGF0ZSBqb2IgdHLGsOG7m2Mga2hpIHRo4buxYyBoaeG7h24KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyB2YWxpZGF0aW9uOgogICAgICAgICAgICAgICAgLSB2YWxpZCAoYm9vbCk6IFRydWUgbuG6v3Ugam9iIGjhu6NwIGzhu4csIEZhbHNlIG7hur91IGtow7RuZwogICAgICAgICAgICAgICAgLSBzaG91bGRfc2tpcCAoYm9vbCk6IFRydWUgbuG6v3UgbsOqbiBza2lwIGpvYiwgRmFsc2UgbuG6v3Uga2jDtG5nCiAgICAgICAgICAgICAgICAtIHJlYXNvbiAoc3RyKTogTMO9IGRvIGtow7RuZyBo4bujcCBs4buHIGhv4bq3YyBza2lwCiAgICAgICAgICAgICAgICAtIG1lc3NhZ2UgKHN0cik6IFRow7RuZyBiw6FvIGNoaSB0aeG6v3QKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGpvYl90eXBlID0gam9iLmdldCgidHlwZSIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIGpvYl9wcmljZSA9IGpvYi5nZXQoInByaWNlX2FmdGVyX2Nvc3QiLCAwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGpvYiBmb2xsb3cKICAgICAgICAgICAgaWYgam9iX3R5cGUgPT0gImZvbGxvdyI6CiAgICAgICAgICAgICAgICAjIDEuIEtp4buDbSB0cmEgZ2nDoSB0aeG7gW4gY+G7p2Egam9iIGZvbGxvdwogICAgICAgICAgICAgICAgbWluX2ZvbGxvd19wcmljZSA9IHNlbGYuZGIuZ2V0KCJtaW5fZm9sbG93X3ByaWNlIiwgMzApICAjIE3hurdjIMSR4buLbmggMzAKICAgICAgICAgICAgICAgIGlmIGpvYl9wcmljZSA8IG1pbl9mb2xsb3dfcHJpY2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgInZhbGlkIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICJzaG91bGRfc2tpcCI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIjogZiJKb2IgZm9sbG93IGPDsyBnacOhIHtqb2JfcHJpY2V9IDwge21pbl9mb2xsb3dfcHJpY2V9LCBza2lwIGpvYi4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMSQw6MgYuG7jyBraeG7g20gdHJhIGtow7NhIGZvbGxvdyB2w6wga2jDtG5nIGPDsm4gZ2nhu5tpIGjhuqFuIGZvbGxvdwogICAgICAgICAgICAKICAgICAgICAgICAgIyBKb2IgaOG7o3AgbOG7hwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInZhbGlkIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJzaG91bGRfc2tpcCI6IEZhbHNlLAogICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiAiSm9iIGjhu6NwIGzhu4ciCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgdmFsaWRhdGUgam9iOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAidmFsaWQiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJzaG91bGRfc2tpcCI6IEZhbHNlLAogICAgICAgICAgICAgICAgInJlYXNvbiI6ICJ2YWxpZGF0aW9uX2Vycm9yIiwKICAgICAgICAgICAgICAgICJtZXNzYWdlIjogZiJM4buXaSBraGkgdmFsaWRhdGUgam9iOiB7c3RyKGUpfSIKICAgICAgICAgICAgfQogICAgCiAgICBkZWYgZXhlY3V0ZV9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogS+G6v3QgcXXhuqMgdGjhu7FjIGhp4buHbiBqb2IsIGJhbyBn4buTbToKICAgICAgICAgICAgICAgIC0gc3RhdHVzIChpbnQpOiBNw6MgdHLhuqFuZyB0aMOhaSBqb2IKICAgICAgICAgICAgICAgICAgICAwOiBDaMawYSB0aOG7sWMgaGnhu4duCiAgICAgICAgICAgICAgICAgICAgMTogVGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICAgICAgMjogVGjhuqV0IGLhuqFpLCBraMO0bmcgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nCiAgICAgICAgICAgICAgICAgICAgMzogVGjhuqV0IGLhuqFpLCDEkcOjIGLhu4sgdW5mb2xsb3cvdW5saWtlCiAgICAgICAgICAgICAgICAtIG1lc3NhZ2UgKHN0cik6IFRow7RuZyBiw6FvIGvhur90IHF14bqjCiAgICAgICAgICAgICAgICAtIHN1Y2Nlc3MgKGJvb2wpOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgIyBN4bq3YyDEkeG7i25oIGtow7RuZyBsw6BtIGfDrCwgY+G6p24gb3ZlcnJpZGUg4bufIGzhu5twIGNvbgogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUaOG7sWMgaGnhu4duIGpvYiBjaG8gdMOgaSBraG/huqNuIHthY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJyl9IikKICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlX2pvYl9yZXN1bHQoMCwgIkNoxrBhIHRo4buxYyBoaeG7h24gam9iIiwgRmFsc2UpCiAgICAKICAgIGRlZiBfY3JlYXRlX2pvYl9yZXN1bHQoc2VsZiwgc3RhdHVzOiBpbnQsIG1lc3NhZ2U6IHN0ciwgc3VjY2VzczogYm9vbCwgKiprd2FyZ3MpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFThuqFvIGvhur90IHF14bqjIGpvYiBjaHXhuqluCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc3RhdHVzIChpbnQpOiBNw6MgdHLhuqFuZyB0aMOhaSBqb2IKICAgICAgICAgICAgICAgIDA6IENoxrBhIHRo4buxYyBoaeG7h24KICAgICAgICAgICAgICAgIDE6IFRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgMjogVGjhuqV0IGLhuqFpLCBraMO0bmcgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nCiAgICAgICAgICAgICAgICAzOiBUaOG6pXQgYuG6oWksIMSRw6MgYuG7iyB1bmZvbGxvdy91bmxpa2UKICAgICAgICAgICAgICAgIDQ6IFRo4bqldCBi4bqhaSwgecOqdSBj4bqndSDEkWFuZyBjaOG7nQogICAgICAgICAgICAgICAgNTogR+G7rWkgecOqdSBj4bqndSBjaOG7nSBkdXnhu4d0IChJbnN0YWdyYW0pCiAgICAgICAgICAgIG1lc3NhZ2UgKHN0cik6IFRow7RuZyBiw6FvIGvhur90IHF14bqjCiAgICAgICAgICAgIHN1Y2Nlc3MgKGJvb2wpOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgICAgICoqa3dhcmdzOiBDw6FjIHRow7RuZyB0aW4gYuG7lSBzdW5nCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyBqb2IgxJHDoyBjaHXhuqluIGjDs2EKICAgICAgICAiIiIKICAgICAgICByZXN1bHQgPSB7CiAgICAgICAgICAgICJzdGF0dXMiOiBzdGF0dXMsCiAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgInN1Y2Nlc3MiOiBzdWNjZXNzCiAgICAgICAgfQogICAgICAgIAogICAgICAgICMgVGjDqm0gdGjDtG5nIHRpbiBi4buVIHN1bmcgbuG6v3UgY8OzCiAgICAgICAgcmVzdWx0LnVwZGF0ZShrd2FyZ3MpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgCiAgICBkZWYgcmVwb3J0X2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSwgcmVzdWx0OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBCw6FvIGPDoW8ga+G6v3QgcXXhuqMgam9iCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICByZXN1bHQ6IEvhur90IHF14bqjIHRo4buxYyBoaeG7h24gam9iIGJhbyBn4buTbToKICAgICAgICAgICAgICAgIC0gc3RhdHVzIChpbnQpOiBNw6MgdHLhuqFuZyB0aMOhaSBqb2IKICAgICAgICAgICAgICAgICAgICAxOiBUaMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICAyOiBUaOG6pXQgYuG6oWksIGtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcKICAgICAgICAgICAgICAgICAgICAzOiBUaOG6pXQgYuG6oWksIMSRw6MgYuG7iyB1bmZvbGxvdy91bmxpa2UKICAgICAgICAgICAgICAgIC0gbWVzc2FnZSAoc3RyKTogVGjDtG5nIGLDoW8ga+G6v3QgcXXhuqMKICAgICAgICAgICAgICAgIC0gc3VjY2VzcyAoYm9vbCk6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBiw6FvIGPDoW8gdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICAgICAgam9iX3R5cGUgPSBqb2IuZ2V0KCJ0eXBlIiwgIiIpCiAgICAgICAgICAgIGpvYl9zdGF0dXMgPSByZXN1bHQuZ2V0KCJzdGF0dXMiLCAwKQogICAgICAgICAgICBqb2Jfc3VjY2VzcyA9IHJlc3VsdC5nZXQoInN1Y2Nlc3MiLCBGYWxzZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR2hpIGzhuqFpIGzhu4tjaCBz4butIGpvYgogICAgICAgICAgICBzZWxmLnJlY29yZF9qb2JfaGlzdG9yeShhY2NvdW50LCBqb2IsIHJlc3VsdCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBqb2JfaWQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIGPDsyBJRCBqb2IgxJHhu4MgYsOhbyBjw6FvIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIGpvYiB2w6AgeOG7rSBsw70gdMawxqFuZyDhu6luZwogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBzdGF0dXMgbMOgIDIgKGzhu5dpIGtow7RuZyB0w6xtIHRo4bqleSDEkeG7kWkgdMaw4bujbmcpLCBo4buneSBqb2IgdsOgIGLDoW8gY8OhbyB0aOG6pXQgYuG6oWkKICAgICAgICAgICAgaWYgam9iX3N0YXR1cyA9PSAyOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYiB7am9iX2lkfSwga2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZywgaOG7p3kgam9iIikKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnNraXBfam9iKGFjY291bnQsIGpvYikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Ugc3RhdHVzIGzDoCAzICjEkcOjIGLhu4sgdW5mb2xsb3cvdW5saWtlKSwgxJHDoW5oIGThuqV1IHRyb25nIHJlc3VsdCDEkeG7gyBKb2JTZXJ2aWNlIHjhu60gbMO9CiAgICAgICAgICAgIGlmIGpvYl9zdGF0dXMgPT0gMzoKICAgICAgICAgICAgICAgIGFjY291bnRfdXNlcm5hbWUgPSBhY2NvdW50LmdldCgndW5pcXVlX3VzZXJuYW1lJykKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJQaMOhdCBoaeG7h24gYuG7iyB1bmZvbGxvdy91bmxpa2UsIHTDoGkga2hv4bqjbiB7YWNjb3VudF91c2VybmFtZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEjhu6d5IGpvYiBoaeG7h24gdOG6oWkKICAgICAgICAgICAgICAgIHNlbGYuc2tpcF9qb2IoYWNjb3VudCwgam9iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIMSQw6FuaCBk4bqldSB1bmZvbGxvdyB0cm9uZyByZXN1bHQgxJHhu4MgSm9iU2VydmljZSB44butIGzDvSB04bqtcCB0cnVuZwogICAgICAgICAgICAgICAgcmVzdWx0WyJ1bmZvbGxvdyJdID0gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGpvYl9zdGF0dXMgPT0gNDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJZw6p1IGPhuqd1IMSRYW5nIGNo4budIHRyb25nIGpvYiB7am9iX3R5cGV9LCBo4buneSBqb2IiKQogICAgICAgICAgICAgICAgc2VsZi5za2lwX2pvYihhY2NvdW50LCBqb2IpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3Ugam9iIHRow6BuaCBjw7RuZywgYsOhbyBjw6FvIGvhur90IHF14bqjCiAgICAgICAgICAgIGlmIGpvYl9zdWNjZXNzOgogICAgICAgICAgICAgICAgIyBVUkwgQVBJIGLDoW8gY8OhbyBqb2IKICAgICAgICAgICAgICAgIHVybCA9IGYiYWR2ZXJ0aXNpbmcvcHVibGlzaGVycy97c2VsZi5hcHBfbmFtZX0vY29tcGxldGUtam9icyIKICAgICAgICAgICAgICAgIHVybCA9IGYiYWR2ZXJ0aXNpbmcvcHVibGlzaGVycy97c2VsZi5hcHBfbmFtZX0vY29tcGxldGUtam9icyIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBU4bqhbyBwYXlsb2FkIGNobyBiw6FvIGPDoW8gam9iCiAgICAgICAgICAgICAgICBwYXlsb2FkID0gc2VsZi5nZXRfcmVwb3J0X3BheWxvYWQoYWNjb3VudCwgam9iKQogICAgICAgICAgICAgICAgaWYgbm90IHBheWxvYWQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB04bqhbyBwYXlsb2FkIGNobyBiw6FvIGPDoW8gam9iIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaOG7rSBn4buNaSBBUEkgdOG7kWkgxJFhIDMgbOG6p24KICAgICAgICAgICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKDMpOgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5hcGlfcmVxdWVzdCh1cmwsICJQT1NUIiwgcGF5bG9hZCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBiw6FvIGPDoW8gam9iIHtqb2JfaWR9IHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgZWxpZiByZXNwb25zZSBhbmQgcmVzcG9uc2UuZ2V0KCJzdGF0dXMiKSA9PSA0MDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IHJlc3BvbnNlLmdldCgnbWVzc2FnZScsICcnKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlt7YXR0ZW1wdCArIDF9XSBCw6FvIGPDoW8gam9iIGzhu5dpOiB7ZXJyb3JfbXNnfSwgdGjhu60gbOG6oWkgc2F1IDVzLi4uIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIlBo4bqjbiBo4buTaSBraMO0bmcgbW9uZyDEkeG7o2kga2hpIGLDoW8gY8OhbyBqb2I6IHtyZXNwb25zZX0iKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg1KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyB0aMOgbmggY8O0bmcgc2F1IDMgbOG6p24gdGjhu60sIGjhu6d5IGpvYgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgYsOhbyBjw6FvIGpvYiB7am9iX2lkfSBzYXUgMyBs4bqnbiB0aOG7rSIpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5za2lwX2pvYihhY2NvdW50LCBqb2IpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIEpvYiBraMO0bmcgdGjDoG5oIGPDtG5nLCBo4buneSBqb2IKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJKb2Ige2pvYl9pZH0ga2jDtG5nIHRow6BuaCBjw7RuZywgaOG7p3kgam9iIikKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnNraXBfam9iKGFjY291bnQsIGpvYikKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgYsOhbyBjw6FvIGpvYiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgZ2V0X3JlcG9ydF9wYXlsb2FkKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBU4bqhbyBwYXlsb2FkIGNobyB2aeG7h2MgYsOhbyBjw6FvIGhvw6BuIHRow6BuaCBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICBqb2I6IFRow7RuZyB0aW4gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBQYXlsb2FkIGNobyBBUEkgYsOhbyBjw6FvCiAgICAgICAgIiIiCiAgICAgICAgZ29saWtlX2lkID0gYWNjb3VudC5nZXQoImdvbGlrZV9pZCIpCiAgICAgICAgam9iX2lkID0gam9iLmdldCgiaWQiKQogICAgICAgIAogICAgICAgIGlmIG5vdCBnb2xpa2VfaWQgb3Igbm90IGpvYl9pZDoKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIlRoaeG6v3UgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24gaG/hurdjIGpvYiDEkeG7gyB04bqhbyBwYXlsb2FkIGLDoW8gY8OhbyIpCiAgICAgICAgICAgIHJldHVybiB7fQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiYWRzX2lkIjogam9iX2lkLAogICAgICAgICAgICAiYWNjb3VudF9pZCI6IGdvbGlrZV9pZCwKICAgICAgICAgICAgImFzeW5jIjogVHJ1ZSwKICAgICAgICAgICAgImRhdGEiOiBOb25lCiAgICAgICAgfQogICAgCiAgICBkZWYgZ2V0X3NraXBfcGF5bG9hZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgVOG6oW8gcGF5bG9hZCBjaG8gdmnhu4djIGLhu48gcXVhL2jhu6d5IGpvYgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IFBheWxvYWQgY2hvIEFQSSBza2lwIGpvYgogICAgICAgICIiIgogICAgICAgIGdvbGlrZV9pZCA9IGFjY291bnQuZ2V0KCJnb2xpa2VfaWQiKQogICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICBqb2JfdHlwZSA9IGpvYi5nZXQoInR5cGUiKQogICAgICAgIG9iamVjdF9pZCA9IGpvYi5nZXQoIm9iamVjdF9pZCIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IGdvbGlrZV9pZCBvciBub3Qgam9iX2lkOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiVGhp4bq/dSB0aMO0bmcgdGluIHTDoGkga2hv4bqjbiBob+G6t2Mgam9iIMSR4buDIHThuqFvIHBheWxvYWQgaOG7p3kiKQogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImFkc19pZCI6IGpvYl9pZCwKICAgICAgICAgICAgImFjY291bnRfaWQiOiBnb2xpa2VfaWQsCiAgICAgICAgICAgICJvYmplY3RfaWQiOiBvYmplY3RfaWQsCiAgICAgICAgICAgICJ0eXBlIjogam9iX3R5cGUKICAgICAgICB9CiAgICAgICAgCiAgICBkZWYgc2tpcF9qb2Ioc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQuG7jyBxdWEvaOG7p3kgam9iIGhp4buHbiB04bqhaQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSBo4buneSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVVJMIEFQSSDEkeG7gyBza2lwIGpvYgogICAgICAgICAgICB1cmwgPSBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS9hZHZlcnRpc2luZy9wdWJsaXNoZXJzL3tzZWxmLmFwcF9uYW1lfS9za2lwLWpvYnMiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIHBheWxvYWQgY2hvIHZp4buHYyBza2lwIGpvYgogICAgICAgICAgICBwYXlsb2FkID0gc2VsZi5nZXRfc2tpcF9wYXlsb2FkKGFjY291bnQsIGpvYikKICAgICAgICAgICAgaWYgbm90IHBheWxvYWQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIHThuqFvIHBheWxvYWQgY2hvIHNraXAgam9iIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBH4buNaSBBUEkKICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmFwaV9yZXF1ZXN0KHVybCwgIlBPU1QiLCBwYXlsb2FkKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzcG9uc2UgYW5kIHJlc3BvbnNlLmdldCgic3VjY2VzcyIsIEZhbHNlKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGjhu6d5IGpvYiB7am9iLmdldCgnaWQnKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiSOG7p3kgam9iIHtqb2IuZ2V0KCdpZCcpfSB0aOG6pXQgYuG6oWk6IHtyZXNwb25zZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGjhu6d5IGpvYiIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgZGVmIGNsb3NlX2FwcChzZWxmKToKICAgICAgICAiIiIKICAgICAgICDEkMOzbmcgYXBwCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5oZWxwZXIuY2xvc2VfYXBwKHNlbGYuYXBwX3BhY2thZ2UpCiAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICBkZWYgZ2V0X2FwaV9iYXNlX3VybChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgVVJMIGfhu5FjIGPhu6dhIEFQSSBHb0xpa2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBn4buRYwogICAgICAgICIiIgogICAgICAgIGltcG9ydCBjb25maWcKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9IgogICAgCiAgICBkZWYgZ2V0X2FjY291bnRfdXJsKHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBM4bqleSBVUkwgQVBJIHTDoGkga2hv4bqjbiBj4bunYSBHb0xpa2UKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgdMOgaSBraG/huqNuCiAgICAgICAgIiIiCiAgICAgICAgaW1wb3J0IGNvbmZpZwogICAgICAgIHJldHVybiBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS97c2VsZi5hcHBfbmFtZX0tYWNjb3VudCIKICAgIAogICAgZGVmIGdldF9qb2JzX3VybChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgVVJMIEFQSSBqb2JzIGPhu6dhIEdvTGlrZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIEFQSSBqb2JzCiAgICAgICAgIiIiCiAgICAgICAgaW1wb3J0IGNvbmZpZwogICAgICAgIHJldHVybiBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS9hZHZlcnRpc2luZy9wdWJsaXNoZXJzL3tzZWxmLmFwcF9uYW1lfS9qb2JzIgogICAgCiAgICBkZWYgZ2V0X2pvYl9yZXBvcnRfdXJsKHNlbGYsIGpvYl9pZDogc3RyKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgVVJMIEFQSSBiw6FvIGPDoW8gam9iIGPhu6dhIEdvTGlrZQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl9pZDogSUQgY+G7p2Egam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIEFQSSBiw6FvIGPDoW8gam9iCiAgICAgICAgIiIiCiAgICAgICAgaW1wb3J0IGNvbmZpZwogICAgICAgIHJldHVybiBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS97c2VsZi5hcHBfbmFtZX0vam9icy97am9iX2lkfS9yZXBvcnQiCiAgICAKICAgIGRlZiBnZXRfam9iX3BhcmFtcyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGhhbSBz4buRIMSR4buDIGfhu41pIEFQSSBs4bqleSBqb2IKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBhY2NvdW50OiBUaMO0bmcgdGluIHTDoGkga2hv4bqjbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBEaWN0W3N0ciwgQW55XTogVGhhbSBz4buRCiAgICAgICAgIiIiCiAgICAgICAgIyBN4bq3YyDEkeG7i25oIGtow7RuZyBjw7MgdGhhbSBz4buRLCBj4bqnbiBvdmVycmlkZSDhu58gbOG7m3AgY29uCiAgICAgICAgcmV0dXJuIHt9CiAgICAKICAgIGRlZiBnZXRfYWNjb3VudHNfZnJvbV9kZXZpY2Uoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiUGjGsMahbmcgdGjhu6ljIGPGoSBz4bufIMSR4buDIGzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuLCBj4bqnbiBvdmVycmlkZSDhu58gY2xhc3MgY29uIiIiCiAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBzZXRfc2xlZXBfZnVuY3Rpb24oc2VsZiwgc2xlZXBfZnVuYzogQ2FsbGFibGVbW2Zsb2F0XSwgYm9vbF0pOgogICAgICAgICIiIgogICAgICAgIMSQ4bq3dCBow6BtIHNsZWVwIHTDuXkgY2jhu4luaAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHNsZWVwX2Z1bmM6IEjDoG0gc2xlZXAgbmjhuq1uIG3hu5l0IHRoYW0gc+G7kSBsw6Agc+G7kSBnacOieSB2w6AgdHLhuqMgduG7gSBUcnVlIG7hur91IHNsZWVwIMSR4bunIHRo4budaSBnaWFuLAogICAgICAgICAgICAgICAgICAgICAgICBGYWxzZSBu4bq/dSBi4buLIGThu6tuZyBs4bqhaQogICAgICAgICIiIgogICAgICAgIHNlbGYuX3NsZWVwX2Z1bmMgPSBzbGVlcF9mdW5jCiAgICAgICAgCiAgICBkZWYgc2FmZV9zbGVlcChzZWxmLCBzZWNvbmRzOiBmbG9hdCkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBOZ+G7pyBhbiB0b8OgbiwgY8OzIHRo4buDIGThu6tuZyBs4bqhaSBuZ2F5IGzhuq1wIHThu6ljCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2Vjb25kczogU+G7kSBnacOieSBj4bqnbiBuZ+G7pwogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IG5n4bunIMSR4bunIHRo4budaSBnaWFuLCBGYWxzZSBu4bq/dSBi4buLIGThu6tuZyBs4bqhaQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9zbGVlcF9mdW5jKHNlY29uZHMpCiAgICAKICAgIGRlZiBzd2l0Y2hfdG9fYWNjb3VudChzZWxmLCB0YXJnZXRfYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENodXnhu4NuIMSR4buVaSBzYW5nIHTDoGkga2hv4bqjbiBt4bulYyB0acOqdQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhcmdldF9hY2NvdW50OiBUw6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24gxJHhur9uCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiB7CiAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IGJvb2wsCiAgICAgICAgICAgICAgICAncmVhc29uJzogc3RyIChu4bq/dSB0aOG6pXQgYuG6oWkpLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBzdHIKICAgICAgICAgICAgfQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQYW5nIGNodXnhu4NuIMSR4buVaSBzYW5nIHTDoGkga2hv4bqjbiB7dGFyZ2V0X2FjY291bnQuZ2V0KCd1bmlxdWVfdXNlcm5hbWUnLCAndW5rbm93bicpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIMSQ4bq3dCB0aOG7nWkgZ2lhbiBjaOG7nSB04buRaSDEkWEgKGdpw6J5KQogICAgICAgICAgICB0aW1lb3V0ID0gNjAKICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wCiAgICAgICAgICAgIGN1cnJlbnRfdXNlcm5hbWUgPSBzZWxmLmdldF9jdXJyZW50X2xvZ2dlZF9pbl91c2VybmFtZSgpCiAgICAgICAgICAgIHRhcmdldF91c2VybmFtZSA9IHRhcmdldF9hY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgxJHDoyDEkcSDbmcgbmjhuq1wIMSRw7puZyB0w6BpIGtob+G6o24gcuG7k2ksIGtow7RuZyBj4bqnbiBjaHV54buDbiDEkeG7lWkKICAgICAgICAgICAgaWYgY3VycmVudF91c2VybmFtZSBhbmQgY3VycmVudF91c2VybmFtZSA9PSB0YXJnZXRfdXNlcm5hbWU6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyDEkcSDbmcgbmjhuq1wIHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSBy4buTaSIpCiAgICAgICAgICAgICAgICByZXR1cm4geydzdWNjZXNzJzogVHJ1ZSwgJ21lc3NhZ2UnOiBmJ8SQw6MgxJHEg25nIG5o4bqtcCB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0nfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBjaMawYSDEkcSDbmcgbmjhuq1wIMSRw7puZyB0w6BpIGtob+G6o24sIHRo4buxYyBoaeG7h24gY2h1eeG7g24gxJHhu5VpCiAgICAgICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyBQaMawxqFuZyB0aOG7qWMgbsOgeSBz4bq9IMSRxrDhu6NjIGdoaSDEkcOoIGLhu59pIGzhu5twIGNvbiB0w7l5IHRoZW8g4bupbmcgZOG7pW5nCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoX3Jlc3VsdCA9IHNlbGYuX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2godGFyZ2V0X2FjY291bnQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IHF14bqjIHRy4bqjIHbhu4EgdOG7qyBfcGVyZm9ybV9hY2NvdW50X3N3aXRjaAogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc3dpdGNoX3Jlc3VsdCwgZGljdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzd2l0Y2hfcmVzdWx0LmdldCgnc3VjY2VzcycsIEZhbHNlKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzd2l0Y2hfcmVzdWx0ICAjIFRy4bqjIHbhu4EgbmdheSBs4buXaSB04burIF9wZXJmb3JtX2FjY291bnRfc3dpdGNoCiAgICAgICAgICAgICAgICAgICAgZWxpZiBub3Qgc3dpdGNoX3Jlc3VsdDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBUxrDGoW5nIHRow61jaCB24bubaSBpbXBsZW1lbnRhdGlvbiBjxakgdHLhuqMgduG7gSBib29sZWFuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWFzb24nOiAnc3dpdGNoX2ZhaWxlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICdLaMO0bmcgdGjhu4MgY2h1eeG7g24gdMOgaSBraG/huqNuJwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyDEkOG7o2kgbeG7mXQgY2jDunQgxJHhu4Mg4bupbmcgZOG7pW5nIGxvYWQgeG9uZwogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSB4ZW0gxJHDoyBjaHV54buDbiDEkcO6bmcgdMOgaSBraG/huqNuIGNoxrBhCiAgICAgICAgICAgICAgICAgICAgbmV3X3VzZXJuYW1lID0gc2VsZi5nZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5ld191c2VybmFtZSBhbmQgbmV3X3VzZXJuYW1lID09IHRhcmdldF91c2VybmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgY2h1eeG7g24gc2FuZyB0w6BpIGtob+G6o24ge3RhcmdldF91c2VybmFtZX0gdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgxJHEg25nIG5o4bqtcCB0cm9uZyBEQgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnJlc2V0X2xvZ2luX3N0YXR1c19ieV9hcHAoc2VsZi5hcHBfbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudCh0YXJnZXRfYWNjb3VudFsiaWQiXSwgeyJpc19sb2dpbiI6IFRydWUsICJpc19zeW5jIjogRmFsc2V9KQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsnc3VjY2Vzcyc6IFRydWUsICdtZXNzYWdlJzogZidDaHV54buDbiBzYW5nIHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSB0aMOgbmggY8O0bmcnfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgY2jGsGEgdGjDoG5oIGPDtG5nLCDEkeG7o2kgbeG7mXQgY2jDunQgcuG7k2kgdGjhu60gbOG6oWkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBjaHV54buDbiB0w6BpIGtob+G6o246IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHRo4buDIGNodXnhu4NuIHNhbmcgdMOgaSBraG/huqNuIHt0YXJnZXRfdXNlcm5hbWV9IHNhdSB7dGltZW91dH0gZ2nDonkiKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwgCiAgICAgICAgICAgICAgICAncmVhc29uJzogJ3RpbWVvdXQnLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBmJ0tow7RuZyB0aOG7gyBjaHV54buDbiBzYW5nIHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSBzYXUge3RpbWVvdXR9IGdpw6J5JwogICAgICAgICAgICB9CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgY2h1eeG7g24gdMOgaSBraG/huqNuIikKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsIAogICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdleGNlcHRpb24nLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBmJ0zhu5dpIGtoaSBjaHV54buDbiB0w6BpIGtob+G6o246IHtzdHIoZSl9JwogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBfcGVyZm9ybV9hY2NvdW50X3N3aXRjaChzZWxmLCB0YXJnZXRfYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gY8OhYyB0aGFvIHTDoWMgVUkgxJHhu4MgY2h1eeG7g24gdMOgaSBraG/huqNuCiAgICAgICAgUGjGsMahbmcgdGjhu6ljIG7DoHkgY+G6p24gxJHGsOG7o2MgZ2hpIMSRw6ggYuG7n2kgbOG7m3AgY29uCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFyZ2V0X2FjY291bnQ6IFTDoGkga2hv4bqjbiBj4bqnbiBjaHV54buDbiDEkeG6v24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogYm9vbCwKICAgICAgICAgICAgICAgICdyZWFzb24nOiBzdHIgKG7hur91IHRo4bqldCBi4bqhaSAtICdhY2NvdW50X25vdF9mb3VuZCcsICd1aV9lcnJvcicsIGV0Yy4pLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBzdHIKICAgICAgICAgICAgfQogICAgICAgICIiIgogICAgICAgICMgUGjGsMahbmcgdGjhu6ljIGPGoSBz4bufIGNo4buJIGxvZyBj4bqjbmggYsOhbwogICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiJQaMawxqFuZyB0aOG7qWMgX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2ggY2jGsGEgxJHGsOG7o2MgdHJp4buDbiBraGFpIGNobyB7c2VsZi5fX2NsYXNzX18uX19uYW1lX199IikKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLCAKICAgICAgICAgICAgJ3JlYXNvbic6ICdub3RfaW1wbGVtZW50ZWQnLAogICAgICAgICAgICAnbWVzc2FnZSc6IGYnUGjGsMahbmcgdGjhu6ljIF9wZXJmb3JtX2FjY291bnRfc3dpdGNoIGNoxrBhIMSRxrDhu6NjIHRyaeG7g24ga2hhaSBjaG8ge3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffScKICAgICAgICB9CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfbG9nZ2VkX2luX3VzZXJuYW1lKHNlbGYpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdXNlcm5hbWUgY+G7p2EgdMOgaSBraG/huqNuIMSRYW5nIMSRxINuZyBuaOG6rXAKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHIgaG/hurdjIE5vbmU6IFVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wLCBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgIyBQaMawxqFuZyB0aOG7qWMgY8ahIHPhu58gY2jhu4kgbG9nIGPhuqNuaCBiw6FvCiAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIlBoxrDGoW5nIHRo4bupYyBnZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUgY2jGsGEgxJHGsOG7o2MgdHJp4buDbiBraGFpIGNobyB7c2VsZi5fX2NsYXNzX18uX19uYW1lX199IikKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgcmVjb3JkX2pvYl9oaXN0b3J5KHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldLCByZXN1bHQ6IERpY3Rbc3RyLCBBbnldKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgR2hpIGzhuqFpIGzhu4tjaCBz4butIGpvYiB2w6BvIGRhdGFiYXNlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICByZXN1bHQ6IEvhur90IHF14bqjIHRo4buxYyBoaeG7h24gam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVVJRCBj4bunYSBi4bqjbiBnaGkgbOG7i2NoIHPhu60gam9iIGhv4bq3YyBjaHXhu5dpIHLhu5duZyBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgZGV2aWNlX2lkCiAgICAgICAgICAgIGRldmljZV9pZCA9IHNlbGYuZGIuZ2V0X29yX2NyZWF0ZV9kZXZpY2VfaWQoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHXhuqluIGLhu4sgZOG7ryBsaeG7h3Ugam9iIGhpc3RvcnkKICAgICAgICAgICAgam9iX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAiYWNjb3VudF91dWlkIjogYWNjb3VudC5nZXQoImFjY291bnRfdXVpZCIsICIiKSwKICAgICAgICAgICAgICAgICJkZXZpY2VfaWQiOiBkZXZpY2VfaWQsCiAgICAgICAgICAgICAgICAiYXBwIjogc2VsZi5hcHBfbmFtZSwKICAgICAgICAgICAgICAgICJqb2JfaWQiOiBqb2IuZ2V0KCJpZCIsICIiKSwKICAgICAgICAgICAgICAgICJqb2JfdHlwZSI6IGpvYi5nZXQoInR5cGUiLCAiIiksCiAgICAgICAgICAgICAgICAib2JqZWN0X2lkIjogam9iLmdldCgib2JqZWN0X2lkIiwgIiIpLAogICAgICAgICAgICAgICAgImxpbmsiOiBqb2IuZ2V0KCJsaW5rIiwgIiIpLAogICAgICAgICAgICAgICAgInN0YXR1cyI6IHJlc3VsdC5nZXQoInN0YXR1cyIsIDApLAogICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiByZXN1bHQuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpLAogICAgICAgICAgICAgICAgInByaWNlIjogam9iLmdldCgicHJpY2VfYWZ0ZXJfY29zdCIsIDApLAogICAgICAgICAgICAgICAgImVycm9yX21lc3NhZ2UiOiByZXN1bHQuZ2V0KCJtZXNzYWdlIiwgIiIpIGlmIG5vdCByZXN1bHQuZ2V0KCJzdWNjZXNzIiwgRmFsc2UpIGVsc2UgIiIsCiAgICAgICAgICAgICAgICAiY3JlYXRlZF9hdCI6IGludCh0aW1lLnRpbWUoKSksCiAgICAgICAgICAgICAgICAiaXNfc3luYyI6IEZhbHNlICAjIMSQ4bqjbSBi4bqjbyB0cuG6oW5nIHRow6FpIGzDoCBjaMawYSDEkeG7k25nIGLhu5kKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBMxrB1IHbDoG8gZGF0YWJhc2UKICAgICAgICAgICAgam9iX3V1aWQgPSBzZWxmLmRiLmFkZF9qb2JfaGlzdG9yeShqb2JfZGF0YSkKICAgICAgICAgICAgaWYgam9iX3V1aWQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIsSQw6MgbMawdSBs4buLY2ggc+G7rSBqb2Ige2pvYi5nZXQoJ2lkJyl9IHbDoG8gZGF0YWJhc2UgduG7m2kgVVVJRDoge2pvYl91dWlkfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYiS2jDtG5nIHRo4buDIGzGsHUgbOG7i2NoIHPhu60gam9iIHtqb2IuZ2V0KCdpZCcpfSB2w6BvIGRhdGFiYXNlIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBqb2JfdXVpZAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgZ2hpIGzhu4tjaCBz4butIGpvYiIpCiAgICAgICAgICAgIHJldHVybiAiIgoKICAgIGRlZiByZXBvcnRfam9iX2NvbXBsZXRlZChzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSwgam9iOiBEaWN0W3N0ciwgQW55XSwgcmVwb3J0X2RhdGE6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBCw6FvIGPDoW8gam9iIMSRw6MgaG/DoG4gdGjDoG5oCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICByZXBvcnRfZGF0YTogROG7ryBsaeG7h3UgYsOhbyBjw6FvCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBL4bq/dCBxdeG6oyBiw6FvIGPDoW8gdOG7qyBBUEkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTOG6pXkgam9iX2lkIHThu6sgam9iCiAgICAgICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICAgICAgaWYgbm90IGpvYl9pZDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgam9iX2lkIHRyb25nIGpvYiIpCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6ICJLaMO0bmcgdMOsbSB0aOG6pXkgam9iX2lkIHRyb25nIGpvYiJ9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBDaHXhuqluIGLhu4sgZOG7ryBsaeG7h3UgYsOhbyBjw6FvCiAgICAgICAgICAgIHBheWxvYWQgPSB7CiAgICAgICAgICAgICAgICAiaWQiOiBqb2JfaWQsCiAgICAgICAgICAgICAgICAic3RhdHVzIjogVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGThu68gbGnhu4d1IGLDoW8gY8OhbyBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgcmVwb3J0X2RhdGE6CiAgICAgICAgICAgICAgICBwYXlsb2FkLnVwZGF0ZShyZXBvcnRfZGF0YSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSSBiw6FvIGPDoW8gam9iIMSRw6MgaG/DoG4gdGjDoG5oCiAgICAgICAgICAgIHVybCA9IGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L2FkdmVydGlzaW5nL3B1Ymxpc2hlcnMve3NlbGYuYXBwX25hbWV9L2NvbXBsZXRlLWpvYnMiCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuZ29saWtlX3NlcnZpY2UuYXBpX3JlcXVlc3QodXJsLCBtZXRob2Q9IlBPU1QiLCBwYXlsb2FkPXBheWxvYWQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcmVzdWx0OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBiw6FvIGPDoW8gam9iIMSRw6MgaG/DoG4gdGjDoG5oIikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIktow7RuZyB0aOG7gyBiw6FvIGPDoW8gam9iIMSRw6MgaG/DoG4gdGjDoG5oIn0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBiw6FvIGPDoW8gam9iIHtqb2JfaWR9IGhvw6BuIHRow6BuaCB0aMOgbmggY8O0bmciKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJtZXNzYWdlIjogIsSQw6MgYsOhbyBjw6FvIGpvYiBob8OgbiB0aMOgbmggdGjDoG5oIGPDtG5nIiwgImRhdGEiOiByZXN1bHR9CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgYsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaCIpCiAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogZiJM4buXaSBraGkgYsOhbyBjw6FvIGpvYiDEkcOjIGhvw6BuIHRow6BuaDoge3N0cihlKX0ifQogICAgICAgICAgICAKICAgIGRlZiByZXBvcnRfam9iX3NraXBwZWQoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0sIGpvYjogRGljdFtzdHIsIEFueV0sIHJlYXNvbjogc3RyID0gIiIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIELDoW8gY8OhbyBqb2IgxJHDoyBi4buLIGLhu48gcXVhCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgam9iOiBUaMO0bmcgdGluIGpvYgogICAgICAgICAgICByZWFzb246IEzDvSBkbyBi4buPIHF1YSBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIGLDoW8gY8OhbyB04burIEFQSQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSBqb2JfaWQgdOG7qyBqb2IKICAgICAgICAgICAgam9iX2lkID0gam9iLmdldCgiaWQiKQogICAgICAgICAgICBpZiBub3Qgam9iX2lkOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0w6xtIHRo4bqleSBqb2JfaWQgdHJvbmcgam9iIikKICAgICAgICAgICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJlcnJvciIsICJtZXNzYWdlIjogIktow7RuZyB0w6xtIHRo4bqleSBqb2JfaWQgdHJvbmcgam9iIn0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIENodeG6qW4gYuG7iyBk4buvIGxp4buHdSBiw6FvIGPDoW8KICAgICAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICJpZCI6IGpvYl9pZAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIGzDvSBkbyBu4bq/dSBjw7MKICAgICAgICAgICAgaWYgcmVhc29uOgogICAgICAgICAgICAgICAgcGF5bG9hZFsicmVhc29uIl0gPSByZWFzb24KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu41pIEFQSSBiw6FvIGPDoW8gam9iIMSRw6MgYuG7iyBi4buPIHF1YQogICAgICAgICAgICB1cmwgPSBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS9hZHZlcnRpc2luZy9wdWJsaXNoZXJzL3tzZWxmLmFwcF9uYW1lfS9za2lwLWpvYnMiCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuZ29saWtlX3NlcnZpY2UuYXBpX3JlcXVlc3QodXJsLCBtZXRob2Q9IlBPU1QiLCBwYXlsb2FkPXBheWxvYWQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcmVzdWx0OgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyBiw6FvIGPDoW8gam9iIMSRw6MgYuG7iyBi4buPIHF1YSIpCiAgICAgICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZXJyb3IiLCAibWVzc2FnZSI6ICJLaMO0bmcgdGjhu4MgYsOhbyBjw6FvIGpvYiDEkcOjIGLhu4sgYuG7jyBxdWEifQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGLDoW8gY8OhbyBqb2Ige2pvYl9pZH0gYuG7iyBi4buPIHF1YSB0aMOgbmggY8O0bmciKQogICAgICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAic3VjY2VzcyIsICJtZXNzYWdlIjogIsSQw6MgYsOhbyBjw6FvIGpvYiBi4buLIGLhu48gcXVhIHRow6BuaCBjw7RuZyIsICJkYXRhIjogcmVzdWx0fQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGLDoW8gY8OhbyBqb2IgxJHDoyBi4buLIGLhu48gcXVhIikKICAgICAgICAgICAgcmV0dXJuIHsic3RhdHVzIjogImVycm9yIiwgIm1lc3NhZ2UiOiBmIkzhu5dpIGtoaSBiw6FvIGPDoW8gam9iIMSRw6MgYuG7iyBi4buPIHF1YToge3N0cihlKX0ifQogICAgCiAgICBkZWYgZ2V0X2FjY291bnRfbGlzdF91cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9IgogICAgICAgIAogICAgZGVmIGdldF9hY2NvdW50X2RldGFpbF91cmwoc2VsZikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgY2hpIHRp4bq/dCB0w6BpIGtob+G6o24KICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHI6IFVSTCBBUEkgY2hpIHRp4bq/dCB0w6BpIGtob+G6o24KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gZiJ7Y29uZmlnLkdPTElLRV9BUElfQkFTRX0ve3NlbGYuYXBwX25hbWV9LWFjY291bnQiCiAgICAgICAgCiAgICBkZWYgZ2V0X2pvYl9saXN0X3VybChzZWxmKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgVVJMIEFQSSBkYW5oIHPDoWNoIGpvYgogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIEFQSSBkYW5oIHPDoWNoIGpvYgogICAgICAgICIiIgogICAgICAgIHJldHVybiBmIntjb25maWcuR09MSUtFX0FQSV9CQVNFfS9hZHZlcnRpc2luZy9wdWJsaXNoZXJzL3tzZWxmLmFwcF9uYW1lfS9qb2JzIgogICAgICAgIAogICAgZGVmIGdldF9qb2JfcmVwb3J0X3VybChzZWxmLCBqb2JfaWQ6IHN0cikgLT4gc3RyOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IFVSTCBBUEkgYsOhbyBjw6FvIGpvYgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGpvYl9pZDogSUQgY+G7p2Egam9iCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIHN0cjogVVJMIEFQSSBiw6FvIGPDoW8gam9iCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGYie2NvbmZpZy5HT0xJS0VfQVBJX0JBU0V9L3tzZWxmLmFwcF9uYW1lfS9qb2JzL3tqb2JfaWR9L3JlcG9ydCI=').decode('utf-8'))
