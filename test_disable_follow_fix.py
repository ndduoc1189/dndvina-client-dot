import base64
exec(base64.b64decode('IiIiClNjcmlwdCB0ZXN0IHZlcmlmeSBmaXggZGlzYWJsZV9mb2xsb3cKIiIiCmltcG9ydCBzeXMKaW1wb3J0IG9zCnN5cy5wYXRoLmFwcGVuZChvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKSkpCgpmcm9tIHNlcnZpY2VzLmRiX3NlcnZpY2UgaW1wb3J0IERhdGFiYXNlU2VydmljZQoKZGVmIHRlc3RfZGlzYWJsZV9mb2xsb3dfZml4KCk6CiAgICAiIiJUZXN0IHhlbSBkaXNhYmxlX2ZvbGxvdyBjw7MgxJHGsOG7o2MgcHJlc2VydmUgxJHDum5nIGtow7RuZyIiIgogICAgcHJpbnQoIlRlc3RpbmcgZGlzYWJsZV9mb2xsb3cgcHJlc2VydmF0aW9uLi4uIikKICAgIAogICAgZGIgPSBEYXRhYmFzZVNlcnZpY2UoKQogICAgCiAgICAjIFRlc3QgMTogTOG6pXkgYWNjb3VudCBjw7MgZGlzYWJsZV9mb2xsb3cgPSBUcnVlCiAgICBhY2NvdW50cyA9IGRiLmdldF9hY2NvdW50cygpCiAgICAKICAgIHRlc3RfYWNjb3VudCA9IE5vbmUKICAgIGZvciBhY2NvdW50IGluIGFjY291bnRzOgogICAgICAgIGlmIGFjY291bnQuZ2V0KCJkaXNhYmxlX2ZvbGxvdyIpOgogICAgICAgICAgICB0ZXN0X2FjY291bnQgPSBhY2NvdW50CiAgICAgICAgICAgIGJyZWFrCiAgICAKICAgIGlmIHRlc3RfYWNjb3VudDoKICAgICAgICBhY2NvdW50X2lkID0gdGVzdF9hY2NvdW50WyJpZCJdCiAgICAgICAgcHJpbnQoZiJGb3VuZCB0ZXN0IGFjY291bnQ6IHt0ZXN0X2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSB3aXRoIGRpc2FibGVfZm9sbG93ID0ge3Rlc3RfYWNjb3VudFsnZGlzYWJsZV9mb2xsb3cnXX0iKQogICAgICAgIAogICAgICAgICMgVGVzdCBnZXRfYWNjb3VudAogICAgICAgIHNpbmdsZV9hY2NvdW50ID0gZGIuZ2V0X2FjY291bnQoYWNjb3VudF9pZCkKICAgICAgICBwcmludChmImdldF9hY2NvdW50IHJlc3VsdDogZGlzYWJsZV9mb2xsb3cgPSB7c2luZ2xlX2FjY291bnRbJ2Rpc2FibGVfZm9sbG93J119IikKICAgICAgICAKICAgICAgICAjIFRlc3QgZ2V0X2FjY291bnRfYnlfdXVpZAogICAgICAgIGlmIHRlc3RfYWNjb3VudC5nZXQoInV1aWQiKToKICAgICAgICAgICAgdXVpZF9hY2NvdW50ID0gZGIuZ2V0X2FjY291bnRfYnlfdXVpZCh0ZXN0X2FjY291bnRbInV1aWQiXSkKICAgICAgICAgICAgcHJpbnQoZiJnZXRfYWNjb3VudF9ieV91dWlkIHJlc3VsdDogZGlzYWJsZV9mb2xsb3cgPSB7dXVpZF9hY2NvdW50WydkaXNhYmxlX2ZvbGxvdyddfSIpCiAgICAgICAgCiAgICAgICAgIyBWZXJpZnkgc3RhdHVzIGlzIHByZXNlcnZlZAogICAgICAgIGlmIHNpbmdsZV9hY2NvdW50WyJkaXNhYmxlX2ZvbGxvdyJdID09IHRlc3RfYWNjb3VudFsiZGlzYWJsZV9mb2xsb3ciXToKICAgICAgICAgICAgcHJpbnQoIuKchSBQQVNTOiBkaXNhYmxlX2ZvbGxvdyBzdGF0dXMgcHJlc2VydmVkISIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIuKdjCBGQUlMOiBkaXNhYmxlX2ZvbGxvdyBzdGF0dXMgY2hhbmdlZCEiKQogICAgZWxzZToKICAgICAgICBwcmludCgiTm8gYWNjb3VudCB3aXRoIGRpc2FibGVfZm9sbG93PVRydWUgZm91bmQgZm9yIHRlc3RpbmciKQogICAgICAgIAogICAgICAgICMgQ3JlYXRlIHRlc3QgYnkgdGVtcG9yYXJpbHkgZGlzYWJsaW5nIGFuIGFjY291bnQKICAgICAgICBhY3RpdmVfYWNjb3VudHMgPSBbYWNjIGZvciBhY2MgaW4gYWNjb3VudHMgaWYgbm90IGFjYy5nZXQoImRpc2FibGVfZm9sbG93IildCiAgICAgICAgaWYgYWN0aXZlX2FjY291bnRzOgogICAgICAgICAgICB0ZXN0X2FjYyA9IGFjdGl2ZV9hY2NvdW50c1swXQogICAgICAgICAgICBhY2NvdW50X2lkID0gdGVzdF9hY2NbImlkIl0KICAgICAgICAgICAgcHJpbnQoZiJUZXN0aW5nIHdpdGggYWNjb3VudDoge3Rlc3RfYWNjWyd1bmlxdWVfdXNlcm5hbWUnXX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUZW1wb3JhcmlseSBkaXNhYmxlCiAgICAgICAgICAgIGRiLnVwZGF0ZV9hY2NvdW50KGFjY291bnRfaWQsIHsiZGlzYWJsZV9mb2xsb3ciOiBUcnVlfSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGVzdCBpZiBpdCdzIHByZXNlcnZlZAogICAgICAgICAgICByZXRyaWV2ZWQgPSBkYi5nZXRfYWNjb3VudChhY2NvdW50X2lkKQogICAgICAgICAgICBpZiByZXRyaWV2ZWRbImRpc2FibGVfZm9sbG93Il06CiAgICAgICAgICAgICAgICBwcmludCgi4pyFIFBBU1M6IGRpc2FibGVfZm9sbG93PVRydWUgcHJlc2VydmVkIGFmdGVyIHVwZGF0ZSEiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIuKdjCBGQUlMOiBkaXNhYmxlX2ZvbGxvdz1UcnVlIG5vdCBwcmVzZXJ2ZWQhIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVzdG9yZSBvcmlnaW5hbCBzdGF0ZQogICAgICAgICAgICBkYi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB7ImRpc2FibGVfZm9sbG93IjogRmFsc2V9KQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHRlc3RfZGlzYWJsZV9mb2xsb3dfZml4KCkK').decode('utf-8'))
