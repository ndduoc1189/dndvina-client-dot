import base64
exec(base64.b64decode('aW1wb3J0IGRhdGV0aW1lCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IHJlCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIExpc3QsIE9wdGlvbmFsCmZyb20gam9icy5qb2JfYmFzZSBpbXBvcnQgQmFzZUpvYgoKY2xhc3MgVGlrdG9rSm9iKEJhc2VKb2IpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGRiX3NlcnZpY2UsIGhlbHBlcl9zZXJ2aWNlLCBnb2xpa2Vfc2VydmljZSkKICAgICAgICBzZWxmLmFwcF9wYWNrYWdlID0gImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbCIKICAgICAgICBzZWxmLmFwcF9uYW1lID0gInRpa3RvayIKICAgICAgICAKICAgIGRlZiBnZXRfYWNjb3VudHNfZnJvbV9kZXZpY2Uoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gVGlrdG9rIHThu6sgdGhp4bq/dCBi4buLIiIiCiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBN4bufIOG7qW5nIGThu6VuZyBUaWtUb2sKICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2jhu50gbcOgbiBow6xuaCBjaMOtbmggdOG6o2kgLSBraeG7g20gdHJhIGNobyDEkeG6v24ga2hpIGPDsyAiVHJhbmcgY2jhu6ciIGhv4bq3YyB04buRaSDEkWEgMjBzCiAgICAgICAgICAgIGhvbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudChjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIiwgdGltZW91dD0yMCkKICAgICAgICAgICAgaWYgbm90IGhvbWVfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIktow7RuZyB0aOG7gyB04bqjaSBtw6BuIGjDrG5oIGNow61uaCBUaWtUb2sgc2F1IDIwIGdpw6J5IikKICAgICAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBuw7p0ICJI4buTIHPGoSIgdsOgIG5o4bqlcCB2w6BvCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9uYXZpZ2F0ZV90b19wcm9maWxlX3RhYigpOgogICAgICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIG1lbnUgaOG7kyBzxqEgxJHhu4MgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAgICAgaWYgbm90IHNlbGYuX29wZW5fcHJvZmlsZV9tZW51KCk6CiAgICAgICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgWE1MIG3DoG4gaMOsbmggc2F1IGtoaSBt4bufIG1lbnUKICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gbsO6dCAiVGjDqm0gdMOgaSBraG/huqNuIgogICAgICAgICAgICBhZGRfYWNjb3VudF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iVGjDqm0gdMOgaSBraG/huqNuIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGFkZF9hY2NvdW50X2J1dHRvbjoKICAgICAgICAgICAgICAgICMgVMOsbSBkYW5oIHPDoWNoIHTDoGkga2hv4bqjbiAoUmVjeWNsZXJWaWV3KSAtIGzDoCBjaGEgY+G7p2EgbsO6dCAiVGjDqm0gdMOgaSBraG/huqNuIgogICAgICAgICAgICAgICAgcmVjeWNsZXJfdmlldyA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgUmVjeWNsZXJWaWV3CiAgICAgICAgICAgICAgICBhbGxfcmVjeWNsZXJfdmlld3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwgCiAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZHgucmVjeWNsZXJ2aWV3LndpZGdldC5SZWN5Y2xlclZpZXciCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSBSZWN5Y2xlclZpZXcgY2jhu6lhIGPDoWMgdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBmb3IgcnYgaW4gYWxsX3JlY3ljbGVyX3ZpZXdzOgogICAgICAgICAgICAgICAgICAgIHJ2X2JvdW5kcyA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X2JvdW5kcyhydikKICAgICAgICAgICAgICAgICAgICBhZGRfYWNjb3VudF9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoYWRkX2FjY291bnRfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gYWRkX2FjY291bnRfYnV0dG9uIGPDsyBu4bqxbSB0cm9uZyByZWN5Y2xlcl92aWV3IGtow7RuZwogICAgICAgICAgICAgICAgICAgIGlmIChydl9ib3VuZHNbMF0gPD0gYWRkX2FjY291bnRfYm91bmRzWzBdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICBydl9ib3VuZHNbMV0gPD0gYWRkX2FjY291bnRfYm91bmRzWzFdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICBydl9ib3VuZHNbMl0gPj0gYWRkX2FjY291bnRfYm91bmRzWzJdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICBydl9ib3VuZHNbM10gPj0gYWRkX2FjY291bnRfYm91bmRzWzNdKToKICAgICAgICAgICAgICAgICAgICAgICAgcmVjeWNsZXJfdmlldyA9IHJ2CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHJlY3ljbGVyX3ZpZXc6CiAgICAgICAgICAgICAgICAgICAgIyBUw6xtIHThuqV0IGPhuqMgbsO6dCAoQnV0dG9uKSB0cm9uZyBSZWN5Y2xlclZpZXcgYuG6sW5nIGNsYXNzIHRoYXkgdsOsIHJlc291cmNlLWlkCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9idXR0b25zID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGZvciBidXR0b24gaW4gYWNjb3VudF9idXR0b25zOgogICAgICAgICAgICAgICAgICAgICAgICAjIELhu48gcXVhIG7DunQgIlRow6ptIHTDoGkga2hv4bqjbiIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnV0dG9uLmdldCgiY29udGVudC1kZXNjIikgPT0gIlRow6ptIHTDoGkga2hv4bqjbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBM4bqleSB0w6puIHTDoGkga2hv4bqjbiB04burIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGJ1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFTDrG0gVGV4dFZpZXcgdHJvbmcgYnV0dG9uIGLhurFuZyBjbGFzcyB0aGF5IHbDrCByZXNvdXJjZS1pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dHZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuVGV4dFZpZXciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTOG7jWMgdGV4dHZpZXcgdGhlbyBib3VuZHMgxJHhu4MgdMOsbSDEkcO6bmcgY8OhaSB0aHXhu5ljIHbhu4EgYnV0dG9uIG7DoHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbl9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHR2IGluIHRleHR2aWV3czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dl9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHModHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR2X2JvdW5kc1swXSA+PSBidXR0b25fYm91bmRzWzBdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dl9ib3VuZHNbMV0gPj0gYnV0dG9uX2JvdW5kc1sxXSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHZfYm91bmRzWzJdIDw9IGJ1dHRvbl9ib3VuZHNbMl0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR2X2JvdW5kc1szXSA8PSBidXR0b25fYm91bmRzWzNdKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQodHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSDEkeG7gyBraMO0bmcgbOG6pXkgcGjhuqNpIHRleHQgcuG7l25nIGhv4bq3YyAibnVsbCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGV4dCBhbmQgdGV4dCAhPSAibnVsbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIELhu48gcXVhIG7DunQgIsSQw7NuZyIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUgPT0gIsSQw7NuZyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSB0w6BpIGtob+G6o24gY8OzIMSRYW5nIMSRxINuZyBuaOG6rXAga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlzX2N1cnJlbnQgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBUw6xtIGThuqV1IGtp4buDbSB0cm9uZyBidXR0b24gYuG6sW5nIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgICAgICAgICBjaGVja21hcmtzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfZGVzYz0iROG6pXUga2nhu4NtIgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGThuqV1IGtp4buDbSBjw7MgdGh14buZYyB24buBIGJ1dHRvbiBuw6B5IGtow7RuZwogICAgICAgICAgICAgICAgICAgICAgICBidXR0b25fYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGNoZWNrIGluIGNoZWNrbWFya3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHMoY2hlY2spCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tfYm91bmRzWzBdID49IGJ1dHRvbl9ib3VuZHNbMF0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfYm91bmRzWzFdID49IGJ1dHRvbl9ib3VuZHNbMV0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfYm91bmRzWzJdIDw9IGJ1dHRvbl9ib3VuZHNbMl0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfYm91bmRzWzNdIDw9IGJ1dHRvbl9ib3VuZHNbM10pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2N1cnJlbnQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ8WpbmcgY8OzIHRo4buDIGtp4buDbSB0cmEgdGh14buZYyB0w61uaCBzZWxlY3RlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBidXR0b24uZ2V0KCJzZWxlY3RlZCIpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2N1cnJlbnQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdXNlcm5hbWUgaOG7o3AgbOG7hyB0csaw4bubYyBraGkgdGjDqm0gdsOgbyBkYW5oIHPDoWNoCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lIGFuZCB1c2VybmFtZSAhPSAibnVsbCIgYW5kIHVzZXJuYW1lLnN0cmlwKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEzhu41jIHRow6ptIGPDoWMgdMOqbiBraMO0bmcgcGjhuqNpIHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUgbm90IGluIFsiQ8OgaSDEkeG6t3QiLCAiQ8OgaSDEkeG6t3QgdMOgaSBraG/huqNuIiwgIlTDuXkgY2jhu41uIiwgIk1lbnUiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmlja25hbWUiOiB1c2VybmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV91c2VybmFtZSI6IHVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidW5pcXVlX2lkIjogdXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiYWN0aXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzX2xvZ2luIjogaXNfY3VycmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiam9iX2VuYWJsZSI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsZXZlbCI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKGFjY291bnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUXVheSBs4bqhaSBtw6BuIGjDrG5oIGNow61uaAogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIucHJlc3NfYmFjaygpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24gVGlrVG9rIikKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIGFjY291bnRzCiAgICAKICAgIGRlZiBwZXJmb3JtX2pvYihzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSk6CiAgICAgICAgIiIiVGjhu7FjIGhp4buHbiBjw7RuZyB2aeG7h2MgduG7m2kgdMOgaSBraG/huqNuIFRpa1RvayIiIgogICAgICAgICMgU+G7rSBk4bulbmcgcGjGsMahbmcgdGjhu6ljIGPhu6dhIGzhu5twIGNoYQogICAgICAgIHN1cGVyKCkucGVyZm9ybV9qb2IoYWNjb3VudCkKICAgICAgICAKICAgIGRlZiBwZXJmb3JtX2NhcmUoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIk51w7RpIHTDoGkga2hv4bqjbiBUaWtUb2siIiIKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgbnXDtGkgdMOgaSBraG/huqNuIFRpa1Rvazoge2FjY291bnRbJ3VuaXF1ZV91c2VybmFtZSddfSIpCiAgICAgICAgIyBH4buNaSBwaMawxqFuZyB0aOG7qWMgbWluaSBjYXJlCiAgICAgICAgcmV0dXJuIHNlbGYucGVyZm9ybV9taW5pX2NhcmUoYWNjb3VudCkKICAgICAgICAKICAgIGRlZiBwZXJmb3JtX21pbmlfY2FyZShzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIG1pbmkgY2FyZSBjaG8gdMOgaSBraG/huqNuIFRpa1RvazoKICAgICAgICAxLiBW4buBIHRyYW5nIGNo4bunLCB4w6FjIG5o4bqtbiB0YWIgxJHhu4EgeHXhuqV0CiAgICAgICAgMi4gTMaw4bubdCDEkeG7gSB4deG6pXQgdHJvbmcgMi0zIHBow7p0CiAgICAgICAgMy4gTmfhuqt1IG5oacOqbiBi4bqlbSB2w6BvIEjhu5lwIHRoxrAsIGThu6tuZyAyLTVzLCB2deG7kXQgbMOqbiwgcXVheSBs4bqhaSB0cmFuZyBjaOG7pwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJC4bqvdCDEkeG6p3UgbWluaSBjYXJlIGNobyB0w6BpIGtob+G6o24gVGlrVG9rOiB7YWNjb3VudFsndW5pcXVlX3VzZXJuYW1lJ119IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgMS4gxJDhuqNtIGLhuqNvIHbhu4EgdHJhbmcgY2jhu6cgdsOgIHjDoWMgbmjhuq1uIHRhYiDEkeG7gSB4deG6pXQKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHRo4buDIHbhu4EgdHJhbmcgY2jhu6cgVGlrVG9rIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB2w6AgY2xpY2sgdsOgbyB0YWIgIkTDoG5oIGNobyBi4bqhbiIgKHRhYiDEkeG7gSB4deG6pXQpCiAgICAgICAgICAgIGZvcl95b3VfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IkTDoG5oIGNobyBi4bqhbiIpCiAgICAgICAgICAgIGlmIG5vdCBmb3JfeW91X3RhYjoKICAgICAgICAgICAgICAgIGZvcl95b3VfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iRMOgbmggY2hvIGLhuqFuIikKICAgICAgICAgICAgaWYgbm90IGZvcl95b3VfdGFiOgogICAgICAgICAgICAgICAgZm9yX3lvdV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iRm9yIFlvdSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgZm9yX3lvdV90YWI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIHRo4bqleSB0YWIgxJHhu4EgeHXhuqV0LCDEkWFuZyBjbGljayB2w6BvLi4uIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihmb3JfeW91X3RhYikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiDEkeG7gSB4deG6pXQsIGdp4bqjIMSR4buLbmggxJFhbmcg4bufIHRhYiDEkcO6bmciKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAyLiBMxrDhu5t0IMSR4buBIHh14bqldCB0cm9uZyAyLTMgcGjDunQKICAgICAgICAgICAgc2Nyb2xsX2R1cmF0aW9uID0gcmFuZG9tLnJhbmRpbnQoMTIwLCAxODApICAjIDItMyBwaMO6dAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiQuG6r3QgxJHhuqd1IGzGsOG7m3QgxJHhu4EgeHXhuqV0IHRyb25nIHtzY3JvbGxfZHVyYXRpb259IGdpw6J5Li4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICB2aWRlb19jb3VudCA9IDAKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlICh0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUpIDwgc2Nyb2xsX2R1cmF0aW9uOgogICAgICAgICAgICAgICAgIyBMxrDhu5t0IGzDqm4gxJHhu4MgY2h1eeG7g24gdmlkZW8gdGnhur9wIHRoZW8KICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIHZpZGVvX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOZ2jhu4kgbmfhuqt1IG5oacOqbiAzLTggZ2nDonkgZ2nhu69hIGPDoWMgdmlkZW8gKG5oxrAgbmfGsOG7nWkgZMO5bmcgdGjhuq10KQogICAgICAgICAgICAgICAgd2F0Y2hfdGltZSA9IHJhbmRvbS5yYW5kaW50KDMsIDgpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2F0Y2hfdGltZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBSYW5kb20gY8OzIDEwJSBraOG6oyBuxINuZyBi4bqlbSBsaWtlIHZpZGVvCiAgICAgICAgICAgICAgICBpZiByYW5kb20ucmFuZG9tKCkgPCAwLjE6ICAjIDEwJSBjaGFuY2UKICAgICAgICAgICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuX2ZpbmRfbGlrZV9idXR0b24oKQogICAgICAgICAgICAgICAgICAgIGlmIGxpa2VfYnV0dG9uIGFuZCBub3Qgc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChsaWtlX2J1dHRvbik6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlJhbmRvbSBsaWtlIHZpZGVvIHRyb25nIGtoaSBtaW5pIGNhcmUiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIobGlrZV9idXR0b24pCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFJhbmRvbSBjw7MgNSUga2jhuqMgbsSDbmcgYuG6pW0gc2hhcmUKICAgICAgICAgICAgICAgIGlmIHJhbmRvbS5yYW5kb20oKSA8IDAuMDU6ICAjIDUlIGNoYW5jZQogICAgICAgICAgICAgICAgICAgIHNoYXJlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IkNoaWEgc+G6uyIpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNoYXJlX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iU2hhcmUiKQogICAgICAgICAgICAgICAgICAgIGlmIHNoYXJlX2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiUmFuZG9tIGNsaWNrIHNoYXJlIHRyb25nIGtoaSBtaW5pIGNhcmUiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2hhcmVfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgIyBOaOG6pW4gYmFjayDEkeG7gyDEkcOzbmcgZGlhbG9nIHNoYXJlCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGzGsOG7m3Qge3ZpZGVvX2NvdW50fSB2aWRlbyB0cm9uZyB7c2Nyb2xsX2R1cmF0aW9ufSBnacOieSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIDMuIE5n4bqrdSBuaGnDqm4gYuG6pW0gdsOgbyBI4buZcCB0aMawICg1MCUga2jhuqMgbsSDbmcpCiAgICAgICAgICAgIGlmIHJhbmRvbS5yYW5kb20oKSA8IDAuNTogICMgNTAlIGNoYW5jZQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiUmFuZG9tIHRydXkgY+G6rXAgSOG7mXAgdGjGsC4uLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB2w6AgY2xpY2sgdsOgbyBI4buZcCB0aMawCiAgICAgICAgICAgICAgICBpbmJveF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJI4buZcCB0aMawIikKICAgICAgICAgICAgICAgIGlmIGluYm94X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIHRo4bqleSBI4buZcCB0aMawLCDEkWFuZyBjbGljayB2w6BvLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoaW5ib3hfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgROG7q25nIGzhuqFpIDItNSBnacOieQogICAgICAgICAgICAgICAgICAgIHdhaXRfdGltZSA9IHJhbmRvbS5yYW5kaW50KDIsIDUpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkThu6tuZyBs4bqhaSB7d2FpdF90aW1lfSBnacOieSB0cm9uZyBI4buZcCB0aMawLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVnXhu5F0IGzDqm4gdHJvbmcgSOG7mXAgdGjGsAogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlZ14buRdCBsw6puIHRyb25nIEjhu5lwIHRoxrAuLi4iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFF1YXkgbOG6oWkgdHJhbmcgY2jhu6cKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJRdWF5IGzhuqFpIHRyYW5nIGNo4bunIHThu6sgSOG7mXAgdGjGsC4uLiIpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuYmFja190b19ob21lKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBxdWF5IHbhu4EgdHJhbmcgY2jhu6cgdOG7qyBI4buZcCB0aMawIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgSOG7mXAgdGjGsCIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJTa2lwIHRydXkgY+G6rXAgSOG7mXAgdGjGsCBs4bqnbiBuw6B5IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIHbhu4EgdHJhbmcgY2jhu6cgY3Xhu5FpIGPDuW5nCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHRo4buDIMSR4bqjbSBi4bqjbyB24buBIHRyYW5nIGNo4bunIHNhdSBtaW5pIGNhcmUiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJIb8OgbiB0aMOgbmggbWluaSBjYXJlIGNobyB0w6BpIGtob+G6o24gVGlrVG9rOiB7YWNjb3VudFsndW5pcXVlX3VzZXJuYW1lJ119IikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBtaW5pIGNhcmUgY2hvIHTDoGkga2hv4bqjbiBUaWtUb2s6IHthY2NvdW50Wyd1bmlxdWVfdXNlcm5hbWUnXX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBD4buRIGfhuq9uZyB24buBIHRyYW5nIGNo4bunIG7hur91IGPDsyBs4buXaQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9lbnN1cmVfZm9yX3lvdV90YWIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRhYiDEkeG7gSB4deG6pXQgKEZvciBZb3UpCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUw6xtIHRhYiAiRMOgbmggY2hvIGLhuqFuIiBob+G6t2MgIkZvciBZb3UiCiAgICAgICAgICAgIGZvcl95b3VfdGV4dHMgPSBbIkTDoG5oIGNobyBi4bqhbiIsICJGb3IgWW91IiwgIsSQ4buBIHh14bqldCJdCiAgICAgICAgICAgIGZvcl95b3VfdGFiID0gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIHRleHQgaW4gZm9yX3lvdV90ZXh0czoKICAgICAgICAgICAgICAgIGZvcl95b3VfdGFiID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9dGV4dCkKICAgICAgICAgICAgICAgIGlmIGZvcl95b3VfdGFiOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgZm9yX3lvdV90YWI6CiAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gdGhlbyBjb250ZW50LWRlc2MKICAgICAgICAgICAgICAgIGZvciBkZXNjIGluIGZvcl95b3VfdGV4dHM6CiAgICAgICAgICAgICAgICAgICAgZm9yX3lvdV90YWIgPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPWRlc2MpCiAgICAgICAgICAgICAgICAgICAgaWYgZm9yX3lvdV90YWI6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBmb3JfeW91X3RhYjoKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gdGFiIGPDsyDEkcaw4bujYyBjaOG7jW4ga2jDtG5nCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChmb3JfeW91X3RhYik6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVGFiIMSR4buBIHh14bqldCBjaMawYSDEkcaw4bujYyBjaOG7jW4sIMSRYW5nIGNsaWNrIHbDoG8uLi4iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihmb3JfeW91X3RhYikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyB4w6FjIG5o4bqtbiB0YWIgxJHhu4EgeHXhuqV0IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgdGFiIMSR4buBIHh14bqldCIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgeMOhYyBuaOG6rW4gdGFiIMSR4buBIHh14bqldCIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX3Njcm9sbF9mb3JfeW91X2ZlZWQoc2VsZiwgZHVyYXRpb25fc2Vjb25kczogaW50KSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIEzGsOG7m3QgZmVlZCDEkeG7gSB4deG6pXQgdHJvbmcga2hv4bqjbmcgdGjhu51pIGdpYW4gbmjhuqV0IMSR4buLbmgKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBkdXJhdGlvbl9zZWNvbmRzOiBUaOG7nWkgZ2lhbiBsxrDhu5t0IChnacOieSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIHNjcm9sbF9jb3VudCA9IDAKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IGR1cmF0aW9uX3NlY29uZHM6CiAgICAgICAgICAgICAgICAjIFZ14buRdCBsw6puIMSR4buDIGNodXnhu4NuIHZpZGVvIHRp4bq/cCB0aGVvCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICBzY3JvbGxfY291bnQgKz0gMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5naOG7iSBuZ+G6q3Ugbmhpw6puIDItNiBnacOieSBuaMawIG5nxrDhu51pIGTDuW5nIHRo4bqtdCB4ZW0gdmlkZW8KICAgICAgICAgICAgICAgIHdhdGNoX3RpbWUgPSByYW5kb20ucmFuZGludCgyLCA2KQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKHdhdGNoX3RpbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUmFuZG9tIHRo4buJbmggdGhv4bqjbmcgZOG7q25nIGzDonUgaMahbiAobmjGsCDEkWFuZyB4ZW0gdmlkZW8gdGjDuiB24buLKQogICAgICAgICAgICAgICAgaWYgcmFuZG9tLnJhbmRpbnQoMSwgMTApID09IDE6ICAjIDEwJSB4w6FjIHN14bqldAogICAgICAgICAgICAgICAgICAgIGxvbmdfd2F0Y2hfdGltZSA9IHJhbmRvbS5yYW5kaW50KDgsIDE1KQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJE4burbmcgeGVtIHZpZGVvIGzDonUgaMahbjoge2xvbmdfd2F0Y2hfdGltZX1zIikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAobG9uZ193YXRjaF90aW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIExvZyB0aeG6v24gdHLDrG5oIG3hu5dpIDMwIGdpw6J5CiAgICAgICAgICAgICAgICBlbGFwc2VkID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lCiAgICAgICAgICAgICAgICBpZiBlbGFwc2VkID4gMCBhbmQgaW50KGVsYXBzZWQpICUgMzAgPT0gMCBhbmQgc2Nyb2xsX2NvdW50ID4gMDoKICAgICAgICAgICAgICAgICAgICByZW1haW5pbmcgPSBkdXJhdGlvbl9zZWNvbmRzIC0gZWxhcHNlZAogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIGzGsOG7m3Qge3Njcm9sbF9jb3VudH0gdmlkZW8sIGPDsm4gbOG6oWkge2ludChyZW1haW5pbmcpfXMiKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkhvw6BuIHRow6BuaCBsxrDhu5t0IMSR4buBIHh14bqldDoge3Njcm9sbF9jb3VudH0gdmlkZW8gdHJvbmcge2R1cmF0aW9uX3NlY29uZHN9cyIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbMaw4bubdCBmZWVkIMSR4buBIHh14bqldCIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX2ludGVyYWN0X3dpdGhfaW5ib3goc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUxrDGoW5nIHTDoWMgduG7m2kgSOG7mXAgdGjGsDogYuG6pW0gdsOgbywgZOG7q25nIDItNXMsIHZ14buRdCBsw6puCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUw6xtIG7DunQgSOG7mXAgdGjGsAogICAgICAgICAgICBpbmJveF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSJI4buZcCB0aMawIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBpbmJveF9idXR0b246CiAgICAgICAgICAgICAgICAjIFRo4butIHTDrG0gdGhlbyB0ZXh0CiAgICAgICAgICAgICAgICBpbmJveF9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iSOG7mXAgdGjGsCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgaW5ib3hfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgSOG7mXAgdGjGsCIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2xpY2sgdsOgbyBI4buZcCB0aMawCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQYW5nIGNsaWNrIHbDoG8gSOG7mXAgdGjGsCIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihpbmJveF9idXR0b24pCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEThu6tuZyBs4bqhaSAyLTUgZ2nDonkKICAgICAgICAgICAgd2FpdF90aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgNSkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIkThu6tuZyB0cm9uZyBI4buZcCB0aMawIHt3YWl0X3RpbWV9cyIpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFZ14buRdCBsw6puIHRyb25nIEjhu5lwIHRoxrAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVnXhu5F0IGzDqm4gdHJvbmcgSOG7mXAgdGjGsCIpCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIHRoYW8gdMOhYyB2deG7kXQgbMOqbiB0aMOqbSAxLTIgbOG6p24gbuG7r2EKICAgICAgICAgICAgYWRkaXRpb25hbF9zd2lwZXMgPSByYW5kb20ucmFuZGludCgxLCAyKQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShhZGRpdGlvbmFsX3N3aXBlcyk6CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5zd2lwZV91cCgpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAocmFuZG9tLnVuaWZvcm0oMC41LCAxLjUpKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiSG/DoG4gdGjDoG5oIHTGsMahbmcgdMOhYyB24bubaSBI4buZcCB0aMawIikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSB0xrDGoW5nIHTDoWMgduG7m2kgSOG7mXAgdGjGsCIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBnZXRfYXZhaWxhYmxlX2pvYnMoc2VsZiwgYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIgogICAgICAgIEzhuqV5IGRhbmggc8OhY2ggY8OhYyBqb2Iga2jhuqMgZOG7pW5nIHThu6sgR29MaWtlCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWNjb3VudDogVGjDtG5nIHRpbiB0w6BpIGtob+G6o24KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdFtEaWN0W3N0ciwgQW55XV06IERhbmggc8OhY2ggam9iIGhv4bq3YyBsaXN0IHLhu5duZyBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuZ29saWtlX3NlcnZpY2U6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgbOG6pXkgam9iOiBHb0xpa2VTZXJ2aWNlIGNoxrBhIMSRxrDhu6NjIGN1bmcgY+G6pXAiKQogICAgICAgICAgICByZXR1cm4gW10KICAgICAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEfhu41pIEFQSSBs4bqleSBqb2IKICAgICAgICAgICAgam9iX3VybCA9IHNlbGYuZ2V0X2pvYnNfdXJsKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVOG6oW8gdGhhbSBz4buRCiAgICAgICAgICAgIHBhcmFtcyA9IHNlbGYuZ2V0X2pvYl9wYXJhbXMoYWNjb3VudCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR+G7jWkgQVBJCiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5hcGlfcmVxdWVzdChqb2JfdXJsLCAiR0VUIiwgcGFyYW1zKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzcG9uc2UgYW5kIHJlc3BvbnNlLmdldCgic3VjY2VzcyIsIEZhbHNlKToKICAgICAgICAgICAgICAgIGpvYl9kYXRhID0gcmVzcG9uc2UuZ2V0KCJkYXRhIiwgTm9uZSkKICAgICAgICAgICAgICAgIGlmIGpvYl9kYXRhOgogICAgICAgICAgICAgICAgICAgICMgQ2h14bqpbiBow7NhIGThu68gbGnhu4d1IGpvYgogICAgICAgICAgICAgICAgICAgIGpvYiA9IHNlbGYubWFwX2pvYl9kYXRhKGpvYl9kYXRhKQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHTDrG0gdGjhuqV5IGpvYiB7am9iWydpZCddfSBsb+G6oWkge2pvYlsndHlwZSddfSBjaG8gdMOgaSBraG/huqNuIHthY2NvdW50Wyd1bmlxdWVfdXNlcm5hbWUnXX0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbam9iXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbOG6pXkgZGFuaCBzw6FjaCBqb2IiKQogICAgICAgICAgICByZXR1cm4gW10KICAgIAogICAgZGVmIGV4ZWN1dGVfam9iKHNlbGYsIGFjY291bnQ6IERpY3Rbc3RyLCBBbnldLCBqb2I6IERpY3Rbc3RyLCBBbnldKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBUaOG7sWMgaGnhu4duIGpvYgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIGpvYjogVGjDtG5nIHRpbiBqb2IKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdFtzdHIsIEFueV06IEvhur90IHF14bqjIHRo4buxYyBoaeG7h24gam9iLCBiYW8gZ+G7k206CiAgICAgICAgICAgICAgICAtIHN0YXR1cyAoaW50KTogTcOjIHRy4bqhbmcgdGjDoWkgam9iCiAgICAgICAgICAgICAgICAgICAgMDogQ2jGsGEgdGjhu7FjIGhp4buHbgogICAgICAgICAgICAgICAgICAgIDE6IFRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIDI6IFRo4bqldCBi4bqhaSwga2jDtG5nIHTDrG0gdGjhuqV5IMSR4buRaSB0xrDhu6NuZwogICAgICAgICAgICAgICAgICAgIDM6IFRo4bqldCBi4bqhaSwgxJHDoyBi4buLIHVuZm9sbG93L3VubGlrZQogICAgICAgICAgICAgICAgICAgIDQ6IFRo4bqldCBi4bqhaSwgecOqdSBj4bqndSDEkWFuZyBjaOG7nQogICAgICAgICAgICAgICAgLSBtZXNzYWdlIChzdHIpOiBUaMO0bmcgYsOhbyBr4bq/dCBxdeG6owogICAgICAgICAgICAgICAgLSBzdWNjZXNzIChib29sKTogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgam9iX3R5cGUgPSBqb2IuZ2V0KCJ0eXBlIiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgam9iX2xpbmsgPSBqb2IuZ2V0KCJsaW5rIiwgIiIpCiAgICAgICAgICAgIGpvYl9pZCA9IGpvYi5nZXQoImlkIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkGFuZyB0aOG7sWMgaGnhu4duIGpvYiB7am9iX2lkfSBsb+G6oWkge2pvYl90eXBlfSB24bubaSBsaW5rIHtqb2JfbGlua30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBLaeG7g20gdHJhIGxv4bqhaSBqb2IgxJHGsOG7o2MgaOG7lyB0cuG7owogICAgICAgICAgICBpZiBqb2JfdHlwZSBub3QgaW4gWyJmb2xsb3ciLCAibGlrZSJdOgogICAgICAgICAgICAgICAgbWVzc2FnZSA9IGYiTG/huqFpIGpvYiB7am9iX3R5cGV9IGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujIgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhtZXNzYWdlKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogMiwKICAgICAgICAgICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIGpvYiB0aGVvIGxv4bqhaQogICAgICAgICAgICBqb2Jfc3RhdHVzID0gMCAgIyBN4bq3YyDEkeG7i25oIGzDoCBjaMawYSBsw6BtCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBqb2JfdHlwZSA9PSAiZm9sbG93IjoKICAgICAgICAgICAgICAgIGpvYl9zdGF0dXMgPSBzZWxmLl9wZXJmb3JtX2ZvbGxvd19qb2Ioam9iX2xpbmspCiAgICAgICAgICAgIGVsaWYgam9iX3R5cGUgPT0gImxpa2UiOgogICAgICAgICAgICAgICAgam9iX3N0YXR1cyA9IHNlbGYuX3BlcmZvcm1fbGlrZV9qb2Ioam9iX2xpbmspCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFThuqFvIGvhur90IHF14bqjIHRy4bqjIHbhu4EgZOG7sWEgdHLDqm4gam9iX3N0YXR1cwogICAgICAgICAgICBpZiBqb2Jfc3RhdHVzID09IDE6ICAjIFRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgbWVzc2FnZSA9IGYixJDDoyBob8OgbiB0aMOgbmggam9iIHtqb2JfdHlwZX0gdGjDoG5oIGPDtG5nIgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogam9iX3N0YXR1cywKICAgICAgICAgICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBUcnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSAyOiAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nCiAgICAgICAgICAgICAgICBtZXNzYWdlID0gZiJLaMO0bmcgdGjhu4MgdMOsbSB0aOG6pXkgxJHhu5FpIHTGsOG7o25nIMSR4buDIHRo4buxYyBoaeG7h24gam9iIHtqb2JfdHlwZX0iCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiBqb2Jfc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyI6IEZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsaWYgam9iX3N0YXR1cyA9PSAzOiAgIyDEkMOjIGLhu4sgdW5mb2xsb3cvdW5saWtlCiAgICAgICAgICAgICAgICBtZXNzYWdlID0gZiLEkOG7kWkgdMaw4bujbmcgxJHDoyBi4buLIHVuZm9sbG93L3VubGlrZSB0csaw4bubYyDEkcOzIgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhtZXNzYWdlKQogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogam9iX3N0YXR1cywKICAgICAgICAgICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiOiBGYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlOiAgIyBUaOG6pXQgYuG6oWkgaG/hurdjIHRy4bqhbmcgdGjDoWkga2jDoWMKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBmIlRo4buxYyBoaeG7h24gam9iIHtqb2JfdHlwZX0gdGjhuqV0IGLhuqFpIHbhu5tpIHRy4bqhbmcgdGjDoWkge2pvYl9zdGF0dXN9IgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IobWVzc2FnZSkKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IGpvYl9zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiBtZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbWVzc2FnZSA9IGYiTOG7l2kga2hpIHRo4buxYyBoaeG7h24gam9iOiB7c3RyKGUpfSIKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsIG1lc3NhZ2UpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic3RhdHVzIjogMiwKICAgICAgICAgICAgICAgICJtZXNzYWdlIjogbWVzc2FnZSwKICAgICAgICAgICAgICAgICJzdWNjZXNzIjogRmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgIGRlZiBfcGVyZm9ybV9mb2xsb3dfam9iKHNlbGYsIHByb2ZpbGVfbGluazogc3RyKSAtPiBpbnQ6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IgZm9sbG93IHRyw6puIFRpa1RvawogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHByb2ZpbGVfbGluazogTGluayDEkeG6v24gdHJhbmcgY8OhIG5ow6JuIGPhuqduIGZvbGxvdyAoZOG6oW5nOiBodHRwczovL3d3dy50aWt0b2suY29tL0B1c2VybmFtZSkKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgaW50OiBUcuG6oW5nIHRow6FpIGpvYiAoMDogY2jGsGEgbMOgbSwgMTogaG/DoG4gdGjDoG5oLCAyOiBs4buXaSwgMzogYuG7iyB1bmZvbGxvdywgNDogecOqdSBj4bqndSBjaOG7nSwgNTogZ+G7rWkgecOqdSBj4bqndSkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIMSRYW5nIOG7nyB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbnN1cmVfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IHVzZXJuYW1lIHThu6sgVVJMIFRpa1RvayDEkeG7gyBz4butIGThu6VuZyBjaG8gbG9nZ2luZwogICAgICAgICAgICB1c2VybmFtZV9tYXRjaCA9IHJlLnNlYXJjaChyJ3Rpa3Rva1wuY29tL0AoW14vP10rKScsIHByb2ZpbGVfbGluaykKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX21hdGNoOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgdHLDrWNoIHh14bqldCB1c2VybmFtZSB04burIGxpbms6IHtwcm9maWxlX2xpbmt9IikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdXNlcm5hbWUgPSB1c2VybmFtZV9tYXRjaC5ncm91cCgxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIHRyYW5nIGPDoSBuaMOibgogICAgICAgICAgICBpZiBub3Qgc2VsZi5fb3Blbl9wcm9maWxlX3BhZ2UocHJvZmlsZV9saW5rKToKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENo4budIHRow6ptIGNobyB0cmFuZyBo4buTIHPGoSB04bqjaSB4b25nCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIG7DunQgRm9sbG93IHRoZW8gY8OhYyBjw6FjaCBraMOhYyBuaGF1CiAgICAgICAgICAgIGZvbGxvd19idXR0b24gPSBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPDoWNoIDE6IFTDrG0gdGhlbyB0ZXh0IHRp4bq/bmcgVmnhu4d0IHbDoCB0aeG6v25nIEFuaAogICAgICAgICAgICBmb2xsb3dfdGV4dHMgPSBbIlRoZW8gZMO1aSIsICJGb2xsb3ciLCAixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyIsICLEkMOjIHnDqnUgY+G6p3UiLCAiUmVxdWVzdGVkIl0KICAgICAgICAgICAgZm9yIHRleHQgaW4gZm9sbG93X3RleHRzOgogICAgICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PXRleHQpCiAgICAgICAgICAgICAgICBpZiBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPDoWNoIDI6IFTDrG0gdGhlbyBjb250ZW50LWRlc2MKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBmb2xsb3dfZGVzY3MgPSBbIlRoZW8gZMO1aSIsICJGb2xsb3ciLCAixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyJdCiAgICAgICAgICAgICAgICBmb3IgZGVzYyBpbiBmb2xsb3dfZGVzY3M6CiAgICAgICAgICAgICAgICAgICAgZm9sbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9ZGVzYykKICAgICAgICAgICAgICAgICAgICBpZiBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSBs4bqnbiBu4buvYSBu4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBmb2xsb3cKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCB0aGVvIGTDtWkg4bufIGzhuqduIMSR4bqndSwgdGjhu60gdnXhu5F0IG3DoG4gaMOsbmggdsOgIHTDrG0gbOG6oWkiKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUaOG7rSBs4bqhaSB04bqldCBj4bqjIGPDoWMgY8OhY2gKICAgICAgICAgICAgICAgIGZvciB0ZXh0IGluIGZvbGxvd190ZXh0czoKICAgICAgICAgICAgICAgICAgICBmb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9dGV4dCkKICAgICAgICAgICAgICAgICAgICBpZiBmb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGZvbGxvd19idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgdGhlbyBkw7VpIHNhdSBuaGnhu4F1IGzhuqduIHRo4butIikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHRleHQgY+G7p2EgbsO6dAogICAgICAgICAgICBidXR0b25fdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoZm9sbG93X2J1dHRvbikKICAgICAgICAgICAgYnV0dG9uX3Jlc291cmNlX2lkID0gZm9sbG93X2J1dHRvbi5nZXQoInJlc291cmNlLWlkIiwgIiIpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUZXh0IGPhu6dhIG7DunQgZm9sbG93OiAne2J1dHRvbl90ZXh0fScsIHJlc291cmNlLWlkOiAne2J1dHRvbl9yZXNvdXJjZV9pZH0nIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIGhp4buHbiB04bqhaQogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIsSQYW5nIHRoZW8gZMO1aSIsICJGb2xsb3dpbmciXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHRoZW8gZMO1aSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSB04burIHRyxrDhu5tjIikKICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLEkMOjIHnDqnUgY+G6p3UgdGhlbyBkw7VpIHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9IHThu6sgdHLGsOG7m2MiKQogICAgICAgICAgICAgICAgcmV0dXJuIDUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTuG6v3UgbMOgICJUaGVvIGTDtWkiIGhv4bq3YyAiRm9sbG93IiB0aMOsIGNsaWNrIHbDoG8gbsO6dAogICAgICAgICAgICBpZiBidXR0b25fdGV4dCBpbiBbIlRoZW8gZMO1aSIsICJGb2xsb3ciXToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlRo4buxYyBoaeG7h24gY2xpY2sgdsOgbyBuw7p0IHRoZW8gZMO1aSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTOG6pXkgcmVzb3VyY2VfaWQgY+G7p2EgYnV0dG9uIMSR4buDIGtp4buDbSB0cmEgbOG6oWkgc2F1CiAgICAgICAgICAgICAgICBidXR0b25fcmVzb3VyY2VfaWQgPSBmb2xsb3dfYnV0dG9uLmdldCgicmVzb3VyY2UtaWQiLCAiIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGZvbGxvd19idXR0b24pCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgICMgVnXhu5F0IHh14buRbmcgMSBs4bqnbiDEkeG7gyByZWZyZXNoIHRy4bqhbmcgdGjDoWkKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX2Rvd24oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBkaWFsb2cgaGnhu4duIGzDqm4ga2jDtG5nCiAgICAgICAgICAgICAgICAjIHNjcmVlbl94bWwgPSBzZWxmLmR1bXBfc2NyZWVuX3dpdGhfcmV0cnkoKQogICAgICAgICAgICAgICAgIyBpZiBzY3JlZW5feG1sOgogICAgICAgICAgICAgICAgIyAgICAgIyBLaeG7g20gdHJhIGRpYWxvZyBj4bqjbmggYsOhbyBob+G6t2MgZ2nhu5tpIGjhuqFuCiAgICAgICAgICAgICAgICAjICAgICBkaWFsb2dzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKHNjcmVlbl94bWwsIGNsYXNzX25hbWU9ImFuZHJvaWQuYXBwLkRpYWxvZyIpCiAgICAgICAgICAgICAgICAjICAgICBmb3IgZGlhbG9nIGluIGRpYWxvZ3M6CiAgICAgICAgICAgICAgICAjICAgICAgICAgZGlhbG9nX3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KGRpYWxvZykKICAgICAgICAgICAgICAgICMgICAgICAgICBpZiBhbnkoa2V5d29yZCBpbiBkaWFsb2dfdGV4dC5sb3dlcigpIGZvciBrZXl3b3JkIGluIFsidGjhu60gbOG6oWkgc2F1IiwgImdp4bubaSBo4bqhbiIsICJsaW1pdCIsICJ0cnkgYWdhaW4iXSk6CiAgICAgICAgICAgICAgICAjICAgICAgICAgICAgICMgVMOsbSB2w6AgbmjhuqVuIG7DunQgT0svxJDDs25nCiAgICAgICAgICAgICAgICAjICAgICAgICAgICAgIG9rX2J1dHRvbnMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoc2NyZWVuX3htbCwgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuQnV0dG9uIikKICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgZm9yIGJ0biBpbiBva19idXR0b25zOgogICAgICAgICAgICAgICAgIyAgICAgICAgICAgICAgICAgYnRuX3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KGJ0bikKICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgICAgIGlmIGJ0bl90ZXh0IGFuZCBidG5fdGV4dC5sb3dlcigpIGluIFsib2siLCAixJHDs25nIiwgInTDtGkgaGnhu4N1IiwgIsSR4buTbmcgw70iXToKICAgICAgICAgICAgICAgICMgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoYnRuKQogICAgICAgICAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAjICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIkpvYiBraMO0bmcgaG/DoG4gdGjDoG5oLCBi4buLIGdp4bubaSBo4bqhbiB0aGVvIGTDtWkiKQogICAgICAgICAgICAgICAgIyAgICAgICAgICAgICByZXR1cm4gMwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgdGV4dCBzYXUga2hpIG5o4bqlbiB0aGVvIGTDtWkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gbOG6oWkgbsO6dCBmb2xsb3cgxJHhu4Mga2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIC0gxrB1IHRpw6puIHRoZW8gcmVzb3VyY2UtaWQgbuG6v3UgY8OzCiAgICAgICAgICAgICAgICB1cGRhdGVkX2ZvbGxvd19idXR0b24gPSBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgY8OzIHJlc291cmNlX2lkLCB0w6xtIHRoZW8gcmVzb3VyY2VfaWQgdHLGsOG7m2MKICAgICAgICAgICAgICAgIGlmIGJ1dHRvbl9yZXNvdXJjZV9pZDoKICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2ZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9YnV0dG9uX3Jlc291cmNlX2lkKQogICAgICAgICAgICAgICAgICAgIGlmIHVwZGF0ZWRfZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgdMOsbSBs4bqhaSBuw7p0IGZvbGxvdyB0aGVvIHJlc291cmNlLWlkOiB7YnV0dG9uX3Jlc291cmNlX2lkfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5IHRoZW8gcmVzb3VyY2VfaWQgaG/hurdjIGtow7RuZyBjw7MgcmVzb3VyY2VfaWQsIHTDrG0gdGhlbyB0ZXh0CiAgICAgICAgICAgICAgICBpZiBub3QgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIGZvbGxvd190ZXh0cyA9IFsixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyIsICLEkMOjIHnDqnUgY+G6p3UiLCAiUmVxdWVzdGVkIiwgIlRoZW8gZMO1aSIsICJGb2xsb3ciXQogICAgICAgICAgICAgICAgICAgIGZvciB0ZXh0IGluIGZvbGxvd190ZXh0czoKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF9mb2xsb3dfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9dGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXBkYXRlZF9mb2xsb3dfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBGYWxsYmFjazogdMOsbSB0aGVvIGNvbnRlbnQtZGVzYwogICAgICAgICAgICAgICAgaWYgbm90IHVwZGF0ZWRfZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICBmb2xsb3dfZGVzY3MgPSBbIlRoZW8gZMO1aSIsICJGb2xsb3ciLCAixJBhbmcgdGhlbyBkw7VpIiwgIkZvbGxvd2luZyJdCiAgICAgICAgICAgICAgICAgICAgZm9yIGRlc2MgaW4gZm9sbG93X2Rlc2NzOgogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2ZvbGxvd19idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPWRlc2MpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVwZGF0ZWRfZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHVwZGF0ZWRfZm9sbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX3RleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHVwZGF0ZWRfZm9sbG93X2J1dHRvbikKICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX3Jlc291cmNlX2lkID0gdXBkYXRlZF9mb2xsb3dfYnV0dG9uLmdldCgicmVzb3VyY2UtaWQiLCAiIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiU2F1IGtoaSBjbGljayBmb2xsb3c6IHRleHQ9J3t1cGRhdGVkX3RleHR9JywgcmVzb3VyY2UtaWQ9J3t1cGRhdGVkX3Jlc291cmNlX2lkfSciKQogICAgICAgICAgICAgICAgICAgICMgVHJpbSB3aGl0ZXNwYWNlIHThu6sgdXBkYXRlZF90ZXh0CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF90ZXh0ID0gdXBkYXRlZF90ZXh0LnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgY8OhYyB0csaw4budbmcgaOG7o3Aga2jDoWMgbmhhdQogICAgICAgICAgICAgICAgICAgIGlmIHVwZGF0ZWRfdGV4dCBpbiBbIsSQYW5nIHRoZW8gZMO1aSIsICJGb2xsb3dpbmciLCAiTmjhuq9uIHRpbiIsICJNZXNzYWdlIl06CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIkZvbGxvdyB0aMOgbmggY8O0bmchIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgICAgICBlbGlmIHVwZGF0ZWRfdGV4dCBpbiBbIsSQw6MgecOqdSBj4bqndSIsICJSZXF1ZXN0ZWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBn4butaSB5w6p1IGPhuqd1IHRoZW8gZMO1aSB0aMOgbmggY8O0bmchIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDUKICAgICAgICAgICAgICAgICAgICBlbGlmIHVwZGF0ZWRfdGV4dCBpbiBbIlRoZW8gZMO1aSIsICJGb2xsb3ciXToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJGb2xsb3cga2jDtG5nIHRow6BuaCBjw7RuZywgdGV4dCBj4bunYSBuw7p0IHbhuqtuIGzDoDoge3VwZGF0ZWRfdGV4dH0iKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMgogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiRm9sbG93IGtow7RuZyB0aMOgbmggY8O0bmcsIHRleHQgY+G7p2EgbsO6dCBsw6A6IHt1cGRhdGVkX3RleHR9IikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCwgY8OzIHRo4buDIMSRw6MgZm9sbG93IHRow6BuaCBjw7RuZwogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIktow7RuZyB0w6xtIHRo4bqleSBuw7p0IGZvbGxvdyBzYXUga2hpIG5o4bqlbiwgZ2nhuqMgxJHhu4tuaCDEkcOjIHRow6BuaCBjw7RuZyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiVGV4dCBj4bunYSBuw7p0IGtow7RuZyBraOG7m3AgduG7m2kgJ1RoZW8gZMO1aScgaG/hurdjICdGb2xsb3cnOiB7YnV0dG9uX3RleHR9IikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYiBmb2xsb3c6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIDIKICAgIAogICAgZGVmIF9vcGVuX3Byb2ZpbGVfcGFnZShzZWxmLCBwcm9maWxlX2xpbms6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBN4bufIHRyYW5nIHByb2ZpbGUgVGlrVG9rIGLhurFuZyB0w6xtIGtp4bq/bSBob+G6t2MgbGluayB0cuG7sWMgdGnhur9wCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcHJvZmlsZV9saW5rOiBMaW5rIMSR4bq/biB0cmFuZyBjw6EgbmjDom4KICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IHVzZXJuYW1lIHThu6sgVVJMIFRpa1RvawogICAgICAgICAgICB1c2VybmFtZV9tYXRjaCA9IHJlLnNlYXJjaChyJ3Rpa3Rva1wuY29tL0AoW14vP10rKScsIHByb2ZpbGVfbGluaykKICAgICAgICAgICAgaWYgbm90IHVzZXJuYW1lX21hdGNoOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgdHLDrWNoIHh14bqldCB1c2VybmFtZSB04burIGxpbms6IHtwcm9maWxlX2xpbmt9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHVzZXJuYW1lID0gdXNlcm5hbWVfbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmFuZG9tIGNo4buNbiAxIHRyb25nIDIgY8OhY2g6IHTDrG0ga2nhur9tIGhv4bq3YyBt4bufIHRy4buxYyB0aeG6v3AgbGluawogICAgICAgICAgICBpZiByYW5kb20uY2hvaWNlKFtUcnVlLCBGYWxzZV0pOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIk3hu58gdHJhbmcgY8OhIG5ow6JuIGLhurFuZyBjw6FjaCB0w6xtIGtp4bq/bToge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICAjIFRo4butIG3hu58gYuG6sW5nIHTDrG0ga2nhur9tCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5fb3Blbl9wcm9maWxlX2J5X3NlYXJjaCh1c2VybmFtZSk6CiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSB0w6xtIGtp4bq/bSB0aOG6pXQgYuG6oWksIGZhbGxiYWNrIHNhbmcgbeG7nyBsaW5rCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSBraeG6v20gdGjhuqV0IGLhuqFpLCBt4bufIGLhurFuZyBsaW5rIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLm9wZW5fdXJsKHByb2ZpbGVfbGluayxzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg0KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBDw6FjaCAyOiBN4bufIHRy4buxYyB0aeG6v3AgVVJMIHRow7RuZyBxdWEgaGVscGVyLm9wZW5fdXJsKCkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJN4bufIHRyYW5nIGPDoSBuaMOibiBi4bqxbmcgbGluayB0cuG7sWMgdGnhur9wOiB7cHJvZmlsZV9saW5rfSIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX3VybChwcm9maWxlX2xpbmssc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaOG7nSB0aMOqbSBjaG8gdHJhbmcgaOG7kyBzxqEgdOG6o2kgeG9uZwogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyB2w6BvIMSRw7puZyBwcm9maWxlIGtow7RuZyBi4bqxbmcgY8OhY2ggdMOsbSBidXR0b24gY8OzIHRleHQgPSBAdXNlcm5hbWUKICAgICAgICAgICAgIyBUw6xtIGJ1dHRvbiBjw7MgdGV4dCBjaMOtbmggeMOhYyBi4bqxbmcgQHVzZXJuYW1lIChUaWtUb2sgbHXDtG4gY8OzIEAgdHLGsOG7m2MgdXNlcm5hbWUpCiAgICAgICAgICAgIGF0X3VzZXJuYW1lX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iLCB0ZXh0PWYiQHt1c2VybmFtZX0iKQogICAgICAgICAgICBpZiBhdF91c2VybmFtZV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyB4w6FjIG5o4bqtbiB2w6BvIMSRw7puZyBwcm9maWxlIGPhu6dhIHt1c2VybmFtZX0gKHTDrG0gdGjhuqV5IGJ1dHRvbiBjw7MgdGV4dDogJ0B7dXNlcm5hbWV9JykiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHTDrG0gdGjhuqV5IGJ1dHRvbiBjw7MgdGV4dCA9ICdAe3VzZXJuYW1lfScgdHLDqm4gbcOgbiBow6xuaCwgY8OzIHRo4buDIGtow7RuZyB2w6BvIMSRw7puZyBwcm9maWxlIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSBt4bufIHRyYW5nIHByb2ZpbGU6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfb3Blbl9wcm9maWxlX2J5X3NlYXJjaChzZWxmLCB1c2VybmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIE3hu58gdHJhbmcgcHJvZmlsZSBUaWtUb2sgYuG6sW5nIGPDoWNoIHTDrG0ga2nhur9tIHVzZXJuYW1lCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdXNlcm5hbWU6IFVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiBj4bqnbiB0w6xtCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVMOsbSB0YWIgdMOsbSBraeG6v20KICAgICAgICAgICAgc2VhcmNoX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlTDrG0ga2nhur9tIikKICAgICAgICAgICAgaWYgbm90IHNlYXJjaF90YWI6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiBUw6xtIGtp4bq/bSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoc2VhcmNoX3RhYikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCgogICAgICAgICAgICAjIFTDrG0gw7Qgbmjhuq1wIHTDrG0ga2nhur9tCiAgICAgICAgICAgIHNlYXJjaF9pbnB1dCA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5FZGl0VGV4dCIpCiAgICAgICAgICAgIGlmIG5vdCBzZWFyY2hfaW5wdXQ6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IMO0IG5o4bqtcCB0w6xtIGtp4bq/bSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTmjhuq1wIHVzZXJuYW1lIGPhuqduIHTDrG0KICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNlYXJjaF9pbnB1dCkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEuNSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLmlucHV0X3RleHQoZiJ7dXNlcm5hbWV9IikKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDUpICAjIENo4budIGvhur90IHF14bqjIHTDrG0ga2nhur9tCgogICAgICAgICAgICAjIFTDrG0gbsO6dCBUw6xtIGtp4bq/bSB2w6AgY2xpY2sKICAgICAgICAgICAgc2VhcmNoX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5CdXR0b24iLCB0ZXh0PSJUw6xtIGtp4bq/bSIpCiAgICAgICAgICAgIGlmIHNlYXJjaF9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJUw6xtIHRo4bqleSBuw7p0ICdUw6xtIGtp4bq/bScsIMSRYW5nIGNsaWNrLi4uIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihzZWFyY2hfYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCAnVMOsbSBraeG6v20nIikKICAgICAgICAgICAgICAgICMgVGjhu7FjIGhp4buHbiBzZWFyY2ggduG7m2kgZW50ZXIga2V5CiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19lbnRlcigpCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikgCgogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSB0YWIgIk5nxrDhu51pIGTDuW5nIiB2w6AgY2xpY2sgdsOgbyBuw7MgLSDEkeG7o2kgdOG7kWkgxJFhIDEwcwogICAgICAgICAgICB1c2VyX3RhYiA9IHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQodGV4dD0iTmfGsOG7nWkgZMO5bmciLCB0aW1lb3V0PTEwKQogICAgICAgICAgICBpZiBub3QgdXNlcl90YWI6CiAgICAgICAgICAgICAgICB1c2VyX3RhYiA9IHNlbGYuaGVscGVyLndhaXRfZm9yX2VsZW1lbnQoY29udGVudF9kZXNjPSJOZ8aw4budaSBkw7luZyIsIHRpbWVvdXQ9NikKCiAgICAgICAgICAgIGlmIHVzZXJfdGFiOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiVMOsbSB0aOG6pXkgdGFiIE5nxrDhu51pIGTDuW5nLCDEkWFuZyBjbGljayB2w6BvLi4uIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih1c2VyX3RhYikKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IHRhYiBOZ8aw4budaSBkw7luZyBzYXUgMTBzIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gVGV4dFZpZXcgY8OzIHRleHQgY2jDrW5oIHjDoWMgYuG6sW5nIHVzZXJuYW1lIChraMO0bmcgY8OzIEApIC0gxJHhu6NpIHThu5FpIMSRYSA2cwogICAgICAgICAgICB1c2VybmFtZV9lbGVtZW50ID0gc2VsZi5oZWxwZXIud2FpdF9mb3JfZWxlbWVudCh0ZXh0PXVzZXJuYW1lLCBjbGFzc19uYW1lPSJhbmRyb2lkLndpZGdldC5UZXh0VmlldyIsIHRpbWVvdXQ9NikKCiAgICAgICAgICAgIGlmIHVzZXJuYW1lX2VsZW1lbnQ6CiAgICAgICAgICAgICAgICAjIENsaWNrIHbDoG8gZWxlbWVudCDEkeG6p3UgdGnDqm4gdMOsbSDEkcaw4bujYwogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dXNlcm5hbWV9LCDEkWFuZyBjbGljayB2w6BvLi4uIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcih1c2VybmFtZV9lbGVtZW50KQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIktow7RuZyB0w6xtIHRo4bqleSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfSB0cm9uZyBr4bq/dCBxdeG6oyB0w6xtIGtp4bq/bSBzYXUgMTBzIikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnByZXNzX2JhY2soKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHTDrG0ga2nhur9tIHTDoGkga2hv4bqjbjoge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9wZXJmb3JtX2xpa2Vfam9iKHNlbGYsIHBvc3RfbGluazogc3RyKSAtPiBpbnQ6CiAgICAgICAgIiIiCiAgICAgICAgVGjhu7FjIGhp4buHbiBqb2IgbGlrZSB2aWRlbyB0csOqbiBUaWtUb2sKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwb3N0X2xpbms6IExpbmsgxJHhur9uIHZpZGVvIGPhuqduIGxpa2UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgaW50OiBUcuG6oW5nIHRow6FpIGpvYiAoMDogY2jGsGEgbMOgbSwgMTogaG/DoG4gdGjDoG5oLCAyOiBs4buXaSwgMzogxJHDoyBsaWtlIHRyxrDhu5tjIMSRw7MpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiTeG7nyB2aWRlbyBUaWtUb2sgYuG6sW5nIGxpbmsgdHLhu7FjIHRp4bq/cDoge3Bvc3RfbGlua30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIHRy4buxYyB0aeG6v3AgVVJMIHRow7RuZyBxdWEgaGVscGVyLm9wZW5fdXJsKCkKICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl91cmwocG9zdF9saW5rLHNlbGYuYXBwX3BhY2thZ2UpCiAgICAKICAgICAgICAgICAgIyBSYW5kb20gbmdo4buJIDMtMTAgZ2nDonkgbmjGsCBuZ8aw4budaSBkw7luZyB0aMO0bmcgdGjGsOG7nW5nCiAgICAgICAgICAgIHdhaXRfdGltZSA9IHJhbmRvbS5yYW5kaW50KDMsIDEwKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJBhbmcgbmdo4buJIHt3YWl0X3RpbWV9cyBuaMawIG5nxrDhu51pIGTDuW5nIHRow7RuZyB0aMaw4budbmcuLi4iKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIG7DunQgbGlrZSBi4bqxbmcgY29udGVudC1kZXNjICJUaMOtY2ggdmlkZW8uIgogICAgICAgICAgICBsaWtlX2J1dHRvbiA9IHNlbGYuX2ZpbmRfbGlrZV9idXR0b24oKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGxpa2VfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZygiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgbGlrZSB0csOqbiBtw6BuIGjDrG5oIikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHRow7RuZyB0aW4gbsO6dCBsaWtlIGJhbiDEkeG6p3UKICAgICAgICAgICAgaW5pdGlhbF9jb250ZW50X2Rlc2MgPSBsaWtlX2J1dHRvbi5nZXQoImNvbnRlbnQtZGVzYyIsICIiKQogICAgICAgICAgICBpbml0aWFsX3Jlc291cmNlX2lkID0gbGlrZV9idXR0b24uZ2V0KCJyZXNvdXJjZS1pZCIsICIiKQogICAgICAgICAgICBpbml0aWFsX3NlbGVjdGVkID0gc2VsZi5oZWxwZXIuaXNfZWxlbWVudF9zZWxlY3RlZChsaWtlX2J1dHRvbikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUcuG6oW5nIHRow6FpIG7DunQgbGlrZSBiYW4gxJHhuqd1OiBzZWxlY3RlZD17aW5pdGlhbF9zZWxlY3RlZH0sIGNvbnRlbnQtZGVzYz0ne2luaXRpYWxfY29udGVudF9kZXNjfScsIHJlc291cmNlLWlkPSd7aW5pdGlhbF9yZXNvdXJjZV9pZH0nIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSDEkcOjIGxpa2UgdOG7qyB0csaw4bubYwogICAgICAgICAgICBpZiBpbml0aWFsX3NlbGVjdGVkIG9yICJC4buPIHRow61jaCIgaW4gaW5pdGlhbF9jb250ZW50X2Rlc2Mgb3IgIlVubGlrZSIgaW4gaW5pdGlhbF9jb250ZW50X2Rlc2M6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJWaWRlbyDEkcOjIMSRxrDhu6NjIGxpa2UgdOG7qyB0csaw4bubYyIpCiAgICAgICAgICAgICAgICByZXN1bHQgPSAzICAjIMSQw6MgbGlrZSB0csaw4bubYyDEkcOzCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRo4buxYyBoaeG7h24gbGlrZSB2aWRlbwogICAgICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi5fYXR0ZW1wdF9saWtlX3ZpZGVvKGxpa2VfYnV0dG9uKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBTYXUga2hpIGxpa2UgeG9uZywgdnXhu5F0IHJhbmRvbSAyLTUgdmlkZW8gcuG7k2kgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICAgICBpZiByZXN1bHQgPT0gMTogICMgVGjDoG5oIGPDtG5nCiAgICAgICAgICAgICAgICBzZWxmLl9zY3JvbGxfdmlkZW9zX2FuZF9yZXR1cm5faG9tZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCBmIkzhu5dpIGtoaSB0aOG7sWMgaGnhu4duIGpvYiBsaWtlOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiAyCgogICAgZGVmIF9maW5kX2xpa2VfYnV0dG9uKHNlbGYpOgogICAgICAgICIiIlTDrG0gbsO6dCBsaWtlIHRyw6puIHZpZGVvIFRpa1RvayIiIgogICAgICAgICMgVGjhu60gY8OhYyBjw6FjaCB0w6xtIGtow6FjIG5oYXUgY2hvIG7DunQgbGlrZQogICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVGjDrWNoIikKICAgICAgICBpZiBub3QgbGlrZV9idXR0b246CiAgICAgICAgICAgIGxpa2VfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iTGlrZSIpCiAgICAgICAgaWYgbm90IGxpa2VfYnV0dG9uOgogICAgICAgICAgICAjIFTDrG0gdGhlbyByZXNvdXJjZS1pZCBob+G6t2MgeHBhdGgKICAgICAgICAgICAgbGlrZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQocmVzb3VyY2VfaWQ9ImNvbS5zcy5hbmRyb2lkLnVnYy50cmlsbDppZC9saWtlX2J1dHRvbiIpCiAgICAgICAgcmV0dXJuIGxpa2VfYnV0dG9uCgogICAgZGVmIF9hdHRlbXB0X2xpa2VfdmlkZW8oc2VsZiwgbGlrZV9idXR0b24pOgogICAgICAgICIiIlRo4buxYyBoaeG7h24gbGlrZSB2aWRlbywgxrB1IHRpw6puIGLhuqVtIHJhbmRvbSB04buNYSDEkeG7mSwgZmFsbGJhY2sgc2FuZyBi4bqlbSBuw7p0IGxpa2UiIiIKICAgICAgICAjIEzhuqV5IGvDrWNoIHRoxrDhu5tjIG3DoG4gaMOsbmggxJHhu4MgdMOtbmggdOG7jWEgxJHhu5kgcmFuZG9tCiAgICAgICAgd2lkdGgsIGhlaWdodCA9IHNlbGYuaGVscGVyLmdldF9zY3JlZW5fc2l6ZSgpCiAgICAgICAgCiAgICAgICAgIyBUaOG7rSBi4bqlbSByYW5kb20gdOG7jWEgxJHhu5kgdHLGsOG7m2MgKGRvdWJsZSBjbGljaykKICAgICAgICB4ID0gaW50KHdpZHRoICogcmFuZG9tLnVuaWZvcm0oMC41LCAwLjYpKQogICAgICAgIHkgPSBpbnQoaGVpZ2h0ICogcmFuZG9tLnVuaWZvcm0oMC41LCAwLjYpKQogICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJUaOG7rSBkb3VibGUgY2xpY2sgdOG6oWkgdOG7jWEgxJHhu5kgKHt4fSwge3l9KSDEkeG7gyBsaWtlIHZpZGVvIikKICAgICAgICAKICAgICAgICAjIFRo4buxYyBoaeG7h24gZG91YmxlIGNsaWNrCiAgICAgICAgc2VsZi5oZWxwZXIudGFwKHgsIHkpCiAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDAuMSkKICAgICAgICBzZWxmLmhlbHBlci50YXAoeCwgeSkKICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikgICMgQ2jhu50gYW5pbWF0aW9uCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGvhur90IHF14bqjIHNhdSBkb3VibGUgY2xpY2sKICAgICAgICBpZiBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQoY29udGVudF9kZXNjPSLEkMOjIHRow61jaCB2aWRlbyIpOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLEkMOjIGxpa2UgdmlkZW8gdGjDoG5oIGPDtG5nIGLhurFuZyBkb3VibGUgY2xpY2siKQogICAgICAgICAgICByZXR1cm4gMQoKICAgICAgICAKICAgICAgICAjIE7hur91IGRvdWJsZSBjbGljayBraMO0bmcgdGjDoG5oIGPDtG5nLCBi4bqlbSB0cuG7sWMgdGnhur9wIHbDoG8gbsO6dCBsaWtlCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiRG91YmxlIGNsaWNrIGNoxrBhIGxpa2UgxJHGsOG7o2MsIGLhuqVtIHRy4buxYyB0aeG6v3AgdsOgbyBuw7p0IGxpa2UiKQogICAgICAgIAogICAgICAgICMgTOG6pXkgbOG6oWkgdGjDtG5nIHRpbiBuw7p0IGxpa2UgbeG7m2kgbmjhuqV0CiAgICAgICAgY3VycmVudF9saWtlX2J1dHRvbiA9IHNlbGYuX2ZpbmRfbGlrZV9idXR0b24oKQogICAgICAgIGlmIG5vdCBjdXJyZW50X2xpa2VfYnV0dG9uOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBsaWtlIMSR4buDIGLhuqVtIHRy4buxYyB0aeG6v3AiKQogICAgICAgICAgICByZXR1cm4gMgogICAgICAgIAogICAgICAgICMgQuG6pW0gdsOgbyBuw7p0IGxpa2UKICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudChjdXJyZW50X2xpa2VfYnV0dG9uKQogICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSBr4bq/dCBxdeG6oyBzYXUga2hpIGLhuqVtIG7DunQKICAgICAgICBsaWtlX2J1dHRvbl9maW5hbCA9IHNlbGYuX2ZpbmRfbGlrZV9idXR0b24oKQogICAgICAgIGlmIGxpa2VfYnV0dG9uX2ZpbmFsOgogICAgICAgICAgICBpc19zZWxlY3RlZF9maW5hbCA9IHNlbGYuaGVscGVyLmlzX2VsZW1lbnRfc2VsZWN0ZWQobGlrZV9idXR0b25fZmluYWwpCiAgICAgICAgICAgIGNvbnRlbnRfZGVzY19maW5hbCA9IGxpa2VfYnV0dG9uX2ZpbmFsLmdldCgiY29udGVudC1kZXNjIiwgIiIpCiAgICAgICAgICAgIHJlc291cmNlX2lkX2ZpbmFsID0gbGlrZV9idXR0b25fZmluYWwuZ2V0KCJyZXNvdXJjZS1pZCIsICIiKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlNhdSBraGkgYuG6pW0gbsO6dCBsaWtlOiBzZWxlY3RlZD17aXNfc2VsZWN0ZWRfZmluYWx9LCBjb250ZW50LWRlc2M9J3tjb250ZW50X2Rlc2NfZmluYWx9JywgcmVzb3VyY2UtaWQ9J3tyZXNvdXJjZV9pZF9maW5hbH0nIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGlzX3NlbGVjdGVkX2ZpbmFsIG9yICJC4buPIHRow61jaCIgaW4gY29udGVudF9kZXNjX2ZpbmFsIG9yICJVbmxpa2UiIGluIGNvbnRlbnRfZGVzY19maW5hbDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIsSQw6MgbGlrZSB2aWRlbyB0aMOgbmggY8O0bmcgYuG6sW5nIGNsaWNrIG7DunQiKQogICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBsaWtlIHZpZGVvIHNhdSBraGkgdGjhu60gY+G6oyAyIGPDoWNoIikKICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCDEkeG7gyBraeG7g20gdHJhLCBnaeG6oyDEkeG7i25oIHRow6BuaCBjw7RuZwogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBsaWtlIMSR4buDIGtp4buDbSB0cmEsIGdp4bqjIMSR4buLbmggdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgcmV0dXJuIDEKCiAgICBkZWYgX3Njcm9sbF92aWRlb3NfYW5kX3JldHVybl9ob21lKHNlbGYpOgogICAgICAgICIiIlZ14buRdCByYW5kb20gMi01IHZpZGVvIHLhu5NpIHbhu4EgdHJhbmcgY2jhu6ciIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgUmFuZG9tIHPhu5EgbMaw4bujbmcgdmlkZW8gc+G6vSB2deG7kXQgKDItNSkKICAgICAgICAgICAgbnVtX3ZpZGVvcyA9IHJhbmRvbS5yYW5kaW50KDIsIDUpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJT4bq9IHZ14buRdCBxdWEge251bV92aWRlb3N9IHZpZGVvIHRyxrDhu5tjIGtoaSB24buBIHRyYW5nIGNo4bunIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHdpZHRoLCBoZWlnaHQgPSBzZWxmLmhlbHBlci5nZXRfc2NyZWVuX3NpemUoKQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobnVtX3ZpZGVvcyk6CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJWdeG7kXQgdmlkZW8gdGjhu6kge2krMX0ve251bV92aWRlb3N9IikKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOZ2jhu4kgcmFuZG9tIDItNCBnacOieSBuaMawIG5nxrDhu51pIGTDuW5nIHRo4bqtdAogICAgICAgICAgICAgICAgd2FpdF90aW1lID0gcmFuZG9tLnJhbmRpbnQoMiwgNCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFbhu4EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygiSG/DoG4gdGjDoG5oIHZ14buRdCB2aWRlbywgxJFhbmcgcXVheSB24buBIHRyYW5nIGNo4bunIikKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHZ14buRdCB2aWRlbzoge3N0cihlKX0iKQogICAgICAgICAgICAjIFbhuqtuIGPhu5EgZ+G6r25nIHbhu4EgdHJhbmcgY2jhu6cKICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAKICAgIGRlZiBnZXRfam9iX3BhcmFtcyhzZWxmLCBhY2NvdW50OiBEaWN0W3N0ciwgQW55XSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgTOG6pXkgdGhhbSBz4buRIMSR4buDIGfhu41pIEFQSSBs4bqleSBqb2IgY2hvIFRpa1RvawogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rbc3RyLCBBbnldOiBUaGFtIHPhu5EKICAgICAgICAiIiIKICAgICAgICBnb2xpa2VfaWQgPSBhY2NvdW50LmdldCgiZ29saWtlX2lkIikKICAgICAgICBpZiBub3QgZ29saWtlX2lkOgogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImFjY291bnRfaWQiOiBnb2xpa2VfaWQsCiAgICAgICAgICAgICJkYXRhIjogIm51bGwiCiAgICAgICAgfQogICAgICAgIAogICAgZGVmIHN5bmNfYWNjb3VudHNfdG9fZGIoc2VsZikgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgxJDhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB04burIHRoaeG6v3QgYuG7iyB2w6BvIGRhdGFiYXNlCiAgICAgICAgR2hpIMSRw6ggcGjGsMahbmcgdGjhu6ljIGPhu6dhIGzhu5twIGNoYSDEkeG7gyDEkeG6o20gYuG6o28gY2jhu4kgY8OzIG3hu5l0IHTDoGkga2hv4bqjbiDEkcaw4bujYyDEkcOhbmggZOG6pXUgbMOgIMSRYW5nIGxvZ2luCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bq3dCBs4bqhaSB0cuG6oW5nIHRow6FpIGxvZ2luIGNobyB04bqldCBj4bqjIHTDoGkga2hv4bqjbiBUaWtUb2sgdHJvbmcgREIKICAgICAgICAgICAgc2VsZi5kYi5yZXNldF9sb2dpbl9zdGF0dXNfYnlfYXBwKHNlbGYuYXBwX25hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggdMOgaSBraG/huqNuIHThu6sgdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGRldmljZV9hY2NvdW50cyA9IHNlbGYuZ2V0X2FjY291bnRzX2Zyb21fZGV2aWNlKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGhv4bq3YyB0aMOqbSBt4bubaSB2w6BvIERCCiAgICAgICAgICAgIGZvciBhY2NvdW50IGluIGRldmljZV9hY2NvdW50czoKICAgICAgICAgICAgICAgICMgVGjDqm0gdGjDtG5nIHRpbiBhcHAKICAgICAgICAgICAgICAgIGFjY291bnRbImFwcCJdID0gc2VsZi5hcHBfbmFtZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdMOgaSBraG/huqNuIMSRw6MgdOG7k24gdOG6oWkgY2jGsGEKICAgICAgICAgICAgICAgIGV4aXN0aW5nX2FjY291bnRzID0gc2VsZi5kYi5nZXRfYWNjb3VudHMoCiAgICAgICAgICAgICAgICAgICAgYXBwPXNlbGYuYXBwX25hbWUsIAogICAgICAgICAgICAgICAgICAgIHN0YXR1cz0iYWN0aXZlIiBpZiBhY2NvdW50LmdldCgiaXNfbG9naW4iLCBGYWxzZSkgZWxzZSBOb25lCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVMOsbSB0w6BpIGtob+G6o24gdHJvbmcgREIgZOG7sWEgdsOgbyB1bmlxdWVfdXNlcm5hbWUKICAgICAgICAgICAgICAgIGV4aXN0aW5nX2FjY291bnQgPSBOb25lCiAgICAgICAgICAgICAgICBmb3IgYWNjIGluIGV4aXN0aW5nX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgIGlmIGFjYy5nZXQoInVuaXF1ZV91c2VybmFtZSIpID09IGFjY291bnQuZ2V0KCJ1bmlxdWVfdXNlcm5hbWUiKToKICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfYWNjb3VudCA9IGFjYwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBleGlzdGluZ19hY2NvdW50OgogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHTDoGkga2hv4bqjbgogICAgICAgICAgICAgICAgICAgIGFjY291bnRfaWQgPSBleGlzdGluZ19hY2NvdW50WyJpZCJdCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCBhY2NvdW50KQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIFRow6ptIHTDoGkga2hv4bqjbiBt4bubaQogICAgICAgICAgICAgICAgICAgIHNlbGYuZGIuYWRkX2FjY291bnQoYWNjb3VudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZGV2aWNlX2FjY291bnRzCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgZiJM4buXaSBraGkgxJHhu5NuZyBi4buZIHTDoGkga2hv4bqjbiB7c2VsZi5hcHBfbmFtZX0iKQogICAgICAgICAgICByZXR1cm4gW10KCiAgICBkZWYgbWFwX2dvbGlrZV9hY2NvdW50cyhzZWxmLCBnb2xpa2VfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dLCBkZXZpY2VfYWNjb3VudHM6IExpc3RbRGljdFtzdHIsIEFueV1dKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiIKICAgICAgICDDgW5oIHjhuqEgdMOgaSBraG/huqNuIHThu6sgR29MaWtlIHbDoG8gdMOgaSBraG/huqNuIHRyw6puIHRoaeG6v3QgYuG7iwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGdvbGlrZV9hY2NvdW50czogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdOG7qyBHb0xpa2UgQVBJCiAgICAgICAgICAgIGRldmljZV9hY2NvdW50czogRGFuaCBzw6FjaCB0w6BpIGtob+G6o24gdHLDqm4gdGhp4bq/dCBi4buLCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIExpc3RbRGljdFtzdHIsIEFueV1dOiBEYW5oIHPDoWNoIHTDoGkga2hv4bqjbiDEkcOjIMOhbmggeOG6oQogICAgICAgICIiIgogICAgICAgIG1hcHBlZF9hY2NvdW50cyA9IFtdCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIENodeG6qW4gaMOzYSBk4buvIGxp4buHdSB04burIEdvTGlrZQogICAgICAgICAgICBnb2xpa2VfZGF0YSA9IHt9CiAgICAgICAgICAgIGZvciBhY2MgaW4gZ29saWtlX2FjY291bnRzOgogICAgICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IHRow7RuZyB0aW4gdOG7qyB0w6BpIGtob+G6o24gR29MaWtlCiAgICAgICAgICAgICAgICBnb2xpa2VfYWNjb3VudCA9IHsKICAgICAgICAgICAgICAgICAgICAiZ29saWtlX2lkIjogYWNjLmdldCgiaWQiKSwKICAgICAgICAgICAgICAgICAgICAibmlja25hbWUiOiBhY2MuZ2V0KCJuaWNrbmFtZSIpLAogICAgICAgICAgICAgICAgICAgICJ1bmlxdWVfaWQiOiBhY2MuZ2V0KCJ1bmlxdWVfaWQiKSwKICAgICAgICAgICAgICAgICAgICAidW5pcXVlX3VzZXJuYW1lIjogYWNjLmdldCgidW5pcXVlX3VzZXJuYW1lIiksCiAgICAgICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6IGFjYy5nZXQoImF2YXRhcl90aHVtYiIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU+G7rSBk4bulbmcgdW5pcXVlX3VzZXJuYW1lIGzDoG0ga2jDs2EgxJHhu4MgZOG7hSDDoW5oIHjhuqEKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gZ29saWtlX2FjY291bnRbInVuaXF1ZV91c2VybmFtZSJdCiAgICAgICAgICAgICAgICBpZiB1c2VybmFtZToKICAgICAgICAgICAgICAgICAgICBnb2xpa2VfZGF0YVt1c2VybmFtZS5sb3dlcigpXSA9IGdvbGlrZV9hY2NvdW50CiAgICAgICAgICAgIAogICAgICAgICAgICAjIMOBbmggeOG6oSB24bubaSB0w6BpIGtob+G6o24gdHLDqm4gdGhp4bq/dCBi4buLCiAgICAgICAgICAgIGZvciBkZXZpY2VfYWNjb3VudCBpbiBkZXZpY2VfYWNjb3VudHM6CiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGRldmljZV9hY2NvdW50LmdldCgidW5pcXVlX3VzZXJuYW1lIiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXNlcm5hbWUgaW4gZ29saWtlX2RhdGE6CiAgICAgICAgICAgICAgICAgICAgIyDEkMOjIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB0cm9uZyBkYW5oIHPDoWNoIEdvTGlrZQogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdOG7qyBHb0xpa2UgdsOgbyB0w6BpIGtob+G6o24gdGhp4bq/dCBi4buLCiAgICAgICAgICAgICAgICAgICAgZ29saWtlX2luZm8gPSBnb2xpa2VfZGF0YVt1c2VybmFtZV0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJnb2xpa2VfaWQiOiBnb2xpa2VfaW5mb1siZ29saWtlX2lkIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICJpc19nb2xpa2VfbGlua2VkIjogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgImF2YXRhcl90aHVtYiI6IGdvbGlrZV9pbmZvWyJhdmF0YXJfdGh1bWIiXSBvciBkZXZpY2VfYWNjb3VudC5nZXQoImF2YXRhcl90aHVtYiIsICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgInVuaXF1ZV9pZCI6IGdvbGlrZV9pbmZvWyJ1bmlxdWVfaWQiXSBvciBkZXZpY2VfYWNjb3VudC5nZXQoInVuaXF1ZV9pZCIsICIiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFTDrG0gSUQgdMOgaSBraG/huqNuIHRyb25nIERCCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9pZCA9IGRldmljZV9hY2NvdW50LmdldCgiaWQiKQogICAgICAgICAgICAgICAgICAgIGlmIGFjY291bnRfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHbDoG8gREIKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudChhY2NvdW50X2lkLCB1cGRhdGVfZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gdsOgbyBkZXZpY2VfYWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfYWNjb3VudC51cGRhdGUodXBkYXRlX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBlZF9hY2NvdW50cy5hcHBlbmQoZGV2aWNlX2FjY291bnQpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyDDoW5oIHjhuqEgdMOgaSBraG/huqNuIFRpa1Rvazoge3VzZXJuYW1lfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gbWFwcGVkX2FjY291bnRzCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMOhbmggeOG6oSB0w6BpIGtob+G6o24gVGlrVG9rIikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBfbmF2aWdhdGVfdG9fcHJvZmlsZV90YWIoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkGnhu4F1IGjGsOG7m25nIMSR4bq/biB0YWIgaOG7kyBzxqEgVGlrVG9rCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcsIEZhbHNlIG7hur91IHRo4bqldCBi4bqhaQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFTDrG0gdsOgIGLhuqVtIHbDoG8gbsO6dCAiSOG7kyBzxqEiCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICBwcm9maWxlX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJI4buTIHPGoSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgcHJvZmlsZV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgSOG7kyBzxqEiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHByb2ZpbGVfYnV0dG9uKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2w6AgeOG7rSBsw70gZGlhbG9nICJLaMO0bmcgY2hvIHBow6lwIiBu4bq/dSBjw7MKICAgICAgICAgICAgbm90X2FsbG93X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSJLaMO0bmcgY2hvIHBow6lwIikKICAgICAgICAgICAgaWYgbm90X2FsbG93X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiBkaWFsb2cgJ0tow7RuZyBjaG8gcGjDqXAnLCDEkWFuZyBjbGljayDEkeG7gyDEkcOzbmcuLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKG5vdF9hbGxvd19idXR0b24pCiAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB2w6AgeOG7rSBsw70gZGlhbG9nICJMxrB1IGzhuqFpIMSRxINuZyBuaOG6rXAgbOG6p24gc2F1IiBu4bq/dSBjw7MKICAgICAgICAgICAgc2F2ZV9sb2dpbl9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iTMawdSB0aMO0bmcgdGluIMSRxINuZyBuaOG6rXAiKQogICAgICAgICAgICBpZiBzYXZlX2xvZ2luX2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiBkaWFsb2cgJ0zGsHUgbOG6oWkgxJHEg25nIG5o4bqtcCBs4bqnbiBzYXUnLCDEkWFuZyBjbGljayDEkeG7gyDEkcOzbmcuLi4iKQogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHNhdmVfbG9naW5fYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCgoKICAgICAgICAgICAgIyBWdeG7kXQgbMOqbiAxIGzhuqduIMSR4buDIHThuqNpIMSR4bqneSDEkeG7pyBu4buZaSBkdW5nCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnN3aXBlX3VwKCkKICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMSRaeG7gXUgaMaw4bubbmcgxJHhur9uIHRhYiBo4buTIHPGoSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgX29wZW5fcHJvZmlsZV9tZW51KHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgTeG7nyBtZW51IGjhu5Mgc8ahIChkYW5oIHPDoWNoIHTDoGkga2hv4bqjbikKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IHRow6BuaCBjw7RuZywgRmFsc2UgbuG6v3UgdGjhuqV0IGLhuqFpCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgIyBUw6xtIG7DunQgbWVudSBo4buTIHPGoQogICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgbWVudV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnRfaW5feG1sKHNjcmVlbl94bWwsIGNvbnRlbnRfZGVzYz0iTWVudSBo4buTIHPGoSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgbWVudV9idXR0b246CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcigiS2jDtG5nIHTDrG0gdGjhuqV5IG7DunQgTWVudSBo4buTIHPGoSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIEzhuqV5IHThu41hIMSR4buZIGPhu6dhIG7DunQgbWVudSB2w6AgY2xpY2sgduG7m2kgxJHhu5kgbOG7h2NoIG5n4bqrdSBuaGnDqm4KICAgICAgICAgICAgYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKG1lbnVfYnV0dG9uKQogICAgICAgICAgICB4MSwgeTEsIHgyLCB5MiA9IGJvdW5kcwogICAgICAgICAgICB5ID0gKCh5MiAtIHkxKSAvLyAyKSArIHkxCiAgICAgICAgICAgIHggPSB4MiAvLyAyCiAgICAgICAgICAgIHggKz0gcmFuZG9tLnJhbmRpbnQoLTEwLCAxMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcCh4LCB5KQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgbeG7nyBtZW51IGjhu5Mgc8ahIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgZGVmIGlzX2hvbWVfc2NyZWVuKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgS2nhu4NtIHRyYSB4ZW0gY8OzIMSRYW5nIOG7nyBtw6BuIGjDrG5oIHRyYW5nIGNo4bunIFRpa1RvayBraMO0bmcKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBib29sOiBUcnVlIG7hur91IMSRYW5nIOG7nyB0cmFuZyBjaOG7pywgRmFsc2UgbuG6v3Uga2jDtG5nCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgYXBwIMSRYW5nIG3hu58gY8OzIMSRw7puZyB24bubaSBwYWNrYWdlIGPhu6dhIGpvYiBraMO0bmcKICAgICAgICAgICAgY3VycmVudF9wYWNrYWdlID0gc2VsZi5oZWxwZXIuZ2V0X2N1cnJlbnRfcGFja2FnZSgpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkFwcCBoaeG7h24gdOG6oWkgKHtjdXJyZW50X3BhY2thZ2V9KSBraMO0bmcga2jhu5twIHbhu5tpIHBhY2thZ2Ugam9iICh7c2VsZi5hcHBfcGFja2FnZX0pIikKICAgICAgICAgICAgICAgICMgTuG6v3Uga2jDtG5nIHBo4bqjaSBhcHAgVGlrVG9rLCBt4bufIGFwcCBUaWtUb2sKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIk3hu58gbOG6oWkgYXBwIFRpa1Rvay4uLiIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcChzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaSBwYWNrYWdlIHNhdSBraGkgbeG7nyBhcHAKICAgICAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICAgICAgaWYgY3VycmVudF9wYWNrYWdlICE9IHNlbGYuYXBwX3BhY2thZ2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiJLaMO0bmcgdGjhu4MgbeG7nyBhcHAgVGlrVG9rLCBwYWNrYWdlIGhp4buHbiB04bqhaSB24bqrbiBsw6A6IHtjdXJyZW50X3BhY2thZ2V9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyBt4bufIGFwcCBUaWtUb2sgdGjDoG5oIGPDtG5nIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSBjw7MgbsO6dCAiVHJhbmcgY2jhu6ciIMSRxrDhu6NjIGNo4buNbiAoc2VsZWN0ZWQ9dHJ1ZSkgdHJvbmcgdGhhbmggdGFiIGtow7RuZwogICAgICAgICAgICBob21lX3RhYiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChjb250ZW50X2Rlc2M9IlRyYW5nIGNo4bunIikKICAgICAgICAgICAgaWYgaG9tZV90YWI6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmhlbHBlci5pc19lbGVtZW50X3NlbGVjdGVkKGhvbWVfdGFiKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIE7hur91IHTDrG0gdGjhuqV5IHRhYiAiVHJhbmcgY2jhu6ciIG5oxrBuZyBjaMawYSDEkcaw4bujYyBjaOG7jW4sIGNsaWNrIHbDoG8gxJHDswogICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihob21lX3RhYikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMS41KQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2jDtG5nIHTDrG0gdGjhuqV5IGPDoWMgeeG6v3UgdOG7kSBj4bunYSB0cmFuZyBjaOG7pwogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBraeG7g20gdHJhIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgVGlrVG9rIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBlbnN1cmVfaG9tZV9zY3JlZW4oc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICDEkOG6o20gYuG6o28gxJFhbmcg4bufIG3DoG4gaMOsbmggdHJhbmcgY2jhu6cgVGlrVG9rCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBLaeG7g20gdHJhIHBhY2thZ2UgaGnhu4duIHThuqFpIHRyxrDhu5tjIHRpw6puCiAgICAgICAgICAgIGN1cnJlbnRfcGFja2FnZSA9IHNlbGYuaGVscGVyLmdldF9jdXJyZW50X3BhY2thZ2UoKQogICAgICAgICAgICBpZiBjdXJyZW50X3BhY2thZ2UgIT0gc2VsZi5hcHBfcGFja2FnZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJBcHAgaGnhu4duIHThuqFpICh7Y3VycmVudF9wYWNrYWdlfSkga2jDtG5nIHBo4bqjaSBUaWtUb2ssIG3hu58gYXBwIFRpa1Rvay4uLiIpCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5vcGVuX2FwcChzZWxmLmFwcF9wYWNrYWdlKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVmFsaWRhdGUgYXBwIGtow7RuZyBi4buLIGJhbm5lZCBzYXUga2hpIG3hu58KICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnZhbGlkYXRlX2FwcF9ub3RfYmFubmVkKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoIkFwcCBUaWtUb2sgY8OzIHbhuqVuIMSR4buBIChiYW5uZWQvY+G6o25oIGLDoW8pIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyDhu58gdHJhbmcgY2jhu6cgY2jGsGEKICAgICAgICAgICAgaWYgc2VsZi5pc19ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyDhu58gdHJhbmcgY2jhu6cgVGlrVG9rIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBO4bq/dSBjaMawYSwgY+G7kSBn4bqvbmcgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICAgICByZXR1cm4gc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIMSR4bqjbSBi4bqjbyB24buBIHRyYW5nIGNo4bunIFRpa1RvayIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdmFsaWRhdGVfYXBwX25vdF9iYW5uZWQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgxJDhuqNtIGLhuqNvIGtow7RuZyBjw7MgdMOgaSBraG/huqNuIG7DoG8gYuG7iyBiYW5uZWQKICAgICAgICAiIiIKICAgICAgICAjIEtp4buDbSB0cmEgZGlhbG9nIGPhuqNuaCBiw6FvIGNodW5nCiAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgIyBLaeG7g20gdHJhIGRpYWxvZyAiQ+G6rXAgbmjhuq10IENow61uaCBzw6FjaCBxdXnhu4FuIHJpw6puZyB0xrAiCiAgICAgICAgcHJpdmFjeV91cGRhdGVfZWxlbWVudHMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgIHRleHQ9IkPhuq1wIG5o4bqtdCBDaMOtbmggc8OhY2ggcXV54buBbiByacOqbmcgdMawIgogICAgICAgICkKCiAgICAgICAgaWYgcHJpdmFjeV91cGRhdGVfZWxlbWVudHM6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIlBow6F0IGhp4buHbiBkaWFsb2cgJ0Phuq1wIG5o4bqtdCBDaMOtbmggc8OhY2ggcXV54buBbiByacOqbmcgdMawJywgxJFhbmcgeOG7rSBsw70uLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIG7DunQgIsSQw6MgaGnhu4N1IiB2w6AgYuG6pW0gdHLhu7FjIHRp4bq/cAogICAgICAgICAgICB1bmRlcnN0YW5kX2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudCh0ZXh0PSLEkMOjIGhp4buDdSIpCiAgICAgICAgICAgIGlmIHVuZGVyc3RhbmRfYnV0dG9uOgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKHVuZGVyc3RhbmRfYnV0dG9uKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sID0gc2VsZi5oZWxwZXIuZHVtcF9zY3JlZW5feG1sKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVGjhu60gdMOsbSB24bubaSBjw6FjIHRleHQga2jDoWMKICAgICAgICAgICAgICAgIGZvciB0ZXh0IGluIFsiVGnhur9wIHThu6VjIiwgIsSQ4buTbmcgw70iLCAiQ29udGludWUiLCAiQWdyZWUiLCAiQ2jhuqVwIG5o4bqtbiIsICJBY2NlcHQiXToKICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD10ZXh0KQogICAgICAgICAgICAgICAgICAgIGlmIGJ1dHRvbjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICMgS2nhu4NtIHRyYSBkaWFsb2cgIlRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuIgogICAgICAgIGFjY291bnRfc3RhdHVzX2VsZW1lbnRzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICB0ZXh0PSJUcuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbiIKICAgICAgICApCgogICAgICAgIGlmIGFjY291bnRfc3RhdHVzX2VsZW1lbnRzOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJQaMOhdCBoaeG7h24gZGlhbG9nIMSRxINuZyB4deG6pXQgdMOgaSBraG/huqNuLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVMOsbSBuw7p0IGPDsyBpZCBsw6AgYnV0dG9uMSB2w6AgYuG6pW0KICAgICAgICAgICAgYnV0dG9uMSA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudChyZXNvdXJjZV9pZD0iYW5kcm9pZDppZC9idXR0b24xIikKICAgICAgICAgICAgaWYgYnV0dG9uMToKICAgICAgICAgICAgICAgIHNlbGYuaGVscGVyLnRhcF9lbGVtZW50X2NlbnRlcihidXR0b24xKQogICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEwKQogICAgICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCgogICAgICAgICMgVMOsbSBkaWFsb2cgY+G6o25oIGLDoW8gYuG6sW5nIElEIGhv4bq3YyBjb250ZW50LWRlc2MgY8OzIGNo4bupYSAiY+G6o25oIGLDoW8iLCAibOG7l2kiLCAidGjDtG5nIGLDoW8iCiAgICAgICAgYWxlcnRfZGlhbG9ncyA9IHNlbGYuaGVscGVyLmZpbmRfYWxsX2VsZW1lbnRzX2luX3htbCgKICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC5hcHAuRGlhbG9nIgogICAgICAgICkKICAgICAgICAKICAgICAgICBmb3IgZGlhbG9nIGluIGFsZXJ0X2RpYWxvZ3M6CiAgICAgICAgICAgICMgVMOsbSB0ZXh0IHRyb25nIGRpYWxvZwogICAgICAgICAgICB0ZXh0X3ZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LlRleHRWaWV3IgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgdGV4dF92aWV3IGluIHRleHRfdmlld3M6CiAgICAgICAgICAgICAgICB0ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh0ZXh0X3ZpZXcpCiAgICAgICAgICAgICAgICBpZiB0ZXh0IGFuZCBhbnkoa2V5d29yZCBpbiB0ZXh0Lmxvd2VyKCkgZm9yIGtleXdvcmQgaW4gWyJj4bqjbmggYsOhbyIsICJs4buXaSIsICJ0aMO0bmcgYsOhbyIsICJi4buLIGtow7NhIiwgInZpIHBo4bqhbSJdKToKICAgICAgICAgICAgICAgICAgICAjIEzhuqV5IGRhbmggc8OhY2ggY+G6o25oIGLDoW8gaGnhu4duIHThuqFpIHThu6sgZGIKICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dhcm5pbmdzID0gc2VsZi5kYi5nZXQoImxvZ3Mtd2FybmluZy1tZXNzYWdlIiwgW10pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUaMOqbSBj4bqjbmggYsOhbyBt4bubaQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfd2FybmluZ3MuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgInRpbWUiOiBkYXRldGltZS5kYXRldGltZS5ub3coKS5pc29mb3JtYXQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgIm1lc3MiOiB0ZXh0CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENo4buJIGdp4buvIGzhuqFpIHThu5FpIMSRYSAyMCBsb2cgZ+G6p24gbmjhuqV0CiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGN1cnJlbnRfd2FybmluZ3MpID4gMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfd2FybmluZ3MgPSBjdXJyZW50X3dhcm5pbmdzWy0yMDpdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBMxrB1IGzhuqFpIHbDoG8gZGIKICAgICAgICAgICAgICAgICAgICBzZWxmLmRiLnNldCgibG9ncy13YXJuaW5nLW1lc3NhZ2UiLCBjdXJyZW50X3dhcm5pbmdzKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLEkMOjIGzGsHUgY+G6o25oIGLDoW8gVGlrVG9rOiB7dGV4dH0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVMOsbSBuw7p0IE9LIGhv4bq3YyDEkMOzbmcgxJHhu4MgxJHDs25nIGRpYWxvZwogICAgICAgICAgICAgICAgICAgIGJ1dHRvbnMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yIGJ1dHRvbiBpbiBidXR0b25zOgogICAgICAgICAgICAgICAgICAgICAgICBidXR0b25fdGV4dCA9IHNlbGYuaGVscGVyLmdldF9lbGVtZW50X3RleHQoYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBidXR0b25fdGV4dCBhbmQgYnV0dG9uX3RleHQubG93ZXIoKSBpbiBbIm9rIiwgIsSRw7NuZyIsICJ0w7RpIGhp4buDdSIsICLEkeG7k25nIMO9Il06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIoYnV0dG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYWZlX3NsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZSAgIyBDw7MgY+G6o25oIGLDoW8gdGjDrCByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gVHJ1ZSAgIyBLaMO0bmcgY8OzIGPhuqNuaCBiw6FvCiAgICAgICAgCiAgICBkZWYgYmFja190b19ob21lKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgUXVheSB24buBIHRyYW5nIGNo4bunIFRpa1RvayB04burIGLhuqV0IGvhu7MgbcOgbiBow6xuaCBuw6BvCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogVHJ1ZSBu4bq/dSB0aMOgbmggY8O0bmcgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICIiIgogICAgICAgIG1heF9hdHRlbXB0cyA9IDUKICAgICAgICAKICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfYXR0ZW1wdHMpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6Mg4bufIHRyYW5nIGNo4bunIGNoxrBhCiAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygixJDDoyDhu58gdHJhbmcgY2jhu6cgVGlrVG9rIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgcGFja2FnZSBoaeG7h24gdOG6oWkgdHLGsOG7m2Mga2hpIHRo4buxYyBoaeG7h24gdGhhbyB0w6FjCiAgICAgICAgICAgICAgICBjdXJyZW50X3BhY2thZ2UgPSBzZWxmLmhlbHBlci5nZXRfY3VycmVudF9wYWNrYWdlKCkKICAgICAgICAgICAgICAgIGlmIGN1cnJlbnRfcGFja2FnZSAhPSBzZWxmLmFwcF9wYWNrYWdlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJBcHAgaGnhu4duIHThuqFpICh7Y3VycmVudF9wYWNrYWdlfSkga2jDtG5nIHBo4bqjaSBUaWtUb2ssIG3hu58gbOG6oWkgYXBwIFRpa1Rvay4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIub3Blbl9hcHAoc2VsZi5hcHBfcGFja2FnZSkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgbOG6oWkgc2F1IGtoaSBt4bufIGFwcAogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFTDrG0gbsO6dCAiVHJhbmcgY2jhu6ciIOG7nyBib3R0b20gbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgaG9tZV9idXR0b24gPSBzZWxmLmhlbHBlci5maW5kX2VsZW1lbnQodGV4dD0iVHJhbmcgY2jhu6ciKQogICAgICAgICAgICAgICAgaWYgbm90IGhvbWVfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIGhvbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KGNvbnRlbnRfZGVzYz0iVHJhbmcgY2jhu6ciKQogICAgICAgICAgICAgICAgaWYgbm90IGhvbWVfYnV0dG9uOgogICAgICAgICAgICAgICAgICAgIGhvbWVfYnV0dG9uID0gc2VsZi5oZWxwZXIuZmluZF9lbGVtZW50KHRleHQ9IkhvbWUiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgaG9tZV9idXR0b246CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIlTDrG0gdGjhuqV5IG7DunQgVHJhbmcgY2jhu6csIMSRYW5nIGNsaWNrIChs4bqnbiB7YXR0ZW1wdCArIDF9KS4uLiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIudGFwX2VsZW1lbnRfY2VudGVyKGhvbWVfYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSBs4bqhaQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfaG9tZV9zY3JlZW4oKToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBob21lLCB0aOG7rSBuaOG6pW4gYmFjawogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJLaMO0bmcgdMOsbSB0aOG6pXkgbsO6dCBUcmFuZyBjaOG7pywgdGjhu60gbmjhuqVuIGJhY2sgKGzhuqduIHthdHRlbXB0ICsgMX0pLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIkzhu5dpIGtoaSBj4buRIGfhuq9uZyB24buBIHRyYW5nIGNo4bunIChs4bqnbiB7YXR0ZW1wdCArIDF9KToge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdGjhu4MgcXVheSB24buBIHRyYW5nIGNo4bunIFRpa1RvayBzYXUgbmhp4buBdSBs4bqnbiB0aOG7rSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBzd2l0Y2hfYWNjb3VudChzZWxmLCB0YXJnZXRfYWNjb3VudDogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ2h1eeG7g24gc2FuZyB0w6BpIGtob+G6o24gVGlrVG9rIGtow6FjCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdGFyZ2V0X2FjY291bnQ6IFRow7RuZyB0aW4gdMOgaSBraG/huqNuIGPhuqduIGNodXnhu4NuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgY2h1eeG7g24gdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0YXJnZXRfdXNlcm5hbWUgPSB0YXJnZXRfYWNjb3VudC5nZXQoInVuaXF1ZV91c2VybmFtZSIsICIiKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQYW5nIGNodXnhu4NuIHNhbmcgdMOgaSBraG/huqNuIFRpa1Rvazoge3RhcmdldF91c2VybmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gxJFhbmcg4bufIHRyYW5nIGNo4bunCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmVuc3VyZV9ob21lX3NjcmVlbigpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFbDoG8gdHJhbmcgaOG7kyBzxqEKICAgICAgICAgICAgaWYgbm90IHNlbGYuX25hdmlnYXRlX3RvX3Byb2ZpbGVfdGFiKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIFZ14buRdCBsw6puIDEgbOG6p24KICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfdXAoKQogICAgICAgICAgICBzZWxmLnNhZmVfc2xlZXAoMC41KQogICAgICAgICAgICAKICAgICAgICAgICAgIyBN4bufIG1lbnUgaOG7kyBzxqEKICAgICAgICAgICAgaWYgbm90IHNlbGYuX29wZW5fcHJvZmlsZV9tZW51KCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCB0w6BpIGtob+G6o24KICAgICAgICAgICAgc2NyZWVuX3htbCA9IHNlbGYuaGVscGVyLmR1bXBfc2NyZWVuX3htbCgpCiAgICAgICAgICAgIGFkZF9hY2NvdW50X2J1dHRvbiA9IHNlbGYuaGVscGVyLmZpbmRfZWxlbWVudF9pbl94bWwoc2NyZWVuX3htbCwgY29udGVudF9kZXNjPSJUaMOqbSB0w6BpIGtob+G6o24iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGFkZF9hY2NvdW50X2J1dHRvbjoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCJLaMO0bmcgdMOsbSB0aOG6pXkgbWVudSB0w6BpIGtob+G6o24iKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHTDoGkga2hv4bqjbiBj4bqnbiBjaHV54buDbgogICAgICAgICAgICBhY2NvdW50X2J1dHRvbnMgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICBzY3JlZW5feG1sLAogICAgICAgICAgICAgICAgY2xhc3NfbmFtZT0iYW5kcm9pZC53aWRnZXQuQnV0dG9uIgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICB0YXJnZXRfaXRlbSA9IE5vbmUKICAgICAgICAgICAgZm9yIGJ1dHRvbiBpbiBhY2NvdW50X2J1dHRvbnM6CiAgICAgICAgICAgICAgICBpZiBidXR0b24uZ2V0KCJjb250ZW50LWRlc2MiKSA9PSAiVGjDqm0gdMOgaSBraG/huqNuIiBvciBidXR0b24uZ2V0KCJjb250ZW50LWRlc2MiKSA9PSAixJDDs25nIjoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBidXR0b24uZ2V0KCJjb250ZW50LWRlc2MiLCAiIikKICAgICAgICAgICAgICAgIGlmIG5vdCB1c2VybmFtZToKICAgICAgICAgICAgICAgICAgICB0ZXh0dmlld3MgPSBzZWxmLmhlbHBlci5maW5kX2FsbF9lbGVtZW50c19pbl94bWwoCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbl94bWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LlRleHRWaWV3IgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBidXR0b25fYm91bmRzID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfYm91bmRzKGJ1dHRvbikKICAgICAgICAgICAgICAgICAgICBmb3IgdHYgaW4gdGV4dHZpZXdzOgogICAgICAgICAgICAgICAgICAgICAgICB0dl9ib3VuZHMgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF9ib3VuZHModHYpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0dl9ib3VuZHNbMF0gPj0gYnV0dG9uX2JvdW5kc1swXSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR2X2JvdW5kc1sxXSA+PSBidXR0b25fYm91bmRzWzFdIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHZfYm91bmRzWzJdIDw9IGJ1dHRvbl9ib3VuZHNbMl0gYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dl9ib3VuZHNbM10gPD0gYnV0dG9uX2JvdW5kc1szXSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gc2VsZi5oZWxwZXIuZ2V0X2VsZW1lbnRfdGV4dCh0dikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRleHQgYW5kIHRleHQgIT0gIm51bGwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gdGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHVzZXJuYW1lID09IHRhcmdldF91c2VybmFtZToKICAgICAgICAgICAgICAgICAgICB0YXJnZXRfaXRlbSA9IGJ1dHRvbgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRfaXRlbToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYiS2jDtG5nIHTDrG0gdGjhuqV5IHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSB0cm9uZyBkYW5oIHPDoWNoIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgdMOgaSBraG/huqNuIGzDoCBi4buLIHbDtCBoaeG7h3UgaMOzYSB0cm9uZyBEQgogICAgICAgICAgICAgICAgc2VsZi5kYi51cGRhdGVfYWNjb3VudCh0YXJnZXRfYWNjb3VudFsiaWQiXSwgewogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiZGlzYWJsZWQiLAogICAgICAgICAgICAgICAgICAgICJkaXNhYmxlX3JlYXNvbiI6ICJUw6BpIGtob+G6o24ga2jDtG5nIGPDsyB0csOqbiB0aGnhur90IGLhu4siLAogICAgICAgICAgICAgICAgICAgICJsYXN0X3VwZGF0ZSI6IGludCh0aW1lLnRpbWUoKSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTmjhuqVuIEJhY2sgxJHhu4MgxJHDs25nIGRhbmggc8OhY2ggdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICBzZWxmLmhlbHBlci5wcmVzc19iYWNrKCkKICAgICAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFF1YXkgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAjIE5o4bqlcCB2w6BvIHTDoGkga2hv4bqjbiBt4bulYyB0acOqdQogICAgICAgICAgICBzZWxmLmhlbHBlci50YXBfZWxlbWVudF9jZW50ZXIodGFyZ2V0X2l0ZW0pCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCg1KSAgIyDEkOG7o2kgY2h1eeG7g24gdMOgaSBraG/huqNuIGhvw6BuIHThuqV0CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6MgY2h1eeG7g24gdMOgaSBraG/huqNuIHRow6BuaCBjw7RuZyBjaMawYQogICAgICAgICAgICBjdXJyZW50X3VzZXJuYW1lID0gc2VsZi5nZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgY3VycmVudF91c2VybmFtZSA9PSB0YXJnZXRfdXNlcm5hbWU6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYixJDDoyBjaHV54buDbiB0w6BpIGtob+G6o24gdGjDoG5oIGPDtG5nIHNhbmcge3RhcmdldF91c2VybmFtZX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGYixJDDoyBi4bqlbSB2w6BvIHTDoGkga2hv4bqjbiB7dGFyZ2V0X3VzZXJuYW1lfSBuaMawbmcga2nhu4NtIHRyYSBs4bqhaSB0aOG6pXkgxJFhbmcgxJHEg25nIG5o4bqtcCBsw6Age2N1cnJlbnRfdXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5leGNlcHRpb24oZSwgIkzhu5dpIGtoaSBjaHV54buDbiB0w6BpIGtob+G6o24gVGlrVG9rIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgxJDhuqNtIGLhuqNvIHF1YXkgduG7gSB0cmFuZyBjaOG7pwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmJhY2tfdG9faG9tZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICBkZWYgX3BlcmZvcm1fYWNjb3VudF9zd2l0Y2goc2VsZiwgdGFyZ2V0X2FjY291bnQ6IERpY3Rbc3RyLCBBbnldKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFRo4buxYyBoaeG7h24gY8OhYyB0aGFvIHTDoWMgVUkgxJHhu4MgY2h1eeG7g24gdMOgaSBraG/huqNuIFRpa1RvawogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhcmdldF9hY2NvdW50OiBUw6BpIGtob+G6o24gY+G6p24gY2h1eeG7g24gxJHhur9uCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IFRydWUgbuG6v3UgdGjDoG5oIGPDtG5nLCBGYWxzZSBu4bq/dSB0aOG6pXQgYuG6oWkKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnN3aXRjaF9hY2NvdW50KHRhcmdldF9hY2NvdW50KQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXhjZXB0aW9uKGUsICJM4buXaSBraGkgdGjhu7FjIGhp4buHbiBjaHV54buDbiB0w6BpIGtob+G6o24gVGlrVG9rIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBnZXRfY3VycmVudF9sb2dnZWRfaW5fdXNlcm5hbWUoc2VsZikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICAiIiIKICAgICAgICBM4bqleSB1c2VybmFtZSBj4bunYSB0w6BpIGtob+G6o24gVGlrVG9rIMSRYW5nIMSRxINuZyBuaOG6rXAKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBzdHIgaG/hurdjIE5vbmU6IFVzZXJuYW1lIGPhu6dhIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wLCBob+G6t2MgTm9uZSBu4bq/dSBraMO0bmcgY8OzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIMSQ4bqjbSBi4bqjbyDEkWFuZyDhu58gdHJhbmcgY2jhu6cKICAgICAgICAgICAgaWYgbm90IHNlbGYuZW5zdXJlX2hvbWVfc2NyZWVuKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgIyBWw6BvIHRyYW5nIGjhu5Mgc8ahIMSR4buDIGzhuqV5IHVzZXJuYW1lCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9uYXZpZ2F0ZV90b19wcm9maWxlX3RhYigpOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVnXhu5F0IHh14buRbmcgdsOgIGNo4budIDIgZ2nDonkKICAgICAgICAgICAgc2VsZi5oZWxwZXIuc3dpcGVfZG93bigpCiAgICAgICAgICAgIHNlbGYuc2FmZV9zbGVlcCgyKQoKICAgICAgICAgICAgIyBUw6xtIHVzZXJuYW1lIHRyb25nIHRyYW5nIGjhu5Mgc8ahCiAgICAgICAgICAgIHNjcmVlbl94bWwgPSBzZWxmLmhlbHBlci5kdW1wX3NjcmVlbl94bWwoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHRyb25nIGPDoWMgVGV4dFZpZXcgY8OzIHRo4buDIGNo4bupYSB1c2VybmFtZQogICAgICAgICAgICB0ZXh0X3ZpZXdzID0gc2VsZi5oZWxwZXIuZmluZF9hbGxfZWxlbWVudHNfaW5feG1sKAogICAgICAgICAgICAgICAgc2NyZWVuX3htbCwKICAgICAgICAgICAgICAgIGNsYXNzX25hbWU9ImFuZHJvaWQud2lkZ2V0LkJ1dHRvbiIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgdXNlcm5hbWUgPSBOb25lCiAgICAgICAgICAgIGZvciB0ZXh0X3ZpZXcgaW4gdGV4dF92aWV3czoKICAgICAgICAgICAgICAgIHRleHQgPSBzZWxmLmhlbHBlci5nZXRfZWxlbWVudF90ZXh0KHRleHRfdmlldykKICAgICAgICAgICAgICAgIGlmIHRleHQgYW5kIHRleHQuc3RhcnRzd2l0aCgiQCIpIGFuZCBsZW4odGV4dCkgPiAxOgogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gdGV4dFsxOl0gICMgQuG7jyBrw70gdOG7sSBACiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIyBRdWF5IGzhuqFpIHRyYW5nIGNo4bunCiAgICAgICAgICAgIHNlbGYuYmFja190b19ob21lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHVzZXJuYW1lOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIsSQw6MgbOG6pXkgdXNlcm5hbWUgdOG7qyB0cmFuZyBo4buTIHPGoToge3VzZXJuYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gdXNlcm5hbWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIktow7RuZyB0aOG7gyBs4bqleSB1c2VybmFtZSB04burIHRyYW5nIGjhu5Mgc8ahIikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmV4Y2VwdGlvbihlLCAiTOG7l2kga2hpIGzhuqV5IHVzZXJuYW1lIHTDoGkga2hv4bqjbiDEkWFuZyDEkcSDbmcgbmjhuq1wIikKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5iYWNrX3RvX2hvbWUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJldHVybiBOb25l').decode('utf-8'))
